import{r as ee,a as $Y,R as JY,c as aF,b as Hn,g as $A}from"./vendor.CqcSyPVE.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))u(_);new MutationObserver(_=>{for(const E of _)if(E.type==="childList")for(const T of E.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&u(T)}).observe(document,{childList:!0,subtree:!0});function l(_){const E={};return _.integrity&&(E.integrity=_.integrity),_.referrerPolicy&&(E.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?E.credentials="include":_.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function u(_){if(_.ep)return;_.ep=!0;const E=l(_);fetch(_.href,E)}})();var cF={exports:{}},$v={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XY=ee,QY=Symbol.for("react.element"),ZY=Symbol.for("react.fragment"),eq=Object.prototype.hasOwnProperty,tq=XY.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nq={key:!0,ref:!0,__self:!0,__source:!0};function lF(a,r,l){var u,_={},E=null,T=null;l!==void 0&&(E=""+l),r.key!==void 0&&(E=""+r.key),r.ref!==void 0&&(T=r.ref);for(u in r)eq.call(r,u)&&!nq.hasOwnProperty(u)&&(_[u]=r[u]);if(a&&a.defaultProps)for(u in r=a.defaultProps,r)_[u]===void 0&&(_[u]=r[u]);return{$$typeof:QY,type:a,key:E,ref:T,props:_,_owner:tq.current}}$v.Fragment=ZY;$v.jsx=lF;$v.jsxs=lF;cF.exports=$v;var h=cF.exports,vA={},tV=$Y;vA.createRoot=tV.createRoot,vA.hydrateRoot=tV.hydrateRoot;/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function am(){return am=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])}return a},am.apply(this,arguments)}var el;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(el||(el={}));const nV="popstate";function iq(a){a===void 0&&(a={});function r(u,_){let{pathname:E,search:T,hash:R}=u.location;return SA("",{pathname:E,search:T,hash:R},_.state&&_.state.usr||null,_.state&&_.state.key||"default")}function l(u,_){return typeof _=="string"?_:xv(_)}return rq(r,l,null,a)}function bi(a,r){if(a===!1||a===null||typeof a>"u")throw new Error(r)}function dF(a,r){if(!a){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function sq(){return Math.random().toString(36).substr(2,8)}function iV(a,r){return{usr:a.state,key:a.key,idx:r}}function SA(a,r,l,u){return l===void 0&&(l=null),am({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof r=="string"?Rh(r):r,{state:l,key:r&&r.key||u||sq()})}function xv(a){let{pathname:r="/",search:l="",hash:u=""}=a;return l&&l!=="?"&&(r+=l.charAt(0)==="?"?l:"?"+l),u&&u!=="#"&&(r+=u.charAt(0)==="#"?u:"#"+u),r}function Rh(a){let r={};if(a){let l=a.indexOf("#");l>=0&&(r.hash=a.substr(l),a=a.substr(0,l));let u=a.indexOf("?");u>=0&&(r.search=a.substr(u),a=a.substr(0,u)),a&&(r.pathname=a)}return r}function rq(a,r,l,u){u===void 0&&(u={});let{window:_=document.defaultView,v5Compat:E=!1}=u,T=_.history,R=el.Pop,w=null,j=P();j==null&&(j=0,T.replaceState(am({},T.state,{idx:j}),""));function P(){return(T.state||{idx:null}).idx}function U(){R=el.Pop;let ie=P(),te=ie==null?null:ie-j;j=ie,w&&w({action:R,location:Y.location,delta:te})}function G(ie,te){R=el.Push;let Z=SA(Y.location,ie,te);j=P()+1;let se=iV(Z,j),pe=Y.createHref(Z);try{T.pushState(se,"",pe)}catch(ge){if(ge instanceof DOMException&&ge.name==="DataCloneError")throw ge;_.location.assign(pe)}E&&w&&w({action:R,location:Y.location,delta:1})}function q(ie,te){R=el.Replace;let Z=SA(Y.location,ie,te);j=P();let se=iV(Z,j),pe=Y.createHref(Z);T.replaceState(se,"",pe),E&&w&&w({action:R,location:Y.location,delta:0})}function K(ie){let te=_.location.origin!=="null"?_.location.origin:_.location.href,Z=typeof ie=="string"?ie:xv(ie);return Z=Z.replace(/ $/,"%20"),bi(te,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,te)}let Y={get action(){return R},get location(){return a(_,T)},listen(ie){if(w)throw new Error("A history only accepts one active listener");return _.addEventListener(nV,U),w=ie,()=>{_.removeEventListener(nV,U),w=null}},createHref(ie){return r(_,ie)},createURL:K,encodeLocation(ie){let te=K(ie);return{pathname:te.pathname,search:te.search,hash:te.hash}},push:G,replace:q,go(ie){return T.go(ie)}};return Y}var sV;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(sV||(sV={}));function oq(a,r,l){return l===void 0&&(l="/"),aq(a,r,l,!1)}function aq(a,r,l,u){let _=typeof r=="string"?Rh(r):r,E=JA(_.pathname||"/",l);if(E==null)return null;let T=uF(a);cq(T);let R=null;for(let w=0;R==null&&w<T.length;++w){let j=vq(E);R=Eq(T[w],j,u)}return R}function uF(a,r,l,u){r===void 0&&(r=[]),l===void 0&&(l=[]),u===void 0&&(u="");let _=(E,T,R)=>{let w={relativePath:R===void 0?E.path||"":R,caseSensitive:E.caseSensitive===!0,childrenIndex:T,route:E};w.relativePath.startsWith("/")&&(bi(w.relativePath.startsWith(u),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+u+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(u.length));let j=il([u,w.relativePath]),P=l.concat(w);E.children&&E.children.length>0&&(bi(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+j+'".')),uF(E.children,r,P,j)),!(E.path==null&&!E.index)&&r.push({path:j,score:mq(j,E.index),routesMeta:P})};return a.forEach((E,T)=>{var R;if(E.path===""||!((R=E.path)!=null&&R.includes("?")))_(E,T);else for(let w of hF(E.path))_(E,T,w)}),r}function hF(a){let r=a.split("/");if(r.length===0)return[];let[l,...u]=r,_=l.endsWith("?"),E=l.replace(/\?$/,"");if(u.length===0)return _?[E,""]:[E];let T=hF(u.join("/")),R=[];return R.push(...T.map(w=>w===""?E:[E,w].join("/"))),_&&R.push(...T),R.map(w=>a.startsWith("/")&&w===""?"/":w)}function cq(a){a.sort((r,l)=>r.score!==l.score?l.score-r.score:_q(r.routesMeta.map(u=>u.childrenIndex),l.routesMeta.map(u=>u.childrenIndex)))}const lq=/^:[\w-]+$/,dq=3,uq=2,hq=1,pq=10,fq=-2,rV=a=>a==="*";function mq(a,r){let l=a.split("/"),u=l.length;return l.some(rV)&&(u+=fq),r&&(u+=uq),l.filter(_=>!rV(_)).reduce((_,E)=>_+(lq.test(E)?dq:E===""?hq:pq),u)}function _q(a,r){return a.length===r.length&&a.slice(0,-1).every((u,_)=>u===r[_])?a[a.length-1]-r[r.length-1]:0}function Eq(a,r,l){let{routesMeta:u}=a,_={},E="/",T=[];for(let R=0;R<u.length;++R){let w=u[R],j=R===u.length-1,P=E==="/"?r:r.slice(E.length)||"/",U=oV({path:w.relativePath,caseSensitive:w.caseSensitive,end:j},P),G=w.route;if(!U&&j&&l&&!u[u.length-1].route.index&&(U=oV({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},P)),!U)return null;Object.assign(_,U.params),T.push({params:_,pathname:il([E,U.pathname]),pathnameBase:bq(il([E,U.pathnameBase])),route:G}),U.pathnameBase!=="/"&&(E=il([E,U.pathnameBase]))}return T}function oV(a,r){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[l,u]=gq(a.path,a.caseSensitive,a.end),_=r.match(l);if(!_)return null;let E=_[0],T=E.replace(/(.)\/+$/,"$1"),R=_.slice(1);return{params:u.reduce((j,P,U)=>{let{paramName:G,isOptional:q}=P;if(G==="*"){let Y=R[U]||"";T=E.slice(0,E.length-Y.length).replace(/(.)\/+$/,"$1")}const K=R[U];return q&&!K?j[G]=void 0:j[G]=(K||"").replace(/%2F/g,"/"),j},{}),pathname:E,pathnameBase:T,pattern:a}}function gq(a,r,l){r===void 0&&(r=!1),l===void 0&&(l=!0),dF(a==="*"||!a.endsWith("*")||a.endsWith("/*"),'Route path "'+a+'" will be treated as if it were '+('"'+a.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+a.replace(/\*$/,"/*")+'".'));let u=[],_="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(T,R,w)=>(u.push({paramName:R,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return a.endsWith("*")?(u.push({paramName:"*"}),_+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?_+="\\/*$":a!==""&&a!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,r?void 0:"i"),u]}function vq(a){try{return a.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return dF(!1,'The URL path "'+a+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),a}}function JA(a,r){if(r==="/")return a;if(!a.toLowerCase().startsWith(r.toLowerCase()))return null;let l=r.endsWith("/")?r.length-1:r.length,u=a.charAt(l);return u&&u!=="/"?null:a.slice(l)||"/"}function Sq(a,r){r===void 0&&(r="/");let{pathname:l,search:u="",hash:_=""}=typeof a=="string"?Rh(a):a;return{pathname:l?l.startsWith("/")?l:Tq(l,r):r,search:Cq(u),hash:Rq(_)}}function Tq(a,r){let l=r.replace(/\/+$/,"").split("/");return a.split("/").forEach(_=>{_===".."?l.length>1&&l.pop():_!=="."&&l.push(_)}),l.length>1?l.join("/"):"/"}function eA(a,r,l,u){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(u)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function yq(a){return a.filter((r,l)=>l===0||r.route.path&&r.route.path.length>0)}function XA(a,r){let l=yq(a);return r?l.map((u,_)=>_===l.length-1?u.pathname:u.pathnameBase):l.map(u=>u.pathnameBase)}function QA(a,r,l,u){u===void 0&&(u=!1);let _;typeof a=="string"?_=Rh(a):(_=am({},a),bi(!_.pathname||!_.pathname.includes("?"),eA("?","pathname","search",_)),bi(!_.pathname||!_.pathname.includes("#"),eA("#","pathname","hash",_)),bi(!_.search||!_.search.includes("#"),eA("#","search","hash",_)));let E=a===""||_.pathname==="",T=E?"/":_.pathname,R;if(T==null)R=l;else{let U=r.length-1;if(!u&&T.startsWith("..")){let G=T.split("/");for(;G[0]==="..";)G.shift(),U-=1;_.pathname=G.join("/")}R=U>=0?r[U]:"/"}let w=Sq(_,R),j=T&&T!=="/"&&T.endsWith("/"),P=(E||T===".")&&l.endsWith("/");return!w.pathname.endsWith("/")&&(j||P)&&(w.pathname+="/"),w}const il=a=>a.join("/").replace(/\/\/+/g,"/"),bq=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Cq=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Rq=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function wq(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}const pF=["post","put","patch","delete"];new Set(pF);const Aq=["get",...pF];new Set(Aq);/**
 * React Router v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cm(){return cm=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])}return a},cm.apply(this,arguments)}const ZA=ee.createContext(null),Iq=ee.createContext(null),rl=ee.createContext(null),Jv=ee.createContext(null),ol=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),fF=ee.createContext(null);function Oq(a,r){let{relative:l}=r===void 0?{}:r;wh()||bi(!1);let{basename:u,navigator:_}=ee.useContext(rl),{hash:E,pathname:T,search:R}=_F(a,{relative:l}),w=T;return u!=="/"&&(w=T==="/"?u:il([u,T])),_.createHref({pathname:w,search:R,hash:E})}function wh(){return ee.useContext(Jv)!=null}function Ah(){return wh()||bi(!1),ee.useContext(Jv).location}function mF(a){ee.useContext(rl).static||ee.useLayoutEffect(a)}function da(){let{isDataRoute:a}=ee.useContext(ol);return a?Gq():Nq()}function Nq(){wh()||bi(!1);let a=ee.useContext(ZA),{basename:r,future:l,navigator:u}=ee.useContext(rl),{matches:_}=ee.useContext(ol),{pathname:E}=Ah(),T=JSON.stringify(XA(_,l.v7_relativeSplatPath)),R=ee.useRef(!1);return mF(()=>{R.current=!0}),ee.useCallback(function(j,P){if(P===void 0&&(P={}),!R.current)return;if(typeof j=="number"){u.go(j);return}let U=QA(j,JSON.parse(T),E,P.relative==="path");a==null&&r!=="/"&&(U.pathname=U.pathname==="/"?r:il([r,U.pathname])),(P.replace?u.replace:u.push)(U,P.state,P)},[r,u,T,E,a])}function _F(a,r){let{relative:l}=r===void 0?{}:r,{future:u}=ee.useContext(rl),{matches:_}=ee.useContext(ol),{pathname:E}=Ah(),T=JSON.stringify(XA(_,u.v7_relativeSplatPath));return ee.useMemo(()=>QA(a,JSON.parse(T),E,l==="path"),[a,T,E,l])}function Dq(a,r){return Pq(a,r)}function Pq(a,r,l,u){wh()||bi(!1);let{navigator:_}=ee.useContext(rl),{matches:E}=ee.useContext(ol),T=E[E.length-1],R=T?T.params:{};T&&T.pathname;let w=T?T.pathnameBase:"/";T&&T.route;let j=Ah(),P;if(r){var U;let ie=typeof r=="string"?Rh(r):r;w==="/"||(U=ie.pathname)!=null&&U.startsWith(w)||bi(!1),P=ie}else P=j;let G=P.pathname||"/",q=G;if(w!=="/"){let ie=w.replace(/^\//,"").split("/");q="/"+G.replace(/^\//,"").split("/").slice(ie.length).join("/")}let K=oq(a,{pathname:q}),Y=jq(K&&K.map(ie=>Object.assign({},ie,{params:Object.assign({},R,ie.params),pathname:il([w,_.encodeLocation?_.encodeLocation(ie.pathname).pathname:ie.pathname]),pathnameBase:ie.pathnameBase==="/"?w:il([w,_.encodeLocation?_.encodeLocation(ie.pathnameBase).pathname:ie.pathnameBase])})),E,l,u);return r&&Y?ee.createElement(Jv.Provider,{value:{location:cm({pathname:"/",search:"",hash:"",state:null,key:"default"},P),navigationType:el.Pop}},Y):Y}function Lq(){let a=Bq(),r=wq(a)?a.status+" "+a.statusText:a instanceof Error?a.message:JSON.stringify(a),l=a instanceof Error?a.stack:null,_={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},r),l?ee.createElement("pre",{style:_},l):null,null)}const xq=ee.createElement(Lq,null);class kq extends ee.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,l){return l.location!==r.location||l.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:l.error,location:l.location,revalidation:r.revalidation||l.revalidation}}componentDidCatch(r,l){console.error("React Router caught the following error during render",r,l)}render(){return this.state.error!==void 0?ee.createElement(ol.Provider,{value:this.props.routeContext},ee.createElement(fF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Mq(a){let{routeContext:r,match:l,children:u}=a,_=ee.useContext(ZA);return _&&_.static&&_.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=l.route.id),ee.createElement(ol.Provider,{value:r},u)}function jq(a,r,l,u){var _;if(r===void 0&&(r=[]),l===void 0&&(l=null),u===void 0&&(u=null),a==null){var E;if(!l)return null;if(l.errors)a=l.matches;else if((E=u)!=null&&E.v7_partialHydration&&r.length===0&&!l.initialized&&l.matches.length>0)a=l.matches;else return null}let T=a,R=(_=l)==null?void 0:_.errors;if(R!=null){let P=T.findIndex(U=>U.route.id&&(R==null?void 0:R[U.route.id])!==void 0);P>=0||bi(!1),T=T.slice(0,Math.min(T.length,P+1))}let w=!1,j=-1;if(l&&u&&u.v7_partialHydration)for(let P=0;P<T.length;P++){let U=T[P];if((U.route.HydrateFallback||U.route.hydrateFallbackElement)&&(j=P),U.route.id){let{loaderData:G,errors:q}=l,K=U.route.loader&&G[U.route.id]===void 0&&(!q||q[U.route.id]===void 0);if(U.route.lazy||K){w=!0,j>=0?T=T.slice(0,j+1):T=[T[0]];break}}}return T.reduceRight((P,U,G)=>{let q,K=!1,Y=null,ie=null;l&&(q=R&&U.route.id?R[U.route.id]:void 0,Y=U.route.errorElement||xq,w&&(j<0&&G===0?(K=!0,ie=null):j===G&&(K=!0,ie=U.route.hydrateFallbackElement||null)));let te=r.concat(T.slice(0,G+1)),Z=()=>{let se;return q?se=Y:K?se=ie:U.route.Component?se=ee.createElement(U.route.Component,null):U.route.element?se=U.route.element:se=P,ee.createElement(Mq,{match:U,routeContext:{outlet:P,matches:te,isDataRoute:l!=null},children:se})};return l&&(U.route.ErrorBoundary||U.route.errorElement||G===0)?ee.createElement(kq,{location:l.location,revalidation:l.revalidation,component:Y,error:q,children:Z(),routeContext:{outlet:null,matches:te,isDataRoute:!0}}):Z()},null)}var EF=function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a}(EF||{}),kv=function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a}(kv||{});function Uq(a){let r=ee.useContext(ZA);return r||bi(!1),r}function Vq(a){let r=ee.useContext(Iq);return r||bi(!1),r}function Fq(a){let r=ee.useContext(ol);return r||bi(!1),r}function gF(a){let r=Fq(),l=r.matches[r.matches.length-1];return l.route.id||bi(!1),l.route.id}function Bq(){var a;let r=ee.useContext(fF),l=Vq(kv.UseRouteError),u=gF(kv.UseRouteError);return r!==void 0?r:(a=l.errors)==null?void 0:a[u]}function Gq(){let{router:a}=Uq(EF.UseNavigateStable),r=gF(kv.UseNavigateStable),l=ee.useRef(!1);return mF(()=>{l.current=!0}),ee.useCallback(function(_,E){E===void 0&&(E={}),l.current&&(typeof _=="number"?a.navigate(_):a.navigate(_,cm({fromRouteId:r},E)))},[a,r])}const aV={};function Hq(a,r){aV[r]||(aV[r]=!0,console.warn(r))}const cV=(a,r,l)=>Hq(a,"⚠️ React Router Future Flag Warning: "+r+". "+("You can use the `"+a+"` future flag to opt-in early. ")+("For more information, see "+l+"."));function Wq(a,r){a!=null&&a.v7_startTransition||cV("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),!(a!=null&&a.v7_relativeSplatPath)&&!r&&cV("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath")}function Kq(a){let{to:r,replace:l,state:u,relative:_}=a;wh()||bi(!1);let{future:E,static:T}=ee.useContext(rl),{matches:R}=ee.useContext(ol),{pathname:w}=Ah(),j=da(),P=QA(r,XA(R,E.v7_relativeSplatPath),w,_==="path"),U=JSON.stringify(P);return ee.useEffect(()=>j(JSON.parse(U),{replace:l,state:u,relative:_}),[j,U,_,l,u]),null}function ui(a){bi(!1)}function zq(a){let{basename:r="/",children:l=null,location:u,navigationType:_=el.Pop,navigator:E,static:T=!1,future:R}=a;wh()&&bi(!1);let w=r.replace(/^\/*/,"/"),j=ee.useMemo(()=>({basename:w,navigator:E,static:T,future:cm({v7_relativeSplatPath:!1},R)}),[w,R,E,T]);typeof u=="string"&&(u=Rh(u));let{pathname:P="/",search:U="",hash:G="",state:q=null,key:K="default"}=u,Y=ee.useMemo(()=>{let ie=JA(P,w);return ie==null?null:{location:{pathname:ie,search:U,hash:G,state:q,key:K},navigationType:_}},[w,P,U,G,q,K,_]);return Y==null?null:ee.createElement(rl.Provider,{value:j},ee.createElement(Jv.Provider,{children:l,value:Y}))}function Yq(a){let{children:r,location:l}=a;return Dq(TA(r),l)}new Promise(()=>{});function TA(a,r){r===void 0&&(r=[]);let l=[];return ee.Children.forEach(a,(u,_)=>{if(!ee.isValidElement(u))return;let E=[...r,_];if(u.type===ee.Fragment){l.push.apply(l,TA(u.props.children,E));return}u.type!==ui&&bi(!1),!u.props.index||!u.props.children||bi(!1);let T={id:u.props.id||E.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,loader:u.props.loader,action:u.props.action,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(T.children=TA(u.props.children,E)),l.push(T)}),l}/**
 * React Router DOM v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yA(){return yA=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])}return a},yA.apply(this,arguments)}function qq(a,r){if(a==null)return{};var l={},u=Object.keys(a),_,E;for(E=0;E<u.length;E++)_=u[E],!(r.indexOf(_)>=0)&&(l[_]=a[_]);return l}function $q(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function Jq(a,r){return a.button===0&&(!r||r==="_self")&&!$q(a)}const Xq=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Qq="6";try{window.__reactRouterVersion=Qq}catch{}const Zq="startTransition",lV=JY[Zq];function e2(a){let{basename:r,children:l,future:u,window:_}=a,E=ee.useRef();E.current==null&&(E.current=iq({window:_,v5Compat:!0}));let T=E.current,[R,w]=ee.useState({action:T.action,location:T.location}),{v7_startTransition:j}=u||{},P=ee.useCallback(U=>{j&&lV?lV(()=>w(U)):w(U)},[w,j]);return ee.useLayoutEffect(()=>T.listen(P),[T,P]),ee.useEffect(()=>Wq(u),[u]),ee.createElement(zq,{basename:r,children:l,location:R.location,navigationType:R.action,navigator:T,future:u})}const t2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",n2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vt=ee.forwardRef(function(r,l){let{onClick:u,relative:_,reloadDocument:E,replace:T,state:R,target:w,to:j,preventScrollReset:P,viewTransition:U}=r,G=qq(r,Xq),{basename:q}=ee.useContext(rl),K,Y=!1;if(typeof j=="string"&&n2.test(j)&&(K=j,t2))try{let se=new URL(window.location.href),pe=j.startsWith("//")?new URL(se.protocol+j):new URL(j),ge=JA(pe.pathname,q);pe.origin===se.origin&&ge!=null?j=ge+pe.search+pe.hash:Y=!0}catch{}let ie=Oq(j,{relative:_}),te=i2(j,{replace:T,state:R,target:w,preventScrollReset:P,relative:_,viewTransition:U});function Z(se){u&&u(se),se.defaultPrevented||te(se)}return ee.createElement("a",yA({},G,{href:K||ie,onClick:Y||E?u:Z,ref:l,target:w}))});var dV;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(dV||(dV={}));var uV;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(uV||(uV={}));function i2(a,r){let{target:l,replace:u,state:_,preventScrollReset:E,relative:T,viewTransition:R}=r===void 0?{}:r,w=da(),j=Ah(),P=_F(a,{relative:T});return ee.useCallback(U=>{if(Jq(U,l)){U.preventDefault();let G=u!==void 0?u:xv(j)===xv(P);w(a,{replace:G,state:_,preventScrollReset:E,relative:T,viewTransition:R})}},[j,w,P,u,_,l,a,E,T,R])}var s2={exports:{}};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(a,r){(function(l,u){a.exports=u()})(aF,function(){const l=new Map,u={set(x,S,O){l.has(x)||l.set(x,new Map);const W=l.get(x);if(!W.has(S)&&W.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(W.keys())[0]}.`);return}W.set(S,O)},get(x,S){return l.has(x)&&l.get(x).get(S)||null},remove(x,S){if(!l.has(x))return;const O=l.get(x);O.delete(S),O.size===0&&l.delete(x)}},_=1e6,E=1e3,T="transitionend",R=x=>(x&&window.CSS&&window.CSS.escape&&(x=x.replace(/#([^\s"#']+)/g,(S,O)=>`#${CSS.escape(O)}`)),x),w=x=>x==null?`${x}`:Object.prototype.toString.call(x).match(/\s([a-z]+)/i)[1].toLowerCase(),j=x=>{do x+=Math.floor(Math.random()*_);while(document.getElementById(x));return x},P=x=>{if(!x)return 0;let{transitionDuration:S,transitionDelay:O}=window.getComputedStyle(x);const W=Number.parseFloat(S),ne=Number.parseFloat(O);return!W&&!ne?0:(S=S.split(",")[0],O=O.split(",")[0],(Number.parseFloat(S)+Number.parseFloat(O))*E)},U=x=>{x.dispatchEvent(new Event(T))},G=x=>!x||typeof x!="object"?!1:(typeof x.jquery<"u"&&(x=x[0]),typeof x.nodeType<"u"),q=x=>G(x)?x.jquery?x[0]:x:typeof x=="string"&&x.length>0?document.querySelector(R(x)):null,K=x=>{if(!G(x)||x.getClientRects().length===0)return!1;const S=getComputedStyle(x).getPropertyValue("visibility")==="visible",O=x.closest("details:not([open])");if(!O)return S;if(O!==x){const W=x.closest("summary");if(W&&W.parentNode!==O||W===null)return!1}return S},Y=x=>!x||x.nodeType!==Node.ELEMENT_NODE||x.classList.contains("disabled")?!0:typeof x.disabled<"u"?x.disabled:x.hasAttribute("disabled")&&x.getAttribute("disabled")!=="false",ie=x=>{if(!document.documentElement.attachShadow)return null;if(typeof x.getRootNode=="function"){const S=x.getRootNode();return S instanceof ShadowRoot?S:null}return x instanceof ShadowRoot?x:x.parentNode?ie(x.parentNode):null},te=()=>{},Z=x=>{x.offsetHeight},se=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,pe=[],ge=x=>{document.readyState==="loading"?(pe.length||document.addEventListener("DOMContentLoaded",()=>{for(const S of pe)S()}),pe.push(x)):x()},je=()=>document.documentElement.dir==="rtl",Ye=x=>{ge(()=>{const S=se();if(S){const O=x.NAME,W=S.fn[O];S.fn[O]=x.jQueryInterface,S.fn[O].Constructor=x,S.fn[O].noConflict=()=>(S.fn[O]=W,x.jQueryInterface)}})},fe=(x,S=[],O=x)=>typeof x=="function"?x(...S):O,we=(x,S,O=!0)=>{if(!O){fe(x);return}const ne=P(S)+5;let ue=!1;const _e=({target:Ae})=>{Ae===S&&(ue=!0,S.removeEventListener(T,_e),fe(x))};S.addEventListener(T,_e),setTimeout(()=>{ue||U(S)},ne)},Le=(x,S,O,W)=>{const ne=x.length;let ue=x.indexOf(S);return ue===-1?!O&&W?x[ne-1]:x[0]:(ue+=O?1:-1,W&&(ue=(ue+ne)%ne),x[Math.max(0,Math.min(ue,ne-1))])},Fe=/[^.]*(?=\..*)\.|.*/,tt=/\..*/,Me=/::\d+$/,Ze={};let rt=1;const Qt={mouseenter:"mouseover",mouseleave:"mouseout"},rs=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function We(x,S){return S&&`${S}::${rt++}`||x.uidEvent||rt++}function Kt(x){const S=We(x);return x.uidEvent=S,Ze[S]=Ze[S]||{},Ze[S]}function Jt(x,S){return function O(W){return ua(W,{delegateTarget:x}),O.oneOff&&ke.off(x,W.type,S),S.apply(x,[W])}}function vs(x,S,O){return function W(ne){const ue=x.querySelectorAll(S);for(let{target:_e}=ne;_e&&_e!==this;_e=_e.parentNode)for(const Ae of ue)if(Ae===_e)return ua(ne,{delegateTarget:_e}),W.oneOff&&ke.off(x,ne.type,S,O),O.apply(_e,[ne])}}function Ss(x,S,O=null){return Object.values(x).find(W=>W.callable===S&&W.delegationSelector===O)}function Ts(x,S,O){const W=typeof S=="string",ne=W?O:S||O;let ue=Co(x);return rs.has(ue)||(ue=x),[W,ne,ue]}function Ri(x,S,O,W,ne){if(typeof S!="string"||!x)return;let[ue,_e,Ae]=Ts(S,O,W);S in Qt&&(_e=(On=>function(Lt){if(!Lt.relatedTarget||Lt.relatedTarget!==Lt.delegateTarget&&!Lt.delegateTarget.contains(Lt.relatedTarget))return On.call(this,Lt)})(_e));const Ue=Kt(x),it=Ue[Ae]||(Ue[Ae]={}),Be=Ss(it,_e,ue?O:null);if(Be){Be.oneOff=Be.oneOff&&ne;return}const Ot=We(_e,S.replace(Fe,"")),Bt=ue?vs(x,O,_e):Jt(x,_e);Bt.delegationSelector=ue?O:null,Bt.callable=_e,Bt.oneOff=ne,Bt.uidEvent=Ot,it[Ot]=Bt,x.addEventListener(Ae,Bt,ue)}function Ni(x,S,O,W,ne){const ue=Ss(S[O],W,ne);ue&&(x.removeEventListener(O,ue,!!ne),delete S[O][ue.uidEvent])}function cl(x,S,O,W){const ne=S[O]||{};for(const[ue,_e]of Object.entries(ne))ue.includes(W)&&Ni(x,S,O,_e.callable,_e.delegationSelector)}function Co(x){return x=x.replace(tt,""),Qt[x]||x}const ke={on(x,S,O,W){Ri(x,S,O,W,!1)},one(x,S,O,W){Ri(x,S,O,W,!0)},off(x,S,O,W){if(typeof S!="string"||!x)return;const[ne,ue,_e]=Ts(S,O,W),Ae=_e!==S,Ue=Kt(x),it=Ue[_e]||{},Be=S.startsWith(".");if(typeof ue<"u"){if(!Object.keys(it).length)return;Ni(x,Ue,_e,ue,ne?O:null);return}if(Be)for(const Ot of Object.keys(Ue))cl(x,Ue,Ot,S.slice(1));for(const[Ot,Bt]of Object.entries(it)){const Rt=Ot.replace(Me,"");(!Ae||S.includes(Rt))&&Ni(x,Ue,_e,Bt.callable,Bt.delegationSelector)}},trigger(x,S,O){if(typeof S!="string"||!x)return null;const W=se(),ne=Co(S),ue=S!==ne;let _e=null,Ae=!0,Ue=!0,it=!1;ue&&W&&(_e=W.Event(S,O),W(x).trigger(_e),Ae=!_e.isPropagationStopped(),Ue=!_e.isImmediatePropagationStopped(),it=_e.isDefaultPrevented());const Be=ua(new Event(S,{bubbles:Ae,cancelable:!0}),O);return it&&Be.preventDefault(),Ue&&x.dispatchEvent(Be),Be.defaultPrevented&&_e&&_e.preventDefault(),Be}};function ua(x,S={}){for(const[O,W]of Object.entries(S))try{x[O]=W}catch{Object.defineProperty(x,O,{configurable:!0,get(){return W}})}return x}function Kr(x){if(x==="true")return!0;if(x==="false")return!1;if(x===Number(x).toString())return Number(x);if(x===""||x==="null")return null;if(typeof x!="string")return x;try{return JSON.parse(decodeURIComponent(x))}catch{return x}}function Ds(x){return x.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)}const nt={setDataAttribute(x,S,O){x.setAttribute(`data-bs-${Ds(S)}`,O)},removeDataAttribute(x,S){x.removeAttribute(`data-bs-${Ds(S)}`)},getDataAttributes(x){if(!x)return{};const S={},O=Object.keys(x.dataset).filter(W=>W.startsWith("bs")&&!W.startsWith("bsConfig"));for(const W of O){let ne=W.replace(/^bs/,"");ne=ne.charAt(0).toLowerCase()+ne.slice(1,ne.length),S[ne]=Kr(x.dataset[W])}return S},getDataAttribute(x,S){return Kr(x.getAttribute(`data-bs-${Ds(S)}`))}};class Zt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(S){return S=this._mergeConfigObj(S),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}_configAfterMerge(S){return S}_mergeConfigObj(S,O){const W=G(O)?nt.getDataAttribute(O,"config"):{};return{...this.constructor.Default,...typeof W=="object"?W:{},...G(O)?nt.getDataAttributes(O):{},...typeof S=="object"?S:{}}}_typeCheckConfig(S,O=this.constructor.DefaultType){for(const[W,ne]of Object.entries(O)){const ue=S[W],_e=G(ue)?"element":w(ue);if(!new RegExp(ne).test(_e))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${W}" provided type "${_e}" but expected type "${ne}".`)}}}const wi="5.3.3";class Di extends Zt{constructor(S,O){super(),S=q(S),S&&(this._element=S,this._config=this._getConfig(O),u.set(this._element,this.constructor.DATA_KEY,this))}dispose(){u.remove(this._element,this.constructor.DATA_KEY),ke.off(this._element,this.constructor.EVENT_KEY);for(const S of Object.getOwnPropertyNames(this))this[S]=null}_queueCallback(S,O,W=!0){we(S,O,W)}_getConfig(S){return S=this._mergeConfigObj(S,this._element),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}static getInstance(S){return u.get(q(S),this.DATA_KEY)}static getOrCreateInstance(S,O={}){return this.getInstance(S)||new this(S,typeof O=="object"?O:null)}static get VERSION(){return wi}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(S){return`${S}${this.EVENT_KEY}`}}const Ro=x=>{let S=x.getAttribute("data-bs-target");if(!S||S==="#"){let O=x.getAttribute("href");if(!O||!O.includes("#")&&!O.startsWith("."))return null;O.includes("#")&&!O.startsWith("#")&&(O=`#${O.split("#")[1]}`),S=O&&O!=="#"?O.trim():null}return S?S.split(",").map(O=>R(O)).join(","):null},qe={find(x,S=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(S,x))},findOne(x,S=document.documentElement){return Element.prototype.querySelector.call(S,x)},children(x,S){return[].concat(...x.children).filter(O=>O.matches(S))},parents(x,S){const O=[];let W=x.parentNode.closest(S);for(;W;)O.push(W),W=W.parentNode.closest(S);return O},prev(x,S){let O=x.previousElementSibling;for(;O;){if(O.matches(S))return[O];O=O.previousElementSibling}return[]},next(x,S){let O=x.nextElementSibling;for(;O;){if(O.matches(S))return[O];O=O.nextElementSibling}return[]},focusableChildren(x){const S=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(O=>`${O}:not([tabindex^="-"])`).join(",");return this.find(S,x).filter(O=>!Y(O)&&K(O))},getSelectorFromElement(x){const S=Ro(x);return S&&qe.findOne(S)?S:null},getElementFromSelector(x){const S=Ro(x);return S?qe.findOne(S):null},getMultipleElementsFromSelector(x){const S=Ro(x);return S?qe.find(S):[]}},zr=(x,S="hide")=>{const O=`click.dismiss${x.EVENT_KEY}`,W=x.NAME;ke.on(document,O,`[data-bs-dismiss="${W}"]`,function(ne){if(["A","AREA"].includes(this.tagName)&&ne.preventDefault(),Y(this))return;const ue=qe.getElementFromSelector(this)||this.closest(`.${W}`);x.getOrCreateInstance(ue)[S]()})},Ei="alert",Qa=".bs.alert",me=`close${Qa}`,It=`closed${Qa}`,Mt="fade",cn="show";class ys extends Di{static get NAME(){return Ei}close(){if(ke.trigger(this._element,me).defaultPrevented)return;this._element.classList.remove(cn);const O=this._element.classList.contains(Mt);this._queueCallback(()=>this._destroyElement(),this._element,O)}_destroyElement(){this._element.remove(),ke.trigger(this._element,It),this.dispose()}static jQueryInterface(S){return this.each(function(){const O=ys.getOrCreateInstance(this);if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S](this)}})}}zr(ys,"close"),Ye(ys);const vr="button",hm=".bs.button",Ph=".data-api",pm="active",Lh='[data-bs-toggle="button"]',fm=`click${hm}${Ph}`;class Za extends Di{static get NAME(){return vr}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(pm))}static jQueryInterface(S){return this.each(function(){const O=Za.getOrCreateInstance(this);S==="toggle"&&O[S]()})}}ke.on(document,fm,Lh,x=>{x.preventDefault();const S=x.target.closest(Lh);Za.getOrCreateInstance(S).toggle()}),Ye(Za);const ha="swipe",pa=".bs.swipe",cS=`touchstart${pa}`,lS=`touchmove${pa}`,ec=`touchend${pa}`,mm=`pointerdown${pa}`,dS=`pointerup${pa}`,uS="touch",hS="pen",pS="pointer-event",ll=40,fS={endCallback:null,leftCallback:null,rightCallback:null},tc={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Sd extends Zt{constructor(S,O){super(),this._element=S,!(!S||!Sd.isSupported())&&(this._config=this._getConfig(O),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return fS}static get DefaultType(){return tc}static get NAME(){return ha}dispose(){ke.off(this._element,pa)}_start(S){if(!this._supportPointerEvents){this._deltaX=S.touches[0].clientX;return}this._eventIsPointerPenTouch(S)&&(this._deltaX=S.clientX)}_end(S){this._eventIsPointerPenTouch(S)&&(this._deltaX=S.clientX-this._deltaX),this._handleSwipe(),fe(this._config.endCallback)}_move(S){this._deltaX=S.touches&&S.touches.length>1?0:S.touches[0].clientX-this._deltaX}_handleSwipe(){const S=Math.abs(this._deltaX);if(S<=ll)return;const O=S/this._deltaX;this._deltaX=0,O&&fe(O>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(ke.on(this._element,mm,S=>this._start(S)),ke.on(this._element,dS,S=>this._end(S)),this._element.classList.add(pS)):(ke.on(this._element,cS,S=>this._start(S)),ke.on(this._element,lS,S=>this._move(S)),ke.on(this._element,ec,S=>this._end(S)))}_eventIsPointerPenTouch(S){return this._supportPointerEvents&&(S.pointerType===hS||S.pointerType===uS)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const mS="carousel",ii=".bs.carousel",_m=".data-api",_S="ArrowLeft",Td="ArrowRight",Em=500,nc="next",fa="prev",ic="left",dl="right",ES=`slide${ii}`,yd=`slid${ii}`,gS=`keydown${ii}`,vS=`mouseenter${ii}`,SS=`mouseleave${ii}`,gm=`dragstart${ii}`,vm=`load${ii}${_m}`,xh=`click${ii}${_m}`,kh="carousel",Yr="active",TS="slide",yS="carousel-item-end",Sr="carousel-item-start",bS="carousel-item-next",CS="carousel-item-prev",Xn=".active",Sm=".carousel-item",RS=Xn+Sm,wS=".carousel-item img",AS=".carousel-indicators",Mh="[data-bs-slide], [data-bs-slide-to]",IS='[data-bs-ride="carousel"]',Tm={[_S]:dl,[Td]:ic},OS={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},NS={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class sc extends Di{constructor(S,O){super(S,O),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=qe.findOne(AS,this._element),this._addEventListeners(),this._config.ride===kh&&this.cycle()}static get Default(){return OS}static get DefaultType(){return NS}static get NAME(){return mS}next(){this._slide(nc)}nextWhenVisible(){!document.hidden&&K(this._element)&&this.next()}prev(){this._slide(fa)}pause(){this._isSliding&&U(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){ke.one(this._element,yd,()=>this.cycle());return}this.cycle()}}to(S){const O=this._getItems();if(S>O.length-1||S<0)return;if(this._isSliding){ke.one(this._element,yd,()=>this.to(S));return}const W=this._getItemIndex(this._getActive());if(W===S)return;const ne=S>W?nc:fa;this._slide(ne,O[S])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(S){return S.defaultInterval=S.interval,S}_addEventListeners(){this._config.keyboard&&ke.on(this._element,gS,S=>this._keydown(S)),this._config.pause==="hover"&&(ke.on(this._element,vS,()=>this.pause()),ke.on(this._element,SS,()=>this._maybeEnableCycle())),this._config.touch&&Sd.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const W of qe.find(wS,this._element))ke.on(W,gm,ne=>ne.preventDefault());const O={leftCallback:()=>this._slide(this._directionToOrder(ic)),rightCallback:()=>this._slide(this._directionToOrder(dl)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),Em+this._config.interval))}};this._swipeHelper=new Sd(this._element,O)}_keydown(S){if(/input|textarea/i.test(S.target.tagName))return;const O=Tm[S.key];O&&(S.preventDefault(),this._slide(this._directionToOrder(O)))}_getItemIndex(S){return this._getItems().indexOf(S)}_setActiveIndicatorElement(S){if(!this._indicatorsElement)return;const O=qe.findOne(Xn,this._indicatorsElement);O.classList.remove(Yr),O.removeAttribute("aria-current");const W=qe.findOne(`[data-bs-slide-to="${S}"]`,this._indicatorsElement);W&&(W.classList.add(Yr),W.setAttribute("aria-current","true"))}_updateInterval(){const S=this._activeElement||this._getActive();if(!S)return;const O=Number.parseInt(S.getAttribute("data-bs-interval"),10);this._config.interval=O||this._config.defaultInterval}_slide(S,O=null){if(this._isSliding)return;const W=this._getActive(),ne=S===nc,ue=O||Le(this._getItems(),W,ne,this._config.wrap);if(ue===W)return;const _e=this._getItemIndex(ue),Ae=Rt=>ke.trigger(this._element,Rt,{relatedTarget:ue,direction:this._orderToDirection(S),from:this._getItemIndex(W),to:_e});if(Ae(ES).defaultPrevented||!W||!ue)return;const it=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(_e),this._activeElement=ue;const Be=ne?Sr:yS,Ot=ne?bS:CS;ue.classList.add(Ot),Z(ue),W.classList.add(Be),ue.classList.add(Be);const Bt=()=>{ue.classList.remove(Be,Ot),ue.classList.add(Yr),W.classList.remove(Yr,Ot,Be),this._isSliding=!1,Ae(yd)};this._queueCallback(Bt,W,this._isAnimated()),it&&this.cycle()}_isAnimated(){return this._element.classList.contains(TS)}_getActive(){return qe.findOne(RS,this._element)}_getItems(){return qe.find(Sm,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(S){return je()?S===ic?fa:nc:S===ic?nc:fa}_orderToDirection(S){return je()?S===fa?ic:dl:S===fa?dl:ic}static jQueryInterface(S){return this.each(function(){const O=sc.getOrCreateInstance(this,S);if(typeof S=="number"){O.to(S);return}if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S]()}})}}ke.on(document,xh,Mh,function(x){const S=qe.getElementFromSelector(this);if(!S||!S.classList.contains(kh))return;x.preventDefault();const O=sc.getOrCreateInstance(S),W=this.getAttribute("data-bs-slide-to");if(W){O.to(W),O._maybeEnableCycle();return}if(nt.getDataAttribute(this,"slide")==="next"){O.next(),O._maybeEnableCycle();return}O.prev(),O._maybeEnableCycle()}),ke.on(window,vm,()=>{const x=qe.find(IS);for(const S of x)sc.getOrCreateInstance(S)}),Ye(sc);const rc="collapse",ul=".bs.collapse",yn=".data-api",DS=`show${ul}`,bm=`shown${ul}`,Cm=`hide${ul}`,PS=`hidden${ul}`,LS=`click${ul}${yn}`,jh="show",oc="collapse",bd="collapsing",xS="collapsed",Uh=`:scope .${oc} .${oc}`,Rm="collapse-horizontal",Vh="width",kS="height",Fh=".collapse.show, .collapse.collapsing",Bh='[data-bs-toggle="collapse"]',wm={parent:null,toggle:!0},MS={parent:"(null|element)",toggle:"boolean"};class ac extends Di{constructor(S,O){super(S,O),this._isTransitioning=!1,this._triggerArray=[];const W=qe.find(Bh);for(const ne of W){const ue=qe.getSelectorFromElement(ne),_e=qe.find(ue).filter(Ae=>Ae===this._element);ue!==null&&_e.length&&this._triggerArray.push(ne)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return wm}static get DefaultType(){return MS}static get NAME(){return rc}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let S=[];if(this._config.parent&&(S=this._getFirstLevelChildren(Fh).filter(Ae=>Ae!==this._element).map(Ae=>ac.getOrCreateInstance(Ae,{toggle:!1}))),S.length&&S[0]._isTransitioning||ke.trigger(this._element,DS).defaultPrevented)return;for(const Ae of S)Ae.hide();const W=this._getDimension();this._element.classList.remove(oc),this._element.classList.add(bd),this._element.style[W]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const ne=()=>{this._isTransitioning=!1,this._element.classList.remove(bd),this._element.classList.add(oc,jh),this._element.style[W]="",ke.trigger(this._element,bm)},_e=`scroll${W[0].toUpperCase()+W.slice(1)}`;this._queueCallback(ne,this._element,!0),this._element.style[W]=`${this._element[_e]}px`}hide(){if(this._isTransitioning||!this._isShown()||ke.trigger(this._element,Cm).defaultPrevented)return;const O=this._getDimension();this._element.style[O]=`${this._element.getBoundingClientRect()[O]}px`,Z(this._element),this._element.classList.add(bd),this._element.classList.remove(oc,jh);for(const ne of this._triggerArray){const ue=qe.getElementFromSelector(ne);ue&&!this._isShown(ue)&&this._addAriaAndCollapsedClass([ne],!1)}this._isTransitioning=!0;const W=()=>{this._isTransitioning=!1,this._element.classList.remove(bd),this._element.classList.add(oc),ke.trigger(this._element,PS)};this._element.style[O]="",this._queueCallback(W,this._element,!0)}_isShown(S=this._element){return S.classList.contains(jh)}_configAfterMerge(S){return S.toggle=!!S.toggle,S.parent=q(S.parent),S}_getDimension(){return this._element.classList.contains(Rm)?Vh:kS}_initializeChildren(){if(!this._config.parent)return;const S=this._getFirstLevelChildren(Bh);for(const O of S){const W=qe.getElementFromSelector(O);W&&this._addAriaAndCollapsedClass([O],this._isShown(W))}}_getFirstLevelChildren(S){const O=qe.find(Uh,this._config.parent);return qe.find(S,this._config.parent).filter(W=>!O.includes(W))}_addAriaAndCollapsedClass(S,O){if(S.length)for(const W of S)W.classList.toggle(xS,!O),W.setAttribute("aria-expanded",O)}static jQueryInterface(S){const O={};return typeof S=="string"&&/show|hide/.test(S)&&(O.toggle=!1),this.each(function(){const W=ac.getOrCreateInstance(this,O);if(typeof S=="string"){if(typeof W[S]>"u")throw new TypeError(`No method named "${S}"`);W[S]()}})}}ke.on(document,LS,Bh,function(x){(x.target.tagName==="A"||x.delegateTarget&&x.delegateTarget.tagName==="A")&&x.preventDefault();for(const S of qe.getMultipleElementsFromSelector(this))ac.getOrCreateInstance(S,{toggle:!1}).toggle()}),Ye(ac);var Ji="top",bs="bottom",Cs="right",Xi="left",Cd="auto",cc=[Ji,bs,Cs,Xi],Ao="start",lc="end",Am="clippingParents",Gh="viewport",Tr="popper",Im="reference",Hh=cc.reduce(function(x,S){return x.concat([S+"-"+Ao,S+"-"+lc])},[]),Wh=[].concat(cc,[Cd]).reduce(function(x,S){return x.concat([S,S+"-"+Ao,S+"-"+lc])},[]),Om="beforeRead",Kh="read",Nm="afterRead",Dm="beforeMain",Pm="main",qr="afterMain",Rs="beforeWrite",zh="write",Lm="afterWrite",xm=[Om,Kh,Nm,Dm,Pm,qr,Rs,zh,Lm];function yr(x){return x?(x.nodeName||"").toLowerCase():null}function In(x){if(x==null)return window;if(x.toString()!=="[object Window]"){var S=x.ownerDocument;return S&&S.defaultView||window}return x}function ma(x){var S=In(x).Element;return x instanceof S||x instanceof Element}function Ps(x){var S=In(x).HTMLElement;return x instanceof S||x instanceof HTMLElement}function Yh(x){if(typeof ShadowRoot>"u")return!1;var S=In(x).ShadowRoot;return x instanceof S||x instanceof ShadowRoot}function Rd(x){var S=x.state;Object.keys(S.elements).forEach(function(O){var W=S.styles[O]||{},ne=S.attributes[O]||{},ue=S.elements[O];!Ps(ue)||!yr(ue)||(Object.assign(ue.style,W),Object.keys(ne).forEach(function(_e){var Ae=ne[_e];Ae===!1?ue.removeAttribute(_e):ue.setAttribute(_e,Ae===!0?"":Ae)}))})}function km(x){var S=x.state,O={popper:{position:S.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(S.elements.popper.style,O.popper),S.styles=O,S.elements.arrow&&Object.assign(S.elements.arrow.style,O.arrow),function(){Object.keys(S.elements).forEach(function(W){var ne=S.elements[W],ue=S.attributes[W]||{},_e=Object.keys(S.styles.hasOwnProperty(W)?S.styles[W]:O[W]),Ae=_e.reduce(function(Ue,it){return Ue[it]="",Ue},{});!Ps(ne)||!yr(ne)||(Object.assign(ne.style,Ae),Object.keys(ue).forEach(function(Ue){ne.removeAttribute(Ue)}))})}}const qh={name:"applyStyles",enabled:!0,phase:"write",fn:Rd,effect:km,requires:["computeStyles"]};function Ls(x){return x.split("-")[0]}var _a=Math.max,dc=Math.min,Io=Math.round;function hl(){var x=navigator.userAgentData;return x!=null&&x.brands&&Array.isArray(x.brands)?x.brands.map(function(S){return S.brand+"/"+S.version}).join(" "):navigator.userAgent}function Mm(){return!/^((?!chrome|android).)*safari/i.test(hl())}function uc(x,S,O){S===void 0&&(S=!1),O===void 0&&(O=!1);var W=x.getBoundingClientRect(),ne=1,ue=1;S&&Ps(x)&&(ne=x.offsetWidth>0&&Io(W.width)/x.offsetWidth||1,ue=x.offsetHeight>0&&Io(W.height)/x.offsetHeight||1);var _e=ma(x)?In(x):window,Ae=_e.visualViewport,Ue=!Mm()&&O,it=(W.left+(Ue&&Ae?Ae.offsetLeft:0))/ne,Be=(W.top+(Ue&&Ae?Ae.offsetTop:0))/ue,Ot=W.width/ne,Bt=W.height/ue;return{width:Ot,height:Bt,top:Be,right:it+Ot,bottom:Be+Bt,left:it,x:it,y:Be}}function $r(x){var S=uc(x),O=x.offsetWidth,W=x.offsetHeight;return Math.abs(S.width-O)<=1&&(O=S.width),Math.abs(S.height-W)<=1&&(W=S.height),{x:x.offsetLeft,y:x.offsetTop,width:O,height:W}}function hc(x,S){var O=S.getRootNode&&S.getRootNode();if(x.contains(S))return!0;if(O&&Yh(O)){var W=S;do{if(W&&x.isSameNode(W))return!0;W=W.parentNode||W.host}while(W)}return!1}function Jr(x){return In(x).getComputedStyle(x)}function jS(x){return["table","td","th"].indexOf(yr(x))>=0}function Oo(x){return((ma(x)?x.ownerDocument:x.document)||window.document).documentElement}function wd(x){return yr(x)==="html"?x:x.assignedSlot||x.parentNode||(Yh(x)?x.host:null)||Oo(x)}function jm(x){return!Ps(x)||Jr(x).position==="fixed"?null:x.offsetParent}function pc(x){var S=/firefox/i.test(hl()),O=/Trident/i.test(hl());if(O&&Ps(x)){var W=Jr(x);if(W.position==="fixed")return null}var ne=wd(x);for(Yh(ne)&&(ne=ne.host);Ps(ne)&&["html","body"].indexOf(yr(ne))<0;){var ue=Jr(ne);if(ue.transform!=="none"||ue.perspective!=="none"||ue.contain==="paint"||["transform","perspective"].indexOf(ue.willChange)!==-1||S&&ue.willChange==="filter"||S&&ue.filter&&ue.filter!=="none")return ne;ne=ne.parentNode}return null}function pl(x){for(var S=In(x),O=jm(x);O&&jS(O)&&Jr(O).position==="static";)O=jm(O);return O&&(yr(O)==="html"||yr(O)==="body"&&Jr(O).position==="static")?S:O||pc(x)||S}function No(x){return["top","bottom"].indexOf(x)>=0?"x":"y"}function fc(x,S,O){return _a(x,dc(S,O))}function US(x,S,O){var W=fc(x,S,O);return W>O?O:W}function yt(){return{top:0,right:0,bottom:0,left:0}}function Um(x){return Object.assign({},yt(),x)}function Vm(x,S){return S.reduce(function(O,W){return O[W]=x,O},{})}var VS=function(S,O){return S=typeof S=="function"?S(Object.assign({},O.rects,{placement:O.placement})):S,Um(typeof S!="number"?S:Vm(S,cc))};function FS(x){var S,O=x.state,W=x.name,ne=x.options,ue=O.elements.arrow,_e=O.modifiersData.popperOffsets,Ae=Ls(O.placement),Ue=No(Ae),it=[Xi,Cs].indexOf(Ae)>=0,Be=it?"height":"width";if(!(!ue||!_e)){var Ot=VS(ne.padding,O),Bt=$r(ue),Rt=Ue==="y"?Ji:Xi,On=Ue==="y"?bs:Cs,Lt=O.rects.reference[Be]+O.rects.reference[Ue]-_e[Ue]-O.rects.popper[Be],ln=_e[Ue]-O.rects.reference[Ue],kn=pl(ue),Qn=kn?Ue==="y"?kn.clientHeight||0:kn.clientWidth||0:0,si=Lt/2-ln/2,Gt=Ot[Rt],Sn=Qn-Bt[Be]-Ot[On],bn=Qn/2-Bt[Be]/2+si,Zn=fc(Gt,bn,Sn),Pi=Ue;O.modifiersData[W]=(S={},S[Pi]=Zn,S.centerOffset=Zn-bn,S)}}function $h(x){var S=x.state,O=x.options,W=O.element,ne=W===void 0?"[data-popper-arrow]":W;ne!=null&&(typeof ne=="string"&&(ne=S.elements.popper.querySelector(ne),!ne)||hc(S.elements.popper,ne)&&(S.elements.arrow=ne))}const Fm={name:"arrow",enabled:!0,phase:"main",fn:FS,effect:$h,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mc(x){return x.split("-")[1]}var BS={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Jh(x,S){var O=x.x,W=x.y,ne=S.devicePixelRatio||1;return{x:Io(O*ne)/ne||0,y:Io(W*ne)/ne||0}}function Bm(x){var S,O=x.popper,W=x.popperRect,ne=x.placement,ue=x.variation,_e=x.offsets,Ae=x.position,Ue=x.gpuAcceleration,it=x.adaptive,Be=x.roundOffsets,Ot=x.isFixed,Bt=_e.x,Rt=Bt===void 0?0:Bt,On=_e.y,Lt=On===void 0?0:On,ln=typeof Be=="function"?Be({x:Rt,y:Lt}):{x:Rt,y:Lt};Rt=ln.x,Lt=ln.y;var kn=_e.hasOwnProperty("x"),Qn=_e.hasOwnProperty("y"),si=Xi,Gt=Ji,Sn=window;if(it){var bn=pl(O),Zn="clientHeight",Pi="clientWidth";if(bn===In(O)&&(bn=Oo(O),Jr(bn).position!=="static"&&Ae==="absolute"&&(Zn="scrollHeight",Pi="scrollWidth")),bn=bn,ne===Ji||(ne===Xi||ne===Cs)&&ue===lc){Gt=bs;var ri=Ot&&bn===Sn&&Sn.visualViewport?Sn.visualViewport.height:bn[Zn];Lt-=ri-W.height,Lt*=Ue?1:-1}if(ne===Xi||(ne===Ji||ne===bs)&&ue===lc){si=Cs;var gi=Ot&&bn===Sn&&Sn.visualViewport?Sn.visualViewport.width:bn[Pi];Rt-=gi-W.width,Rt*=Ue?1:-1}}var Fi=Object.assign({position:Ae},it&&BS),tr=Be===!0?Jh({x:Rt,y:Lt},In(O)):{x:Rt,y:Lt};if(Rt=tr.x,Lt=tr.y,Ue){var Bi;return Object.assign({},Fi,(Bi={},Bi[Gt]=Qn?"0":"",Bi[si]=kn?"0":"",Bi.transform=(Sn.devicePixelRatio||1)<=1?"translate("+Rt+"px, "+Lt+"px)":"translate3d("+Rt+"px, "+Lt+"px, 0)",Bi))}return Object.assign({},Fi,(S={},S[Gt]=Qn?Lt+"px":"",S[si]=kn?Rt+"px":"",S.transform="",S))}function GS(x){var S=x.state,O=x.options,W=O.gpuAcceleration,ne=W===void 0?!0:W,ue=O.adaptive,_e=ue===void 0?!0:ue,Ae=O.roundOffsets,Ue=Ae===void 0?!0:Ae,it={placement:Ls(S.placement),variation:mc(S.placement),popper:S.elements.popper,popperRect:S.rects.popper,gpuAcceleration:ne,isFixed:S.options.strategy==="fixed"};S.modifiersData.popperOffsets!=null&&(S.styles.popper=Object.assign({},S.styles.popper,Bm(Object.assign({},it,{offsets:S.modifiersData.popperOffsets,position:S.options.strategy,adaptive:_e,roundOffsets:Ue})))),S.modifiersData.arrow!=null&&(S.styles.arrow=Object.assign({},S.styles.arrow,Bm(Object.assign({},it,{offsets:S.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Ue})))),S.attributes.popper=Object.assign({},S.attributes.popper,{"data-popper-placement":S.placement})}const Ad={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:GS,data:{}};var Id={passive:!0};function Do(x){var S=x.state,O=x.instance,W=x.options,ne=W.scroll,ue=ne===void 0?!0:ne,_e=W.resize,Ae=_e===void 0?!0:_e,Ue=In(S.elements.popper),it=[].concat(S.scrollParents.reference,S.scrollParents.popper);return ue&&it.forEach(function(Be){Be.addEventListener("scroll",O.update,Id)}),Ae&&Ue.addEventListener("resize",O.update,Id),function(){ue&&it.forEach(function(Be){Be.removeEventListener("scroll",O.update,Id)}),Ae&&Ue.removeEventListener("resize",O.update,Id)}}const Xh={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Do,data:{}};var HS={left:"right",right:"left",bottom:"top",top:"bottom"};function Od(x){return x.replace(/left|right|bottom|top/g,function(S){return HS[S]})}var Gm={start:"end",end:"start"};function Nd(x){return x.replace(/start|end/g,function(S){return Gm[S]})}function Qh(x){var S=In(x),O=S.pageXOffset,W=S.pageYOffset;return{scrollLeft:O,scrollTop:W}}function Zh(x){return uc(Oo(x)).left+Qh(x).scrollLeft}function WS(x,S){var O=In(x),W=Oo(x),ne=O.visualViewport,ue=W.clientWidth,_e=W.clientHeight,Ae=0,Ue=0;if(ne){ue=ne.width,_e=ne.height;var it=Mm();(it||!it&&S==="fixed")&&(Ae=ne.offsetLeft,Ue=ne.offsetTop)}return{width:ue,height:_e,x:Ae+Zh(x),y:Ue}}function xs(x){var S,O=Oo(x),W=Qh(x),ne=(S=x.ownerDocument)==null?void 0:S.body,ue=_a(O.scrollWidth,O.clientWidth,ne?ne.scrollWidth:0,ne?ne.clientWidth:0),_e=_a(O.scrollHeight,O.clientHeight,ne?ne.scrollHeight:0,ne?ne.clientHeight:0),Ae=-W.scrollLeft+Zh(x),Ue=-W.scrollTop;return Jr(ne||O).direction==="rtl"&&(Ae+=_a(O.clientWidth,ne?ne.clientWidth:0)-ue),{width:ue,height:_e,x:Ae,y:Ue}}function ep(x){var S=Jr(x),O=S.overflow,W=S.overflowX,ne=S.overflowY;return/auto|scroll|overlay|hidden/.test(O+ne+W)}function Hm(x){return["html","body","#document"].indexOf(yr(x))>=0?x.ownerDocument.body:Ps(x)&&ep(x)?x:Hm(wd(x))}function fl(x,S){var O;S===void 0&&(S=[]);var W=Hm(x),ne=W===((O=x.ownerDocument)==null?void 0:O.body),ue=In(W),_e=ne?[ue].concat(ue.visualViewport||[],ep(W)?W:[]):W,Ae=S.concat(_e);return ne?Ae:Ae.concat(fl(wd(_e)))}function tp(x){return Object.assign({},x,{left:x.x,top:x.y,right:x.x+x.width,bottom:x.y+x.height})}function Wm(x,S){var O=uc(x,!1,S==="fixed");return O.top=O.top+x.clientTop,O.left=O.left+x.clientLeft,O.bottom=O.top+x.clientHeight,O.right=O.left+x.clientWidth,O.width=x.clientWidth,O.height=x.clientHeight,O.x=O.left,O.y=O.top,O}function Km(x,S,O){return S===Gh?tp(WS(x,O)):ma(S)?Wm(S,O):tp(xs(Oo(x)))}function KS(x){var S=fl(wd(x)),O=["absolute","fixed"].indexOf(Jr(x).position)>=0,W=O&&Ps(x)?pl(x):x;return ma(W)?S.filter(function(ne){return ma(ne)&&hc(ne,W)&&yr(ne)!=="body"}):[]}function zm(x,S,O,W){var ne=S==="clippingParents"?KS(x):[].concat(S),ue=[].concat(ne,[O]),_e=ue[0],Ae=ue.reduce(function(Ue,it){var Be=Km(x,it,W);return Ue.top=_a(Be.top,Ue.top),Ue.right=dc(Be.right,Ue.right),Ue.bottom=dc(Be.bottom,Ue.bottom),Ue.left=_a(Be.left,Ue.left),Ue},Km(x,_e,W));return Ae.width=Ae.right-Ae.left,Ae.height=Ae.bottom-Ae.top,Ae.x=Ae.left,Ae.y=Ae.top,Ae}function Dd(x){var S=x.reference,O=x.element,W=x.placement,ne=W?Ls(W):null,ue=W?mc(W):null,_e=S.x+S.width/2-O.width/2,Ae=S.y+S.height/2-O.height/2,Ue;switch(ne){case Ji:Ue={x:_e,y:S.y-O.height};break;case bs:Ue={x:_e,y:S.y+S.height};break;case Cs:Ue={x:S.x+S.width,y:Ae};break;case Xi:Ue={x:S.x-O.width,y:Ae};break;default:Ue={x:S.x,y:S.y}}var it=ne?No(ne):null;if(it!=null){var Be=it==="y"?"height":"width";switch(ue){case Ao:Ue[it]=Ue[it]-(S[Be]/2-O[Be]/2);break;case lc:Ue[it]=Ue[it]+(S[Be]/2-O[Be]/2);break}}return Ue}function _c(x,S){S===void 0&&(S={});var O=S,W=O.placement,ne=W===void 0?x.placement:W,ue=O.strategy,_e=ue===void 0?x.strategy:ue,Ae=O.boundary,Ue=Ae===void 0?Am:Ae,it=O.rootBoundary,Be=it===void 0?Gh:it,Ot=O.elementContext,Bt=Ot===void 0?Tr:Ot,Rt=O.altBoundary,On=Rt===void 0?!1:Rt,Lt=O.padding,ln=Lt===void 0?0:Lt,kn=Um(typeof ln!="number"?ln:Vm(ln,cc)),Qn=Bt===Tr?Im:Tr,si=x.rects.popper,Gt=x.elements[On?Qn:Bt],Sn=zm(ma(Gt)?Gt:Gt.contextElement||Oo(x.elements.popper),Ue,Be,_e),bn=uc(x.elements.reference),Zn=Dd({reference:bn,element:si,strategy:"absolute",placement:ne}),Pi=tp(Object.assign({},si,Zn)),ri=Bt===Tr?Pi:bn,gi={top:Sn.top-ri.top+kn.top,bottom:ri.bottom-Sn.bottom+kn.bottom,left:Sn.left-ri.left+kn.left,right:ri.right-Sn.right+kn.right},Fi=x.modifiersData.offset;if(Bt===Tr&&Fi){var tr=Fi[ne];Object.keys(gi).forEach(function(Bi){var Ca=[Cs,bs].indexOf(Bi)>=0?1:-1,Ra=[Ji,bs].indexOf(Bi)>=0?"y":"x";gi[Bi]+=tr[Ra]*Ca})}return gi}function zS(x,S){S===void 0&&(S={});var O=S,W=O.placement,ne=O.boundary,ue=O.rootBoundary,_e=O.padding,Ae=O.flipVariations,Ue=O.allowedAutoPlacements,it=Ue===void 0?Wh:Ue,Be=mc(W),Ot=Be?Ae?Hh:Hh.filter(function(On){return mc(On)===Be}):cc,Bt=Ot.filter(function(On){return it.indexOf(On)>=0});Bt.length===0&&(Bt=Ot);var Rt=Bt.reduce(function(On,Lt){return On[Lt]=_c(x,{placement:Lt,boundary:ne,rootBoundary:ue,padding:_e})[Ls(Lt)],On},{});return Object.keys(Rt).sort(function(On,Lt){return Rt[On]-Rt[Lt]})}function Pd(x){if(Ls(x)===Cd)return[];var S=Od(x);return[Nd(x),S,Nd(S)]}function YS(x){var S=x.state,O=x.options,W=x.name;if(!S.modifiersData[W]._skip){for(var ne=O.mainAxis,ue=ne===void 0?!0:ne,_e=O.altAxis,Ae=_e===void 0?!0:_e,Ue=O.fallbackPlacements,it=O.padding,Be=O.boundary,Ot=O.rootBoundary,Bt=O.altBoundary,Rt=O.flipVariations,On=Rt===void 0?!0:Rt,Lt=O.allowedAutoPlacements,ln=S.options.placement,kn=Ls(ln),Qn=kn===ln,si=Ue||(Qn||!On?[Od(ln)]:Pd(ln)),Gt=[ln].concat(si).reduce(function(yc,Mo){return yc.concat(Ls(Mo)===Cd?zS(S,{placement:Mo,boundary:Be,rootBoundary:Ot,padding:it,flipVariations:On,allowedAutoPlacements:Lt}):Mo)},[]),Sn=S.rects.reference,bn=S.rects.popper,Zn=new Map,Pi=!0,ri=Gt[0],gi=0;gi<Gt.length;gi++){var Fi=Gt[gi],tr=Ls(Fi),Bi=mc(Fi)===Ao,Ca=[Ji,bs].indexOf(tr)>=0,Ra=Ca?"width":"height",Qi=_c(S,{placement:Fi,boundary:Be,rootBoundary:Ot,altBoundary:Bt,padding:it}),nr=Ca?Bi?Cs:Xi:Bi?bs:Ji;Sn[Ra]>bn[Ra]&&(nr=Od(nr));var Tc=Od(nr),wa=[];if(ue&&wa.push(Qi[tr]<=0),Ae&&wa.push(Qi[nr]<=0,Qi[Tc]<=0),wa.every(function(yc){return yc})){ri=Fi,Pi=!1;break}Zn.set(Fi,wa)}if(Pi)for(var bl=On?3:1,Op=function(Mo){var bc=Gt.find(function(wl){var no=Zn.get(wl);if(no)return no.slice(0,Mo).every(function(Np){return Np})});if(bc)return ri=bc,"break"},Cl=bl;Cl>0;Cl--){var Rl=Op(Cl);if(Rl==="break")break}S.placement!==ri&&(S.modifiersData[W]._skip=!0,S.placement=ri,S.reset=!0)}}const Ym={name:"flip",enabled:!0,phase:"main",fn:YS,requiresIfExists:["offset"],data:{_skip:!1}};function qm(x,S,O){return O===void 0&&(O={x:0,y:0}),{top:x.top-S.height-O.y,right:x.right-S.width+O.x,bottom:x.bottom-S.height+O.y,left:x.left-S.width-O.x}}function br(x){return[Ji,Cs,bs,Xi].some(function(S){return x[S]>=0})}function qS(x){var S=x.state,O=x.name,W=S.rects.reference,ne=S.rects.popper,ue=S.modifiersData.preventOverflow,_e=_c(S,{elementContext:"reference"}),Ae=_c(S,{altBoundary:!0}),Ue=qm(_e,W),it=qm(Ae,ne,ue),Be=br(Ue),Ot=br(it);S.modifiersData[O]={referenceClippingOffsets:Ue,popperEscapeOffsets:it,isReferenceHidden:Be,hasPopperEscaped:Ot},S.attributes.popper=Object.assign({},S.attributes.popper,{"data-popper-reference-hidden":Be,"data-popper-escaped":Ot})}const $m={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:qS};function as(x,S,O){var W=Ls(x),ne=[Xi,Ji].indexOf(W)>=0?-1:1,ue=typeof O=="function"?O(Object.assign({},S,{placement:x})):O,_e=ue[0],Ae=ue[1];return _e=_e||0,Ae=(Ae||0)*ne,[Xi,Cs].indexOf(W)>=0?{x:Ae,y:_e}:{x:_e,y:Ae}}function $S(x){var S=x.state,O=x.options,W=x.name,ne=O.offset,ue=ne===void 0?[0,0]:ne,_e=Wh.reduce(function(Be,Ot){return Be[Ot]=as(Ot,S.rects,ue),Be},{}),Ae=_e[S.placement],Ue=Ae.x,it=Ae.y;S.modifiersData.popperOffsets!=null&&(S.modifiersData.popperOffsets.x+=Ue,S.modifiersData.popperOffsets.y+=it),S.modifiersData[W]=_e}const Jm={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:$S};function JS(x){var S=x.state,O=x.name;S.modifiersData[O]=Dd({reference:S.rects.reference,element:S.rects.popper,strategy:"absolute",placement:S.placement})}const np={name:"popperOffsets",enabled:!0,phase:"read",fn:JS,data:{}};function Xm(x){return x==="x"?"y":"x"}function XS(x){var S=x.state,O=x.options,W=x.name,ne=O.mainAxis,ue=ne===void 0?!0:ne,_e=O.altAxis,Ae=_e===void 0?!1:_e,Ue=O.boundary,it=O.rootBoundary,Be=O.altBoundary,Ot=O.padding,Bt=O.tether,Rt=Bt===void 0?!0:Bt,On=O.tetherOffset,Lt=On===void 0?0:On,ln=_c(S,{boundary:Ue,rootBoundary:it,padding:Ot,altBoundary:Be}),kn=Ls(S.placement),Qn=mc(S.placement),si=!Qn,Gt=No(kn),Sn=Xm(Gt),bn=S.modifiersData.popperOffsets,Zn=S.rects.reference,Pi=S.rects.popper,ri=typeof Lt=="function"?Lt(Object.assign({},S.rects,{placement:S.placement})):Lt,gi=typeof ri=="number"?{mainAxis:ri,altAxis:ri}:Object.assign({mainAxis:0,altAxis:0},ri),Fi=S.modifiersData.offset?S.modifiersData.offset[S.placement]:null,tr={x:0,y:0};if(bn){if(ue){var Bi,Ca=Gt==="y"?Ji:Xi,Ra=Gt==="y"?bs:Cs,Qi=Gt==="y"?"height":"width",nr=bn[Gt],Tc=nr+ln[Ca],wa=nr-ln[Ra],bl=Rt?-Pi[Qi]/2:0,Op=Qn===Ao?Zn[Qi]:Pi[Qi],Cl=Qn===Ao?-Pi[Qi]:-Zn[Qi],Rl=S.elements.arrow,yc=Rt&&Rl?$r(Rl):{width:0,height:0},Mo=S.modifiersData["arrow#persistent"]?S.modifiersData["arrow#persistent"].padding:yt(),bc=Mo[Ca],wl=Mo[Ra],no=fc(0,Zn[Qi],yc[Qi]),Np=si?Zn[Qi]/2-bl-no-bc-gi.mainAxis:Op-no-bc-gi.mainAxis,Gy=si?-Zn[Qi]/2+bl+no+wl+gi.mainAxis:Cl+no+wl+gi.mainAxis,Aa=S.elements.arrow&&pl(S.elements.arrow),Y_=Aa?Gt==="y"?Aa.clientTop||0:Aa.clientLeft||0:0,Cc=(Bi=Fi==null?void 0:Fi[Gt])!=null?Bi:0,Rc=nr+Np-Cc-Y_,q_=nr+Gy-Cc,cu=fc(Rt?dc(Tc,Rc):Tc,nr,Rt?_a(wa,q_):wa);bn[Gt]=cu,tr[Gt]=cu-nr}if(Ae){var Al,Hy=Gt==="x"?Ji:Xi,Wy=Gt==="x"?bs:Cs,Ia=bn[Sn],Il=Sn==="y"?"height":"width",$_=Ia+ln[Hy],J_=Ia-ln[Wy],Dp=[Ji,Xi].indexOf(kn)!==-1,lu=(Al=Fi==null?void 0:Fi[Sn])!=null?Al:0,io=Dp?$_:Ia-Zn[Il]-Pi[Il]-lu+gi.altAxis,X_=Dp?Ia+Zn[Il]+Pi[Il]-lu-gi.altAxis:J_,jo=Rt&&Dp?US(io,Ia,X_):fc(Rt?io:$_,Ia,Rt?X_:J_);bn[Sn]=jo,tr[Sn]=jo-Ia}S.modifiersData[W]=tr}}const Qm={name:"preventOverflow",enabled:!0,phase:"main",fn:XS,requiresIfExists:["offset"]};function QS(x){return{scrollLeft:x.scrollLeft,scrollTop:x.scrollTop}}function Zm(x){return x===In(x)||!Ps(x)?Qh(x):QS(x)}function ZS(x){var S=x.getBoundingClientRect(),O=Io(S.width)/x.offsetWidth||1,W=Io(S.height)/x.offsetHeight||1;return O!==1||W!==1}function eT(x,S,O){O===void 0&&(O=!1);var W=Ps(S),ne=Ps(S)&&ZS(S),ue=Oo(S),_e=uc(x,ne,O),Ae={scrollLeft:0,scrollTop:0},Ue={x:0,y:0};return(W||!W&&!O)&&((yr(S)!=="body"||ep(ue))&&(Ae=Zm(S)),Ps(S)?(Ue=uc(S,!0),Ue.x+=S.clientLeft,Ue.y+=S.clientTop):ue&&(Ue.x=Zh(ue))),{x:_e.left+Ae.scrollLeft-Ue.x,y:_e.top+Ae.scrollTop-Ue.y,width:_e.width,height:_e.height}}function ip(x){var S=new Map,O=new Set,W=[];x.forEach(function(ue){S.set(ue.name,ue)});function ne(ue){O.add(ue.name);var _e=[].concat(ue.requires||[],ue.requiresIfExists||[]);_e.forEach(function(Ae){if(!O.has(Ae)){var Ue=S.get(Ae);Ue&&ne(Ue)}}),W.push(ue)}return x.forEach(function(ue){O.has(ue.name)||ne(ue)}),W}function sp(x){var S=ip(x);return xm.reduce(function(O,W){return O.concat(S.filter(function(ne){return ne.phase===W}))},[])}function tT(x){var S;return function(){return S||(S=new Promise(function(O){Promise.resolve().then(function(){S=void 0,O(x())})})),S}}function ve(x){var S=x.reduce(function(O,W){var ne=O[W.name];return O[W.name]=ne?Object.assign({},ne,W,{options:Object.assign({},ne.options,W.options),data:Object.assign({},ne.data,W.data)}):W,O},{});return Object.keys(S).map(function(O){return S[O]})}var e_={placement:"bottom",modifiers:[],strategy:"absolute"};function t_(){for(var x=arguments.length,S=new Array(x),O=0;O<x;O++)S[O]=arguments[O];return!S.some(function(W){return!(W&&typeof W.getBoundingClientRect=="function")})}function Ld(x){x===void 0&&(x={});var S=x,O=S.defaultModifiers,W=O===void 0?[]:O,ne=S.defaultOptions,ue=ne===void 0?e_:ne;return function(Ae,Ue,it){it===void 0&&(it=ue);var Be={placement:"bottom",orderedModifiers:[],options:Object.assign({},e_,ue),modifiersData:{},elements:{reference:Ae,popper:Ue},attributes:{},styles:{}},Ot=[],Bt=!1,Rt={state:Be,setOptions:function(kn){var Qn=typeof kn=="function"?kn(Be.options):kn;Lt(),Be.options=Object.assign({},ue,Be.options,Qn),Be.scrollParents={reference:ma(Ae)?fl(Ae):Ae.contextElement?fl(Ae.contextElement):[],popper:fl(Ue)};var si=sp(ve([].concat(W,Be.options.modifiers)));return Be.orderedModifiers=si.filter(function(Gt){return Gt.enabled}),On(),Rt.update()},forceUpdate:function(){if(!Bt){var kn=Be.elements,Qn=kn.reference,si=kn.popper;if(t_(Qn,si)){Be.rects={reference:eT(Qn,pl(si),Be.options.strategy==="fixed"),popper:$r(si)},Be.reset=!1,Be.placement=Be.options.placement,Be.orderedModifiers.forEach(function(gi){return Be.modifiersData[gi.name]=Object.assign({},gi.data)});for(var Gt=0;Gt<Be.orderedModifiers.length;Gt++){if(Be.reset===!0){Be.reset=!1,Gt=-1;continue}var Sn=Be.orderedModifiers[Gt],bn=Sn.fn,Zn=Sn.options,Pi=Zn===void 0?{}:Zn,ri=Sn.name;typeof bn=="function"&&(Be=bn({state:Be,options:Pi,name:ri,instance:Rt})||Be)}}}},update:tT(function(){return new Promise(function(ln){Rt.forceUpdate(),ln(Be)})}),destroy:function(){Lt(),Bt=!0}};if(!t_(Ae,Ue))return Rt;Rt.setOptions(it).then(function(ln){!Bt&&it.onFirstUpdate&&it.onFirstUpdate(ln)});function On(){Be.orderedModifiers.forEach(function(ln){var kn=ln.name,Qn=ln.options,si=Qn===void 0?{}:Qn,Gt=ln.effect;if(typeof Gt=="function"){var Sn=Gt({state:Be,name:kn,instance:Rt,options:si}),bn=function(){};Ot.push(Sn||bn)}})}function Lt(){Ot.forEach(function(ln){return ln()}),Ot=[]}return Rt}}var nT=Ld(),n_=[Xh,np,Ad,qh],i_=Ld({defaultModifiers:n_}),s_=[Xh,np,Ad,qh,Jm,Ym,Qm,Fm,$m],rp=Ld({defaultModifiers:s_});const r_=Object.freeze(Object.defineProperty({__proto__:null,afterMain:qr,afterRead:Nm,afterWrite:Lm,applyStyles:qh,arrow:Fm,auto:Cd,basePlacements:cc,beforeMain:Dm,beforeRead:Om,beforeWrite:Rs,bottom:bs,clippingParents:Am,computeStyles:Ad,createPopper:rp,createPopperBase:nT,createPopperLite:i_,detectOverflow:_c,end:lc,eventListeners:Xh,flip:Ym,hide:$m,left:Xi,main:Pm,modifierPhases:xm,offset:Jm,placements:Wh,popper:Tr,popperGenerator:Ld,popperOffsets:np,preventOverflow:Qm,read:Kh,reference:Im,right:Cs,start:Ao,top:Ji,variationPlacements:Hh,viewport:Gh,write:zh},Symbol.toStringTag,{value:"Module"})),ml="dropdown",Ea=".bs.dropdown",op=".data-api",kd="Escape",Md="Tab",jd="ArrowUp",o_="ArrowDown",iT=2,sT=`hide${Ea}`,rT=`hidden${Ea}`,ap=`show${Ea}`,oT=`shown${Ea}`,cp=`click${Ea}${op}`,ks=`keydown${Ea}${op}`,aT=`keyup${Ea}${op}`,Cr="show",cT="dropup",lT="dropend",dT="dropstart",a_="dropup-center",uT="dropdown-center",ga='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',hT=`${ga}.${Cr}`,Ec=".dropdown-menu",pT=".navbar",c_=".navbar-nav",l_=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",fT=je()?"top-end":"top-start",d_=je()?"top-start":"top-end",Ud=je()?"bottom-end":"bottom-start",mT=je()?"bottom-start":"bottom-end",_T=je()?"left-start":"right-start",ET=je()?"right-start":"left-start",gT="top",vT="bottom",u_={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},lp={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Zs extends Di{constructor(S,O){super(S,O),this._popper=null,this._parent=this._element.parentNode,this._menu=qe.next(this._element,Ec)[0]||qe.prev(this._element,Ec)[0]||qe.findOne(Ec,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return u_}static get DefaultType(){return lp}static get NAME(){return ml}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Y(this._element)||this._isShown())return;const S={relatedTarget:this._element};if(!ke.trigger(this._element,ap,S).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(c_))for(const W of[].concat(...document.body.children))ke.on(W,"mouseover",te);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Cr),this._element.classList.add(Cr),ke.trigger(this._element,oT,S)}}hide(){if(Y(this._element)||!this._isShown())return;const S={relatedTarget:this._element};this._completeHide(S)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(S){if(!ke.trigger(this._element,sT,S).defaultPrevented){if("ontouchstart"in document.documentElement)for(const W of[].concat(...document.body.children))ke.off(W,"mouseover",te);this._popper&&this._popper.destroy(),this._menu.classList.remove(Cr),this._element.classList.remove(Cr),this._element.setAttribute("aria-expanded","false"),nt.removeDataAttribute(this._menu,"popper"),ke.trigger(this._element,rT,S)}}_getConfig(S){if(S=super._getConfig(S),typeof S.reference=="object"&&!G(S.reference)&&typeof S.reference.getBoundingClientRect!="function")throw new TypeError(`${ml.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return S}_createPopper(){if(typeof r_>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let S=this._element;this._config.reference==="parent"?S=this._parent:G(this._config.reference)?S=q(this._config.reference):typeof this._config.reference=="object"&&(S=this._config.reference);const O=this._getPopperConfig();this._popper=rp(S,this._menu,O)}_isShown(){return this._menu.classList.contains(Cr)}_getPlacement(){const S=this._parent;if(S.classList.contains(lT))return _T;if(S.classList.contains(dT))return ET;if(S.classList.contains(a_))return gT;if(S.classList.contains(uT))return vT;const O=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return S.classList.contains(cT)?O?d_:fT:O?mT:Ud}_detectNavbar(){return this._element.closest(pT)!==null}_getOffset(){const{offset:S}=this._config;return typeof S=="string"?S.split(",").map(O=>Number.parseInt(O,10)):typeof S=="function"?O=>S(O,this._element):S}_getPopperConfig(){const S={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(nt.setDataAttribute(this._menu,"popper","static"),S.modifiers=[{name:"applyStyles",enabled:!1}]),{...S,...fe(this._config.popperConfig,[S])}}_selectMenuItem({key:S,target:O}){const W=qe.find(l_,this._menu).filter(ne=>K(ne));W.length&&Le(W,O,S===o_,!W.includes(O)).focus()}static jQueryInterface(S){return this.each(function(){const O=Zs.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof O[S]>"u")throw new TypeError(`No method named "${S}"`);O[S]()}})}static clearMenus(S){if(S.button===iT||S.type==="keyup"&&S.key!==Md)return;const O=qe.find(hT);for(const W of O){const ne=Zs.getInstance(W);if(!ne||ne._config.autoClose===!1)continue;const ue=S.composedPath(),_e=ue.includes(ne._menu);if(ue.includes(ne._element)||ne._config.autoClose==="inside"&&!_e||ne._config.autoClose==="outside"&&_e||ne._menu.contains(S.target)&&(S.type==="keyup"&&S.key===Md||/input|select|option|textarea|form/i.test(S.target.tagName)))continue;const Ae={relatedTarget:ne._element};S.type==="click"&&(Ae.clickEvent=S),ne._completeHide(Ae)}}static dataApiKeydownHandler(S){const O=/input|textarea/i.test(S.target.tagName),W=S.key===kd,ne=[jd,o_].includes(S.key);if(!ne&&!W||O&&!W)return;S.preventDefault();const ue=this.matches(ga)?this:qe.prev(this,ga)[0]||qe.next(this,ga)[0]||qe.findOne(ga,S.delegateTarget.parentNode),_e=Zs.getOrCreateInstance(ue);if(ne){S.stopPropagation(),_e.show(),_e._selectMenuItem(S);return}_e._isShown()&&(S.stopPropagation(),_e.hide(),ue.focus())}}ke.on(document,ks,ga,Zs.dataApiKeydownHandler),ke.on(document,ks,Ec,Zs.dataApiKeydownHandler),ke.on(document,cp,Zs.clearMenus),ke.on(document,aT,Zs.clearMenus),ke.on(document,cp,ga,function(x){x.preventDefault(),Zs.getOrCreateInstance(this).toggle()}),Ye(Zs);const Vd="backdrop",ST="fade",h_="show",p_=`mousedown.bs.${Vd}`,TT={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},yT={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class f_ extends Zt{constructor(S){super(),this._config=this._getConfig(S),this._isAppended=!1,this._element=null}static get Default(){return TT}static get DefaultType(){return yT}static get NAME(){return Vd}show(S){if(!this._config.isVisible){fe(S);return}this._append();const O=this._getElement();this._config.isAnimated&&Z(O),O.classList.add(h_),this._emulateAnimation(()=>{fe(S)})}hide(S){if(!this._config.isVisible){fe(S);return}this._getElement().classList.remove(h_),this._emulateAnimation(()=>{this.dispose(),fe(S)})}dispose(){this._isAppended&&(ke.off(this._element,p_),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const S=document.createElement("div");S.className=this._config.className,this._config.isAnimated&&S.classList.add(ST),this._element=S}return this._element}_configAfterMerge(S){return S.rootElement=q(S.rootElement),S}_append(){if(this._isAppended)return;const S=this._getElement();this._config.rootElement.append(S),ke.on(S,p_,()=>{fe(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(S){we(S,this._getElement(),this._config.isAnimated)}}const bT="focustrap",Fd=".bs.focustrap",CT=`focusin${Fd}`,RT=`keydown.tab${Fd}`,Bd="Tab",Gd="forward",Hd="backward",wT={autofocus:!0,trapElement:null},AT={autofocus:"boolean",trapElement:"element"};class m_ extends Zt{constructor(S){super(),this._config=this._getConfig(S),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return wT}static get DefaultType(){return AT}static get NAME(){return bT}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),ke.off(document,Fd),ke.on(document,CT,S=>this._handleFocusin(S)),ke.on(document,RT,S=>this._handleKeydown(S)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ke.off(document,Fd))}_handleFocusin(S){const{trapElement:O}=this._config;if(S.target===document||S.target===O||O.contains(S.target))return;const W=qe.focusableChildren(O);W.length===0?O.focus():this._lastTabNavDirection===Hd?W[W.length-1].focus():W[0].focus()}_handleKeydown(S){S.key===Bd&&(this._lastTabNavDirection=S.shiftKey?Hd:Gd)}}const dp=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",up=".sticky-top",gc="padding-right",__="margin-right";class hp{constructor(){this._element=document.body}getWidth(){const S=document.documentElement.clientWidth;return Math.abs(window.innerWidth-S)}hide(){const S=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,gc,O=>O+S),this._setElementAttributes(dp,gc,O=>O+S),this._setElementAttributes(up,__,O=>O-S)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,gc),this._resetElementAttributes(dp,gc),this._resetElementAttributes(up,__)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(S,O,W){const ne=this.getWidth(),ue=_e=>{if(_e!==this._element&&window.innerWidth>_e.clientWidth+ne)return;this._saveInitialAttribute(_e,O);const Ae=window.getComputedStyle(_e).getPropertyValue(O);_e.style.setProperty(O,`${W(Number.parseFloat(Ae))}px`)};this._applyManipulationCallback(S,ue)}_saveInitialAttribute(S,O){const W=S.style.getPropertyValue(O);W&&nt.setDataAttribute(S,O,W)}_resetElementAttributes(S,O){const W=ne=>{const ue=nt.getDataAttribute(ne,O);if(ue===null){ne.style.removeProperty(O);return}nt.removeDataAttribute(ne,O),ne.style.setProperty(O,ue)};this._applyManipulationCallback(S,W)}_applyManipulationCallback(S,O){if(G(S)){O(S);return}for(const W of qe.find(S,this._element))O(W)}}const _l="modal",Ms=".bs.modal",IT=".data-api",OT="Escape",NT=`hide${Ms}`,DT=`hidePrevented${Ms}`,pp=`hidden${Ms}`,E_=`show${Ms}`,PT=`shown${Ms}`,LT=`resize${Ms}`,fp=`click.dismiss${Ms}`,xT=`mousedown.dismiss${Ms}`,kT=`keydown.dismiss${Ms}`,Wd=`click${Ms}${IT}`,g_="modal-open",MT="fade",v_="show",mp="modal-static",jT=".modal.show",UT=".modal-dialog",Kd=".modal-body",S_='[data-bs-toggle="modal"]',VT={backdrop:!0,focus:!0,keyboard:!0},FT={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Po extends Di{constructor(S,O){super(S,O),this._dialog=qe.findOne(UT,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new hp,this._addEventListeners()}static get Default(){return VT}static get DefaultType(){return FT}static get NAME(){return _l}toggle(S){return this._isShown?this.hide():this.show(S)}show(S){this._isShown||this._isTransitioning||ke.trigger(this._element,E_,{relatedTarget:S}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(g_),this._adjustDialog(),this._backdrop.show(()=>this._showElement(S)))}hide(){!this._isShown||this._isTransitioning||ke.trigger(this._element,NT).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(v_),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){ke.off(window,Ms),ke.off(this._dialog,Ms),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new f_({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new m_({trapElement:this._element})}_showElement(S){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const O=qe.findOne(Kd,this._dialog);O&&(O.scrollTop=0),Z(this._element),this._element.classList.add(v_);const W=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,ke.trigger(this._element,PT,{relatedTarget:S})};this._queueCallback(W,this._dialog,this._isAnimated())}_addEventListeners(){ke.on(this._element,kT,S=>{if(S.key===OT){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),ke.on(window,LT,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),ke.on(this._element,xT,S=>{ke.one(this._element,fp,O=>{if(!(this._element!==S.target||this._element!==O.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(g_),this._resetAdjustments(),this._scrollBar.reset(),ke.trigger(this._element,pp)})}_isAnimated(){return this._element.classList.contains(MT)}_triggerBackdropTransition(){if(ke.trigger(this._element,DT).defaultPrevented)return;const O=this._element.scrollHeight>document.documentElement.clientHeight,W=this._element.style.overflowY;W==="hidden"||this._element.classList.contains(mp)||(O||(this._element.style.overflowY="hidden"),this._element.classList.add(mp),this._queueCallback(()=>{this._element.classList.remove(mp),this._queueCallback(()=>{this._element.style.overflowY=W},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const S=this._element.scrollHeight>document.documentElement.clientHeight,O=this._scrollBar.getWidth(),W=O>0;if(W&&!S){const ne=je()?"paddingLeft":"paddingRight";this._element.style[ne]=`${O}px`}if(!W&&S){const ne=je()?"paddingRight":"paddingLeft";this._element.style[ne]=`${O}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(S,O){return this.each(function(){const W=Po.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof W[S]>"u")throw new TypeError(`No method named "${S}"`);W[S](O)}})}}ke.on(document,Wd,S_,function(x){const S=qe.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&x.preventDefault(),ke.one(S,E_,ne=>{ne.defaultPrevented||ke.one(S,pp,()=>{K(this)&&this.focus()})});const O=qe.findOne(jT);O&&Po.getInstance(O).hide(),Po.getOrCreateInstance(S).toggle(this)}),zr(Po),Ye(Po);const BT="offcanvas",Xr=".bs.offcanvas",zd=".data-api",_p=`load${Xr}${zd}`,T_="Escape",Yd="show",Ep="showing",gp="hiding",qd="offcanvas-backdrop",vc=".offcanvas.show",GT=`show${Xr}`,HT=`shown${Xr}`,y_=`hide${Xr}`,b_=`hidePrevented${Xr}`,C_=`hidden${Xr}`,R_=`resize${Xr}`,WT=`click${Xr}${zd}`,KT=`keydown.dismiss${Xr}`,zT='[data-bs-toggle="offcanvas"]',YT={backdrop:!0,keyboard:!0,scroll:!1},qT={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Qr extends Di{constructor(S,O){super(S,O),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return YT}static get DefaultType(){return qT}static get NAME(){return BT}toggle(S){return this._isShown?this.hide():this.show(S)}show(S){if(this._isShown||ke.trigger(this._element,GT,{relatedTarget:S}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new hp().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Ep);const W=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(Yd),this._element.classList.remove(Ep),ke.trigger(this._element,HT,{relatedTarget:S})};this._queueCallback(W,this._element,!0)}hide(){if(!this._isShown||ke.trigger(this._element,y_).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(gp),this._backdrop.hide();const O=()=>{this._element.classList.remove(Yd,gp),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new hp().reset(),ke.trigger(this._element,C_)};this._queueCallback(O,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const S=()=>{if(this._config.backdrop==="static"){ke.trigger(this._element,b_);return}this.hide()},O=!!this._config.backdrop;return new f_({className:qd,isVisible:O,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:O?S:null})}_initializeFocusTrap(){return new m_({trapElement:this._element})}_addEventListeners(){ke.on(this._element,KT,S=>{if(S.key===T_){if(this._config.keyboard){this.hide();return}ke.trigger(this._element,b_)}})}static jQueryInterface(S){return this.each(function(){const O=Qr.getOrCreateInstance(this,S);if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S](this)}})}}ke.on(document,WT,zT,function(x){const S=qe.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&x.preventDefault(),Y(this))return;ke.one(S,C_,()=>{K(this)&&this.focus()});const O=qe.findOne(vc);O&&O!==S&&Qr.getInstance(O).hide(),Qr.getOrCreateInstance(S).toggle(this)}),ke.on(window,_p,()=>{for(const x of qe.find(vc))Qr.getOrCreateInstance(x).show()}),ke.on(window,R_,()=>{for(const x of qe.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(x).position!=="fixed"&&Qr.getOrCreateInstance(x).hide()}),zr(Qr),Ye(Qr);const Lo={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},JT=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),XT=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,QT=(x,S)=>{const O=x.nodeName.toLowerCase();return S.includes(O)?JT.has(O)?!!XT.test(x.nodeValue):!0:S.filter(W=>W instanceof RegExp).some(W=>W.test(O))};function w_(x,S,O){if(!x.length)return x;if(O&&typeof O=="function")return O(x);const ne=new window.DOMParser().parseFromString(x,"text/html"),ue=[].concat(...ne.body.querySelectorAll("*"));for(const _e of ue){const Ae=_e.nodeName.toLowerCase();if(!Object.keys(S).includes(Ae)){_e.remove();continue}const Ue=[].concat(..._e.attributes),it=[].concat(S["*"]||[],S[Ae]||[]);for(const Be of Ue)QT(Be,it)||_e.removeAttribute(Be.nodeName)}return ne.body.innerHTML}const ZT="TemplateFactory",A_={allowList:Lo,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},ey={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},ty={entry:"(string|element|function|null)",selector:"(string|element)"};class ny extends Zt{constructor(S){super(),this._config=this._getConfig(S)}static get Default(){return A_}static get DefaultType(){return ey}static get NAME(){return ZT}getContent(){return Object.values(this._config.content).map(S=>this._resolvePossibleFunction(S)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(S){return this._checkContent(S),this._config.content={...this._config.content,...S},this}toHtml(){const S=document.createElement("div");S.innerHTML=this._maybeSanitize(this._config.template);for(const[ne,ue]of Object.entries(this._config.content))this._setContent(S,ue,ne);const O=S.children[0],W=this._resolvePossibleFunction(this._config.extraClass);return W&&O.classList.add(...W.split(" ")),O}_typeCheckConfig(S){super._typeCheckConfig(S),this._checkContent(S.content)}_checkContent(S){for(const[O,W]of Object.entries(S))super._typeCheckConfig({selector:O,entry:W},ty)}_setContent(S,O,W){const ne=qe.findOne(W,S);if(ne){if(O=this._resolvePossibleFunction(O),!O){ne.remove();return}if(G(O)){this._putElementInTemplate(q(O),ne);return}if(this._config.html){ne.innerHTML=this._maybeSanitize(O);return}ne.textContent=O}}_maybeSanitize(S){return this._config.sanitize?w_(S,this._config.allowList,this._config.sanitizeFn):S}_resolvePossibleFunction(S){return fe(S,[this])}_putElementInTemplate(S,O){if(this._config.html){O.innerHTML="",O.append(S);return}O.textContent=S.textContent}}const $d="tooltip",iy=new Set(["sanitize","allowList","sanitizeFn"]),vp="fade",sy="modal",Jd="show",ry=".tooltip-inner",I_=`.${sy}`,Xd="hide.bs.modal",El="hover",Qd="focus",oy="click",O_="manual",ay="hide",cy="hidden",ly="show",dy="shown",uy="inserted",hy="click",N_="focusin",py="focusout",fy="mouseenter",D_="mouseleave",my={AUTO:"auto",TOP:"top",RIGHT:je()?"left":"right",BOTTOM:"bottom",LEFT:je()?"right":"left"},Zd={allowList:Lo,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},P_={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class er extends Di{constructor(S,O){if(typeof r_>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(S,O),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Zd}static get DefaultType(){return P_}static get NAME(){return $d}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),ke.off(this._element.closest(I_),Xd,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const S=ke.trigger(this._element,this.constructor.eventName(ly)),W=(ie(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(S.defaultPrevented||!W)return;this._disposePopper();const ne=this._getTipElement();this._element.setAttribute("aria-describedby",ne.getAttribute("id"));const{container:ue}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ue.append(ne),ke.trigger(this._element,this.constructor.eventName(uy))),this._popper=this._createPopper(ne),ne.classList.add(Jd),"ontouchstart"in document.documentElement)for(const Ae of[].concat(...document.body.children))ke.on(Ae,"mouseover",te);const _e=()=>{ke.trigger(this._element,this.constructor.eventName(dy)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(_e,this.tip,this._isAnimated())}hide(){if(!this._isShown()||ke.trigger(this._element,this.constructor.eventName(ay)).defaultPrevented)return;if(this._getTipElement().classList.remove(Jd),"ontouchstart"in document.documentElement)for(const ne of[].concat(...document.body.children))ke.off(ne,"mouseover",te);this._activeTrigger[oy]=!1,this._activeTrigger[Qd]=!1,this._activeTrigger[El]=!1,this._isHovered=null;const W=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ke.trigger(this._element,this.constructor.eventName(cy)))};this._queueCallback(W,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(S){const O=this._getTemplateFactory(S).toHtml();if(!O)return null;O.classList.remove(vp,Jd),O.classList.add(`bs-${this.constructor.NAME}-auto`);const W=j(this.constructor.NAME).toString();return O.setAttribute("id",W),this._isAnimated()&&O.classList.add(vp),O}setContent(S){this._newContent=S,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(S){return this._templateFactory?this._templateFactory.changeContent(S):this._templateFactory=new ny({...this._config,content:S,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[ry]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(S){return this.constructor.getOrCreateInstance(S.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(vp)}_isShown(){return this.tip&&this.tip.classList.contains(Jd)}_createPopper(S){const O=fe(this._config.placement,[this,S,this._element]),W=my[O.toUpperCase()];return rp(this._element,S,this._getPopperConfig(W))}_getOffset(){const{offset:S}=this._config;return typeof S=="string"?S.split(",").map(O=>Number.parseInt(O,10)):typeof S=="function"?O=>S(O,this._element):S}_resolvePossibleFunction(S){return fe(S,[this._element])}_getPopperConfig(S){const O={placement:S,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:W=>{this._getTipElement().setAttribute("data-popper-placement",W.state.placement)}}]};return{...O,...fe(this._config.popperConfig,[O])}}_setListeners(){const S=this._config.trigger.split(" ");for(const O of S)if(O==="click")ke.on(this._element,this.constructor.eventName(hy),this._config.selector,W=>{this._initializeOnDelegatedTarget(W).toggle()});else if(O!==O_){const W=O===El?this.constructor.eventName(fy):this.constructor.eventName(N_),ne=O===El?this.constructor.eventName(D_):this.constructor.eventName(py);ke.on(this._element,W,this._config.selector,ue=>{const _e=this._initializeOnDelegatedTarget(ue);_e._activeTrigger[ue.type==="focusin"?Qd:El]=!0,_e._enter()}),ke.on(this._element,ne,this._config.selector,ue=>{const _e=this._initializeOnDelegatedTarget(ue);_e._activeTrigger[ue.type==="focusout"?Qd:El]=_e._element.contains(ue.relatedTarget),_e._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},ke.on(this._element.closest(I_),Xd,this._hideModalHandler)}_fixTitle(){const S=this._element.getAttribute("title");S&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",S),this._element.setAttribute("data-bs-original-title",S),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(S,O){clearTimeout(this._timeout),this._timeout=setTimeout(S,O)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(S){const O=nt.getDataAttributes(this._element);for(const W of Object.keys(O))iy.has(W)&&delete O[W];return S={...O,...typeof S=="object"&&S?S:{}},S=this._mergeConfigObj(S),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}_configAfterMerge(S){return S.container=S.container===!1?document.body:q(S.container),typeof S.delay=="number"&&(S.delay={show:S.delay,hide:S.delay}),typeof S.title=="number"&&(S.title=S.title.toString()),typeof S.content=="number"&&(S.content=S.content.toString()),S}_getDelegateConfig(){const S={};for(const[O,W]of Object.entries(this._config))this.constructor.Default[O]!==W&&(S[O]=W);return S.selector=!1,S.trigger="manual",S}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(S){return this.each(function(){const O=er.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof O[S]>"u")throw new TypeError(`No method named "${S}"`);O[S]()}})}}Ye(er);const _y="popover",Ey=".popover-header",gy=".popover-body",vy={...er.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},eu={...er.DefaultType,content:"(null|string|element|function)"};class tu extends er{static get Default(){return vy}static get DefaultType(){return eu}static get NAME(){return _y}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Ey]:this._getTitle(),[gy]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(S){return this.each(function(){const O=tu.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof O[S]>"u")throw new TypeError(`No method named "${S}"`);O[S]()}})}}Ye(tu);const L_="scrollspy",gl=".bs.scrollspy",Sy=".data-api",Ty=`activate${gl}`,k_=`click${gl}`,yy=`load${gl}${Sy}`,by="dropdown-item",Zr="active",Cy='[data-bs-spy="scroll"]',xo="[href]",Sp=".nav, .list-group",vl=".nav-link",Ry=`${vl}, .nav-item > ${vl}, .list-group-item`,M_=".dropdown",wy=".dropdown-toggle",j_={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Ay={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Sl extends Di{constructor(S,O){super(S,O),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return j_}static get DefaultType(){return Ay}static get NAME(){return L_}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const S of this._observableSections.values())this._observer.observe(S)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(S){return S.target=q(S.target)||document.body,S.rootMargin=S.offset?`${S.offset}px 0px -30%`:S.rootMargin,typeof S.threshold=="string"&&(S.threshold=S.threshold.split(",").map(O=>Number.parseFloat(O))),S}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(ke.off(this._config.target,k_),ke.on(this._config.target,k_,xo,S=>{const O=this._observableSections.get(S.target.hash);if(O){S.preventDefault();const W=this._rootElement||window,ne=O.offsetTop-this._element.offsetTop;if(W.scrollTo){W.scrollTo({top:ne,behavior:"smooth"});return}W.scrollTop=ne}}))}_getNewObserver(){const S={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(O=>this._observerCallback(O),S)}_observerCallback(S){const O=_e=>this._targetLinks.get(`#${_e.target.id}`),W=_e=>{this._previousScrollData.visibleEntryTop=_e.target.offsetTop,this._process(O(_e))},ne=(this._rootElement||document.documentElement).scrollTop,ue=ne>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ne;for(const _e of S){if(!_e.isIntersecting){this._activeTarget=null,this._clearActiveClass(O(_e));continue}const Ae=_e.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(ue&&Ae){if(W(_e),!ne)return;continue}!ue&&!Ae&&W(_e)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const S=qe.find(xo,this._config.target);for(const O of S){if(!O.hash||Y(O))continue;const W=qe.findOne(decodeURI(O.hash),this._element);K(W)&&(this._targetLinks.set(decodeURI(O.hash),O),this._observableSections.set(O.hash,W))}}_process(S){this._activeTarget!==S&&(this._clearActiveClass(this._config.target),this._activeTarget=S,S.classList.add(Zr),this._activateParents(S),ke.trigger(this._element,Ty,{relatedTarget:S}))}_activateParents(S){if(S.classList.contains(by)){qe.findOne(wy,S.closest(M_)).classList.add(Zr);return}for(const O of qe.parents(S,Sp))for(const W of qe.prev(O,Ry))W.classList.add(Zr)}_clearActiveClass(S){S.classList.remove(Zr);const O=qe.find(`${xo}.${Zr}`,S);for(const W of O)W.classList.remove(Zr)}static jQueryInterface(S){return this.each(function(){const O=Sl.getOrCreateInstance(this,S);if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S]()}})}}ke.on(window,yy,()=>{for(const x of qe.find(Cy))Sl.getOrCreateInstance(x)}),Ye(Sl);const yp="tab",va=".bs.tab",Iy=`hide${va}`,V_=`hidden${va}`,bp=`show${va}`,Oy=`shown${va}`,Rr=`click${va}`,Sc=`keydown${va}`,Sa=`load${va}`,F_="ArrowLeft",Cp="ArrowRight",Ta="ArrowUp",iu="ArrowDown",Rp="Home",wp="End",ya="active",su="fade",ru="show",Ny="dropdown",eo=".dropdown-toggle",Dy=".dropdown-menu",Ap=`:not(${eo})`,Py='.list-group, .nav, [role="tablist"]',Ly=".nav-item, .list-group-item",B_=`.nav-link${Ap}, .list-group-item${Ap}, [role="tab"]${Ap}`,G_='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Tl=`${B_}, ${G_}`,H_=`.${ya}[data-bs-toggle="tab"], .${ya}[data-bs-toggle="pill"], .${ya}[data-bs-toggle="list"]`;class ba extends Di{constructor(S){super(S),this._parent=this._element.closest(Py),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),ke.on(this._element,Sc,O=>this._keydown(O)))}static get NAME(){return yp}show(){const S=this._element;if(this._elemIsActive(S))return;const O=this._getActiveElem(),W=O?ke.trigger(O,Iy,{relatedTarget:S}):null;ke.trigger(S,bp,{relatedTarget:O}).defaultPrevented||W&&W.defaultPrevented||(this._deactivate(O,S),this._activate(S,O))}_activate(S,O){if(!S)return;S.classList.add(ya),this._activate(qe.getElementFromSelector(S));const W=()=>{if(S.getAttribute("role")!=="tab"){S.classList.add(ru);return}S.removeAttribute("tabindex"),S.setAttribute("aria-selected",!0),this._toggleDropDown(S,!0),ke.trigger(S,Oy,{relatedTarget:O})};this._queueCallback(W,S,S.classList.contains(su))}_deactivate(S,O){if(!S)return;S.classList.remove(ya),S.blur(),this._deactivate(qe.getElementFromSelector(S));const W=()=>{if(S.getAttribute("role")!=="tab"){S.classList.remove(ru);return}S.setAttribute("aria-selected",!1),S.setAttribute("tabindex","-1"),this._toggleDropDown(S,!1),ke.trigger(S,V_,{relatedTarget:O})};this._queueCallback(W,S,S.classList.contains(su))}_keydown(S){if(![F_,Cp,Ta,iu,Rp,wp].includes(S.key))return;S.stopPropagation(),S.preventDefault();const O=this._getChildren().filter(ne=>!Y(ne));let W;if([Rp,wp].includes(S.key))W=O[S.key===Rp?0:O.length-1];else{const ne=[Cp,iu].includes(S.key);W=Le(O,S.target,ne,!0)}W&&(W.focus({preventScroll:!0}),ba.getOrCreateInstance(W).show())}_getChildren(){return qe.find(Tl,this._parent)}_getActiveElem(){return this._getChildren().find(S=>this._elemIsActive(S))||null}_setInitialAttributes(S,O){this._setAttributeIfNotExists(S,"role","tablist");for(const W of O)this._setInitialAttributesOnChild(W)}_setInitialAttributesOnChild(S){S=this._getInnerElement(S);const O=this._elemIsActive(S),W=this._getOuterElement(S);S.setAttribute("aria-selected",O),W!==S&&this._setAttributeIfNotExists(W,"role","presentation"),O||S.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(S,"role","tab"),this._setInitialAttributesOnTargetPanel(S)}_setInitialAttributesOnTargetPanel(S){const O=qe.getElementFromSelector(S);O&&(this._setAttributeIfNotExists(O,"role","tabpanel"),S.id&&this._setAttributeIfNotExists(O,"aria-labelledby",`${S.id}`))}_toggleDropDown(S,O){const W=this._getOuterElement(S);if(!W.classList.contains(Ny))return;const ne=(ue,_e)=>{const Ae=qe.findOne(ue,W);Ae&&Ae.classList.toggle(_e,O)};ne(eo,ya),ne(Dy,ru),W.setAttribute("aria-expanded",O)}_setAttributeIfNotExists(S,O,W){S.hasAttribute(O)||S.setAttribute(O,W)}_elemIsActive(S){return S.classList.contains(ya)}_getInnerElement(S){return S.matches(Tl)?S:qe.findOne(Tl,S)}_getOuterElement(S){return S.closest(Ly)||S}static jQueryInterface(S){return this.each(function(){const O=ba.getOrCreateInstance(this);if(typeof S=="string"){if(O[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);O[S]()}})}}ke.on(document,Rr,G_,function(x){["A","AREA"].includes(this.tagName)&&x.preventDefault(),!Y(this)&&ba.getOrCreateInstance(this).show()}),ke.on(window,Sa,()=>{for(const x of qe.find(H_))ba.getOrCreateInstance(x)}),Ye(ba);const W_="toast",ko=".bs.toast",xy=`mouseover${ko}`,ky=`mouseout${ko}`,My=`focusin${ko}`,jy=`focusout${ko}`,Uy=`hide${ko}`,K_=`hidden${ko}`,to=`show${ko}`,Vy=`shown${ko}`,Fy="fade",z_="hide",ou="show",au="showing",By={animation:"boolean",autohide:"boolean",delay:"number"},Ip={animation:!0,autohide:!0,delay:5e3};class yl extends Di{constructor(S,O){super(S,O),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Ip}static get DefaultType(){return By}static get NAME(){return W_}show(){if(ke.trigger(this._element,to).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(Fy);const O=()=>{this._element.classList.remove(au),ke.trigger(this._element,Vy),this._maybeScheduleHide()};this._element.classList.remove(z_),Z(this._element),this._element.classList.add(ou,au),this._queueCallback(O,this._element,this._config.animation)}hide(){if(!this.isShown()||ke.trigger(this._element,Uy).defaultPrevented)return;const O=()=>{this._element.classList.add(z_),this._element.classList.remove(au,ou),ke.trigger(this._element,K_)};this._element.classList.add(au),this._queueCallback(O,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(ou),super.dispose()}isShown(){return this._element.classList.contains(ou)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(S,O){switch(S.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=O;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=O;break}}if(O){this._clearTimeout();return}const W=S.relatedTarget;this._element===W||this._element.contains(W)||this._maybeScheduleHide()}_setListeners(){ke.on(this._element,xy,S=>this._onInteraction(S,!0)),ke.on(this._element,ky,S=>this._onInteraction(S,!1)),ke.on(this._element,My,S=>this._onInteraction(S,!0)),ke.on(this._element,jy,S=>this._onInteraction(S,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(S){return this.each(function(){const O=yl.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof O[S]>"u")throw new TypeError(`No method named "${S}"`);O[S](this)}})}}return zr(yl),Ye(yl),{Alert:ys,Button:Za,Carousel:sc,Collapse:ac,Dropdown:Zs,Modal:Po,Offcanvas:Qr,Popover:tu,ScrollSpy:Sl,Tab:ba,Toast:yl,Tooltip:er}})})(s2);var vF={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},hV=Hn.createContext&&Hn.createContext(vF),r2=["attr","size","title"];function o2(a,r){if(a==null)return{};var l=a2(a,r),u,_;if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(a);for(_=0;_<E.length;_++)u=E[_],!(r.indexOf(u)>=0)&&Object.prototype.propertyIsEnumerable.call(a,u)&&(l[u]=a[u])}return l}function a2(a,r){if(a==null)return{};var l={};for(var u in a)if(Object.prototype.hasOwnProperty.call(a,u)){if(r.indexOf(u)>=0)continue;l[u]=a[u]}return l}function Mv(){return Mv=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])}return a},Mv.apply(this,arguments)}function pV(a,r){var l=Object.keys(a);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(a);r&&(u=u.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),l.push.apply(l,u)}return l}function jv(a){for(var r=1;r<arguments.length;r++){var l=arguments[r]!=null?arguments[r]:{};r%2?pV(Object(l),!0).forEach(function(u){c2(a,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):pV(Object(l)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(l,u))})}return a}function c2(a,r,l){return r=l2(r),r in a?Object.defineProperty(a,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[r]=l,a}function l2(a){var r=d2(a,"string");return typeof r=="symbol"?r:r+""}function d2(a,r){if(typeof a!="object"||!a)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,r||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}function SF(a){return a&&a.map((r,l)=>Hn.createElement(r.tag,jv({key:l},r.attr),SF(r.child)))}function Ct(a){return r=>Hn.createElement(u2,Mv({attr:jv({},a.attr)},r),SF(a.child))}function u2(a){var r=l=>{var{attr:u,size:_,title:E}=a,T=o2(a,r2),R=_||l.size||"1em",w;return l.className&&(w=l.className),a.className&&(w=(w?w+" ":"")+a.className),Hn.createElement("svg",Mv({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},l.attr,u,T,{className:w,style:jv(jv({color:a.color||l.color},l.style),a.style),height:R,width:R,xmlns:"http://www.w3.org/2000/svg"}),E&&Hn.createElement("title",null,E),a.children)};return hV!==void 0?Hn.createElement(hV.Consumer,null,l=>r(l)):r(vF)}function TF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"},child:[]}]})(a)}function h2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M64 0C46.3 0 32 14.3 32 32V96c0 17.7 14.3 32 32 32h80v32H87c-31.6 0-58.5 23.1-63.3 54.4L1.1 364.1C.4 368.8 0 373.6 0 378.4V448c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V378.4c0-4.8-.4-9.6-1.1-14.4L488.2 214.4C483.5 183.1 456.6 160 425 160H208V128h80c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H64zM96 48H256c8.8 0 16 7.2 16 16s-7.2 16-16 16H96c-8.8 0-16-7.2-16-16s7.2-16 16-16zM64 432c0-8.8 7.2-16 16-16H432c8.8 0 16 7.2 16 16s-7.2 16-16 16H80c-8.8 0-16-7.2-16-16zm48-168a24 24 0 1 1 0-48 24 24 0 1 1 0 48zm120-24a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM160 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM328 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM256 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM424 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM352 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48z"},child:[]}]})(a)}function fV(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M64 480H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H288c-10.1 0-19.6-4.7-25.6-12.8L243.2 57.6C231.1 41.5 212.1 32 192 32H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64z"},child:[]}]})(a)}function yF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M96 96V256c0 53 43 96 96 96s96-43 96-96H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80V192H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80V128H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80c0-53-43-96-96-96S96 43 96 96zM320 240v16c0 70.7-57.3 128-128 128s-128-57.3-128-128V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v24z"},child:[]}]})(a)}function bF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2h61.4C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"},child:[]}]})(a)}function CF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(a)}function RF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(a)}function p2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M272.1 204.2v71.1c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.1 0-2.1-.6-2.6-1.3l-32.6-44v42.2c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.8 0-3.2-1.4-3.2-3.2v-71.1c0-1.8 1.4-3.2 3.2-3.2H219c1 0 2.1.5 2.6 1.4l32.6 44v-42.2c0-1.8 1.4-3.2 3.2-3.2h11.4c1.8-.1 3.3 1.4 3.3 3.1zm-82-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 1.8 1.4 3.2 3.2 3.2h11.4c1.8 0 3.2-1.4 3.2-3.2v-71.1c0-1.7-1.4-3.2-3.2-3.2zm-27.5 59.6h-31.1v-56.4c0-1.8-1.4-3.2-3.2-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 .9.3 1.6.9 2.2.6.5 1.3.9 2.2.9h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.7-1.4-3.2-3.1-3.2zM332.1 201h-45.7c-1.7 0-3.2 1.4-3.2 3.2v71.1c0 1.7 1.4 3.2 3.2 3.2h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2V234c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2v-11.4c-.1-1.7-1.5-3.2-3.2-3.2zM448 113.7V399c-.1 44.8-36.8 81.1-81.7 81H81c-44.8-.1-81.1-36.9-81-81.7V113c.1-44.8 36.9-81.1 81.7-81H367c44.8.1 81.1 36.8 81 81.7zm-61.6 122.6c0-73-73.2-132.4-163.1-132.4-89.9 0-163.1 59.4-163.1 132.4 0 65.4 58 120.2 136.4 130.6 19.1 4.1 16.9 11.1 12.6 36.8-.7 4.1-3.3 16.1 14.1 8.8 17.4-7.3 93.9-55.3 128.2-94.7 23.6-26 34.9-52.3 34.9-81.5z"},child:[]}]})(a)}function f2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm169.5 338.9c-3.5 8.1-18.1 14-44.8 18.2-1.4 1.9-2.5 9.8-4.3 15.9-1.1 3.7-3.7 5.9-8.1 5.9h-.2c-6.2 0-12.8-2.9-25.8-2.9-17.6 0-23.7 4-37.4 13.7-14.5 10.3-28.4 19.1-49.2 18.2-21 1.6-38.6-11.2-48.5-18.2-13.8-9.7-19.8-13.7-37.4-13.7-12.5 0-20.4 3.1-25.8 3.1-5.4 0-7.5-3.3-8.3-6-1.8-6.1-2.9-14.1-4.3-16-13.8-2.1-44.8-7.5-45.5-21.4-.2-3.6 2.3-6.8 5.9-7.4 46.3-7.6 67.1-55.1 68-57.1 0-.1.1-.2.2-.3 2.5-5 3-9.2 1.6-12.5-3.4-7.9-17.9-10.7-24-13.2-15.8-6.2-18-13.4-17-18.3 1.6-8.5 14.4-13.8 21.9-10.3 5.9 2.8 11.2 4.2 15.7 4.2 3.3 0 5.5-.8 6.6-1.4-1.4-23.9-4.7-58 3.8-77.1C183.1 100 230.7 96 244.7 96c.6 0 6.1-.1 6.7-.1 34.7 0 68 17.8 84.3 54.3 8.5 19.1 5.2 53.1 3.8 77.1 1.1.6 2.9 1.3 5.7 1.4 4.3-.2 9.2-1.6 14.7-4.2 4-1.9 9.6-1.6 13.6 0 6.3 2.3 10.3 6.8 10.4 11.9.1 6.5-5.7 12.1-17.2 16.6-1.4.6-3.1 1.1-4.9 1.7-6.5 2.1-16.4 5.2-19 11.5-1.4 3.3-.8 7.5 1.6 12.5.1.1.1.2.2.3.9 2 21.7 49.5 68 57.1 4 1 7.1 5.5 4.9 10.8z"},child:[]}]})(a)}function m2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"},child:[]}]})(a)}function wF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(a)}function Uv(a){return Ct({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(a)}function _2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"},child:[]}]})(a)}function E2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"},child:[]}]})(a)}function Qe(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(a)}function AF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 9.8 11.2 15.5 19.1 9.7L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64z"},child:[]}]})(a)}function bA(a){return Ct({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(a)}function g2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M434.7 64h-85.9c-8 0-15.7 3-21.6 8.4l-98.3 90c-.1.1-.2.3-.3.4-16.6 15.6-16.3 40.5-2.1 56 12.7 13.9 39.4 17.6 56.1 2.7.1-.1.3-.1.4-.2l79.9-73.2c6.5-5.9 16.7-5.5 22.6 1 6 6.5 5.5 16.6-1 22.6l-26.1 23.9L504 313.8c2.9 2.4 5.5 5 7.9 7.7V128l-54.6-54.6c-5.9-6-14.1-9.4-22.6-9.4zM544 128.2v223.9c0 17.7 14.3 32 32 32h64V128.2h-96zm48 223.9c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zM0 384h64c17.7 0 32-14.3 32-32V128.2H0V384zm48-63.9c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16c0-8.9 7.2-16 16-16zm435.9 18.6L334.6 217.5l-30 27.5c-29.7 27.1-75.2 24.5-101.7-4.4-26.9-29.4-24.8-74.9 4.4-101.7L289.1 64h-83.8c-8.5 0-16.6 3.4-22.6 9.4L128 128v223.9h18.3l90.5 81.9c27.4 22.3 67.7 18.1 90-9.3l.2-.2 17.9 15.5c15.9 13 39.4 10.5 52.3-5.4l31.4-38.6 5.4 4.4c13.7 11.1 33.9 9.1 45-4.7l9.5-11.7c11.2-13.8 9.1-33.9-4.6-45.1z"},child:[]}]})(a)}function IF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(a)}function v2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z"},child:[]}]})(a)}function OF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"},child:[]}]})(a)}const eI="/assets/%D8%A7%D9%84%D8%B4%D8%B9%D8%A7%D8%B1-2-png.HSDaABN7.png";function S2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-1 6h2v2h-2V7zm0 4h2v6h-2v-6z"},child:[]}]})(a)}function NF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"},child:[]}]})(a)}function T2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0zm0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"},child:[]}]})(a)}function y2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.67-1.85.996.996 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"},child:[]}]})(a)}function DF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"},child:[]}]})(a)}function b2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 3H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h4v2h8v-2h4c1.1 0 2-.9 2-2V5a2 2 0 0 0-2-2zm0 14H4V5h16v12z"},child:[]},{tag:"path",attr:{d:"M6.5 7.5H9V6H5v4h1.5zM19 12h-1.5v2.5H15V16h4z"},child:[]}]})(a)}function C2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"},child:[]}]})(a)}function R2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"},child:[]}]})(a)}function mV(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M4 4h16v12H5.17L4 17.17V4m0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4zm2 10h8v2H6v-2zm0-3h12v2H6V9zm0-3h12v2H6V6z"},child:[]}]})(a)}function w2(a){return Ct({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2z"},child:[]}]})(a)}function A2(a){return Ct({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.961 12.365a2 2 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272zm-10.114-9A2 2 0 0 0 0 5v6a2 2 0 0 0 2 2h5.728zm9.746 11.925-10-14 .814-.58 10 14z"},child:[]}]})(a)}function ud(a){return Ct({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z"},child:[]},{tag:"path",attr:{d:"M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5zM10 8a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1"},child:[]}]})(a)}function PF(a){return Ct({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"},child:[]},{tag:"path",attr:{d:"M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"},child:[]},{tag:"path",attr:{d:"M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"},child:[]},{tag:"path",attr:{d:"M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"},child:[]}]})(a)}function LF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M14,14 L10,14 L10,10 L14,10 L14,14 Z M14,7 L10,7 L10,3 L14,3 L14,7 Z M14,21 L10,21 L10,17 L14,17 L14,21 Z"},child:[]}]})(a)}function Ui(){const[a,r]=ee.useState(null),[l,u]=ee.useState(null),[_,E]=ee.useState(null),T=localStorage.getItem("userEmail"),R=async()=>{try{const w=localStorage.getItem("token");if(!w){E("لا يوجد توكن. يرجى تسجيل الدخول.");return}const j=await fetch("https://api.japaneseacademy.jp/allusers",{headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"}});if(!j.ok)throw new"توكن غير صالح";const P=j.headers.get("content-type");if(!P||!P.includes("application/json"))throw new"الرد من الخادم ليس بصيغة JSON";const G=(await j.json()).find(q=>q.email===T);G?u(G):E("اسم المستخدم أو كلمة المرور خطأ")}catch(w){console.error("Error:",w.message),E(w.message)}};return ee.useEffect(()=>{const w=localStorage.getItem("userRole");w&&r(w)},[]),ee.useEffect(()=>{R()},[]),h.jsx(h.Fragment,{children:h.jsxs("nav",{className:"navbar navbar-expand-xl navbar-light  container",children:[h.jsx("a",{className:"navbar-brand",href:"#",children:h.jsx("img",{src:eI,alt:""})}),h.jsx("div",{className:"buttons_mobile",children:l?h.jsx("div",{className:"user-info",children:h.jsxs("div",{className:"user-info-buttons",children:[h.jsx("span",{className:"user-icon"}),h.jsx(vt,{to:`/Dash_users/${l.id}`,children:h.jsx("button",{className:"register_nav",children:"لوحة التحكم "})}),h.jsx("button",{className:"logout_nav register_nav",onClick:()=>{localStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),localStorage.removeItem("firstName"),localStorage.removeItem("showVideoCall"),localStorage.removeItem("uid"),sessionStorage.removeItem("auth"),window.location.reload()},children:"تسجيل الخروج"})]})}):h.jsxs("div",{className:"buttons",children:[h.jsx(vt,{to:"/Login_users",children:h.jsx("button",{className:"login_nav",children:"تسجيل الدخول"})}),h.jsx(vt,{to:"/Register_account",children:h.jsx("button",{className:"register_nav",children:"سجل الآن"})})]})}),h.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNavDropdown","aria-controls":"navbarNavDropdown","aria-expanded":"false","aria-label":"Toggle navigation",children:h.jsx("span",{className:"navbar-toggler-icon"})}),h.jsxs("div",{className:"collapse navbar-collapse",id:"navbarNavDropdown",children:[h.jsx("div",{className:"buttons_pc",children:l?h.jsxs("div",{className:"user-info",children:[h.jsx("span",{className:"user-icon"}),h.jsx(vt,{to:`/Dash_users/${l.id}`,children:h.jsx("button",{className:"register_nav",children:"لوحة التحكم "})}),h.jsx("button",{className:"logout_nav register_nav",onClick:()=>{localStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),localStorage.removeItem("firstName"),localStorage.removeItem("showVideoCall"),localStorage.removeItem("uid"),sessionStorage.removeItem("auth"),window.location.reload()},children:"تسجيل الخروج"})]}):h.jsxs("div",{className:"buttons",children:[h.jsx(vt,{to:"/Register_account",children:h.jsx("button",{className:"register_nav",children:"سجل الآن"})}),h.jsx(vt,{to:"/Login_users",children:h.jsx("button",{className:"login_nav",children:"تسجيل الدخول"})})]})}),h.jsx("ul",{className:"navbar-nav",children:h.jsxs("div",{className:"group",children:[h.jsxs("div",{className:"group_1",children:[h.jsx("li",{className:"nav-item active item1 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/",children:[h.jsx(IF,{}),"الصفحة الرئيسية",h.jsx("span",{className:"sr-only"})]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/Teachers",children:[h.jsx(bF,{}),"الهيئة التدريسية"]})}),h.jsx("li",{className:"nav-item item2 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/Level_division",children:[h.jsx(NF,{}),"المستويات الدراسية"]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/Study_materials",children:[h.jsx(TF,{}),"المواد الدراسية"]})})]}),h.jsxs("div",{className:"group_2",children:[h.jsx("li",{className:"nav-item item3 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/Fees",children:[h.jsx(PF,{}),"الرسوم الدراسية"]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/Questions",children:[h.jsx(OF,{}),"الأسئلة الشائعة"]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/Comments",children:[h.jsx(AF,{}),"آراء الطلاب"]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/More_services",children:[h.jsx(LF,{}),"خدمات إضافية"]})}),h.jsx("li",{className:"nav-item item4 hidden",children:h.jsxs(vt,{className:"nav-a dropdown-item",to:"/Support",children:[h.jsx(yF,{}),"الدعم الفني"]})})]}),h.jsx("div",{className:"group_3",children:a==="teacher"&&h.jsx("li",{className:"nav-item item4",children:h.jsx(vt,{className:"nav-a dropdown-item",to:"/Dash_Teachers",children:"لوحة تحكم الأساتذة"})})})]})})]})]})})}function I2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.6727 1.61162 20.7999 9H17.8267L12 3.70302 6 9.15757V19.0001H11V21.0001H5C4.44772 21.0001 4 20.5524 4 20.0001V11.0001L1 11.0001 11.3273 1.61162C11.7087 1.26488 12.2913 1.26488 12.6727 1.61162ZM14 11H23V18H14V11ZM16 13V16H21V13H16ZM24 21H13V19H24V21Z"},child:[]}]})(a)}function O2(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M11 17H4C2.34315 17 1 15.6569 1 14V6C1 4.34315 2.34315 3 4 3H20C21.6569 3 23 4.34315 23 6V14C23 15.6569 21.6569 17 20 17H13V19H16C16.5523 19 17 19.4477 17 20C17 20.5523 16.5523 21 16 21H8C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19H11V17ZM4 5H20C20.5523 5 21 5.44772 21 6V14C21 14.5523 20.5523 15 20 15H4C3.44772 15 3 14.5523 3 14V6C3 5.44772 3.44772 5 4 5Z",fill:"currentColor"},child:[]}]})(a)}function N2(){const[a,r]=ee.useState(!1),l=()=>{if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad|android)/)){const _=document.querySelector("meta[name=viewport]");_&&(a?_.setAttribute("content","width=device-width, initial-scale=1"):_.setAttribute("content","width=1250"))}r(!a)};return h.jsx(h.Fragment,{children:h.jsx("div",{children:h.jsxs("button",{className:"DesktopView m-1",onClick:l,children:[h.jsxs("h5",{children:["PC ",h.jsx("br",{}),"VIEW"]})," ",h.jsx(O2,{})]})})})}function Vi(){return h.jsx(h.Fragment,{children:h.jsx("footer",{className:"footer",children:h.jsxs("div",{className:"text-white text-center text-lg-left",children:[h.jsx("div",{className:"container p-3 position-relative",children:h.jsx("div",{className:"rowFooter",children:h.jsxs("div",{className:"Footer_all_list",children:[h.jsxs("div",{className:"list_footer",children:[h.jsxs("div",{className:"Footer_ul",children:[h.jsxs("ul",{className:"list-unstyled",children:[h.jsx("a",{href:"tel:+81050-6866-1791",children:h.jsxs("li",{children:[h.jsx(I2,{})," رقم الهاتف: 1791-6866-050"]})}),h.jsx("a",{href:"tel:+81090-1840-9625",children:h.jsxs("li",{children:[h.jsx(v2,{}),"رقم المحمول: 819018409625+"]})}),h.jsx("a",{href:"https://wa.link/3zzbvj",children:h.jsxs("li",{children:[h.jsx(Uv,{})," واتساب: 819018409625+"]})}),h.jsx("a",{href:"https://line.me/ti/p/IuAqVt59QV",children:h.jsxs("li",{children:[h.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-line",viewBox:"0 0 16 16",children:h.jsx("path",{d:"M8 0c4.411 0 8 2.912 8 6.492 0 1.433-.555 2.723-1.715 3.994-1.678 1.932-5.431 4.285-6.285 4.645-.83.35-.734-.197-.696-.413l.003-.018.114-.685c.027-.204.055-.521-.026-.723-.09-.223-.444-.339-.704-.395C2.846 12.39 0 9.701 0 6.492 0 2.912 3.59 0 8 0M5.022 7.686H3.497V4.918a.156.156 0 0 0-.155-.156H2.78a.156.156 0 0 0-.156.156v3.486c0 .041.017.08.044.107v.001l.002.002.002.002a.15.15 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157m.791-2.924a.156.156 0 0 0-.156.156v3.486c0 .086.07.155.156.155h.562c.086 0 .155-.07.155-.155V4.918a.156.156 0 0 0-.155-.156zm3.863 0a.156.156 0 0 0-.156.156v2.07L7.923 4.832l-.013-.015v-.001l-.01-.01-.003-.003-.011-.009h-.001L7.88 4.79l-.003-.002-.005-.003-.008-.005h-.002l-.003-.002-.01-.004-.004-.002-.01-.003h-.002l-.003-.001-.009-.002h-.006l-.003-.001h-.004l-.002-.001h-.574a.156.156 0 0 0-.156.155v3.486c0 .086.07.155.156.155h.56c.087 0 .157-.07.157-.155v-2.07l1.6 2.16a.2.2 0 0 0 .039.038l.001.001.01.006.004.002.008.004.007.003.005.002.01.003h.003a.2.2 0 0 0 .04.006h.56c.087 0 .157-.07.157-.155V4.918a.156.156 0 0 0-.156-.156zm3.815.717v-.56a.156.156 0 0 0-.155-.157h-2.242a.16.16 0 0 0-.108.044h-.001l-.001.002-.002.003a.16.16 0 0 0-.044.107v3.486c0 .041.017.08.044.107l.002.003.002.002a.16.16 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156Z"})})," ","لاين: 819018409625+"]})}),h.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:h.jsxs("li",{children:[h.jsx(DF,{}),"info@japaneseacademy.jp"]})})]}),h.jsxs("div",{className:"social_icons",children:[h.jsx("a",{href:"",children:h.jsx(CF,{})}),h.jsx("a",{href:"",children:h.jsx(Uv,{})}),h.jsx("a",{href:"",children:h.jsx(wF,{})}),h.jsx("a",{href:"",children:h.jsx(RF,{})})]})]}),h.jsxs("div",{className:"group_footer",children:[h.jsxs("div",{className:"group_1_footer",children:[h.jsx("li",{className:" active item1 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/",children:[h.jsx(IF,{}),"الصفحة الرئيسية",h.jsx("span",{className:"sr-only"})]})}),h.jsx("li",{className:" item2 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/Level_division",children:[h.jsx(NF,{}),"المستويات الدراسية"]})}),h.jsx("li",{className:" item3 hidden",children:h.jsxs(vt,{className:"nav-a",to:"/Fees",children:[h.jsx(PF,{}),"الرسوم الدراسية"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Teachers",children:[h.jsx(bF,{}),"الهيئة التدريسية"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Register",children:[h.jsx(h2,{}),"طريقة التسجيل"]})})]}),h.jsxs("div",{className:"group_2_footer",children:[h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Study_materials",children:[h.jsx(TF,{}),"المواد الدراسية"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Questions",children:[h.jsx(OF,{}),"الأسئلة الشائعة"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Comments",children:[h.jsx(AF,{}),"آراء الطلاب"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/More_services",children:[h.jsx(LF,{}),"خدمات إضافية"]})}),h.jsx("li",{className:" item4 hidden",children:h.jsxs(vt,{to:"/Support",children:[h.jsx(yF,{}),"الدعم الفني"]})})]}),h.jsxs("div",{className:"group_3_footer",children:[h.jsx("li",{className:"item4 hidden",children:h.jsxs(vt,{to:"/Privacy",children:[h.jsx(S2,{}),"سياسة الخصوصية"]})}),h.jsx("li",{className:"item4 hidden",children:h.jsxs(vt,{to:"/Terms",children:[h.jsx(g2,{}),"شروط الاستخدام"]})})]})]})]}),h.jsx("div",{className:"footer-img",children:h.jsx("img",{className:"Logo_Footer",src:eI,alt:""})})]})})}),h.jsxs("div",{className:"text-center p-3",style:{backgroundColor:"darkslategrey"},children:[" ",h.jsxs("ul",{className:"Ulfooter",children:[h.jsx("li",{children:h.jsx("a",{className:"text-white fs-5",children:"Copyright © 2022 Japanese Academy. All Rights Reserved"})}),h.jsx("li",{className:"App",children:h.jsx(N2,{})})]})]})]})})})}function D2(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"Container",children:h.jsx("div",{className:"content p-0 w-100",children:h.jsx("div",{className:"img",children:h.jsxs("div",{className:"detailsHeader col-lg-10  m-auto",children:[h.jsx("h1",{children:"تعرف إلينا"}),h.jsx("p",{className:"mt-3",children:"  Home / تعرف علينا "})]})})})})})}function P2(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"contentVision",children:[h.jsx("p",{children:"رؤيتنا: أن نكون المرجع الأول في تدريس اللغة العربية افتراضياً في العالم، وتطوير طرق تدريسها ومناهجها."}),h.jsx("p",{children:"رسالتنا: نشر لغة القرآن وتقريبها وتحبيبها إلى الأجيال."}),h.jsx("p",{children:"مدير الأكاديمية:"}),h.jsx("p",{children:"أ. أحمد الصالح خبير في تعليم اللغة العربية"})]})})}function L2(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container",children:h.jsxs("div",{className:"row pt-5 pb-5",children:[h.jsxs("div",{className:"col-xl-6 col-lg-6",children:[h.jsxs("div",{className:"icons",children:[h.jsx("p",{children:h.jsx(f2,{})}),h.jsx("p",{children:h.jsx(RF,{})}),h.jsx("p",{children:h.jsx(m2,{})}),h.jsx("p",{children:h.jsx(Uv,{})}),h.jsx("p",{children:h.jsx(_2,{})}),h.jsx("p",{children:h.jsx(wF,{})}),h.jsx("p",{children:h.jsx(CF,{})})]}),h.jsx("p",{className:"textIcon text-center m-auto",children:"مع أكاديمية اللغة العربية ستكون اللغة العربية هي المادة الأفضل عند أبنائك"})]}),h.jsx("div",{className:"col-xl-6 col-lg-6",children:h.jsxs("div",{className:"category",children:[h.jsx("h1",{children:"اكاديمية اللغة العربية"}),h.jsx("h3",{children:"الإتقان في تعليم لغة القران"}),h.jsx("p",{children:"امنح أبناءك فرصة الاستمتاع بتجربة فريدة ومميزة في تعليم اللغة العربية والحفاظ على هويتهم الأصيلة"})]})})]})})})}function Zc(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm43.4 289.1c7.5 7.5 7.5 19.8 0 27.3-3.8 3.8-8.7 5.6-13.6 5.6s-9.9-1.9-13.7-5.7l-94-94.3c-6.9-7.6-6.7-19.3.6-26.6l95.4-95.7c7.5-7.5 19.7-7.6 27.3 0 7.5 7.5 7.6 19.7 0 27.3l-81.9 81 79.9 81.1z"},child:[]}]})(a)}function x2(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container",children:[h.jsxs("div",{className:"TitleAbout text-center mt-5",children:[h.jsx("h2",{className:"mb-5 fw-bold",children:"من نحن"}),h.jsx("p",{children:"أكاديميّة افتراضيّة عالمية، متخصّصة في تعليم اللّغة العربيّة، بأحدث الطرق والأساليب الإبداعية، مع كادر تعليميّ تربويّ مؤهّل مدرّب، تحت إشراف أكاديميّ فعّال."})]}),h.jsx("div",{className:"options mb-5 pb-5",children:h.jsxs("ul",{children:[h.jsx("li",{children:" مسارات الدراسة "}),h.jsx("li",{children:" كيف أسجل ابني "}),h.jsx("li",{children:" للتسجيل في مسار الدروس المسجلة  "}),h.jsx("li",{children:" ضمان الجودة "}),h.jsx("li",{children:" المناهج التعليمية "}),h.jsx("li",{children:" من آراء الطلاب "}),h.jsx("li",{children:" النظام الدراسي "}),h.jsx("li",{children:" البرامج والمستويات "}),h.jsx("li",{children:" سياسية دفع الرسوم واستردادها "}),h.jsx("li",{children:" من آراء الأهالي "})]})}),h.jsxs("div",{className:"row",children:[h.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"mb-4 fw-bold",children:"كيف أسجل ابني في أكاديمية اللغة العربية؟"}),h.jsx("p",{children:"للتسجيل في مسار الدروس المباشرة (الفردي أو الجماعي) من خلال موقع الأكاديمية أو من خلال التواصل على وتساب الأكاديمية تستطيع:"}),h.jsxs("ul",{children:[h.jsxs("li",{children:[h.jsx(Zc,{}),"حجز موعد اختبار تحديد المستوى لأبنائك، في الوقت الذي يناسبك."]}),h.jsxs("li",{children:[h.jsx(Zc,{}),"ستزودك الأكاديمية بنتائج تحديد المستوى في أقل من 24 ساعة، وتختار المستوى المناسب له."]}),h.jsxs("li",{children:[h.jsx(Zc,{}),"يمكنك اختيار المسار المناسب لكم (الخاص أو الجماعي)، وبعدها تزودك الإدارة برابط الزوم ومواعيد الدروس وبيانات دخول المنصة"]}),h.jsxs("li",{children:[h.jsx(Zc,{}),"يمكن الطالب حضور الحصص التجريبية في المسار الذي اختاره لمدة أسبوع في كل مسار."]}),h.jsxs("li",{children:[h.jsx(Zc,{}),"في حال لم تناسبه الدروس تكون الحصص هديةً له من أكاديمية اللغة العربية، دون أن يترتب عليه أي رسوم."]})]})]}),h.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"fw-bold mb-4",children:"للتسجيل في مسار الدروس المسجلة"}),h.jsxs("ul",{children:[h.jsxs("li",{children:[h.jsx(Zc,{})," من خلال الموقع يستطيع الطالب أن يختار الدروة المناسبة له "]}),h.jsxs("li",{children:[h.jsx(Zc,{})," بعد أن يحضر الدرس المجاني يمكنه شراء الدورة وحضورها "]}),h.jsxs("li",{children:[h.jsx(Zc,{})," ستظل الدورة مفتوحة له مدة سنة كاملة. "]})]})]})]})]})})}function vh(a){return Ct({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"},child:[]}]})(a)}function k2(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"Allcontent pb-5 pt-5",children:h.jsx("div",{className:"container Aboutiso text-center",children:h.jsxs("div",{className:"row",children:[h.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"mb-4 fw-bold",children:"ضمان الجودة"}),h.jsx("p",{children:"تضمن أكاديمية اللغة العربية لطلابها المواظبين على حضور الدروس وتنفيذ متطلبات النجاح (ملف الإنجاز):"}),h.jsxs("ul",{children:[h.jsxs("li",{children:[" ",h.jsx(vh,{}),"الحصول على المخرجات التعليمية الموضحة في كل مستوى. (في صفحة الدورات)"]}),h.jsxs("li",{children:[" ",h.jsx(vh,{}),"في حال لم يحصل على المخرجات التعليمية الموعود بها فإن أكاديمية اللغة العربية ملزمة بإعادة رسوم الدورة أو منحه مقعداً مجاناً في الدورة."]})]})]}),h.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"fw-bold mb-4",children:"المناهج التعليمية"}),h.jsx("p",{children:"اختارت أكاديمية اللغة العربية لطلابها أفضل المناهج المعتمدة عالمياً"}),h.jsxs("ul",{children:[h.jsxs("li",{children:[" ",h.jsx(vh,{}),"مبنية على أسس تربوية وعلمية"]}),h.jsxs("li",{children:[" ",h.jsx(vh,{}),"مختارة من قبل متخصصين"]}),h.jsxs("li",{children:[" ",h.jsx(vh,{}),"ثرية بالأنشطة التفاعلية وأوراق العمل وعروض بوربوينت والوسائل السمعية والبصرية."]}),h.jsxs("li",{children:[" ",h.jsx(vh,{}),"كما نعتمد سلاسل خاصة في تعليم غير الناطقين بالعربية."]})]})]})]})})})})}function hd(a){return Ct({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M1.25 7.5C1.25 7.22386 1.47386 7 1.75 7H13.25C13.5261 7 13.75 7.22386 13.75 7.5C13.75 7.77614 13.5261 8 13.25 8H1.75C1.47386 8 1.25 7.77614 1.25 7.5Z",fill:"currentColor"},child:[]}]})(a)}function M2(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"Allcontent pb-5 pt-5",children:h.jsx("div",{className:"container Aboutiso text-center",children:h.jsxs("div",{className:"row",children:[h.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"mb-4 fw-bold",children:"سياسية دفع الرسوم واستردادها"}),h.jsx("p",{children:"لأكاديمية اللغة العربية حسابات في عدة دول حول العالم فضلا عن إمكانية الدفع في باي بال و وايز وكويت ترك في تركيا"}),h.jsxs("ul",{children:[h.jsxs("li",{children:[" ",h.jsx(hd,{}),"بعد مقابلة تحديد المستوى وحضور الحصص التجريبية يثبت الطالب التسجيل بدفع الرسوم لشهر مقدماً أو أكثر"]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"الدفع في بداية كل شهر ميلادي."]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"يتحمل الطالب رسوم التحويل إن وجدت."]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"يمكن للطالب إيقاف التسجيل لمدة أسبوع أو أكثر في الدروس الفردية."]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"لا يمكن إيقاف التسجيل في الدروس الجماعية لاستمرار بقية الطلاب في الدراسة."]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"لا تحسم أجور أيام العطل الرسمية مثل عيد الفطر وعيد الأضحى."]}),h.jsxs("li",{children:[" ",h.jsx(hd,{}),"يتحمل الطالب مسؤولية غيابه عن الدروس، ولكن يمكنه الاستفادة من مزية إيقاف التسجيل في الدروس الفردية فقط."]})]})]}),h.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[h.jsx("h4",{className:"fw-bold mb-4",children:"النظام الدراسي في أكاديمية اللغة العربية"}),h.jsx("p",{children:"تعتمد أكاديمية اللغة العربية نظاما تعليمياً مميزاً لتقدم اللغة العربية بأبسط أسلوب لأبنائها بعيداً عن التعقيد والتقعر."}),h.jsxs("ul",{children:[h.jsxs("li",{children:[" ","وقد وُضع هذا البرنامج بناء على دراسات الخبراء والمتخصصين في تعليم اللغة العربية. حيث يهدف إلى تمكين المهارات الأساسية لمتحدث اللغة العربية الأصلي، سواء أكان يقيم في بلاد عربية أم يقيم في بلاد أجنبية."]}),h.jsx("li",{children:"ويهدف هذا البرنامج إلى تقديم اللغة العربية بطريقة تكاملية بحيث تتكامل مهارات: الاستماع، والتحدث باللغة العربية الفصحى، والقراءة السليمة، فضلاً عن الكتابة السليمة."}),h.jsx("li",{children:"إضافة إلى تعليم غير العرب، ودورات القرآن الكريم، كما تأخذ على عاتقها تطوير المعلمين والآباء والأمهات في تعليم اللغة العربية لأبنائهم في تعليم اللغة العربية من خلال دورات مميزة ومتخصصة."})]})]})]})})})})}function j2(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:" AboutLevel pb-5 pt-3",children:[h.jsx("h1",{className:"fw-bold",children:"البرامج والمستويات"}),h.jsxs("div",{className:"container cards text-center",children:[h.jsxs("div",{className:"card1",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج تعليم اللغة العربية للعرب"}),h.jsx("p",{children:"(12 مستوى)"})]}),h.jsxs("div",{className:"card2",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج تعليم اللغة العربية للناطقين بغير العربية"}),h.jsx("p",{children:"مستوى 6"})]}),h.jsxs("div",{className:"card3",children:[h.jsx(ud,{}),h.jsxs("h4",{children:["برنامج متابعة مناهج اللغة العربية الدراسية في المدارس العالمية والعربية"," "]})]}),h.jsxs("div",{className:"card4",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج تعليم القرآن الكريم والعلوم الشرعية "}),h.jsx("p",{children:" (حفظ، تدبر، حديث، سيرة)"})]}),h.jsxs("div",{className:"card5",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج تعليم اللغة العربية للمتخصصين "}),h.jsx("p",{children:" (نحو، صرف، بلاغة)"})]}),h.jsxs("div",{className:"card6",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج رعاية المواهب العربية"}),h.jsx("p",{children:"-"})]}),h.jsxs("div",{className:"card7",children:[h.jsx(ud,{}),h.jsx("h4",{children:"برنامج تدريب المعلمين والآباء والأمهات "})]})]}),h.jsx("button",{children:"التفاصيل في قسم الدورات"})]})})}function U2(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container About_login text-center pt-5 pb-5",children:[h.jsx("h1",{className:"fs-5 fw-bold",children:"أكاديمية اللغة العربية"}),h.jsx("p",{className:"fs-2 pt-4",children:"الإتقان في تعليم لغة القران"}),h.jsx("p",{children:"سجل الآن، وامنح ابنك فرصة تعلم لغته العربية على أيدي المتخصصين."}),h.jsx("p",{children:"0999999999999"})]})})}function V2(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container",children:h.jsxs("div",{className:"main_content",children:[h.jsxs("div",{className:"level_one",children:[h.jsxs("div",{className:"title_level_one",children:[h.jsx("hr",{}),h.jsx("h1",{children:"مستويات اللغة اليابانية للمبتدئين 1"}),h.jsxs("p",{children:["＊على اعتبار تخصيص درسين في الأسبوع، بحيث تكون مدة كل درس 90 دقيقة، ولمدة شهرين ",h.jsx("br",{}),"أي 8 دروس لكل مستوى موزعة على 12 ساعة في شهرين ",h.jsx("br",{}),"＊كل درس من كتاب (مينا نو نيهونغو) يحتاج إلى حصتين درسيتين، حصة لدراسة القاعدة والحصة الثانية للتطبيق عليها. ",h.jsx("br",{}),"＊البدء بدراسة الكانجي اعتبارا من المستوى الرابع، أي بعد 3 مستويات عبر 6 أشهر من بدء دراسة اللغة وتركيز أحرف الكانا جيدا."," ",h.jsx("br",{}),"دراسة 20 حرف كانجي في كل مستوى (5 أحرف أسبوعيا) باعتماد كتاب:"," ",h.jsx("br",{}),"ＢＡＳＩＣ　ＫＡＮＪＩ　ＢＯＯＫ　基本漢字500　ＶＯＬ．１ ",h.jsx("br",{}),"＊7 مستويات ضرورية لإنهاء الجزء الأول من كتاب (مينا نو نيهونغو1)، يكون الطالب قد درس خلالها 80 جرف كانجي. ",h.jsx("br",{})]})]}),h.jsx("div",{className:"content_level_one",children:h.jsxs("ul",{children:[h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الأول"}),"دراسة حروف الهيراغانا ",h.jsx("br",{}),"التحيات ",h.jsx("br",{}),"التعريف عن النفس ",h.jsx("br",{}),"الأرقام ",h.jsx("br",{}),"الدرس 1 من كتاب (مينا نو نيهونغو): التعريف عن الاسم والمهنة والانتماء، النفي، صياغة السؤال."]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الثاني"}),"دراسة حروف الكاتاكانا",h.jsx("br",{}),"الدرس 2 من كتاب (مينا نو نيهونغو): أسماء الإشارة، الملكية."," ",h.jsx("br",{}),"الدرس 3: الإرشاد إلى مكان، أين، البلدان والجنسية. ",h.jsx("br",{}),"الدرس 4: الوقت، صيغة الحاضر والماضي والنفي من الفعل. ",h.jsx("br",{}),"الدرس 5: الأفعال يأتي ويذهب ويعود، السؤال باستخدام متى. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الثالث"}),"مراجعة لأحرف الكانا ",h.jsx("br",{}),"الدرس 6: المفعول به، السؤال باستخدام ما وماذا، صيغتي ألا تفعل ودعنا نفعل. ",h.jsx("br",{}),"الدرس 7: القيام بفعل باستخدام وسيلة معينة، الأفعال يعطي ويأخذ، صيغة قد فعلت كذا أو لم أفعل بعد. ",h.jsx("br",{}),"الدرس 8: الصفات والسؤال عن صفة شيء ما، الظرفين كثيرا وقليلا ما. ",h.jsx("br",{}),"الدرس 9: الأفعال التي نستخدم معها ظروف التكرار قليلا وكثيرا مثل يفهم ويكره ويحب وغيرها، صيغة من وإلى، السؤال باستخدام لماذا. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الرابع"}),"الدرس 10: صيغة يوجد ولا يوجد للعاقل وغير العاقل، حروف الجر."," ",h.jsx("br",{}),"الدرس 11: العدد والمعدود، صيغة فقط. ",h.jsx("br",{}),"الدرس 12: اثبات ونفي الأسماء والصفات، صيغة التفضيل. ",h.jsx("br",{}),"الدرس 13: صيغة أريد شيء وأريد أن أفعل كذا. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الخامس"}),"الدرس 14: صيغة افعل من فضلك، ما رأيك أن نفعل كذا، أنا الآن أقوم بكذا. ",h.jsx("br",{}),"الدرس 15: صيغة لا بأس أن...، لا يجب أن...، هل تعرف...؟ ",h.jsx("br",{}),"الدرس 16: ترتيب عدة أفعال أو عدة أسماء في جملة واحدة، صيغة فعلت كذا ثم فعلت كذا، صيفة كيف تفعل كذا...؟ ",h.jsx("br",{}),"الدرس 17: نفي الفعل حسب المجموعة التي ينتمي إليها، صيغة لا داعي أو لا ضرورة لكذا، صيغة يتوجب عليك كذا. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى السادس"}),"الدرس 18: صيغة الاستطاعة من الفعل، الهواية، صيغة أفعل كذا قبل فعل كذا. ",h.jsx("br",{}),"الدرس 19: صيغة سبق لي أن، ترتيب الأفعال دون التقيد بترتيب زمني، صيغة يصبح كذا للعاقل وغير العاقل. ",h.jsx("br",{}),"الدرس 20: الصيغة العامية ",h.jsx("br",{}),"الدرس 21: صيغة أعتقد وأظن، صيفة مقول القول، صيغة أليس كذلك، صيغة التنبيه. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى السابع"}),"الدرس 22: صلة الموصول. ",h.jsx("br",{}),"الدرس 23: استخدام عندما مع الأفعال والصفات والأسماء. ",h.jsx("br",{}),"الدرس 24: صيغة يفعل لأجل. ",h.jsx("br",{}),"الدرس 25: صيغة إذا كان، حتى لو كان. ",h.jsx("br",{})]})]})})]}),h.jsxs("div",{className:"level_two",children:[h.jsxs("div",{className:"title_level_two",children:[h.jsx("hr",{}),h.jsx("h1",{children:"مستويات اللغة اليابانية للمبتدئين 2"}),h.jsxs("p",{children:["＊6 مستويات ضرورية لإنهاء كتاب الجزء الثاني (مينا نو نيهونغو2)."," ",h.jsx("br",{}),"＊يتم زيادة عدد أحرف الكانجي المطلوب دراستها إلى 25 حرف في كل مستوى (تقريبا 6 أحرف أسبوعيا)، فيكون العدد الإجمالي للأحرف المدروسة خلال هذه المستويات 150 حرف كانجي. ",h.jsx("br",{}),"＊ربما من الأفضل أن نخصص 9 أو 10 حصص للمستوى الثالث عشر، لاحتوائه على 5 دروس قواعد وللقيام بمراجعة وتمارين قواعدية عامة على الكتاب. ",h.jsx("br",{})]})]}),h.jsx("div",{className:"content_level_two",children:h.jsxs("ul",{children:[h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الثامن"}),"الدرس 26: السببية العامية، الطلب، النصيحة. ",h.jsx("br",{}),"الدرس 27: صياغة الاستطاعة من ذات الفعل. ",h.jsx("br",{}),"الدرس 28: جمع فعلين باستخدام بينما، ترتيب عدة أسباب في نفس الجملة، استخدام الصيغتين بالإضافة إلى ولذلك. ",h.jsx("br",{}),"الدرس 29: التعبير عن حالة شيء عاقل أو غير عاقل، الحاضر التام، الأسف على فعل تم. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى التاسع"}),"الدرس 30: المبني للمجهول، الحاضر التام لأجل هدف معين، القيام بفعل كتحضير مسبق لهدف معين. ",h.jsx("br",{}),"الدرس 31: النفي بالعامية، صيفة أفكّر في فعل كذا، أنوي كذا، أنا على موعد مع كذا. ",h.jsx("br",{}),"الدرس 32: صيغة من الأفضل أن، صبغة ربّما... قد يكون، التوقع المستقبلي. ",h.jsx("br",{}),"الدرس 33: صيغة الاقتباس، طلب نقل رسالة شفوية إلى شخص. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى العاشر:"}),"الدرس 34: صيغة كما... تماما، ترتيب أفعال في نفس الجملة باستخدام بعد أن، صيغة النهي. ",h.jsx("br",{}),"الدرس 35: الصيغة الشرطية باستخدام إذا، سؤال طلب النصيحة، صيغة بقدر كذا فهو كذا. ",h.jsx("br",{}),"الدرس 36: صيغة لكي أكتسب القدرة على كذا أفعل كذا، سأعمل على أن... ",h.jsx("br",{}),"الدرس 37: المبني للمجهول من الأفعال، صيغة وفقا لِـ... ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الحادي عشر"}),"الدرس 38: صيغة من الممتع من الجميل من .... أن تفعل كذا، نسيت فعل كذا. ",h.jsx("br",{}),"الدرس 39: السبب والنتيجة باستخدام بعض الأدوات أو بإجراء تغيير على الفعل. ",h.jsx("br",{}),"الدرس 40، صيغة ما إذا كان قد... أو لا، صيغة يمكنك أن... ",h.jsx("br",{}),"الدرس 41: صيغة يفعل لأجل، افعل لو سمحت، ألا تفعل كذا لأجل."," ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الثاني عشر"}),"الدرس 42: استخدام لأجل مع الأسماء. ",h.jsx("br",{}),"الدرس 43: صيغة يبدو أنّ مع الأفعال والصفات والأسماء. ",h.jsx("br",{}),"الدرس 44: صيغة المبالغة، صيغة من السهل أن ومن الصعب أن. ",h.jsx("br",{}),"الدرس 45: صيغة في حال، رغم أنّ. ",h.jsx("br",{})]}),h.jsxs("li",{children:[h.jsx("h3",{children:"محتوى المستوى الثالث عشر"}),"الدرس 46: صيغة كنت على وشك، قد فعلت توّا، من المؤكد أنّ."," ",h.jsx("br",{}),"الدرس 47: صيغة وفقا لِـ... يبدو أنّ. ",h.jsx("br",{}),"الدرس 48: صيغة الإجبار، جعل شخص يقوم بشيء. ",h.jsx("br",{}),"الدرس 49: صيغة الاحترام. ",h.jsx("br",{}),"الدرس 50: صيغة التواضع. ",h.jsx("br",{})]})]})})]})]})})})}function xF(a,r){return function(){return a.apply(r,arguments)}}var F2={};const{toString:B2}=Object.prototype,{getPrototypeOf:tI}=Object,Xv=(a=>r=>{const l=B2.call(r);return a[l]||(a[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),bo=a=>(a=a.toLowerCase(),r=>Xv(r)===a),Qv=a=>r=>typeof r===a,{isArray:Ih}=Array,lm=Qv("undefined");function G2(a){return a!==null&&!lm(a)&&a.constructor!==null&&!lm(a.constructor)&&Er(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const kF=bo("ArrayBuffer");function H2(a){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(a):r=a&&a.buffer&&kF(a.buffer),r}const W2=Qv("string"),Er=Qv("function"),MF=Qv("number"),Zv=a=>a!==null&&typeof a=="object",K2=a=>a===!0||a===!1,Rv=a=>{if(Xv(a)!=="object")return!1;const r=tI(a);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},z2=bo("Date"),Y2=bo("File"),q2=bo("Blob"),$2=bo("FileList"),J2=a=>Zv(a)&&Er(a.pipe),X2=a=>{let r;return a&&(typeof FormData=="function"&&a instanceof FormData||Er(a.append)&&((r=Xv(a))==="formdata"||r==="object"&&Er(a.toString)&&a.toString()==="[object FormData]"))},Q2=bo("URLSearchParams"),[Z2,e$,t$,n$]=["ReadableStream","Request","Response","Headers"].map(bo),i$=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function dm(a,r,{allOwnKeys:l=!1}={}){if(a===null||typeof a>"u")return;let u,_;if(typeof a!="object"&&(a=[a]),Ih(a))for(u=0,_=a.length;u<_;u++)r.call(null,a[u],u,a);else{const E=l?Object.getOwnPropertyNames(a):Object.keys(a),T=E.length;let R;for(u=0;u<T;u++)R=E[u],r.call(null,a[R],R,a)}}function jF(a,r){r=r.toLowerCase();const l=Object.keys(a);let u=l.length,_;for(;u-- >0;)if(_=l[u],r===_.toLowerCase())return _;return null}const md=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:F2,UF=a=>!lm(a)&&a!==md;function CA(){const{caseless:a}=UF(this)&&this||{},r={},l=(u,_)=>{const E=a&&jF(r,_)||_;Rv(r[E])&&Rv(u)?r[E]=CA(r[E],u):Rv(u)?r[E]=CA({},u):Ih(u)?r[E]=u.slice():r[E]=u};for(let u=0,_=arguments.length;u<_;u++)arguments[u]&&dm(arguments[u],l);return r}const s$=(a,r,l,{allOwnKeys:u}={})=>(dm(r,(_,E)=>{l&&Er(_)?a[E]=xF(_,l):a[E]=_},{allOwnKeys:u}),a),r$=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),o$=(a,r,l,u)=>{a.prototype=Object.create(r.prototype,u),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:r.prototype}),l&&Object.assign(a.prototype,l)},a$=(a,r,l,u)=>{let _,E,T;const R={};if(r=r||{},a==null)return r;do{for(_=Object.getOwnPropertyNames(a),E=_.length;E-- >0;)T=_[E],(!u||u(T,a,r))&&!R[T]&&(r[T]=a[T],R[T]=!0);a=l!==!1&&tI(a)}while(a&&(!l||l(a,r))&&a!==Object.prototype);return r},c$=(a,r,l)=>{a=String(a),(l===void 0||l>a.length)&&(l=a.length),l-=r.length;const u=a.indexOf(r,l);return u!==-1&&u===l},l$=a=>{if(!a)return null;if(Ih(a))return a;let r=a.length;if(!MF(r))return null;const l=new Array(r);for(;r-- >0;)l[r]=a[r];return l},d$=(a=>r=>a&&r instanceof a)(typeof Uint8Array<"u"&&tI(Uint8Array)),u$=(a,r)=>{const u=(a&&a[Symbol.iterator]).call(a);let _;for(;(_=u.next())&&!_.done;){const E=_.value;r.call(a,E[0],E[1])}},h$=(a,r)=>{let l;const u=[];for(;(l=a.exec(r))!==null;)u.push(l);return u},p$=bo("HTMLFormElement"),f$=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,u,_){return u.toUpperCase()+_}),_V=(({hasOwnProperty:a})=>(r,l)=>a.call(r,l))(Object.prototype),m$=bo("RegExp"),VF=(a,r)=>{const l=Object.getOwnPropertyDescriptors(a),u={};dm(l,(_,E)=>{let T;(T=r(_,E,a))!==!1&&(u[E]=T||_)}),Object.defineProperties(a,u)},_$=a=>{VF(a,(r,l)=>{if(Er(a)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const u=a[l];if(Er(u)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},E$=(a,r)=>{const l={},u=_=>{_.forEach(E=>{l[E]=!0})};return Ih(a)?u(a):u(String(a).split(r)),l},g$=()=>{},v$=(a,r)=>a!=null&&Number.isFinite(a=+a)?a:r,tA="abcdefghijklmnopqrstuvwxyz",EV="0123456789",FF={DIGIT:EV,ALPHA:tA,ALPHA_DIGIT:tA+tA.toUpperCase()+EV},S$=(a=16,r=FF.ALPHA_DIGIT)=>{let l="";const{length:u}=r;for(;a--;)l+=r[Math.random()*u|0];return l};function T$(a){return!!(a&&Er(a.append)&&a[Symbol.toStringTag]==="FormData"&&a[Symbol.iterator])}const y$=a=>{const r=new Array(10),l=(u,_)=>{if(Zv(u)){if(r.indexOf(u)>=0)return;if(!("toJSON"in u)){r[_]=u;const E=Ih(u)?[]:{};return dm(u,(T,R)=>{const w=l(T,_+1);!lm(w)&&(E[R]=w)}),r[_]=void 0,E}}return u};return l(a,0)},b$=bo("AsyncFunction"),C$=a=>a&&(Zv(a)||Er(a))&&Er(a.then)&&Er(a.catch),BF=((a,r)=>a?setImmediate:r?((l,u)=>(md.addEventListener("message",({source:_,data:E})=>{_===md&&E===l&&u.length&&u.shift()()},!1),_=>{u.push(_),md.postMessage(l,"*")}))(`axios@${Math.random()}`,[]):l=>setTimeout(l))(typeof setImmediate=="function",Er(md.postMessage)),R$=typeof queueMicrotask<"u"?queueMicrotask.bind(md):typeof process<"u"&&process.nextTick||BF,ye={isArray:Ih,isArrayBuffer:kF,isBuffer:G2,isFormData:X2,isArrayBufferView:H2,isString:W2,isNumber:MF,isBoolean:K2,isObject:Zv,isPlainObject:Rv,isReadableStream:Z2,isRequest:e$,isResponse:t$,isHeaders:n$,isUndefined:lm,isDate:z2,isFile:Y2,isBlob:q2,isRegExp:m$,isFunction:Er,isStream:J2,isURLSearchParams:Q2,isTypedArray:d$,isFileList:$2,forEach:dm,merge:CA,extend:s$,trim:i$,stripBOM:r$,inherits:o$,toFlatObject:a$,kindOf:Xv,kindOfTest:bo,endsWith:c$,toArray:l$,forEachEntry:u$,matchAll:h$,isHTMLForm:p$,hasOwnProperty:_V,hasOwnProp:_V,reduceDescriptors:VF,freezeMethods:_$,toObjectSet:E$,toCamelCase:f$,noop:g$,toFiniteNumber:v$,findKey:jF,global:md,isContextDefined:UF,ALPHABET:FF,generateString:S$,isSpecCompliantForm:T$,toJSONObject:y$,isAsyncFn:b$,isThenable:C$,setImmediate:BF,asap:R$};function Ft(a,r,l,u,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",r&&(this.code=r),l&&(this.config=l),u&&(this.request=u),_&&(this.response=_,this.status=_.status?_.status:null)}ye.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ye.toJSONObject(this.config),code:this.code,status:this.status}}});const GF=Ft.prototype,HF={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{HF[a]={value:a}});Object.defineProperties(Ft,HF);Object.defineProperty(GF,"isAxiosError",{value:!0});Ft.from=(a,r,l,u,_,E)=>{const T=Object.create(GF);return ye.toFlatObject(a,T,function(w){return w!==Error.prototype},R=>R!=="isAxiosError"),Ft.call(T,a.message,r,l,u,_),T.cause=a,T.name=a.name,E&&Object.assign(T,E),T};const w$=null;function RA(a){return ye.isPlainObject(a)||ye.isArray(a)}function WF(a){return ye.endsWith(a,"[]")?a.slice(0,-2):a}function gV(a,r,l){return a?a.concat(r).map(function(_,E){return _=WF(_),!l&&E?"["+_+"]":_}).join(l?".":""):r}function A$(a){return ye.isArray(a)&&!a.some(RA)}const I$=ye.toFlatObject(ye,{},null,function(r){return/^is[A-Z]/.test(r)});function eS(a,r,l){if(!ye.isObject(a))throw new TypeError("target must be an object");r=r||new FormData,l=ye.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Y,ie){return!ye.isUndefined(ie[Y])});const u=l.metaTokens,_=l.visitor||P,E=l.dots,T=l.indexes,w=(l.Blob||typeof Blob<"u"&&Blob)&&ye.isSpecCompliantForm(r);if(!ye.isFunction(_))throw new TypeError("visitor must be a function");function j(K){if(K===null)return"";if(ye.isDate(K))return K.toISOString();if(!w&&ye.isBlob(K))throw new Ft("Blob is not supported. Use a Buffer instead.");return ye.isArrayBuffer(K)||ye.isTypedArray(K)?w&&typeof Blob=="function"?new Blob([K]):Buffer.from(K):K}function P(K,Y,ie){let te=K;if(K&&!ie&&typeof K=="object"){if(ye.endsWith(Y,"{}"))Y=u?Y:Y.slice(0,-2),K=JSON.stringify(K);else if(ye.isArray(K)&&A$(K)||(ye.isFileList(K)||ye.endsWith(Y,"[]"))&&(te=ye.toArray(K)))return Y=WF(Y),te.forEach(function(se,pe){!(ye.isUndefined(se)||se===null)&&r.append(T===!0?gV([Y],pe,E):T===null?Y:Y+"[]",j(se))}),!1}return RA(K)?!0:(r.append(gV(ie,Y,E),j(K)),!1)}const U=[],G=Object.assign(I$,{defaultVisitor:P,convertValue:j,isVisitable:RA});function q(K,Y){if(!ye.isUndefined(K)){if(U.indexOf(K)!==-1)throw Error("Circular reference detected in "+Y.join("."));U.push(K),ye.forEach(K,function(te,Z){(!(ye.isUndefined(te)||te===null)&&_.call(r,te,ye.isString(Z)?Z.trim():Z,Y,G))===!0&&q(te,Y?Y.concat(Z):[Z])}),U.pop()}}if(!ye.isObject(a))throw new TypeError("data must be an object");return q(a),r}function vV(a){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(u){return r[u]})}function nI(a,r){this._pairs=[],a&&eS(a,this,r)}const KF=nI.prototype;KF.append=function(r,l){this._pairs.push([r,l])};KF.toString=function(r){const l=r?function(u){return r.call(this,u,vV)}:vV;return this._pairs.map(function(_){return l(_[0])+"="+l(_[1])},"").join("&")};function O$(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zF(a,r,l){if(!r)return a;const u=l&&l.encode||O$;ye.isFunction(l)&&(l={serialize:l});const _=l&&l.serialize;let E;if(_?E=_(r,l):E=ye.isURLSearchParams(r)?r.toString():new nI(r,l).toString(u),E){const T=a.indexOf("#");T!==-1&&(a=a.slice(0,T)),a+=(a.indexOf("?")===-1?"?":"&")+E}return a}class SV{constructor(){this.handlers=[]}use(r,l,u){return this.handlers.push({fulfilled:r,rejected:l,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){ye.forEach(this.handlers,function(u){u!==null&&r(u)})}}const YF={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},N$=typeof URLSearchParams<"u"?URLSearchParams:nI,D$=typeof FormData<"u"?FormData:null,P$=typeof Blob<"u"?Blob:null,L$={isBrowser:!0,classes:{URLSearchParams:N$,FormData:D$,Blob:P$},protocols:["http","https","file","blob","url","data"]},iI=typeof window<"u"&&typeof document<"u",wA=typeof navigator=="object"&&navigator||void 0,x$=iI&&(!wA||["ReactNative","NativeScript","NS"].indexOf(wA.product)<0),k$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",M$=iI&&window.location.href||"http://localhost",j$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:iI,hasStandardBrowserEnv:x$,hasStandardBrowserWebWorkerEnv:k$,navigator:wA,origin:M$},Symbol.toStringTag,{value:"Module"})),gs={...j$,...L$};function U$(a,r){return eS(a,new gs.classes.URLSearchParams,Object.assign({visitor:function(l,u,_,E){return gs.isNode&&ye.isBuffer(l)?(this.append(u,l.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},r))}function V$(a){return ye.matchAll(/\w+|\[(\w*)]/g,a).map(r=>r[0]==="[]"?"":r[1]||r[0])}function F$(a){const r={},l=Object.keys(a);let u;const _=l.length;let E;for(u=0;u<_;u++)E=l[u],r[E]=a[E];return r}function qF(a){function r(l,u,_,E){let T=l[E++];if(T==="__proto__")return!0;const R=Number.isFinite(+T),w=E>=l.length;return T=!T&&ye.isArray(_)?_.length:T,w?(ye.hasOwnProp(_,T)?_[T]=[_[T],u]:_[T]=u,!R):((!_[T]||!ye.isObject(_[T]))&&(_[T]=[]),r(l,u,_[T],E)&&ye.isArray(_[T])&&(_[T]=F$(_[T])),!R)}if(ye.isFormData(a)&&ye.isFunction(a.entries)){const l={};return ye.forEachEntry(a,(u,_)=>{r(V$(u),_,l,0)}),l}return null}function B$(a,r,l){if(ye.isString(a))try{return(r||JSON.parse)(a),ye.trim(a)}catch(u){if(u.name!=="SyntaxError")throw u}return(0,JSON.stringify)(a)}const um={transitional:YF,adapter:["xhr","http","fetch"],transformRequest:[function(r,l){const u=l.getContentType()||"",_=u.indexOf("application/json")>-1,E=ye.isObject(r);if(E&&ye.isHTMLForm(r)&&(r=new FormData(r)),ye.isFormData(r))return _?JSON.stringify(qF(r)):r;if(ye.isArrayBuffer(r)||ye.isBuffer(r)||ye.isStream(r)||ye.isFile(r)||ye.isBlob(r)||ye.isReadableStream(r))return r;if(ye.isArrayBufferView(r))return r.buffer;if(ye.isURLSearchParams(r))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let R;if(E){if(u.indexOf("application/x-www-form-urlencoded")>-1)return U$(r,this.formSerializer).toString();if((R=ye.isFileList(r))||u.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return eS(R?{"files[]":r}:r,w&&new w,this.formSerializer)}}return E||_?(l.setContentType("application/json",!1),B$(r)):r}],transformResponse:[function(r){const l=this.transitional||um.transitional,u=l&&l.forcedJSONParsing,_=this.responseType==="json";if(ye.isResponse(r)||ye.isReadableStream(r))return r;if(r&&ye.isString(r)&&(u&&!this.responseType||_)){const T=!(l&&l.silentJSONParsing)&&_;try{return JSON.parse(r)}catch(R){if(T)throw R.name==="SyntaxError"?Ft.from(R,Ft.ERR_BAD_RESPONSE,this,null,this.response):R}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:gs.classes.FormData,Blob:gs.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ye.forEach(["delete","get","head","post","put","patch"],a=>{um.headers[a]={}});const G$=ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),H$=a=>{const r={};let l,u,_;return a&&a.split(`
`).forEach(function(T){_=T.indexOf(":"),l=T.substring(0,_).trim().toLowerCase(),u=T.substring(_+1).trim(),!(!l||r[l]&&G$[l])&&(l==="set-cookie"?r[l]?r[l].push(u):r[l]=[u]:r[l]=r[l]?r[l]+", "+u:u)}),r},TV=Symbol("internals");function qf(a){return a&&String(a).trim().toLowerCase()}function wv(a){return a===!1||a==null?a:ye.isArray(a)?a.map(wv):String(a)}function W$(a){const r=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=l.exec(a);)r[u[1]]=u[2];return r}const K$=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function nA(a,r,l,u,_){if(ye.isFunction(u))return u.call(this,r,l);if(_&&(r=l),!!ye.isString(r)){if(ye.isString(u))return r.indexOf(u)!==-1;if(ye.isRegExp(u))return u.test(r)}}function z$(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,l,u)=>l.toUpperCase()+u)}function Y$(a,r){const l=ye.toCamelCase(" "+r);["get","set","has"].forEach(u=>{Object.defineProperty(a,u+l,{value:function(_,E,T){return this[u].call(this,r,_,E,T)},configurable:!0})})}class Qs{constructor(r){r&&this.set(r)}set(r,l,u){const _=this;function E(R,w,j){const P=qf(w);if(!P)throw new Error("header name must be a non-empty string");const U=ye.findKey(_,P);(!U||_[U]===void 0||j===!0||j===void 0&&_[U]!==!1)&&(_[U||w]=wv(R))}const T=(R,w)=>ye.forEach(R,(j,P)=>E(j,P,w));if(ye.isPlainObject(r)||r instanceof this.constructor)T(r,l);else if(ye.isString(r)&&(r=r.trim())&&!K$(r))T(H$(r),l);else if(ye.isHeaders(r))for(const[R,w]of r.entries())E(w,R,u);else r!=null&&E(l,r,u);return this}get(r,l){if(r=qf(r),r){const u=ye.findKey(this,r);if(u){const _=this[u];if(!l)return _;if(l===!0)return W$(_);if(ye.isFunction(l))return l.call(this,_,u);if(ye.isRegExp(l))return l.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,l){if(r=qf(r),r){const u=ye.findKey(this,r);return!!(u&&this[u]!==void 0&&(!l||nA(this,this[u],u,l)))}return!1}delete(r,l){const u=this;let _=!1;function E(T){if(T=qf(T),T){const R=ye.findKey(u,T);R&&(!l||nA(u,u[R],R,l))&&(delete u[R],_=!0)}}return ye.isArray(r)?r.forEach(E):E(r),_}clear(r){const l=Object.keys(this);let u=l.length,_=!1;for(;u--;){const E=l[u];(!r||nA(this,this[E],E,r,!0))&&(delete this[E],_=!0)}return _}normalize(r){const l=this,u={};return ye.forEach(this,(_,E)=>{const T=ye.findKey(u,E);if(T){l[T]=wv(_),delete l[E];return}const R=r?z$(E):String(E).trim();R!==E&&delete l[E],l[R]=wv(_),u[R]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const l=Object.create(null);return ye.forEach(this,(u,_)=>{u!=null&&u!==!1&&(l[_]=r&&ye.isArray(u)?u.join(", "):u)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,l])=>r+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...l){const u=new this(r);return l.forEach(_=>u.set(_)),u}static accessor(r){const u=(this[TV]=this[TV]={accessors:{}}).accessors,_=this.prototype;function E(T){const R=qf(T);u[R]||(Y$(_,T),u[R]=!0)}return ye.isArray(r)?r.forEach(E):E(r),this}}Qs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ye.reduceDescriptors(Qs.prototype,({value:a},r)=>{let l=r[0].toUpperCase()+r.slice(1);return{get:()=>a,set(u){this[l]=u}}});ye.freezeMethods(Qs);function iA(a,r){const l=this||um,u=r||l,_=Qs.from(u.headers);let E=u.data;return ye.forEach(a,function(R){E=R.call(l,E,_.normalize(),r?r.status:void 0)}),_.normalize(),E}function $F(a){return!!(a&&a.__CANCEL__)}function Oh(a,r,l){Ft.call(this,a??"canceled",Ft.ERR_CANCELED,r,l),this.name="CanceledError"}ye.inherits(Oh,Ft,{__CANCEL__:!0});function JF(a,r,l){const u=l.config.validateStatus;!l.status||!u||u(l.status)?a(l):r(new Ft("Request failed with status code "+l.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function q$(a){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return r&&r[1]||""}function $$(a,r){a=a||10;const l=new Array(a),u=new Array(a);let _=0,E=0,T;return r=r!==void 0?r:1e3,function(w){const j=Date.now(),P=u[E];T||(T=j),l[_]=w,u[_]=j;let U=E,G=0;for(;U!==_;)G+=l[U++],U=U%a;if(_=(_+1)%a,_===E&&(E=(E+1)%a),j-T<r)return;const q=P&&j-P;return q?Math.round(G*1e3/q):void 0}}function J$(a,r){let l=0,u=1e3/r,_,E;const T=(j,P=Date.now())=>{l=P,_=null,E&&(clearTimeout(E),E=null),a.apply(null,j)};return[(...j)=>{const P=Date.now(),U=P-l;U>=u?T(j,P):(_=j,E||(E=setTimeout(()=>{E=null,T(_)},u-U)))},()=>_&&T(_)]}const Vv=(a,r,l=3)=>{let u=0;const _=$$(50,250);return J$(E=>{const T=E.loaded,R=E.lengthComputable?E.total:void 0,w=T-u,j=_(w),P=T<=R;u=T;const U={loaded:T,total:R,progress:R?T/R:void 0,bytes:w,rate:j||void 0,estimated:j&&R&&P?(R-T)/j:void 0,event:E,lengthComputable:R!=null,[r?"download":"upload"]:!0};a(U)},l)},yV=(a,r)=>{const l=a!=null;return[u=>r[0]({lengthComputable:l,total:a,loaded:u}),r[1]]},bV=a=>(...r)=>ye.asap(()=>a(...r)),X$=gs.hasStandardBrowserEnv?((a,r)=>l=>(l=new URL(l,gs.origin),a.protocol===l.protocol&&a.host===l.host&&(r||a.port===l.port)))(new URL(gs.origin),gs.navigator&&/(msie|trident)/i.test(gs.navigator.userAgent)):()=>!0,Q$=gs.hasStandardBrowserEnv?{write(a,r,l,u,_,E){const T=[a+"="+encodeURIComponent(r)];ye.isNumber(l)&&T.push("expires="+new Date(l).toGMTString()),ye.isString(u)&&T.push("path="+u),ye.isString(_)&&T.push("domain="+_),E===!0&&T.push("secure"),document.cookie=T.join("; ")},read(a){const r=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Z$(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function eJ(a,r){return r?a.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):a}function XF(a,r){return a&&!Z$(r)?eJ(a,r):r}const CV=a=>a instanceof Qs?{...a}:a;function gd(a,r){r=r||{};const l={};function u(j,P,U,G){return ye.isPlainObject(j)&&ye.isPlainObject(P)?ye.merge.call({caseless:G},j,P):ye.isPlainObject(P)?ye.merge({},P):ye.isArray(P)?P.slice():P}function _(j,P,U,G){if(ye.isUndefined(P)){if(!ye.isUndefined(j))return u(void 0,j,U,G)}else return u(j,P,U,G)}function E(j,P){if(!ye.isUndefined(P))return u(void 0,P)}function T(j,P){if(ye.isUndefined(P)){if(!ye.isUndefined(j))return u(void 0,j)}else return u(void 0,P)}function R(j,P,U){if(U in r)return u(j,P);if(U in a)return u(void 0,j)}const w={url:E,method:E,data:E,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:R,headers:(j,P,U)=>_(CV(j),CV(P),U,!0)};return ye.forEach(Object.keys(Object.assign({},a,r)),function(P){const U=w[P]||_,G=U(a[P],r[P],P);ye.isUndefined(G)&&U!==R||(l[P]=G)}),l}const QF=a=>{const r=gd({},a);let{data:l,withXSRFToken:u,xsrfHeaderName:_,xsrfCookieName:E,headers:T,auth:R}=r;r.headers=T=Qs.from(T),r.url=zF(XF(r.baseURL,r.url),a.params,a.paramsSerializer),R&&T.set("Authorization","Basic "+btoa((R.username||"")+":"+(R.password?unescape(encodeURIComponent(R.password)):"")));let w;if(ye.isFormData(l)){if(gs.hasStandardBrowserEnv||gs.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if((w=T.getContentType())!==!1){const[j,...P]=w?w.split(";").map(U=>U.trim()).filter(Boolean):[];T.setContentType([j||"multipart/form-data",...P].join("; "))}}if(gs.hasStandardBrowserEnv&&(u&&ye.isFunction(u)&&(u=u(r)),u||u!==!1&&X$(r.url))){const j=_&&E&&Q$.read(E);j&&T.set(_,j)}return r},tJ=typeof XMLHttpRequest<"u",nJ=tJ&&function(a){return new Promise(function(l,u){const _=QF(a);let E=_.data;const T=Qs.from(_.headers).normalize();let{responseType:R,onUploadProgress:w,onDownloadProgress:j}=_,P,U,G,q,K;function Y(){q&&q(),K&&K(),_.cancelToken&&_.cancelToken.unsubscribe(P),_.signal&&_.signal.removeEventListener("abort",P)}let ie=new XMLHttpRequest;ie.open(_.method.toUpperCase(),_.url,!0),ie.timeout=_.timeout;function te(){if(!ie)return;const se=Qs.from("getAllResponseHeaders"in ie&&ie.getAllResponseHeaders()),ge={data:!R||R==="text"||R==="json"?ie.responseText:ie.response,status:ie.status,statusText:ie.statusText,headers:se,config:a,request:ie};JF(function(Ye){l(Ye),Y()},function(Ye){u(Ye),Y()},ge),ie=null}"onloadend"in ie?ie.onloadend=te:ie.onreadystatechange=function(){!ie||ie.readyState!==4||ie.status===0&&!(ie.responseURL&&ie.responseURL.indexOf("file:")===0)||setTimeout(te)},ie.onabort=function(){ie&&(u(new Ft("Request aborted",Ft.ECONNABORTED,a,ie)),ie=null)},ie.onerror=function(){u(new Ft("Network Error",Ft.ERR_NETWORK,a,ie)),ie=null},ie.ontimeout=function(){let pe=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded";const ge=_.transitional||YF;_.timeoutErrorMessage&&(pe=_.timeoutErrorMessage),u(new Ft(pe,ge.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,a,ie)),ie=null},E===void 0&&T.setContentType(null),"setRequestHeader"in ie&&ye.forEach(T.toJSON(),function(pe,ge){ie.setRequestHeader(ge,pe)}),ye.isUndefined(_.withCredentials)||(ie.withCredentials=!!_.withCredentials),R&&R!=="json"&&(ie.responseType=_.responseType),j&&([G,K]=Vv(j,!0),ie.addEventListener("progress",G)),w&&ie.upload&&([U,q]=Vv(w),ie.upload.addEventListener("progress",U),ie.upload.addEventListener("loadend",q)),(_.cancelToken||_.signal)&&(P=se=>{ie&&(u(!se||se.type?new Oh(null,a,ie):se),ie.abort(),ie=null)},_.cancelToken&&_.cancelToken.subscribe(P),_.signal&&(_.signal.aborted?P():_.signal.addEventListener("abort",P)));const Z=q$(_.url);if(Z&&gs.protocols.indexOf(Z)===-1){u(new Ft("Unsupported protocol "+Z+":",Ft.ERR_BAD_REQUEST,a));return}ie.send(E||null)})},iJ=(a,r)=>{const{length:l}=a=a?a.filter(Boolean):[];if(r||l){let u=new AbortController,_;const E=function(j){if(!_){_=!0,R();const P=j instanceof Error?j:this.reason;u.abort(P instanceof Ft?P:new Oh(P instanceof Error?P.message:P))}};let T=r&&setTimeout(()=>{T=null,E(new Ft(`timeout ${r} of ms exceeded`,Ft.ETIMEDOUT))},r);const R=()=>{a&&(T&&clearTimeout(T),T=null,a.forEach(j=>{j.unsubscribe?j.unsubscribe(E):j.removeEventListener("abort",E)}),a=null)};a.forEach(j=>j.addEventListener("abort",E));const{signal:w}=u;return w.unsubscribe=()=>ye.asap(R),w}},sJ=function*(a,r){let l=a.byteLength;if(l<r){yield a;return}let u=0,_;for(;u<l;)_=u+r,yield a.slice(u,_),u=_},rJ=async function*(a,r){for await(const l of oJ(a))yield*sJ(l,r)},oJ=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const r=a.getReader();try{for(;;){const{done:l,value:u}=await r.read();if(l)break;yield u}}finally{await r.cancel()}},RV=(a,r,l,u)=>{const _=rJ(a,r);let E=0,T,R=w=>{T||(T=!0,u&&u(w))};return new ReadableStream({async pull(w){try{const{done:j,value:P}=await _.next();if(j){R(),w.close();return}let U=P.byteLength;if(l){let G=E+=U;l(G)}w.enqueue(new Uint8Array(P))}catch(j){throw R(j),j}},cancel(w){return R(w),_.return()}},{highWaterMark:2})},tS=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ZF=tS&&typeof ReadableStream=="function",aJ=tS&&(typeof TextEncoder=="function"?(a=>r=>a.encode(r))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),eB=(a,...r)=>{try{return!!a(...r)}catch{return!1}},cJ=ZF&&eB(()=>{let a=!1;const r=new Request(gs.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!r}),wV=64*1024,AA=ZF&&eB(()=>ye.isReadableStream(new Response("").body)),Fv={stream:AA&&(a=>a.body)};tS&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!Fv[r]&&(Fv[r]=ye.isFunction(a[r])?l=>l[r]():(l,u)=>{throw new Ft(`Response type '${r}' is not supported`,Ft.ERR_NOT_SUPPORT,u)})})})(new Response);const lJ=async a=>{if(a==null)return 0;if(ye.isBlob(a))return a.size;if(ye.isSpecCompliantForm(a))return(await new Request(gs.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(ye.isArrayBufferView(a)||ye.isArrayBuffer(a))return a.byteLength;if(ye.isURLSearchParams(a)&&(a=a+""),ye.isString(a))return(await aJ(a)).byteLength},dJ=async(a,r)=>{const l=ye.toFiniteNumber(a.getContentLength());return l??lJ(r)},uJ=tS&&(async a=>{let{url:r,method:l,data:u,signal:_,cancelToken:E,timeout:T,onDownloadProgress:R,onUploadProgress:w,responseType:j,headers:P,withCredentials:U="same-origin",fetchOptions:G}=QF(a);j=j?(j+"").toLowerCase():"text";let q=iJ([_,E&&E.toAbortSignal()],T),K;const Y=q&&q.unsubscribe&&(()=>{q.unsubscribe()});let ie;try{if(w&&cJ&&l!=="get"&&l!=="head"&&(ie=await dJ(P,u))!==0){let ge=new Request(r,{method:"POST",body:u,duplex:"half"}),je;if(ye.isFormData(u)&&(je=ge.headers.get("content-type"))&&P.setContentType(je),ge.body){const[Ye,fe]=yV(ie,Vv(bV(w)));u=RV(ge.body,wV,Ye,fe)}}ye.isString(U)||(U=U?"include":"omit");const te="credentials"in Request.prototype;K=new Request(r,{...G,signal:q,method:l.toUpperCase(),headers:P.normalize().toJSON(),body:u,duplex:"half",credentials:te?U:void 0});let Z=await fetch(K);const se=AA&&(j==="stream"||j==="response");if(AA&&(R||se&&Y)){const ge={};["status","statusText","headers"].forEach(we=>{ge[we]=Z[we]});const je=ye.toFiniteNumber(Z.headers.get("content-length")),[Ye,fe]=R&&yV(je,Vv(bV(R),!0))||[];Z=new Response(RV(Z.body,wV,Ye,()=>{fe&&fe(),Y&&Y()}),ge)}j=j||"text";let pe=await Fv[ye.findKey(Fv,j)||"text"](Z,a);return!se&&Y&&Y(),await new Promise((ge,je)=>{JF(ge,je,{data:pe,headers:Qs.from(Z.headers),status:Z.status,statusText:Z.statusText,config:a,request:K})})}catch(te){throw Y&&Y(),te&&te.name==="TypeError"&&/fetch/i.test(te.message)?Object.assign(new Ft("Network Error",Ft.ERR_NETWORK,a,K),{cause:te.cause||te}):Ft.from(te,te&&te.code,a,K)}}),IA={http:w$,xhr:nJ,fetch:uJ};ye.forEach(IA,(a,r)=>{if(a){try{Object.defineProperty(a,"name",{value:r})}catch{}Object.defineProperty(a,"adapterName",{value:r})}});const AV=a=>`- ${a}`,hJ=a=>ye.isFunction(a)||a===null||a===!1,tB={getAdapter:a=>{a=ye.isArray(a)?a:[a];const{length:r}=a;let l,u;const _={};for(let E=0;E<r;E++){l=a[E];let T;if(u=l,!hJ(l)&&(u=IA[(T=String(l)).toLowerCase()],u===void 0))throw new Ft(`Unknown adapter '${T}'`);if(u)break;_[T||"#"+E]=u}if(!u){const E=Object.entries(_).map(([R,w])=>`adapter ${R} `+(w===!1?"is not supported by the environment":"is not available in the build"));let T=r?E.length>1?`since :
`+E.map(AV).join(`
`):" "+AV(E[0]):"as no adapter specified";throw new Ft("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return u},adapters:IA};function sA(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Oh(null,a)}function IV(a){return sA(a),a.headers=Qs.from(a.headers),a.data=iA.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),tB.getAdapter(a.adapter||um.adapter)(a).then(function(u){return sA(a),u.data=iA.call(a,a.transformResponse,u),u.headers=Qs.from(u.headers),u},function(u){return $F(u)||(sA(a),u&&u.response&&(u.response.data=iA.call(a,a.transformResponse,u.response),u.response.headers=Qs.from(u.response.headers))),Promise.reject(u)})}const nB="1.7.9",nS={};["object","boolean","number","function","string","symbol"].forEach((a,r)=>{nS[a]=function(u){return typeof u===a||"a"+(r<1?"n ":" ")+a}});const OV={};nS.transitional=function(r,l,u){function _(E,T){return"[Axios v"+nB+"] Transitional option '"+E+"'"+T+(u?". "+u:"")}return(E,T,R)=>{if(r===!1)throw new Ft(_(T," has been removed"+(l?" in "+l:"")),Ft.ERR_DEPRECATED);return l&&!OV[T]&&(OV[T]=!0,console.warn(_(T," has been deprecated since v"+l+" and will be removed in the near future"))),r?r(E,T,R):!0}};nS.spelling=function(r){return(l,u)=>(console.warn(`${u} is likely a misspelling of ${r}`),!0)};function pJ(a,r,l){if(typeof a!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const u=Object.keys(a);let _=u.length;for(;_-- >0;){const E=u[_],T=r[E];if(T){const R=a[E],w=R===void 0||T(R,E,a);if(w!==!0)throw new Ft("option "+E+" must be "+w,Ft.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new Ft("Unknown option "+E,Ft.ERR_BAD_OPTION)}}const Av={assertOptions:pJ,validators:nS},sa=Av.validators;class Ed{constructor(r){this.defaults=r,this.interceptors={request:new SV,response:new SV}}async request(r,l){try{return await this._request(r,l)}catch(u){if(u instanceof Error){let _={};Error.captureStackTrace?Error.captureStackTrace(_):_=new Error;const E=_.stack?_.stack.replace(/^.+\n/,""):"";try{u.stack?E&&!String(u.stack).endsWith(E.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+E):u.stack=E}catch{}}throw u}}_request(r,l){typeof r=="string"?(l=l||{},l.url=r):l=r||{},l=gd(this.defaults,l);const{transitional:u,paramsSerializer:_,headers:E}=l;u!==void 0&&Av.assertOptions(u,{silentJSONParsing:sa.transitional(sa.boolean),forcedJSONParsing:sa.transitional(sa.boolean),clarifyTimeoutError:sa.transitional(sa.boolean)},!1),_!=null&&(ye.isFunction(_)?l.paramsSerializer={serialize:_}:Av.assertOptions(_,{encode:sa.function,serialize:sa.function},!0)),Av.assertOptions(l,{baseUrl:sa.spelling("baseURL"),withXsrfToken:sa.spelling("withXSRFToken")},!0),l.method=(l.method||this.defaults.method||"get").toLowerCase();let T=E&&ye.merge(E.common,E[l.method]);E&&ye.forEach(["delete","get","head","post","put","patch","common"],K=>{delete E[K]}),l.headers=Qs.concat(T,E);const R=[];let w=!0;this.interceptors.request.forEach(function(Y){typeof Y.runWhen=="function"&&Y.runWhen(l)===!1||(w=w&&Y.synchronous,R.unshift(Y.fulfilled,Y.rejected))});const j=[];this.interceptors.response.forEach(function(Y){j.push(Y.fulfilled,Y.rejected)});let P,U=0,G;if(!w){const K=[IV.bind(this),void 0];for(K.unshift.apply(K,R),K.push.apply(K,j),G=K.length,P=Promise.resolve(l);U<G;)P=P.then(K[U++],K[U++]);return P}G=R.length;let q=l;for(U=0;U<G;){const K=R[U++],Y=R[U++];try{q=K(q)}catch(ie){Y.call(this,ie);break}}try{P=IV.call(this,q)}catch(K){return Promise.reject(K)}for(U=0,G=j.length;U<G;)P=P.then(j[U++],j[U++]);return P}getUri(r){r=gd(this.defaults,r);const l=XF(r.baseURL,r.url);return zF(l,r.params,r.paramsSerializer)}}ye.forEach(["delete","get","head","options"],function(r){Ed.prototype[r]=function(l,u){return this.request(gd(u||{},{method:r,url:l,data:(u||{}).data}))}});ye.forEach(["post","put","patch"],function(r){function l(u){return function(E,T,R){return this.request(gd(R||{},{method:r,headers:u?{"Content-Type":"multipart/form-data"}:{},url:E,data:T}))}}Ed.prototype[r]=l(),Ed.prototype[r+"Form"]=l(!0)});class sI{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(E){l=E});const u=this;this.promise.then(_=>{if(!u._listeners)return;let E=u._listeners.length;for(;E-- >0;)u._listeners[E](_);u._listeners=null}),this.promise.then=_=>{let E;const T=new Promise(R=>{u.subscribe(R),E=R}).then(_);return T.cancel=function(){u.unsubscribe(E)},T},r(function(E,T,R){u.reason||(u.reason=new Oh(E,T,R),l(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const l=this._listeners.indexOf(r);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const r=new AbortController,l=u=>{r.abort(u)};return this.subscribe(l),r.signal.unsubscribe=()=>this.unsubscribe(l),r.signal}static source(){let r;return{token:new sI(function(_){r=_}),cancel:r}}}function fJ(a){return function(l){return a.apply(null,l)}}function mJ(a){return ye.isObject(a)&&a.isAxiosError===!0}const OA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(OA).forEach(([a,r])=>{OA[r]=a});function iB(a){const r=new Ed(a),l=xF(Ed.prototype.request,r);return ye.extend(l,Ed.prototype,r,{allOwnKeys:!0}),ye.extend(l,r,null,{allOwnKeys:!0}),l.create=function(_){return iB(gd(a,_))},l}const Ci=iB(um);Ci.Axios=Ed;Ci.CanceledError=Oh;Ci.CancelToken=sI;Ci.isCancel=$F;Ci.VERSION=nB;Ci.toFormData=eS;Ci.AxiosError=Ft;Ci.Cancel=Ci.CanceledError;Ci.all=function(r){return Promise.all(r)};Ci.spread=fJ;Ci.isAxiosError=mJ;Ci.mergeConfig=gd;Ci.AxiosHeaders=Qs;Ci.formToJSON=a=>qF(ye.isHTMLForm(a)?new FormData(a):a);Ci.getAdapter=tB.getAdapter;Ci.HttpStatusCode=OA;Ci.default=Ci;const _J="/assets/_c41fd9c8-37b4-4ced-a109-30ba1dde9350.BZm4w6qW.jpg";function NV(a){return a!==null&&typeof a=="object"&&"constructor"in a&&a.constructor===Object}function rI(a,r){a===void 0&&(a={}),r===void 0&&(r={}),Object.keys(r).forEach(l=>{typeof a[l]>"u"?a[l]=r[l]:NV(r[l])&&NV(a[l])&&Object.keys(r[l]).length>0&&rI(a[l],r[l])})}const sB={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function $a(){const a=typeof document<"u"?document:{};return rI(a,sB),a}const EJ={document:sB,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(a){return typeof setTimeout>"u"?(a(),null):setTimeout(a,0)},cancelAnimationFrame(a){typeof setTimeout>"u"||clearTimeout(a)}};function gr(){const a=typeof window<"u"?window:{};return rI(a,EJ),a}function gJ(a){return a===void 0&&(a=""),a.trim().split(" ").filter(r=>!!r.trim())}function vJ(a){const r=a;Object.keys(r).forEach(l=>{try{r[l]=null}catch{}try{delete r[l]}catch{}})}function NA(a,r){return r===void 0&&(r=0),setTimeout(a,r)}function Bv(){return Date.now()}function SJ(a){const r=gr();let l;return r.getComputedStyle&&(l=r.getComputedStyle(a,null)),!l&&a.currentStyle&&(l=a.currentStyle),l||(l=a.style),l}function TJ(a,r){r===void 0&&(r="x");const l=gr();let u,_,E;const T=SJ(a);return l.WebKitCSSMatrix?(_=T.transform||T.webkitTransform,_.split(",").length>6&&(_=_.split(", ").map(R=>R.replace(",",".")).join(", ")),E=new l.WebKitCSSMatrix(_==="none"?"":_)):(E=T.MozTransform||T.OTransform||T.MsTransform||T.msTransform||T.transform||T.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),u=E.toString().split(",")),r==="x"&&(l.WebKitCSSMatrix?_=E.m41:u.length===16?_=parseFloat(u[12]):_=parseFloat(u[4])),r==="y"&&(l.WebKitCSSMatrix?_=E.m42:u.length===16?_=parseFloat(u[13]):_=parseFloat(u[5])),_||0}function vv(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"}function yJ(a){return typeof window<"u"&&typeof window.HTMLElement<"u"?a instanceof HTMLElement:a&&(a.nodeType===1||a.nodeType===11)}function mr(){const a=Object(arguments.length<=0?void 0:arguments[0]),r=["__proto__","constructor","prototype"];for(let l=1;l<arguments.length;l+=1){const u=l<0||arguments.length<=l?void 0:arguments[l];if(u!=null&&!yJ(u)){const _=Object.keys(Object(u)).filter(E=>r.indexOf(E)<0);for(let E=0,T=_.length;E<T;E+=1){const R=_[E],w=Object.getOwnPropertyDescriptor(u,R);w!==void 0&&w.enumerable&&(vv(a[R])&&vv(u[R])?u[R].__swiper__?a[R]=u[R]:mr(a[R],u[R]):!vv(a[R])&&vv(u[R])?(a[R]={},u[R].__swiper__?a[R]=u[R]:mr(a[R],u[R])):a[R]=u[R])}}}return a}function Sv(a,r,l){a.style.setProperty(r,l)}function rB(a){let{swiper:r,targetPosition:l,side:u}=a;const _=gr(),E=-r.translate;let T=null,R;const w=r.params.speed;r.wrapperEl.style.scrollSnapType="none",_.cancelAnimationFrame(r.cssModeFrameID);const j=l>E?"next":"prev",P=(G,q)=>j==="next"&&G>=q||j==="prev"&&G<=q,U=()=>{R=new Date().getTime(),T===null&&(T=R);const G=Math.max(Math.min((R-T)/w,1),0),q=.5-Math.cos(G*Math.PI)/2;let K=E+q*(l-E);if(P(K,l)&&(K=l),r.wrapperEl.scrollTo({[u]:K}),P(K,l)){r.wrapperEl.style.overflow="hidden",r.wrapperEl.style.scrollSnapType="",setTimeout(()=>{r.wrapperEl.style.overflow="",r.wrapperEl.scrollTo({[u]:K})}),_.cancelAnimationFrame(r.cssModeFrameID);return}r.cssModeFrameID=_.requestAnimationFrame(U)};U()}function aa(a,r){r===void 0&&(r="");const l=[...a.children];return a instanceof HTMLSlotElement&&l.push(...a.assignedElements()),r?l.filter(u=>u.matches(r)):l}function bJ(a,r){const l=r.contains(a);return!l&&r instanceof HTMLSlotElement?[...r.assignedElements()].includes(a):l}function Gv(a){try{console.warn(a);return}catch{}}function Hv(a,r){r===void 0&&(r=[]);const l=document.createElement(a);return l.classList.add(...Array.isArray(r)?r:gJ(r)),l}function CJ(a,r){const l=[];for(;a.previousElementSibling;){const u=a.previousElementSibling;r?u.matches(r)&&l.push(u):l.push(u),a=u}return l}function RJ(a,r){const l=[];for(;a.nextElementSibling;){const u=a.nextElementSibling;r?u.matches(r)&&l.push(u):l.push(u),a=u}return l}function tl(a,r){return gr().getComputedStyle(a,null).getPropertyValue(r)}function Wv(a){let r=a,l;if(r){for(l=0;(r=r.previousSibling)!==null;)r.nodeType===1&&(l+=1);return l}}function oB(a,r){const l=[];let u=a.parentElement;for(;u;)r?u.matches(r)&&l.push(u):l.push(u),u=u.parentElement;return l}function DA(a,r,l){const u=gr();return a[r==="width"?"offsetWidth":"offsetHeight"]+parseFloat(u.getComputedStyle(a,null).getPropertyValue(r==="width"?"margin-right":"margin-top"))+parseFloat(u.getComputedStyle(a,null).getPropertyValue(r==="width"?"margin-left":"margin-bottom"))}function $i(a){return(Array.isArray(a)?a:[a]).filter(r=>!!r)}let rA;function wJ(){const a=gr(),r=$a();return{smoothScroll:r.documentElement&&r.documentElement.style&&"scrollBehavior"in r.documentElement.style,touch:!!("ontouchstart"in a||a.DocumentTouch&&r instanceof a.DocumentTouch)}}function aB(){return rA||(rA=wJ()),rA}let oA;function AJ(a){let{userAgent:r}=a===void 0?{}:a;const l=aB(),u=gr(),_=u.navigator.platform,E=r||u.navigator.userAgent,T={ios:!1,android:!1},R=u.screen.width,w=u.screen.height,j=E.match(/(Android);?[\s\/]+([\d.]+)?/);let P=E.match(/(iPad).*OS\s([\d_]+)/);const U=E.match(/(iPod)(.*OS\s([\d_]+))?/),G=!P&&E.match(/(iPhone\sOS|iOS)\s([\d_]+)/),q=_==="Win32";let K=_==="MacIntel";const Y=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!P&&K&&l.touch&&Y.indexOf(`${R}x${w}`)>=0&&(P=E.match(/(Version)\/([\d.]+)/),P||(P=[0,1,"13_0_0"]),K=!1),j&&!q&&(T.os="android",T.android=!0),(P||G||U)&&(T.os="ios",T.ios=!0),T}function cB(a){return a===void 0&&(a={}),oA||(oA=AJ(a)),oA}let aA;function IJ(){const a=gr(),r=cB();let l=!1;function u(){const R=a.navigator.userAgent.toLowerCase();return R.indexOf("safari")>=0&&R.indexOf("chrome")<0&&R.indexOf("android")<0}if(u()){const R=String(a.navigator.userAgent);if(R.includes("Version/")){const[w,j]=R.split("Version/")[1].split(" ")[0].split(".").map(P=>Number(P));l=w<16||w===16&&j<2}}const _=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(a.navigator.userAgent),E=u(),T=E||_&&r.ios;return{isSafari:l||E,needPerspectiveFix:l,need3dFix:T,isWebView:_}}function OJ(){return aA||(aA=IJ()),aA}function NJ(a){let{swiper:r,on:l,emit:u}=a;const _=gr();let E=null,T=null;const R=()=>{!r||r.destroyed||!r.initialized||(u("beforeResize"),u("resize"))},w=()=>{!r||r.destroyed||!r.initialized||(E=new ResizeObserver(U=>{T=_.requestAnimationFrame(()=>{const{width:G,height:q}=r;let K=G,Y=q;U.forEach(ie=>{let{contentBoxSize:te,contentRect:Z,target:se}=ie;se&&se!==r.el||(K=Z?Z.width:(te[0]||te).inlineSize,Y=Z?Z.height:(te[0]||te).blockSize)}),(K!==G||Y!==q)&&R()})}),E.observe(r.el))},j=()=>{T&&_.cancelAnimationFrame(T),E&&E.unobserve&&r.el&&(E.unobserve(r.el),E=null)},P=()=>{!r||r.destroyed||!r.initialized||u("orientationchange")};l("init",()=>{if(r.params.resizeObserver&&typeof _.ResizeObserver<"u"){w();return}_.addEventListener("resize",R),_.addEventListener("orientationchange",P)}),l("destroy",()=>{j(),_.removeEventListener("resize",R),_.removeEventListener("orientationchange",P)})}function DJ(a){let{swiper:r,extendParams:l,on:u,emit:_}=a;const E=[],T=gr(),R=function(P,U){U===void 0&&(U={});const G=T.MutationObserver||T.WebkitMutationObserver,q=new G(K=>{if(r.__preventObserver__)return;if(K.length===1){_("observerUpdate",K[0]);return}const Y=function(){_("observerUpdate",K[0])};T.requestAnimationFrame?T.requestAnimationFrame(Y):T.setTimeout(Y,0)});q.observe(P,{attributes:typeof U.attributes>"u"?!0:U.attributes,childList:r.isElement||(typeof U.childList>"u"?!0:U).childList,characterData:typeof U.characterData>"u"?!0:U.characterData}),E.push(q)},w=()=>{if(r.params.observer){if(r.params.observeParents){const P=oB(r.hostEl);for(let U=0;U<P.length;U+=1)R(P[U])}R(r.hostEl,{childList:r.params.observeSlideChildren}),R(r.wrapperEl,{attributes:!1})}},j=()=>{E.forEach(P=>{P.disconnect()}),E.splice(0,E.length)};l({observer:!1,observeParents:!1,observeSlideChildren:!1}),u("init",w),u("destroy",j)}var PJ={on(a,r,l){const u=this;if(!u.eventsListeners||u.destroyed||typeof r!="function")return u;const _=l?"unshift":"push";return a.split(" ").forEach(E=>{u.eventsListeners[E]||(u.eventsListeners[E]=[]),u.eventsListeners[E][_](r)}),u},once(a,r,l){const u=this;if(!u.eventsListeners||u.destroyed||typeof r!="function")return u;function _(){u.off(a,_),_.__emitterProxy&&delete _.__emitterProxy;for(var E=arguments.length,T=new Array(E),R=0;R<E;R++)T[R]=arguments[R];r.apply(u,T)}return _.__emitterProxy=r,u.on(a,_,l)},onAny(a,r){const l=this;if(!l.eventsListeners||l.destroyed||typeof a!="function")return l;const u=r?"unshift":"push";return l.eventsAnyListeners.indexOf(a)<0&&l.eventsAnyListeners[u](a),l},offAny(a){const r=this;if(!r.eventsListeners||r.destroyed||!r.eventsAnyListeners)return r;const l=r.eventsAnyListeners.indexOf(a);return l>=0&&r.eventsAnyListeners.splice(l,1),r},off(a,r){const l=this;return!l.eventsListeners||l.destroyed||!l.eventsListeners||a.split(" ").forEach(u=>{typeof r>"u"?l.eventsListeners[u]=[]:l.eventsListeners[u]&&l.eventsListeners[u].forEach((_,E)=>{(_===r||_.__emitterProxy&&_.__emitterProxy===r)&&l.eventsListeners[u].splice(E,1)})}),l},emit(){const a=this;if(!a.eventsListeners||a.destroyed||!a.eventsListeners)return a;let r,l,u;for(var _=arguments.length,E=new Array(_),T=0;T<_;T++)E[T]=arguments[T];return typeof E[0]=="string"||Array.isArray(E[0])?(r=E[0],l=E.slice(1,E.length),u=a):(r=E[0].events,l=E[0].data,u=E[0].context||a),l.unshift(u),(Array.isArray(r)?r:r.split(" ")).forEach(w=>{a.eventsAnyListeners&&a.eventsAnyListeners.length&&a.eventsAnyListeners.forEach(j=>{j.apply(u,[w,...l])}),a.eventsListeners&&a.eventsListeners[w]&&a.eventsListeners[w].forEach(j=>{j.apply(u,l)})}),a}};function LJ(){const a=this;let r,l;const u=a.el;typeof a.params.width<"u"&&a.params.width!==null?r=a.params.width:r=u.clientWidth,typeof a.params.height<"u"&&a.params.height!==null?l=a.params.height:l=u.clientHeight,!(r===0&&a.isHorizontal()||l===0&&a.isVertical())&&(r=r-parseInt(tl(u,"padding-left")||0,10)-parseInt(tl(u,"padding-right")||0,10),l=l-parseInt(tl(u,"padding-top")||0,10)-parseInt(tl(u,"padding-bottom")||0,10),Number.isNaN(r)&&(r=0),Number.isNaN(l)&&(l=0),Object.assign(a,{width:r,height:l,size:a.isHorizontal()?r:l}))}function xJ(){const a=this;function r(Le,Fe){return parseFloat(Le.getPropertyValue(a.getDirectionLabel(Fe))||0)}const l=a.params,{wrapperEl:u,slidesEl:_,size:E,rtlTranslate:T,wrongRTL:R}=a,w=a.virtual&&l.virtual.enabled,j=w?a.virtual.slides.length:a.slides.length,P=aa(_,`.${a.params.slideClass}, swiper-slide`),U=w?a.virtual.slides.length:P.length;let G=[];const q=[],K=[];let Y=l.slidesOffsetBefore;typeof Y=="function"&&(Y=l.slidesOffsetBefore.call(a));let ie=l.slidesOffsetAfter;typeof ie=="function"&&(ie=l.slidesOffsetAfter.call(a));const te=a.snapGrid.length,Z=a.slidesGrid.length;let se=l.spaceBetween,pe=-Y,ge=0,je=0;if(typeof E>"u")return;typeof se=="string"&&se.indexOf("%")>=0?se=parseFloat(se.replace("%",""))/100*E:typeof se=="string"&&(se=parseFloat(se)),a.virtualSize=-se,P.forEach(Le=>{T?Le.style.marginLeft="":Le.style.marginRight="",Le.style.marginBottom="",Le.style.marginTop=""}),l.centeredSlides&&l.cssMode&&(Sv(u,"--swiper-centered-offset-before",""),Sv(u,"--swiper-centered-offset-after",""));const Ye=l.grid&&l.grid.rows>1&&a.grid;Ye?a.grid.initSlides(P):a.grid&&a.grid.unsetSlides();let fe;const we=l.slidesPerView==="auto"&&l.breakpoints&&Object.keys(l.breakpoints).filter(Le=>typeof l.breakpoints[Le].slidesPerView<"u").length>0;for(let Le=0;Le<U;Le+=1){fe=0;let Fe;if(P[Le]&&(Fe=P[Le]),Ye&&a.grid.updateSlide(Le,Fe,P),!(P[Le]&&tl(Fe,"display")==="none")){if(l.slidesPerView==="auto"){we&&(P[Le].style[a.getDirectionLabel("width")]="");const tt=getComputedStyle(Fe),Me=Fe.style.transform,Ze=Fe.style.webkitTransform;if(Me&&(Fe.style.transform="none"),Ze&&(Fe.style.webkitTransform="none"),l.roundLengths)fe=a.isHorizontal()?DA(Fe,"width"):DA(Fe,"height");else{const rt=r(tt,"width"),Qt=r(tt,"padding-left"),rs=r(tt,"padding-right"),We=r(tt,"margin-left"),Kt=r(tt,"margin-right"),Jt=tt.getPropertyValue("box-sizing");if(Jt&&Jt==="border-box")fe=rt+We+Kt;else{const{clientWidth:vs,offsetWidth:Ss}=Fe;fe=rt+Qt+rs+We+Kt+(Ss-vs)}}Me&&(Fe.style.transform=Me),Ze&&(Fe.style.webkitTransform=Ze),l.roundLengths&&(fe=Math.floor(fe))}else fe=(E-(l.slidesPerView-1)*se)/l.slidesPerView,l.roundLengths&&(fe=Math.floor(fe)),P[Le]&&(P[Le].style[a.getDirectionLabel("width")]=`${fe}px`);P[Le]&&(P[Le].swiperSlideSize=fe),K.push(fe),l.centeredSlides?(pe=pe+fe/2+ge/2+se,ge===0&&Le!==0&&(pe=pe-E/2-se),Le===0&&(pe=pe-E/2-se),Math.abs(pe)<1/1e3&&(pe=0),l.roundLengths&&(pe=Math.floor(pe)),je%l.slidesPerGroup===0&&G.push(pe),q.push(pe)):(l.roundLengths&&(pe=Math.floor(pe)),(je-Math.min(a.params.slidesPerGroupSkip,je))%a.params.slidesPerGroup===0&&G.push(pe),q.push(pe),pe=pe+fe+se),a.virtualSize+=fe+se,ge=fe,je+=1}}if(a.virtualSize=Math.max(a.virtualSize,E)+ie,T&&R&&(l.effect==="slide"||l.effect==="coverflow")&&(u.style.width=`${a.virtualSize+se}px`),l.setWrapperSize&&(u.style[a.getDirectionLabel("width")]=`${a.virtualSize+se}px`),Ye&&a.grid.updateWrapperSize(fe,G),!l.centeredSlides){const Le=[];for(let Fe=0;Fe<G.length;Fe+=1){let tt=G[Fe];l.roundLengths&&(tt=Math.floor(tt)),G[Fe]<=a.virtualSize-E&&Le.push(tt)}G=Le,Math.floor(a.virtualSize-E)-Math.floor(G[G.length-1])>1&&G.push(a.virtualSize-E)}if(w&&l.loop){const Le=K[0]+se;if(l.slidesPerGroup>1){const Fe=Math.ceil((a.virtual.slidesBefore+a.virtual.slidesAfter)/l.slidesPerGroup),tt=Le*l.slidesPerGroup;for(let Me=0;Me<Fe;Me+=1)G.push(G[G.length-1]+tt)}for(let Fe=0;Fe<a.virtual.slidesBefore+a.virtual.slidesAfter;Fe+=1)l.slidesPerGroup===1&&G.push(G[G.length-1]+Le),q.push(q[q.length-1]+Le),a.virtualSize+=Le}if(G.length===0&&(G=[0]),se!==0){const Le=a.isHorizontal()&&T?"marginLeft":a.getDirectionLabel("marginRight");P.filter((Fe,tt)=>!l.cssMode||l.loop?!0:tt!==P.length-1).forEach(Fe=>{Fe.style[Le]=`${se}px`})}if(l.centeredSlides&&l.centeredSlidesBounds){let Le=0;K.forEach(tt=>{Le+=tt+(se||0)}),Le-=se;const Fe=Le>E?Le-E:0;G=G.map(tt=>tt<=0?-Y:tt>Fe?Fe+ie:tt)}if(l.centerInsufficientSlides){let Le=0;K.forEach(tt=>{Le+=tt+(se||0)}),Le-=se;const Fe=(l.slidesOffsetBefore||0)+(l.slidesOffsetAfter||0);if(Le+Fe<E){const tt=(E-Le-Fe)/2;G.forEach((Me,Ze)=>{G[Ze]=Me-tt}),q.forEach((Me,Ze)=>{q[Ze]=Me+tt})}}if(Object.assign(a,{slides:P,snapGrid:G,slidesGrid:q,slidesSizesGrid:K}),l.centeredSlides&&l.cssMode&&!l.centeredSlidesBounds){Sv(u,"--swiper-centered-offset-before",`${-G[0]}px`),Sv(u,"--swiper-centered-offset-after",`${a.size/2-K[K.length-1]/2}px`);const Le=-a.snapGrid[0],Fe=-a.slidesGrid[0];a.snapGrid=a.snapGrid.map(tt=>tt+Le),a.slidesGrid=a.slidesGrid.map(tt=>tt+Fe)}if(U!==j&&a.emit("slidesLengthChange"),G.length!==te&&(a.params.watchOverflow&&a.checkOverflow(),a.emit("snapGridLengthChange")),q.length!==Z&&a.emit("slidesGridLengthChange"),l.watchSlidesProgress&&a.updateSlidesOffset(),a.emit("slidesUpdated"),!w&&!l.cssMode&&(l.effect==="slide"||l.effect==="fade")){const Le=`${l.containerModifierClass}backface-hidden`,Fe=a.el.classList.contains(Le);U<=l.maxBackfaceHiddenSlides?Fe||a.el.classList.add(Le):Fe&&a.el.classList.remove(Le)}}function kJ(a){const r=this,l=[],u=r.virtual&&r.params.virtual.enabled;let _=0,E;typeof a=="number"?r.setTransition(a):a===!0&&r.setTransition(r.params.speed);const T=R=>u?r.slides[r.getSlideIndexByData(R)]:r.slides[R];if(r.params.slidesPerView!=="auto"&&r.params.slidesPerView>1)if(r.params.centeredSlides)(r.visibleSlides||[]).forEach(R=>{l.push(R)});else for(E=0;E<Math.ceil(r.params.slidesPerView);E+=1){const R=r.activeIndex+E;if(R>r.slides.length&&!u)break;l.push(T(R))}else l.push(T(r.activeIndex));for(E=0;E<l.length;E+=1)if(typeof l[E]<"u"){const R=l[E].offsetHeight;_=R>_?R:_}(_||_===0)&&(r.wrapperEl.style.height=`${_}px`)}function MJ(){const a=this,r=a.slides,l=a.isElement?a.isHorizontal()?a.wrapperEl.offsetLeft:a.wrapperEl.offsetTop:0;for(let u=0;u<r.length;u+=1)r[u].swiperSlideOffset=(a.isHorizontal()?r[u].offsetLeft:r[u].offsetTop)-l-a.cssOverflowAdjustment()}const DV=(a,r,l)=>{r&&!a.classList.contains(l)?a.classList.add(l):!r&&a.classList.contains(l)&&a.classList.remove(l)};function jJ(a){a===void 0&&(a=this&&this.translate||0);const r=this,l=r.params,{slides:u,rtlTranslate:_,snapGrid:E}=r;if(u.length===0)return;typeof u[0].swiperSlideOffset>"u"&&r.updateSlidesOffset();let T=-a;_&&(T=a),r.visibleSlidesIndexes=[],r.visibleSlides=[];let R=l.spaceBetween;typeof R=="string"&&R.indexOf("%")>=0?R=parseFloat(R.replace("%",""))/100*r.size:typeof R=="string"&&(R=parseFloat(R));for(let w=0;w<u.length;w+=1){const j=u[w];let P=j.swiperSlideOffset;l.cssMode&&l.centeredSlides&&(P-=u[0].swiperSlideOffset);const U=(T+(l.centeredSlides?r.minTranslate():0)-P)/(j.swiperSlideSize+R),G=(T-E[0]+(l.centeredSlides?r.minTranslate():0)-P)/(j.swiperSlideSize+R),q=-(T-P),K=q+r.slidesSizesGrid[w],Y=q>=0&&q<=r.size-r.slidesSizesGrid[w],ie=q>=0&&q<r.size-1||K>1&&K<=r.size||q<=0&&K>=r.size;ie&&(r.visibleSlides.push(j),r.visibleSlidesIndexes.push(w)),DV(j,ie,l.slideVisibleClass),DV(j,Y,l.slideFullyVisibleClass),j.progress=_?-U:U,j.originalProgress=_?-G:G}}function UJ(a){const r=this;if(typeof a>"u"){const P=r.rtlTranslate?-1:1;a=r&&r.translate&&r.translate*P||0}const l=r.params,u=r.maxTranslate()-r.minTranslate();let{progress:_,isBeginning:E,isEnd:T,progressLoop:R}=r;const w=E,j=T;if(u===0)_=0,E=!0,T=!0;else{_=(a-r.minTranslate())/u;const P=Math.abs(a-r.minTranslate())<1,U=Math.abs(a-r.maxTranslate())<1;E=P||_<=0,T=U||_>=1,P&&(_=0),U&&(_=1)}if(l.loop){const P=r.getSlideIndexByData(0),U=r.getSlideIndexByData(r.slides.length-1),G=r.slidesGrid[P],q=r.slidesGrid[U],K=r.slidesGrid[r.slidesGrid.length-1],Y=Math.abs(a);Y>=G?R=(Y-G)/K:R=(Y+K-q)/K,R>1&&(R-=1)}Object.assign(r,{progress:_,progressLoop:R,isBeginning:E,isEnd:T}),(l.watchSlidesProgress||l.centeredSlides&&l.autoHeight)&&r.updateSlidesProgress(a),E&&!w&&r.emit("reachBeginning toEdge"),T&&!j&&r.emit("reachEnd toEdge"),(w&&!E||j&&!T)&&r.emit("fromEdge"),r.emit("progress",_)}const cA=(a,r,l)=>{r&&!a.classList.contains(l)?a.classList.add(l):!r&&a.classList.contains(l)&&a.classList.remove(l)};function VJ(){const a=this,{slides:r,params:l,slidesEl:u,activeIndex:_}=a,E=a.virtual&&l.virtual.enabled,T=a.grid&&l.grid&&l.grid.rows>1,R=U=>aa(u,`.${l.slideClass}${U}, swiper-slide${U}`)[0];let w,j,P;if(E)if(l.loop){let U=_-a.virtual.slidesBefore;U<0&&(U=a.virtual.slides.length+U),U>=a.virtual.slides.length&&(U-=a.virtual.slides.length),w=R(`[data-swiper-slide-index="${U}"]`)}else w=R(`[data-swiper-slide-index="${_}"]`);else T?(w=r.filter(U=>U.column===_)[0],P=r.filter(U=>U.column===_+1)[0],j=r.filter(U=>U.column===_-1)[0]):w=r[_];w&&(T||(P=RJ(w,`.${l.slideClass}, swiper-slide`)[0],l.loop&&!P&&(P=r[0]),j=CJ(w,`.${l.slideClass}, swiper-slide`)[0],l.loop&&!j===0&&(j=r[r.length-1]))),r.forEach(U=>{cA(U,U===w,l.slideActiveClass),cA(U,U===P,l.slideNextClass),cA(U,U===j,l.slidePrevClass)}),a.emitSlidesClasses()}const Iv=(a,r)=>{if(!a||a.destroyed||!a.params)return;const l=()=>a.isElement?"swiper-slide":`.${a.params.slideClass}`,u=r.closest(l());if(u){let _=u.querySelector(`.${a.params.lazyPreloaderClass}`);!_&&a.isElement&&(u.shadowRoot?_=u.shadowRoot.querySelector(`.${a.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{u.shadowRoot&&(_=u.shadowRoot.querySelector(`.${a.params.lazyPreloaderClass}`),_&&_.remove())})),_&&_.remove()}},lA=(a,r)=>{if(!a.slides[r])return;const l=a.slides[r].querySelector('[loading="lazy"]');l&&l.removeAttribute("loading")},PA=a=>{if(!a||a.destroyed||!a.params)return;let r=a.params.lazyPreloadPrevNext;const l=a.slides.length;if(!l||!r||r<0)return;r=Math.min(r,l);const u=a.params.slidesPerView==="auto"?a.slidesPerViewDynamic():Math.ceil(a.params.slidesPerView),_=a.activeIndex;if(a.params.grid&&a.params.grid.rows>1){const T=_,R=[T-r];R.push(...Array.from({length:r}).map((w,j)=>T+u+j)),a.slides.forEach((w,j)=>{R.includes(w.column)&&lA(a,j)});return}const E=_+u-1;if(a.params.rewind||a.params.loop)for(let T=_-r;T<=E+r;T+=1){const R=(T%l+l)%l;(R<_||R>E)&&lA(a,R)}else for(let T=Math.max(_-r,0);T<=Math.min(E+r,l-1);T+=1)T!==_&&(T>E||T<_)&&lA(a,T)};function FJ(a){const{slidesGrid:r,params:l}=a,u=a.rtlTranslate?a.translate:-a.translate;let _;for(let E=0;E<r.length;E+=1)typeof r[E+1]<"u"?u>=r[E]&&u<r[E+1]-(r[E+1]-r[E])/2?_=E:u>=r[E]&&u<r[E+1]&&(_=E+1):u>=r[E]&&(_=E);return l.normalizeSlideIndex&&(_<0||typeof _>"u")&&(_=0),_}function BJ(a){const r=this,l=r.rtlTranslate?r.translate:-r.translate,{snapGrid:u,params:_,activeIndex:E,realIndex:T,snapIndex:R}=r;let w=a,j;const P=q=>{let K=q-r.virtual.slidesBefore;return K<0&&(K=r.virtual.slides.length+K),K>=r.virtual.slides.length&&(K-=r.virtual.slides.length),K};if(typeof w>"u"&&(w=FJ(r)),u.indexOf(l)>=0)j=u.indexOf(l);else{const q=Math.min(_.slidesPerGroupSkip,w);j=q+Math.floor((w-q)/_.slidesPerGroup)}if(j>=u.length&&(j=u.length-1),w===E&&!r.params.loop){j!==R&&(r.snapIndex=j,r.emit("snapIndexChange"));return}if(w===E&&r.params.loop&&r.virtual&&r.params.virtual.enabled){r.realIndex=P(w);return}const U=r.grid&&_.grid&&_.grid.rows>1;let G;if(r.virtual&&_.virtual.enabled&&_.loop)G=P(w);else if(U){const q=r.slides.filter(Y=>Y.column===w)[0];let K=parseInt(q.getAttribute("data-swiper-slide-index"),10);Number.isNaN(K)&&(K=Math.max(r.slides.indexOf(q),0)),G=Math.floor(K/_.grid.rows)}else if(r.slides[w]){const q=r.slides[w].getAttribute("data-swiper-slide-index");q?G=parseInt(q,10):G=w}else G=w;Object.assign(r,{previousSnapIndex:R,snapIndex:j,previousRealIndex:T,realIndex:G,previousIndex:E,activeIndex:w}),r.initialized&&PA(r),r.emit("activeIndexChange"),r.emit("snapIndexChange"),(r.initialized||r.params.runCallbacksOnInit)&&(T!==G&&r.emit("realIndexChange"),r.emit("slideChange"))}function GJ(a,r){const l=this,u=l.params;let _=a.closest(`.${u.slideClass}, swiper-slide`);!_&&l.isElement&&r&&r.length>1&&r.includes(a)&&[...r.slice(r.indexOf(a)+1,r.length)].forEach(R=>{!_&&R.matches&&R.matches(`.${u.slideClass}, swiper-slide`)&&(_=R)});let E=!1,T;if(_){for(let R=0;R<l.slides.length;R+=1)if(l.slides[R]===_){E=!0,T=R;break}}if(_&&E)l.clickedSlide=_,l.virtual&&l.params.virtual.enabled?l.clickedIndex=parseInt(_.getAttribute("data-swiper-slide-index"),10):l.clickedIndex=T;else{l.clickedSlide=void 0,l.clickedIndex=void 0;return}u.slideToClickedSlide&&l.clickedIndex!==void 0&&l.clickedIndex!==l.activeIndex&&l.slideToClickedSlide()}var HJ={updateSize:LJ,updateSlides:xJ,updateAutoHeight:kJ,updateSlidesOffset:MJ,updateSlidesProgress:jJ,updateProgress:UJ,updateSlidesClasses:VJ,updateActiveIndex:BJ,updateClickedSlide:GJ};function WJ(a){a===void 0&&(a=this.isHorizontal()?"x":"y");const r=this,{params:l,rtlTranslate:u,translate:_,wrapperEl:E}=r;if(l.virtualTranslate)return u?-_:_;if(l.cssMode)return _;let T=TJ(E,a);return T+=r.cssOverflowAdjustment(),u&&(T=-T),T||0}function KJ(a,r){const l=this,{rtlTranslate:u,params:_,wrapperEl:E,progress:T}=l;let R=0,w=0;const j=0;l.isHorizontal()?R=u?-a:a:w=a,_.roundLengths&&(R=Math.floor(R),w=Math.floor(w)),l.previousTranslate=l.translate,l.translate=l.isHorizontal()?R:w,_.cssMode?E[l.isHorizontal()?"scrollLeft":"scrollTop"]=l.isHorizontal()?-R:-w:_.virtualTranslate||(l.isHorizontal()?R-=l.cssOverflowAdjustment():w-=l.cssOverflowAdjustment(),E.style.transform=`translate3d(${R}px, ${w}px, ${j}px)`);let P;const U=l.maxTranslate()-l.minTranslate();U===0?P=0:P=(a-l.minTranslate())/U,P!==T&&l.updateProgress(a),l.emit("setTranslate",l.translate,r)}function zJ(){return-this.snapGrid[0]}function YJ(){return-this.snapGrid[this.snapGrid.length-1]}function qJ(a,r,l,u,_){a===void 0&&(a=0),r===void 0&&(r=this.params.speed),l===void 0&&(l=!0),u===void 0&&(u=!0);const E=this,{params:T,wrapperEl:R}=E;if(E.animating&&T.preventInteractionOnTransition)return!1;const w=E.minTranslate(),j=E.maxTranslate();let P;if(u&&a>w?P=w:u&&a<j?P=j:P=a,E.updateProgress(P),T.cssMode){const U=E.isHorizontal();if(r===0)R[U?"scrollLeft":"scrollTop"]=-P;else{if(!E.support.smoothScroll)return rB({swiper:E,targetPosition:-P,side:U?"left":"top"}),!0;R.scrollTo({[U?"left":"top"]:-P,behavior:"smooth"})}return!0}return r===0?(E.setTransition(0),E.setTranslate(P),l&&(E.emit("beforeTransitionStart",r,_),E.emit("transitionEnd"))):(E.setTransition(r),E.setTranslate(P),l&&(E.emit("beforeTransitionStart",r,_),E.emit("transitionStart")),E.animating||(E.animating=!0,E.onTranslateToWrapperTransitionEnd||(E.onTranslateToWrapperTransitionEnd=function(G){!E||E.destroyed||G.target===this&&(E.wrapperEl.removeEventListener("transitionend",E.onTranslateToWrapperTransitionEnd),E.onTranslateToWrapperTransitionEnd=null,delete E.onTranslateToWrapperTransitionEnd,E.animating=!1,l&&E.emit("transitionEnd"))}),E.wrapperEl.addEventListener("transitionend",E.onTranslateToWrapperTransitionEnd))),!0}var $J={getTranslate:WJ,setTranslate:KJ,minTranslate:zJ,maxTranslate:YJ,translateTo:qJ};function JJ(a,r){const l=this;l.params.cssMode||(l.wrapperEl.style.transitionDuration=`${a}ms`,l.wrapperEl.style.transitionDelay=a===0?"0ms":""),l.emit("setTransition",a,r)}function lB(a){let{swiper:r,runCallbacks:l,direction:u,step:_}=a;const{activeIndex:E,previousIndex:T}=r;let R=u;if(R||(E>T?R="next":E<T?R="prev":R="reset"),r.emit(`transition${_}`),l&&E!==T){if(R==="reset"){r.emit(`slideResetTransition${_}`);return}r.emit(`slideChangeTransition${_}`),R==="next"?r.emit(`slideNextTransition${_}`):r.emit(`slidePrevTransition${_}`)}}function XJ(a,r){a===void 0&&(a=!0);const l=this,{params:u}=l;u.cssMode||(u.autoHeight&&l.updateAutoHeight(),lB({swiper:l,runCallbacks:a,direction:r,step:"Start"}))}function QJ(a,r){a===void 0&&(a=!0);const l=this,{params:u}=l;l.animating=!1,!u.cssMode&&(l.setTransition(0),lB({swiper:l,runCallbacks:a,direction:r,step:"End"}))}var ZJ={setTransition:JJ,transitionStart:XJ,transitionEnd:QJ};function eX(a,r,l,u,_){a===void 0&&(a=0),l===void 0&&(l=!0),typeof a=="string"&&(a=parseInt(a,10));const E=this;let T=a;T<0&&(T=0);const{params:R,snapGrid:w,slidesGrid:j,previousIndex:P,activeIndex:U,rtlTranslate:G,wrapperEl:q,enabled:K}=E;if(!K&&!u&&!_||E.destroyed||E.animating&&R.preventInteractionOnTransition)return!1;typeof r>"u"&&(r=E.params.speed);const Y=Math.min(E.params.slidesPerGroupSkip,T);let ie=Y+Math.floor((T-Y)/E.params.slidesPerGroup);ie>=w.length&&(ie=w.length-1);const te=-w[ie];if(R.normalizeSlideIndex)for(let ge=0;ge<j.length;ge+=1){const je=-Math.floor(te*100),Ye=Math.floor(j[ge]*100),fe=Math.floor(j[ge+1]*100);typeof j[ge+1]<"u"?je>=Ye&&je<fe-(fe-Ye)/2?T=ge:je>=Ye&&je<fe&&(T=ge+1):je>=Ye&&(T=ge)}if(E.initialized&&T!==U&&(!E.allowSlideNext&&(G?te>E.translate&&te>E.minTranslate():te<E.translate&&te<E.minTranslate())||!E.allowSlidePrev&&te>E.translate&&te>E.maxTranslate()&&(U||0)!==T))return!1;T!==(P||0)&&l&&E.emit("beforeSlideChangeStart"),E.updateProgress(te);let Z;T>U?Z="next":T<U?Z="prev":Z="reset";const se=E.virtual&&E.params.virtual.enabled;if(!(se&&_)&&(G&&-te===E.translate||!G&&te===E.translate))return E.updateActiveIndex(T),R.autoHeight&&E.updateAutoHeight(),E.updateSlidesClasses(),R.effect!=="slide"&&E.setTranslate(te),Z!=="reset"&&(E.transitionStart(l,Z),E.transitionEnd(l,Z)),!1;if(R.cssMode){const ge=E.isHorizontal(),je=G?te:-te;if(r===0)se&&(E.wrapperEl.style.scrollSnapType="none",E._immediateVirtual=!0),se&&!E._cssModeVirtualInitialSet&&E.params.initialSlide>0?(E._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{q[ge?"scrollLeft":"scrollTop"]=je})):q[ge?"scrollLeft":"scrollTop"]=je,se&&requestAnimationFrame(()=>{E.wrapperEl.style.scrollSnapType="",E._immediateVirtual=!1});else{if(!E.support.smoothScroll)return rB({swiper:E,targetPosition:je,side:ge?"left":"top"}),!0;q.scrollTo({[ge?"left":"top"]:je,behavior:"smooth"})}return!0}return E.setTransition(r),E.setTranslate(te),E.updateActiveIndex(T),E.updateSlidesClasses(),E.emit("beforeTransitionStart",r,u),E.transitionStart(l,Z),r===0?E.transitionEnd(l,Z):E.animating||(E.animating=!0,E.onSlideToWrapperTransitionEnd||(E.onSlideToWrapperTransitionEnd=function(je){!E||E.destroyed||je.target===this&&(E.wrapperEl.removeEventListener("transitionend",E.onSlideToWrapperTransitionEnd),E.onSlideToWrapperTransitionEnd=null,delete E.onSlideToWrapperTransitionEnd,E.transitionEnd(l,Z))}),E.wrapperEl.addEventListener("transitionend",E.onSlideToWrapperTransitionEnd)),!0}function tX(a,r,l,u){a===void 0&&(a=0),l===void 0&&(l=!0),typeof a=="string"&&(a=parseInt(a,10));const _=this;if(_.destroyed)return;typeof r>"u"&&(r=_.params.speed);const E=_.grid&&_.params.grid&&_.params.grid.rows>1;let T=a;if(_.params.loop)if(_.virtual&&_.params.virtual.enabled)T=T+_.virtual.slidesBefore;else{let R;if(E){const G=T*_.params.grid.rows;R=_.slides.filter(q=>q.getAttribute("data-swiper-slide-index")*1===G)[0].column}else R=_.getSlideIndexByData(T);const w=E?Math.ceil(_.slides.length/_.params.grid.rows):_.slides.length,{centeredSlides:j}=_.params;let P=_.params.slidesPerView;P==="auto"?P=_.slidesPerViewDynamic():(P=Math.ceil(parseFloat(_.params.slidesPerView,10)),j&&P%2===0&&(P=P+1));let U=w-R<P;if(j&&(U=U||R<Math.ceil(P/2)),u&&j&&_.params.slidesPerView!=="auto"&&!E&&(U=!1),U){const G=j?R<_.activeIndex?"prev":"next":R-_.activeIndex-1<_.params.slidesPerView?"next":"prev";_.loopFix({direction:G,slideTo:!0,activeSlideIndex:G==="next"?R+1:R-w+1,slideRealIndex:G==="next"?_.realIndex:void 0})}if(E){const G=T*_.params.grid.rows;T=_.slides.filter(q=>q.getAttribute("data-swiper-slide-index")*1===G)[0].column}else T=_.getSlideIndexByData(T)}return requestAnimationFrame(()=>{_.slideTo(T,r,l,u)}),_}function nX(a,r,l){r===void 0&&(r=!0);const u=this,{enabled:_,params:E,animating:T}=u;if(!_||u.destroyed)return u;typeof a>"u"&&(a=u.params.speed);let R=E.slidesPerGroup;E.slidesPerView==="auto"&&E.slidesPerGroup===1&&E.slidesPerGroupAuto&&(R=Math.max(u.slidesPerViewDynamic("current",!0),1));const w=u.activeIndex<E.slidesPerGroupSkip?1:R,j=u.virtual&&E.virtual.enabled;if(E.loop){if(T&&!j&&E.loopPreventsSliding)return!1;if(u.loopFix({direction:"next"}),u._clientLeft=u.wrapperEl.clientLeft,u.activeIndex===u.slides.length-1&&E.cssMode)return requestAnimationFrame(()=>{u.slideTo(u.activeIndex+w,a,r,l)}),!0}return E.rewind&&u.isEnd?u.slideTo(0,a,r,l):u.slideTo(u.activeIndex+w,a,r,l)}function iX(a,r,l){r===void 0&&(r=!0);const u=this,{params:_,snapGrid:E,slidesGrid:T,rtlTranslate:R,enabled:w,animating:j}=u;if(!w||u.destroyed)return u;typeof a>"u"&&(a=u.params.speed);const P=u.virtual&&_.virtual.enabled;if(_.loop){if(j&&!P&&_.loopPreventsSliding)return!1;u.loopFix({direction:"prev"}),u._clientLeft=u.wrapperEl.clientLeft}const U=R?u.translate:-u.translate;function G(te){return te<0?-Math.floor(Math.abs(te)):Math.floor(te)}const q=G(U),K=E.map(te=>G(te));let Y=E[K.indexOf(q)-1];if(typeof Y>"u"&&_.cssMode){let te;E.forEach((Z,se)=>{q>=Z&&(te=se)}),typeof te<"u"&&(Y=E[te>0?te-1:te])}let ie=0;if(typeof Y<"u"&&(ie=T.indexOf(Y),ie<0&&(ie=u.activeIndex-1),_.slidesPerView==="auto"&&_.slidesPerGroup===1&&_.slidesPerGroupAuto&&(ie=ie-u.slidesPerViewDynamic("previous",!0)+1,ie=Math.max(ie,0))),_.rewind&&u.isBeginning){const te=u.params.virtual&&u.params.virtual.enabled&&u.virtual?u.virtual.slides.length-1:u.slides.length-1;return u.slideTo(te,a,r,l)}else if(_.loop&&u.activeIndex===0&&_.cssMode)return requestAnimationFrame(()=>{u.slideTo(ie,a,r,l)}),!0;return u.slideTo(ie,a,r,l)}function sX(a,r,l){r===void 0&&(r=!0);const u=this;if(!u.destroyed)return typeof a>"u"&&(a=u.params.speed),u.slideTo(u.activeIndex,a,r,l)}function rX(a,r,l,u){r===void 0&&(r=!0),u===void 0&&(u=.5);const _=this;if(_.destroyed)return;typeof a>"u"&&(a=_.params.speed);let E=_.activeIndex;const T=Math.min(_.params.slidesPerGroupSkip,E),R=T+Math.floor((E-T)/_.params.slidesPerGroup),w=_.rtlTranslate?_.translate:-_.translate;if(w>=_.snapGrid[R]){const j=_.snapGrid[R],P=_.snapGrid[R+1];w-j>(P-j)*u&&(E+=_.params.slidesPerGroup)}else{const j=_.snapGrid[R-1],P=_.snapGrid[R];w-j<=(P-j)*u&&(E-=_.params.slidesPerGroup)}return E=Math.max(E,0),E=Math.min(E,_.slidesGrid.length-1),_.slideTo(E,a,r,l)}function oX(){const a=this;if(a.destroyed)return;const{params:r,slidesEl:l}=a,u=r.slidesPerView==="auto"?a.slidesPerViewDynamic():r.slidesPerView;let _=a.clickedIndex,E;const T=a.isElement?"swiper-slide":`.${r.slideClass}`;if(r.loop){if(a.animating)return;E=parseInt(a.clickedSlide.getAttribute("data-swiper-slide-index"),10),r.centeredSlides?_<a.loopedSlides-u/2||_>a.slides.length-a.loopedSlides+u/2?(a.loopFix(),_=a.getSlideIndex(aa(l,`${T}[data-swiper-slide-index="${E}"]`)[0]),NA(()=>{a.slideTo(_)})):a.slideTo(_):_>a.slides.length-u?(a.loopFix(),_=a.getSlideIndex(aa(l,`${T}[data-swiper-slide-index="${E}"]`)[0]),NA(()=>{a.slideTo(_)})):a.slideTo(_)}else a.slideTo(_)}var aX={slideTo:eX,slideToLoop:tX,slideNext:nX,slidePrev:iX,slideReset:sX,slideToClosest:rX,slideToClickedSlide:oX};function cX(a){const r=this,{params:l,slidesEl:u}=r;if(!l.loop||r.virtual&&r.params.virtual.enabled)return;const _=()=>{aa(u,`.${l.slideClass}, swiper-slide`).forEach((U,G)=>{U.setAttribute("data-swiper-slide-index",G)})},E=r.grid&&l.grid&&l.grid.rows>1,T=l.slidesPerGroup*(E?l.grid.rows:1),R=r.slides.length%T!==0,w=E&&r.slides.length%l.grid.rows!==0,j=P=>{for(let U=0;U<P;U+=1){const G=r.isElement?Hv("swiper-slide",[l.slideBlankClass]):Hv("div",[l.slideClass,l.slideBlankClass]);r.slidesEl.append(G)}};if(R){if(l.loopAddBlankSlides){const P=T-r.slides.length%T;j(P),r.recalcSlides(),r.updateSlides()}else Gv("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");_()}else if(w){if(l.loopAddBlankSlides){const P=l.grid.rows-r.slides.length%l.grid.rows;j(P),r.recalcSlides(),r.updateSlides()}else Gv("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");_()}else _();r.loopFix({slideRealIndex:a,direction:l.centeredSlides?void 0:"next"})}function lX(a){let{slideRealIndex:r,slideTo:l=!0,direction:u,setTranslate:_,activeSlideIndex:E,byController:T,byMousewheel:R}=a===void 0?{}:a;const w=this;if(!w.params.loop)return;w.emit("beforeLoopFix");const{slides:j,allowSlidePrev:P,allowSlideNext:U,slidesEl:G,params:q}=w,{centeredSlides:K}=q;if(w.allowSlidePrev=!0,w.allowSlideNext=!0,w.virtual&&q.virtual.enabled){l&&(!q.centeredSlides&&w.snapIndex===0?w.slideTo(w.virtual.slides.length,0,!1,!0):q.centeredSlides&&w.snapIndex<q.slidesPerView?w.slideTo(w.virtual.slides.length+w.snapIndex,0,!1,!0):w.snapIndex===w.snapGrid.length-1&&w.slideTo(w.virtual.slidesBefore,0,!1,!0)),w.allowSlidePrev=P,w.allowSlideNext=U,w.emit("loopFix");return}let Y=q.slidesPerView;Y==="auto"?Y=w.slidesPerViewDynamic():(Y=Math.ceil(parseFloat(q.slidesPerView,10)),K&&Y%2===0&&(Y=Y+1));const ie=q.slidesPerGroupAuto?Y:q.slidesPerGroup;let te=ie;te%ie!==0&&(te+=ie-te%ie),te+=q.loopAdditionalSlides,w.loopedSlides=te;const Z=w.grid&&q.grid&&q.grid.rows>1;j.length<Y+te?Gv("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):Z&&q.grid.fill==="row"&&Gv("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const se=[],pe=[];let ge=w.activeIndex;typeof E>"u"?E=w.getSlideIndex(j.filter(Me=>Me.classList.contains(q.slideActiveClass))[0]):ge=E;const je=u==="next"||!u,Ye=u==="prev"||!u;let fe=0,we=0;const Le=Z?Math.ceil(j.length/q.grid.rows):j.length,tt=(Z?j[E].column:E)+(K&&typeof _>"u"?-Y/2+.5:0);if(tt<te){fe=Math.max(te-tt,ie);for(let Me=0;Me<te-tt;Me+=1){const Ze=Me-Math.floor(Me/Le)*Le;if(Z){const rt=Le-Ze-1;for(let Qt=j.length-1;Qt>=0;Qt-=1)j[Qt].column===rt&&se.push(Qt)}else se.push(Le-Ze-1)}}else if(tt+Y>Le-te){we=Math.max(tt-(Le-te*2),ie);for(let Me=0;Me<we;Me+=1){const Ze=Me-Math.floor(Me/Le)*Le;Z?j.forEach((rt,Qt)=>{rt.column===Ze&&pe.push(Qt)}):pe.push(Ze)}}if(w.__preventObserver__=!0,requestAnimationFrame(()=>{w.__preventObserver__=!1}),Ye&&se.forEach(Me=>{j[Me].swiperLoopMoveDOM=!0,G.prepend(j[Me]),j[Me].swiperLoopMoveDOM=!1}),je&&pe.forEach(Me=>{j[Me].swiperLoopMoveDOM=!0,G.append(j[Me]),j[Me].swiperLoopMoveDOM=!1}),w.recalcSlides(),q.slidesPerView==="auto"?w.updateSlides():Z&&(se.length>0&&Ye||pe.length>0&&je)&&w.slides.forEach((Me,Ze)=>{w.grid.updateSlide(Ze,Me,w.slides)}),q.watchSlidesProgress&&w.updateSlidesOffset(),l){if(se.length>0&&Ye){if(typeof r>"u"){const Me=w.slidesGrid[ge],rt=w.slidesGrid[ge+fe]-Me;R?w.setTranslate(w.translate-rt):(w.slideTo(ge+Math.ceil(fe),0,!1,!0),_&&(w.touchEventsData.startTranslate=w.touchEventsData.startTranslate-rt,w.touchEventsData.currentTranslate=w.touchEventsData.currentTranslate-rt))}else if(_){const Me=Z?se.length/q.grid.rows:se.length;w.slideTo(w.activeIndex+Me,0,!1,!0),w.touchEventsData.currentTranslate=w.translate}}else if(pe.length>0&&je)if(typeof r>"u"){const Me=w.slidesGrid[ge],rt=w.slidesGrid[ge-we]-Me;R?w.setTranslate(w.translate-rt):(w.slideTo(ge-we,0,!1,!0),_&&(w.touchEventsData.startTranslate=w.touchEventsData.startTranslate-rt,w.touchEventsData.currentTranslate=w.touchEventsData.currentTranslate-rt))}else{const Me=Z?pe.length/q.grid.rows:pe.length;w.slideTo(w.activeIndex-Me,0,!1,!0)}}if(w.allowSlidePrev=P,w.allowSlideNext=U,w.controller&&w.controller.control&&!T){const Me={slideRealIndex:r,direction:u,setTranslate:_,activeSlideIndex:E,byController:!0};Array.isArray(w.controller.control)?w.controller.control.forEach(Ze=>{!Ze.destroyed&&Ze.params.loop&&Ze.loopFix({...Me,slideTo:Ze.params.slidesPerView===q.slidesPerView?l:!1})}):w.controller.control instanceof w.constructor&&w.controller.control.params.loop&&w.controller.control.loopFix({...Me,slideTo:w.controller.control.params.slidesPerView===q.slidesPerView?l:!1})}w.emit("loopFix")}function dX(){const a=this,{params:r,slidesEl:l}=a;if(!r.loop||a.virtual&&a.params.virtual.enabled)return;a.recalcSlides();const u=[];a.slides.forEach(_=>{const E=typeof _.swiperSlideIndex>"u"?_.getAttribute("data-swiper-slide-index")*1:_.swiperSlideIndex;u[E]=_}),a.slides.forEach(_=>{_.removeAttribute("data-swiper-slide-index")}),u.forEach(_=>{l.append(_)}),a.recalcSlides(),a.slideTo(a.realIndex,0)}var uX={loopCreate:cX,loopFix:lX,loopDestroy:dX};function hX(a){const r=this;if(!r.params.simulateTouch||r.params.watchOverflow&&r.isLocked||r.params.cssMode)return;const l=r.params.touchEventsTarget==="container"?r.el:r.wrapperEl;r.isElement&&(r.__preventObserver__=!0),l.style.cursor="move",l.style.cursor=a?"grabbing":"grab",r.isElement&&requestAnimationFrame(()=>{r.__preventObserver__=!1})}function pX(){const a=this;a.params.watchOverflow&&a.isLocked||a.params.cssMode||(a.isElement&&(a.__preventObserver__=!0),a[a.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",a.isElement&&requestAnimationFrame(()=>{a.__preventObserver__=!1}))}var fX={setGrabCursor:hX,unsetGrabCursor:pX};function mX(a,r){r===void 0&&(r=this);function l(u){if(!u||u===$a()||u===gr())return null;u.assignedSlot&&(u=u.assignedSlot);const _=u.closest(a);return!_&&!u.getRootNode?null:_||l(u.getRootNode().host)}return l(r)}function PV(a,r,l){const u=gr(),{params:_}=a,E=_.edgeSwipeDetection,T=_.edgeSwipeThreshold;return E&&(l<=T||l>=u.innerWidth-T)?E==="prevent"?(r.preventDefault(),!0):!1:!0}function _X(a){const r=this,l=$a();let u=a;u.originalEvent&&(u=u.originalEvent);const _=r.touchEventsData;if(u.type==="pointerdown"){if(_.pointerId!==null&&_.pointerId!==u.pointerId)return;_.pointerId=u.pointerId}else u.type==="touchstart"&&u.targetTouches.length===1&&(_.touchId=u.targetTouches[0].identifier);if(u.type==="touchstart"){PV(r,u,u.targetTouches[0].pageX);return}const{params:E,touches:T,enabled:R}=r;if(!R||!E.simulateTouch&&u.pointerType==="mouse"||r.animating&&E.preventInteractionOnTransition)return;!r.animating&&E.cssMode&&E.loop&&r.loopFix();let w=u.target;if(E.touchEventsTarget==="wrapper"&&!bJ(w,r.wrapperEl)||"which"in u&&u.which===3||"button"in u&&u.button>0||_.isTouched&&_.isMoved)return;const j=!!E.noSwipingClass&&E.noSwipingClass!=="",P=u.composedPath?u.composedPath():u.path;j&&u.target&&u.target.shadowRoot&&P&&(w=P[0]);const U=E.noSwipingSelector?E.noSwipingSelector:`.${E.noSwipingClass}`,G=!!(u.target&&u.target.shadowRoot);if(E.noSwiping&&(G?mX(U,w):w.closest(U))){r.allowClick=!0;return}if(E.swipeHandler&&!w.closest(E.swipeHandler))return;T.currentX=u.pageX,T.currentY=u.pageY;const q=T.currentX,K=T.currentY;if(!PV(r,u,q))return;Object.assign(_,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),T.startX=q,T.startY=K,_.touchStartTime=Bv(),r.allowClick=!0,r.updateSize(),r.swipeDirection=void 0,E.threshold>0&&(_.allowThresholdMove=!1);let Y=!0;w.matches(_.focusableElements)&&(Y=!1,w.nodeName==="SELECT"&&(_.isTouched=!1)),l.activeElement&&l.activeElement.matches(_.focusableElements)&&l.activeElement!==w&&(u.pointerType==="mouse"||u.pointerType!=="mouse"&&!w.matches(_.focusableElements))&&l.activeElement.blur();const ie=Y&&r.allowTouchMove&&E.touchStartPreventDefault;(E.touchStartForcePreventDefault||ie)&&!w.isContentEditable&&u.preventDefault(),E.freeMode&&E.freeMode.enabled&&r.freeMode&&r.animating&&!E.cssMode&&r.freeMode.onTouchStart(),r.emit("touchStart",u)}function EX(a){const r=$a(),l=this,u=l.touchEventsData,{params:_,touches:E,rtlTranslate:T,enabled:R}=l;if(!R||!_.simulateTouch&&a.pointerType==="mouse")return;let w=a;if(w.originalEvent&&(w=w.originalEvent),w.type==="pointermove"&&(u.touchId!==null||w.pointerId!==u.pointerId))return;let j;if(w.type==="touchmove"){if(j=[...w.changedTouches].filter(je=>je.identifier===u.touchId)[0],!j||j.identifier!==u.touchId)return}else j=w;if(!u.isTouched){u.startMoving&&u.isScrolling&&l.emit("touchMoveOpposite",w);return}const P=j.pageX,U=j.pageY;if(w.preventedByNestedSwiper){E.startX=P,E.startY=U;return}if(!l.allowTouchMove){w.target.matches(u.focusableElements)||(l.allowClick=!1),u.isTouched&&(Object.assign(E,{startX:P,startY:U,currentX:P,currentY:U}),u.touchStartTime=Bv());return}if(_.touchReleaseOnEdges&&!_.loop){if(l.isVertical()){if(U<E.startY&&l.translate<=l.maxTranslate()||U>E.startY&&l.translate>=l.minTranslate()){u.isTouched=!1,u.isMoved=!1;return}}else if(P<E.startX&&l.translate<=l.maxTranslate()||P>E.startX&&l.translate>=l.minTranslate())return}if(r.activeElement&&r.activeElement.matches(u.focusableElements)&&r.activeElement!==w.target&&w.pointerType!=="mouse"&&r.activeElement.blur(),r.activeElement&&w.target===r.activeElement&&w.target.matches(u.focusableElements)){u.isMoved=!0,l.allowClick=!1;return}u.allowTouchCallbacks&&l.emit("touchMove",w),E.previousX=E.currentX,E.previousY=E.currentY,E.currentX=P,E.currentY=U;const G=E.currentX-E.startX,q=E.currentY-E.startY;if(l.params.threshold&&Math.sqrt(G**2+q**2)<l.params.threshold)return;if(typeof u.isScrolling>"u"){let je;l.isHorizontal()&&E.currentY===E.startY||l.isVertical()&&E.currentX===E.startX?u.isScrolling=!1:G*G+q*q>=25&&(je=Math.atan2(Math.abs(q),Math.abs(G))*180/Math.PI,u.isScrolling=l.isHorizontal()?je>_.touchAngle:90-je>_.touchAngle)}if(u.isScrolling&&l.emit("touchMoveOpposite",w),typeof u.startMoving>"u"&&(E.currentX!==E.startX||E.currentY!==E.startY)&&(u.startMoving=!0),u.isScrolling||w.type==="touchmove"&&u.preventTouchMoveFromPointerMove){u.isTouched=!1;return}if(!u.startMoving)return;l.allowClick=!1,!_.cssMode&&w.cancelable&&w.preventDefault(),_.touchMoveStopPropagation&&!_.nested&&w.stopPropagation();let K=l.isHorizontal()?G:q,Y=l.isHorizontal()?E.currentX-E.previousX:E.currentY-E.previousY;_.oneWayMovement&&(K=Math.abs(K)*(T?1:-1),Y=Math.abs(Y)*(T?1:-1)),E.diff=K,K*=_.touchRatio,T&&(K=-K,Y=-Y);const ie=l.touchesDirection;l.swipeDirection=K>0?"prev":"next",l.touchesDirection=Y>0?"prev":"next";const te=l.params.loop&&!_.cssMode,Z=l.touchesDirection==="next"&&l.allowSlideNext||l.touchesDirection==="prev"&&l.allowSlidePrev;if(!u.isMoved){if(te&&Z&&l.loopFix({direction:l.swipeDirection}),u.startTranslate=l.getTranslate(),l.setTransition(0),l.animating){const je=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});l.wrapperEl.dispatchEvent(je)}u.allowMomentumBounce=!1,_.grabCursor&&(l.allowSlideNext===!0||l.allowSlidePrev===!0)&&l.setGrabCursor(!0),l.emit("sliderFirstMove",w)}let se;if(new Date().getTime(),u.isMoved&&u.allowThresholdMove&&ie!==l.touchesDirection&&te&&Z&&Math.abs(K)>=1){Object.assign(E,{startX:P,startY:U,currentX:P,currentY:U,startTranslate:u.currentTranslate}),u.loopSwapReset=!0,u.startTranslate=u.currentTranslate;return}l.emit("sliderMove",w),u.isMoved=!0,u.currentTranslate=K+u.startTranslate;let pe=!0,ge=_.resistanceRatio;if(_.touchReleaseOnEdges&&(ge=0),K>0?(te&&Z&&!se&&u.allowThresholdMove&&u.currentTranslate>(_.centeredSlides?l.minTranslate()-l.slidesSizesGrid[l.activeIndex+1]-(_.slidesPerView!=="auto"&&l.slides.length-_.slidesPerView>=2?l.slidesSizesGrid[l.activeIndex+1]+l.params.spaceBetween:0)-l.params.spaceBetween:l.minTranslate())&&l.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),u.currentTranslate>l.minTranslate()&&(pe=!1,_.resistance&&(u.currentTranslate=l.minTranslate()-1+(-l.minTranslate()+u.startTranslate+K)**ge))):K<0&&(te&&Z&&!se&&u.allowThresholdMove&&u.currentTranslate<(_.centeredSlides?l.maxTranslate()+l.slidesSizesGrid[l.slidesSizesGrid.length-1]+l.params.spaceBetween+(_.slidesPerView!=="auto"&&l.slides.length-_.slidesPerView>=2?l.slidesSizesGrid[l.slidesSizesGrid.length-1]+l.params.spaceBetween:0):l.maxTranslate())&&l.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:l.slides.length-(_.slidesPerView==="auto"?l.slidesPerViewDynamic():Math.ceil(parseFloat(_.slidesPerView,10)))}),u.currentTranslate<l.maxTranslate()&&(pe=!1,_.resistance&&(u.currentTranslate=l.maxTranslate()+1-(l.maxTranslate()-u.startTranslate-K)**ge))),pe&&(w.preventedByNestedSwiper=!0),!l.allowSlideNext&&l.swipeDirection==="next"&&u.currentTranslate<u.startTranslate&&(u.currentTranslate=u.startTranslate),!l.allowSlidePrev&&l.swipeDirection==="prev"&&u.currentTranslate>u.startTranslate&&(u.currentTranslate=u.startTranslate),!l.allowSlidePrev&&!l.allowSlideNext&&(u.currentTranslate=u.startTranslate),_.threshold>0)if(Math.abs(K)>_.threshold||u.allowThresholdMove){if(!u.allowThresholdMove){u.allowThresholdMove=!0,E.startX=E.currentX,E.startY=E.currentY,u.currentTranslate=u.startTranslate,E.diff=l.isHorizontal()?E.currentX-E.startX:E.currentY-E.startY;return}}else{u.currentTranslate=u.startTranslate;return}!_.followFinger||_.cssMode||((_.freeMode&&_.freeMode.enabled&&l.freeMode||_.watchSlidesProgress)&&(l.updateActiveIndex(),l.updateSlidesClasses()),_.freeMode&&_.freeMode.enabled&&l.freeMode&&l.freeMode.onTouchMove(),l.updateProgress(u.currentTranslate),l.setTranslate(u.currentTranslate))}function gX(a){const r=this,l=r.touchEventsData;let u=a;u.originalEvent&&(u=u.originalEvent);let _;if(u.type==="touchend"||u.type==="touchcancel"){if(_=[...u.changedTouches].filter(ge=>ge.identifier===l.touchId)[0],!_||_.identifier!==l.touchId)return}else{if(l.touchId!==null||u.pointerId!==l.pointerId)return;_=u}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(u.type)&&!(["pointercancel","contextmenu"].includes(u.type)&&(r.browser.isSafari||r.browser.isWebView)))return;l.pointerId=null,l.touchId=null;const{params:T,touches:R,rtlTranslate:w,slidesGrid:j,enabled:P}=r;if(!P||!T.simulateTouch&&u.pointerType==="mouse")return;if(l.allowTouchCallbacks&&r.emit("touchEnd",u),l.allowTouchCallbacks=!1,!l.isTouched){l.isMoved&&T.grabCursor&&r.setGrabCursor(!1),l.isMoved=!1,l.startMoving=!1;return}T.grabCursor&&l.isMoved&&l.isTouched&&(r.allowSlideNext===!0||r.allowSlidePrev===!0)&&r.setGrabCursor(!1);const U=Bv(),G=U-l.touchStartTime;if(r.allowClick){const ge=u.path||u.composedPath&&u.composedPath();r.updateClickedSlide(ge&&ge[0]||u.target,ge),r.emit("tap click",u),G<300&&U-l.lastClickTime<300&&r.emit("doubleTap doubleClick",u)}if(l.lastClickTime=Bv(),NA(()=>{r.destroyed||(r.allowClick=!0)}),!l.isTouched||!l.isMoved||!r.swipeDirection||R.diff===0&&!l.loopSwapReset||l.currentTranslate===l.startTranslate&&!l.loopSwapReset){l.isTouched=!1,l.isMoved=!1,l.startMoving=!1;return}l.isTouched=!1,l.isMoved=!1,l.startMoving=!1;let q;if(T.followFinger?q=w?r.translate:-r.translate:q=-l.currentTranslate,T.cssMode)return;if(T.freeMode&&T.freeMode.enabled){r.freeMode.onTouchEnd({currentPos:q});return}const K=q>=-r.maxTranslate()&&!r.params.loop;let Y=0,ie=r.slidesSizesGrid[0];for(let ge=0;ge<j.length;ge+=ge<T.slidesPerGroupSkip?1:T.slidesPerGroup){const je=ge<T.slidesPerGroupSkip-1?1:T.slidesPerGroup;typeof j[ge+je]<"u"?(K||q>=j[ge]&&q<j[ge+je])&&(Y=ge,ie=j[ge+je]-j[ge]):(K||q>=j[ge])&&(Y=ge,ie=j[j.length-1]-j[j.length-2])}let te=null,Z=null;T.rewind&&(r.isBeginning?Z=T.virtual&&T.virtual.enabled&&r.virtual?r.virtual.slides.length-1:r.slides.length-1:r.isEnd&&(te=0));const se=(q-j[Y])/ie,pe=Y<T.slidesPerGroupSkip-1?1:T.slidesPerGroup;if(G>T.longSwipesMs){if(!T.longSwipes){r.slideTo(r.activeIndex);return}r.swipeDirection==="next"&&(se>=T.longSwipesRatio?r.slideTo(T.rewind&&r.isEnd?te:Y+pe):r.slideTo(Y)),r.swipeDirection==="prev"&&(se>1-T.longSwipesRatio?r.slideTo(Y+pe):Z!==null&&se<0&&Math.abs(se)>T.longSwipesRatio?r.slideTo(Z):r.slideTo(Y))}else{if(!T.shortSwipes){r.slideTo(r.activeIndex);return}r.navigation&&(u.target===r.navigation.nextEl||u.target===r.navigation.prevEl)?u.target===r.navigation.nextEl?r.slideTo(Y+pe):r.slideTo(Y):(r.swipeDirection==="next"&&r.slideTo(te!==null?te:Y+pe),r.swipeDirection==="prev"&&r.slideTo(Z!==null?Z:Y))}}function LV(){const a=this,{params:r,el:l}=a;if(l&&l.offsetWidth===0)return;r.breakpoints&&a.setBreakpoint();const{allowSlideNext:u,allowSlidePrev:_,snapGrid:E}=a,T=a.virtual&&a.params.virtual.enabled;a.allowSlideNext=!0,a.allowSlidePrev=!0,a.updateSize(),a.updateSlides(),a.updateSlidesClasses();const R=T&&r.loop;(r.slidesPerView==="auto"||r.slidesPerView>1)&&a.isEnd&&!a.isBeginning&&!a.params.centeredSlides&&!R?a.slideTo(a.slides.length-1,0,!1,!0):a.params.loop&&!T?a.slideToLoop(a.realIndex,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0),a.autoplay&&a.autoplay.running&&a.autoplay.paused&&(clearTimeout(a.autoplay.resizeTimeout),a.autoplay.resizeTimeout=setTimeout(()=>{a.autoplay&&a.autoplay.running&&a.autoplay.paused&&a.autoplay.resume()},500)),a.allowSlidePrev=_,a.allowSlideNext=u,a.params.watchOverflow&&E!==a.snapGrid&&a.checkOverflow()}function vX(a){const r=this;r.enabled&&(r.allowClick||(r.params.preventClicks&&a.preventDefault(),r.params.preventClicksPropagation&&r.animating&&(a.stopPropagation(),a.stopImmediatePropagation())))}function SX(){const a=this,{wrapperEl:r,rtlTranslate:l,enabled:u}=a;if(!u)return;a.previousTranslate=a.translate,a.isHorizontal()?a.translate=-r.scrollLeft:a.translate=-r.scrollTop,a.translate===0&&(a.translate=0),a.updateActiveIndex(),a.updateSlidesClasses();let _;const E=a.maxTranslate()-a.minTranslate();E===0?_=0:_=(a.translate-a.minTranslate())/E,_!==a.progress&&a.updateProgress(l?-a.translate:a.translate),a.emit("setTranslate",a.translate,!1)}function TX(a){const r=this;Iv(r,a.target),!(r.params.cssMode||r.params.slidesPerView!=="auto"&&!r.params.autoHeight)&&r.update()}function yX(){const a=this;a.documentTouchHandlerProceeded||(a.documentTouchHandlerProceeded=!0,a.params.touchReleaseOnEdges&&(a.el.style.touchAction="auto"))}const dB=(a,r)=>{const l=$a(),{params:u,el:_,wrapperEl:E,device:T}=a,R=!!u.nested,w=r==="on"?"addEventListener":"removeEventListener",j=r;!_||typeof _=="string"||(l[w]("touchstart",a.onDocumentTouchStart,{passive:!1,capture:R}),_[w]("touchstart",a.onTouchStart,{passive:!1}),_[w]("pointerdown",a.onTouchStart,{passive:!1}),l[w]("touchmove",a.onTouchMove,{passive:!1,capture:R}),l[w]("pointermove",a.onTouchMove,{passive:!1,capture:R}),l[w]("touchend",a.onTouchEnd,{passive:!0}),l[w]("pointerup",a.onTouchEnd,{passive:!0}),l[w]("pointercancel",a.onTouchEnd,{passive:!0}),l[w]("touchcancel",a.onTouchEnd,{passive:!0}),l[w]("pointerout",a.onTouchEnd,{passive:!0}),l[w]("pointerleave",a.onTouchEnd,{passive:!0}),l[w]("contextmenu",a.onTouchEnd,{passive:!0}),(u.preventClicks||u.preventClicksPropagation)&&_[w]("click",a.onClick,!0),u.cssMode&&E[w]("scroll",a.onScroll),u.updateOnWindowResize?a[j](T.ios||T.android?"resize orientationchange observerUpdate":"resize observerUpdate",LV,!0):a[j]("observerUpdate",LV,!0),_[w]("load",a.onLoad,{capture:!0}))};function bX(){const a=this,{params:r}=a;a.onTouchStart=_X.bind(a),a.onTouchMove=EX.bind(a),a.onTouchEnd=gX.bind(a),a.onDocumentTouchStart=yX.bind(a),r.cssMode&&(a.onScroll=SX.bind(a)),a.onClick=vX.bind(a),a.onLoad=TX.bind(a),dB(a,"on")}function CX(){dB(this,"off")}var RX={attachEvents:bX,detachEvents:CX};const xV=(a,r)=>a.grid&&r.grid&&r.grid.rows>1;function wX(){const a=this,{realIndex:r,initialized:l,params:u,el:_}=a,E=u.breakpoints;if(!E||E&&Object.keys(E).length===0)return;const T=a.getBreakpoint(E,a.params.breakpointsBase,a.el);if(!T||a.currentBreakpoint===T)return;const w=(T in E?E[T]:void 0)||a.originalParams,j=xV(a,u),P=xV(a,w),U=a.params.grabCursor,G=w.grabCursor,q=u.enabled;j&&!P?(_.classList.remove(`${u.containerModifierClass}grid`,`${u.containerModifierClass}grid-column`),a.emitContainerClasses()):!j&&P&&(_.classList.add(`${u.containerModifierClass}grid`),(w.grid.fill&&w.grid.fill==="column"||!w.grid.fill&&u.grid.fill==="column")&&_.classList.add(`${u.containerModifierClass}grid-column`),a.emitContainerClasses()),U&&!G?a.unsetGrabCursor():!U&&G&&a.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(se=>{if(typeof w[se]>"u")return;const pe=u[se]&&u[se].enabled,ge=w[se]&&w[se].enabled;pe&&!ge&&a[se].disable(),!pe&&ge&&a[se].enable()});const K=w.direction&&w.direction!==u.direction,Y=u.loop&&(w.slidesPerView!==u.slidesPerView||K),ie=u.loop;K&&l&&a.changeDirection(),mr(a.params,w);const te=a.params.enabled,Z=a.params.loop;Object.assign(a,{allowTouchMove:a.params.allowTouchMove,allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev}),q&&!te?a.disable():!q&&te&&a.enable(),a.currentBreakpoint=T,a.emit("_beforeBreakpoint",w),l&&(Y?(a.loopDestroy(),a.loopCreate(r),a.updateSlides()):!ie&&Z?(a.loopCreate(r),a.updateSlides()):ie&&!Z&&a.loopDestroy()),a.emit("breakpoint",w)}function AX(a,r,l){if(r===void 0&&(r="window"),!a||r==="container"&&!l)return;let u=!1;const _=gr(),E=r==="window"?_.innerHeight:l.clientHeight,T=Object.keys(a).map(R=>{if(typeof R=="string"&&R.indexOf("@")===0){const w=parseFloat(R.substr(1));return{value:E*w,point:R}}return{value:R,point:R}});T.sort((R,w)=>parseInt(R.value,10)-parseInt(w.value,10));for(let R=0;R<T.length;R+=1){const{point:w,value:j}=T[R];r==="window"?_.matchMedia(`(min-width: ${j}px)`).matches&&(u=w):j<=l.clientWidth&&(u=w)}return u||"max"}var IX={setBreakpoint:wX,getBreakpoint:AX};function OX(a,r){const l=[];return a.forEach(u=>{typeof u=="object"?Object.keys(u).forEach(_=>{u[_]&&l.push(r+_)}):typeof u=="string"&&l.push(r+u)}),l}function NX(){const a=this,{classNames:r,params:l,rtl:u,el:_,device:E}=a,T=OX(["initialized",l.direction,{"free-mode":a.params.freeMode&&l.freeMode.enabled},{autoheight:l.autoHeight},{rtl:u},{grid:l.grid&&l.grid.rows>1},{"grid-column":l.grid&&l.grid.rows>1&&l.grid.fill==="column"},{android:E.android},{ios:E.ios},{"css-mode":l.cssMode},{centered:l.cssMode&&l.centeredSlides},{"watch-progress":l.watchSlidesProgress}],l.containerModifierClass);r.push(...T),_.classList.add(...r),a.emitContainerClasses()}function DX(){const a=this,{el:r,classNames:l}=a;!r||typeof r=="string"||(r.classList.remove(...l),a.emitContainerClasses())}var PX={addClasses:NX,removeClasses:DX};function LX(){const a=this,{isLocked:r,params:l}=a,{slidesOffsetBefore:u}=l;if(u){const _=a.slides.length-1,E=a.slidesGrid[_]+a.slidesSizesGrid[_]+u*2;a.isLocked=a.size>E}else a.isLocked=a.snapGrid.length===1;l.allowSlideNext===!0&&(a.allowSlideNext=!a.isLocked),l.allowSlidePrev===!0&&(a.allowSlidePrev=!a.isLocked),r&&r!==a.isLocked&&(a.isEnd=!1),r!==a.isLocked&&a.emit(a.isLocked?"lock":"unlock")}var xX={checkOverflow:LX},LA={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function kX(a,r){return function(u){u===void 0&&(u={});const _=Object.keys(u)[0],E=u[_];if(typeof E!="object"||E===null){mr(r,u);return}if(a[_]===!0&&(a[_]={enabled:!0}),_==="navigation"&&a[_]&&a[_].enabled&&!a[_].prevEl&&!a[_].nextEl&&(a[_].auto=!0),["pagination","scrollbar"].indexOf(_)>=0&&a[_]&&a[_].enabled&&!a[_].el&&(a[_].auto=!0),!(_ in a&&"enabled"in E)){mr(r,u);return}typeof a[_]=="object"&&!("enabled"in a[_])&&(a[_].enabled=!0),a[_]||(a[_]={enabled:!1}),mr(r,u)}}const dA={eventsEmitter:PJ,update:HJ,translate:$J,transition:ZJ,slide:aX,loop:uX,grabCursor:fX,events:RX,breakpoints:IX,checkOverflow:xX,classes:PX},uA={};let oI=class qa{constructor(){let r,l;for(var u=arguments.length,_=new Array(u),E=0;E<u;E++)_[E]=arguments[E];_.length===1&&_[0].constructor&&Object.prototype.toString.call(_[0]).slice(8,-1)==="Object"?l=_[0]:[r,l]=_,l||(l={}),l=mr({},l),r&&!l.el&&(l.el=r);const T=$a();if(l.el&&typeof l.el=="string"&&T.querySelectorAll(l.el).length>1){const P=[];return T.querySelectorAll(l.el).forEach(U=>{const G=mr({},l,{el:U});P.push(new qa(G))}),P}const R=this;R.__swiper__=!0,R.support=aB(),R.device=cB({userAgent:l.userAgent}),R.browser=OJ(),R.eventsListeners={},R.eventsAnyListeners=[],R.modules=[...R.__modules__],l.modules&&Array.isArray(l.modules)&&R.modules.push(...l.modules);const w={};R.modules.forEach(P=>{P({params:l,swiper:R,extendParams:kX(l,w),on:R.on.bind(R),once:R.once.bind(R),off:R.off.bind(R),emit:R.emit.bind(R)})});const j=mr({},LA,w);return R.params=mr({},j,uA,l),R.originalParams=mr({},R.params),R.passedParams=mr({},l),R.params&&R.params.on&&Object.keys(R.params.on).forEach(P=>{R.on(P,R.params.on[P])}),R.params&&R.params.onAny&&R.onAny(R.params.onAny),Object.assign(R,{enabled:R.params.enabled,el:r,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return R.params.direction==="horizontal"},isVertical(){return R.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:R.params.allowSlideNext,allowSlidePrev:R.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:R.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:R.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),R.emit("_swiper"),R.params.init&&R.init(),R}getDirectionLabel(r){return this.isHorizontal()?r:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[r]}getSlideIndex(r){const{slidesEl:l,params:u}=this,_=aa(l,`.${u.slideClass}, swiper-slide`),E=Wv(_[0]);return Wv(r)-E}getSlideIndexByData(r){return this.getSlideIndex(this.slides.filter(l=>l.getAttribute("data-swiper-slide-index")*1===r)[0])}recalcSlides(){const r=this,{slidesEl:l,params:u}=r;r.slides=aa(l,`.${u.slideClass}, swiper-slide`)}enable(){const r=this;r.enabled||(r.enabled=!0,r.params.grabCursor&&r.setGrabCursor(),r.emit("enable"))}disable(){const r=this;r.enabled&&(r.enabled=!1,r.params.grabCursor&&r.unsetGrabCursor(),r.emit("disable"))}setProgress(r,l){const u=this;r=Math.min(Math.max(r,0),1);const _=u.minTranslate(),T=(u.maxTranslate()-_)*r+_;u.translateTo(T,typeof l>"u"?0:l),u.updateActiveIndex(),u.updateSlidesClasses()}emitContainerClasses(){const r=this;if(!r.params._emitClasses||!r.el)return;const l=r.el.className.split(" ").filter(u=>u.indexOf("swiper")===0||u.indexOf(r.params.containerModifierClass)===0);r.emit("_containerClasses",l.join(" "))}getSlideClasses(r){const l=this;return l.destroyed?"":r.className.split(" ").filter(u=>u.indexOf("swiper-slide")===0||u.indexOf(l.params.slideClass)===0).join(" ")}emitSlidesClasses(){const r=this;if(!r.params._emitClasses||!r.el)return;const l=[];r.slides.forEach(u=>{const _=r.getSlideClasses(u);l.push({slideEl:u,classNames:_}),r.emit("_slideClass",u,_)}),r.emit("_slideClasses",l)}slidesPerViewDynamic(r,l){r===void 0&&(r="current"),l===void 0&&(l=!1);const u=this,{params:_,slides:E,slidesGrid:T,slidesSizesGrid:R,size:w,activeIndex:j}=u;let P=1;if(typeof _.slidesPerView=="number")return _.slidesPerView;if(_.centeredSlides){let U=E[j]?Math.ceil(E[j].swiperSlideSize):0,G;for(let q=j+1;q<E.length;q+=1)E[q]&&!G&&(U+=Math.ceil(E[q].swiperSlideSize),P+=1,U>w&&(G=!0));for(let q=j-1;q>=0;q-=1)E[q]&&!G&&(U+=E[q].swiperSlideSize,P+=1,U>w&&(G=!0))}else if(r==="current")for(let U=j+1;U<E.length;U+=1)(l?T[U]+R[U]-T[j]<w:T[U]-T[j]<w)&&(P+=1);else for(let U=j-1;U>=0;U-=1)T[j]-T[U]<w&&(P+=1);return P}update(){const r=this;if(!r||r.destroyed)return;const{snapGrid:l,params:u}=r;u.breakpoints&&r.setBreakpoint(),[...r.el.querySelectorAll('[loading="lazy"]')].forEach(T=>{T.complete&&Iv(r,T)}),r.updateSize(),r.updateSlides(),r.updateProgress(),r.updateSlidesClasses();function _(){const T=r.rtlTranslate?r.translate*-1:r.translate,R=Math.min(Math.max(T,r.maxTranslate()),r.minTranslate());r.setTranslate(R),r.updateActiveIndex(),r.updateSlidesClasses()}let E;if(u.freeMode&&u.freeMode.enabled&&!u.cssMode)_(),u.autoHeight&&r.updateAutoHeight();else{if((u.slidesPerView==="auto"||u.slidesPerView>1)&&r.isEnd&&!u.centeredSlides){const T=r.virtual&&u.virtual.enabled?r.virtual.slides:r.slides;E=r.slideTo(T.length-1,0,!1,!0)}else E=r.slideTo(r.activeIndex,0,!1,!0);E||_()}u.watchOverflow&&l!==r.snapGrid&&r.checkOverflow(),r.emit("update")}changeDirection(r,l){l===void 0&&(l=!0);const u=this,_=u.params.direction;return r||(r=_==="horizontal"?"vertical":"horizontal"),r===_||r!=="horizontal"&&r!=="vertical"||(u.el.classList.remove(`${u.params.containerModifierClass}${_}`),u.el.classList.add(`${u.params.containerModifierClass}${r}`),u.emitContainerClasses(),u.params.direction=r,u.slides.forEach(E=>{r==="vertical"?E.style.width="":E.style.height=""}),u.emit("changeDirection"),l&&u.update()),u}changeLanguageDirection(r){const l=this;l.rtl&&r==="rtl"||!l.rtl&&r==="ltr"||(l.rtl=r==="rtl",l.rtlTranslate=l.params.direction==="horizontal"&&l.rtl,l.rtl?(l.el.classList.add(`${l.params.containerModifierClass}rtl`),l.el.dir="rtl"):(l.el.classList.remove(`${l.params.containerModifierClass}rtl`),l.el.dir="ltr"),l.update())}mount(r){const l=this;if(l.mounted)return!0;let u=r||l.params.el;if(typeof u=="string"&&(u=document.querySelector(u)),!u)return!1;u.swiper=l,u.parentNode&&u.parentNode.host&&u.parentNode.host.nodeName===l.params.swiperElementNodeName.toUpperCase()&&(l.isElement=!0);const _=()=>`.${(l.params.wrapperClass||"").trim().split(" ").join(".")}`;let T=u&&u.shadowRoot&&u.shadowRoot.querySelector?u.shadowRoot.querySelector(_()):aa(u,_())[0];return!T&&l.params.createElements&&(T=Hv("div",l.params.wrapperClass),u.append(T),aa(u,`.${l.params.slideClass}`).forEach(R=>{T.append(R)})),Object.assign(l,{el:u,wrapperEl:T,slidesEl:l.isElement&&!u.parentNode.host.slideSlots?u.parentNode.host:T,hostEl:l.isElement?u.parentNode.host:u,mounted:!0,rtl:u.dir.toLowerCase()==="rtl"||tl(u,"direction")==="rtl",rtlTranslate:l.params.direction==="horizontal"&&(u.dir.toLowerCase()==="rtl"||tl(u,"direction")==="rtl"),wrongRTL:tl(T,"display")==="-webkit-box"}),!0}init(r){const l=this;if(l.initialized||l.mount(r)===!1)return l;l.emit("beforeInit"),l.params.breakpoints&&l.setBreakpoint(),l.addClasses(),l.updateSize(),l.updateSlides(),l.params.watchOverflow&&l.checkOverflow(),l.params.grabCursor&&l.enabled&&l.setGrabCursor(),l.params.loop&&l.virtual&&l.params.virtual.enabled?l.slideTo(l.params.initialSlide+l.virtual.slidesBefore,0,l.params.runCallbacksOnInit,!1,!0):l.slideTo(l.params.initialSlide,0,l.params.runCallbacksOnInit,!1,!0),l.params.loop&&l.loopCreate(),l.attachEvents();const _=[...l.el.querySelectorAll('[loading="lazy"]')];return l.isElement&&_.push(...l.hostEl.querySelectorAll('[loading="lazy"]')),_.forEach(E=>{E.complete?Iv(l,E):E.addEventListener("load",T=>{Iv(l,T.target)})}),PA(l),l.initialized=!0,PA(l),l.emit("init"),l.emit("afterInit"),l}destroy(r,l){r===void 0&&(r=!0),l===void 0&&(l=!0);const u=this,{params:_,el:E,wrapperEl:T,slides:R}=u;return typeof u.params>"u"||u.destroyed||(u.emit("beforeDestroy"),u.initialized=!1,u.detachEvents(),_.loop&&u.loopDestroy(),l&&(u.removeClasses(),E&&typeof E!="string"&&E.removeAttribute("style"),T&&T.removeAttribute("style"),R&&R.length&&R.forEach(w=>{w.classList.remove(_.slideVisibleClass,_.slideFullyVisibleClass,_.slideActiveClass,_.slideNextClass,_.slidePrevClass),w.removeAttribute("style"),w.removeAttribute("data-swiper-slide-index")})),u.emit("destroy"),Object.keys(u.eventsListeners).forEach(w=>{u.off(w)}),r!==!1&&(u.el&&typeof u.el!="string"&&(u.el.swiper=null),vJ(u)),u.destroyed=!0),null}static extendDefaults(r){mr(uA,r)}static get extendedDefaults(){return uA}static get defaults(){return LA}static installModule(r){qa.prototype.__modules__||(qa.prototype.__modules__=[]);const l=qa.prototype.__modules__;typeof r=="function"&&l.indexOf(r)<0&&l.push(r)}static use(r){return Array.isArray(r)?(r.forEach(l=>qa.installModule(l)),qa):(qa.installModule(r),qa)}};Object.keys(dA).forEach(a=>{Object.keys(dA[a]).forEach(r=>{oI.prototype[r]=dA[a][r]})});oI.use([NJ,DJ]);const uB=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function vd(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"&&!a.__swiper__}function yh(a,r){const l=["__proto__","constructor","prototype"];Object.keys(r).filter(u=>l.indexOf(u)<0).forEach(u=>{typeof a[u]>"u"?a[u]=r[u]:vd(r[u])&&vd(a[u])&&Object.keys(r[u]).length>0?r[u].__swiper__?a[u]=r[u]:yh(a[u],r[u]):a[u]=r[u]})}function hB(a){return a===void 0&&(a={}),a.navigation&&typeof a.navigation.nextEl>"u"&&typeof a.navigation.prevEl>"u"}function pB(a){return a===void 0&&(a={}),a.pagination&&typeof a.pagination.el>"u"}function fB(a){return a===void 0&&(a={}),a.scrollbar&&typeof a.scrollbar.el>"u"}function mB(a){a===void 0&&(a="");const r=a.split(" ").map(u=>u.trim()).filter(u=>!!u),l=[];return r.forEach(u=>{l.indexOf(u)<0&&l.push(u)}),l.join(" ")}function MX(a){return a===void 0&&(a=""),a?a.includes("swiper-wrapper")?a:`swiper-wrapper ${a}`:"swiper-wrapper"}function jX(a){let{swiper:r,slides:l,passedParams:u,changedParams:_,nextEl:E,prevEl:T,scrollbarEl:R,paginationEl:w}=a;const j=_.filter(we=>we!=="children"&&we!=="direction"&&we!=="wrapperClass"),{params:P,pagination:U,navigation:G,scrollbar:q,virtual:K,thumbs:Y}=r;let ie,te,Z,se,pe,ge,je,Ye;_.includes("thumbs")&&u.thumbs&&u.thumbs.swiper&&!u.thumbs.swiper.destroyed&&P.thumbs&&(!P.thumbs.swiper||P.thumbs.swiper.destroyed)&&(ie=!0),_.includes("controller")&&u.controller&&u.controller.control&&P.controller&&!P.controller.control&&(te=!0),_.includes("pagination")&&u.pagination&&(u.pagination.el||w)&&(P.pagination||P.pagination===!1)&&U&&!U.el&&(Z=!0),_.includes("scrollbar")&&u.scrollbar&&(u.scrollbar.el||R)&&(P.scrollbar||P.scrollbar===!1)&&q&&!q.el&&(se=!0),_.includes("navigation")&&u.navigation&&(u.navigation.prevEl||T)&&(u.navigation.nextEl||E)&&(P.navigation||P.navigation===!1)&&G&&!G.prevEl&&!G.nextEl&&(pe=!0);const fe=we=>{r[we]&&(r[we].destroy(),we==="navigation"?(r.isElement&&(r[we].prevEl.remove(),r[we].nextEl.remove()),P[we].prevEl=void 0,P[we].nextEl=void 0,r[we].prevEl=void 0,r[we].nextEl=void 0):(r.isElement&&r[we].el.remove(),P[we].el=void 0,r[we].el=void 0))};_.includes("loop")&&r.isElement&&(P.loop&&!u.loop?ge=!0:!P.loop&&u.loop?je=!0:Ye=!0),j.forEach(we=>{if(vd(P[we])&&vd(u[we]))Object.assign(P[we],u[we]),(we==="navigation"||we==="pagination"||we==="scrollbar")&&"enabled"in u[we]&&!u[we].enabled&&fe(we);else{const Le=u[we];(Le===!0||Le===!1)&&(we==="navigation"||we==="pagination"||we==="scrollbar")?Le===!1&&fe(we):P[we]=u[we]}}),j.includes("controller")&&!te&&r.controller&&r.controller.control&&P.controller&&P.controller.control&&(r.controller.control=P.controller.control),_.includes("children")&&l&&K&&P.virtual.enabled?(K.slides=l,K.update(!0)):_.includes("virtual")&&K&&P.virtual.enabled&&(l&&(K.slides=l),K.update(!0)),_.includes("children")&&l&&P.loop&&(Ye=!0),ie&&Y.init()&&Y.update(!0),te&&(r.controller.control=P.controller.control),Z&&(r.isElement&&(!w||typeof w=="string")&&(w=document.createElement("div"),w.classList.add("swiper-pagination"),w.part.add("pagination"),r.el.appendChild(w)),w&&(P.pagination.el=w),U.init(),U.render(),U.update()),se&&(r.isElement&&(!R||typeof R=="string")&&(R=document.createElement("div"),R.classList.add("swiper-scrollbar"),R.part.add("scrollbar"),r.el.appendChild(R)),R&&(P.scrollbar.el=R),q.init(),q.updateSize(),q.setTranslate()),pe&&(r.isElement&&((!E||typeof E=="string")&&(E=document.createElement("div"),E.classList.add("swiper-button-next"),E.innerHTML=r.hostEl.constructor.nextButtonSvg,E.part.add("button-next"),r.el.appendChild(E)),(!T||typeof T=="string")&&(T=document.createElement("div"),T.classList.add("swiper-button-prev"),T.innerHTML=r.hostEl.constructor.prevButtonSvg,T.part.add("button-prev"),r.el.appendChild(T))),E&&(P.navigation.nextEl=E),T&&(P.navigation.prevEl=T),G.init(),G.update()),_.includes("allowSlideNext")&&(r.allowSlideNext=u.allowSlideNext),_.includes("allowSlidePrev")&&(r.allowSlidePrev=u.allowSlidePrev),_.includes("direction")&&r.changeDirection(u.direction,!1),(ge||Ye)&&r.loopDestroy(),(je||Ye)&&r.loopCreate(),r.update()}function UX(a,r){a===void 0&&(a={}),r===void 0&&(r=!0);const l={on:{}},u={},_={};yh(l,LA),l._emitClasses=!0,l.init=!1;const E={},T=uB.map(w=>w.replace(/_/,"")),R=Object.assign({},a);return Object.keys(R).forEach(w=>{typeof a[w]>"u"||(T.indexOf(w)>=0?vd(a[w])?(l[w]={},_[w]={},yh(l[w],a[w]),yh(_[w],a[w])):(l[w]=a[w],_[w]=a[w]):w.search(/on[A-Z]/)===0&&typeof a[w]=="function"?r?u[`${w[2].toLowerCase()}${w.substr(3)}`]=a[w]:l.on[`${w[2].toLowerCase()}${w.substr(3)}`]=a[w]:E[w]=a[w])}),["navigation","pagination","scrollbar"].forEach(w=>{l[w]===!0&&(l[w]={}),l[w]===!1&&delete l[w]}),{params:l,passedParams:_,rest:E,events:u}}function VX(a,r){let{el:l,nextEl:u,prevEl:_,paginationEl:E,scrollbarEl:T,swiper:R}=a;hB(r)&&u&&_&&(R.params.navigation.nextEl=u,R.originalParams.navigation.nextEl=u,R.params.navigation.prevEl=_,R.originalParams.navigation.prevEl=_),pB(r)&&E&&(R.params.pagination.el=E,R.originalParams.pagination.el=E),fB(r)&&T&&(R.params.scrollbar.el=T,R.originalParams.scrollbar.el=T),R.init(l)}function FX(a,r,l,u,_){const E=[];if(!r)return E;const T=w=>{E.indexOf(w)<0&&E.push(w)};if(l&&u){const w=u.map(_),j=l.map(_);w.join("")!==j.join("")&&T("children"),u.length!==l.length&&T("children")}return uB.filter(w=>w[0]==="_").map(w=>w.replace(/_/,"")).forEach(w=>{if(w in a&&w in r)if(vd(a[w])&&vd(r[w])){const j=Object.keys(a[w]),P=Object.keys(r[w]);j.length!==P.length?T(w):(j.forEach(U=>{a[w][U]!==r[w][U]&&T(w)}),P.forEach(U=>{a[w][U]!==r[w][U]&&T(w)}))}else a[w]!==r[w]&&T(w)}),E}const BX=a=>{!a||a.destroyed||!a.params.virtual||a.params.virtual&&!a.params.virtual.enabled||(a.updateSlides(),a.updateProgress(),a.updateSlidesClasses(),a.parallax&&a.params.parallax&&a.params.parallax.enabled&&a.parallax.setTranslate())};function Kv(){return Kv=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])}return a},Kv.apply(this,arguments)}function _B(a){return a.type&&a.type.displayName&&a.type.displayName.includes("SwiperSlide")}function EB(a){const r=[];return Hn.Children.toArray(a).forEach(l=>{_B(l)?r.push(l):l.props&&l.props.children&&EB(l.props.children).forEach(u=>r.push(u))}),r}function GX(a){const r=[],l={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return Hn.Children.toArray(a).forEach(u=>{if(_B(u))r.push(u);else if(u.props&&u.props.slot&&l[u.props.slot])l[u.props.slot].push(u);else if(u.props&&u.props.children){const _=EB(u.props.children);_.length>0?_.forEach(E=>r.push(E)):l["container-end"].push(u)}else l["container-end"].push(u)}),{slides:r,slots:l}}function HX(a,r,l){if(!l)return null;const u=P=>{let U=P;return P<0?U=r.length+P:U>=r.length&&(U=U-r.length),U},_=a.isHorizontal()?{[a.rtlTranslate?"right":"left"]:`${l.offset}px`}:{top:`${l.offset}px`},{from:E,to:T}=l,R=a.params.loop?-r.length:0,w=a.params.loop?r.length*2:r.length,j=[];for(let P=R;P<w;P+=1)P>=E&&P<=T&&j.push(r[u(P)]);return j.map((P,U)=>Hn.cloneElement(P,{swiper:a,style:_,key:P.props.virtualIndex||P.key||`slide-${U}`}))}function rm(a,r){return typeof window>"u"?ee.useEffect(a,r):ee.useLayoutEffect(a,r)}const kV=ee.createContext(null),WX=ee.createContext(null),gB=ee.forwardRef(function(a,r){let{className:l,tag:u="div",wrapperTag:_="div",children:E,onSwiper:T,...R}=a===void 0?{}:a,w=!1;const[j,P]=ee.useState("swiper"),[U,G]=ee.useState(null),[q,K]=ee.useState(!1),Y=ee.useRef(!1),ie=ee.useRef(null),te=ee.useRef(null),Z=ee.useRef(null),se=ee.useRef(null),pe=ee.useRef(null),ge=ee.useRef(null),je=ee.useRef(null),Ye=ee.useRef(null),{params:fe,passedParams:we,rest:Le,events:Fe}=UX(R),{slides:tt,slots:Me}=GX(E),Ze=()=>{K(!q)};Object.assign(fe.on,{_containerClasses(Kt,Jt){P(Jt)}});const rt=()=>{Object.assign(fe.on,Fe),w=!0;const Kt={...fe};if(delete Kt.wrapperClass,te.current=new oI(Kt),te.current.virtual&&te.current.params.virtual.enabled){te.current.virtual.slides=tt;const Jt={cache:!1,slides:tt,renderExternal:G,renderExternalUpdate:!1};yh(te.current.params.virtual,Jt),yh(te.current.originalParams.virtual,Jt)}};ie.current||rt(),te.current&&te.current.on("_beforeBreakpoint",Ze);const Qt=()=>{w||!Fe||!te.current||Object.keys(Fe).forEach(Kt=>{te.current.on(Kt,Fe[Kt])})},rs=()=>{!Fe||!te.current||Object.keys(Fe).forEach(Kt=>{te.current.off(Kt,Fe[Kt])})};ee.useEffect(()=>()=>{te.current&&te.current.off("_beforeBreakpoint",Ze)}),ee.useEffect(()=>{!Y.current&&te.current&&(te.current.emitSlidesClasses(),Y.current=!0)}),rm(()=>{if(r&&(r.current=ie.current),!!ie.current)return te.current.destroyed&&rt(),VX({el:ie.current,nextEl:pe.current,prevEl:ge.current,paginationEl:je.current,scrollbarEl:Ye.current,swiper:te.current},fe),T&&!te.current.destroyed&&T(te.current),()=>{te.current&&!te.current.destroyed&&te.current.destroy(!0,!1)}},[]),rm(()=>{Qt();const Kt=FX(we,Z.current,tt,se.current,Jt=>Jt.key);return Z.current=we,se.current=tt,Kt.length&&te.current&&!te.current.destroyed&&jX({swiper:te.current,slides:tt,passedParams:we,changedParams:Kt,nextEl:pe.current,prevEl:ge.current,scrollbarEl:Ye.current,paginationEl:je.current}),()=>{rs()}}),rm(()=>{BX(te.current)},[U]);function We(){return fe.virtual?HX(te.current,tt,U):tt.map((Kt,Jt)=>Hn.cloneElement(Kt,{swiper:te.current,swiperSlideIndex:Jt}))}return Hn.createElement(u,Kv({ref:ie,className:mB(`${j}${l?` ${l}`:""}`)},Le),Hn.createElement(WX.Provider,{value:te.current},Me["container-start"],Hn.createElement(_,{className:MX(fe.wrapperClass)},Me["wrapper-start"],We(),Me["wrapper-end"]),hB(fe)&&Hn.createElement(Hn.Fragment,null,Hn.createElement("div",{ref:ge,className:"swiper-button-prev"}),Hn.createElement("div",{ref:pe,className:"swiper-button-next"})),fB(fe)&&Hn.createElement("div",{ref:Ye,className:"swiper-scrollbar"}),pB(fe)&&Hn.createElement("div",{ref:je,className:"swiper-pagination"}),Me["container-end"]))});gB.displayName="Swiper";const vB=ee.forwardRef(function(a,r){let{tag:l="div",children:u,className:_="",swiper:E,zoom:T,lazy:R,virtualIndex:w,swiperSlideIndex:j,...P}=a===void 0?{}:a;const U=ee.useRef(null),[G,q]=ee.useState("swiper-slide"),[K,Y]=ee.useState(!1);function ie(pe,ge,je){ge===U.current&&q(je)}rm(()=>{if(typeof j<"u"&&(U.current.swiperSlideIndex=j),r&&(r.current=U.current),!(!U.current||!E)){if(E.destroyed){G!=="swiper-slide"&&q("swiper-slide");return}return E.on("_slideClass",ie),()=>{E&&E.off("_slideClass",ie)}}}),rm(()=>{E&&U.current&&!E.destroyed&&q(E.getSlideClasses(U.current))},[E]);const te={isActive:G.indexOf("swiper-slide-active")>=0,isVisible:G.indexOf("swiper-slide-visible")>=0,isPrev:G.indexOf("swiper-slide-prev")>=0,isNext:G.indexOf("swiper-slide-next")>=0},Z=()=>typeof u=="function"?u(te):u,se=()=>{Y(!0)};return Hn.createElement(l,Kv({ref:U,className:mB(`${G}${_?` ${_}`:""}`),"data-swiper-slide-index":w,onLoad:se},P),T&&Hn.createElement(kV.Provider,{value:te},Hn.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof T=="number"?T:void 0},Z(),R&&!K&&Hn.createElement("div",{className:"swiper-lazy-preloader"}))),!T&&Hn.createElement(kV.Provider,{value:te},Z(),R&&!K&&Hn.createElement("div",{className:"swiper-lazy-preloader"})))});vB.displayName="SwiperSlide";function SB(a,r,l,u){return a.params.createElements&&Object.keys(u).forEach(_=>{if(!l[_]&&l.auto===!0){let E=aa(a.el,`.${u[_]}`)[0];E||(E=Hv("div",u[_]),E.className=u[_],a.el.append(E)),l[_]=E,r[_]=E}}),l}function KX(a){let{swiper:r,extendParams:l,on:u,emit:_}=a;l({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),r.navigation={nextEl:null,prevEl:null};function E(K){let Y;return K&&typeof K=="string"&&r.isElement&&(Y=r.el.querySelector(K)||r.hostEl.querySelector(K),Y)?Y:(K&&(typeof K=="string"&&(Y=[...document.querySelectorAll(K)]),r.params.uniqueNavElements&&typeof K=="string"&&Y&&Y.length>1&&r.el.querySelectorAll(K).length===1?Y=r.el.querySelector(K):Y&&Y.length===1&&(Y=Y[0])),K&&!Y?K:Y)}function T(K,Y){const ie=r.params.navigation;K=$i(K),K.forEach(te=>{te&&(te.classList[Y?"add":"remove"](...ie.disabledClass.split(" ")),te.tagName==="BUTTON"&&(te.disabled=Y),r.params.watchOverflow&&r.enabled&&te.classList[r.isLocked?"add":"remove"](ie.lockClass))})}function R(){const{nextEl:K,prevEl:Y}=r.navigation;if(r.params.loop){T(Y,!1),T(K,!1);return}T(Y,r.isBeginning&&!r.params.rewind),T(K,r.isEnd&&!r.params.rewind)}function w(K){K.preventDefault(),!(r.isBeginning&&!r.params.loop&&!r.params.rewind)&&(r.slidePrev(),_("navigationPrev"))}function j(K){K.preventDefault(),!(r.isEnd&&!r.params.loop&&!r.params.rewind)&&(r.slideNext(),_("navigationNext"))}function P(){const K=r.params.navigation;if(r.params.navigation=SB(r,r.originalParams.navigation,r.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(K.nextEl||K.prevEl))return;let Y=E(K.nextEl),ie=E(K.prevEl);Object.assign(r.navigation,{nextEl:Y,prevEl:ie}),Y=$i(Y),ie=$i(ie);const te=(Z,se)=>{Z&&Z.addEventListener("click",se==="next"?j:w),!r.enabled&&Z&&Z.classList.add(...K.lockClass.split(" "))};Y.forEach(Z=>te(Z,"next")),ie.forEach(Z=>te(Z,"prev"))}function U(){let{nextEl:K,prevEl:Y}=r.navigation;K=$i(K),Y=$i(Y);const ie=(te,Z)=>{te.removeEventListener("click",Z==="next"?j:w),te.classList.remove(...r.params.navigation.disabledClass.split(" "))};K.forEach(te=>ie(te,"next")),Y.forEach(te=>ie(te,"prev"))}u("init",()=>{r.params.navigation.enabled===!1?q():(P(),R())}),u("toEdge fromEdge lock unlock",()=>{R()}),u("destroy",()=>{U()}),u("enable disable",()=>{let{nextEl:K,prevEl:Y}=r.navigation;if(K=$i(K),Y=$i(Y),r.enabled){R();return}[...K,...Y].filter(ie=>!!ie).forEach(ie=>ie.classList.add(r.params.navigation.lockClass))}),u("click",(K,Y)=>{let{nextEl:ie,prevEl:te}=r.navigation;ie=$i(ie),te=$i(te);const Z=Y.target;let se=te.includes(Z)||ie.includes(Z);if(r.isElement&&!se){const pe=Y.path||Y.composedPath&&Y.composedPath();pe&&(se=pe.find(ge=>ie.includes(ge)||te.includes(ge)))}if(r.params.navigation.hideOnClick&&!se){if(r.pagination&&r.params.pagination&&r.params.pagination.clickable&&(r.pagination.el===Z||r.pagination.el.contains(Z)))return;let pe;ie.length?pe=ie[0].classList.contains(r.params.navigation.hiddenClass):te.length&&(pe=te[0].classList.contains(r.params.navigation.hiddenClass)),_(pe===!0?"navigationShow":"navigationHide"),[...ie,...te].filter(ge=>!!ge).forEach(ge=>ge.classList.toggle(r.params.navigation.hiddenClass))}});const G=()=>{r.el.classList.remove(...r.params.navigation.navigationDisabledClass.split(" ")),P(),R()},q=()=>{r.el.classList.add(...r.params.navigation.navigationDisabledClass.split(" ")),U()};Object.assign(r.navigation,{enable:G,disable:q,update:R,init:P,destroy:U})}function $f(a){return a===void 0&&(a=""),`.${a.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function zX(a){let{swiper:r,extendParams:l,on:u,emit:_}=a;const E="swiper-pagination";l({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:Z=>Z,formatFractionTotal:Z=>Z,bulletClass:`${E}-bullet`,bulletActiveClass:`${E}-bullet-active`,modifierClass:`${E}-`,currentClass:`${E}-current`,totalClass:`${E}-total`,hiddenClass:`${E}-hidden`,progressbarFillClass:`${E}-progressbar-fill`,progressbarOppositeClass:`${E}-progressbar-opposite`,clickableClass:`${E}-clickable`,lockClass:`${E}-lock`,horizontalClass:`${E}-horizontal`,verticalClass:`${E}-vertical`,paginationDisabledClass:`${E}-disabled`}}),r.pagination={el:null,bullets:[]};let T,R=0;function w(){return!r.params.pagination.el||!r.pagination.el||Array.isArray(r.pagination.el)&&r.pagination.el.length===0}function j(Z,se){const{bulletActiveClass:pe}=r.params.pagination;Z&&(Z=Z[`${se==="prev"?"previous":"next"}ElementSibling`],Z&&(Z.classList.add(`${pe}-${se}`),Z=Z[`${se==="prev"?"previous":"next"}ElementSibling`],Z&&Z.classList.add(`${pe}-${se}-${se}`)))}function P(Z,se,pe){if(Z=Z%pe,se=se%pe,se===Z+1)return"next";if(se===Z-1)return"previous"}function U(Z){const se=Z.target.closest($f(r.params.pagination.bulletClass));if(!se)return;Z.preventDefault();const pe=Wv(se)*r.params.slidesPerGroup;if(r.params.loop){if(r.realIndex===pe)return;const ge=P(r.realIndex,pe,r.slides.length);ge==="next"?r.slideNext():ge==="previous"?r.slidePrev():r.slideToLoop(pe)}else r.slideTo(pe)}function G(){const Z=r.rtl,se=r.params.pagination;if(w())return;let pe=r.pagination.el;pe=$i(pe);let ge,je;const Ye=r.virtual&&r.params.virtual.enabled?r.virtual.slides.length:r.slides.length,fe=r.params.loop?Math.ceil(Ye/r.params.slidesPerGroup):r.snapGrid.length;if(r.params.loop?(je=r.previousRealIndex||0,ge=r.params.slidesPerGroup>1?Math.floor(r.realIndex/r.params.slidesPerGroup):r.realIndex):typeof r.snapIndex<"u"?(ge=r.snapIndex,je=r.previousSnapIndex):(je=r.previousIndex||0,ge=r.activeIndex||0),se.type==="bullets"&&r.pagination.bullets&&r.pagination.bullets.length>0){const we=r.pagination.bullets;let Le,Fe,tt;if(se.dynamicBullets&&(T=DA(we[0],r.isHorizontal()?"width":"height"),pe.forEach(Me=>{Me.style[r.isHorizontal()?"width":"height"]=`${T*(se.dynamicMainBullets+4)}px`}),se.dynamicMainBullets>1&&je!==void 0&&(R+=ge-(je||0),R>se.dynamicMainBullets-1?R=se.dynamicMainBullets-1:R<0&&(R=0)),Le=Math.max(ge-R,0),Fe=Le+(Math.min(we.length,se.dynamicMainBullets)-1),tt=(Fe+Le)/2),we.forEach(Me=>{const Ze=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(rt=>`${se.bulletActiveClass}${rt}`)].map(rt=>typeof rt=="string"&&rt.includes(" ")?rt.split(" "):rt).flat();Me.classList.remove(...Ze)}),pe.length>1)we.forEach(Me=>{const Ze=Wv(Me);Ze===ge?Me.classList.add(...se.bulletActiveClass.split(" ")):r.isElement&&Me.setAttribute("part","bullet"),se.dynamicBullets&&(Ze>=Le&&Ze<=Fe&&Me.classList.add(...`${se.bulletActiveClass}-main`.split(" ")),Ze===Le&&j(Me,"prev"),Ze===Fe&&j(Me,"next"))});else{const Me=we[ge];if(Me&&Me.classList.add(...se.bulletActiveClass.split(" ")),r.isElement&&we.forEach((Ze,rt)=>{Ze.setAttribute("part",rt===ge?"bullet-active":"bullet")}),se.dynamicBullets){const Ze=we[Le],rt=we[Fe];for(let Qt=Le;Qt<=Fe;Qt+=1)we[Qt]&&we[Qt].classList.add(...`${se.bulletActiveClass}-main`.split(" "));j(Ze,"prev"),j(rt,"next")}}if(se.dynamicBullets){const Me=Math.min(we.length,se.dynamicMainBullets+4),Ze=(T*Me-T)/2-tt*T,rt=Z?"right":"left";we.forEach(Qt=>{Qt.style[r.isHorizontal()?rt:"top"]=`${Ze}px`})}}pe.forEach((we,Le)=>{if(se.type==="fraction"&&(we.querySelectorAll($f(se.currentClass)).forEach(Fe=>{Fe.textContent=se.formatFractionCurrent(ge+1)}),we.querySelectorAll($f(se.totalClass)).forEach(Fe=>{Fe.textContent=se.formatFractionTotal(fe)})),se.type==="progressbar"){let Fe;se.progressbarOpposite?Fe=r.isHorizontal()?"vertical":"horizontal":Fe=r.isHorizontal()?"horizontal":"vertical";const tt=(ge+1)/fe;let Me=1,Ze=1;Fe==="horizontal"?Me=tt:Ze=tt,we.querySelectorAll($f(se.progressbarFillClass)).forEach(rt=>{rt.style.transform=`translate3d(0,0,0) scaleX(${Me}) scaleY(${Ze})`,rt.style.transitionDuration=`${r.params.speed}ms`})}se.type==="custom"&&se.renderCustom?(we.innerHTML=se.renderCustom(r,ge+1,fe),Le===0&&_("paginationRender",we)):(Le===0&&_("paginationRender",we),_("paginationUpdate",we)),r.params.watchOverflow&&r.enabled&&we.classList[r.isLocked?"add":"remove"](se.lockClass)})}function q(){const Z=r.params.pagination;if(w())return;const se=r.virtual&&r.params.virtual.enabled?r.virtual.slides.length:r.grid&&r.params.grid.rows>1?r.slides.length/Math.ceil(r.params.grid.rows):r.slides.length;let pe=r.pagination.el;pe=$i(pe);let ge="";if(Z.type==="bullets"){let je=r.params.loop?Math.ceil(se/r.params.slidesPerGroup):r.snapGrid.length;r.params.freeMode&&r.params.freeMode.enabled&&je>se&&(je=se);for(let Ye=0;Ye<je;Ye+=1)Z.renderBullet?ge+=Z.renderBullet.call(r,Ye,Z.bulletClass):ge+=`<${Z.bulletElement} ${r.isElement?'part="bullet"':""} class="${Z.bulletClass}"></${Z.bulletElement}>`}Z.type==="fraction"&&(Z.renderFraction?ge=Z.renderFraction.call(r,Z.currentClass,Z.totalClass):ge=`<span class="${Z.currentClass}"></span> / <span class="${Z.totalClass}"></span>`),Z.type==="progressbar"&&(Z.renderProgressbar?ge=Z.renderProgressbar.call(r,Z.progressbarFillClass):ge=`<span class="${Z.progressbarFillClass}"></span>`),r.pagination.bullets=[],pe.forEach(je=>{Z.type!=="custom"&&(je.innerHTML=ge||""),Z.type==="bullets"&&r.pagination.bullets.push(...je.querySelectorAll($f(Z.bulletClass)))}),Z.type!=="custom"&&_("paginationRender",pe[0])}function K(){r.params.pagination=SB(r,r.originalParams.pagination,r.params.pagination,{el:"swiper-pagination"});const Z=r.params.pagination;if(!Z.el)return;let se;typeof Z.el=="string"&&r.isElement&&(se=r.el.querySelector(Z.el)),!se&&typeof Z.el=="string"&&(se=[...document.querySelectorAll(Z.el)]),se||(se=Z.el),!(!se||se.length===0)&&(r.params.uniqueNavElements&&typeof Z.el=="string"&&Array.isArray(se)&&se.length>1&&(se=[...r.el.querySelectorAll(Z.el)],se.length>1&&(se=se.filter(pe=>oB(pe,".swiper")[0]===r.el)[0])),Array.isArray(se)&&se.length===1&&(se=se[0]),Object.assign(r.pagination,{el:se}),se=$i(se),se.forEach(pe=>{Z.type==="bullets"&&Z.clickable&&pe.classList.add(...(Z.clickableClass||"").split(" ")),pe.classList.add(Z.modifierClass+Z.type),pe.classList.add(r.isHorizontal()?Z.horizontalClass:Z.verticalClass),Z.type==="bullets"&&Z.dynamicBullets&&(pe.classList.add(`${Z.modifierClass}${Z.type}-dynamic`),R=0,Z.dynamicMainBullets<1&&(Z.dynamicMainBullets=1)),Z.type==="progressbar"&&Z.progressbarOpposite&&pe.classList.add(Z.progressbarOppositeClass),Z.clickable&&pe.addEventListener("click",U),r.enabled||pe.classList.add(Z.lockClass)}))}function Y(){const Z=r.params.pagination;if(w())return;let se=r.pagination.el;se&&(se=$i(se),se.forEach(pe=>{pe.classList.remove(Z.hiddenClass),pe.classList.remove(Z.modifierClass+Z.type),pe.classList.remove(r.isHorizontal()?Z.horizontalClass:Z.verticalClass),Z.clickable&&(pe.classList.remove(...(Z.clickableClass||"").split(" ")),pe.removeEventListener("click",U))})),r.pagination.bullets&&r.pagination.bullets.forEach(pe=>pe.classList.remove(...Z.bulletActiveClass.split(" ")))}u("changeDirection",()=>{if(!r.pagination||!r.pagination.el)return;const Z=r.params.pagination;let{el:se}=r.pagination;se=$i(se),se.forEach(pe=>{pe.classList.remove(Z.horizontalClass,Z.verticalClass),pe.classList.add(r.isHorizontal()?Z.horizontalClass:Z.verticalClass)})}),u("init",()=>{r.params.pagination.enabled===!1?te():(K(),q(),G())}),u("activeIndexChange",()=>{typeof r.snapIndex>"u"&&G()}),u("snapIndexChange",()=>{G()}),u("snapGridLengthChange",()=>{q(),G()}),u("destroy",()=>{Y()}),u("enable disable",()=>{let{el:Z}=r.pagination;Z&&(Z=$i(Z),Z.forEach(se=>se.classList[r.enabled?"remove":"add"](r.params.pagination.lockClass)))}),u("lock unlock",()=>{G()}),u("click",(Z,se)=>{const pe=se.target,ge=$i(r.pagination.el);if(r.params.pagination.el&&r.params.pagination.hideOnClick&&ge&&ge.length>0&&!pe.classList.contains(r.params.pagination.bulletClass)){if(r.navigation&&(r.navigation.nextEl&&pe===r.navigation.nextEl||r.navigation.prevEl&&pe===r.navigation.prevEl))return;const je=ge[0].classList.contains(r.params.pagination.hiddenClass);_(je===!0?"paginationShow":"paginationHide"),ge.forEach(Ye=>Ye.classList.toggle(r.params.pagination.hiddenClass))}});const ie=()=>{r.el.classList.remove(r.params.pagination.paginationDisabledClass);let{el:Z}=r.pagination;Z&&(Z=$i(Z),Z.forEach(se=>se.classList.remove(r.params.pagination.paginationDisabledClass))),K(),q(),G()},te=()=>{r.el.classList.add(r.params.pagination.paginationDisabledClass);let{el:Z}=r.pagination;Z&&(Z=$i(Z),Z.forEach(se=>se.classList.add(r.params.pagination.paginationDisabledClass))),Y()};Object.assign(r.pagination,{enable:ie,disable:te,render:q,update:G,init:K,destroy:Y})}function YX(a){let{swiper:r,extendParams:l,on:u,emit:_,params:E}=a;r.autoplay={running:!1,paused:!1,timeLeft:0},l({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let T,R,w=E&&E.autoplay?E.autoplay.delay:3e3,j=E&&E.autoplay?E.autoplay.delay:3e3,P,U=new Date().getTime(),G,q,K,Y,ie,te,Z;function se(We){!r||r.destroyed||!r.wrapperEl||We.target===r.wrapperEl&&(r.wrapperEl.removeEventListener("transitionend",se),!(Z||We.detail&&We.detail.bySwiperTouchMove)&&Le())}const pe=()=>{if(r.destroyed||!r.autoplay.running)return;r.autoplay.paused?G=!0:G&&(j=P,G=!1);const We=r.autoplay.paused?P:U+j-new Date().getTime();r.autoplay.timeLeft=We,_("autoplayTimeLeft",We,We/w),R=requestAnimationFrame(()=>{pe()})},ge=()=>{let We;return r.virtual&&r.params.virtual.enabled?We=r.slides.filter(Jt=>Jt.classList.contains("swiper-slide-active"))[0]:We=r.slides[r.activeIndex],We?parseInt(We.getAttribute("data-swiper-autoplay"),10):void 0},je=We=>{if(r.destroyed||!r.autoplay.running)return;cancelAnimationFrame(R),pe();let Kt=typeof We>"u"?r.params.autoplay.delay:We;w=r.params.autoplay.delay,j=r.params.autoplay.delay;const Jt=ge();!Number.isNaN(Jt)&&Jt>0&&typeof We>"u"&&(Kt=Jt,w=Jt,j=Jt),P=Kt;const vs=r.params.speed,Ss=()=>{!r||r.destroyed||(r.params.autoplay.reverseDirection?!r.isBeginning||r.params.loop||r.params.rewind?(r.slidePrev(vs,!0,!0),_("autoplay")):r.params.autoplay.stopOnLastSlide||(r.slideTo(r.slides.length-1,vs,!0,!0),_("autoplay")):!r.isEnd||r.params.loop||r.params.rewind?(r.slideNext(vs,!0,!0),_("autoplay")):r.params.autoplay.stopOnLastSlide||(r.slideTo(0,vs,!0,!0),_("autoplay")),r.params.cssMode&&(U=new Date().getTime(),requestAnimationFrame(()=>{je()})))};return Kt>0?(clearTimeout(T),T=setTimeout(()=>{Ss()},Kt)):requestAnimationFrame(()=>{Ss()}),Kt},Ye=()=>{U=new Date().getTime(),r.autoplay.running=!0,je(),_("autoplayStart")},fe=()=>{r.autoplay.running=!1,clearTimeout(T),cancelAnimationFrame(R),_("autoplayStop")},we=(We,Kt)=>{if(r.destroyed||!r.autoplay.running)return;clearTimeout(T),We||(te=!0);const Jt=()=>{_("autoplayPause"),r.params.autoplay.waitForTransition?r.wrapperEl.addEventListener("transitionend",se):Le()};if(r.autoplay.paused=!0,Kt){ie&&(P=r.params.autoplay.delay),ie=!1,Jt();return}P=(P||r.params.autoplay.delay)-(new Date().getTime()-U),!(r.isEnd&&P<0&&!r.params.loop)&&(P<0&&(P=0),Jt())},Le=()=>{r.isEnd&&P<0&&!r.params.loop||r.destroyed||!r.autoplay.running||(U=new Date().getTime(),te?(te=!1,je(P)):je(),r.autoplay.paused=!1,_("autoplayResume"))},Fe=()=>{if(r.destroyed||!r.autoplay.running)return;const We=$a();We.visibilityState==="hidden"&&(te=!0,we(!0)),We.visibilityState==="visible"&&Le()},tt=We=>{We.pointerType==="mouse"&&(te=!0,Z=!0,!(r.animating||r.autoplay.paused)&&we(!0))},Me=We=>{We.pointerType==="mouse"&&(Z=!1,r.autoplay.paused&&Le())},Ze=()=>{r.params.autoplay.pauseOnMouseEnter&&(r.el.addEventListener("pointerenter",tt),r.el.addEventListener("pointerleave",Me))},rt=()=>{r.el&&typeof r.el!="string"&&(r.el.removeEventListener("pointerenter",tt),r.el.removeEventListener("pointerleave",Me))},Qt=()=>{$a().addEventListener("visibilitychange",Fe)},rs=()=>{$a().removeEventListener("visibilitychange",Fe)};u("init",()=>{r.params.autoplay.enabled&&(Ze(),Qt(),Ye())}),u("destroy",()=>{rt(),rs(),r.autoplay.running&&fe()}),u("_freeModeStaticRelease",()=>{(K||te)&&Le()}),u("_freeModeNoMomentumRelease",()=>{r.params.autoplay.disableOnInteraction?fe():we(!0,!0)}),u("beforeTransitionStart",(We,Kt,Jt)=>{r.destroyed||!r.autoplay.running||(Jt||!r.params.autoplay.disableOnInteraction?we(!0,!0):fe())}),u("sliderFirstMove",()=>{if(!(r.destroyed||!r.autoplay.running)){if(r.params.autoplay.disableOnInteraction){fe();return}q=!0,K=!1,te=!1,Y=setTimeout(()=>{te=!0,K=!0,we(!0)},200)}}),u("touchEnd",()=>{if(!(r.destroyed||!r.autoplay.running||!q)){if(clearTimeout(Y),clearTimeout(T),r.params.autoplay.disableOnInteraction){K=!1,q=!1;return}K&&r.params.cssMode&&Le(),K=!1,q=!1}}),u("slideChange",()=>{r.destroyed||!r.autoplay.running||(ie=!0)}),Object.assign(r.autoplay,{start:Ye,stop:fe,pause:we,resume:Le})}function TB(){const[a,r]=ee.useState([]);return ee.useEffect(()=>{Ci.get("https://api.japaneseacademy.jp/allcomments").then(l=>{r(l.data)}).catch(l=>{console.error("Error fetching the comments:",l)})},[]),h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container Comments",id:"Comments",children:[h.jsx("h2",{className:"text-center fw-bold mt-5 mb-5",children:"من آراء الطلاب الكرام في أكاديمية اللغة اليابانية"}),h.jsx("img",{className:"w-75 m-auto d-flex",src:_J,alt:""}),h.jsx(gB,{spaceBetween:30,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0,modules:[YX,zX,KX],className:"mySwiper",breakpoints:{0:{slidesPerView:1},768:{slidesPerView:2},1024:{slidesPerView:3}},children:a.map(l=>h.jsx(vB,{className:"comments",children:h.jsxs("li",{children:[h.jsx("p",{className:"main_comment shadow",children:l.comment}),h.jsx("p",{className:"country",children:l.country}),h.jsx("p",{className:"name",children:l.name})]})},l.id))})]})})}function qX(){const[a,r]=ee.useState(""),[l,u]=ee.useState(""),[_,E]=ee.useState(""),[T,R]=ee.useState([]),[w,j]=ee.useState(""),[P,U]=ee.useState(""),[G,q]=ee.useState([]),K=da();ee.useEffect(()=>{ie(),se()},[]);const Y=fe=>{fe.preventDefault(),fetch("https://api.japaneseacademy.online/addcomment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,country:l,comment:_})}).then(we=>{we.ok?(alert("تم إضافة التعليق بنجاح"),r(""),u(""),E(""),ie()):alert("حدث خطأ أثناء محاولة إضافة التعليق")}).catch(we=>console.error("Error adding comment:",we))},ie=()=>{fetch("https://api.japaneseacademy.online/allcomments").then(fe=>fe.json()).then(fe=>R(fe)).catch(fe=>console.error("Error fetching comments:",fe))},te=fe=>{fetch("https://api.japaneseacademy.online/deletecomment",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:fe})}).then(we=>{we.ok?(alert("تم حذف التعليق بنجاح"),ie()):alert("حدث خطأ أثناء محاولة حذف التعليق")}).catch(we=>console.error("Error deleting comment:",we))},Z=()=>{const we=localStorage.getItem("token");w&&P?fetch("https://api.japaneseacademy.online/updatecredentials",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${we}`},body:JSON.stringify({newUsername:w,newPassword:P,userId:1})}).then(Le=>{Le.ok?alert("تم تغيير اسم المستخدم وكلمة المرور بنجاح"):alert("حدث خطأ أثناء محاولة تغيير اسم المستخدم وكلمة المرور")}).catch(Le=>console.error("Error updating credentials:",Le)):alert("الرجاء إدخال اسم مستخدم وكلمة مرور جديدة")},se=()=>{fetch("https://api.japaneseacademy.jp/allusers").then(fe=>fe.json()).then(fe=>{q(fe)}).catch(fe=>console.error("Error fetching users:",fe))},pe=fe=>{fetch("https://api.japaneseacademy.jp/deleteusers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:fe})}).then(we=>{we.ok?q(G.filter(Le=>Le.id!==fe)):console.error("Failed to delete user")}).catch(we=>console.error("Error deleting user:",we))},ge=(fe,we)=>{fetch("https://api.japaneseacademy.jp/update-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:fe,role:we})}).then(Le=>{Le.ok?(alert("تم تغيير الدور !"),q(G.map(Fe=>Fe.id===fe?{...Fe,role:we}:Fe))):console.error("Failed to update role")}).catch(Le=>console.error("Error updating role:",Le))},je=(fe,we)=>{fetch("https://api.japaneseacademy.jp/update-show-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:fe,show:we})}).then(Le=>{Le.ok?(alert("تم تغيير الصلاحية !"),q(G.map(Fe=>Fe.id===fe?{...Fe,show:we}:Fe))):console.error("Failed to update show")}).catch(Le=>console.error("Error updating show:",Le))},Ye=()=>{localStorage.removeItem("auth"),K("/Login")};return h.jsxs("div",{className:"container",children:[h.jsxs("div",{className:"sidebar",children:[h.jsx("h2",{children:"لوحة التحكم"}),h.jsx("a",{href:"#change-credentials",children:"تغيير اسم المستخدم وكلمة المرور"}),h.jsx("a",{href:"#add-comment",children:"إضافة تعليق"}),h.jsx("a",{href:"#view-comments",children:"عرض التعليقات"}),h.jsx("a",{href:"#view-users",children:"عرض المستخدمين"}),h.jsx("a",{className:"logout",href:"#",onClick:Ye,children:"تسجيل الخروج"})]}),h.jsxs("div",{className:"content",children:[h.jsxs("div",{id:"change-credentials",className:"change-credentials",children:[h.jsx("h3",{children:"تغيير اسم المستخدم وكلمة المرور"}),h.jsx("input",{type:"text",placeholder:"اسم المستخدم الجديد",value:w,onChange:fe=>j(fe.target.value)}),h.jsx("input",{type:"password",placeholder:"كلمة المرور الجديدة",value:P,onChange:fe=>U(fe.target.value)}),h.jsx("button",{onClick:Z,children:"حفظ التغييرات"})]}),h.jsxs("div",{id:"add-comment",className:"form-section",children:[h.jsx("h3",{children:"إضافة تعليق"}),h.jsxs("form",{onSubmit:Y,children:[h.jsx("label",{htmlFor:"name",children:"الاسم"}),h.jsx("input",{type:"text",id:"name",name:"name",value:a,onChange:fe=>r(fe.target.value)}),h.jsx("br",{}),h.jsx("br",{}),h.jsx("label",{htmlFor:"country",children:"المدينة"}),h.jsx("input",{type:"text",id:"country",name:"country",value:l,onChange:fe=>u(fe.target.value)}),h.jsx("br",{}),h.jsx("br",{}),h.jsx("label",{htmlFor:"comment",children:"التعليق"}),h.jsx("textarea",{name:"comment",id:"comment",value:_,onChange:fe=>E(fe.target.value)}),h.jsx("br",{}),h.jsx("br",{}),h.jsx("button",{className:"button_add_comment",type:"submit",children:"أضف تعليق"})]})]}),h.jsxs("div",{id:"view-comments",className:"comments-section",children:[h.jsx("h3",{children:"جميع التعليقات"}),T.map(fe=>h.jsxs("div",{className:"comment-box",children:[h.jsxs("p",{children:[h.jsx("strong",{children:"الاسم:"})," ",fe.name]}),h.jsxs("p",{children:[h.jsx("strong",{children:"الدولة:"})," ",fe.country]}),h.jsxs("p",{children:[h.jsx("strong",{children:"التعليق:"})," ",fe.comment]}),h.jsx("button",{onClick:()=>te(fe.id),children:"حذف"})]},fe.id))]}),h.jsxs("div",{className:"table-container",id:"view-users",children:[h.jsx("h2",{children:"جدول المستخدمين"}),h.jsxs("table",{className:"responsive-table",children:[h.jsx("thead",{children:h.jsxs("tr",{children:[h.jsx("th",{children:"الاسم الأول"}),h.jsx("th",{children:"الاسم الأخير"}),h.jsx("th",{children:"البلد"}),h.jsx("th",{children:"العمر"}),h.jsx("th",{children:"الجنس"}),h.jsx("th",{children:"مستوى التعليم"}),h.jsx("th",{children:"مستوى اللغة اليابانية"}),h.jsx("th",{children:"الهاتف"}),h.jsx("th",{children:"الإيميل"}),h.jsx("th",{children:"الدور"}),h.jsx("th",{children:"إظهار صفحة الفيديو"}),h.jsx("th",{children:"الحذف"})]})}),h.jsx("tbody",{children:G.map(fe=>h.jsxs("tr",{children:[h.jsx("td",{children:fe.firstName}),h.jsx("td",{children:fe.lastName}),h.jsx("td",{children:fe.country}),h.jsx("td",{children:fe.age}),h.jsx("td",{children:fe.gender}),h.jsx("td",{children:fe.educationLevel}),h.jsx("td",{children:fe.japaneseLevel}),h.jsx("td",{children:fe.phone}),h.jsx("td",{children:fe.email}),h.jsx("td",{children:h.jsxs("select",{value:fe.role,onChange:we=>ge(fe.id,we.target.value),children:[h.jsx("option",{value:"student",children:"Student"}),h.jsx("option",{value:"teacher",children:"Teacher"})]})}),h.jsx("td",{children:h.jsxs("select",{value:fe.show,onChange:we=>je(fe.id,we.target.value),children:[h.jsx("option",{value:"do_not_show",children:"Do not show"}),h.jsx("option",{value:"level_one",children:"Level One"}),h.jsx("option",{value:"level_two",children:"Level Two"}),h.jsx("option",{value:"level_three",children:"Level Three"}),h.jsx("option",{value:"level_four",children:"Level Four"}),h.jsx("option",{value:"level_five",children:"Level Five"}),h.jsx("option",{value:"level_six",children:"Level Six"}),h.jsx("option",{value:"level_seven",children:"Level Seven"}),h.jsx("option",{value:"level_eight",children:"Level Eight"}),h.jsx("option",{value:"level_nine",children:"Level Nine"}),h.jsx("option",{value:"level_ten",children:"Level Ten"}),h.jsx("option",{value:"level_eleven",children:"Level Eleven"}),h.jsx("option",{value:"level_twelve",children:"Level Twelve"}),h.jsx("option",{value:"level_thirteen",children:"Level Thirteen"}),h.jsx("option",{value:"level_fourteen",children:"Level Fourteen"}),h.jsx("option",{value:"level_fifteen",children:"Level Fifteen"}),h.jsx("option",{value:"level_sixteen",children:"Level Sixteen"})]})}),h.jsx("td",{children:h.jsx("button",{className:"delete-btn",onClick:()=>pe(fe.id),children:"🗑️"})})]},fe.id))})]})]})]})]})}function $X(){const[a,r]=ee.useState(""),[l,u]=ee.useState(""),[_,E]=ee.useState(""),[T,R]=ee.useState(!1),w=da(),j=async()=>{E(""),R(!0);try{const U=await fetch("https://api.japaneseacademy.jp/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:l})});if(U.ok){const G=await U.json();console.log("Login successful:",G),localStorage.setItem("auth",G.token),w("/Dash")}else E("اسم المستخدم أو كلمة المرور غير صحيح")}catch(U){E("حدث خطأ أثناء محاولة تسجيل الدخول. حاول مرة أخرى."),console.error("Login error:",U)}finally{R(!1)}},P=()=>a.trim()!==""&&l.trim()!=="";return h.jsxs("div",{className:"login-container",children:[h.jsx("h2",{children:"تسجيل الدخول"}),_&&h.jsx("p",{className:"error-message",children:_}),h.jsx("input",{type:"text",placeholder:"اسم المستخدم",value:a,onChange:U=>r(U.target.value)}),h.jsx("input",{type:"password",placeholder:"كلمة المرور",value:l,onChange:U=>u(U.target.value)}),h.jsx("button",{onClick:j,disabled:!P()||T,children:T?"جاري تسجيل الدخول...":"تسجيل الدخول"}),h.jsx(vt,{to:"/",children:h.jsx("button",{className:"me-3",children:"الانتقال إلى الموقع"})})]})}function JX(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M5.22 8.22a.749.749 0 0 0 0 1.06l6.25 6.25a.749.749 0 0 0 1.06 0l6.25-6.25a.749.749 0 1 0-1.06-1.06L12 13.939 6.28 8.22a.749.749 0 0 0-1.06 0Z"},child:[]}]})(a)}const XX="/assets/_951e1fca-31d2-4544-acc4-7e540675ec7d.B8UGnWJz.jpg",QX=()=>{const[a,r]=ee.useState(null),l=u=>{r(a===u?null:u)};return h.jsx("div",{className:"container elementor-column elementor-col-100 elementor-top-column elementor-element",children:h.jsxs("div",{className:"elementor-widget-wrap elementor-element-populated",id:"Questions",children:[h.jsx("div",{className:"elementor-element elementor-widget elementor-widget-elementskit-heading",children:h.jsx("div",{className:"elementor-widget-container",children:h.jsx("div",{className:"ekit-wid-con",children:h.jsx("div",{className:"ekit-heading elementskit-section-title-wraper text_center",children:h.jsx("h2",{className:"ekit-heading--title elementskit-section-title fw-bold text-center",children:"لماذا سأسجل أبنائي في أكاديمية اللغة اليابانية ؟"})})})})}),h.jsx("img",{className:"w-75 d-flex m-auto",src:XX,alt:""}),h.jsx("div",{className:"elementor-element elementor-widget elementor-widget-elementskit-accordion mt-5 mb-5",children:h.jsx("div",{className:"elementor-widget-container",children:h.jsx("div",{className:"ekit-wid-con",children:h.jsx("div",{className:"elementskit-accordion accoedion-primary",children:ZX.map((u,_)=>h.jsxs("div",{className:`elementskit-card ${a===_?"active":""}`,children:[h.jsx("div",{className:"elementskit-card-header",id:`primaryHeading-${_}`,children:h.jsxs("a",{href:`#collapse-${_}`,className:"ekit-accordion--toggler elementskit-btn-link",onClick:()=>l(_),"aria-expanded":a===_,"aria-controls":`Collapse-${_}`,children:[h.jsxs("span",{className:"ekit-accordion-title",children:[h.jsxs("span",{children:[" ",u.title," "]})," ",h.jsx("span",{children:h.jsx(JX,{})})," "]}),h.jsx("div",{className:"ekit_accordion_icon_group",children:h.jsx("div",{className:"ekit_accordion_normal_icon",children:h.jsx("i",{"aria-hidden":"true",className:`icon-right icon ${a===_?"icon-up-arrow":"icon-down-arrow1"}`})})})]})}),h.jsx("div",{id:`Collapse-${_}`,className:`elementskit-card-body ekit-accordion--content ${a===_?"":"collapse"}`,"aria-labelledby":`primaryHeading-${_}`,children:h.jsx("p",{children:u.content})})]},_))})})})}),h.jsx("div",{className:"elementor-element elementor-widget-elementskit-dual-button-center elementor-widget  mb-5",children:h.jsx("div",{className:"elementor-widget-container",children:h.jsx("div",{className:"ekit-wid-con",children:h.jsx("div",{className:"ekit-element-align-wrapper"})})})})]})})},ZX=[{title:"1. ما هي أكاديمية اللغة اليابانية؟",content:"أكاديمية اللغة اليابانية هي منصة تعليمية متخصصة في تدريس اللغة اليابانية للناطقين بالعربية عبر الإنترنت. تقدم الأكاديمية مستويات دراسية تناسب جميع المستويات من المبتدئين إلى المتقدمين، وتتيح للطلاب فرصة تعلم اللغة من معلمين ناطقين باللغة اليابانية والعربية."},{title:"2. ما الذي يميز أكاديمية اللغة اليابانية عن غيرها؟",content:"تُعتبر أكاديمية اللغة اليابانية أول منصة متكاملة متخصصة بتعليم اللغة اليابانية للناطقين باللغة العربية في العالم، وتركز على تقديم تجربة تعلم شاملة تلائم الطلاب الناطقين باللغة العربية من خلال تقديم دروس مباشرة مع معلمين ناطقين باللغة اليابانية والعربية، وتقديم مناهج مخصصة لاحتياجات الناطقين بالعربية. كما تهتم الأكاديمية بجوانب الثقافة اليابانية، مما يجعل الطلاب يكتسبون فهمًا أعمق للغة في سياقها الثقافي."},{title:"3. ما هي مستويات الدراسة المتوفرة؟",content:"توفر الأكاديمية مستويات متعددة تناسب جميع الطلاب، بدءًا من المستوى التمهيدي للمبتدئين الذين ليس لديهم خلفية في اللغة اليابانية، وصولًا إلى المستويات المتقدمة التي تركز على تطوير المهارات اللغوية المعقدة كالمحادثة المتقدمة والكتابة الأكاديمية."},{title:"4. ما هو عدد الحصص الأسبوعية ومدتها؟",content:"تقدم الأكاديمية حصتين على الأكثر في الأسبوع لكل مستوى، بحيث تكون مدة كل حصة 90 دقيقة، مما يتيح للطلاب فرصة كافية للتعلم والممارسة مع توازن بين الاستيعاب والاستمرارية."},{title:"5. هل يمكنني تعلم اللغة اليابانية من الصفر؟",content:"نعم، الأكاديمية تقدم دورات تمهيدية للمبتدئين الذين ليس لديهم خلفية سابقة في اللغة اليابانية، بحيث يتم تعليمهم الحروف اليابانية (الكانا) والمفردات الأساسية، والقواعد اللغوية المبسطة، مما يؤهلهم للمستويات الأعلى لاحقاً."},{title:"6. من هم المدرسون؟",content:"يضم فريق التدريس في أكاديمية اللغة اليابانية نخبة من المعلمين اليابانيين والعرب ذوي الخبرة في تدريس اللغة اليابانية للناطقين بالعربية. والمعلمون اليابانيون هم ناطقون أصليون للغة ولديهم خبرة واسعة في العمل مع الطلاب الناطقين باللغة العربية، مما يتيح لهم توصيل المعلومات الثقافية واللغوية بطريقة ملائمة. أما المعلمون العرب فهم أيضًا متخصصون في اللغة اليابانية وآدابها، وقادرون على شرح المفاهيم بطرق تسهل على الطلاب الناطقين باللغة العربية استيعابها."},{title:"7. ما هي آلية التسجيل؟",content:"يمكن للطلاب التسجيل عبر الموقع من خلال تعبئة نموذج التسجيل، واختيار المستوى المناسب لهم. بعد ذلك، سيتواصل فريقنا مع الطالب لتأكيد التسجيل وتقديم الإرشادات اللازمة للبدء."},{title:"8. ما هي تكلفة الدورات؟",content:"تختلف تكلفة الدورات حسب المستوى وعدد الساعات المطلوبة. يمكن للطلاب الاطلاع على تفاصيل الأسعار من خلال قسم الرسوم في الموقع."},{title:"9. هل يتم تقديم شهادات للطلاب بعد إتمام المستويات؟",content:"نعم، يحصل الطلاب على شهادات إتمام بعد اجتياز كل مستوى بنجاح، وذلك كتأكيد على مهاراتهم ومعرفتهم باللغة اليابانية."},{title:"10. هل يمكنني الانضمام في أي وقت؟",content:"نعم، الأكاديمية تفتح باب التسجيل على مدار العام، وتتوفر مواعيد بدء مرنة حسب مستوى كل طالب واحتياجاته."},{title:"11. ما هي طريقة التدريس؟",content:"تعتمد الأكاديمية على المناهج اليابانية المخصصة للناطقين بلغات أجنبية، وتقدم دروسًا مباشرة عبر الإنترنت، تجمع بين الشرح والممارسة، مع التركيز على التواصل والتفاعل. يتم توفير المواد التعليمية والمراجع إلكترونيًا."},{title:"12. كيف يتم التقييم في الأكاديمية؟",content:"يتم تقييم الطلاب من خلال اختبارات قصيرة ومشاريع عملية خلال كل مستوى، بالإضافة إلى اختبار نهائي لتحديد مدى استيعابهم للمستوى."},{title:"13. هل هناك دعم للطلاب خارج أوقات الحصص؟",content:"نعم، توفر الأكاديمية دعمًا إضافيًا للطلاب خارج أوقات الحصص من خلال مجموعات التواصل أو البريد الإلكتروني، للإجابة على استفساراتهم وتقديم المساعدة في حال احتاجوا إليها."},{title:"14. ما هي المنصة المستخدمة في التدريس عبر الإنترنت؟",content:"تعتمد الأكاديمية على منصة تفاعلية تتيح للطلاب التفاعل مع المعلمين والزملاء، وتوفر أدوات تعليمية متقدمة مثل مشاركة الشاشة، اللوح الأبيض، والقدرة على تسجيل الدروس لمراجعتها لاحقًا."},{title:"15. هل هناك اختبارات لتحديد المستوى قبل بدء الدراسة؟",content:"نعم، يتم تقديم اختبار تحديد مستوى مجاني لجميع الطلاب الجدد لتحديد مستواهم الحالي في اللغة اليابانية، مما يساعد في توجيههم للمستوى الأنسب لهم في الأكاديمية."},{title:"16. كم هي مدة الدراسة لكل مستوى؟",content:"تختلف مدة الدراسة لكل مستوى حسب محتوى المستوى وتقدُّم الطالب. عادةً، تتراوح مدة المستوى الواحد بين 3 إلى 4 أشهر بواقع حصتين أسبوعيًا، مما يتيح للطلاب فرصة الاستيعاب والممارسة."},{title:"17. هل تركز الأكاديمية على اللهجات اليابانية المختلفة أم اللغة الرسمية فقط؟",content:"يتم تدريس اللغة اليابانية الرسمية (標準語) المستخدمة في جميع أنحاء اليابان، ولكن يتم أيضًا تقديم نبذة عن بعض اللهجات المحلية (方言) لاكتساب فهم أشمل للتنوع اللغوي."},{title:"18. هل تركز الدروس على جانب معين من اللغة (مثل المحادثة فقط) أم تشمل جميع المهارات؟",content:"تشمل الدروس جميع المهارات اللغوية الأساسية، مثل القراءة، الكتابة، الاستماع، والمحادثة. كما يتم التركيز على قواعد اللغة والمفردات بما يلائم كل مستوى لضمان تطوير شامل للمهارات."},{title:"19. هل تقدم الأكاديمية دروسًا حول الثقافة اليابانية؟",content:"نعم، تقدم الأكاديمية دروسًا خاصة حول الثقافة اليابانية تشمل جوانب مثل العادات والتقاليد، الفن، التاريخ، والعلاقات الاجتماعية. يساعد ذلك الطلاب في فهم السياق الثقافي للغة بشكل أفضل."},{title:"20. هل أحتاج إلى شراء كتب دراسية للدروس؟",content:"توفر الأكاديمية معظم المواد التعليمية إلكترونيًا، ولكن قد يُنصح الطلاب بشراء بعض الكتب المعتمدة مثل سلسلة ”Genki“ أو ”Minna no Nihongo“ حسب مستوى دراستهم لمساعدتهم في التعلم الذاتي."},{title:"21. هل هناك دروس خصوصية متاحة؟",content:"نعم، تقدم الأكاديمية دروسًا خاصة للراغبين في تعلم اللغة بشكل فردي مع معلم خاص. يتم تخصيص محتوى الدرس حسب أهداف الطالب، سواء كان ذلك لتحسين مهارة معينة أو التحضير لاختبار."},{title:"22. هل تقدم الأكاديمية دورات تحضيرية لاختبار JLPT؟",content:"نعم، تقدم الأكاديمية دورات خاصة للتحضير لاختبار الكفاءة في اللغة اليابانية (JLPT)، مع التركيز على الأقسام المختلفة للاختبار، مثل القراءة، القواعد، المفردات، والاستماع."},{title:"23. هل يمكنني تغيير المستوى إذا شعرت أنني بحاجة لذلك؟",content:"نعم، يمكن للطلاب طلب تغيير المستوى في حال وجدوا أن المستوى الحالي غير مناسب لهم. يتم مراجعة طلبهم وتقييمهم من قبل المعلمين لتحديد أنسب مستوى لهم."},{title:"24. ما هي سياسات الاسترداد في حال الانسحاب من الدورة؟",content:"توفر الأكاديمية سياسات استرداد مرنة حسب مدة الدراسة المنقضية وتوقيت الانسحاب. يُنصح الطلاب بالاطلاع على الشروط الخاصة بالاسترداد قبل التسجيل."},{title:"25. كيف يتم دعم الطلاب الذين يواجهون صعوبات في التعلم؟",content:"الأكاديمية تقدم دعمًا إضافيًا للطلاب الذين يحتاجون مساعدة خاصة، مثل جلسات تقوية، ودروس مساعدة، وتوفير مستشارين تعليميين لإرشادهم حسب احتياجاتهم."},{title:"26. هل الدروس مسجلة ويمكن مشاهدتها لاحقًا؟",content:"نعم، يتم تسجيل معظم الدروس بحيث يتمكن الطلاب من العودة إليها في أي وقت للمراجعة، مما يضمن لهم الاستفادة القصوى من كل درس."},{title:"27. هل يمكنني الدراسة من الهاتف أو الجهاز اللوحي؟",content:"نعم، توفر الأكاديمية إمكانية الوصول للدروس من خلال الحواسيب، الهواتف الذكية، والأجهزة اللوحية، مما يتيح للطلاب مرونة أكبر في الدراسة من أي مكان."},{title:"28. هل يجب أن أكون متفرغًا تمامًا للدروس؟",content:"لا، يمكن للطلاب اختيار أوقات الدروس التي تناسبهم، كما أن الأكاديمية توفر خيارات دراسة مرنة تلائم الأشخاص الذين لديهم جدول عمل أو التزامات أخرى."},{title:"29. هل تقدمون شهادات معترف بها؟",content:"الشهادات المقدمة هي شهادات إتمام من الأكاديمية، مما يعكس إنجاز الطالب في دراسة اللغة اليابانية. للاعتراف الدولي، يمكن للطلاب التحضير لاختبار JLPT عبر الأكاديمية."},{title:"30. ما هو عدد الطلاب في كل فصل؟",content:"تحرص الأكاديمية على إبقاء الفصول الدراسية صغيرة، بحيث لا يتجاوز عدد الطلاب في الفصل الواحد 10 طلاب، مما يتيح التفاعل الشخصي والمباشر مع المعلم."},{title:"31. ما هي طرق الدفع المتاحة؟",content:"يمكن للطلاب الدفع من خلال عدة وسائل مثل بطاقات الائتمان، التحويلات المصرفية، أو عبر خدمات الدفع الإلكتروني مثل PayPal وغيره. ويتم توفير التفاصيل الكاملة عند التسجيل."}];function eQ(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"Container",children:h.jsx("div",{className:"content p-0 w-100",children:h.jsx("div",{className:"img_Articles",children:h.jsxs("div",{className:"detailsHeader col-lg-10  m-auto",children:[h.jsx("h1",{children:"المقالات"}),h.jsx("p",{className:"mt-3",children:"  Home /  المقالات "})]})})})})})}const MV="/assets/Leonardo_Diffusion_XL_In_this_enchanting_image_we_are_transpor_1.B2jPVufg.jpg",tQ="/assets/nn.CYVYMjyY.jpg",nQ="/assets/%D8%AE%D8%B1%D9%8A%D8%B7%D8%A9-%D8%A7%D9%84%D8%B9%D8%A7%D9%84%D9%85-%D8%B5%D9%85%D8%A7%D8%A11-768x488-1.BgnfJy3a.png",iQ="/assets/Leonardo_Diffusion_XL_In_this_mesmerizing_image_we_enter_a_cap_1.BJ-L_ZQg.jpg",sQ="/assets/leonardo_diffusion_xl_in_this_enchanting_image_we_are_drawn_in_0_8f7bd515-89b0-4176-a32d-0255f374a939.DKMXD72u.jpg",rQ="/assets/DreamShaper_v7_An_image_imbued_with_the_charm_of_stories_and_l_2-1.B2yCMdK6.jpg",oQ="/assets/Default_A_cartoon_illustration_depicts_a_child_with_a_furrowed_2.C_x8Rjhb.jpg";function aQ(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container",children:h.jsxs("div",{className:"cards_Articles",children:[h.jsxs("div",{className:"card_Articles mt-5",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:MV,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:"  كيف أطور مهارة القراءة؟"}),h.jsx("p",{children:"  أهمية القراءة وكيفية تطوير مهارة القراءة عند الأطفال مقدمة تلعب القراءة دورًا حيويًا في تنمية مهارات الأطفال العقلية واللغوية. إنها"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:tQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" 🌟 تعلم العربية عن بعد: تحولات مهمة في عالم التعليم 📚"}),h.jsx("p",{children:"  🌟 أهمية التعليم عن بعد في تعليم اللغة العربية 📚 شهد العالم تطوراً كبيراً في مجال التعليم عن بعد 🌐، […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:nQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" 🌍📚 الكلمات العربية في لغات العالم: تعرف على أصولها! 🧐✨"}),h.jsx("p",{children:" هل تعرف أصول الكلمات العربية في لغات أخرى؟ مقدمة 🌍 اللغة العربية ليست فقط وسيلة تواصل بين العرب، بل هي […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:iQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" لماذا ارتبطت العربية بحرف الضاد؟"}),h.jsx("p",{children:" لماذا سميت اللغة العربية لغة الضاد؟ 🌍📜   مقدمة اللغة العربية، بجمالها وتعقيدها، هي واحدة من أكثر اللغات تأثيرًا في […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:sQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" 💡سحر اللغة العربية: من التراث إلى الابتكار الحديث📱"}),h.jsx("p",{children:"   أسرار جمال اللغة العربية: رحلة في عالم الضاد 🌍📜 اللغة العربية ليست مجرد وسيلة للتواصل؛ إنها وعاءٌ ثقافيٌ وتاريخيٌ […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:rQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" 🌍📚 الكلمات العربية في لغات العالم: تعرف على أصولها! 🧐✨"}),h.jsx("p",{children:" هل تعرف أصول الكلمات العربية في لغات أخرى؟ مقدمة 🌍 اللغة العربية ليست فقط وسيلة تواصل بين العرب، بل هي […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:oQ,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" 📚 كيف ترفع اللغة العربية من ذكائك؟"}),h.jsx("p",{children:" 📚 كيف ترفع اللغة العربية من ذكائك؟   اكتشف التأثير المذهل لهذه اللغة العريقة على دماغك 📚 هل تعلم أن […]"})]}),h.jsxs("div",{className:"card_Articles",children:[h.jsx("div",{className:"image_articles",children:h.jsx("img",{className:" m-auto",src:MV,alt:""})}),h.jsx("h3",{className:"mt-4 mb-3",children:" ماذا تعرف عن عسر القراءة؟"}),h.jsx("p",{children:" 📚 عسر القراءة (الديسلكسيا) دليل شامل للتعرف والتعامل مع هذا الاضطراب الشائع 📚 🧐 هل تبحث عن فهم شامل لعسر […]"})]})]})})})}const cQ="/assets/_c44c06cf-5421-4193-b9bb-cd39a86e679f.DTBo8aBr.jpg",lQ="/assets/_dcdcbe88-4c28-4699-bb82-1d2754efe109.CDD-GR4X.jpg",dQ="/assets/_993a5416-0b18-4ddb-869a-a5b99532ffe5.DLDW9ic2.jpg",uQ="/assets/_fa1d11a6-f7f0-49d6-8ba9-5ea0abd69afe._G4bukGu.jpg",hQ="/assets/_9e9b0610-8fca-4c60-8d4d-d734e8182c46.tmnqcAv2.jpg";function pQ(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container Header",children:[h.jsx("div",{className:"academy pb-4 pt-4 mt-4 left",children:h.jsxs("div",{className:"row Header_revers",children:[h.jsxs("div",{className:"col-lg-6",children:[h.jsx("div",{className:"academy_logo mb-4 ",children:h.jsx("h2",{className:" left fw-bold",children:"أكاديمية اللغة اليابانية"})}),h.jsxs("div",{className:"details",children:["مرحبًا بكم في"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"}),"، المنصة التعليمية الرائدة لتعليم اللغة اليابانية للناطقين بغيرها. في ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","نقدم لكم تجربة تعليمية تفاعلية وفريدة، تمكنكم من تعلم اللغة اليابانية من خلال مجموعة متنوعة من الدروس والأنشطة، مدعومةً بأحدث التقنيات التعليمية وطرق التدريس المتقدمة. وما يميزنا في أكاديمية اللغة اليابانية هو فريق التدريس المتعدد الثقافات، والذي يضم ناطقين أصليين باللغتين اليابانية والعربية، مما يوفر لكم تعلمًا ممتعًا وسلسًا يجمع بين الدقة اللغوية والتواصل الثقافي، ونوفر لكم بيئة تعليمية متخصصة تساعدكم على تحقيق أهدافكم اللغوية والثقافية."]})]}),h.jsx("div",{className:"col-lg-6",children:h.jsx("img",{className:"w-100",src:cQ,alt:""})})]})}),h.jsxs("div",{className:"academy mt-5 mb-5 right row",children:[h.jsx("div",{className:"col-lg-6 ",children:h.jsx("img",{className:"w-100",src:uQ,alt:""})}),h.jsxs("div",{className:"col-lg-6",children:[h.jsx("h2",{className:"title_academy mb-3",children:"رؤيتنا:"}),h.jsxs("div",{className:"details",children:["لقد تأسست"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"لتكون جسرًا يربط بين العالم العربي واليابان من خلال اللغة والثقافة. فنحن نؤمن أن تعلم اللغة ليس مجرد تعلم القواعد والمفردات واستخدامها للتواصل اللغوي، بل هو نافذة لفهم الثقافات والحضارات المختلفة. ومن هنا، جاءت رؤيتنا في تقديم تعليم شامل يمزج بين التعليم اللغوي والتواصل الثقافي، بحيث يصبح الطلاب قادرين على استخدام اللغة اليابانية بشكل فعال في حياتهم اليومية والعملية. وبناء جسر ثقافي بين العالم العربي واليابان من خلال تعليم اللغة اليابانية بطريقة مبتكرة، ومتدرجة، وشاملة. ونسعى إلى تمكين الطلاب من التواصل بثقة واحترافية باستخدام اللغة اليابانية في مختلف مجالات الحياة، سواء كانت أكاديمية، أو مهنية، أو حتى ترفيهية. وفي أكاديمية اللغة اليابانية نؤمن بأن اللغة ليست مجرد أداة للتواصل، بل هي مفتاح لفهم ثقافات جديدة وتوسيع آفاق التبادل الثقافي والعلمي."]})]})]}),h.jsxs("div",{className:"academy mt-5 mb-5 right row",children:[h.jsxs("div",{className:"col-lg-6 ",children:[h.jsx("h2",{className:"title_academy mb-3",children:"رسالتنا:"}),h.jsxs("div",{className:"details",children:["تتمثل رسالة",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"في توفير تعليم لغوي عالي الجودة، يمكِّن جميع المتعلمين من اكتساب اللغة اليابانية بفعالية، مع فهم عميق للثقافة اليابانية. ونهدف في أكاديميتنا إلى أن نصبح وجهة أساسية لكل من يسعى لتعلم اللغة اليابانية في العالم من الناطقين باللغة العربية بشكل خاص. ونحرص على أن يكون التعليم ليس فقط تفاعليًا وممتعًا، بل أيضًا مبنيًا على أسس علمية ولغوية مدروسة، تضمن الفهم العميق والتطبيق السليم للغة. وفي أكاديمية اللغة اليابانية، نؤمن أن إتقان اللغة اليابانية سيفتح أمامكم أبوابًا واسعة من الفرص، سواءً في مجالات العمل، أو الدراسة، أو حتى التواصل الشخصي. وتعلم اللغة اليابانية ليس مجرد اكتساب مهارات جديدة، بل هو رحلة لاكتشاف عالم جديد مليء بالإثارة والتحديات."]})]}),h.jsx("div",{className:"col-lg-6",children:h.jsx("img",{className:"w-100",src:hQ,alt:""})})]}),h.jsxs("div",{className:"what_we_do ",children:[h.jsx("h2",{className:"fw-bold text-center mb-4",children:"ماذا نقدم في أكاديمية اللغة اليابانية؟"}),h.jsx("img",{className:"w-75 m-auto d-flex mb-4",src:lQ,alt:""}),h.jsxs("ul",{className:"ps-0",children:[h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"1. دورات تعليمية شاملة: "}),h.jsxs("p",{children:["تقوم"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"بتقديم دورات تعليمية متنوعة تناسب جميع المستويات، بدءًا من المبتدئين الذين لا يملكون أي معرفة مسبقة باللغة اليابانية، وصولًا إلى المتعلمين المتقدمين الذين يرغبون في تحسين مهاراتهم اللغوية. وتعتمد الدورات على منهجيات تدريس حديثة ومتطورة، تجمع بين التعلم الذاتي والتفاعل المباشر مع المدرسين."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"2. تدريس تفاعلي عبر الإنترنت: "}),h.jsxs("p",{children:["في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نستخدم أحدث الأدوات والمنصات التعليمية لتقديم دروس تفاعلية عبر الإنترنت. حيث يمكن للطلاب الانضمام إلى الحصص الافتراضية من أي مكان في العالم، والمشاركة في نقاشات وأنشطة مباشرة مع معلمين ناطقين أصليين باللغتين اليابانية والعربية، مما يعزز التفاعل والتطبيق الفعلي للغة."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"3. برنامج متكامل للتعلم الثقافي: "}),h.jsxs("p",{children:["إلى جانب تعليم اللغة اليابانية، نقوم في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","بتقديم مواد وأنشطة تساعد على فهم الثقافة والعادات والتقاليد اليابانية. وهذه البرامج الثقافية تعزز من قدرة الطلاب على التواصل بفعالية مع المجتمع الياباني وتفتح لهم آفاقًا أوسع لفهم المجتمع الياباني وثقافته."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"4. أساليب تدريس مبتكرة: "}),h.jsxs("p",{children:["في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نحرص على استخدام أساليب تدريس حديثة تعتمد على التكنولوجيا المتقدمة مثل التعلم التكيُّفي، والألعاب التعليمية، والتطبيقات التفاعلية. وهذه الأساليب تجعل عملية التعلم أكثر متعة وفعالية، وتساعد الطلاب على تحسين مهاراتهم في وقت قصير."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"5. دروس خصوصية وجماعية: "}),h.jsxs("p",{children:["نقوم في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"بتوفير خيارات متعددة من الدروس، سواءً كنت تفضل التعلم ضمن مجموعة أو تحتاج إلى دروس خصوصية مع مدرس متخصص. وتتناسب هذه الخيارات مع احتياجات كل طالب، سواءً كان الهدف هو اكتساب المهارات اللغوية الأساسية أو التحضير للامتحانات الرسمية مثل اختبار الكفاءة في اللغة اليابانية (JLPT) وغيره."]})]})]})]}),h.jsxs("div",{className:"why_we_choose",children:[h.jsx("h2",{className:"fw-bold text-center",children:"لماذا تختار أكاديمية اللغة اليابانية؟"}),h.jsx("img",{className:"w-75 m-auto d-flex mb-4",src:dQ,alt:""}),h.jsxs("ul",{className:"ps-0",children:[h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"1. فريق تدريس متخصص:"}),h.jsxs("p",{children:["يضم فريق"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"مدرِّسين ناطقين أصليين باليابانية، بالإضافة إلى مدرِّسين ناطقين باللغة العربية ذوي خبرة في تعليم اللغة اليابانية. وهذا المزيج المثالي من المدرِّسين يتيح لنا تقديم تعليم متميز يجمع بين الدقة اللغوية والتواصل الفعال مع الطلاب."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"2. مرونة في التعلم: "}),h.jsxs("p",{children:["في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نفهم أن الطلاب لديهم جداول زمنية مختلفة، لذا نقدم مرونة في اختيار مواعيد الدروس بما يتناسب مع ظروفهم. فسواءً كنت تفضل التعلم في الصباح أو المساء، يمكنك ضبط جدولك الدراسي بما يتناسب مع احتياجاتك."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"3. موارد تعليمية شاملة: "}),h.jsxs("p",{children:["بالإضافة إلى الدروس المباشرة، يحصل الطلاب في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","على مجموعة واسعة من المواد التعليمية مثل الكتب الإلكترونية، والملفات الصوتية، والفيديوهات التعليمية، والتطبيقات التفاعلية التي تساعدهم على ممارسة اللغة في أي وقت."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"4. بيئة تعليمية داعمة:"}),h.jsxs("p",{children:["نسعى في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"إلى توفير بيئة تعليمية محفزة، تشجع الطلاب على المشاركة وطرح الأسئلة دون أي تردد. ونقوم بالاهتمام بكل طالب بشكل فردي، ونعمل على تقديم الدعم اللازم له لتحقيق النجاح."]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"5. شبكة تواصل مع المتعلمين والخبراء: "}),h.jsxs("p",{children:["من خلال"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية، "})," ","يتاح للطلاب التواصل مع متعلمين آخرين من مختلف أنحاء العالم العربي، بالإضافة إلى الخبراء والمدرسين اليابانيين والعرب على حد السواء. وهذا يساهم في بناء مجتمع تعليمي داعم يمكن للطلاب فيه تبادل الخبرات والتجارب مع الآخرين."]})]})]})]})]})})}function yB(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container Register",children:[h.jsxs("div",{className:"RegisterContent",children:[h.jsx("h2",{className:"fw-bold",id:"Register",children:"طريقة التسجيل:"}),h.jsx("p",{children:"عملية التسجيل في أكاديميتنا بسيطة ومرنة، تشمل الخطوات التالية:"})]}),h.jsxs("ul",{className:"mt-5",children:[h.jsxs("li",{className:"step1 left item1 academy",children:[h.jsx("h2",{children:"إنشاء حساب مجاني:"}),h.jsx("p",{children:"قم بتعبئة نموذج التسجيل لإنشاء حساب في أكاديمية اللغة اليابانية، وستتلقى رسالة تأكيد على بريدك الإلكتروني لتفعيل الحساب."})]}),h.jsxs("li",{className:"step2 top item2 academy",children:[h.jsx("h2",{children:" اختبار تحديد المستوى:"}),h.jsx("p",{children:"خذ اختبار تحديد المستوى المجاني عبر الإنترنت لتحديد مستوى دراستك المناسب."})]}),h.jsxs("li",{className:"step3 right item3 academy",children:[h.jsx("h2",{children:" اختيار الدورة المناسبة:"}),h.jsx("p",{children:"بناءً على نتائج اختبار تحديد المستوى، يمكنك اختيار الدورة التعليمية الأنسب وبدء التسجيل."})]}),h.jsxs("li",{className:"step4 left item4 academy",children:[h.jsx("h2",{children:" إتمام عملية الدفع:"}),h.jsx("p",{children:"أتمم عملية الدفع من خلال وسائل الدفع الإلكترونية المتاحة (بطاقات ائتمان، PayPal، تحويل بنكي)."})]}),h.jsxs("li",{className:"step5 right item5 academy",children:[h.jsx("h2",{children:" الوصول إلى الدروس:"}),h.jsx("p",{children:"بعد الدفع، ستحصل على وصول فوري إلى منصة الدروس حيث يمكنك البدء في التعلم على الفور."})]})]})]})})}const fQ="/assets/_9bf252b1-f72c-4ab3-b8d4-f9dbd6ba947f.CPtbePdx.jpg",mQ="/assets/_f8bcafb4-5b49-4da9-8bb3-92e3f75bce9e.ygoKbN-k.jpg",_Q="/assets/_20102b1c-f765-4316-b5ce-f6690c682010.BpqpXaIv.jpg",EQ="/assets/_621b977e-14ea-4c95-96a0-b4487827a673.CDiAC36v.jpg",gQ="/assets/_a8d31677-60f5-4507-9984-ebdced19d05a.3wb_df62.jpg";function vQ(){return h.jsxs("div",{className:"container Date_lisson_Header mt-5",id:"Level_division",children:[h.jsxs("div",{className:"row academy",children:[h.jsxs("div",{className:"col-lg-7",children:[h.jsx("h2",{className:"title_Date_lisson_Header fw-bold",children:"المستويات الدراسية"}),h.jsxs("div",{className:"details mt-3",children:["تقدم ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","برنامجًا دراسيًا متكاملًا لتعلم اللغة اليابانية، ومصممًا خصيصًا للناطقين باللغة العربية. وينقسم البرنامج إلى عدة مستويات تعليمية تبدأ من الأساسيات وحتى الوصول إلى الطلاقة اللغوية، لتلبية احتياجات المتعلمين المختلفين. ويهدف هذا التقسيم إلى تمكين الطلاب من تطوير مهاراتهم اللغوية بشكل متدرج ومنظم، بحيث يتمكنون من فهم اللغة اليابانية واستخدامها بشكل عملي وفعّال. وتنقسم المستويات الدراسية في "," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," إلى المستويات التالية:"]})]}),h.jsx("div",{className:"col-lg-5",children:h.jsx("img",{className:"w-100",src:fQ,alt:""})})]}),h.jsxs("div",{className:"All_level",children:[h.jsxs("ul",{children:[h.jsxs("li",{className:"academy mb-4 mt-4",children:[h.jsx("h2",{children:"1. المستويات المبتدئة"}),h.jsxs("p",{children:["تنقسم المستويات المبتدئة في"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","إلى ثلاثة مستويات، وهي الخطوة الأولى للطلاب الذين لم يسبق لهم أن تعلموا اللغة اليابانية، أو بدؤوا في تعلمها حديثًا. وفي هذه المستويات، يتعلم الطلاب الأبجدية اليابانية الأساسية (الهيراغانا والكاتاكانا)، وأساسيات النطق، وقواعد اللغة الأساسية، مع بعض حروف الكانجي الأساسية، مما يضعهم على طريق فهم الجمل البسيطة والتعبيرات اليومية. ويتم التركيز على بناء قاعدة قوية، تشمل كلمات وجملًا بسيطة، إلى جانب تطوير مهارات الاستماع والنطق، لتسهيل عملية الانتقال إلى مستويات أعلى. وتنقسم المستويات المبتدئة إلى المستويات الأربعة التالية:",h.jsx("br",{}),"1- المستوى المبتدئ الأساسي(J1)",h.jsx("br",{}),"2- المستوى المبتدئ المتوسط (J2)",h.jsx("br",{}),"3- المستوى المبتدئ المتقدم (J3)",h.jsx("br",{}),"4- المستوى المبتدئ الاحترافي (J4)"]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"2. المستويات المتوسطة"}),h.jsxs("p",{children:["بمجرد إتمام المستويات المبتدئة، ينتقل طلاب"," ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","إلى المستويات المتوسطة، والتي تنقسم بدورها إلى ثلاثة مستويات، حيث يصبحون قادرين على بناء جمل أكثر تعقيدًا، واستخدام تراكيب لغوية متنوعة. وفي هذه المستويات، يتعلم الطلاب مجموعة واسعة من المفردات والتعابير اللغوية التي تساعدهم على التفاعل في مواقف الحياة اليومية، والتواصل بثقة في بيئات غير مألوفة. كما يتم التركيز على تطوير مهارات القراءة وفهم النصوص اليابانية البسيطة وحتى المتوسطة من خلال تعلم المزيد من حروف الكانجي، ليصبح الطلاب قادرين على قراءة وفهم النصوص اليابانية بشكل أفضل. وتنقسم المستويات المتوسطة إلى المستويات الأربعة التالية:",h.jsx("br",{}),"1- المستوى المتوسط المبتدئ (J4)",h.jsx("br",{}),"2- المستوى المتوسط الأساسي (J6)",h.jsx("br",{}),"3- المستوى المتوسط المتقدم (J7)",h.jsx("br",{}),"4- المستوى المتوسط الاحترافي (J8)"]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"3. المستويات المتقدمة"}),h.jsxs("p",{children:["عند الوصول إلى المستويات المتقدمة، يكتسب الطلاب القدرة على فهم واستخدام اللغة اليابانية في سياقات أكثر تعقيدًا، سواءً في المحادثات أو في قراءة النصوص المكتوبة. وفي",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","يتم التركيز في هذه المستويات على صقل المهارات اللغوية من خلال التعرف على تراكيب لغوية معقدة وتوسيع المفردات بما يشمل مصطلحات تقنية وثقافية. وتهدف",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," في في المستويات المتقدمة إلى تأهيل الطلاب للتفاعل بطلاقة في بيئات واقعية، سواءً في مجال العمل أو الدراسة أو حتى النشاطات الترفيهية. وتنقسم المستويات المتقدمة إلى المستويات الأربعة التالية:",h.jsx("br",{}),"1- المستوى المتقدم المبتدئ (J9)",h.jsx("br",{}),"2- المستوى المتقدم المتوسط (J10)",h.jsx("br",{}),"3- المستوى المتقدم الأساسي (J11)",h.jsx("br",{}),"4- المستوى المتقدم الاحترافي (J12)"]})]}),h.jsxs("li",{className:"academy mb-4",children:[h.jsx("h2",{children:"4. المستويات الاحترافية"}),h.jsxs("p",{children:["المستويات الاحترافية هي مستويات موجهة للطلاب الذين يسعون لاستخدام اللغة اليابانية بشكل متمكن واحترافي في مجالات متنوعة مثل الأكاديمية والمهنية. وتهدف",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," من من خلال هذه المستويات إلى توفير تدريب شامل ومتعمق، وتُركز على اكتساب الطلاب القدرة على التعامل مع نصوص معقدة مثل الأبحاث العلمية، والمقالات المتخصصة، والتقارير المهنية، مما يعزز قدرتهم على فهم واستخدام اللغة اليابانية بشكل يتماشى مع أعلى المعايير اللغوية. وبالإضافة إلى ذلك، تولي",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," في في هذه المستويات اهتمامًا خاصًا لتطوير مهارات التواصل في بيئات العمل اليابانية، سواء من خلال المحادثات اليومية أو عبر الكتابة المهنية مثل الرسائل الرسمية والتقارير المهنية، مما يعزز فرص النجاح والتفوق في بيئة عمل احترافية. وتنقسم هذه المستويات إلى المستويات الأربعة التالية:",h.jsx("br",{}),"1- المستوى الاحترافي المبتدئ (J13)",h.jsx("br",{}),"2- المستوى الاحترافي المتوسط (J14)",h.jsx("br",{}),"3- المستوى الاحترافي الأساسي (J15)",h.jsx("br",{}),"4- المستوى الاحترافي المتقدم (J16)"]})]}),h.jsx("hr",{}),h.jsxs("p",{className:"single",children:["إن كل مستوى في ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," يتضمن برنامجًا دراسيًا شاملًا يغطي جميع المهارات الأساسية التي يحتاجها الطالب لتعلم اللغة بشكل متكامل. وتشمل هذه المهارات القراءة، والكتابة، والاستماع، والمحادثة، حيث يُعطى كل جانب من هذه المهارات اهتمامًا خاصًا بما يتناسب مع مستوى الطالب وتقدمه. ويتم بناء المنهج بطريقة مرنة بحيث يُمكن للطلاب التقدم حسب قدراتهم الشخصية واحتياجاتهم اللغوية. وتنقسم المهارات اللغوية في أكاديمية اللغة اليابانية إلى المهارات التالية:"]})]}),h.jsx("hr",{}),h.jsx("div",{className:"skills All_level",children:h.jsxs("ul",{children:[h.jsxs("li",{className:"academy row mb-4",children:[h.jsx("div",{className:"col-lg-7",children:h.jsxs("p",{children:["1. ","",h.jsx("span",{className:"academySpan",children:"مهارات القراءة:"})," تتضمن مهارات القراءة في"," ",h.jsxs("span",{className:"academySpan",children:[" ","أكاديمية اللغة اليابانية"," "]})," ","دراسة النصوص اليابانية المتنوعة التي تبدأ من النصوص البسيطة حتى الوصول إلى النصوص المتقدمة والمعقدة. ويتعلم الطلاب في المراحل الأولى كيفية قراءة الحروف الأبجدية اليابانية (الهيراغانا والكاتاكانا)، ثم ينتقلون إلى قراءة الجمل والنصوص القصيرة التي تحتوي على حروف الكانجي. ومع تقدمهم في المستويات الدراسية، يتعلمون المزيد من حروف الكانجي، ويتعاملون مع نصوص أدبية وعلمية تحتوي على مفردات وصيغ لغوية معقدة، مما يساعدهم على تحسين مهارات الفهم والاستيعاب لديهم."]})}),h.jsx("div",{className:"img_skills col-lg-5",children:h.jsx("img",{className:"w-100",src:mQ,alt:""})})]}),h.jsxs("li",{className:"academy row mb-4",children:[h.jsx("div",{className:"img_listen col-lg-5",children:h.jsx("img",{className:"w-100",src:EQ,alt:""})}),h.jsx("div",{className:"col-lg-7",children:h.jsxs("p",{children:["2. ","",h.jsx("span",{className:"academySpan",children:"مهارات الكتابة:"})," تركز"," ",h.jsxs("span",{className:"academySpan",children:[" ","أكاديمية اللغة اليابانية"," "]})," ","على تطوير قدرة الطلاب على الكتابة بشكل صحيح ودقيق باستخدام الأساليب الأكاديمية والمهنية. ويبدأ الطلاب في كتابة الجمل البسيطة، ثم يتدرجون نحو كتابة المقالات والتقارير الأكاديمية والمهنية. ويتعلمون أيضًا كتابة رسائل رسمية واحترافية تتماشى مع معايير بيئة العمل اليابانية، مما يساعدهم على التفاعل مع بيئات الدراسة والعمل بطرق احترافية."]})})]}),h.jsxs("li",{className:"academy row mb-4",children:[h.jsx("div",{className:"col-lg-7",children:h.jsxs("p",{children:["3. ","",h.jsx("span",{className:"academySpan",children:"مهارات الاستماع:"})," تُعتبر مهارات الاستماع من أهم الجوانب التي يتم التركيز عليها في جميع المستويات في",h.jsxs("span",{className:"academySpan",children:[" ","أكاديمية اللغة اليابانية"," "]}),"حيث يبدأ الطلاب في الاستماع إلى محادثات بسيطة باللغة اليابانية، ومن ثم يتدرجون إلى الاستماع إلى حوارات ومحاضرات متقدمة تحتوي على مفردات معقدة وأسلوب لغوي أكاديمي ومهني. ويتم تعزيز مهارات الاستماع من خلال تمارين عملية تساعد الطلاب على فهم التعابير المختلفة، والتعرف على أساليب التحدث في البيئات الأكاديمية والمهنية المختلفة."]})}),h.jsx("div",{className:"img_listen col-lg-5",children:h.jsx("img",{className:"w-100",src:_Q,alt:""})})]}),h.jsxs("li",{className:"academy row mb-4",children:[h.jsx("div",{className:"img_listen col-lg-5",children:h.jsx("img",{className:"w-100",src:gQ,alt:""})}),h.jsx("div",{className:"col-lg-7",children:h.jsxs("p",{children:["4. ","",h.jsx("span",{className:"academySpan",children:"مهارات المحادثة:"}),"تُعد مهارات المحادثة من أكثر المهارات أهمية عند تعلم أي لغة أجنبية. وفي",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," ","تتمثل أهمية هذه المهارة في تمكين الطلاب من التواصل بثقة مع الناطقين باللغة اليابانية في مختلف المواقف الحياتية والمهنية. ويتم تدريب الطلاب على التحدث باللغة اليابانية في بيئات متنوعة، سواءً في المحادثات اليومية أو في المناقشات الأكاديمية والمهنية. ويشمل التدريب على تحسين النطق، والقدرة على التعبير عن الأفكار بوضوح وبأسلوب مناسب للمواقف المختلفة."]})})]}),h.jsx("hr",{}),h.jsxs("p",{className:"single",children:["وكل هذه المهارات يتم تدريسها في ",h.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," تحت إشراف فريق من المدرسين المتخصصين، يقومون بتقديم التوجيه والدعم المستمر للطلاب، ويقومون بتحديد تقدم الطلاب بناءً على تقييماتهم الفردية، مما يسمح بتحديد المستويات وطرق التدريس المناسبة لاحتياجات كل طالب. ويتعامل المدرسون في أكاديمية اللغة اليابانية مع الطلاب بشكل شخصي، حيث يساعدونهم على تخطي التحديات اللغوية التي قد يواجهونها، مما يضمن تقدمهم في تعلم اللغة اليابانية بطريقة فعّالة وملائمة لمستوى كل منهم على حدى."]}),h.jsx("hr",{})]})})]})]})}const jV="/assets/OIP.Dy8GVFGD.jpg",SQ="/assets/photo_2024-10-30_14-24-02.BQ--cAxL.webp",TQ="/assets/photo_2024-11-03_14-14-22.Dkw8S-D5.jpg",yQ="/assets/_d0260767-0c90-4923-9381-3f0fb9b206d2.CEO1xR7g.jpg";function bQ(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container   mb-5 Our_Teachers",id:"Teachers",children:[h.jsxs("div",{className:"academy mb-4 ",children:[h.jsx("h2",{className:" fw-bold",children:"أعضاء الهيئة التدريسية"}),h.jsxs("p",{children:["مزيج من الخبرة والمعرفة العميقة باللغتين والثقافتين العربية واليابانية…"," "]}),h.jsx("p",{children:"نفتخر في أكاديمية اللغة اليابانية بفريق متميز من المدرسين الذين يجمعون بين الخبرة والمعرفة العميقة في اللغة والثقافة اليابانية والعربية على حد السواء. ويتكون فريق المدرسين من مجموعة متنوعة من الأساتذة، تشمل مدرّسين يابانيين يتحدثون اللغة العربية بطلاقة، مما يتيح لطلابنا تجربة تعليمية فريدة وشاملة."}),h.jsx("p",{children:"يتمتع المدرسون في أكاديمية اللغة اليابانية بخلفيات أكاديمية قوية وتجارب غنية في تدريس اللغة اليابانية للناطقين بالعربية. ويتميزون بفهم عميق للثقافتين اليابانية والعربية، مما يساعدهم في تعليم اللغة اليابانية ونقل الثقافة اليابانية لطلاب الأكاديمية بطريقة تفاعلية وممتعة. وبفضل معرفتهم المتعمقة بالاختلافات بين اللغتين العربية واليابانية، فإنهم يستطيعون تقديم شروحات تناسب احتياجات الطلاب وتساعدهم على تخطي التحديات والصعوبات اللغوية الناتجة عن الاختلافات الهيكلية بين اللغة الأم واللغة اليابانية. ويستخدم فريق التدريس أساليب تدريس مبتكرة تشمل الأنشطة التفاعلية ووسائل التعليم الحديثة، مما يسهم في خلق بيئة تعليمية محفزة. ويقومون بتقديم تعليم متميز يشجع على الاستكشاف والتفاعل، ويعزز من تجربة الطلاب في تعلم اللغة اليابانية."}),h.jsx("p",{children:"ونحن في أكاديمية اللغة اليابانية نؤمن بأن فهم اللغة لا يقتصر فقط على القواعد والمفردات، بل يتضمن أيضًا التعرف على العادات والتقاليد التي تشكل جوهر اللغة وتؤثر فيها بشكل مباشر. ونحرص على أن يكون كل درس مليئًا بالمعلومات القيمة والتجارب الثقافية، مما يمنح طلابنا أدوات للتواصل الفعّال وفهم أعمق للغة والثقافة. ونحن فخورون بفريقنا المتنوع الذي يساهم في تعزيز التفاهم بين الثقافات، ويعمل على بناء جسر ثقافي بين العالم العربي واليابان."})]}),h.jsxs("div",{className:"row",children:[h.jsx("div",{className:"col-lg-12",children:h.jsx("img",{className:"w-100",src:yQ,alt:""})}),h.jsx("div",{className:"col-lg-12",children:h.jsxs("ul",{children:[h.jsxs("li",{className:"academy position-relative mt-5 mb-5",children:[h.jsxs("div",{className:"img_teacher",children:[h.jsx("h2",{children:"الأستاذة يوكو تاناكا:"}),h.jsx("img",{className:"face",src:jV,alt:""})]}),h.jsx("p",{children:"حاصلة على درجة الماجستير في التعليم من جامعة طوكيو، ومتخصصة في تعليم اللغة اليابانية للأجانب منذ أكثر من 10 سنوات. تُجيد العربية وتعمل مع الطلاب العرب على تطوير مهاراتهم في المحادثة والتواصل الفعّال."})]}),h.jsxs("li",{className:"academy position-relative mt-5",children:[h.jsxs("h2",{children:["الأستاذة ناهد المرعي",h.jsx("span",{children:"(أستاذة في أكاديمية اللغة اليابانية)"})]}),h.jsxs("div",{className:"img_teacher",children:[h.jsxs("p",{children:["من شغف باللغة اليابانية إلى تحقيق الحلم الأكاديمي… ",h.jsx("br",{}),"لقد بدأت مسيرتي في دراسة اللغة اليابانية في عام 2009، حيث حصلت على إجازة جامعية من كلية الآداب والعلوم الإنسانية، قسم اللغة اليابانية، في جامعة دمشق. وقد كانت تجربتي الأولى كمُعيدة في قسم اللغة اليابانية خطوةً أساسية لبدء مسيرة أكاديمية هدفها نقل جماليات هذه اللغة وآدابها إلى طلابي. وخلال تلك الفترة، عملت أيضًا كمدرسة للغة اليابانية في المعهد العالي للغات في",h.jsx("br",{})]}),h.jsx("img",{className:"face",src:SQ,alt:""})]}),h.jsxs("p",{children:["جامعة دمشق, مما عزز خبرتي وأسهم في تعميق معرفتي بطرق تعليم اللغة اليابانية لغير الناطقين بها. لقد دفعني شغفي بالثقافة اليابانية للسفر إلى اليابان لمواصلة دراستي الأكاديمية، وهناك حصلت على درجة الماجستير في الأدب الياباني من جامعة تسوكوبا في عام 2015. واستكملت طريقي نحو الدكتوراه في الأدب الياباني في نفس الجامعة، حيث حصلت على درجة الدكتوراه في الأدب الياباني في عام 2020. وكانت سنوات الدراسة في اليابان غنيةً بالتحديات والفرص، حيث تعرفت على أعماق الأدب والثقافة اليابانية التي تجاوزت حدود اللغة نفسها، مما زاد من إصراري على العودة إلى الوطن والمساهمة في نقل هذه المعرفة. ",h.jsx("br",{}),"في الوقت الحالي، أعمل كعضو هيئة تدريسية في جامعة دمشق، وأسعى إلى تقديم تعليم مُثرٍ يلهم الطلاب لفهم وتقدير الثقافة اليابانية. ",h.jsx("br",{}),"ويشكل عملي في أكاديمية اللغة اليابانية جزءًا أساسيًا من أهدافي المستقبلية، حيث أطمح إلى تأسيس جيل جديد من متعلمي اللغة اليابانية بين الناطقين بالعربية، مع تمكينهم من بناء جسور ثقافية وأكاديمية تربط بين الثقافتين اليابانية والعربية."]})]}),h.jsxs("li",{className:"academy position-relative mt-5",children:[h.jsx("h2",{children:"الأستاذة ميئكو نشيئوتشي"}),h.jsxs("div",{className:"img_teacher",children:[h.jsxs("p",{children:["خبرة يابانية بطلاقة عربية لتجربة تعليمية متميزة… ",h.jsx("br",{}),"لقد بدأ شغفي باللغة والثقافة العربية منذ وقت مبكر، وأمضيت سنوات في الإقامة والعمل في المنطقة العربية، حيث انغمست في تفاصيل الحياة والثقافة العربية وتعلمت اللغة العربية حتى أتقنتها.",h.jsx("br",{})]}),h.jsx("img",{className:"face",src:TQ,alt:""})]}),h.jsxs("p",{children:["وبفضل خلفيتي الغنية التي تجمع بين الثقافة اليابانية العريقة والفهم العميق للثقافة العربية الساحرة، أود بأن أكون جسرًا ثقافيًا حقيقيًا يمكّن الطلاب من اكتساب فهم حقيقي وعميق للغة اليابانية. ",h.jsx("br",{}),"وكمعلمة للغة اليابانية أسعى إلى جعل تعلم اللغة اليابانية تجربة تفاعلية وشيقة من خلال إستراتيجيات مبتكرة، تقدم محتوى يُعنى بتسهيل فهم أساسيات اللغة، وبناء المهارات اللازمة لاستخدامها في الحياة اليومية والأكاديمية. ",h.jsx("br",{}),"ولأنني أدرك جيدًا التحديات التي قد تواجه الطلاب العرب في تعلم اللغة اليابانية، فإنني أتبنى أساليب تدريسية متقدمة تربط بين الكلمات والمفاهيم اليابانية ونظيراتها في اللغة العربية، مما يسهم في تعزيز الفهم وبناء ثقة الطلاب في مهاراتهم. ",h.jsx("br",{}),"وإضافةً إلى شغفي بالتعليم، أمتلك خبرة واسعة في الترجمة بين اللغات اليابانية والعربية والإنجليزية، مما يتيح لي تقديم شرح دقيق وموثوق للمفردات والعبارات بما يتماشى مع السياقات المختلفة، ويمكّن الطلاب من فهم واستيعاب اللغة بطريقة متكاملة. ولأنني أدرك عمق التعابير اليابانية وتعدد معانيها، كما هو الحال في اللغة العربية، فإنني قادرة على تبسيط المفاهيم الصعبة وجعلها في متناول الجميع، مما يجعل من تعليمها تجربة ممتعة، تدمج بين الاحترافية والإلهام. ",h.jsx("br",{}),"ومن خلال تعليمي للغة اليابانية في أكاديمية اللغة اليابانية أسعى لأن أكون مصدر إلهام حقيقي لكل من يرغب بتعلم هذه اللغة الجميلة، وتعريفهم على ثقافة اليابان وقيمها وعاداتها التي تجعل منها بلدًا فريدًا وساحرًا. ",h.jsx("br",{})]})]}),h.jsxs("li",{className:"academy position-relative mt-5",children:[h.jsxs("h2",{children:["الأستاذ خالد سليمان",h.jsx("span",{children:"(مدير أكاديمية اللغة اليابانية)"})]}),h.jsxs("div",{className:"img_teacher",children:[h.jsxs("p",{children:["من رحلة بين لغتين إلى بناء جسر بين ثقافتين…",h.jsx("br",{}),"عندما بدأت رحلتي الأكاديمية في كلية الاقتصاد في جامعة دمشق، كانت اليابان بالنسبة لي مجرد بلد بعيد يقع في أقصى الشرق، وكان كل ما أعرفه عن اللغة اليابانية هي تلك الحروف والكلمات الغريبة التي كانت تظهر في شاشة التلفاز عند مشاهدة (الأنمي) الياباني القادم من ذلك البلد. ",h.jsx("br",{})]}),h.jsx("img",{className:"face",src:jV,alt:""})]}),h.jsxs("p",{children:["وفجأة ودون تخطيط مُسبق، التحقت بالمعهد العالي للغات في جامعة دمشق، ومن هناك بدأت خطواتي الأولى في عالم اللغة اليابانية، حيث انفتحت أمامي نافذة إلى عالم مليء بالغرابة والجمال، ووجدت نفسي منجذبًا إلى ذلك العالم البعيد بقوة. ",h.jsx("br",{}),"ومن هناك حصلت على منحة دراسية لدراسة اللغة اليابانية في جامعة طوكيو للدراسات الأجنبية، حيث أمضيت عامًا في اليابان بين جمال اللغة وأعماق الثقافة، وأدركت أن اللغة هي مفتاح لفهم عميق لمجتمع بأكمله. ",h.jsx("br",{}),"وبعدها عُدت إلى حيث بدأت، حاملًا معي شغفًا جديدًا، وبدأت عملي مترجمًا في مكتب الوكالة اليابانية للتعاون الدولي (جايكا) في دمشق، حيث عشت تجربة الربط بين لغتين وثقافتين بشكل عملي ومؤثر. وأدركت حينها بأن الترجمة هي فن الوصل، وجسر بين الثقافات والشعوب. فكل كلمة في أي لغة هي فرصة لنسج حوار بين عالمين."," ",h.jsx("br",{}),"ولم أكتفِ عند ذلك الحد، فقد حملت معي حنينًا إلى ذلك العالم الذي صار جزءًا مني، وقررت العودة إليه مرة أخرى لأكمل دراساتي العليا. وبعد أن تنقلت بين عدة جامعات، وأنهيت دراستي في مرحلتي الماجستير والدكتوراه، أصبحت اليابان لي وطنًا ثانيًا، ليس فقط بالمعنى المكاني، بل بارتباط روحي ومعرفي. ",h.jsx("br",{}),"واليوم، وأنا أعمل كأستاذ للغة والثقافة العربية في عدة جامعات ومعاهد يابانية، وأقوم بتدريس مهارات الترجمة بين اللغتين العربية واليابانية، أجد نفسي في كل درس أو محاضرة، أقدم أكثر من كلمات، أقدم جسرًا عابرًا للقارات، بين البلاد العربية واليابان."," ",h.jsx("br",{}),"وفي أكاديمية اللغة اليابانية، أسعى لأن أتابع هذه الرسالة، وأن أنقل رحلتي إلى أشخاص يملكون ذات الشغف، لأمهد لهم طريقًا يربط بين اللغة والثقافة اليابانية، ولأساعدهم في بناء جسورهم الخاصة إلى ثقافة ثرية وجميلة، لعلهم يحملون بدورهم رسائل تقرِّب بين الثقافات، ويكتبون قصصهم الخاصة على طريقهم إلى اليابان. ",h.jsx("br",{})]})]})]})})]})]})})}const CQ="/assets/_6f2f27d9-4995-4117-aa80-149abadfed41.BnLOJiQs.jpg";function RQ(){return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"container Our_Study_materials mt-5 mb-3",id:"Study_materials",children:[h.jsx("h2",{className:"fw-bold",children:"تشمل موادنا الدراسية:"}),h.jsx("div",{className:"academy",children:h.jsxs("div",{className:"row",children:[h.jsx("div",{className:"col-lg-6",children:h.jsx("img",{className:"w-100",src:CQ,alt:""})}),h.jsx("div",{className:"col-lg-6",children:h.jsxs("ul",{children:[h.jsx("li",{children:"- كتب إلكترونية تفاعلية: تحتوي على تدريبات واختبارات لكل مستوى، مع محتوى قابل للتنزيل والقراءة في أي وقت."}),h.jsx("li",{children:"- فيديوهات تعليمية مسجلة: تُتيح لك متابعة الدروس وفق جدولك الخاص."}),h.jsx("li",{children:"- جلسات مباشرة عبر الإنترنت: مع أساتذة متخصصين لطرح الأسئلة والحصول على توضيحات."})]})})]})})]})})}const wQ="/assets/OIP.BoF6l54M.jpg";function AQ(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container More_Services",id:"More_services",children:h.jsxs("div",{className:"row academy mt-5 mb-5",children:[h.jsx("div",{className:"col-lg-6 mt-5",children:h.jsxs("ul",{children:[h.jsx("h2",{children:"خدمات إضافية:"}),h.jsxs("li",{children:[h.jsx("h5",{children:"ورش عمل حول الثقافة اليابانية:"}),h.jsx("p",{children:"نقدم ورش عمل شهرية تغطي مواضيع متنوعة مثل الثقافة الشعبية، التقاليد اليابانية، وتاريخ اليابان."})]}),h.jsxs("li",{children:[h.jsx("h5",{children:"دورات اللغة اليابانية للأعمال:"}),h.jsx("p",{children:"موجهة لمن يرغبون في تحسين مهاراتهم اللغوية في بيئات العمل اليابانية."})]})]})}),h.jsx("div",{className:"col-lg-6 ",children:h.jsx("img",{className:"w-100",src:wQ,alt:""})})]})})})}const IQ="/assets/_f43c3626-6c13-4a8d-82d5-697203e33105.DUPr2yI4.jpg";function OQ(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container Supports",id:"Support",children:h.jsxs("div",{className:"row academy  mt-5 mb-5",children:[h.jsxs("div",{className:"col-lg-6",children:[h.jsx("h2",{children:"الدعم الفني:"}),h.jsx("p",{children:"يتوفر لدينا فريق دعم فني متواجد على مدار الساعة لمساعدتك في حال واجهت أي مشاكل فنية أثناء الدراسة أو التسجيل."}),h.jsx("p",{children:"تم تحسين التفاصيل لتشمل مزيدًا من المعلومات حول البرامج الدراسية والخدمات التي تقدمها الأكاديمية."})]}),h.jsx("div",{className:"col-lg-6",children:h.jsx("img",{className:"w-100 m-auto d-flex",src:IQ,alt:""})})]})})})}const NQ="/assets/_73a4c5e5-2e9c-40f3-8260-f94d1fb42248.FeAXB9mq.jpg";function DQ(){const a=da(),r=()=>{const l=localStorage.getItem("token");a(l?"/Dash_users/:userId":"/Login_users")};return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container",children:h.jsxs("div",{className:"money_lisson mt-5",id:"Fees",children:[h.jsxs("div",{className:"row academy",children:[h.jsxs("div",{className:"col-lg-7",children:[h.jsx("h2",{className:"fw-bold mt-4",children:"الرسوم:"}),h.jsxs("p",{children:["في ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية،"})," ","نؤمن بأن فرصة تعلم اللغة اليابانية يجب أن تكون متاحة للجميع، بغض النظر عن الظروف المالية أو المعيشية. لذلك، لا تسعى الأكاديمية لتحقيق أي ربح مادي، بل تهدف إلى تمكين الطلاب من تعلم اللغة اليابانية بأعلى مستوى من الجودة والإتقان. وتضع أكاديمية اللغة اليابانية أولوياتها في توفير الفرصة لأولئك الذين يجدون صعوبة في الوصول إلى المراكز التعليمية أو الجامعات التي تقوم بتقديم برامج تعليمية متخصصة في اللغة اليابانية حول العالم."]})]}),h.jsx("div",{className:"col-lg-5",children:h.jsx("img",{className:"w-100",src:NQ,alt:""})}),h.jsxs("div",{className:"academy",children:[h.jsxs("p",{children:["وبناءً على هذه الرؤية، يتم تحديد الرسوم الدراسية في"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","بشكل رمزي، بحيث تغطي فقط النفقات الإدارية الأساسية. حيث يعمل المدرسون بشكل شبه تطوعي رغبةً منهم في تعليم اللغة اليابانية لمن يرغب في تعلمها، مما يعكس التزام الأكاديمية بتقديم تعليم عالي الجودة دون أن يكون الهدف من ورائه تحقيق أرباح مادية. حيث تسعى"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","إلى توفير بيئة تعليمية تُمكن الطلاب من التغلب على التحديات التي قد يواجهونها في تعلم اللغة اليابانية، وخاصة لأولئك الذين تمنعهم ظروفهم الشخصية أو المالية من الالتحاق بمراكز أو جامعات لغوية أخرى."]}),h.jsxs("p",{children:["وإضافة إلى ذلك، تسعى"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","إلى دعم الطلاب المتميزين من خلال تقديم منح دراسية خاصة. حيث يتم منح الطالب المتفوق في كل مستوى فرصة استكمال دراسته في المستوى الأعلى على نفقة الأكاديمية، ودون الحاجة إلى دفع أي رسوم دراسية إضافية. وهذا يُعد بمثابة تحفيز وتشجيع للطلاب الذين يُظهرون تفوقًا ملحوظًا في تعلم اللغة اليابانية، مما يساعدهم على التقدم في دراستهم وتحقيق طموحاتهم."]}),h.jsxs("p",{children:["كما نولي في"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","اهتمامًا خاصًا بالطلاب الذين يعيشون في مناطق النزاعات أو في ظروف صعبة قد تمنعهم من دفع الرسوم الدراسية. لذا فإن الأكاديمية تقوم بتقديم منح دراسية لهذه الفئة من الطلاب، بما يتيح لهم الاستفادة من التعليم دون القلق بشأن التكاليف الدراسية. فنحن نؤمن بأن لكل طالب الحق في الحصول على فرصة لتعلم اللغة اليابانية بغض النظر عن التحديات التي قد تواجهه في حياته اليومية، ونسعى إلى تقديم الدعم الكامل له لتحقيق هذا الهدف."]}),h.jsxs("p",{children:["ومن خلال هذه السياسات، تهدف"," ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","إلى جعل فرصة تعلم اللغة اليابانية متاحةً لأكبر عدد ممكن من الطلاب حول العالم، وتقديم بيئة تعليمية عادلة ومتساوية تساهم في تذليل الصعوبات التي قد تواجههم أثناء دراستهم لهذه اللغة الفريدة."]}),h.jsxs("p",{children:["في ",h.jsx("span",{className:"academySpan",children:"أكاديمية اللغة اليابانية"})," ","يتم تحديد نفس الرسوم الدراسية لجميع المستويات، ونعمل على توفير برامج تعليمية متنوعة تلبي مختلف الاحتياجات، مع مراعاة توفير باقات مرنة للطلاب، بحيث يمكن الاختيار بين الاشتراك في كل مستوى على حدى، أو الاشتراك في باقة شاملة لكل المستويات برسوم مخفَّضة."]})]})]}),h.jsx("div",{className:"levels_fees",children:h.jsxs("ul",{children:[h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المبتدئ الأساسي (J1)"}),h.jsxs("p",{children:["سيبدأ الطلاب في هذا المستوى بتعلم أساسيات اللغة اليابانية من الصفر. سيتعلمون الحروف اليابانية الأساسية مثل الهيراغانا والكاتاكانا، بالإضافة إلى النطق الصحيح للأصوات اليابانية. كما سيتمكنون من التعريف بأنفسهم، إلقاء التحيات، وتقديم المعلومات الشخصية البسيطة مثل العمر والمهنة.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," تعلم الحروف الأساسية (الهيراغانا والكاتاكانا)",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم كيفية التعريف بالنفس باستخدام جمل اسمية بسيطة",h.jsx("br",{}),h.jsx(Qe,{}),"  فهم القواعد النحوية الأساسية مثل تركيب الجمل الاسمية البسيطة",h.jsx("br",{}),h.jsx(Qe,{}),"  اكتساب مفردات أساسية تتعلق بالتحيات، العمل، الأنشطة اليومية",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المبتدئ المتوسط (J2)"}),h.jsxs("p",{children:["سيستمر الطلاب في هذا المستوى في تعلم المفردات والجمل الأكثر تعقيدًا. سيتعلمون كيفية طرح الأسئلة واستخدام الأفعال في الزمن الماضي والمستقبل. كما سيكتسبون القدرة على التفاعل بشكل أفضل في المواقف اليومية مثل التسوق أو طلب الطعام في المطاعم، وبالتالي تعزيز قدرة الطلاب على إجراء محادثات بسيطة وفعّالة مع اليابانيين في مواقف الحياة اليومية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم صيغة الماضي والمستقبل للأفعال",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم كيفية طرح الأسئلة باستخدام أدوات الاستفهام (ما، أين، لماذا، متى)",h.jsx("br",{}),h.jsx(Qe,{}),"  توسيع القدرة على فهم المحادثات اليومية البسيطة",h.jsx("br",{}),h.jsx(Qe,{})," تعلم 40 حرف كانجي قراءةً وكتابةً، بمعدل حرفين في كل حصة دراسية",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المبتدئ المتقدم (J3)"}),h.jsxs("p",{children:["يركز هذا المستوى على استخدام لغة أكثر تعقيدًا لتمكين الطلاب من التعبير عن آرائهم وأفكارهم. وسيتعلم الطلاب كيفية التحدث عن رغباتهم واحتمالات حدوث شيء ما. كما سيكتسبون القدرة على وصف الأنشطة اليومية بتفصيل أكبر، وبالتالي تطوير قدرة الطلاب على بناء جمل أكثر تعبيرًا وتنظيمًا، مما يساعدهم في التفاعل بشكل أفضل في محادثات يومية أكثر تعقيدًا.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," اكتساب القدرة على التعبير عن الرغبات",h.jsx("br",{}),h.jsx(Qe,{}),"  التحدث عن الأنشطة اليومية بتفاصيل دقيقة",h.jsx("br",{}),h.jsx(Qe,{}),"  اكتساب القدرة على التعبير عن الاحتمالات",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم 40 حرف كانجي قراءةً وكتابةً، بمعدل حرفين في كل حصة دراسية",h.jsx("br",{}),h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المبتدئ الاحترافي (J4)"}),h.jsxs("p",{children:["يهدف هذا المستوى إلى تحسين مهارات الطلاب في استخدام اللغة اليابانية في مواقف أكثر رسمية ومهنية. وسيتعلم الطلاب في هذا المستوى كيفية التحدث بلباقة في البيئات المختلفة، باستخدام التعابير اليابانية الخاصة بالاحترام، وبالتالي تمكين الطلاب من التفاعل مع الآخرين بشكل محترف، والتعامل مع محادثات أطول حول مواضيع مختلفة.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," تعلم الأسلوب الرسمي والتعابير المهذبة في المحادثة",h.jsx("br",{}),h.jsx(Qe,{}),"  استخدام تعابير الاحترام في بيئات مختلفة",h.jsx("br",{}),h.jsx(Qe,{}),"  اكتساب القدرة على كتابة رسائل رسمية بسيطة",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم 40 حرف كانجي قراءةً وكتابةً، بمعدل حرفين في كل حصة دراسية",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"باقة المستويات المبتدئة"}),h.jsxs("p",{children:["تغطي هذه الباقة جميع المستويات من (J1) إلى (J4)، وتغطي 120 ساعة دراسية من تعلم اللغة اليابانية. وسيكتسب الطلاب إلمامًا كاملًا بأساسيات اللغة اليابانية بما في ذلك الحروف، والمفردات، والقواعد، مع تعزيز القدرة على التفاعل في مواقف الحياة اليومية والرسمية. وتتيح هذه الباقة للطلاب استكمال المهارات الأساسية للغة اليابانية من خلال دراسة شاملة ومتكاملة، ليصبح الطالب مؤهلًا لاجتياز امتحان المستوى (N5) أو حتى (N4) في اختبار الكفاءة في اللغة اليابانية (JLPT).",h.jsx("br",{}),h.jsx("br",{}),h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 120 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"100,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتوسط المبتدئ (J5)"}),h.jsxs("p",{children:["بعد مراجعة شاملة لما تمت دراسته في المستويات المبتدئة، سيبدأ الطلاب في هذا المستوى بتعلم جمل أكثر تعقيدًا، واستخدام أدوات الربط بين الجمل لتكوين جمل أطول. وسيتعلمون كيفية التعبير عن آرائهم بشكل أكثر تفصيلًا وتنظيمًا، مما سيمنحهم القدرة على التحدث حول مواضيع متنوعة بشكل أكثر انسيابية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," استخدام أدوات الربط بين الجمل",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم كيفية التعبير عن الآراء والأفكار الشخصية",h.jsx("br",{}),h.jsx(Qe,{}),"  تطوير مهارات الاستماع باستخدام نصوص حوارية متنوعة",h.jsx("br",{}),h.jsx(Qe,{}),"  تعلم 60 حرف كانجي قراءةً وكتابةً، بمعدل 3 أحرف في كل حصة دراسية",h.jsx("br",{}),h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," ","ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتوسط الأساسي (J6)"}),h.jsxs("p",{children:["سيتم في هذا المستوى تعليم الطلاب كيفية التحدث عن الأهداف المختلفة مثل الأهداف الشخصية، وأسباب اتخاذ قرارات معينة. وسيتعلمون أيضًا كيفية التشبيه في اللغة اليابانية، واستخدام الجمل المركبة للقيام بمقارنات بين الأشياء، وبالتالي تمكين الطلاب من التفاعل بشكل أكثر وضوحًا عند الحديث عن أشياء مثل التفضيلات الشخصية أو القرارات الحياتية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," اكتساب القدرة على التعبير عن الأهداف",h.jsx("br",{}),h.jsx(Qe,{})," استخدام أساليب التشبيه في اللغة اليابانية",h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن المواقف الاجتماعية مثل السفر، والدراسة، والعمل",h.jsx("br",{}),h.jsx(Qe,{})," تعلم 60 حرف كانجي قراءةً وكتابةً، بمعدل 3 أحرف في كل حصة دراسية",h.jsx("br",{}),"   ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتوسط المتقدم (J7)"}),h.jsxs("p",{children:["يركز هذا المستوى على تطوير قدرة الطلاب على التعامل مع المواقف الحياتية المعقدة مثل التعبير عن مشاعرهم، ومناقشة قضايا اجتماعية معقدة. وسيتعلم الطلاب في هذا المستوى كيفية القيام بحوارات حول موضوعات مختلفة مثل السياسة أو الثقافة، وبالتالي إكساب الطلاب القدرة على التعبير عن آرائهم بطلاقة وبشكل أكثر وضوحًا.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن المشاعر والأحاسيس الشخصية",h.jsx("br",{}),h.jsx(Qe,{})," التعبير عن الآراء الشخصية في مواضيع متنوعة",h.jsx("br",{}),h.jsx(Qe,{})," التعامل مع المواقف المتقدمة في الحياة اليومية",h.jsx("br",{}),h.jsx(Qe,{})," تعلم 60 حرف كانجي قراءةً وكتابةً، بمعدل 3 أحرف في كل حصة دراسية",h.jsx("br",{}),"   ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتوسط الاحترافي (J8)"}),h.jsxs("p",{children:["يركز هذا المستوى على تحسين المهارات اللغوية في السياقات الاحترافية تمامًا. وسيتعلم الطلاب كيفية التفاوض في المواقف المهنية، واستخدام تعابير متخصصة مثل تلك المستخدمة في الأعمال التجارية، وبالتالي تمكين الطلاب من التعامل بكفاءة مع مواقف تتطلب مستوى عالٍ من اللغة اليابانية في المجالات الأكاديمية أو المهنية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" الاهداف: "}),h.jsx("br",{}),h.jsx(Qe,{})," اكتساب المزيد من المفردات الاختصاصية",h.jsx("br",{}),h.jsx(Qe,{})," القدرة على إجراء محادثات في مجالات متنوعة",h.jsx("br",{}),h.jsx(Qe,{})," تطوير مهارات الكتابة الرسمية المهنية والأكاديمية",h.jsx("br",{}),h.jsx(Qe,{})," تعلم 60 حرف كانجي قراءةً وكتابةً، بمعدل 3 أحرف في كل حصة دراسية",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"باقة المستويات المتوسطة"}),h.jsxs("p",{children:["تغطي هذه الباقة جميع المستويات من (J5) إلى (J8)، وتشمل 120 ساعة دراسية من تعلم اللغة اليابانية. وبالتالي سيتمكن الطلاب من تطوير مهاراتهم في التحدث بشكل أكثر دقة حول مواضيع متنوعة ومعقدة. وسيتعلم الطلاب في هذه المستويات كيفية التعبير عن آرائهم حول القضايا الاجتماعية أو المهنية أو غيرها باستخدام أساليب أكثر وضوحًا. وبعد إتمام دراسة المستويات المتوسطة سيصبح الطلاب مؤهلين لاجتياز امتحان المستوى (N3) أو حتى (N2) في اختبار الكفاءة في اللغة اليابانية (JLPT).",h.jsx("br",{}),h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 120 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","100,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتقدم المبتدئ (J9)"}),h.jsxs("p",{children:["هذا المستوى يركز على تطوير المهارات اللغوية في المواضيع الأكثر تعقيدًا. سيتعلم الطلاب كيفية التعبير عن الأفكار المعقدة باستخدام التراكيب النحوية المتقدمة، والتحدث عن تجاربهم الشخصية بشكل مفصل. الهدف هنا هو تعزيز قدرة الطلاب على التواصل بسهولة في مواضيع الحياة اليومية مثل السفر، العمل، والدراسة.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," التعبير عن التجارب الشخصية باستخدام الجمل المعقدة.",h.jsx("br",{}),h.jsx(Qe,{})," استخدام التراكيب النحوية المتقدمة مثل الجمل الشرطية.",h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن الأنشطة الاجتماعية بتفاصيل دقيقة.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات الاستماع للمحادثات الطبيعية والمركبة.",h.jsx("br",{}),"     ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتقدم المتوسط (J10)"}),h.jsxs("p",{children:["في هذا المستوى، يتعلم الطلاب كيفية التعامل مع مواضيع ثقافية معقدة بشكل أكثر تعمقًا، مثل النقاشات حول القيم الاجتماعية أو القضايا المعاصرة. سيتمكن الطلاب من التعبير عن آراءهم حول مواضيع ذات طابع نظري أو ثقافي. الهدف هنا هو تقوية قدرة الطلاب على المشاركة في مناقشات فكرية مع متحدثين أصليين للغة اليابانية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن القضايا الاجتماعية والثقافية المتعمقة.",h.jsx("br",{}),h.jsx(Qe,{})," التعبير عن الرأي الشخصي حول المواضيع المعقدة.",h.jsx("br",{}),h.jsx(Qe,{})," استخدام المفردات المتخصصة مثل تلك المتعلقة بالثقافة اليابانية.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين القدرة على الكتابة حول المواضيع الأكاديمية والثقافية.",h.jsx("br",{}),"  ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتقدم الأساسي (J11)"}),h.jsxs("p",{children:["هذا المستوى يركز على تحسين قدرة الطلاب على التحدث والكتابة بشكل دقيق ومقنع حول مواضيع أكاديمية وأدبية. سيتعلم الطلاب كيفية تقديم العروض والمناقشات باللغة اليابانية بشكل متقن، بالإضافة إلى تحسين قدرتهم على التعبير عن الآراء المعقدة بشكل واضح. الهدف من هذا المستوى هو إعداد الطلاب للمشاركة في مناقشات أكاديمية أو مهنية مع المتحدثين الأصليين للغة.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التحدث والكتابة الأكاديمية.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم كيفية تقديم العروض باللغة اليابانية.",h.jsx("br",{}),h.jsx(Qe,{})," التعبير عن الآراء المعقدة حول مواضيع ثقافية وأدبية.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات الاستماع للأفكار المتقدمة.",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى المتقدم الاحترافي (J12)"}),h.jsxs("p",{children:["يركز هذا المستوى على تعزيز المهارات اللغوية في بيئات العمل الاحترافية المتقدمة. سيتعلم الطلاب كيفية التفاعل مع المتحدثين اليابانيين في سياقات مهنية مثل المؤتمرات أو المفاوضات. الهدف من هذا المستوى هو أن يصبح الطلاب قادرين على التعامل مع بيئات العمل اليابانية بشكل محترف، سواء كان ذلك في التقديمات أو المفاوضات أو الاجتماعات.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تعلم التفاوض باللغة اليابانية في بيئات العمل.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التقديم في الاجتماعات والمناسبات الرسمية.",h.jsx("br",{}),h.jsx(Qe,{})," التحدث باستخدام الأسلوب الاحترافي في المحادثات.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم المفردات المتخصصة في مجالات الأعمال.",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"باقة المستويات المتقدمة"}),h.jsxs("p",{children:["تغطي هذه الباقة المستويات من J9 حتى J12، حيث يتمكن الطلاب من تحسين مهاراتهم في التحدث والكتابة في مواضيع أكاديمية ومهنية معقدة. سيتعلمون كيفية التعبير عن آرائهم في محادثات احترافية وثقافية، مما يعزز قدرتهم على التفاعل مع المجتمع الياباني في سياقات متنوعة ومتقدمة. الهدف من هذه الباقة هو تمكين الطلاب من المشاركة بشكل طليق في محادثات ومناقشات مع المتحدثين الأصليين للغة اليابانية في بيئات أكاديمية أو مهنية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تطوير المهارات الاحترافية في العمل والتفاوض.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين الكتابة الأكاديمية والعروض.",h.jsx("br",{}),h.jsx(Qe,{})," التعامل مع المواضيع المعقدة في الاجتماعات والمناقشات.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم المفردات المتقدمة في مجالات الثقافة والأعمال.",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"120 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","100,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى الاحترافي المبتدئ (J13)"}),h.jsxs("p",{children:["يركز هذا المستوى على تعلم أسلوب اللغة اليابانية الاحترافية الموجهة إلى بيئات العمل الدولية. سيتعلم الطلاب كيفية كتابة رسائل الأعمال، والتفاعل مع الزملاء والعملاء في بيئات مهنية. الهدف من هذا المستوى هو أن يكون الطلاب قادرين على التعامل مع مواقف العمل الدولية باستخدام لغة احترافية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تعلم كتابة رسائل الأعمال والبريد الإلكتروني.",h.jsx("br",{}),h.jsx(Qe,{})," استخدام التعابير الاحترافية في بيئات العمل.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التفاوض والمحادثات مع الزملاء.",h.jsx("br",{}),h.jsx(Qe,{})," التفاعل مع العملاء باستخدام لغة مهذبة.",h.jsx("br",{}),"    ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"}),"30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"})," ","4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى الاحترافي المتوسط (J14)"}),h.jsxs("p",{children:["في هذا المستوى، يتعلم الطلاب كيفية التفاعل بشكل مهني في السياقات اليابانية الدولية. سيتعلمون كيفية إجراء المناقشات المعقدة والتعامل مع القضايا المتعلقة بالعمل الجماعي، والقيادة، وإدارة المشاريع. الهدف هو تعزيز قدرة الطلاب على الانخراط في بيئات العمل الاحترافية وتقديم آرائهم وحلولهم بوضوح.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," المشاركة في المناقشات المهنية حول موضوعات متقدمة.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم إدارة المشاريع واستخدام اللغة المتعلقة بالقيادة.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات الاستماع في سياقات العمل.",h.jsx("br",{}),h.jsx(Qe,{})," كتابة تقارير ومراسلات احترافية.",h.jsx("br",{}),"     ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"})," ","30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى الاحترافي الأساسي (J15)"}),h.jsxs("p",{children:["يركز هذا المستوى على استخدام اللغة اليابانية في السياقات الأكاديمية المتقدمة. سيتعلم الطلاب كيفية كتابة البحوث الأكاديمية، والمشاركة في مناقشات فكرية أكاديمية باستخدام أسلوب دقيق ومهني. الهدف هو أن يصبح الطلاب قادرين على التعبير عن أفكارهم بشكل أكاديمي وعلمي باللغة اليابانية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تعلم كيفية كتابة البحوث الأكاديمية.",h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن المواضيع الأكاديمية والبحث العلمي.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التحدث والكتابة في البيئة الأكاديمية.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم المفردات الخاصة بالأبحاث والكتابة العلمية.",h.jsx("br",{}),"  ",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"المستوى الاحترافي المتقدم (J16)"}),h.jsxs("p",{children:["هذا المستوى يركز على تطوير القدرة على استخدام اللغة اليابانية في البيئات الأكاديمية والمهنية المتقدمة. سيتعلم الطلاب كيفية التحدث عن القضايا المعقدة مثل السياسة أو الاقتصاد، وكيفية كتابة تقارير وتحليلات احترافية. الهدف هنا هو تمكين الطلاب من التعبير عن آرائهم وأفكارهم بوضوح في مواقف أكاديمية أو مهنية معقدة.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," التحدث عن القضايا السياسية والاقتصادية المتقدمة.",h.jsx("br",{}),h.jsx(Qe,{})," كتابة تحليلات وتقارير احترافية.",h.jsx("br",{}),h.jsx(Qe,{})," تعلم اللغة المتخصصة في الاقتصاد والسياسة.",h.jsx("br",{}),h.jsx(Qe,{})," تطوير المهارات البحثية باستخدام اللغة اليابانية.",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 30 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"عدد الطلاب في كل فصل دراسي:"}),"4 طلاب كحد أدنى و10 طلاب كحد أقصى.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"30,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]}),h.jsxs("li",{className:"p-4",children:[h.jsx("h2",{className:"fw-bold text-end",children:"باقة المستويات الاحترافية"}),h.jsxs("p",{children:["تغطي هذه الباقة جميع المستويات من J13 حتى J16، مما يسمح للطلاب بتطوير مهاراتهم في التفاعل مع المجتمع الياباني في بيئات أكاديمية ومهنية متقدمة. سيتعلم الطلاب كيفية التعامل مع موضوعات معقدة ومهام متخصصة في العمل والأبحاث الأكاديمية. الهدف من هذه الباقة هو تمكين الطلاب من المشاركة بفعالية في المحادثات الأكاديمية والمهنية مع المتحدثين الأصليين للغة اليابانية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:" التركيز: "}),h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التفاوض والإدارة في البيئات الاحترافية.",h.jsx("br",{}),h.jsx(Qe,{}),"تعلم كتابة التقارير الأكاديمية والاحترافية.",h.jsx("br",{}),h.jsx(Qe,{})," التعامل مع المواضيع المعقدة في السياسة والاقتصاد.",h.jsx("br",{}),h.jsx(Qe,{})," تحسين مهارات التواصل الأكاديمي مع المتحدثين الأصليين.",h.jsx("span",{className:"academySpan",children:"عدد الساعات الدراسية:"})," 120 ساعة دراسية، بمعدل حصتين أسبوعيًا، وساعة ونصف لكل حصة دراسية.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"الرسوم الدراسية:"}),"100,000 ين ياباني أو ما يعادلها بعملة الدولة التي يقيم فيها الطالب.",h.jsx("br",{})," ",h.jsx("span",{className:"academySpan",children:"التسجيل في هذا المستوى:"})," ","يُرجى الضغط ",h.jsx(vt,{to:"/Register_account",children:"هنا"})," للانتقال إلى صفحة التسجيل."]})]})]})}),h.jsxs("div",{className:"How_to_pay academy",children:[h.jsx("h2",{className:"fw-bold",children:"وسائل الدفع:"}),h.jsxs("div",{className:"means",children:[h.jsx("div",{className:"mean_1",onClick:r}),h.jsx("div",{className:"mean_2",onClick:r}),h.jsx("div",{className:"mean_3",onClick:r}),h.jsx("div",{className:"mean_4",onClick:r}),h.jsx("div",{className:"mean_5",onClick:r})]})]}),h.jsx("p",{children:h.jsxs("ul",{className:"academy p-4",children:[h.jsx("span",{className:"note fw-bold",children:"ملاحظات: "}),h.jsx("li",{className:"text-end",children:"عند وصول عدد الطلاب المسجلين في نفس المستوى إلى 11 طالبًا أو أكثر، يتم تقسيم الطلاب على فصلين دراسيين أو أكثر، وفقًا لعدد الطلاب المسجلين في نفس المستوى."}),h.jsx("li",{className:"text-end",children:"تتضمن جميع الرسوم الوصول إلى المواد الدراسية الرقمية، التمارين التفاعلية، والدعم المباشر مع الأساتذة."}),h.jsx("li",{className:"text-end",children:"لا يمكن استرجاع الرسوم الدراسية بعد بدء الدورة الدراسية."}),h.jsx("li",{className:"text-end",children:"يمكن استرجاع 25% من الرسوم الدراسية عند الاشتراك في إحدى باقات المستويات الشاملة."})]})})]})})})}/*! choices.js v11.0.3 | © 2024 Josh Johnson | https://github.com/jshjohnson/Choices#readme */var xA=function(a,r){return xA=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,u){l.__proto__=u}||function(l,u){for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(l[_]=u[_])},xA(a,r)};function bB(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");xA(a,r);function l(){this.constructor=a}a.prototype=r===null?Object.create(r):(l.prototype=r.prototype,new l)}var Xs=function(){return Xs=Object.assign||function(r){for(var l,u=1,_=arguments.length;u<_;u++){l=arguments[u];for(var E in l)Object.prototype.hasOwnProperty.call(l,E)&&(r[E]=l[E])}return r},Xs.apply(this,arguments)};function PQ(a,r,l){for(var u=0,_=r.length,E;u<_;u++)(E||!(u in r))&&(E||(E=Array.prototype.slice.call(r,0,u)),E[u]=r[u]);return a.concat(E||Array.prototype.slice.call(r))}var yi={ADD_CHOICE:"ADD_CHOICE",REMOVE_CHOICE:"REMOVE_CHOICE",FILTER_CHOICES:"FILTER_CHOICES",ACTIVATE_CHOICES:"ACTIVATE_CHOICES",CLEAR_CHOICES:"CLEAR_CHOICES",ADD_GROUP:"ADD_GROUP",ADD_ITEM:"ADD_ITEM",REMOVE_ITEM:"REMOVE_ITEM",HIGHLIGHT_ITEM:"HIGHLIGHT_ITEM"},Js={showDropdown:"showDropdown",hideDropdown:"hideDropdown",change:"change",choice:"choice",search:"search",addItem:"addItem",removeItem:"removeItem",highlightItem:"highlightItem",highlightChoice:"highlightChoice",unhighlightItem:"unhighlightItem"},_s={TAB_KEY:9,SHIFT_KEY:16,BACK_KEY:46,DELETE_KEY:8,ENTER_KEY:13,A_KEY:65,ESC_KEY:27,UP_KEY:38,DOWN_KEY:40,PAGE_UP_KEY:33,PAGE_DOWN_KEY:34},LQ=["fuseOptions","classNames"],nl={Text:"text",SelectOne:"select-one",SelectMultiple:"select-multiple"},xQ=function(a){return{type:yi.ADD_CHOICE,choice:a}},UV=function(a){return{type:yi.REMOVE_CHOICE,choice:a}},kQ=function(a){return{type:yi.FILTER_CHOICES,results:a}},MQ=function(a){return{type:yi.ACTIVATE_CHOICES,active:a}},jQ=function(a){return{type:yi.ADD_GROUP,group:a}},UQ=function(a){return{type:yi.ADD_ITEM,item:a}},VV=function(a){return{type:yi.REMOVE_ITEM,item:a}},Tv=function(a,r){return{type:yi.HIGHLIGHT_ITEM,item:a,highlighted:r}},VQ=function(a,r){return Math.floor(Math.random()*(r-a)+a)},FV=function(a){return Array.from({length:a},function(){return VQ(0,36).toString(36)}).join("")},FQ=function(a,r){var l=a.id||a.name&&"".concat(a.name,"-").concat(FV(2))||FV(4);return l=l.replace(/(:|\.|\[|\]|,)/g,""),l="".concat(r,"-").concat(l),l},BQ=function(a,r,l){l===void 0&&(l=1);for(var u="".concat(l>0?"next":"previous","ElementSibling"),_=a[u];_;){if(_.matches(r))return _;_=_[u]}return null},GQ=function(a,r,l){l===void 0&&(l=1);var u;return l>0?u=r.scrollTop+r.offsetHeight>=a.offsetTop+a.offsetHeight:u=a.offsetTop>=r.scrollTop,u},iS=function(a){if(typeof a!="string"){if(a==null)return"";if(typeof a=="object"){if("raw"in a)return iS(a.raw);if("trusted"in a)return a.trusted}return a}return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},HQ=function(){var a=document.createElement("div");return function(r){a.innerHTML=r.trim();for(var l=a.children[0];a.firstChild;)a.removeChild(a.firstChild);return l}}(),om=function(a,r){return typeof a=="function"?a(iS(r),r):a},BV=function(a){return typeof a=="function"?a():a},_d=function(a){if(typeof a=="string")return a;if(typeof a=="object"){if("trusted"in a)return a.trusted;if("raw"in a)return a.raw}return""},WQ=function(a){if(typeof a=="string")return a;if(typeof a=="object"){if("escaped"in a)return a.escaped;if("trusted"in a)return a.trusted}return""},aI=function(a,r){return a?WQ(r):iS(r)},Ya=function(a,r,l){a.innerHTML=aI(r,l)},KQ=function(a,r){var l=a.value,u=a.label,_=u===void 0?l:u,E=r.value,T=r.label,R=T===void 0?E:T;return _d(_).localeCompare(_d(R),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},zQ=function(a,r){return a.rank-r.rank},YQ=function(a,r,l){l===void 0&&(l=null);var u=new CustomEvent(r,{detail:l,bubbles:!0,cancelable:!0});return a.dispatchEvent(u)},qQ=function(a,r){var l=Object.keys(a).sort(),u=Object.keys(r).sort();return l.filter(function(_){return u.indexOf(_)<0})},sS=function(a){return Array.isArray(a)?a:[a]},Jf=function(a){return a&&Array.isArray(a)?a.map(function(r){return".".concat(r)}).join(""):".".concat(a)},Wt=function(a,r){var l;(l=a.classList).add.apply(l,sS(r))},oa=function(a,r){var l;(l=a.classList).remove.apply(l,sS(r))},$Q=function(a){if(typeof a<"u")try{return JSON.parse(a)}catch{return a}return{}},JQ=function(a,r,l){var u=a.itemEl;u&&(oa(u,l),Wt(u,r))},XQ=function(){function a(r){var l=r.element,u=r.type,_=r.classNames;this.element=l,this.classNames=_,this.type=u,this.isActive=!1}return a.prototype.show=function(){return Wt(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},a.prototype.hide=function(){return oa(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},a}(),GV=function(){function a(r){var l=r.element,u=r.type,_=r.classNames,E=r.position;this.element=l,this.classNames=_,this.type=u,this.position=E,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return a.prototype.shouldFlip=function(r,l){var u=!1;return this.position==="auto"?u=this.element.getBoundingClientRect().top-l>=0&&!window.matchMedia("(min-height: ".concat(r+1,"px)")).matches:this.position==="top"&&(u=!0),u},a.prototype.setActiveDescendant=function(r){this.element.setAttribute("aria-activedescendant",r)},a.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},a.prototype.open=function(r,l){Wt(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(r,l)&&(Wt(this.element,this.classNames.flippedState),this.isFlipped=!0)},a.prototype.close=function(){oa(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(oa(this.element,this.classNames.flippedState),this.isFlipped=!1)},a.prototype.addFocusState=function(){Wt(this.element,this.classNames.focusState)},a.prototype.removeFocusState=function(){oa(this.element,this.classNames.focusState)},a.prototype.enable=function(){oa(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===nl.SelectOne&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},a.prototype.disable=function(){Wt(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===nl.SelectOne&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},a.prototype.wrap=function(r){var l=this.element,u=r.parentNode;u&&(r.nextSibling?u.insertBefore(l,r.nextSibling):u.appendChild(l)),l.appendChild(r)},a.prototype.unwrap=function(r){var l=this.element,u=l.parentNode;u&&(u.insertBefore(r,l),u.removeChild(l))},a.prototype.addLoadingState=function(){Wt(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},a.prototype.removeLoadingState=function(){oa(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},a}(),QQ=function(){function a(r){var l=r.element,u=r.type,_=r.classNames,E=r.preventPaste;this.element=l,this.type=u,this.classNames=_,this.preventPaste=E,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=l.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(a.prototype,"placeholder",{set:function(r){this.element.placeholder=r},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"value",{get:function(){return this.element.value},set:function(r){this.element.value=r},enumerable:!1,configurable:!0}),a.prototype.addEventListeners=function(){var r=this.element;r.addEventListener("paste",this._onPaste),r.addEventListener("input",this._onInput,{passive:!0}),r.addEventListener("focus",this._onFocus,{passive:!0}),r.addEventListener("blur",this._onBlur,{passive:!0})},a.prototype.removeEventListeners=function(){var r=this.element;r.removeEventListener("input",this._onInput),r.removeEventListener("paste",this._onPaste),r.removeEventListener("focus",this._onFocus),r.removeEventListener("blur",this._onBlur)},a.prototype.enable=function(){var r=this.element;r.removeAttribute("disabled"),this.isDisabled=!1},a.prototype.disable=function(){var r=this.element;r.setAttribute("disabled",""),this.isDisabled=!0},a.prototype.focus=function(){this.isFocussed||this.element.focus()},a.prototype.blur=function(){this.isFocussed&&this.element.blur()},a.prototype.clear=function(r){return r===void 0&&(r=!0),this.element.value="",r&&this.setWidth(),this},a.prototype.setWidth=function(){var r=this.element;r.style.minWidth="".concat(r.placeholder.length+1,"ch"),r.style.width="".concat(r.value.length+1,"ch")},a.prototype.setActiveDescendant=function(r){this.element.setAttribute("aria-activedescendant",r)},a.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},a.prototype._onInput=function(){this.type!==nl.SelectOne&&this.setWidth()},a.prototype._onPaste=function(r){this.preventPaste&&r.preventDefault()},a.prototype._onFocus=function(){this.isFocussed=!0},a.prototype._onBlur=function(){this.isFocussed=!1},a}(),ZQ=4,HV=function(){function a(r){var l=r.element;this.element=l,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return a.prototype.prepend=function(r){var l=this.element.firstElementChild;l?this.element.insertBefore(r,l):this.element.append(r)},a.prototype.scrollToTop=function(){this.element.scrollTop=0},a.prototype.scrollToChildElement=function(r,l){var u=this;if(r){var _=this.element.offsetHeight,E=this.element.scrollTop+_,T=r.offsetHeight,R=r.offsetTop+T,w=l>0?this.element.scrollTop+R-E:r.offsetTop;requestAnimationFrame(function(){u._animateScroll(w,l)})}},a.prototype._scrollDown=function(r,l,u){var _=(u-r)/l,E=_>1?_:1;this.element.scrollTop=r+E},a.prototype._scrollUp=function(r,l,u){var _=(r-u)/l,E=_>1?_:1;this.element.scrollTop=r-E},a.prototype._animateScroll=function(r,l){var u=this,_=ZQ,E=this.element.scrollTop,T=!1;l>0?(this._scrollDown(E,_,r),E<r&&(T=!0)):(this._scrollUp(E,_,r),E>r&&(T=!0)),T&&requestAnimationFrame(function(){u._animateScroll(r,l)})},a}(),CB=function(){function a(r){var l=r.element,u=r.classNames;this.element=l,this.classNames=u,this.isDisabled=!1}return Object.defineProperty(a.prototype,"isActive",{get:function(){return this.element.dataset.choice==="active"},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"value",{get:function(){return this.element.value},set:function(r){this.element.setAttribute("value",r),this.element.value=r},enumerable:!1,configurable:!0}),a.prototype.conceal=function(){var r=this.element;Wt(r,this.classNames.input),r.hidden=!0,r.tabIndex=-1;var l=r.getAttribute("style");l&&r.setAttribute("data-choice-orig-style",l),r.setAttribute("data-choice","active")},a.prototype.reveal=function(){var r=this.element;oa(r,this.classNames.input),r.hidden=!1,r.removeAttribute("tabindex");var l=r.getAttribute("data-choice-orig-style");l?(r.removeAttribute("data-choice-orig-style"),r.setAttribute("style",l)):r.removeAttribute("style"),r.removeAttribute("data-choice")},a.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},a.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},a.prototype.triggerEvent=function(r,l){YQ(this.element,r,l||{})},a}(),eZ=function(a){bB(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r}(CB),tm=function(a,r){return r===void 0&&(r=!0),typeof a>"u"?r:!!a},RB=function(a){if(typeof a=="string"&&(a=a.split(" ").filter(function(r){return r.length})),Array.isArray(a)&&a.length)return a},ra=function(a,r,l){if(l===void 0&&(l=!0),typeof a=="string"){var u=iS(a),_=l||u===a?a:{escaped:u,raw:a},E=ra({value:a,label:_,selected:!0},!1);return E}var T=a;if("choices"in T){if(!r)throw new TypeError("optGroup is not allowed");var R=T,w=R.choices.map(function(G){return ra(G,!1)}),j={id:0,label:_d(R.label)||R.value,active:!!w.length,disabled:!!R.disabled,choices:w};return j}var P=T,U={id:0,group:null,score:0,rank:0,value:P.value,label:P.label||P.value,active:tm(P.active),selected:tm(P.selected,!1),disabled:tm(P.disabled,!1),placeholder:tm(P.placeholder,!1),highlighted:!1,labelClass:RB(P.labelClass),labelDescription:P.labelDescription,customProperties:P.customProperties};return U},tZ=function(a){return a.tagName==="INPUT"},wB=function(a){return a.tagName==="SELECT"},nZ=function(a){return a.tagName==="OPTION"},iZ=function(a){return a.tagName==="OPTGROUP"},sZ=function(a){bB(r,a);function r(l){var u=l.element,_=l.classNames,E=l.template,T=l.extractPlaceholder,R=a.call(this,{element:u,classNames:_})||this;return R.template=E,R.extractPlaceholder=T,R}return Object.defineProperty(r.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),r.prototype.addOptions=function(l){var u=this,_=document.createDocumentFragment();l.forEach(function(E){var T=E;if(!T.element){var R=u.template(T);_.appendChild(R),T.element=R}}),this.element.appendChild(_)},r.prototype.optionsAsChoices=function(){var l=this,u=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach(function(_){nZ(_)?u.push(l._optionToChoice(_)):iZ(_)&&u.push(l._optgroupToChoice(_))}),u},r.prototype._optionToChoice=function(l){return!l.hasAttribute("value")&&l.hasAttribute("placeholder")&&(l.setAttribute("value",""),l.value=""),{id:0,group:null,score:0,rank:0,value:l.value,label:l.innerText,element:l,active:!0,selected:this.extractPlaceholder?l.selected:l.hasAttribute("selected"),disabled:l.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!l.value||l.hasAttribute("placeholder")),labelClass:typeof l.dataset.labelClass<"u"?RB(l.dataset.labelClass):void 0,labelDescription:typeof l.dataset.labelDescription<"u"?l.dataset.labelDescription:void 0,customProperties:$Q(l.dataset.customProperties)}},r.prototype._optgroupToChoice=function(l){var u=this,_=l.querySelectorAll("option"),E=Array.from(_).map(function(T){return u._optionToChoice(T)});return{id:0,label:l.label||"",element:l,active:!!E.length,disabled:l.disabled,choices:E}},r}(CB),rZ={containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},WV={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(a){return!!a&&a!==""},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:KQ,shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(a){return'Press Enter to add <b>"'.concat(a,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(a){return"Remove item: ".concat(a)},maxItemText:function(a){return"Only ".concat(a," values can be added")},valueComparer:function(a,r){return a===r},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:rZ,appendGroupInSearch:!1},KV=function(a){var r=a.itemEl;r&&(r.remove(),a.itemEl=void 0)};function oZ(a,r,l){var u=a,_=!0;switch(r.type){case yi.ADD_ITEM:{r.item.selected=!0;var E=r.item.element;E&&(E.selected=!0,E.setAttribute("selected","")),u.push(r.item);break}case yi.REMOVE_ITEM:{r.item.selected=!1;var E=r.item.element;if(E){E.selected=!1,E.removeAttribute("selected");var T=E.parentElement;T&&wB(T)&&T.type===nl.SelectOne&&(T.value="")}KV(r.item),u=u.filter(function(P){return P.id!==r.item.id});break}case yi.REMOVE_CHOICE:{KV(r.choice),u=u.filter(function(j){return j.id!==r.choice.id});break}case yi.HIGHLIGHT_ITEM:{var R=r.highlighted,w=u.find(function(j){return j.id===r.item.id});w&&w.highlighted!==R&&(w.highlighted=R,l&&JQ(w,R?l.classNames.highlightedState:l.classNames.selectedState,R?l.classNames.selectedState:l.classNames.highlightedState));break}default:{_=!1;break}}return{state:u,update:_}}function aZ(a,r){var l=a,u=!0;switch(r.type){case yi.ADD_GROUP:{l.push(r.group);break}case yi.CLEAR_CHOICES:{l=[];break}default:{u=!1;break}}return{state:l,update:u}}function cZ(a,r,l){var u=a,_=!0;switch(r.type){case yi.ADD_CHOICE:{u.push(r.choice);break}case yi.REMOVE_CHOICE:{r.choice.choiceEl=void 0,r.choice.group&&(r.choice.group.choices=r.choice.group.choices.filter(function(T){return T.id!==r.choice.id})),u=u.filter(function(T){return T.id!==r.choice.id});break}case yi.ADD_ITEM:case yi.REMOVE_ITEM:{r.item.choiceEl=void 0;break}case yi.FILTER_CHOICES:{var E=[];r.results.forEach(function(T){E[T.item.id]=T}),u.forEach(function(T){var R=E[T.id];R!==void 0?(T.score=R.score,T.rank=R.rank,T.active=!0):(T.score=0,T.rank=0,T.active=!1),l&&l.appendGroupInSearch&&(T.choiceEl=void 0)});break}case yi.ACTIVATE_CHOICES:{u.forEach(function(T){T.active=r.active,l&&l.appendGroupInSearch&&(T.choiceEl=void 0)});break}case yi.CLEAR_CHOICES:{u=[];break}default:{_=!1;break}}return{state:u,update:_}}var zV={groups:aZ,items:oZ,choices:cZ},lZ=function(){function a(r){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=r}return Object.defineProperty(a.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),a.prototype.changeSet=function(r){return{groups:r,items:r,choices:r}},a.prototype.reset=function(){this._state=this.defaultState;var r=this.changeSet(!0);this._txn?this._changeSet=r:this._listeners.forEach(function(l){return l(r)})},a.prototype.subscribe=function(r){return this._listeners.push(r),this},a.prototype.dispatch=function(r){var l=this,u=this._state,_=!1,E=this._changeSet||this.changeSet(!1);Object.keys(zV).forEach(function(T){var R=zV[T](u[T],r,l._context);R.update&&(_=!0,E[T]=!0,u[T]=R.state)}),_&&(this._txn?this._changeSet=E:this._listeners.forEach(function(T){return T(E)}))},a.prototype.withTxn=function(r){this._txn++;try{r()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var l=this._changeSet;l&&(this._changeSet=void 0,this._listeners.forEach(function(u){return u(l)}))}}},Object.defineProperty(a.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"highlightedActiveItems",{get:function(){return this.items.filter(function(r){return!r.disabled&&r.active&&r.highlighted})},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"activeChoices",{get:function(){return this.choices.filter(function(r){return r.active})},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"searchableChoices",{get:function(){return this.choices.filter(function(r){return!r.disabled&&!r.placeholder})},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"activeGroups",{get:function(){var r=this;return this.state.groups.filter(function(l){var u=l.active&&!l.disabled,_=r.state.choices.some(function(E){return E.active&&!E.disabled});return u&&_},[])},enumerable:!1,configurable:!0}),a.prototype.inTxn=function(){return this._txn>0},a.prototype.getChoiceById=function(r){return this.activeChoices.find(function(l){return l.id===r})},a.prototype.getGroupById=function(r){return this.groups.find(function(l){return l.id===r})},a}(),Es={noChoices:"no-choices",noResults:"no-results",addChoice:"add-choice",generic:""};function dZ(a,r,l){return(r=hZ(r))in a?Object.defineProperty(a,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[r]=l,a}function YV(a,r){var l=Object.keys(a);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(a);r&&(u=u.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),l.push.apply(l,u)}return l}function Th(a){for(var r=1;r<arguments.length;r++){var l=arguments[r]!=null?arguments[r]:{};r%2?YV(Object(l),!0).forEach(function(u){dZ(a,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):YV(Object(l)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(l,u))})}return a}function uZ(a,r){if(typeof a!="object"||!a)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,r||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}function hZ(a){var r=uZ(a,"string");return typeof r=="symbol"?r:r+""}function Ja(a){return Array.isArray?Array.isArray(a):OB(a)==="[object Array]"}const pZ=1/0;function fZ(a){if(typeof a=="string")return a;let r=a+"";return r=="0"&&1/a==-pZ?"-0":r}function mZ(a){return a==null?"":fZ(a)}function ca(a){return typeof a=="string"}function AB(a){return typeof a=="number"}function _Z(a){return a===!0||a===!1||EZ(a)&&OB(a)=="[object Boolean]"}function IB(a){return typeof a=="object"}function EZ(a){return IB(a)&&a!==null}function _r(a){return a!=null}function hA(a){return!a.trim().length}function OB(a){return a==null?a===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}const gZ="Incorrect 'index' type",vZ=a=>`Invalid value for key ${a}`,SZ=a=>`Pattern length exceeds max of ${a}.`,TZ=a=>`Missing ${a} property in key`,yZ=a=>`Property 'weight' in key '${a}' must be a positive integer`,qV=Object.prototype.hasOwnProperty;class bZ{constructor(r){this._keys=[],this._keyMap={};let l=0;r.forEach(u=>{let _=NB(u);this._keys.push(_),this._keyMap[_.id]=_,l+=_.weight}),this._keys.forEach(u=>{u.weight/=l})}get(r){return this._keyMap[r]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function NB(a){let r=null,l=null,u=null,_=1,E=null;if(ca(a)||Ja(a))u=a,r=$V(a),l=kA(a);else{if(!qV.call(a,"name"))throw new Error(TZ("name"));const T=a.name;if(u=T,qV.call(a,"weight")&&(_=a.weight,_<=0))throw new Error(yZ(T));r=$V(T),l=kA(T),E=a.getFn}return{path:r,id:l,weight:_,src:u,getFn:E}}function $V(a){return Ja(a)?a:a.split(".")}function kA(a){return Ja(a)?a.join("."):a}function CZ(a,r){let l=[],u=!1;const _=(E,T,R)=>{if(_r(E))if(!T[R])l.push(E);else{let w=T[R];const j=E[w];if(!_r(j))return;if(R===T.length-1&&(ca(j)||AB(j)||_Z(j)))l.push(mZ(j));else if(Ja(j)){u=!0;for(let P=0,U=j.length;P<U;P+=1)_(j[P],T,R+1)}else T.length&&_(j,T,R+1)}};return _(a,ca(r)?r.split("."):r,0),u?l:l[0]}const RZ={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},wZ={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(a,r)=>a.score===r.score?a.idx<r.idx?-1:1:a.score<r.score?-1:1},AZ={location:0,threshold:.6,distance:100},IZ={useExtendedSearch:!1,getFn:CZ,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Dt=Th(Th(Th(Th({},wZ),RZ),AZ),IZ);const OZ=/[^ ]+/g;function NZ(a=1,r=3){const l=new Map,u=Math.pow(10,r);return{get(_){const E=_.match(OZ).length;if(l.has(E))return l.get(E);const T=1/Math.pow(E,.5*a),R=parseFloat(Math.round(T*u)/u);return l.set(E,R),R},clear(){l.clear()}}}class cI{constructor({getFn:r=Dt.getFn,fieldNormWeight:l=Dt.fieldNormWeight}={}){this.norm=NZ(l,3),this.getFn=r,this.isCreated=!1,this.setIndexRecords()}setSources(r=[]){this.docs=r}setIndexRecords(r=[]){this.records=r}setKeys(r=[]){this.keys=r,this._keysMap={},r.forEach((l,u)=>{this._keysMap[l.id]=u})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,ca(this.docs[0])?this.docs.forEach((r,l)=>{this._addString(r,l)}):this.docs.forEach((r,l)=>{this._addObject(r,l)}),this.norm.clear())}add(r){const l=this.size();ca(r)?this._addString(r,l):this._addObject(r,l)}removeAt(r){this.records.splice(r,1);for(let l=r,u=this.size();l<u;l+=1)this.records[l].i-=1}getValueForItemAtKeyId(r,l){return r[this._keysMap[l]]}size(){return this.records.length}_addString(r,l){if(!_r(r)||hA(r))return;let u={v:r,i:l,n:this.norm.get(r)};this.records.push(u)}_addObject(r,l){let u={i:l,$:{}};this.keys.forEach((_,E)=>{let T=_.getFn?_.getFn(r):this.getFn(r,_.path);if(_r(T)){if(Ja(T)){let R=[];const w=[{nestedArrIndex:-1,value:T}];for(;w.length;){const{nestedArrIndex:j,value:P}=w.pop();if(_r(P))if(ca(P)&&!hA(P)){let U={v:P,i:j,n:this.norm.get(P)};R.push(U)}else Ja(P)&&P.forEach((U,G)=>{w.push({nestedArrIndex:G,value:U})})}u.$[E]=R}else if(ca(T)&&!hA(T)){let R={v:T,n:this.norm.get(T)};u.$[E]=R}}}),this.records.push(u)}toJSON(){return{keys:this.keys,records:this.records}}}function DB(a,r,{getFn:l=Dt.getFn,fieldNormWeight:u=Dt.fieldNormWeight}={}){const _=new cI({getFn:l,fieldNormWeight:u});return _.setKeys(a.map(NB)),_.setSources(r),_.create(),_}function DZ(a,{getFn:r=Dt.getFn,fieldNormWeight:l=Dt.fieldNormWeight}={}){const{keys:u,records:_}=a,E=new cI({getFn:r,fieldNormWeight:l});return E.setKeys(u),E.setIndexRecords(_),E}function yv(a,{errors:r=0,currentLocation:l=0,expectedLocation:u=0,distance:_=Dt.distance,ignoreLocation:E=Dt.ignoreLocation}={}){const T=r/a.length;if(E)return T;const R=Math.abs(u-l);return _?T+R/_:R?1:T}function PZ(a=[],r=Dt.minMatchCharLength){let l=[],u=-1,_=-1,E=0;for(let T=a.length;E<T;E+=1){let R=a[E];R&&u===-1?u=E:!R&&u!==-1&&(_=E-1,_-u+1>=r&&l.push([u,_]),u=-1)}return a[E-1]&&E-u>=r&&l.push([u,E-1]),l}const fd=32;function LZ(a,r,l,{location:u=Dt.location,distance:_=Dt.distance,threshold:E=Dt.threshold,findAllMatches:T=Dt.findAllMatches,minMatchCharLength:R=Dt.minMatchCharLength,includeMatches:w=Dt.includeMatches,ignoreLocation:j=Dt.ignoreLocation}={}){if(r.length>fd)throw new Error(SZ(fd));const P=r.length,U=a.length,G=Math.max(0,Math.min(u,U));let q=E,K=G;const Y=R>1||w,ie=Y?Array(U):[];let te;for(;(te=a.indexOf(r,K))>-1;){let Ye=yv(r,{currentLocation:te,expectedLocation:G,distance:_,ignoreLocation:j});if(q=Math.min(Ye,q),K=te+P,Y){let fe=0;for(;fe<P;)ie[te+fe]=1,fe+=1}}K=-1;let Z=[],se=1,pe=P+U;const ge=1<<P-1;for(let Ye=0;Ye<P;Ye+=1){let fe=0,we=pe;for(;fe<we;)yv(r,{errors:Ye,currentLocation:G+we,expectedLocation:G,distance:_,ignoreLocation:j})<=q?fe=we:pe=we,we=Math.floor((pe-fe)/2+fe);pe=we;let Le=Math.max(1,G-we+1),Fe=T?U:Math.min(G+we,U)+P,tt=Array(Fe+2);tt[Fe+1]=(1<<Ye)-1;for(let Ze=Fe;Ze>=Le;Ze-=1){let rt=Ze-1,Qt=l[a.charAt(rt)];if(Y&&(ie[rt]=+!!Qt),tt[Ze]=(tt[Ze+1]<<1|1)&Qt,Ye&&(tt[Ze]|=(Z[Ze+1]|Z[Ze])<<1|1|Z[Ze+1]),tt[Ze]&ge&&(se=yv(r,{errors:Ye,currentLocation:rt,expectedLocation:G,distance:_,ignoreLocation:j}),se<=q)){if(q=se,K=rt,K<=G)break;Le=Math.max(1,2*G-K)}}if(yv(r,{errors:Ye+1,currentLocation:G,expectedLocation:G,distance:_,ignoreLocation:j})>q)break;Z=tt}const je={isMatch:K>=0,score:Math.max(.001,se)};if(Y){const Ye=PZ(ie,R);Ye.length?w&&(je.indices=Ye):je.isMatch=!1}return je}function xZ(a){let r={};for(let l=0,u=a.length;l<u;l+=1){const _=a.charAt(l);r[_]=(r[_]||0)|1<<u-l-1}return r}class PB{constructor(r,{location:l=Dt.location,threshold:u=Dt.threshold,distance:_=Dt.distance,includeMatches:E=Dt.includeMatches,findAllMatches:T=Dt.findAllMatches,minMatchCharLength:R=Dt.minMatchCharLength,isCaseSensitive:w=Dt.isCaseSensitive,ignoreLocation:j=Dt.ignoreLocation}={}){if(this.options={location:l,threshold:u,distance:_,includeMatches:E,findAllMatches:T,minMatchCharLength:R,isCaseSensitive:w,ignoreLocation:j},this.pattern=w?r:r.toLowerCase(),this.chunks=[],!this.pattern.length)return;const P=(G,q)=>{this.chunks.push({pattern:G,alphabet:xZ(G),startIndex:q})},U=this.pattern.length;if(U>fd){let G=0;const q=U%fd,K=U-q;for(;G<K;)P(this.pattern.substr(G,fd),G),G+=fd;if(q){const Y=U-fd;P(this.pattern.substr(Y),Y)}}else P(this.pattern,0)}searchIn(r){const{isCaseSensitive:l,includeMatches:u}=this.options;if(l||(r=r.toLowerCase()),this.pattern===r){let K={isMatch:!0,score:0};return u&&(K.indices=[[0,r.length-1]]),K}const{location:_,distance:E,threshold:T,findAllMatches:R,minMatchCharLength:w,ignoreLocation:j}=this.options;let P=[],U=0,G=!1;this.chunks.forEach(({pattern:K,alphabet:Y,startIndex:ie})=>{const{isMatch:te,score:Z,indices:se}=LZ(r,K,Y,{location:_+ie,distance:E,threshold:T,findAllMatches:R,minMatchCharLength:w,includeMatches:u,ignoreLocation:j});te&&(G=!0),U+=Z,te&&se&&(P=[...P,...se])});let q={isMatch:G,score:G?U/this.chunks.length:1};return G&&u&&(q.indices=P),q}}class al{constructor(r){this.pattern=r}static isMultiMatch(r){return JV(r,this.multiRegex)}static isSingleMatch(r){return JV(r,this.singleRegex)}search(){}}function JV(a,r){const l=a.match(r);return l?l[1]:null}class kZ extends al{constructor(r){super(r)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(r){const l=r===this.pattern;return{isMatch:l,score:l?0:1,indices:[0,this.pattern.length-1]}}}class MZ extends al{constructor(r){super(r)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(r){const u=r.indexOf(this.pattern)===-1;return{isMatch:u,score:u?0:1,indices:[0,r.length-1]}}}class jZ extends al{constructor(r){super(r)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(r){const l=r.startsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,this.pattern.length-1]}}}class UZ extends al{constructor(r){super(r)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(r){const l=!r.startsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,r.length-1]}}}class VZ extends al{constructor(r){super(r)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(r){const l=r.endsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[r.length-this.pattern.length,r.length-1]}}}class FZ extends al{constructor(r){super(r)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(r){const l=!r.endsWith(this.pattern);return{isMatch:l,score:l?0:1,indices:[0,r.length-1]}}}class LB extends al{constructor(r,{location:l=Dt.location,threshold:u=Dt.threshold,distance:_=Dt.distance,includeMatches:E=Dt.includeMatches,findAllMatches:T=Dt.findAllMatches,minMatchCharLength:R=Dt.minMatchCharLength,isCaseSensitive:w=Dt.isCaseSensitive,ignoreLocation:j=Dt.ignoreLocation}={}){super(r),this._bitapSearch=new PB(r,{location:l,threshold:u,distance:_,includeMatches:E,findAllMatches:T,minMatchCharLength:R,isCaseSensitive:w,ignoreLocation:j})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(r){return this._bitapSearch.searchIn(r)}}class xB extends al{constructor(r){super(r)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(r){let l=0,u;const _=[],E=this.pattern.length;for(;(u=r.indexOf(this.pattern,l))>-1;)l=u+E,_.push([u,l-1]);const T=!!_.length;return{isMatch:T,score:T?0:1,indices:_}}}const MA=[kZ,xB,jZ,UZ,FZ,VZ,MZ,LB],XV=MA.length,BZ=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,GZ="|";function HZ(a,r={}){return a.split(GZ).map(l=>{let u=l.trim().split(BZ).filter(E=>E&&!!E.trim()),_=[];for(let E=0,T=u.length;E<T;E+=1){const R=u[E];let w=!1,j=-1;for(;!w&&++j<XV;){const P=MA[j];let U=P.isMultiMatch(R);U&&(_.push(new P(U,r)),w=!0)}if(!w)for(j=-1;++j<XV;){const P=MA[j];let U=P.isSingleMatch(R);if(U){_.push(new P(U,r));break}}}return _})}const WZ=new Set([LB.type,xB.type]);class KZ{constructor(r,{isCaseSensitive:l=Dt.isCaseSensitive,includeMatches:u=Dt.includeMatches,minMatchCharLength:_=Dt.minMatchCharLength,ignoreLocation:E=Dt.ignoreLocation,findAllMatches:T=Dt.findAllMatches,location:R=Dt.location,threshold:w=Dt.threshold,distance:j=Dt.distance}={}){this.query=null,this.options={isCaseSensitive:l,includeMatches:u,minMatchCharLength:_,findAllMatches:T,ignoreLocation:E,location:R,threshold:w,distance:j},this.pattern=l?r:r.toLowerCase(),this.query=HZ(this.pattern,this.options)}static condition(r,l){return l.useExtendedSearch}searchIn(r){const l=this.query;if(!l)return{isMatch:!1,score:1};const{includeMatches:u,isCaseSensitive:_}=this.options;r=_?r:r.toLowerCase();let E=0,T=[],R=0;for(let w=0,j=l.length;w<j;w+=1){const P=l[w];T.length=0,E=0;for(let U=0,G=P.length;U<G;U+=1){const q=P[U],{isMatch:K,indices:Y,score:ie}=q.search(r);if(K){if(E+=1,R+=ie,u){const te=q.constructor.type;WZ.has(te)?T=[...T,...Y]:T.push(Y)}}else{R=0,E=0,T.length=0;break}}if(E){let U={isMatch:!0,score:R/E};return u&&(U.indices=T),U}}return{isMatch:!1,score:1}}}const jA=[];function zZ(...a){jA.push(...a)}function UA(a,r){for(let l=0,u=jA.length;l<u;l+=1){let _=jA[l];if(_.condition(a,r))return new _(a,r)}return new PB(a,r)}const zv={AND:"$and",OR:"$or"},VA={PATH:"$path",PATTERN:"$val"},FA=a=>!!(a[zv.AND]||a[zv.OR]),YZ=a=>!!a[VA.PATH],qZ=a=>!Ja(a)&&IB(a)&&!FA(a),QV=a=>({[zv.AND]:Object.keys(a).map(r=>({[r]:a[r]}))});function kB(a,r,{auto:l=!0}={}){const u=_=>{let E=Object.keys(_);const T=YZ(_);if(!T&&E.length>1&&!FA(_))return u(QV(_));if(qZ(_)){const w=T?_[VA.PATH]:E[0],j=T?_[VA.PATTERN]:_[w];if(!ca(j))throw new Error(vZ(w));const P={keyId:kA(w),pattern:j};return l&&(P.searcher=UA(j,r)),P}let R={children:[],operator:E[0]};return E.forEach(w=>{const j=_[w];Ja(j)&&j.forEach(P=>{R.children.push(u(P))})}),R};return FA(a)||(a=QV(a)),u(a)}function $Z(a,{ignoreFieldNorm:r=Dt.ignoreFieldNorm}){a.forEach(l=>{let u=1;l.matches.forEach(({key:_,norm:E,score:T})=>{const R=_?_.weight:null;u*=Math.pow(T===0&&R?Number.EPSILON:T,(R||1)*(r?1:E))}),l.score=u})}function JZ(a,r){const l=a.matches;r.matches=[],_r(l)&&l.forEach(u=>{if(!_r(u.indices)||!u.indices.length)return;const{indices:_,value:E}=u;let T={indices:_,value:E};u.key&&(T.key=u.key.src),u.idx>-1&&(T.refIndex=u.idx),r.matches.push(T)})}function XZ(a,r){r.score=a.score}function QZ(a,r,{includeMatches:l=Dt.includeMatches,includeScore:u=Dt.includeScore}={}){const _=[];return l&&_.push(JZ),u&&_.push(XZ),a.map(E=>{const{idx:T}=E,R={item:r[T],refIndex:T};return _.length&&_.forEach(w=>{w(E,R)}),R})}class Nh{constructor(r,l={},u){this.options=Th(Th({},Dt),l),this.options.useExtendedSearch,this._keyStore=new bZ(this.options.keys),this.setCollection(r,u)}setCollection(r,l){if(this._docs=r,l&&!(l instanceof cI))throw new Error(gZ);this._myIndex=l||DB(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(r){_r(r)&&(this._docs.push(r),this._myIndex.add(r))}remove(r=()=>!1){const l=[];for(let u=0,_=this._docs.length;u<_;u+=1){const E=this._docs[u];r(E,u)&&(this.removeAt(u),u-=1,_-=1,l.push(E))}return l}removeAt(r){this._docs.splice(r,1),this._myIndex.removeAt(r)}getIndex(){return this._myIndex}search(r,{limit:l=-1}={}){const{includeMatches:u,includeScore:_,shouldSort:E,sortFn:T,ignoreFieldNorm:R}=this.options;let w=ca(r)?ca(this._docs[0])?this._searchStringList(r):this._searchObjectList(r):this._searchLogical(r);return $Z(w,{ignoreFieldNorm:R}),E&&w.sort(T),AB(l)&&l>-1&&(w=w.slice(0,l)),QZ(w,this._docs,{includeMatches:u,includeScore:_})}_searchStringList(r){const l=UA(r,this.options),{records:u}=this._myIndex,_=[];return u.forEach(({v:E,i:T,n:R})=>{if(!_r(E))return;const{isMatch:w,score:j,indices:P}=l.searchIn(E);w&&_.push({item:E,idx:T,matches:[{score:j,value:E,norm:R,indices:P}]})}),_}_searchLogical(r){const l=kB(r,this.options),u=(R,w,j)=>{if(!R.children){const{keyId:U,searcher:G}=R,q=this._findMatches({key:this._keyStore.get(U),value:this._myIndex.getValueForItemAtKeyId(w,U),searcher:G});return q&&q.length?[{idx:j,item:w,matches:q}]:[]}const P=[];for(let U=0,G=R.children.length;U<G;U+=1){const q=R.children[U],K=u(q,w,j);if(K.length)P.push(...K);else if(R.operator===zv.AND)return[]}return P},_=this._myIndex.records,E={},T=[];return _.forEach(({$:R,i:w})=>{if(_r(R)){let j=u(l,R,w);j.length&&(E[w]||(E[w]={idx:w,item:R,matches:[]},T.push(E[w])),j.forEach(({matches:P})=>{E[w].matches.push(...P)}))}}),T}_searchObjectList(r){const l=UA(r,this.options),{keys:u,records:_}=this._myIndex,E=[];return _.forEach(({$:T,i:R})=>{if(!_r(T))return;let w=[];u.forEach((j,P)=>{w.push(...this._findMatches({key:j,value:T[P],searcher:l}))}),w.length&&E.push({idx:R,item:T,matches:w})}),E}_findMatches({key:r,value:l,searcher:u}){if(!_r(l))return[];let _=[];if(Ja(l))l.forEach(({v:E,i:T,n:R})=>{if(!_r(E))return;const{isMatch:w,score:j,indices:P}=u.searchIn(E);w&&_.push({score:j,key:r,value:E,idx:T,norm:R,indices:P})});else{const{v:E,n:T}=l,{isMatch:R,score:w,indices:j}=u.searchIn(E);R&&_.push({score:w,key:r,value:E,norm:T,indices:j})}return _}}Nh.version="7.0.0";Nh.createIndex=DB;Nh.parseIndex=DZ;Nh.config=Dt;Nh.parseQuery=kB;zZ(KZ);var ZZ=function(){function a(r){this._haystack=[],this._fuseOptions=Xs(Xs({},r.fuseOptions),{keys:PQ([],r.searchFields),includeMatches:!0})}return a.prototype.index=function(r){this._haystack=r,this._fuse&&this._fuse.setCollection(r)},a.prototype.reset=function(){this._haystack=[],this._fuse=void 0},a.prototype.isEmptyIndex=function(){return!this._haystack.length},a.prototype.search=function(r){this._fuse||(this._fuse=new Nh(this._haystack,this._fuseOptions));var l=this._fuse.search(r);return l.map(function(u,_){return{item:u.item,score:u.score||0,rank:_+1}})},a}();function eee(a){return new ZZ(a)}var tee=function(a){for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r))return!1;return!0},pA=function(a,r,l){var u=a.dataset,_=r.customProperties,E=r.labelClass,T=r.labelDescription;E&&(u.labelClass=sS(E).join(" ")),T&&(u.labelDescription=T),l&&_&&(typeof _=="string"?u.customProperties=_:typeof _=="object"&&!tee(_)&&(u.customProperties=JSON.stringify(_)))},ZV=function(a,r,l){var u=r&&a.querySelector("label[for='".concat(r,"']")),_=u&&u.innerText;_&&l.setAttribute("aria-label",_)},nee={containerOuter:function(a,r,l,u,_,E,T){var R=a.classNames.containerOuter,w=document.createElement("div");return Wt(w,R),w.dataset.type=E,r&&(w.dir=r),u&&(w.tabIndex=0),l&&(w.setAttribute("role",_?"combobox":"listbox"),_?w.setAttribute("aria-autocomplete","list"):T||ZV(this._docRoot,this.passedElement.element.id,w),w.setAttribute("aria-haspopup","true"),w.setAttribute("aria-expanded","false")),T&&w.setAttribute("aria-labelledby",T),w},containerInner:function(a){var r=a.classNames.containerInner,l=document.createElement("div");return Wt(l,r),l},itemList:function(a,r){var l=a.searchEnabled,u=a.classNames,_=u.list,E=u.listSingle,T=u.listItems,R=document.createElement("div");return Wt(R,_),Wt(R,r?E:T),this._isSelectElement&&l&&R.setAttribute("role","listbox"),R},placeholder:function(a,r){var l=a.allowHTML,u=a.classNames.placeholder,_=document.createElement("div");return Wt(_,u),Ya(_,l,r),_},item:function(a,r,l){var u=a.allowHTML,_=a.removeItemButtonAlignLeft,E=a.removeItemIconText,T=a.removeItemLabelText,R=a.classNames,w=R.item,j=R.button,P=R.highlightedState,U=R.itemSelectable,G=R.placeholder,q=_d(r.value),K=document.createElement("div");if(Wt(K,w),r.labelClass){var Y=document.createElement("span");Ya(Y,u,r.label),Wt(Y,r.labelClass),K.appendChild(Y)}else Ya(K,u,r.label);if(K.dataset.item="",K.dataset.id=r.id,K.dataset.value=q,pA(K,r,!0),(r.disabled||this.containerOuter.isDisabled)&&K.setAttribute("aria-disabled","true"),this._isSelectElement&&(K.setAttribute("aria-selected","true"),K.setAttribute("role","option")),r.placeholder&&(Wt(K,G),K.dataset.placeholder=""),Wt(K,r.highlighted?P:U),l){r.disabled&&oa(K,U),K.dataset.deletable="";var ie=document.createElement("button");ie.type="button",Wt(ie,j),Ya(ie,!0,om(E,r.value));var te=om(T,r.value);te&&ie.setAttribute("aria-label",te),ie.dataset.button="",_?K.insertAdjacentElement("afterbegin",ie):K.appendChild(ie)}return K},choiceList:function(a,r){var l=a.classNames.list,u=document.createElement("div");return Wt(u,l),r||u.setAttribute("aria-multiselectable","true"),u.setAttribute("role","listbox"),u},choiceGroup:function(a,r){var l=a.allowHTML,u=a.classNames,_=u.group,E=u.groupHeading,T=u.itemDisabled,R=r.id,w=r.label,j=r.disabled,P=_d(w),U=document.createElement("div");Wt(U,_),j&&Wt(U,T),U.setAttribute("role","group"),U.dataset.group="",U.dataset.id=R,U.dataset.value=P,j&&U.setAttribute("aria-disabled","true");var G=document.createElement("div");return Wt(G,E),Ya(G,l,w||""),U.appendChild(G),U},choice:function(a,r,l,u){var _=a.allowHTML,E=a.classNames,T=E.item,R=E.itemChoice,w=E.itemSelectable,j=E.selectedState,P=E.itemDisabled,U=E.description,G=E.placeholder,q=r.label,K=_d(r.value),Y=document.createElement("div");Y.id=r.elementId,Wt(Y,T),Wt(Y,R),u&&typeof q=="string"&&(q=aI(_,q),q+=" (".concat(u,")"),q={trusted:q});var ie=Y;if(r.labelClass){var te=document.createElement("span");Ya(te,_,q),Wt(te,r.labelClass),ie=te,Y.appendChild(te)}else Ya(Y,_,q);if(r.labelDescription){var Z="".concat(r.elementId,"-description");ie.setAttribute("aria-describedby",Z);var se=document.createElement("span");Ya(se,_,r.labelDescription),se.id=Z,Wt(se,U),Y.appendChild(se)}return r.selected&&Wt(Y,j),r.placeholder&&Wt(Y,G),Y.setAttribute("role",r.group?"treeitem":"option"),Y.dataset.choice="",Y.dataset.id=r.id,Y.dataset.value=K,l&&(Y.dataset.selectText=l),r.group&&(Y.dataset.groupId="".concat(r.group.id)),pA(Y,r,!1),r.disabled?(Wt(Y,P),Y.dataset.choiceDisabled="",Y.setAttribute("aria-disabled","true")):(Wt(Y,w),Y.dataset.choiceSelectable=""),Y},input:function(a,r){var l=a.classNames,u=l.input,_=l.inputCloned,E=a.labelId,T=document.createElement("input");return T.type="search",Wt(T,u),Wt(T,_),T.autocomplete="off",T.autocapitalize="off",T.spellcheck=!1,T.setAttribute("role","textbox"),T.setAttribute("aria-autocomplete","list"),r?T.setAttribute("aria-label",r):E||ZV(this._docRoot,this.passedElement.element.id,T),T},dropdown:function(a){var r=a.classNames,l=r.list,u=r.listDropdown,_=document.createElement("div");return Wt(_,l),Wt(_,u),_.setAttribute("aria-expanded","false"),_},notice:function(a,r,l){var u=a.classNames,_=u.item,E=u.itemChoice,T=u.addChoice,R=u.noResults,w=u.noChoices,j=u.notice;l===void 0&&(l=Es.generic);var P=document.createElement("div");switch(Ya(P,!0,r),Wt(P,_),Wt(P,E),Wt(P,j),l){case Es.addChoice:Wt(P,T);break;case Es.noResults:Wt(P,R);break;case Es.noChoices:Wt(P,w);break}return l===Es.addChoice&&(P.dataset.choiceSelectable="",P.dataset.choice=""),P},option:function(a){var r=_d(a.label),l=new Option(r,a.value,!1,a.selected);return pA(l,a,!0),l.disabled=a.disabled,a.selected&&l.setAttribute("selected",""),l}},iee="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,see={},fA=function(a){if(a)return a.dataset.id?parseInt(a.dataset.id,10):void 0},Xf="[data-choice-selectable]",Qf=function(){function a(r,l){r===void 0&&(r="[data-choice]"),l===void 0&&(l={});var u=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var _=a.defaults;this.config=Xs(Xs(Xs({},_.allOptions),_.options),l),LQ.forEach(function(te){u.config[te]=Xs(Xs(Xs({},_.allOptions[te]),_.options[te]),l[te])});var E=this.config;E.silent||this._validateConfig();var T=E.shadowRoot||document.documentElement;this._docRoot=T;var R=typeof r=="string"?T.querySelector(r):r;if(!R||typeof R!="object"||!(tZ(R)||wB(R)))throw TypeError(!R&&typeof r=="string"?"Selector ".concat(r," failed to find an element"):"Expected one of the following types text|select-one|select-multiple");var w=R.type,j=w===nl.Text;(j||E.maxItemCount!==1)&&(E.singleModeForMultiSelect=!1),E.singleModeForMultiSelect&&(w=nl.SelectMultiple);var P=w===nl.SelectOne,U=w===nl.SelectMultiple,G=P||U;if(this._elementType=w,this._isTextElement=j,this._isSelectOneElement=P,this._isSelectMultipleElement=U,this._isSelectElement=P||U,this._canAddUserChoices=j&&E.addItems||G&&E.addChoices,typeof E.renderSelectedChoices!="boolean"&&(E.renderSelectedChoices=E.renderSelectedChoices==="always"||P),E.closeDropdownOnSelect==="auto"?E.closeDropdownOnSelect=j||P||E.singleModeForMultiSelect:E.closeDropdownOnSelect=tm(E.closeDropdownOnSelect),E.placeholder&&(E.placeholderValue?this._hasNonChoicePlaceholder=!0:R.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,E.placeholderValue=R.dataset.placeholder)),l.addItemFilter&&typeof l.addItemFilter!="function"){var q=l.addItemFilter instanceof RegExp?l.addItemFilter:new RegExp(l.addItemFilter);E.addItemFilter=q.test.bind(q)}if(this._isTextElement)this.passedElement=new eZ({element:R,classNames:E.classNames});else{var K=R;this.passedElement=new sZ({element:K,classNames:E.classNames,template:function(te){return u._templates.option(te)},extractPlaceholder:E.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new lZ(E),this._currentValue="",E.searchEnabled=!j&&E.searchEnabled||U,this._canSearch=E.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=FQ(R,"choices-"),this._direction=R.dir,!this._direction){var Y=window.getComputedStyle(R).direction,ie=window.getComputedStyle(document.documentElement).direction;Y!==ie&&(this._direction=Y)}if(this._idNames={itemChoice:"item-choice"},this._templates=_.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive){E.silent||console.warn("Trying to initialise Choices on element already initialised",{element:r}),this.initialised=!0,this.initialisedOK=!1;return}this.init(),this._initialItems=this._store.items.map(function(te){return te.value})}return Object.defineProperty(a,"defaults",{get:function(){return Object.preventExtensions({get options(){return see},get allOptions(){return WV},get templates(){return nee}})},enumerable:!1,configurable:!0}),a.prototype.init=function(){if(!(this.initialised||this.initialisedOK!==void 0)){this._searcher=eee(this.config),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var r=this.config.callbackOnInit;typeof r=="function"&&r.call(this)}},a.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=a.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},a.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},a.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},a.prototype.highlightItem=function(r,l){if(l===void 0&&(l=!0),!r||!r.id)return this;var u=this._store.items.find(function(_){return _.id===r.id});return!u||u.highlighted?this:(this._store.dispatch(Tv(u,!0)),l&&this.passedElement.triggerEvent(Js.highlightItem,this._getChoiceForOutput(u)),this)},a.prototype.unhighlightItem=function(r,l){if(l===void 0&&(l=!0),!r||!r.id)return this;var u=this._store.items.find(function(_){return _.id===r.id});return!u||!u.highlighted?this:(this._store.dispatch(Tv(u,!1)),l&&this.passedElement.triggerEvent(Js.unhighlightItem,this._getChoiceForOutput(u)),this)},a.prototype.highlightAll=function(){var r=this;return this._store.withTxn(function(){r._store.items.forEach(function(l){l.highlighted||(r._store.dispatch(Tv(l,!0)),r.passedElement.triggerEvent(Js.highlightItem,r._getChoiceForOutput(l)))})}),this},a.prototype.unhighlightAll=function(){var r=this;return this._store.withTxn(function(){r._store.items.forEach(function(l){l.highlighted&&(r._store.dispatch(Tv(l,!1)),r.passedElement.triggerEvent(Js.highlightItem,r._getChoiceForOutput(l)))})}),this},a.prototype.removeActiveItemsByValue=function(r){var l=this;return this._store.withTxn(function(){l._store.items.filter(function(u){return u.value===r}).forEach(function(u){return l._removeItem(u)})}),this},a.prototype.removeActiveItems=function(r){var l=this;return this._store.withTxn(function(){l._store.items.filter(function(u){var _=u.id;return _!==r}).forEach(function(u){return l._removeItem(u)})}),this},a.prototype.removeHighlightedItems=function(r){var l=this;return r===void 0&&(r=!1),this._store.withTxn(function(){l._store.highlightedActiveItems.forEach(function(u){l._removeItem(u),r&&l._triggerChange(u.value)})}),this},a.prototype.showDropdown=function(r){var l=this;return this.dropdown.isActive?this:(r===void 0&&(r=!this._canSearch),requestAnimationFrame(function(){l.dropdown.show();var u=l.dropdown.element.getBoundingClientRect();l.containerOuter.open(u.bottom,u.height),r||l.input.focus(),l.passedElement.triggerEvent(Js.showDropdown)}),this)},a.prototype.hideDropdown=function(r){var l=this;return this.dropdown.isActive?(requestAnimationFrame(function(){l.dropdown.hide(),l.containerOuter.close(),!r&&l._canSearch&&(l.input.removeActiveDescendant(),l.input.blur()),l.passedElement.triggerEvent(Js.hideDropdown)}),this):this},a.prototype.getValue=function(r){var l=this,u=this._store.items.map(function(_){return r?_.value:l._getChoiceForOutput(_)});return this._isSelectOneElement||this.config.singleModeForMultiSelect?u[0]:u},a.prototype.setValue=function(r){var l=this;return this.initialisedOK?(this._store.withTxn(function(){r.forEach(function(u){u&&l._addChoice(ra(u,!1))})}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},a.prototype.setChoiceByValue=function(r){var l=this;return this.initialisedOK?this._isTextElement?this:(this._store.withTxn(function(){var u=Array.isArray(r)?r:[r];u.forEach(function(_){return l._findAndSelectChoiceByValue(_)}),l.unhighlightAll()}),this._searcher.reset(),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},a.prototype.setChoices=function(r,l,u,_,E){var T=this;if(r===void 0&&(r=[]),l===void 0&&(l="value"),u===void 0&&(u="label"),_===void 0&&(_=!1),E===void 0&&(E=!0),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if(typeof l!="string"||!l)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(_&&this.clearChoices(),typeof r=="function"){var R=r(this);if(typeof Promise=="function"&&R instanceof Promise)return new Promise(function(w){return requestAnimationFrame(w)}).then(function(){return T._handleLoadingState(!0)}).then(function(){return R}).then(function(w){return T.setChoices(w,l,u,_)}).catch(function(w){T.config.silent||console.error(w)}).then(function(){return T._handleLoadingState(!1)}).then(function(){return T});if(!Array.isArray(R))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(typeof R));return this.setChoices(R,l,u,!1)}if(!Array.isArray(r))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn(function(){E&&(T._isSearching=!1);var w=l==="value",j=u==="label";r.forEach(function(P){if("choices"in P){var U=P;j||(U=Xs(Xs({},U),{label:U[u]})),T._addGroup(ra(U,!0))}else{var G=P;(!j||!w)&&(G=Xs(Xs({},G),{value:G[l],label:G[u]})),T._addChoice(ra(G,!1))}}),T.unhighlightAll()}),this._searcher.reset(),this},a.prototype.refresh=function(r,l,u){var _=this;return r===void 0&&(r=!1),l===void 0&&(l=!1),u===void 0&&(u=!1),this._isSelectElement?(this._store.withTxn(function(){var E=_.passedElement.optionsAsChoices(),T={};u||_._store.items.forEach(function(w){w.id&&w.active&&w.selected&&!w.disabled&&(T[w.value]=!0)}),_.clearStore(!1);var R=function(w){u?_._store.dispatch(VV(w)):T[w.value]&&(w.selected=!0)};E.forEach(function(w){if("choices"in w){w.choices.forEach(R);return}R(w)}),_._addPredefinedChoices(E,l,r),_._isSearching&&_._searchChoices(_.input.value)}),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},a.prototype.removeChoice=function(r){var l=this._store.choices.find(function(u){return u.value===r});return l?(this._clearNotice(),this._store.dispatch(UV(l)),this._searcher.reset(),l.selected&&this.passedElement.triggerEvent(Js.removeItem,this._getChoiceForOutput(l)),this):this},a.prototype.clearChoices=function(){var r=this;return this._store.withTxn(function(){r._store.choices.forEach(function(l){l.selected||r._store.dispatch(UV(l))})}),this._searcher.reset(),this},a.prototype.clearStore=function(r){return r===void 0&&(r=!0),this._stopSearch(),r&&this.passedElement.element.replaceChildren(""),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._clearNotice(),this._store.reset(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this._searcher.reset(),this},a.prototype.clearInput=function(){var r=!this._isSelectOneElement;return this.input.clear(r),this._stopSearch(),this},a.prototype._validateConfig=function(){var r=this.config,l=qQ(r,WV);l.length&&console.warn("Unknown config option(s) passed",l.join(", ")),r.allowHTML&&r.allowHtmlUserInput&&(r.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),r.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},a.prototype._render=function(r){r===void 0&&(r={choices:!0,groups:!0,items:!0}),!this._store.inTxn()&&(this._isSelectElement&&(r.choices||r.groups)&&this._renderChoices(),r.items&&this._renderItems())},a.prototype._renderChoices=function(){var r=this;if(this._canAddItems()){var l=this,u=l.config,_=l._isSearching,E=this._store,T=E.activeGroups,R=E.activeChoices,w=0;if(_&&u.searchResultLimit>0?w=u.searchResultLimit:u.renderChoiceLimit>0&&(w=u.renderChoiceLimit),this._isSelectElement){var j=R.filter(function(K){return!K.element});j.length&&this.passedElement.addOptions(j)}var P=document.createDocumentFragment(),U=function(K){return K.filter(function(Y){return!Y.placeholder&&(_?!!Y.rank:u.renderSelectedChoices||!Y.selected)})},G=!1,q=function(K,Y,ie){_?K.sort(zQ):u.shouldSort&&K.sort(u.sorter);var te=K.length;te=!Y&&w&&te>w?w:te,te--,K.every(function(Z,se){var pe=Z.choiceEl||r._templates.choice(u,Z,u.itemSelectText,ie);return Z.choiceEl=pe,P.appendChild(pe),!Z.disabled&&(_||!Z.selected)&&(G=!0),se<te})};R.length&&(u.resetScrollPosition&&requestAnimationFrame(function(){return r.choiceList.scrollToTop()}),!this._hasNonChoicePlaceholder&&!_&&this._isSelectOneElement&&q(R.filter(function(K){return K.placeholder&&!K.group}),!1,void 0),T.length&&!_?(u.shouldSort&&T.sort(u.sorter),q(R.filter(function(K){return!K.placeholder&&!K.group}),!1,void 0),T.forEach(function(K){var Y=U(K.choices);if(Y.length){if(K.label){var ie=K.groupEl||r._templates.choiceGroup(r.config,K);K.groupEl=ie,ie.remove(),P.appendChild(ie)}q(Y,!0,u.appendGroupInSearch&&_?K.label:void 0)}})):q(U(R),!1,void 0)),G||(this._notice||(this._notice={text:BV(_?u.noResultsText:u.noChoicesText),type:_?Es.noResults:Es.noChoices}),P.replaceChildren("")),this._renderNotice(P),this.choiceList.element.replaceChildren(P),G&&this._highlightChoice()}},a.prototype._renderItems=function(){var r=this,l=this._store.items||[],u=this.itemList.element,_=this.config,E=document.createDocumentFragment(),T=function(U){return u.querySelector('[data-item][data-id="'.concat(U.id,'"]'))},R=function(U){var G=U.itemEl;G&&G.parentElement||(G=T(U)||r._templates.item(_,U,_.removeItemButton),U.itemEl=G,E.appendChild(G))};l.forEach(R);var w=!!E.childNodes.length;if(this._isSelectOneElement&&this._hasNonChoicePlaceholder){var j=u.children.length;if(w||j>1){var P=u.querySelector(Jf(_.classNames.placeholder));P&&P.remove()}else j||(w=!0,R(ra({selected:!0,value:"",label:_.placeholderValue||"",placeholder:!0},!1)))}w&&(u.append(E),_.shouldSortItems&&!this._isSelectOneElement&&(l.sort(_.sorter),l.forEach(function(U){var G=T(U);G&&(G.remove(),E.append(G))}),u.append(E))),this._isTextElement&&(this.passedElement.value=l.map(function(U){var G=U.value;return G}).join(_.delimiter))},a.prototype._displayNotice=function(r,l,u){u===void 0&&(u=!0);var _=this._notice;if(_&&(_.type===l&&_.text===r||_.type===Es.addChoice&&(l===Es.noResults||l===Es.noChoices))){u&&this.showDropdown(!0);return}this._clearNotice(),this._notice=r?{text:r,type:l}:void 0,this._renderNotice(),u&&r&&this.showDropdown(!0)},a.prototype._clearNotice=function(){if(this._notice){var r=this.choiceList.element.querySelector(Jf(this.config.classNames.notice));r&&r.remove(),this._notice=void 0}},a.prototype._renderNotice=function(r){var l=this._notice;if(l){var u=this._templates.notice(this.config,l.text,l.type);r?r.append(u):this.choiceList.prepend(u)}},a.prototype._getChoiceForOutput=function(r,l){return{id:r.id,highlighted:r.highlighted,labelClass:r.labelClass,labelDescription:r.labelDescription,customProperties:r.customProperties,disabled:r.disabled,active:r.active,label:r.label,placeholder:r.placeholder,value:r.value,groupValue:r.group?r.group.label:void 0,element:r.element,keyCode:l}},a.prototype._triggerChange=function(r){r!=null&&this.passedElement.triggerEvent(Js.change,{value:r})},a.prototype._handleButtonAction=function(r){var l=this,u=this._store.items;if(!(!u.length||!this.config.removeItems||!this.config.removeItemButton)){var _=r&&fA(r.parentElement),E=_&&u.find(function(T){return T.id===_});E&&this._store.withTxn(function(){if(l._removeItem(E),l._triggerChange(E.value),l._isSelectOneElement&&!l._hasNonChoicePlaceholder){var T=l._store.choices.reverse().find(function(R){return!R.disabled&&R.placeholder});T&&(l._addItem(T),l.unhighlightAll(),T.value&&l._triggerChange(T.value))}})}},a.prototype._handleItemAction=function(r,l){var u=this;l===void 0&&(l=!1);var _=this._store.items;if(!(!_.length||!this.config.removeItems||this._isSelectOneElement)){var E=fA(r);E&&(_.forEach(function(T){T.id===E&&!T.highlighted?u.highlightItem(T):!l&&T.highlighted&&u.unhighlightItem(T)}),this.input.focus())}},a.prototype._handleChoiceAction=function(r){var l=this,u=fA(r),_=u&&this._store.getChoiceById(u);if(!_||_.disabled)return!1;var E=this.dropdown.isActive;if(!_.selected){if(!this._canAddItems())return!0;this._store.withTxn(function(){l._addItem(_,!0,!0),l.clearInput(),l.unhighlightAll()}),this._triggerChange(_.value)}return E&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},a.prototype._handleBackspace=function(r){var l=this.config;if(!(!l.removeItems||!r.length)){var u=r[r.length-1],_=r.some(function(E){return E.highlighted});l.editItems&&!_&&u?(this.input.value=u.value,this.input.setWidth(),this._removeItem(u),this._triggerChange(u.value)):(_||this.highlightItem(u,!1),this.removeHighlightedItems(!0))}},a.prototype._loadChoices=function(){var r,l=this,u=this.config;if(this._isTextElement){if(this._presetChoices=u.items.map(function(T){return ra(T,!1)}),this.passedElement.value){var _=this.passedElement.value.split(u.delimiter).map(function(T){return ra(T,!1,l.config.allowHtmlUserInput)});this._presetChoices=this._presetChoices.concat(_)}this._presetChoices.forEach(function(T){T.selected=!0})}else if(this._isSelectElement){this._presetChoices=u.choices.map(function(T){return ra(T,!0)});var E=this.passedElement.optionsAsChoices();E&&(r=this._presetChoices).push.apply(r,E)}},a.prototype._handleLoadingState=function(r){r===void 0&&(r=!0);var l=this.itemList.element;r?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?l.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(l.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},a.prototype._handleSearch=function(r){if(this.input.isFocussed)if(r!==null&&typeof r<"u"&&r.length>=this.config.searchFloor){var l=this.config.searchChoices?this._searchChoices(r):0;l!==null&&this.passedElement.triggerEvent(Js.search,{value:r,resultCount:l})}else this._store.choices.some(function(u){return!u.active})&&this._stopSearch()},a.prototype._canAddItems=function(){var r=this.config,l=r.maxItemCount,u=r.maxItemText;return!r.singleModeForMultiSelect&&l>0&&l<=this._store.items.length?(this.choiceList.element.replaceChildren(""),this._notice=void 0,this._displayNotice(typeof u=="function"?u(l):u,Es.addChoice),!1):!0},a.prototype._canCreateItem=function(r){var l=this.config,u=!0,_="";if(u&&typeof l.addItemFilter=="function"&&!l.addItemFilter(r)&&(u=!1,_=om(l.customAddItemText,r)),u){var E=this._store.choices.find(function(T){return l.valueComparer(T.value,r)});if(this._isSelectElement){if(E)return this._displayNotice("",Es.addChoice),!1}else this._isTextElement&&!l.duplicateItemsAllowed&&E&&(u=!1,_=om(l.uniqueItemText,r))}return u&&(_=om(l.addItemText,r)),_&&this._displayNotice(_,Es.addChoice),u},a.prototype._searchChoices=function(r){var l=r.trim().replace(/\s{2,}/," ");if(!l.length||l===this._currentValue)return null;var u=this._searcher;u.isEmptyIndex()&&u.index(this._store.searchableChoices);var _=u.search(l);this._currentValue=l,this._highlightPosition=0,this._isSearching=!0;var E=this._notice,T=E&&E.type;return T!==Es.addChoice&&(_.length?this._clearNotice():this._displayNotice(BV(this.config.noResultsText),Es.noResults)),this._store.dispatch(kQ(_)),_.length},a.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch(MQ(!0)),this.passedElement.triggerEvent(Js.search,{value:"",resultCount:0}))},a.prototype._addEventListeners=function(){var r=this._docRoot,l=this.containerOuter.element,u=this.input.element;r.addEventListener("touchend",this._onTouchEnd,!0),l.addEventListener("keydown",this._onKeyDown,!0),l.addEventListener("mousedown",this._onMouseDown,!0),r.addEventListener("click",this._onClick,{passive:!0}),r.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(l.addEventListener("focus",this._onFocus,{passive:!0}),l.addEventListener("blur",this._onBlur,{passive:!0})),u.addEventListener("keyup",this._onKeyUp,{passive:!0}),u.addEventListener("input",this._onInput,{passive:!0}),u.addEventListener("focus",this._onFocus,{passive:!0}),u.addEventListener("blur",this._onBlur,{passive:!0}),u.form&&u.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},a.prototype._removeEventListeners=function(){var r=this._docRoot,l=this.containerOuter.element,u=this.input.element;r.removeEventListener("touchend",this._onTouchEnd,!0),l.removeEventListener("keydown",this._onKeyDown,!0),l.removeEventListener("mousedown",this._onMouseDown,!0),r.removeEventListener("click",this._onClick),r.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(l.removeEventListener("focus",this._onFocus),l.removeEventListener("blur",this._onBlur)),u.removeEventListener("keyup",this._onKeyUp),u.removeEventListener("input",this._onInput),u.removeEventListener("focus",this._onFocus),u.removeEventListener("blur",this._onBlur),u.form&&u.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},a.prototype._onKeyDown=function(r){var l=r.keyCode,u=this.dropdown.isActive,_=r.key.length===1||r.key.length===2&&r.key.charCodeAt(0)>=55296||r.key==="Unidentified";switch(!this._isTextElement&&!u&&l!==_s.ESC_KEY&&l!==_s.TAB_KEY&&l!==_s.SHIFT_KEY&&(this.showDropdown(),!this.input.isFocussed&&_&&(this.input.value+=r.key,r.key===" "&&r.preventDefault())),l){case _s.A_KEY:return this._onSelectKey(r,this.itemList.element.hasChildNodes());case _s.ENTER_KEY:return this._onEnterKey(r,u);case _s.ESC_KEY:return this._onEscapeKey(r,u);case _s.UP_KEY:case _s.PAGE_UP_KEY:case _s.DOWN_KEY:case _s.PAGE_DOWN_KEY:return this._onDirectionKey(r,u);case _s.DELETE_KEY:case _s.BACK_KEY:return this._onDeleteKey(r,this._store.items,this.input.isFocussed)}},a.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},a.prototype._onInput=function(){var r=this.input.value;if(!r){this._isTextElement?this.hideDropdown(!0):this._stopSearch();return}this._canAddItems()&&(this._canSearch&&this._handleSearch(r),this._canAddUserChoices&&(this._canCreateItem(r),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice())))},a.prototype._onSelectKey=function(r,l){if((r.ctrlKey||r.metaKey)&&l){this._canSearch=!1;var u=this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement;u&&this.highlightAll()}},a.prototype._onEnterKey=function(r,l){var u=this,_=this.input.value,E=r.target;if(r.preventDefault(),E&&E.hasAttribute("data-button")){this._handleButtonAction(E);return}if(!l){(this._isSelectElement||this._notice)&&this.showDropdown();return}var T=this.dropdown.element.querySelector(Jf(this.config.classNames.highlightedState));if(!(T&&this._handleChoiceAction(T))){if(!E||!_){this.hideDropdown(!0);return}if(this._canAddItems()){var R=!1;this._store.withTxn(function(){if(R=u._findAndSelectChoiceByValue(_,!0),!R){if(!u._canAddUserChoices||!u._canCreateItem(_))return;u._addChoice(ra(_,!1,u.config.allowHtmlUserInput),!0,!0),R=!0}u.clearInput(),u.unhighlightAll()}),R&&(this._triggerChange(_),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}},a.prototype._onEscapeKey=function(r,l){l&&(r.stopPropagation(),this.hideDropdown(!0),this._stopSearch(),this.containerOuter.element.focus())},a.prototype._onDirectionKey=function(r,l){var u=r.keyCode;if(l||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var _=u===_s.DOWN_KEY||u===_s.PAGE_DOWN_KEY?1:-1,E=r.metaKey||u===_s.PAGE_DOWN_KEY||u===_s.PAGE_UP_KEY,T=void 0;if(E)_>0?T=this.dropdown.element.querySelector("".concat(Xf,":last-of-type")):T=this.dropdown.element.querySelector(Xf);else{var R=this.dropdown.element.querySelector(Jf(this.config.classNames.highlightedState));R?T=BQ(R,Xf,_):T=this.dropdown.element.querySelector(Xf)}T&&(GQ(T,this.choiceList.element,_)||this.choiceList.scrollToChildElement(T,_),this._highlightChoice(T)),r.preventDefault()}},a.prototype._onDeleteKey=function(r,l,u){!this._isSelectOneElement&&!r.target.value&&u&&(this._handleBackspace(l),r.preventDefault())},a.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},a.prototype._onTouchEnd=function(r){var l=(r||r.touches[0]).target,u=this._wasTap&&this.containerOuter.element.contains(l);if(u){var _=l===this.containerOuter.element||l===this.containerInner.element;_&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),r.stopPropagation()}this._wasTap=!0},a.prototype._onMouseDown=function(r){var l=r.target;if(l instanceof HTMLElement){if(iee&&this.choiceList.element.contains(l)){var u=this.choiceList.element.firstElementChild;this._isScrollingOnIe=this._direction==="ltr"?r.offsetX>=u.offsetWidth:r.offsetX<u.offsetLeft}if(l!==this.input.element){var _=l.closest("[data-button],[data-item],[data-choice]");_ instanceof HTMLElement&&("button"in _.dataset?this._handleButtonAction(_):"item"in _.dataset?this._handleItemAction(_,r.shiftKey):"choice"in _.dataset&&this._handleChoiceAction(_)),r.preventDefault()}}},a.prototype._onMouseOver=function(r){var l=r.target;l instanceof HTMLElement&&"choice"in l.dataset&&this._highlightChoice(l)},a.prototype._onClick=function(r){var l=r.target,u=this.containerOuter,_=u.element.contains(l);_?!this.dropdown.isActive&&!u.isDisabled?this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),u.element.focus()):this._isSelectOneElement&&l!==this.input.element&&!this.dropdown.element.contains(l)&&this.hideDropdown():(u.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},a.prototype._onFocus=function(r){var l=r.target,u=this.containerOuter,_=l&&u.element.contains(l);if(_){var E=l===this.input.element;this._isTextElement?E&&u.addFocusState():this._isSelectMultipleElement?E&&(this.showDropdown(!0),u.addFocusState()):(u.addFocusState(),E&&this.showDropdown(!0))}},a.prototype._onBlur=function(r){var l=r.target,u=this.containerOuter,_=l&&u.element.contains(l);_&&!this._isScrollingOnIe?l===this.input.element?(u.removeFocusState(),this.hideDropdown(!0),(this._isTextElement||this._isSelectMultipleElement)&&this.unhighlightAll()):l===this.containerOuter.element&&u.removeFocusState():(this._isScrollingOnIe=!1,this.input.element.focus())},a.prototype._onFormReset=function(){var r=this;this._store.withTxn(function(){r.clearInput(),r.hideDropdown(),r.refresh(!1,!1,!0),r._initialItems.length&&r.setChoiceByValue(r._initialItems)})},a.prototype._highlightChoice=function(r){r===void 0&&(r=null);var l=Array.from(this.dropdown.element.querySelectorAll(Xf));if(l.length){var u=r,_=this.config.classNames.highlightedState,E=Array.from(this.dropdown.element.querySelectorAll(Jf(_)));E.forEach(function(T){oa(T,_),T.setAttribute("aria-selected","false")}),u?this._highlightPosition=l.indexOf(u):(l.length>this._highlightPosition?u=l[this._highlightPosition]:u=l[l.length-1],u||(u=l[0])),Wt(u,_),u.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(Js.highlightChoice,{el:u}),this.dropdown.isActive&&(this.input.setActiveDescendant(u.id),this.containerOuter.setActiveDescendant(u.id))}},a.prototype._addItem=function(r,l,u){if(l===void 0&&(l=!0),u===void 0&&(u=!1),!r.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(r.id),this._store.dispatch(UQ(r)),l&&(this.passedElement.triggerEvent(Js.addItem,this._getChoiceForOutput(r)),u&&this.passedElement.triggerEvent(Js.choice,this._getChoiceForOutput(r)))},a.prototype._removeItem=function(r){if(r.id){this._store.dispatch(VV(r));var l=this._notice;l&&l.type===Es.noChoices&&this._clearNotice(),this.passedElement.triggerEvent(Js.removeItem,this._getChoiceForOutput(r))}},a.prototype._addChoice=function(r,l,u){if(l===void 0&&(l=!0),u===void 0&&(u=!1),r.id)throw new TypeError("Can not re-add a choice which has already been added");var _=this.config;if(!((this._isSelectElement||!_.duplicateItemsAllowed)&&this._store.choices.find(function(R){return _.valueComparer(R.value,r.value)}))){this._lastAddedChoiceId++,r.id=this._lastAddedChoiceId,r.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(r.id);var E=_.prependValue,T=_.appendValue;E&&(r.value=E+r.value),T&&(r.value+=T.toString()),(E||T)&&r.element&&(r.element.value=r.value),this._clearNotice(),this._store.dispatch(xQ(r)),r.selected&&this._addItem(r,l,u)}},a.prototype._addGroup=function(r,l){var u=this;if(l===void 0&&(l=!0),r.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(jQ(r)),r.choices&&(this._lastAddedGroupId++,r.id=this._lastAddedGroupId,r.choices.forEach(function(_){_.group=r,r.disabled&&(_.disabled=!0),u._addChoice(_,l)}))},a.prototype._createTemplates=function(){var r=this,l=this.config.callbackOnCreateTemplates,u={};typeof l=="function"&&(u=l.call(this,HQ,aI,sS));var _={};Object.keys(this._templates).forEach(function(E){E in u?_[E]=u[E].bind(r):_[E]=r._templates[E].bind(r)}),this._templates=_},a.prototype._createElements=function(){var r=this._templates,l=this,u=l.config,_=l._isSelectOneElement,E=u.position,T=u.classNames,R=this._elementType;this.containerOuter=new GV({element:r.containerOuter(u,this._direction,this._isSelectElement,_,u.searchEnabled,R,u.labelId),classNames:T,type:R,position:E}),this.containerInner=new GV({element:r.containerInner(u),classNames:T,type:R,position:E}),this.input=new QQ({element:r.input(u,this._placeholderValue),classNames:T,type:R,preventPaste:!u.paste}),this.choiceList=new HV({element:r.choiceList(u,_)}),this.itemList=new HV({element:r.itemList(u,_)}),this.dropdown=new XQ({element:r.dropdown(u),classNames:T,type:R})},a.prototype._createStructure=function(){var r=this,l=r.containerInner,u=r.containerOuter,_=r.passedElement,E=this.dropdown.element;_.conceal(),l.wrap(_.element),u.wrap(l.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),u.element.appendChild(l.element),u.element.appendChild(E),l.element.appendChild(this.itemList.element),E.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&E.insertBefore(this.input.element,E.firstChild):l.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},a.prototype._initStore=function(){var r=this;this._store.subscribe(this._render).withTxn(function(){r._addPredefinedChoices(r._presetChoices,r._isSelectOneElement&&!r._hasNonChoicePlaceholder,!1)}),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},a.prototype._addPredefinedChoices=function(r,l,u){var _=this;if(l===void 0&&(l=!1),u===void 0&&(u=!0),l){var E=r.findIndex(function(T){return T.selected})===-1;E&&r.some(function(T){return T.disabled||"choices"in T?!1:(T.selected=!0,!0)})}r.forEach(function(T){"choices"in T?_._isSelectElement&&_._addGroup(T,u):_._addChoice(T,u)})},a.prototype._findAndSelectChoiceByValue=function(r,l){var u=this;l===void 0&&(l=!1);var _=this._store.choices.find(function(E){return u.config.valueComparer(E.value,r)});return _&&!_.disabled&&!_.selected?(this._addItem(_,!0,l),!0):!1},a.prototype._generatePlaceholderValue=function(){var r=this.config;if(!r.placeholder)return null;if(this._hasNonChoicePlaceholder)return r.placeholderValue;if(this._isSelectElement){var l=this.passedElement.placeholderOption;return l?l.text:null}return null},a.prototype._warnChoicesInitFailed=function(r){if(!this.config.silent)if(this.initialised){if(!this.initialisedOK)throw new TypeError("".concat(r," called for an element which has multiple instances of Choices initialised on it"))}else throw new TypeError("".concat(r," called on a non-initialised instance of Choices"))},a.version="11.0.3",a}();function ree(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M87.48 380c1.2-4.38-1.43-10.47-3.94-14.86a42.63 42.63 0 0 0-2.54-3.8 199.81 199.81 0 0 1-33-110C47.64 139.09 140.72 48 255.82 48 356.2 48 440 117.54 459.57 209.85a199 199 0 0 1 4.43 41.64c0 112.41-89.49 204.93-204.59 204.93-18.31 0-43-4.6-56.47-8.37s-26.92-8.77-30.39-10.11a31.14 31.14 0 0 0-11.13-2.07 30.7 30.7 0 0 0-12.08 2.43L81.5 462.78a15.92 15.92 0 0 1-4.66 1.22 9.61 9.61 0 0 1-9.58-9.74 15.85 15.85 0 0 1 .6-3.29z"},child:[]},{tag:"circle",attr:{cx:"160",cy:"256",r:"32"},child:[]},{tag:"circle",attr:{cx:"256",cy:"256",r:"32"},child:[]},{tag:"circle",attr:{cx:"352",cy:"256",r:"32"},child:[]}]})(a)}function BA(a){return Ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"circle",attr:{cx:"256",cy:"256",r:"64"},child:[]},{tag:"path",attr:{d:"M394.82 141.18C351.1 111.2 304.31 96 255.76 96c-43.69 0-86.28 13-126.59 38.48C88.52 160.23 48.67 207 16 256c26.42 44 62.56 89.24 100.2 115.18C159.38 400.92 206.33 416 255.76 416c49 0 95.85-15.07 139.3-44.79C433.31 345 469.71 299.82 496 256c-26.38-43.43-62.9-88.56-101.18-114.82zM256 352a96 96 0 1 1 96-96 96.11 96.11 0 0 1-96 96z"},child:[]}]})(a)}function oee(){const[a,r]=ee.useState({firstName:"",lastName:"",country:"",age:"",gender:"",educationLevel:"",japaneseLevel:"",phone:"",email:"",password:"",confirmPassword:""}),[l,u]=ee.useState(""),[_,E]=ee.useState(!1),[T,R]=ee.useState(""),[w,j]=ee.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,specialChar:!1}),[P,U]=ee.useState(!1),[G,q]=ee.useState(!1),[K,Y]=ee.useState("ltr"),ie=ee.useRef(null),te=ee.useRef(null),Z=ee.useRef(null),se=ee.useRef(null),pe=ee.useRef(null),[ge,je]=ee.useState(""),[Ye,fe]=ee.useState(!1),[we,Le]=ee.useState(""),[Fe,tt]=ee.useState(""),[Me,Ze]=ee.useState(""),[rt,Qt]=ee.useState(""),rs=da();ee.useEffect(()=>{const nt=new Qf(ie.current,{searchEnabled:!1,removeItemButton:!0,direction:"ltr"}),Zt=new Qf(te.current,{searchEnabled:!1,removeItemButton:!0,direction:"ltr"}),wi=new Qf(Z.current,{searchEnabled:!1,removeItemButton:!0,direction:"rtl"}),Di=new Qf(se.current,{searchEnabled:!1,removeItemButton:!0,direction:"rtl"}),Ro=new Qf(pe.current,{searchEnabled:!1,removeItemButton:!0,direction:"rtl"});return()=>{nt.destroy(),wi.destroy(),Di.destroy(),Ro.destroy(),Zt.destroy()}},[]),ee.useEffect(()=>{const Zt=(navigator.language||navigator.userLanguage).startsWith("ar"),wi=document.querySelector("select");wi&&(wi.style.direction=Zt?"rtl":"ltr",wi.style.textAlign=Zt?"right":"left")},[]);const We=nt=>{const{name:Zt,value:wi}=nt.target;r(Di=>({...Di,[Zt]:wi})),Zt==="password"&&Kt(wi)},Kt=nt=>{j({length:nt.length>=8,uppercase:/[A-Z]/.test(nt),lowercase:/[a-z]/.test(nt),number:/\d/.test(nt),specialChar:/[!@#$%^&*~\-_.]/.test(nt)})},Jt=nt=>{const Zt=nt.target.value;/[\u0600-\u06FF]/.test(Zt)?Y("rtl"):Y("ltr")},vs=nt=>{if(nt.preventDefault(),!we.includes(".com")){Ze("يرجى إدخال بريد إلكتروني صالح (يجب أن يحتوي على .com)");return}if(!ge){fe(!0);return}if(a.password!==a.confirmPassword){alert("كلمات السر غير متطابقة");return}if(Object.values(w).every(Boolean))R("");else{R("يجب أن تحتوي كلمة السر على ٨ أحرف على الأقل، حرف كبير واحد، حرف صغير واحد، رقم واحد، ورمز واحد.");return}U(!0),fetch("https://api.japaneseacademy.jp/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(Zt=>Zt.json()).then(Zt=>{Zt.error?alert("حدث خطأ: "+Zt.error):(alert("تم التسجيل بنجاح، تحقق من بريدك الإلكتروني لتفعيل الحساب"),E(!0))}).catch(Zt=>{console.error("Error:",Zt)}).finally(()=>{U(!1)})},Ss=nt=>{nt.preventDefault(),q(!0),fetch("https://api.japaneseacademy.jp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,verificationCode:l})}).then(Zt=>Zt.json()).then(Zt=>{Zt.error?alert("رمز التحقق غير صحيح"):(alert("تم التحقق من البريد الإلكتروني بنجاح"),rs("/Login_users/"))}).catch(Zt=>{console.error("Error:",Zt)}).finally(()=>{q(!1)})},Ts=nt=>{je(nt),fe(!1)},Ri=nt=>{nt.preventDefault(),alert("لا يُسمح بلصق النص هنا.")},[Ni,cl]=ee.useState(!1),[Co,ke]=ee.useState(!1),ua=()=>{cl(!Ni)},Kr=()=>{ke(!Co)},Ds=[{code:"AF",name:"أفغانستان",flag:"https://flagcdn.com/w320/af.png"},{code:"AL",name:"ألبانيا",flag:"https://flagcdn.com/w320/al.png"},{code:"DZ",name:"الجزائر",flag:"https://flagcdn.com/w320/dz.png"},{code:"AS",name:"ساموا الأمريكية",flag:"https://flagcdn.com/w320/as.png"},{code:"AD",name:"أندورا",flag:"https://flagcdn.com/w320/ad.png"},{code:"AO",name:"أنغولا",flag:"https://flagcdn.com/w320/ao.png"},{code:"AG",name:"أنتيغوا وباربودا",flag:"https://flagcdn.com/w320/ag.png"},{code:"AR",name:"الأرجنتين",flag:"https://flagcdn.com/w320/ar.png"},{code:"AM",name:"أرمينيا",flag:"https://flagcdn.com/w320/am.png"},{code:"AU",name:"أستراليا",flag:"https://flagcdn.com/w320/au.png"},{code:"AT",name:"النمسا",flag:"https://flagcdn.com/w320/at.png"},{code:"AZ",name:"أذربيجان",flag:"https://flagcdn.com/w320/az.png"},{code:"BS",name:"الباهاما",flag:"https://flagcdn.com/w320/bs.png"},{code:"BH",name:"البحرين",flag:"https://flagcdn.com/w320/bh.png"},{code:"BD",name:"بنغلاديش",flag:"https://flagcdn.com/w320/bd.png"},{code:"BB",name:"بربادوس",flag:"https://flagcdn.com/w320/bb.png"},{code:"BY",name:"بيلاروس",flag:"https://flagcdn.com/w320/by.png"},{code:"BE",name:"بلجيكا",flag:"https://flagcdn.com/w320/be.png"},{code:"BZ",name:"بليز",flag:"https://flagcdn.com/w320/bz.png"},{code:"BJ",name:"بنين",flag:"https://flagcdn.com/w320/bj.png"},{code:"BT",name:"بوتان",flag:"https://flagcdn.com/w320/bt.png"},{code:"BO",name:"بوليفيا",flag:"https://flagcdn.com/w320/bo.png"},{code:"BA",name:"البوسنة والهرسك",flag:"https://flagcdn.com/w320/ba.png"},{code:"BW",name:"بوتسوانا",flag:"https://flagcdn.com/w320/bw.png"},{code:"BR",name:"البرازيل",flag:"https://flagcdn.com/w320/br.png"},{code:"BN",name:"بروناي",flag:"https://flagcdn.com/w320/bn.png"},{code:"BG",name:"بلغاريا",flag:"https://flagcdn.com/w320/bg.png"},{code:"BF",name:"بوركينا فاسو",flag:"https://flagcdn.com/w320/bf.png"},{code:"BI",name:"بوروندي",flag:"https://flagcdn.com/w320/bi.png"},{code:"CV",name:"الرأس الأخضر",flag:"https://flagcdn.com/w320/cv.png"},{code:"KH",name:"كمبوديا",flag:"https://flagcdn.com/w320/kh.png"},{code:"CM",name:"الكاميرون",flag:"https://flagcdn.com/w320/cm.png"},{code:"CA",name:"كندا",flag:"https://flagcdn.com/w320/ca.png"},{code:"CF",name:"جمهورية أفريقيا الوسطى",flag:"https://flagcdn.com/w320/cf.png"},{code:"TD",name:"تشاد",flag:"https://flagcdn.com/w320/td.png"},{code:"CL",name:"تشيلي",flag:"https://flagcdn.com/w320/cl.png"},{code:"CN",name:"الصين",flag:"https://flagcdn.com/w320/cn.png"},{code:"CO",name:"كولومبيا",flag:"https://flagcdn.com/w320/co.png"},{code:"KM",name:"جزر القمر",flag:"https://flagcdn.com/w320/km.png"},{code:"CG",name:"الكونغو",flag:"https://flagcdn.com/w320/cg.png"},{code:"CD",name:"الكونغو الديمقراطية",flag:"https://flagcdn.com/w320/cd.png"},{code:"CR",name:"كوستاريكا",flag:"https://flagcdn.com/w320/cr.png"},{code:"CI",name:"ساحل العاج",flag:"https://flagcdn.com/w320/ci.png"},{code:"HR",name:"كرواتيا",flag:"https://flagcdn.com/w320/hr.png"},{code:"CU",name:"كوبا",flag:"https://flagcdn.com/w320/cu.png"},{code:"CY",name:"قبرص",flag:"https://flagcdn.com/w320/cy.png"},{code:"CZ",name:"التشيك",flag:"https://flagcdn.com/w320/cz.png"},{code:"DK",name:"الدنمارك",flag:"https://flagcdn.com/w320/dk.png"},{code:"DJ",name:"جيبوتي",flag:"https://flagcdn.com/w320/dj.png"},{code:"DM",name:"دومينيكا",flag:"https://flagcdn.com/w320/dm.png"},{code:"DO",name:"جمهورية الدومينيكان",flag:"https://flagcdn.com/w320/do.png"},{code:"EC",name:"الإكوادور",flag:"https://flagcdn.com/w320/ec.png"},{code:"EG",name:"مصر",flag:"https://flagcdn.com/w320/eg.png"},{code:"SV",name:"السلفادور",flag:"https://flagcdn.com/w320/sv.png"},{code:"GQ",name:"غينيا الاستوائية",flag:"https://flagcdn.com/w320/gq.png"},{code:"ER",name:"إريتريا",flag:"https://flagcdn.com/w320/er.png"},{code:"EE",name:"إستونيا",flag:"https://flagcdn.com/w320/ee.png"},{code:"SZ",name:"إسواتيني",flag:"https://flagcdn.com/w320/sz.png"},{code:"ET",name:"إثيوبيا",flag:"https://flagcdn.com/w320/et.png"},{code:"FJ",name:"فيجي",flag:"https://flagcdn.com/w320/fj.png"},{code:"FI",name:"فنلندا",flag:"https://flagcdn.com/w320/fi.png"},{code:"FR",name:"فرنسا",flag:"https://flagcdn.com/w320/fr.png"},{code:"GA",name:"الغابون",flag:"https://flagcdn.com/w320/ga.png"},{code:"GM",name:"غامبيا",flag:"https://flagcdn.com/w320/gm.png"},{code:"GE",name:"جورجيا",flag:"https://flagcdn.com/w320/ge.png"},{code:"DE",name:"ألمانيا",flag:"https://flagcdn.com/w320/de.png"},{code:"GH",name:"غانا",flag:"https://flagcdn.com/w320/gh.png"},{code:"GR",name:"اليونان",flag:"https://flagcdn.com/w320/gr.png"},{code:"GD",name:"غرينادا",flag:"https://flagcdn.com/w320/gd.png"},{code:"GT",name:"غواتيمالا",flag:"https://flagcdn.com/w320/gt.png"},{code:"GN",name:"غينيا",flag:"https://flagcdn.com/w320/gn.png"},{code:"GW",name:"غينيا بيساو",flag:"https://flagcdn.com/w320/gw.png"},{code:"GY",name:"غيانا",flag:"https://flagcdn.com/w320/gy.png"},{code:"HT",name:"هايتي",flag:"https://flagcdn.com/w320/ht.png"},{code:"HN",name:"هندوراس",flag:"https://flagcdn.com/w320/hn.png"},{code:"HU",name:"المجر",flag:"https://flagcdn.com/w320/hu.png"},{code:"IS",name:"أيسلندا",flag:"https://flagcdn.com/w320/is.png"},{code:"IN",name:"الهند",flag:"https://flagcdn.com/w320/in.png"},{code:"ID",name:"إندونيسيا",flag:"https://flagcdn.com/w320/id.png"},{code:"IR",name:"إيران",flag:"https://flagcdn.com/w320/ir.png"},{code:"IQ",name:"العراق",flag:"https://flagcdn.com/w320/iq.png"},{code:"IE",name:"أيرلندا",flag:"https://flagcdn.com/w320/ie.png"},{code:"FA",name:"فلسطين",flag:"https://flagcdn.com/w320/il.png"},{code:"IT",name:"إيطاليا",flag:"https://flagcdn.com/w320/it.png"},{code:"JM",name:"جامايكا",flag:"https://flagcdn.com/w320/jm.png"},{code:"JP",name:"اليابان",flag:"https://flagcdn.com/w320/jp.png"},{code:"JO",name:"الأردن",flag:"https://flagcdn.com/w320/jo.png"},{code:"KZ",name:"كازاخستان",flag:"https://flagcdn.com/w320/kz.png"},{code:"KE",name:"كينيا",flag:"https://flagcdn.com/w320/ke.png"},{code:"KI",name:"كيريباتي",flag:"https://flagcdn.com/w320/ki.png"},{code:"KP",name:"كوريا الشمالية",flag:"https://flagcdn.com/w320/kp.png"},{code:"KR",name:"كوريا الجنوبية",flag:"https://flagcdn.com/w320/kr.png"},{code:"KW",name:"الكويت",flag:"https://flagcdn.com/w320/kw.png"},{code:"KG",name:"قيرغيزستان",flag:"https://flagcdn.com/w320/kg.png"},{code:"LA",name:"لاوس",flag:"https://flagcdn.com/w320/la.png"},{code:"LV",name:"لاتفيا",flag:"https://flagcdn.com/w320/lv.png"},{code:"LB",name:"لبنان",flag:"https://flagcdn.com/w320/lb.png"},{code:"LS",name:"ليسوتو",flag:"https://flagcdn.com/w320/ls.png"},{code:"LR",name:"ليبيريا",flag:"https://flagcdn.com/w320/lr.png"},{code:"LY",name:"ليبيا",flag:"https://flagcdn.com/w320/ly.png"},{code:"LI",name:"ليختنشتاين",flag:"https://flagcdn.com/w320/li.png"},{code:"LT",name:"ليتوانيا",flag:"https://flagcdn.com/w320/lt.png"},{code:"LU",name:"لوكسمبورغ",flag:"https://flagcdn.com/w320/lu.png"},{code:"MG",name:"مدغشقر",flag:"https://flagcdn.com/w320/mg.png"},{code:"MW",name:"مالاوي",flag:"https://flagcdn.com/w320/mw.png"},{code:"MY",name:"ماليزيا",flag:"https://flagcdn.com/w320/my.png"},{code:"MV",name:"المالديف",flag:"https://flagcdn.com/w320/mv.png"},{code:"ML",name:"مالي",flag:"https://flagcdn.com/w320/ml.png"},{code:"MT",name:"مالطا",flag:"https://flagcdn.com/w320/mt.png"},{code:"MH",name:"جزر مارشال",flag:"https://flagcdn.com/w320/mh.png"},{code:"MR",name:"موريتانيا",flag:"https://flagcdn.com/w320/mr.png"},{code:"MU",name:"موريشيوس",flag:"https://flagcdn.com/w320/mu.png"},{code:"MX",name:"المكسيك",flag:"https://flagcdn.com/w320/mx.png"},{code:"FM",name:"ميكرونيزيا",flag:"https://flagcdn.com/w320/fm.png"},{code:"MD",name:"مولدوفا",flag:"https://flagcdn.com/w320/md.png"},{code:"MC",name:"موناكو",flag:"https://flagcdn.com/w320/mc.png"},{code:"MN",name:"منغوليا",flag:"https://flagcdn.com/w320/mn.png"},{code:"ME",name:"الجبل الأسود",flag:"https://flagcdn.com/w320/me.png"},{code:"MA",name:"المغرب",flag:"https://flagcdn.com/w320/ma.png"},{code:"MZ",name:"موزمبيق",flag:"https://flagcdn.com/w320/mz.png"},{code:"MM",name:"ميانمار",flag:"https://flagcdn.com/w320/mm.png"},{code:"NA",name:"ناميبيا",flag:"https://flagcdn.com/w320/na.png"},{code:"NR",name:"ناورو",flag:"https://flagcdn.com/w320/nr.png"},{code:"NP",name:"نيبال",flag:"https://flagcdn.com/w320/np.png"},{code:"NL",name:"هولندا",flag:"https://flagcdn.com/w320/nl.png"},{code:"NZ",name:"نيوزيلندا",flag:"https://flagcdn.com/w320/nz.png"},{code:"NI",name:"نيكاراغوا",flag:"https://flagcdn.com/w320/ni.png"},{code:"NE",name:"النيجر",flag:"https://flagcdn.com/w320/ne.png"},{code:"NG",name:"نيجيريا",flag:"https://flagcdn.com/w320/ng.png"},{code:"NO",name:"النرويج",flag:"https://flagcdn.com/w320/no.png"},{code:"OM",name:"عمان",flag:"https://flagcdn.com/w320/om.png"},{code:"PK",name:"باكستان",flag:"https://flagcdn.com/w320/pk.png"},{code:"PW",name:"بالاو",flag:"https://flagcdn.com/w320/pw.png"},{code:"PS",name:"فلسطين",flag:"https://flagcdn.com/w320/ps.png"},{code:"PA",name:"بنما",flag:"https://flagcdn.com/w320/pa.png"},{code:"PG",name:"بابوا غينيا الجديدة",flag:"https://flagcdn.com/w320/pg.png"},{code:"PY",name:"باراغواي",flag:"https://flagcdn.com/w320/py.png"},{code:"PE",name:"بيرو",flag:"https://flagcdn.com/w320/pe.png"},{code:"PH",name:"الفلبين",flag:"https://flagcdn.com/w320/ph.png"},{code:"PL",name:"بولندا",flag:"https://flagcdn.com/w320/pl.png"},{code:"PT",name:"البرتغال",flag:"https://flagcdn.com/w320/pt.png"},{code:"QA",name:"قطر",flag:"https://flagcdn.com/w320/qa.png"},{code:"RO",name:"رومانيا",flag:"https://flagcdn.com/w320/ro.png"},{code:"RU",name:"روسيا",flag:"https://flagcdn.com/w320/ru.png"},{code:"RW",name:"رواندا",flag:"https://flagcdn.com/w320/rw.png"},{code:"KN",name:"سانت كيتس ونيفيس",flag:"https://flagcdn.com/w320/kn.png"},{code:"LC",name:"سانت لوسيا",flag:"https://flagcdn.com/w320/lc.png"},{code:"VC",name:"سانت فنسنت وجزر غرينادين",flag:"https://flagcdn.com/w320/vc.png"},{code:"WS",name:"ساموا",flag:"https://flagcdn.com/w320/ws.png"},{code:"SM",name:"سان مارينو",flag:"https://flagcdn.com/w320/sm.png"},{code:"ST",name:"ساو تومي وبرينسيب",flag:"https://flagcdn.com/w320/st.png"},{code:"SA",name:"المملكة العربية السعودية",flag:"https://flagcdn.com/w320/sa.png"},{code:"SN",name:"السنغال",flag:"https://flagcdn.com/w320/sn.png"},{code:"RS",name:"صربيا",flag:"https://flagcdn.com/w320/rs.png"},{code:"SC",name:"سيشل",flag:"https://flagcdn.com/w320/sc.png"},{code:"SL",name:"سيراليون",flag:"https://flagcdn.com/w320/sl.png"},{code:"SG",name:"سنغافورة",flag:"https://flagcdn.com/w320/sg.png"},{code:"SK",name:"سلوفاكيا",flag:"https://flagcdn.com/w320/sk.png"},{code:"SI",name:"سلوفينيا",flag:"https://flagcdn.com/w320/si.png"},{code:"SB",name:"جزر سليمان",flag:"https://flagcdn.com/w320/sb.png"},{code:"SO",name:"الصومال",flag:"https://flagcdn.com/w320/so.png"},{code:"ZA",name:"جنوب أفريقيا",flag:"https://flagcdn.com/w320/za.png"},{code:"ES",name:"إسبانيا",flag:"https://flagcdn.com/w320/es.png"},{code:"LK",name:"سريلانكا",flag:"https://flagcdn.com/w320/lk.png"},{code:"SD",name:"السودان",flag:"https://flagcdn.com/w320/sd.png"},{code:"SR",name:"سورينام",flag:"https://flagcdn.com/w320/sr.png"},{code:"SE",name:"السويد",flag:"https://flagcdn.com/w320/se.png"},{code:"CH",name:"سويسرا",flag:"https://flagcdn.com/w320/ch.png"},{code:"SY",name:"سوريا",flag:"https://flagcdn.com/w320/sy.png"},{code:"TJ",name:"طاجيكستان",flag:"https://flagcdn.com/w320/tj.png"},{code:"TZ",name:"تنزانيا",flag:"https://flagcdn.com/w320/tz.png"},{code:"TH",name:"تايلاند",flag:"https://flagcdn.com/w320/th.png"},{code:"TL",name:"تيمور الشرقية",flag:"https://flagcdn.com/w320/tl.png"},{code:"TG",name:"توغو",flag:"https://flagcdn.com/w320/tg.png"},{code:"TO",name:"تونغا",flag:"https://flagcdn.com/w320/to.png"},{code:"TT",name:"ترينيداد وتوباغو",flag:"https://flagcdn.com/w320/tt.png"},{code:"TN",name:"تونس",flag:"https://flagcdn.com/w320/tn.png"},{code:"TR",name:"تركيا",flag:"https://flagcdn.com/w320/tr.png"},{code:"TM",name:"تركمانستان",flag:"https://flagcdn.com/w320/tm.png"},{code:"TV",name:"توفالو",flag:"https://flagcdn.com/w320/tv.png"},{code:"UG",name:"أوغندا",flag:"https://flagcdn.com/w320/ug.png"},{code:"UA",name:"أوكرانيا",flag:"https://flagcdn.com/w320/ua.png"},{code:"AE",name:"الإمارات العربية المتحدة",flag:"https://flagcdn.com/w320/ae.png"},{code:"GB",name:"المملكة المتحدة",flag:"https://flagcdn.com/w320/gb.png"},{code:"US",name:"الولايات المتحدة الأمريكية",flag:"https://flagcdn.com/w320/us.png"},{code:"UY",name:"أوروغواي",flag:"https://flagcdn.com/w320/uy.png"},{code:"UZ",name:"أوزبكستان",flag:"https://flagcdn.com/w320/uz.png"},{code:"VU",name:"فانواتو",flag:"https://flagcdn.com/w320/vu.png"},{code:"VA",name:"الفاتيكان",flag:"https://flagcdn.com/w320/va.png"},{code:"VE",name:"فنزويلا",flag:"https://flagcdn.com/w320/ve.png"},{code:"VN",name:"فيتنام",flag:"https://flagcdn.com/w320/vn.png"},{code:"YE",name:"اليمن",flag:"https://flagcdn.com/w320/ye.png"},{code:"ZM",name:"زامبيا",flag:"https://flagcdn.com/w320/zm.png"},{code:"ZW",name:"زيمبابوي",flag:"https://flagcdn.com/w320/zw.png"}];return h.jsx("div",{className:"container mb-5 mt-3",children:h.jsxs("div",{className:"row RegisteR",children:[h.jsx("div",{className:"register_half col-lg-6",children:h.jsx(yB,{})}),h.jsxs("div",{className:"col-lg-6",children:[h.jsxs("form",{className:"form-container academy p-5 m-auto",onSubmit:vs,children:[h.jsx("h1",{className:"fw-bold m-auto mb-4 mt-4",children:"إنشاء حساب"}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," الاسم الشخصي:"]}),h.jsx("input",{type:"text",name:"firstName",required:!0,value:a.firstName,onChange:nt=>{We(nt),Jt(nt)},style:{direction:K}})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," اسم العائلة:"]}),h.jsx("input",{type:"text",name:"lastName",required:!0,value:a.lastName,onChange:nt=>{We(nt),Jt(nt)},style:{direction:K}})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," دولة الإقامة:"]}),h.jsxs("select",{ref:te,value:ge,onChange:nt=>Ts(nt.target.value),className:"country-select",children:[h.jsx("option",{value:"",disabled:!0,children:"اختر دولة"}),Ds.map(nt=>h.jsx("option",{value:nt.code,children:nt.name},nt.code))]}),Ye&&h.jsx("span",{style:{color:"red",fontSize:"16px"},children:"يرجى اختيار دولة."})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," العمر:"]}),h.jsxs("select",{ref:ie,name:"age",required:!0,onChange:We,children:[h.jsx("option",{value:"",children:"اختر العمر"}),Array.from({length:100},(nt,Zt)=>Zt+1).map(nt=>h.jsx("option",{value:nt,children:nt},nt))]})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," الجنس:"]}),h.jsxs("select",{ref:Z,name:"gender",required:!0,onChange:We,children:[h.jsx("option",{value:"",children:"اختر الجنس"}),h.jsx("option",{value:"ذكر",children:"ذكر"}),h.jsx("option",{value:"أنثى",children:"أنثى"})]})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," المستوى التعليمي:"]}),h.jsxs("select",{ref:se,name:"educationLevel",required:!0,onChange:We,children:[h.jsx("option",{value:"",children:"اختر المستوى التعليمي"}),h.jsx("option",{value:"المرحلة الابتدائية",children:"المرحلة الابتدائية"}),h.jsx("option",{value:"المرحلة الإعدادية",children:"المرحلة الإعدادية"}),h.jsx("option",{value:"المرحلة الثانوية",children:"المرحلة الثانوية"}),h.jsx("option",{value:"مرحلة المعاهد المتوسطة",children:"مرحلة المعاهد المتوسطة"}),h.jsx("option",{value:"مرحلة التعليم الجامعي",children:"مرحلة التعليم الجامعي"}),h.jsx("option",{value:"مرحلة الدراسات العليا (ماجستير)",children:"مرحلة الدراسات العليا (ماجستير)"}),h.jsx("option",{value:"مرحلة الدراسات العليا (دكتوراه)",children:"مرحلة الدراسات العليا (دكتوراه)"})]})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," مستوى اللغة اليابانية:"]}),h.jsxs("select",{ref:pe,name:"japaneseLevel",required:!0,onChange:We,children:[h.jsx("option",{value:"",children:"اختر مستوى اللغة اليابانية"}),Array.from({length:16},(nt,Zt)=>`J${Zt+1}`).map(nt=>h.jsx("option",{value:nt,children:nt},nt))]}),h.jsxs("h5",{className:"japaneseLevelLink",children:["يُرجى الضغط ",h.jsx(vt,{to:"/Level_division",children:"هنا"})," للاطلاع على تفاصيل المستويات الدراسية."]})]}),h.jsxs("div",{children:[h.jsx("label",{children:"رقم الواتساب:"}),h.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:We,style:{direction:K}})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," البريد الإلكتروني:"]}),h.jsx("input",{type:"email",required:!0,value:we,onChange:nt=>Le(nt.target.value),style:{direction:"ltr"}}),Me&&h.jsx("span",{style:{direction:"ltr",color:"red",fontSize:"16px"},children:rt})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," تأكيد البريد الإلكتروني:"]}),h.jsx("input",{type:"email",required:!0,value:Fe,onPaste:Ri,onChange:nt=>tt(nt.target.value),style:{direction:"ltr"}}),Me&&h.jsx("span",{style:{direction:"ltr",color:"red",fontSize:"16px"},children:rt})]}),h.jsxs("div",{children:[h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," كلمة السر:"]}),h.jsxs("div",{style:{position:"relative"},children:[h.jsx("input",{type:Ni?"text":"password",name:"password",required:!0,value:a.password,onChange:nt=>{We(nt),Jt(nt)},onPaste:Ri,style:{direction:"ltr",paddingRight:"30px"}}),h.jsxs("span",{onClick:ua,style:{position:"absolute",top:"50%",right:"10px",cursor:"pointer",transform:"translateY(-50%)"},children:[Ni?h.jsx(bA,{}):h.jsx(BA,{})," "]})]}),T&&h.jsx("p",{style:{color:"red"},children:T}),h.jsxs("ul",{className:"password",children:[h.jsx("li",{style:{color:w.length?"green":"red"},children:w.length?"-  تحتوي على 8 أحرف على الأقل.":"- يجب أن تحتوي على 8 أحرف على الأقل."}),h.jsx("li",{style:{color:w.uppercase?"green":"red"},children:w.uppercase?"-  تحتوي على حرف كبير واحد على الأقل.":"- يجب أن تحتوي على حرف كبير واحد على الأقل."}),h.jsx("li",{style:{color:w.lowercase?"green":"red"},children:w.lowercase?"-  تحتوي على حرف صغير واحد على الأقل.":"- يجب أن تحتوي على حرف صغير واحد على الأقل."}),h.jsx("li",{style:{color:w.number?"green":"red"},children:w.number?"-  تحتوي على رقم واحد على الأقل.":"- يجب أن تحتوي على رقم واحد على الأقل."}),h.jsx("li",{style:{color:w.specialChar?"green":"red"},children:w.specialChar?"- تحتوي على رمز واحد على الأقل (!@#$%^&*~-_.).":"- يجب أن تحتوي على رمز واحد على الأقل (!@#$%^&*~-_.)."})]})]}),h.jsxs("div",{children:[h.jsxs("label",{children:[h.jsx("span",{style:{color:"red"},children:"*"})," تأكيد كلمة السر:"]}),h.jsxs("div",{style:{position:"relative"},children:[h.jsx("input",{type:Co?"text":"password",name:"confirmPassword",required:!0,value:a.confirmPassword,onChange:nt=>{We(nt),Jt(nt)},onPaste:Ri,style:{direction:"ltr",paddingRight:"30px"}}),h.jsxs("span",{onClick:Kr,style:{position:"absolute",top:"50%",right:"10px",cursor:"pointer",transform:"translateY(-50%)"},children:[Co?h.jsx(bA,{}):h.jsx(BA,{})," "]})]})]})]}),h.jsx("button",{className:"mt-4",type:"submit",disabled:P,children:P?"جاري التسجيل...":"سجل الآن"})]}),_&&h.jsxs("form",{className:"form-container academy",onSubmit:Ss,children:[h.jsx("label",{className:"fs-5",children:"أدخل كود التحقق:"}),h.jsx("input",{type:"text",placeholder:"أدخل كود التحقق",value:l,onChange:nt=>u(nt.target.value)}),h.jsx("button",{className:"mt-4 mb-5",type:"submit",disabled:G,children:G?"جاري التحقق...":"تحقق"})]})]})]})})}function aee(){const[a,r]=ee.useState(""),[l,u]=ee.useState(""),[_,E]=ee.useState(!1),T=da(),[R,w]=ee.useState(!1),[j,P]=ee.useState(""),[U,G]=ee.useState("ltr"),q=ie=>{ie.preventDefault(),w(!0),P(""),fetch("https://api.japaneseacademy.jp/login_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:l})}).then(te=>te.json()).then(te=>{w(!1),te.token?(console.log("تم تسجيل الدخول بنجاح"),localStorage.setItem("token",te.token),localStorage.setItem("firstName",te.user.firstName),localStorage.setItem("userEmail",te.user.email),localStorage.setItem("userId",te.user.id),localStorage.setItem("userRole",te.user.role),localStorage.setItem("showVideoCall",te.user.showVideoCall),localStorage.setItem("uid",0),T("/")):P("البريد الإلكتروني أو كلمة المرور غير صحيحة")}).catch(te=>{w(!1),console.error("Error:",te),P("حدث خطأ في الاتصال بالخادم. الرجاء المحاولة لاحقًا.")})},K=ie=>{const te=ie.target.value;/[\u0600-\u06FF]/.test(te)?G("rtl"):G("ltr")},Y=()=>{E(!_)};return h.jsx(h.Fragment,{children:h.jsxs("form",{className:"login-form academy container mt-5 mb-5",onSubmit:q,children:[h.jsx("h1",{className:"fw-bold m-auto",children:"تسجيل الدخول"}),h.jsxs("div",{className:"w-100",children:[h.jsx("label",{className:"mb-2",children:"البريد الإلكتروني:"}),h.jsx("input",{type:"email",value:a,onChange:ie=>{r(ie.target.value),K(ie)},required:!0,style:{direction:U}})]}),h.jsxs("div",{className:"w-100 mb-5",children:[h.jsx("label",{className:"mb-2",children:"كلمة المرور:"}),h.jsxs("div",{style:{position:"relative"},children:[h.jsx("input",{type:_?"text":"password",value:l,onChange:ie=>u(ie.target.value),required:!0,style:{direction:U,paddingRight:"30px"}}),h.jsxs("span",{onClick:Y,style:{position:"absolute",top:"50%",right:"10px",cursor:"pointer",transform:"translateY(-50%)"},children:[_?h.jsx(bA,{}):h.jsx(BA,{})," "]})]})]}),h.jsx("button",{type:"submit",disabled:R,children:R?"جارٍ تسجيل الدخول...":"تسجيل الدخول"}),j&&h.jsx("p",{className:"error-message",children:j}),h.jsx("h5",{className:"text-center m-auto mt-4 Dont_have_account",children:h.jsx(vt,{to:"/Register_account",children:h.jsx("span",{children:"إنشاء حساب"})})})]})})}function cee(){const[a,r]=ee.useState(null),l=da();return ee.useEffect(()=>{const u=localStorage.getItem("token"),_=parseInt(localStorage.getItem("userId"));fetch("https://api.japaneseacademy.jp/allusers",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}}).then(E=>{if(!E.ok)throw new Error("Failed to fetch user data");return E.json()}).then(E=>{const T=E.find(R=>R.id===_);T?r(T):console.log("error")}).catch(E=>{console.error("Error fetching user data:",E),alert("حدث خطأ أثناء جلب البيانات. حاول مرة أخرى."),l("/Login_users")})},[l]),a?h.jsxs("div",{className:"dashboard container mt-5 mb-5 academy",children:[h.jsxs("h3",{className:"fw-bold",children:["مرحباً، ",h.jsxs("span",{children:[a.firstName," "]})," ",h.jsx("span",{children:a.lastName})]}),h.jsxs("p",{children:["البريد الإلكتروني: ",h.jsxs("span",{children:[a.email," "]})]}),h.jsxs("p",{children:["الدولة: ",h.jsxs("span",{children:[a.country," "]})]}),h.jsxs("p",{children:["العمر:",h.jsxs("span",{children:[" ",a.age," "]})]}),h.jsxs("p",{children:["الجنس: ",h.jsxs("span",{children:[a.gender," "]})]}),h.jsxs("p",{children:["المستوى التعليمي: ",h.jsxs("span",{children:[a.educationLevel," "]})]}),h.jsxs("p",{children:["مستوى اللغة اليابانية: ",h.jsxs("span",{children:[a.japaneseLevel," "]})]}),h.jsxs("p",{children:["رقم الهاتف: ",h.jsxs("span",{children:[a.phone," "]})]})]}):h.jsx("p",{children:"جارٍ تحميل البيانات..."})}const lee="/assets/_cf1366d8-6ddb-44f9-b966-a65d496096f6.BMRpVcwh.jpg",dee="/assets/_8448e83a-3c19-4997-b93c-ce4df62dd5ea.BK8mtZW-.jpg";function uee(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container Privacy mt-4",children:h.jsxs("div",{className:"details_privacy",children:[h.jsxs("div",{className:"row academy mb-5",children:[h.jsxs("div",{className:"col-lg-8 col-md-6 col-12 text_privacy ",children:[h.jsx("h2",{className:"mb-3",children:"سياسة الخصوصية"}),h.jsx("p",{children:"مرحبًا بكم في موقع أكاديمية اللغة اليابانية. تلتزم الأكاديمية بحماية خصوصية مستخدمي الموقع وتضمن حماية المعلومات الشخصية الخاصة بكم. تهدف سياسة الخصوصية هذه إلى توضيح كيفية جمع واستخدام وحماية المعلومات التي يقوم الطلاب بتقديمها عند استخدامهم لموقعنا."})]}),h.jsx("div",{className:"col-lg-4 col-md-6 col-12 img_privacy",children:h.jsx("img",{className:"m-auto",src:lee,alt:""})})]}),h.jsxs("div",{className:"ul_privacy",children:[h.jsxs("ul",{className:"academy row mb-5",children:[h.jsxs("div",{className:"col-lg-8",children:[h.jsx("h2",{children:"جمع المعلومات الشخصية"}),h.jsx("p",{children:"تقوم أكاديمية اللغة اليابانية بجمع المعلومات الشخصية اللازمة لتقديم خدماتها التعليمية بشكل فعال، ويشمل ذلك:"}),h.jsxs("li",{children:[h.jsx("span",{children:"المعلومات الأساسية: "}),"كالاسم الكامل، وتاريخ الميلاد، والجنس."]}),h.jsxs("li",{children:[h.jsx("span",{children:"معلومات الاتصال: "}),"مثل البريد الإلكتروني، ورقم الهاتف."]}),h.jsxs("li",{children:[h.jsx("span",{children:"المعلومات التعليمية: "}),"مستوى اللغة الحالي، والخلفية التعليمية السابقة في اللغة اليابانية إن وجدت."]}),h.jsxs("li",{children:[h.jsx("span",{children:"معلومات الحساب: "}),"مثل اسم المستخدم وكلمة المرور الخاصة بالحساب على الموقع."]})]}),h.jsx("div",{className:"col-lg-4 img_privacy",children:h.jsx("img",{className:"m-auto",src:dee,alt:""})}),h.jsx("p",{className:"mt-3",children:"يتم جمع هذه المعلومات بشكل رئيسي عند قيام الطالب بإنشاء حساب جديد أو التسجيل في إحدى الدورات التعليمية التي نقدمها."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"استخدام المعلومات الشخصية"}),h.jsx("p",{children:"نستخدم المعلومات الشخصية التي نجمعها للأغراض التالية:"}),h.jsxs("li",{children:[h.jsx("span",{children:"تقديم الخدمات التعليمية: "}),"مثل تسجيل الطلاب في الدورات، ومتابعة تقدمهم، وتوفير الموارد والدروس التعليمية."]}),h.jsxs("li",{children:[h.jsx("span",{children:"تحسين وتطوير الموقع:"}),"وذلك من خلال تحليل البيانات المتعلقة بتفاعل الطلاب مع الموقع لتحسين تجربة المستخدم."]}),h.jsxs("li",{children:[h.jsx("span",{children:"التواصل مع الطلاب: "}),"نستخدم بيانات الاتصال للتواصل مع الطلاب بشأن مواعيد الدورات، وتحديثات البرامج، والمعلومات المهمة المتعلقة بالدورات أو الحسابات."]}),h.jsxs("li",{children:[h.jsx("span",{children:"أغراض تسويقية: "}),"قد يتم استخدام البريد الإلكتروني لإرسال رسائل حول دورات جديدة أو عروض خاصة؛ يمكن للطالب اختيار إلغاء الاشتراك في أي وقت."]})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"حماية المعلومات"}),h.jsx("p",{children:"نولي أهمية كبيرة لحماية معلوماتكم الشخصية. ونقوم بتطبيق عدة إجراءات أمنية وتقنية لضمان الحفاظ على سرية البيانات، بما في ذلك:"}),h.jsxs("li",{children:[h.jsx("span",{children:"التشفير:"}),"يتم تخزين البيانات الشخصية بشكل مشفر، مما يقلل من مخاطر الوصول غير المصرح به."]}),h.jsxs("li",{children:[h.jsx("span",{children:"القيود الداخلية: "}),"لا يتم السماح بالوصول إلى المعلومات الشخصية إلا للموظفين المخولين بذلك، والذين يحتاجون إليها لأداء مهامهم."]}),h.jsxs("li",{children:[h.jsx("span",{children:"مراجعات الأمان الدورية: "}),"نقوم بعمليات تدقيق دورية للتأكد من سلامة النظام وتقليل احتمالية تعرضه لأي اختراق."]})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"مشاركة المعلومات"}),h.jsx("p",{children:"نلتزم بعدم بيع أو تأجير أو تبادل المعلومات الشخصية للطلاب مع أي طرف ثالث، إلا في الحالات التالية:"}),h.jsxs("li",{children:[h.jsx("span",{children:"الامتثال للمتطلبات القانونية:"}),"قد نكون ملزمين بمشاركة بعض المعلومات إذا كانت هناك طلبات قانونية أو استدعاءات قضائية."]}),h.jsxs("li",{children:[h.jsx("span",{children:"حماية الحقوق والمصالح: "}),"في حالات استثنائية، قد نقوم بمشاركة المعلومات عند الحاجة لحماية حقوق الأكاديمية، أو المستخدمين، أو للحد من الاحتيال."]})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"حقوق المستخدمين"}),h.jsx("p",{children:"نحرص على احترام حقوق المستخدمين فيما يخص معلوماتهم الشخصية. لذلك، يتمتع الطلاب بالحقوق التالية:"}),h.jsxs("li",{children:[h.jsx("span",{children:"الحق في الوصول: "}),"يحق للطلاب طلب الوصول إلى المعلومات الشخصية الخاصة بهم التي قمنا بجمعها."]}),h.jsxs("li",{children:[h.jsx("span",{children:"الحق في التعديل والتصحيح: "}),"إذا كانت هناك معلومات غير دقيقة أو تحتاج إلى تحديث، يمكن للطالب طلب تصحيح البيانات."]}),h.jsxs("li",{children:[h.jsx("span",{children:"الحق في الحذف:"}),"يمكن للطلاب طلب حذف بياناتهم الشخصية إذا لم تعد هناك حاجة للاحتفاظ بها لأغراض قانونية أو تشغيلية."]}),h.jsxs("li",{children:[h.jsx("span",{children:"الحق في الاعتراض: "}),"يحق للطلاب الاعتراض على استخدام بياناتهم الشخصية في بعض الحالات، مثل الاستخدامات التسويقية."]}),h.jsx("p",{children:"يمكن للطلاب ممارسة هذه الحقوق عن طريق التواصل معنا عبر البريد الإلكتروني info@japaneseacademy.jp، وسنعمل على تلبية الطلبات في أقرب وقت ممكن."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"تخزين البيانات ومدة الاحتفاظ بها"}),h.jsx("p",{children:"نقوم بتخزين المعلومات الشخصية التي يتم جمعها من الطلاب طوال فترة استخدامهم لخدمات الأكاديمية. بمجرد إنهاء الحساب أو طلب حذف البيانات، يتم اتخاذ إجراءات لحذف المعلومات أو جعلها غير قابلة للتعرف. قد نحتفظ ببعض المعلومات الضرورية لفترة أطول وفقًا للمتطلبات القانونية أو لأغراض الأمان الداخلي."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"ملفات تعريف الارتباط (الكوكيز)"}),h.jsx("p",{children:"يستخدم موقع أكاديمية اللغة اليابانية ملفات تعريف الارتباط (Cookies) لتحسين تجربة المستخدم وتخصيص المحتوى. هذه الملفات هي عبارة عن بيانات صغيرة تُخزن على جهاز المستخدم عند زيارته للموقع وتساعد في:"}),h.jsxs("li",{children:[h.jsx("span",{children:"تذكر تفضيلات المستخدم: "}),"لتحسين تجربة التصفح من خلال تذكر إعدادات معينة."]}),h.jsxs("li",{children:[h.jsx("span",{children:"تحليل البيانات: "}),"لمساعدتنا في فهم كيفية استخدام الموقع، وبالتالي تحسين جودة الخدمات."]}),h.jsx("p",{children:"يمكن للمستخدم اختيار تعطيل ملفات تعريف الارتباط من إعدادات المتصفح، لكن قد يؤثر ذلك على بعض ميزات الموقع."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"الروابط الخارجية"}),h.jsx("p",{children:"قد يحتوي موقع أكاديمية اللغة اليابانية على روابط لمواقع خارجية. يرجى العلم أننا لسنا مسؤولين عن سياسة الخصوصية أو محتوى تلك المواقع، وننصح المستخدمين بقراءة سياسات الخصوصية الخاصة بالمواقع الأخرى قبل تقديم أي معلومات شخصية."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"تحديث سياسة الخصوصية"}),h.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بالحق في تعديل أو تحديث سياسة الخصوصية هذه من وقت لآخر. سيتم نشر أي تغييرات على هذه الصفحة مع تحديد تاريخ آخر تحديث. يُنصح المستخدمون بمراجعة هذه السياسة بشكل دوري لضمان موافقتهم على أي تغييرات."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"التواصل معنا"}),h.jsxs("p",{children:["إذا كان لديكم أي استفسارات أو مخاوف بشأن سياسة الخصوصية، أو إذا كنتم ترغبون في ممارسة أي من حقوقكم، يُرجى التواصل معنا عبر البريد الإلكتروني:",h.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:"info@japaneseacademy.jp"})]})]})]})]})})})}function hee(){return h.jsx(h.Fragment,{})}function pee(){const[a,r]=ee.useState([]);ee.useEffect(()=>{Ci.get("https://api.japaneseacademy.jp/allusers").then(u=>{r(u.data)}).catch(u=>{console.error("Error fetching students data:",u)})},[]);const l={"المستوى الاحترافي (N1)":[],"المستوى المتقدم جدًا (N2)":[],"المستوى المتقدم (N3)":[],"المستوى المتوسط (N4)":[],"المستوى المبتدئ (N5)":[]};return a.forEach(u=>{l[u.Level]&&l[u.Level].push(u)}),h.jsxs("div",{className:"App",children:[h.jsx("h1",{children:"بيانات الطلاب حسب المستوى"}),Object.keys(l).map(u=>h.jsxs("div",{children:[h.jsx("h2",{children:u}),h.jsx("div",{className:"cards-container",children:l[u].map(_=>h.jsx(fee,{student:_},_.id))})]},u))]})}const fee=({student:a})=>h.jsxs("div",{className:"card",children:[h.jsxs("h3",{children:[a.firstName," ",a.lastName]}),h.jsxs("p",{children:[h.jsx("strong",{children:"البلد:"})," ",a.country]}),h.jsxs("p",{children:[h.jsx("strong",{children:"العمر:"})," ",a.age]}),h.jsxs("p",{children:[h.jsx("strong",{children:"الجنس:"})," ",a.gender]}),h.jsxs("p",{children:[h.jsx("strong",{children:"المستوى:"})," ",a.Level]}),h.jsxs("p",{children:[h.jsx("strong",{children:"البريد الإلكتروني:"})," ",a.email]})]});var MB={exports:{}};(function(a,r){var l={};(function(u,_){a.exports=_()})(aF,function(){function u(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof l<"u"?l:typeof self<"u"?self:{};function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T=function(e){try{return!!e()}catch{return!0}},R=!T(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),w=R,j=Function.prototype,P=j.call,U=w&&j.bind.bind(P,P),G=w?U:function(e){return function(){return P.apply(e,arguments)}},q=G({}.isPrototypeOf),K=function(e){return e&&e.Math===Math&&e},Y=K(typeof globalThis=="object"&&globalThis)||K(typeof window=="object"&&window)||K(typeof self=="object"&&self)||K(typeof _=="object"&&_)||K(typeof _=="object"&&_)||function(){return this}()||Function("return this")(),ie=R,te=Function.prototype,Z=te.apply,se=te.call,pe=typeof Reflect=="object"&&Reflect.apply||(ie?se.bind(Z):function(){return se.apply(Z,arguments)}),ge=G,je=ge({}.toString),Ye=ge("".slice),fe=function(e){return Ye(je(e),8,-1)},we=fe,Le=G,Fe=function(e){if(we(e)==="Function")return Le(e)},tt=typeof document=="object"&&document.all,Me=tt===void 0&&tt!==void 0?function(e){return typeof e=="function"||e===tt}:function(e){return typeof e=="function"},Ze={},rt=!T(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Qt=R,rs=Function.prototype.call,We=Qt?rs.bind(rs):function(){return rs.apply(rs,arguments)},Kt={},Jt={}.propertyIsEnumerable,vs=Object.getOwnPropertyDescriptor,Ss=vs&&!Jt.call({1:2},1);Kt.f=Ss?function(e){var t=vs(this,e);return!!t&&t.enumerable}:Jt;var Ts,Ri,Ni=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},cl=T,Co=fe,ke=Object,ua=G("".split),Kr=cl(function(){return!ke("z").propertyIsEnumerable(0)})?function(e){return Co(e)==="String"?ua(e,""):ke(e)}:ke,Ds=function(e){return e==null},nt=Ds,Zt=TypeError,wi=function(e){if(nt(e))throw new Zt("Can't call method on "+e);return e},Di=Kr,Ro=wi,qe=function(e){return Di(Ro(e))},zr=Me,Ei=function(e){return typeof e=="object"?e!==null:zr(e)},os={},Qa=os,me=Y,It=Me,Mt=function(e){return It(e)?e:void 0},cn=function(e,t){return arguments.length<2?Mt(Qa[e])||Mt(me[e]):Qa[e]&&Qa[e][t]||me[e]&&me[e][t]},ys=Y.navigator,vr=ys&&ys.userAgent,wo=vr?String(vr):"",hm=Y,Ph=wo,pm=hm.process,Lh=hm.Deno,fm=pm&&pm.versions||Lh&&Lh.version,Za=fm&&fm.v8;Za&&(Ri=(Ts=Za.split("."))[0]>0&&Ts[0]<4?1:+(Ts[0]+Ts[1])),!Ri&&Ph&&(!(Ts=Ph.match(/Edge\/(\d+)/))||Ts[1]>=74)&&(Ts=Ph.match(/Chrome\/(\d+)/))&&(Ri=+Ts[1]);var ha=Ri,pa=ha,cS=T,lS=Y.String,ec=!!Object.getOwnPropertySymbols&&!cS(function(){var e=Symbol("symbol detection");return!lS(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&pa&&pa<41}),mm=ec&&!Symbol.sham&&typeof Symbol.iterator=="symbol",dS=cn,uS=Me,hS=q,pS=Object,ll=mm?function(e){return typeof e=="symbol"}:function(e){var t=dS("Symbol");return uS(t)&&hS(t.prototype,pS(e))},fS=String,tc=function(e){try{return fS(e)}catch{return"Object"}},Sd=Me,mS=tc,SI=TypeError,ii=function(e){if(Sd(e))return e;throw new SI(mS(e)+" is not a function")},_m=ii,_S=Ds,Td=function(e,t){var n=e[t];return _S(n)?void 0:_m(n)},Em=We,nc=Me,fa=Ei,ic=TypeError,dl={exports:{}},ES=!0,yd=Y,gS=Object.defineProperty,vS=Y,SS=function(e,t){try{gS(yd,e,{value:t,configurable:!0,writable:!0})}catch{yd[e]=t}return t},gm="__core-js_shared__",vm=dl.exports=vS[gm]||SS(gm,{});(vm.versions||(vm.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var xh=dl.exports,kh=xh,Yr=function(e,t){return kh[e]||(kh[e]=t||{})},TS=wi,yS=Object,Sr=function(e){return yS(TS(e))},bS=Sr,CS=G({}.hasOwnProperty),Xn=Object.hasOwn||function(e,t){return CS(bS(e),t)},Sm=G,RS=0,wS=Math.random(),AS=Sm(1 .toString),Mh=function(e){return"Symbol("+(e===void 0?"":e)+")_"+AS(++RS+wS,36)},IS=Yr,Tm=Xn,OS=Mh,NS=ec,sc=mm,rc=Y.Symbol,ym=IS("wks"),ul=sc?rc.for||rc:rc&&rc.withoutSetter||OS,yn=function(e){return Tm(ym,e)||(ym[e]=NS&&Tm(rc,e)?rc[e]:ul("Symbol."+e)),ym[e]},DS=We,bm=Ei,Cm=ll,PS=Td,LS=function(e,t){var n,i;if(nc(n=e.toString)&&!fa(i=Em(n,e))||nc(n=e.valueOf)&&!fa(i=Em(n,e)))return i;throw new ic("Can't convert object to primitive value")},jh=TypeError,oc=yn("toPrimitive"),bd=function(e,t){if(!bm(e)||Cm(e))return e;var n,i=PS(e,oc);if(i){if(n=DS(i,e,t),!bm(n)||Cm(n))return n;throw new jh("Can't convert object to primitive value")}return LS(e)},xS=ll,Uh=function(e){var t=bd(e,"string");return xS(t)?t:t+""},Rm=Ei,Vh=Y.document,kS=Rm(Vh)&&Rm(Vh.createElement),Fh=function(e){return kS?Vh.createElement(e):{}},Bh=Fh,wm=!rt&&!T(function(){return Object.defineProperty(Bh("div"),"a",{get:function(){return 7}}).a!==7}),MS=rt,ac=We,Ji=Kt,bs=Ni,Cs=qe,Xi=Uh,Cd=Xn,cc=wm,Ao=Object.getOwnPropertyDescriptor;Ze.f=MS?Ao:function(e,t){if(e=Cs(e),t=Xi(t),cc)try{return Ao(e,t)}catch{}if(Cd(e,t))return bs(!ac(Ji.f,e,t),e[t])};var lc=T,Am=Me,Gh=/#|\.prototype\./,Tr=function(e,t){var n=Hh[Im(e)];return n===Om||n!==Wh&&(Am(t)?lc(t):!!t)},Im=Tr.normalize=function(e){return String(e).replace(Gh,".").toLowerCase()},Hh=Tr.data={},Wh=Tr.NATIVE="N",Om=Tr.POLYFILL="P",Kh=Tr,Nm=ii,Dm=R,Pm=Fe(Fe.bind),qr=function(e,t){return Nm(e),t===void 0?e:Dm?Pm(e,t):function(){return e.apply(t,arguments)}},Rs={},zh=rt&&T(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Lm=Ei,xm=String,yr=TypeError,In=function(e){if(Lm(e))return e;throw new yr(xm(e)+" is not an object")},ma=rt,Ps=wm,Yh=zh,Rd=In,km=Uh,qh=TypeError,Ls=Object.defineProperty,_a=Object.getOwnPropertyDescriptor,dc="enumerable",Io="configurable",hl="writable";Rs.f=ma?Yh?function(e,t,n){if(Rd(e),t=km(t),Rd(n),typeof e=="function"&&t==="prototype"&&"value"in n&&hl in n&&!n[hl]){var i=_a(e,t);i&&i[hl]&&(e[t]=n.value,n={configurable:Io in n?n[Io]:i[Io],enumerable:dc in n?n[dc]:i[dc],writable:!1})}return Ls(e,t,n)}:Ls:function(e,t,n){if(Rd(e),t=km(t),Rd(n),Ps)try{return Ls(e,t,n)}catch{}if("get"in n||"set"in n)throw new qh("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Mm=Rs,uc=Ni,$r=rt?function(e,t,n){return Mm.f(e,t,uc(1,n))}:function(e,t,n){return e[t]=n,e},hc=Y,Jr=pe,jS=Fe,Oo=Me,wd=Ze.f,jm=Kh,pc=os,pl=qr,No=$r,fc=Xn,US=function(e){var t=function(n,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,s)}return Jr(e,this,arguments)};return t.prototype=e.prototype,t},yt=function(e,t){var n,i,s,o,c,d,p,f,m,g=e.target,v=e.global,y=e.stat,D=e.proto,A=v?hc:y?hc[g]:hc[g]&&hc[g].prototype,I=v?pc:pc[g]||No(pc,g,{})[g],k=I.prototype;for(o in t)i=!(n=jm(v?o:g+(y?".":"#")+o,e.forced))&&A&&fc(A,o),d=I[o],i&&(p=e.dontCallGetSet?(m=wd(A,o))&&m.value:A[o]),c=i&&p?p:t[o],(n||D||typeof d!=typeof c)&&(f=e.bind&&i?pl(c,hc):e.wrap&&i?US(c):D&&Oo(c)?jS(c):c,(e.sham||c&&c.sham||d&&d.sham)&&No(f,"sham",!0),No(I,o,f),D&&(fc(pc,s=g+"Prototype")||No(pc,s,{}),No(pc[s],o,c),e.real&&k&&(n||!k[o])&&No(k,o,c)))},Um=Math.ceil,Vm=Math.floor,VS=Math.trunc||function(e){var t=+e;return(t>0?Vm:Um)(t)},FS=VS,$h=function(e){var t=+e;return t!=t||t===0?0:FS(t)},Fm=$h,mc=Math.max,BS=Math.min,Jh=function(e,t){var n=Fm(e);return n<0?mc(n+t,0):BS(n,t)},Bm=$h,GS=Math.min,Ad=function(e){var t=Bm(e);return t>0?GS(t,9007199254740991):0},Id=Ad,Do=function(e){return Id(e.length)},Xh=qe,HS=Jh,Od=Do,Gm=function(e){return function(t,n,i){var s=Xh(t),o=Od(s);if(o===0)return!e&&-1;var c,d=HS(i,o);if(e&&n!=n){for(;o>d;)if((c=s[d++])!=c)return!0}else for(;o>d;d++)if((e||d in s)&&s[d]===n)return e||d||0;return!e&&-1}},Nd={includes:Gm(!0),indexOf:Gm(!1)},Qh=Nd.includes;yt({target:"Array",proto:!0,forced:T(function(){return!Array(1).includes()})},{includes:function(e){return Qh(this,e,arguments.length>1?arguments[1]:void 0)}});var Zh=Y,WS=os,xs=function(e,t){var n=WS[e+"Prototype"],i=n&&n[t];if(i)return i;var s=Zh[e],o=s&&s.prototype;return o&&o[t]},ep=xs("Array","includes"),Hm=Ei,fl=fe,tp=yn("match"),Wm=function(e){var t;return Hm(e)&&((t=e[tp])!==void 0?!!t:fl(e)==="RegExp")},Km=Wm,KS=TypeError,zm={};zm[yn("toStringTag")]="z";var Dd=String(zm)==="[object z]",_c=Dd,zS=Me,Pd=fe,YS=yn("toStringTag"),Ym=Object,qm=Pd(function(){return arguments}())==="Arguments",br=_c?Pd:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(s,o){try{return s[o]}catch{}}(t=Ym(e),YS))=="string"?n:qm?Pd(t):(i=Pd(t))==="Object"&&zS(t.callee)?"Arguments":i},qS=br,$m=String,as=function(e){if(qS(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $m(e)},$S=yn("match"),Jm=yt,JS=function(e){if(Km(e))throw new KS("The method doesn't accept regular expressions");return e},np=wi,Xm=as,XS=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[$S]=!1,"/./"[e](t)}catch{}}return!1},Qm=G("".indexOf);Jm({target:"String",proto:!0,forced:!XS("includes")},{includes:function(e){return!!~Qm(Xm(np(this)),Xm(JS(e)),arguments.length>1?arguments[1]:void 0)}});var QS=xs("String","includes"),Zm=q,ZS=ep,eT=QS,ip=Array.prototype,sp=String.prototype,tT=function(e){var t=e.includes;return e===ip||Zm(ip,e)&&t===ip.includes?ZS:typeof e=="string"||e===sp||Zm(sp,e)&&t===sp.includes?eT:t},ve=E(tT),e_=ii,t_=Sr,Ld=Kr,nT=Do,n_=TypeError,i_="Reduce of empty array with no initial value",s_=function(e){return function(t,n,i,s){var o=t_(t),c=Ld(o),d=nT(o);if(e_(n),d===0&&i<2)throw new n_(i_);var p=e?d-1:0,f=e?-1:1;if(i<2)for(;;){if(p in c){s=c[p],p+=f;break}if(p+=f,e?p<0:d<=p)throw new n_(i_)}for(;e?p>=0:d>p;p+=f)p in c&&(s=n(s,c[p],p,o));return s}},rp={left:s_(!1),right:s_(!0)},r_=T,ml=function(e,t){var n=[][e];return!!n&&r_(function(){n.call(null,t||function(){return 1},1)})},xd=Y,Ea=wo,op=fe,kd=function(e){return Ea.slice(0,e.length)===e},Md=kd("Bun/")?"BUN":kd("Cloudflare-Workers")?"CLOUDFLARE":kd("Deno/")?"DENO":kd("Node.js/")?"NODE":xd.Bun&&typeof Bun.version=="string"?"BUN":xd.Deno&&typeof Deno.version=="object"?"DENO":op(xd.process)==="process"?"NODE":xd.window&&xd.document?"BROWSER":"REST",jd=Md==="NODE",o_=rp.left;yt({target:"Array",proto:!0,forced:!jd&&ha>79&&ha<83||!ml("reduce")},{reduce:function(e){var t=arguments.length;return o_(this,e,t,t>1?arguments[1]:void 0)}});var iT=xs("Array","reduce"),sT=q,rT=iT,ap=Array.prototype,oT=function(e){var t=e.reduce;return e===ap||sT(ap,e)&&t===ap.reduce?rT:t},cp=oT,ks=E(cp),aT=fe,Cr=Array.isArray||function(e){return aT(e)==="Array"},cT=yt,lT=Cr,dT=G([].reverse),a_=[1,2];cT({target:"Array",proto:!0,forced:String(a_)===String(a_.reverse())},{reverse:function(){return lT(this)&&(this.length=this.length),dT(this)}});var uT=xs("Array","reverse"),ga=q,hT=uT,Ec=Array.prototype,pT=function(e){var t=e.reverse;return e===Ec||ga(Ec,e)&&t===Ec.reverse?hT:t},c_=pT,l_=E(c_),fT=Mh,d_=Yr("keys"),Ud=function(e){return d_[e]||(d_[e]=fT(e))},mT=!T(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),_T=Xn,ET=Me,gT=Sr,vT=mT,u_=Ud("IE_PROTO"),lp=Object,Zs=lp.prototype,Vd=vT?lp.getPrototypeOf:function(e){var t=gT(e);if(_T(t,u_))return t[u_];var n=t.constructor;return ET(n)&&t instanceof n?n.prototype:t instanceof lp?Zs:null},ST=G,h_=ii,p_=Ei,TT=function(e){return p_(e)||e===null},yT=String,f_=TypeError,bT=function(e,t,n){try{return ST(h_(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},TI=Ei,Fd=wi,CT=function(e){if(TT(e))return e;throw new f_("Can't set "+yT(e)+" as a prototype")},RT=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=bT(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,s){return Fd(i),CT(s),TI(i)&&(t?e(i,s):i.__proto__=s),i}}():void 0),Bd={},Gd={},Hd=Xn,wT=qe,AT=Nd.indexOf,m_=Gd,dp=G([].push),up=function(e,t){var n,i=wT(e),s=0,o=[];for(n in i)!Hd(m_,n)&&Hd(i,n)&&dp(o,n);for(;t.length>s;)Hd(i,n=t[s++])&&(~AT(o,n)||dp(o,n));return o},gc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],__=up,hp=gc.concat("length","prototype");Bd.f=Object.getOwnPropertyNames||function(e){return __(e,hp)};var _l={};_l.f=Object.getOwnPropertySymbols;var yI=cn,Ms=Bd,IT=_l,OT=In,NT=G([].concat),DT=yI("Reflect","ownKeys")||function(e){var t=Ms.f(OT(e)),n=IT.f;return n?NT(t,n(e)):t},pp=Xn,E_=DT,PT=Ze,LT=Rs,fp={},xT=up,kT=gc,Wd=Object.keys||function(e){return xT(e,kT)},g_=rt,MT=zh,v_=Rs,mp=In,jT=qe,UT=Wd;fp.f=g_&&!MT?Object.defineProperties:function(e,t){mp(e);for(var n,i=jT(t),s=UT(t),o=s.length,c=0;o>c;)v_.f(e,n=s[c++],i[n]);return e};var Kd,S_=cn("document","documentElement"),VT=In,FT=fp,Po=gc,BT=Gd,bI=S_,Xr=Fh,zd="prototype",_p="script",T_=Ud("IE_PROTO"),Yd=function(){},Ep=function(e){return"<"+_p+">"+e+"</"+_p+">"},gp=function(e){e.write(Ep("")),e.close();var t=e.parentWindow.Object;return e=null,t},qd=function(){try{Kd=new ActiveXObject("htmlfile")}catch{}var e,t,n;qd=typeof document<"u"?document.domain&&Kd?gp(Kd):(t=Xr("iframe"),n="java"+_p+":",t.style.display="none",bI.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Ep("document.F=Object")),e.close(),e.F):gp(Kd);for(var i=Po.length;i--;)delete qd[zd][Po[i]];return qd()};BT[T_]=!0;var vc=Object.create||function(e,t){var n;return e!==null?(Yd[zd]=VT(e),n=new Yd,Yd[zd]=null,n[T_]=e):n=qd(),t===void 0?n:FT.f(n,t)},GT=Ei,HT=$r,y_=Error,b_=G("".replace),C_=String(new y_("zxcasd").stack),R_=/\n\s*at [^:]*:[^\n]*/,WT=R_.test(C_),KT=Ni,zT=!T(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",KT(1,7)),e.stack!==7)}),YT=$r,qT=function(e,t){if(WT&&typeof e=="string"&&!y_.prepareStackTrace)for(;t--;)e=b_(e,R_,"");return e},Qr=zT,$T=Error.captureStackTrace,Lo={},JT=Lo,XT=yn("iterator"),QT=Array.prototype,w_=function(e){return e!==void 0&&(JT.Array===e||QT[XT]===e)},ZT=br,A_=Td,ey=Ds,ty=Lo,ny=yn("iterator"),$d=function(e){if(!ey(e))return A_(e,ny)||A_(e,"@@iterator")||ty[ZT(e)]},iy=We,vp=ii,sy=In,Jd=tc,ry=$d,I_=TypeError,Xd=function(e,t){var n=arguments.length<2?ry(e):t;if(vp(n))return sy(iy(n,e));throw new I_(Jd(e)+" is not iterable")},El=We,Qd=In,oy=Td,O_=function(e,t,n){var i,s;Qd(e);try{if(!(i=oy(e,"return"))){if(t==="throw")throw n;return n}i=El(i,e)}catch(o){s=!0,i=o}if(t==="throw")throw n;if(s)throw i;return Qd(i),n},ay=qr,cy=We,ly=In,dy=tc,uy=w_,hy=Do,N_=q,py=Xd,fy=$d,D_=O_,my=TypeError,Zd=function(e,t){this.stopped=e,this.result=t},P_=Zd.prototype,er=function(e,t,n){var i,s,o,c,d,p,f,m=n&&n.that,g=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),A=ay(t,m),I=function(M){return i&&D_(i,"normal",M),new Zd(!0,M)},k=function(M){return g?(ly(M),D?A(M[0],M[1],I):A(M[0],M[1])):D?A(M,I):A(M)};if(v)i=e.iterator;else if(y)i=e;else{if(!(s=fy(e)))throw new my(dy(e)+" is not iterable");if(uy(s)){for(o=0,c=hy(e);c>o;o++)if((d=k(e[o]))&&N_(P_,d))return d;return new Zd(!1)}i=py(e,s)}for(p=v?e.next:i.next;!(f=cy(p,i)).done;){try{d=k(f.value)}catch(M){D_(i,"throw",M)}if(typeof d=="object"&&d&&N_(P_,d))return d}return new Zd(!1)},_y=as,Ey=yt,gy=q,vy=Vd,eu=RT,tu=function(e,t,n){for(var i=E_(t),s=LT.f,o=PT.f,c=0;c<i.length;c++){var d=i[c];pp(e,d)||n&&pp(n,d)||s(e,d,o(t,d))}},L_=vc,x_=$r,gl=Ni,Sy=function(e,t){GT(t)&&"cause"in t&&HT(e,"cause",t.cause)},Ty=function(e,t,n,i){Qr&&($T?$T(e,t):YT(e,"stack",qT(n,i)))},k_=er,yy=function(e,t){return e===void 0?arguments.length<2?"":t:_y(e)},by=yn("toStringTag"),Zr=Error,Cy=[].push,xo=function(e,t){var n,i=gy(Sp,this);eu?n=eu(new Zr,i?vy(this):Sp):(n=i?this:L_(Sp),x_(n,by,"Error")),t!==void 0&&x_(n,"message",yy(t)),Ty(n,xo,n.stack,1),arguments.length>2&&Sy(n,arguments[2]);var s=[];return k_(e,Cy,{that:s}),x_(n,"errors",s),n};eu?eu(xo,Zr):tu(xo,Zr,{name:!0});var Sp=xo.prototype=L_(Zr.prototype,{constructor:gl(1,xo),message:gl(1,""),name:gl(1,"AggregateError")});Ey({global:!0,constructor:!0,arity:2},{AggregateError:xo});var vl,nu,Tp,Ry=Me,M_=Y.WeakMap,wy=Ry(M_)&&/native code/.test(String(M_)),j_=Y,Ay=Ei,Sl=$r,yp=Xn,U_=xh,va=Ud,Iy=Gd,V_="Object already initialized",bp=j_.TypeError,Oy=j_.WeakMap;if(wy||U_.state){var Rr=U_.state||(U_.state=new Oy);Rr.get=Rr.get,Rr.has=Rr.has,Rr.set=Rr.set,vl=function(e,t){if(Rr.has(e))throw new bp(V_);return t.facade=e,Rr.set(e,t),t},nu=function(e){return Rr.get(e)||{}},Tp=function(e){return Rr.has(e)}}else{var Sc=va("state");Iy[Sc]=!0,vl=function(e,t){if(yp(e,Sc))throw new bp(V_);return t.facade=e,Sl(e,Sc,t),t},nu=function(e){return yp(e,Sc)?e[Sc]:{}},Tp=function(e){return yp(e,Sc)}}var Sa,F_,Cp,Ta={set:vl,get:nu,has:Tp,enforce:function(e){return Tp(e)?nu(e):vl(e,{})},getterFor:function(e){return function(t){var n;if(!Ay(t)||(n=nu(t)).type!==e)throw new bp("Incompatible receiver, "+e+" required");return n}}},iu=rt,Rp=Xn,wp=Function.prototype,ya=iu&&Object.getOwnPropertyDescriptor,su=Rp(wp,"name"),ru={EXISTS:su,PROPER:su&&(function(){}).name==="something",CONFIGURABLE:su&&(!iu||iu&&ya(wp,"name").configurable)},Ny=$r,eo=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Ny(e,t,n),e},Dy=T,Ap=Me,Py=Ei,Ly=vc,B_=Vd,G_=eo,Tl=yn("iterator"),H_=!1;[].keys&&("next"in(Cp=[].keys())?(F_=B_(B_(Cp)))!==Object.prototype&&(Sa=F_):H_=!0);var ba=!Py(Sa)||Dy(function(){var e={};return Sa[Tl].call(e)!==e});Ap((Sa=ba?{}:Ly(Sa))[Tl])||G_(Sa,Tl,function(){return this});var W_={IteratorPrototype:Sa,BUGGY_SAFARI_ITERATORS:H_},CI=br,ko=Dd?{}.toString:function(){return"[object "+CI(this)+"]"},xy=Dd,ky=Rs.f,My=$r,jy=Xn,Uy=ko,K_=yn("toStringTag"),to=function(e,t,n,i){var s=n?e:e&&e.prototype;s&&(jy(s,K_)||ky(s,K_,{configurable:!0,value:t}),i&&!xy&&My(s,"toString",Uy))},Vy=W_.IteratorPrototype,Fy=vc,z_=Ni,ou=to,au=Lo,By=function(){return this},Ip=function(e,t,n,i){var s=t+" Iterator";return e.prototype=Fy(Vy,{next:z_(+!i,n)}),ou(e,s,!1,!0),au[s]=By,e},yl=yt,RI=We,x=ru,S=Ip,O=Vd,W=to,ne=eo,ue=Lo,_e=W_,Ae=x.PROPER,Ue=_e.BUGGY_SAFARI_ITERATORS,it=yn("iterator"),Be="keys",Ot="values",Bt="entries",Rt=function(){return this},On=function(e,t,n,i,s,o,c){S(n,t,i);var d,p,f,m=function(k){if(k===s&&A)return A;if(!Ue&&k&&k in y)return y[k];switch(k){case Be:case Ot:case Bt:return function(){return new n(this,k)}}return function(){return new n(this)}},g=t+" Iterator",v=!1,y=e.prototype,D=y[it]||y["@@iterator"]||s&&y[s],A=!Ue&&D||m(s),I=t==="Array"&&y.entries||D;if(I&&(d=O(I.call(new e)))!==Object.prototype&&d.next&&(W(d,g,!0,!0),ue[g]=Rt),Ae&&s===Ot&&D&&D.name!==Ot&&(v=!0,A=function(){return RI(D,this)}),s)if(p={values:m(Ot),keys:o?A:m(Be),entries:m(Bt)},c)for(f in p)(Ue||v||!(f in y))&&ne(y,f,p[f]);else yl({target:t,proto:!0,forced:Ue||v},p);return c&&y[it]!==A&&ne(y,it,A,{name:s}),ue[t]=A,p},Lt=function(e,t){return{value:e,done:t}},ln=qe,kn=Lo,Qn=Ta;Rs.f;var si=On,Gt=Lt,Sn="Array Iterator",bn=Qn.set,Zn=Qn.getterFor(Sn);si(Array,"Array",function(e,t){bn(this,{type:Sn,target:ln(e),index:0,kind:t})},function(){var e=Zn(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Gt(void 0,!0);switch(e.kind){case"keys":return Gt(n,!1);case"values":return Gt(t[n],!1)}return Gt([n,t[n]],!1)},"values"),kn.Arguments=kn.Array;var Pi=Rs,ri=function(e,t,n){return Pi.f(e,t,n)},gi=cn,Fi=ri,tr=rt,Bi=yn("species"),Ca=q,Ra=TypeError,Qi=function(e,t){if(Ca(t,e))return e;throw new Ra("Incorrect invocation")},nr=Me,Tc=xh,wa=G(Function.toString);nr(Tc.inspectSource)||(Tc.inspectSource=function(e){return wa(e)});var bl=Tc.inspectSource,Op=G,Cl=T,Rl=Me,yc=br,Mo=bl,bc=function(){},wl=cn("Reflect","construct"),no=/^\s*(?:class|function)\b/,Np=Op(no.exec),Gy=!no.test(bc),Aa=function(e){if(!Rl(e))return!1;try{return wl(bc,[],e),!0}catch{return!1}},Y_=function(e){if(!Rl(e))return!1;switch(yc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Gy||!!Np(no,Mo(e))}catch{return!0}};Y_.sham=!0;var Cc,Rc,q_,cu,Al=!wl||Cl(function(){var e;return Aa(Aa.call)||!Aa(Object)||!Aa(function(){e=!0})||e})?Y_:Aa,Hy=Al,Wy=tc,Ia=TypeError,Il=In,$_=function(e){if(Hy(e))return e;throw new Ia(Wy(e)+" is not a constructor")},J_=Ds,Dp=yn("species"),lu=function(e,t){var n,i=Il(e).constructor;return i===void 0||J_(n=Il(i)[Dp])?t:$_(n)},io=G([].slice),X_=TypeError,jo=function(e,t){if(e<t)throw new X_("Not enough arguments");return e},wI=/(?:ipad|iphone|ipod).*applewebkit/i.test(wo),ir=Y,I4=pe,O4=qr,AI=Me,N4=Xn,II=T,OI=S_,D4=io,NI=Fh,P4=jo,L4=wI,x4=jd,Ky=ir.setImmediate,zy=ir.clearImmediate,k4=ir.process,Yy=ir.Dispatch,M4=ir.Function,DI=ir.MessageChannel,j4=ir.String,qy=0,Pp={},PI="onreadystatechange";II(function(){Cc=ir.location});var $y=function(e){if(N4(Pp,e)){var t=Pp[e];delete Pp[e],t()}},Jy=function(e){return function(){$y(e)}},LI=function(e){$y(e.data)},xI=function(e){ir.postMessage(j4(e),Cc.protocol+"//"+Cc.host)};Ky&&zy||(Ky=function(e){P4(arguments.length,1);var t=AI(e)?e:M4(e),n=D4(arguments,1);return Pp[++qy]=function(){I4(t,void 0,n)},Rc(qy),qy},zy=function(e){delete Pp[e]},x4?Rc=function(e){k4.nextTick(Jy(e))}:Yy&&Yy.now?Rc=function(e){Yy.now(Jy(e))}:DI&&!L4?(cu=(q_=new DI).port2,q_.port1.onmessage=LI,Rc=O4(cu.postMessage,cu)):ir.addEventListener&&AI(ir.postMessage)&&!ir.importScripts&&Cc&&Cc.protocol!=="file:"&&!II(xI)?(Rc=xI,ir.addEventListener("message",LI,!1)):Rc=PI in NI("script")?function(e){OI.appendChild(NI("script"))[PI]=function(){OI.removeChild(this),$y(e)}}:function(e){setTimeout(Jy(e),0)});var Q_={set:Ky,clear:zy},kI=Y,U4=rt,V4=Object.getOwnPropertyDescriptor,MI=function(e){if(!U4)return kI[e];var t=V4(kI,e);return t&&t.value},jI=function(){this.head=null,this.tail=null};jI.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var du,Xy,Qy,Zy,UI,VI=jI,F4=/ipad|iphone|ipod/i.test(wo)&&typeof Pebble<"u",B4=/web0s(?!.*chrome)/i.test(wo),uu=Y,G4=MI,FI=qr,eb=Q_.set,H4=VI,W4=wI,K4=F4,z4=B4,tb=jd,BI=uu.MutationObserver||uu.WebKitMutationObserver,GI=uu.document,HI=uu.process,Z_=uu.Promise,nb=G4("queueMicrotask");if(!nb){var eE=new H4,tE=function(){var e,t;for(tb&&(e=HI.domain)&&e.exit();t=eE.get();)try{t()}catch(n){throw eE.head&&du(),n}e&&e.enter()};W4||tb||z4||!BI||!GI?!K4&&Z_&&Z_.resolve?((Zy=Z_.resolve(void 0)).constructor=Z_,UI=FI(Zy.then,Zy),du=function(){UI(tE)}):tb?du=function(){HI.nextTick(tE)}:(eb=FI(eb,uu),du=function(){eb(tE)}):(Xy=!0,Qy=GI.createTextNode(""),new BI(tE).observe(Qy,{characterData:!0}),du=function(){Qy.data=Xy=!Xy}),nb=function(e){eE.head||du(),eE.add(e)}}var WI=nb,hu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ol=Y.Promise,Y4=Y,Lp=Ol,q4=Me,$4=Kh,J4=bl,X4=yn,KI=Md,ib=ha,zI=Lp&&Lp.prototype,Q4=X4("species"),YI=!1,qI=q4(Y4.PromiseRejectionEvent),Z4=$4("Promise",function(){var e=J4(Lp),t=e!==String(Lp);if(!t&&ib===66||!zI.catch||!zI.finally)return!0;if(!ib||ib<51||!/native code/.test(e)){var n=new Lp(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((n.constructor={})[Q4]=i,!(YI=n.then(function(){})instanceof i))return!0}return!(t||KI!=="BROWSER"&&KI!=="DENO"||qI)}),xp={CONSTRUCTOR:Z4,REJECTION_EVENT:qI,SUBCLASSING:YI},Uo={},$I=ii,e5=TypeError,t5=function(e){var t,n;this.promise=new e(function(i,s){if(t!==void 0||n!==void 0)throw new e5("Bad Promise constructor");t=i,n=s}),this.resolve=$I(t),this.reject=$I(n)};Uo.f=function(e){return new t5(e)};var sb,JI,n5=yt,nE=jd,wc=Y,kp=We,i5=eo,s5=to,r5=function(e){var t=gi(e);tr&&t&&!t[Bi]&&Fi(t,Bi,{configurable:!0,get:function(){return this}})},o5=ii,rb=Me,a5=Ei,c5=Qi,l5=lu,XI=Q_.set,ob=WI,d5=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},u5=hu,h5=VI,QI=Ta,ab=Ol,ZI=xp,e0=Uo,iE="Promise",t0=ZI.CONSTRUCTOR,p5=ZI.REJECTION_EVENT,cb=QI.getterFor(iE),f5=QI.set,m5=ab&&ab.prototype,Mp=ab,lb=m5,n0=wc.TypeError,db=wc.document,ub=wc.process,hb=e0.f,_5=hb,E5=!!(db&&db.createEvent&&wc.dispatchEvent),i0="unhandledrejection",s0=function(e){var t;return!(!a5(e)||!rb(t=e.then))&&t},r0=function(e,t){var n,i,s,o=t.value,c=t.state===1,d=c?e.ok:e.fail,p=e.resolve,f=e.reject,m=e.domain;try{d?(c||(t.rejection===2&&v5(t),t.rejection=1),d===!0?n=o:(m&&m.enter(),n=d(o),m&&(m.exit(),s=!0)),n===e.promise?f(new n0("Promise-chain cycle")):(i=s0(n))?kp(i,n,p,f):p(n)):f(o)}catch(g){m&&!s&&m.exit(),f(g)}},o0=function(e,t){e.notified||(e.notified=!0,ob(function(){for(var n,i=e.reactions;n=i.get();)r0(n,e);e.notified=!1,t&&!e.rejection&&g5(e)}))},a0=function(e,t,n){var i,s;E5?((i=db.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),wc.dispatchEvent(i)):i={promise:t,reason:n},!p5&&(s=wc["on"+e])?s(i):e===i0&&d5("Unhandled promise rejection",n)},g5=function(e){kp(XI,wc,function(){var t,n=e.facade,i=e.value;if(c0(e)&&(t=u5(function(){nE?ub.emit("unhandledRejection",i,n):a0(i0,n,i)}),e.rejection=nE||c0(e)?2:1,t.error))throw t.value})},c0=function(e){return e.rejection!==1&&!e.parent},v5=function(e){kp(XI,wc,function(){var t=e.facade;nE?ub.emit("rejectionHandled",t):a0("rejectionhandled",t,e.value)})},pu=function(e,t,n){return function(i){e(t,i,n)}},fu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,o0(e,!0))},pb=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new n0("Promise can't be resolved itself");var i=s0(t);i?ob(function(){var s={done:!1};try{kp(i,t,pu(pb,s,e),pu(fu,s,e))}catch(o){fu(s,o,e)}}):(e.value=t,e.state=1,o0(e,!1))}catch(s){fu({done:!1},s,e)}}};t0&&(lb=(Mp=function(e){c5(this,lb),o5(e),kp(sb,this);var t=cb(this);try{e(pu(pb,t),pu(fu,t))}catch(n){fu(t,n)}}).prototype,(sb=function(e){f5(this,{type:iE,done:!1,notified:!1,parent:!1,reactions:new h5,rejection:!1,state:0,value:null})}).prototype=i5(lb,"then",function(e,t){var n=cb(this),i=hb(l5(this,Mp));return n.parent=!0,i.ok=!rb(e)||e,i.fail=rb(t)&&t,i.domain=nE?ub.domain:void 0,n.state===0?n.reactions.add(i):ob(function(){r0(i,n)}),i.promise}),JI=function(){var e=new sb,t=cb(e);this.promise=e,this.resolve=pu(pb,t),this.reject=pu(fu,t)},e0.f=hb=function(e){return e===Mp||e===void 0?new JI(e):_5(e)}),n5({global:!0,constructor:!0,wrap:!0,forced:t0},{Promise:Mp}),s5(Mp,iE,!1,!0),r5(iE);var l0=yn("iterator"),d0=!1;try{var S5=0,u0={next:function(){return{done:!!S5++}},return:function(){d0=!0}};u0[l0]=function(){return this},Array.from(u0,function(){throw 2})}catch{}var T5=Ol,y5=function(e,t){try{if(!t&&!d0)return!1}catch{return!1}var n=!1;try{var i={};i[l0]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},sE=xp.CONSTRUCTOR||!y5(function(e){T5.all(e).then(void 0,function(){})}),b5=We,C5=ii,R5=Uo,w5=hu,A5=er;yt({target:"Promise",stat:!0,forced:sE},{all:function(e){var t=this,n=R5.f(t),i=n.resolve,s=n.reject,o=w5(function(){var c=C5(t.resolve),d=[],p=0,f=1;A5(e,function(m){var g=p++,v=!1;f++,b5(c,t,m).then(function(y){v||(v=!0,d[g]=y,--f||i(d))},s)}),--f||i(d)});return o.error&&s(o.value),n.promise}});var I5=yt,O5=xp.CONSTRUCTOR;Ol&&Ol.prototype,I5({target:"Promise",proto:!0,forced:O5,real:!0},{catch:function(e){return this.then(void 0,e)}});var N5=We,D5=ii,P5=Uo,L5=hu,x5=er;yt({target:"Promise",stat:!0,forced:sE},{race:function(e){var t=this,n=P5.f(t),i=n.reject,s=L5(function(){var o=D5(t.resolve);x5(e,function(c){N5(o,t,c).then(n.resolve,i)})});return s.error&&i(s.value),n.promise}});var k5=Uo;yt({target:"Promise",stat:!0,forced:xp.CONSTRUCTOR},{reject:function(e){var t=k5.f(this);return(0,t.reject)(e),t.promise}});var M5=In,j5=Ei,U5=Uo,h0=function(e,t){if(M5(e),j5(t)&&t.constructor===e)return t;var n=U5.f(e);return(0,n.resolve)(t),n.promise},V5=yt,F5=Ol,B5=xp.CONSTRUCTOR,G5=h0,H5=cn("Promise"),W5=!B5;V5({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return G5(W5&&this===H5?F5:this,e)}});var K5=We,z5=ii,Y5=Uo,q5=hu,$5=er;yt({target:"Promise",stat:!0,forced:sE},{allSettled:function(e){var t=this,n=Y5.f(t),i=n.resolve,s=n.reject,o=q5(function(){var c=z5(t.resolve),d=[],p=0,f=1;$5(e,function(m){var g=p++,v=!1;f++,K5(c,t,m).then(function(y){v||(v=!0,d[g]={status:"fulfilled",value:y},--f||i(d))},function(y){v||(v=!0,d[g]={status:"rejected",reason:y},--f||i(d))})}),--f||i(d)});return o.error&&s(o.value),n.promise}});var J5=We,X5=ii,Q5=cn,Z5=Uo,e6=hu,t6=er,p0="No one promise resolved";yt({target:"Promise",stat:!0,forced:sE},{any:function(e){var t=this,n=Q5("AggregateError"),i=Z5.f(t),s=i.resolve,o=i.reject,c=e6(function(){var d=X5(t.resolve),p=[],f=0,m=1,g=!1;t6(e,function(v){var y=f++,D=!1;m++,J5(d,t,v).then(function(A){D||g||(g=!0,s(A))},function(A){D||g||(D=!0,p[y]=A,--m||o(new n(p,p0)))})}),--m||o(new n(p,p0))});return c.error&&o(c.value),i.promise}});var n6=yt,i6=pe,s6=io,r6=Uo,o6=ii,f0=hu,fb=Y.Promise,m0=!1;n6({target:"Promise",stat:!0,forced:!fb||!fb.try||f0(function(){fb.try(function(e){m0=e===8},8)}).error||!m0},{try:function(e){var t=arguments.length>1?s6(arguments,1):[],n=r6.f(this),i=f0(function(){return i6(o6(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var a6=Uo;yt({target:"Promise",stat:!0},{withResolvers:function(){var e=a6.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var c6=yt,mb=Ol,l6=T,d6=cn,u6=Me,h6=lu,_0=h0,p6=mb&&mb.prototype;c6({target:"Promise",proto:!0,real:!0,forced:!!mb&&l6(function(){p6.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=h6(this,d6("Promise")),n=u6(e);return this.then(n?function(i){return _0(t,e()).then(function(){return i})}:e,n?function(i){return _0(t,e()).then(function(){throw i})}:e)}});var _b=G,f6=$h,m6=as,_6=wi,E6=_b("".charAt),E0=_b("".charCodeAt),g6=_b("".slice),g0=function(e){return function(t,n){var i,s,o=m6(_6(t)),c=f6(n),d=o.length;return c<0||c>=d?e?"":void 0:(i=E0(o,c))<55296||i>56319||c+1===d||(s=E0(o,c+1))<56320||s>57343?e?E6(o,c):i:e?g6(o,c,c+2):s-56320+(i-55296<<10)+65536}},Eb={codeAt:g0(!1),charAt:g0(!0)},v6=Eb.charAt,S6=as,v0=Ta,T6=On,S0=Lt,T0="String Iterator",y6=v0.set,b6=v0.getterFor(T0);T6(String,"String",function(e){y6(this,{type:T0,string:S6(e),index:0})},function(){var e,t=b6(this),n=t.string,i=t.index;return i>=n.length?S0(void 0,!0):(e=v6(n,i),t.index+=e.length,S0(e,!1))});var C6=os.Promise,R6={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},w6=Y,A6=to,y0=Lo;for(var gb in R6)A6(w6[gb],gb),y0[gb]=y0.Array;var b0=C6,Te=E(b0),I6=xs("Array","values"),O6=br,N6=Xn,D6=q,P6=I6,vb=Array.prototype,L6={DOMTokenList:!0,NodeList:!0},x6=function(e){var t=e.values;return e===vb||D6(vb,e)&&t===vb.values||N6(L6,O6(e))?P6:t},js=E(x6),k6=yt,M6=G,j6=Jh,U6=RangeError,C0=String.fromCharCode,R0=String.fromCodePoint,V6=M6([].join);k6({target:"String",stat:!0,arity:1,forced:!!R0&&R0.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,s=0;i>s;){if(t=+arguments[s++],j6(t,1114111)!==t)throw new U6(t+" is not a valid code point");n[s]=t<65536?C0(t):C0(55296+((t-=65536)>>10),t%1024+56320)}return V6(n,"")}});var F6=T,B6=ES,G6=yn("iterator"),rE=!F6(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(s,o){t.delete("b"),i+=o+s}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&B6||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[G6]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),H6=eo,w0=io,W6=Math.floor,Sb=function(e,t){var n=e.length;if(n<8)for(var i,s,o=1;o<n;){for(s=o,i=e[o];s&&t(e[s-1],i)>0;)e[s]=e[--s];s!==o++&&(e[s]=i)}else for(var c=W6(n/2),d=Sb(w0(e,0,c),t),p=Sb(w0(e,c),t),f=d.length,m=p.length,g=0,v=0;g<f||v<m;)e[g+v]=g<f&&v<m?t(d[g],p[v])<=0?d[g++]:p[v++]:g<f?d[g++]:p[v++];return e},A0=Sb,Tb=yt,I0=Y,yb=MI,K6=cn,oE=We,so=G,jp=rt,O0=rE,N0=eo,z6=ri,Y6=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:H6(e,i,t[i],n);return e},q6=to,$6=Ip,bb=Ta,D0=Qi,Cb=Me,J6=Xn,X6=qr,Q6=br,Z6=In,P0=Ei,ws=as,e8=vc,L0=Ni,x0=Xd,t8=$d,aE=Lt,mu=jo,n8=A0,i8=yn("iterator"),_u="URLSearchParams",k0=_u+"Iterator",M0=bb.set,wr=bb.getterFor(_u),s8=bb.getterFor(k0),j0=yb("fetch"),cE=yb("Request"),Up=yb("Headers"),Rb=cE&&cE.prototype,U0=Up&&Up.prototype,r8=I0.TypeError,o8=I0.encodeURIComponent,a8=String.fromCharCode,c8=K6("String","fromCodePoint"),l8=parseInt,lE=so("".charAt),V0=so([].join),Ac=so([].push),F0=so("".replace),d8=so([].shift),B0=so([].splice),G0=so("".split),H0=so("".slice),u8=so(/./.exec),h8=/\+/g,p8=/^[0-9a-f]+$/i,W0=function(e,t){var n=H0(e,t,t+2);return u8(p8,n)?l8(n,16):NaN},f8=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},m8=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},K0=function(e){for(var t=(e=F0(e,h8," ")).length,n="",i=0;i<t;){var s=lE(e,i);if(s==="%"){if(lE(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var o=W0(e,i+1);if(o!=o){n+=s,i++;continue}i+=2;var c=f8(o);if(c===0)s=a8(o);else{if(c===1||c>4){n+="�",i++;continue}for(var d=[o],p=1;p<c&&!(++i+3>t||lE(e,i)!=="%");){var f=W0(e,i+1);if(f!=f){i+=3;break}if(f>191||f<128)break;Ac(d,f),i+=2,p++}if(d.length!==c){n+="�";continue}var m=m8(d);m===null?n+="�":s=c8(m)}}n+=s,i++}return n},_8=/[!'()~]|%20/g,E8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},g8=function(e){return E8[e]},z0=function(e){return F0(o8(e),_8,g8)},wb=$6(function(e,t){M0(this,{type:k0,target:wr(e).entries,index:0,kind:t})},_u,function(){var e=s8(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,aE(void 0,!0);var i=t[n];switch(e.kind){case"keys":return aE(i.key,!1);case"values":return aE(i.value,!1)}return aE([i.key,i.value],!1)},!0),Y0=function(e){this.entries=[],this.url=null,e!==void 0&&(P0(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?lE(e,0)==="?"?H0(e,1):e:ws(e)))};Y0.prototype={type:_u,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,s,o,c,d,p=this.entries,f=t8(e);if(f)for(n=(t=x0(e,f)).next;!(i=oE(n,t)).done;){if(o=(s=x0(Z6(i.value))).next,(c=oE(o,s)).done||(d=oE(o,s)).done||!oE(o,s).done)throw new r8("Expected sequence with length 2");Ac(p,{key:ws(c.value),value:ws(d.value)})}else for(var m in e)J6(e,m)&&Ac(p,{key:m,value:ws(e[m])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,s=G0(e,"&"),o=0;o<s.length;)(t=s[o++]).length&&(n=G0(t,"="),Ac(i,{key:K0(d8(n)),value:K0(V0(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Ac(n,z0(e.key)+"="+z0(e.value));return V0(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var dE=function(){D0(this,Eu);var e=M0(this,new Y0(arguments.length>0?arguments[0]:void 0));jp||(this.size=e.entries.length)},Eu=dE.prototype;if(Y6(Eu,{append:function(e,t){var n=wr(this);mu(arguments.length,2),Ac(n.entries,{key:ws(e),value:ws(t)}),jp||this.length++,n.updateURL()},delete:function(e){for(var t=wr(this),n=mu(arguments.length,1),i=t.entries,s=ws(e),o=n<2?void 0:arguments[1],c=o===void 0?o:ws(o),d=0;d<i.length;){var p=i[d];if(p.key!==s||c!==void 0&&p.value!==c)d++;else if(B0(i,d,1),c!==void 0)break}jp||(this.size=i.length),t.updateURL()},get:function(e){var t=wr(this).entries;mu(arguments.length,1);for(var n=ws(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=wr(this).entries;mu(arguments.length,1);for(var n=ws(e),i=[],s=0;s<t.length;s++)t[s].key===n&&Ac(i,t[s].value);return i},has:function(e){for(var t=wr(this).entries,n=mu(arguments.length,1),i=ws(e),s=n<2?void 0:arguments[1],o=s===void 0?s:ws(s),c=0;c<t.length;){var d=t[c++];if(d.key===i&&(o===void 0||d.value===o))return!0}return!1},set:function(e,t){var n=wr(this);mu(arguments.length,1);for(var i,s=n.entries,o=!1,c=ws(e),d=ws(t),p=0;p<s.length;p++)(i=s[p]).key===c&&(o?B0(s,p--,1):(o=!0,i.value=d));o||Ac(s,{key:c,value:d}),jp||(this.size=s.length),n.updateURL()},sort:function(){var e=wr(this);n8(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=wr(this).entries,i=X6(e,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)i((t=n[s++]).value,t.key,this)},keys:function(){return new wb(this,"keys")},values:function(){return new wb(this,"values")},entries:function(){return new wb(this,"entries")}},{enumerable:!0}),N0(Eu,i8,Eu.entries,{name:"entries"}),N0(Eu,"toString",function(){return wr(this).serialize()},{enumerable:!0}),jp&&z6(Eu,"size",{get:function(){return wr(this).entries.length},configurable:!0,enumerable:!0}),q6(dE,_u),Tb({global:!0,constructor:!0,forced:!O0},{URLSearchParams:dE}),!O0&&Cb(Up)){var v8=so(U0.has),S8=so(U0.set),q0=function(e){if(P0(e)){var t,n=e.body;if(Q6(n)===_u)return t=e.headers?new Up(e.headers):new Up,v8(t,"content-type")||S8(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),e8(e,{body:L0(0,ws(n)),headers:L0(0,t)})}return e};if(Cb(j0)&&Tb({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return j0(e,arguments.length>1?q0(arguments[1]):{})}}),Cb(cE)){var Ab=function(e){return D0(this,Rb),new cE(e,arguments.length>1?q0(arguments[1]):{})};Rb.constructor=Ab,Ab.prototype=Rb,Tb({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Ab})}}var Ar,T8={URLSearchParams:dE,getState:wr},y8=os.URLSearchParams,$0=rt,b8=G,C8=We,R8=T,Ib=Wd,w8=_l,A8=Kt,I8=Sr,O8=Kr,gu=Object.assign,J0=Object.defineProperty,N8=b8([].concat),D8=!gu||R8(function(){if($0&&gu({b:1},gu(J0({},"a",{enumerable:!0,get:function(){J0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(s){t[s]=s}),gu({},e)[n]!==7||Ib(gu({},t)).join("")!==i})?function(e,t){for(var n=I8(e),i=arguments.length,s=1,o=w8.f,c=A8.f;i>s;)for(var d,p=O8(arguments[s++]),f=o?N8(Ib(p),o(p)):Ib(p),m=f.length,g=0;m>g;)d=f[g++],$0&&!C8(c,p,d)||(n[d]=p[d]);return n}:gu,P8=In,L8=O_,x8=rt,k8=Rs,M8=Ni,Ob=function(e,t,n){x8?k8.f(e,t,M8(0,n)):e[t]=n},j8=qr,U8=We,V8=Sr,F8=function(e,t,n,i){try{return i?t(P8(n)[0],n[1]):t(n)}catch(s){L8(e,"throw",s)}},B8=w_,G8=Al,H8=Do,X0=Ob,W8=Xd,K8=$d,Q0=Array,Nl=G,Nb=2147483647,z8=/[^\0-\u007E]/,Z0=/[.\u3002\uFF0E\uFF61]/g,eO="Overflow: input needs wider integers to process",tO=RangeError,Y8=Nl(Z0.exec),vu=Math.floor,Db=String.fromCharCode,nO=Nl("".charCodeAt),iO=Nl([].join),Ic=Nl([].push),q8=Nl("".replace),$8=Nl("".split),J8=Nl("".toLowerCase),sO=function(e){return e+22+75*(e<26)},X8=function(e,t,n){var i=0;for(e=n?vu(e/700):e>>1,e+=vu(e/t);e>455;)e=vu(e/35),i+=36;return vu(i+36*e/(e+38))},Q8=function(e){var t=[];e=function(k){for(var M=[],H=0,J=k.length;H<J;){var $=nO(k,H++);if($>=55296&&$<=56319&&H<J){var z=nO(k,H++);(64512&z)==56320?Ic(M,((1023&$)<<10)+(1023&z)+65536):(Ic(M,$),H--)}else Ic(M,$)}return M}(e);var n,i,s=e.length,o=128,c=0,d=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Ic(t,Db(i));var p=t.length,f=p;for(p&&Ic(t,"-");f<s;){var m=Nb;for(n=0;n<e.length;n++)(i=e[n])>=o&&i<m&&(m=i);var g=f+1;if(m-o>vu((Nb-c)/g))throw new tO(eO);for(c+=(m-o)*g,o=m,n=0;n<e.length;n++){if((i=e[n])<o&&++c>Nb)throw new tO(eO);if(i===o){for(var v=c,y=36;;){var D=y<=d?1:y>=d+26?26:y-d;if(v<D)break;var A=v-D,I=36-D;Ic(t,Db(sO(D+A%I))),v=vu(A/I),y+=36}Ic(t,Db(sO(v))),d=X8(c,g,f===p),c=0,f++}}c++,o++}return iO(t,"")},Z8=yt,Pb=rt,e3=rE,Lb=Y,rO=qr,Ir=G,uE=eo,Or=ri,t3=Qi,xb=Xn,kb=D8,Su=function(e){var t=V8(e),n=G8(this),i=arguments.length,s=i>1?arguments[1]:void 0,o=s!==void 0;o&&(s=j8(s,i>2?arguments[2]:void 0));var c,d,p,f,m,g,v=K8(t),y=0;if(!v||this===Q0&&B8(v))for(c=H8(t),d=n?new this(c):Q0(c);c>y;y++)g=o?s(t[y],y):t[y],X0(d,y,g);else for(d=n?new this:[],m=(f=W8(t,v)).next;!(p=U8(m,f)).done;y++)g=o?F8(f,s,[p.value,y],!0):p.value,X0(d,y,g);return d.length=y,d},ro=io,n3=Eb.codeAt,i3=function(e){var t,n,i=[],s=$8(q8(J8(e),Z0,"."),".");for(t=0;t<s.length;t++)n=s[t],Ic(i,Y8(z8,n)?"xn--"+Q8(n):n);return iO(i,".")},Oa=as,s3=to,r3=jo,oO=T8,aO=Ta,o3=aO.set,hE=aO.getterFor("URL"),a3=oO.URLSearchParams,c3=oO.getState,Vp=Lb.URL,Mb=Lb.TypeError,pE=Lb.parseInt,l3=Math.floor,cO=Math.pow,Nr=Ir("".charAt),oo=Ir(/./.exec),Fp=Ir([].join),d3=Ir(1 .toString),u3=Ir([].pop),Tu=Ir([].push),jb=Ir("".replace),h3=Ir([].shift),p3=Ir("".split),Bp=Ir("".slice),fE=Ir("".toLowerCase),f3=Ir([].unshift),Ub="Invalid scheme",Dl="Invalid host",lO="Invalid port",dO=/[a-z]/i,m3=/[\d+-.a-z]/i,Vb=/\d/,_3=/^0x/i,E3=/^[0-7]+$/,g3=/^\d+$/,uO=/^[\da-f]+$/i,v3=/[\0\t\n\r #%/:<>?@[\\\]^|]/,S3=/[\0\t\n\r #/:<>?@[\\\]^|]/,T3=/^[\u0000-\u0020]+/,y3=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,b3=/[\t\n\r]/g,Gp=function(e){var t,n,i,s;if(typeof e=="number"){for(t=[],n=0;n<4;n++)f3(t,e%256),e=l3(e/256);return Fp(t,".")}if(typeof e=="object"){for(t="",i=function(o){for(var c=null,d=1,p=null,f=0,m=0;m<8;m++)o[m]!==0?(f>d&&(c=p,d=f),p=null,f=0):(p===null&&(p=m),++f);return f>d?p:c}(e),n=0;n<8;n++)s&&e[n]===0||(s&&(s=!1),i===n?(t+=n?":":"::",s=!0):(t+=d3(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},mE={},hO=kb({},mE,{" ":1,'"':1,"<":1,">":1,"`":1}),pO=kb({},hO,{"#":1,"?":1,"{":1,"}":1}),Fb=kb({},pO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Oc=function(e,t){var n=n3(e,0);return n>32&&n<127&&!xb(t,e)?e:encodeURIComponent(e)},_E={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Hp=function(e,t){var n;return e.length===2&&oo(dO,Nr(e,0))&&((n=Nr(e,1))===":"||!t&&n==="|")},fO=function(e){var t;return e.length>1&&Hp(Bp(e,0,2))&&(e.length===2||(t=Nr(e,2))==="/"||t==="\\"||t==="?"||t==="#")},C3=function(e){return e==="."||fE(e)==="%2e"},Bb={},mO={},Gb={},_O={},EO={},Hb={},gO={},vO={},EE={},gE={},Wb={},Kb={},zb={},Yb={},SO={},qb={},yu={},Vo={},TO={},Pl={},Na={},$b=function(e,t,n){var i,s,o,c=Oa(e);if(t){if(s=this.parse(c))throw new Mb(s);this.searchParams=null}else{if(n!==void 0&&(i=new $b(n,!0)),s=this.parse(c,null,i))throw new Mb(s);(o=c3(new a3)).bindURL(this),this.searchParams=o}};$b.prototype={type:"URL",parse:function(e,t,n){var i,s,o,c,d,p=this,f=t||Bb,m=0,g="",v=!1,y=!1,D=!1;for(e=Oa(e),t||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,e=jb(e,T3,""),e=jb(e,y3,"$1")),e=jb(e,b3,""),i=Su(e);m<=i.length;){switch(s=i[m],f){case Bb:if(!s||!oo(dO,s)){if(t)return Ub;f=Gb;continue}g+=fE(s),f=mO;break;case mO:if(s&&(oo(m3,s)||s==="+"||s==="-"||s==="."))g+=fE(s);else{if(s!==":"){if(t)return Ub;g="",f=Gb,m=0;continue}if(t&&(p.isSpecial()!==xb(_E,g)||g==="file"&&(p.includesCredentials()||p.port!==null)||p.scheme==="file"&&!p.host))return;if(p.scheme=g,t)return void(p.isSpecial()&&_E[p.scheme]===p.port&&(p.port=null));g="",p.scheme==="file"?f=Yb:p.isSpecial()&&n&&n.scheme===p.scheme?f=_O:p.isSpecial()?f=vO:i[m+1]==="/"?(f=EO,m++):(p.cannotBeABaseURL=!0,Tu(p.path,""),f=TO)}break;case Gb:if(!n||n.cannotBeABaseURL&&s!=="#")return Ub;if(n.cannotBeABaseURL&&s==="#"){p.scheme=n.scheme,p.path=ro(n.path),p.query=n.query,p.fragment="",p.cannotBeABaseURL=!0,f=Na;break}f=n.scheme==="file"?Yb:Hb;continue;case _O:if(s!=="/"||i[m+1]!=="/"){f=Hb;continue}f=EE,m++;break;case EO:if(s==="/"){f=gE;break}f=Vo;continue;case Hb:if(p.scheme=n.scheme,s===Ar)p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=ro(n.path),p.query=n.query;else if(s==="/"||s==="\\"&&p.isSpecial())f=gO;else if(s==="?")p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=ro(n.path),p.query="",f=Pl;else{if(s!=="#"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=ro(n.path),p.path.length--,f=Vo;continue}p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,p.path=ro(n.path),p.query=n.query,p.fragment="",f=Na}break;case gO:if(!p.isSpecial()||s!=="/"&&s!=="\\"){if(s!=="/"){p.username=n.username,p.password=n.password,p.host=n.host,p.port=n.port,f=Vo;continue}f=gE}else f=EE;break;case vO:if(f=EE,s!=="/"||Nr(g,m+1)!=="/")continue;m++;break;case EE:if(s!=="/"&&s!=="\\"){f=gE;continue}break;case gE:if(s==="@"){v&&(g="%40"+g),v=!0,o=Su(g);for(var A=0;A<o.length;A++){var I=o[A];if(I!==":"||D){var k=Oc(I,Fb);D?p.password+=k:p.username+=k}else D=!0}g=""}else if(s===Ar||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()){if(v&&g==="")return"Invalid authority";m-=Su(g).length+1,g="",f=Wb}else g+=s;break;case Wb:case Kb:if(t&&p.scheme==="file"){f=qb;continue}if(s!==":"||y){if(s===Ar||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()){if(p.isSpecial()&&g==="")return Dl;if(t&&g===""&&(p.includesCredentials()||p.port!==null))return;if(c=p.parseHost(g))return c;if(g="",f=yu,t)return;continue}s==="["?y=!0:s==="]"&&(y=!1),g+=s}else{if(g==="")return Dl;if(c=p.parseHost(g))return c;if(g="",f=zb,t===Kb)return}break;case zb:if(!oo(Vb,s)){if(s===Ar||s==="/"||s==="?"||s==="#"||s==="\\"&&p.isSpecial()||t){if(g!==""){var M=pE(g,10);if(M>65535)return lO;p.port=p.isSpecial()&&M===_E[p.scheme]?null:M,g=""}if(t)return;f=yu;continue}return lO}g+=s;break;case Yb:if(p.scheme="file",s==="/"||s==="\\")f=SO;else{if(!n||n.scheme!=="file"){f=Vo;continue}switch(s){case Ar:p.host=n.host,p.path=ro(n.path),p.query=n.query;break;case"?":p.host=n.host,p.path=ro(n.path),p.query="",f=Pl;break;case"#":p.host=n.host,p.path=ro(n.path),p.query=n.query,p.fragment="",f=Na;break;default:fO(Fp(ro(i,m),""))||(p.host=n.host,p.path=ro(n.path),p.shortenPath()),f=Vo;continue}}break;case SO:if(s==="/"||s==="\\"){f=qb;break}n&&n.scheme==="file"&&!fO(Fp(ro(i,m),""))&&(Hp(n.path[0],!0)?Tu(p.path,n.path[0]):p.host=n.host),f=Vo;continue;case qb:if(s===Ar||s==="/"||s==="\\"||s==="?"||s==="#"){if(!t&&Hp(g))f=Vo;else if(g===""){if(p.host="",t)return;f=yu}else{if(c=p.parseHost(g))return c;if(p.host==="localhost"&&(p.host=""),t)return;g="",f=yu}continue}g+=s;break;case yu:if(p.isSpecial()){if(f=Vo,s!=="/"&&s!=="\\")continue}else if(t||s!=="?")if(t||s!=="#"){if(s!==Ar&&(f=Vo,s!=="/"))continue}else p.fragment="",f=Na;else p.query="",f=Pl;break;case Vo:if(s===Ar||s==="/"||s==="\\"&&p.isSpecial()||!t&&(s==="?"||s==="#")){if((d=fE(d=g))===".."||d==="%2e."||d===".%2e"||d==="%2e%2e"?(p.shortenPath(),s==="/"||s==="\\"&&p.isSpecial()||Tu(p.path,"")):C3(g)?s==="/"||s==="\\"&&p.isSpecial()||Tu(p.path,""):(p.scheme==="file"&&!p.path.length&&Hp(g)&&(p.host&&(p.host=""),g=Nr(g,0)+":"),Tu(p.path,g)),g="",p.scheme==="file"&&(s===Ar||s==="?"||s==="#"))for(;p.path.length>1&&p.path[0]==="";)h3(p.path);s==="?"?(p.query="",f=Pl):s==="#"&&(p.fragment="",f=Na)}else g+=Oc(s,pO);break;case TO:s==="?"?(p.query="",f=Pl):s==="#"?(p.fragment="",f=Na):s!==Ar&&(p.path[0]+=Oc(s,mE));break;case Pl:t||s!=="#"?s!==Ar&&(s==="'"&&p.isSpecial()?p.query+="%27":p.query+=s==="#"?"%23":Oc(s,mE)):(p.fragment="",f=Na);break;case Na:s!==Ar&&(p.fragment+=Oc(s,hO))}m++}},parseHost:function(e){var t,n,i;if(Nr(e,0)==="["){if(Nr(e,e.length-1)!=="]"||(t=function(s){var o,c,d,p,f,m,g,v=[0,0,0,0,0,0,0,0],y=0,D=null,A=0,I=function(){return Nr(s,A)};if(I()===":"){if(Nr(s,1)!==":")return;A+=2,D=++y}for(;I();){if(y===8)return;if(I()!==":"){for(o=c=0;c<4&&oo(uO,I());)o=16*o+pE(I(),16),A++,c++;if(I()==="."){if(c===0||(A-=c,y>6))return;for(d=0;I();){if(p=null,d>0){if(!(I()==="."&&d<4))return;A++}if(!oo(Vb,I()))return;for(;oo(Vb,I());){if(f=pE(I(),10),p===null)p=f;else{if(p===0)return;p=10*p+f}if(p>255)return;A++}v[y]=256*v[y]+p,++d!=2&&d!==4||y++}if(d!==4)return;break}if(I()===":"){if(A++,!I())return}else if(I())return;v[y++]=o}else{if(D!==null)return;A++,D=++y}}if(D!==null)for(m=y-D,y=7;y!==0&&m>0;)g=v[y],v[y--]=v[D+m-1],v[D+--m]=g;else if(y!==8)return;return v}(Bp(e,1,-1)),!t))return Dl;this.host=t}else if(this.isSpecial()){if(e=i3(e),oo(v3,e)||(t=function(s){var o,c,d,p,f,m,g,v=p3(s,".");if(v.length&&v[v.length-1]===""&&v.length--,(o=v.length)>4)return s;for(c=[],d=0;d<o;d++){if((p=v[d])==="")return s;if(f=10,p.length>1&&Nr(p,0)==="0"&&(f=oo(_3,p)?16:8,p=Bp(p,f===8?1:2)),p==="")m=0;else{if(!oo(f===10?g3:f===8?E3:uO,p))return s;m=pE(p,f)}Tu(c,m)}for(d=0;d<o;d++)if(m=c[d],d===o-1){if(m>=cO(256,5-o))return null}else if(m>255)return null;for(g=u3(c),d=0;d<c.length;d++)g+=c[d]*cO(256,3-d);return g}(e),t===null))return Dl;this.host=t}else{if(oo(S3,e))return Dl;for(t="",n=Su(e),i=0;i<n.length;i++)t+=Oc(n[i],mE);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return xb(_E,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Hp(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,s=e.host,o=e.port,c=e.path,d=e.query,p=e.fragment,f=t+":";return s!==null?(f+="//",e.includesCredentials()&&(f+=n+(i?":"+i:"")+"@"),f+=Gp(s),o!==null&&(f+=":"+o)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?c[0]:c.length?"/"+Fp(c,"/"):"",d!==null&&(f+="?"+d),p!==null&&(f+="#"+p),f},setHref:function(e){var t=this.parse(e);if(t)throw new Mb(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new bu(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Gp(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Oa(e)+":",Bb)},getUsername:function(){return this.username},setUsername:function(e){var t=Su(Oa(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Oc(t[n],Fb)}},getPassword:function(){return this.password},setPassword:function(e){var t=Su(Oa(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Oc(t[n],Fb)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Gp(e):Gp(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Wb)},getHostname:function(){var e=this.host;return e===null?"":Gp(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Kb)},getPort:function(){var e=this.port;return e===null?"":Oa(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Oa(e))===""?this.port=null:this.parse(e,zb))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Fp(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,yu))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Oa(e))===""?this.query=null:(Nr(e,0)==="?"&&(e=Bp(e,1)),this.query="",this.parse(e,Pl)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Oa(e))!==""?(Nr(e,0)==="#"&&(e=Bp(e,1)),this.fragment="",this.parse(e,Na)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var bu=function(e){var t=t3(this,As),n=r3(arguments.length,1)>1?arguments[1]:void 0,i=o3(t,new $b(e,!1,n));Pb||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},As=bu.prototype,Dr=function(e,t){return{get:function(){return hE(this)[e]()},set:t&&function(n){return hE(this)[t](n)},configurable:!0,enumerable:!0}};if(Pb&&(Or(As,"href",Dr("serialize","setHref")),Or(As,"origin",Dr("getOrigin")),Or(As,"protocol",Dr("getProtocol","setProtocol")),Or(As,"username",Dr("getUsername","setUsername")),Or(As,"password",Dr("getPassword","setPassword")),Or(As,"host",Dr("getHost","setHost")),Or(As,"hostname",Dr("getHostname","setHostname")),Or(As,"port",Dr("getPort","setPort")),Or(As,"pathname",Dr("getPathname","setPathname")),Or(As,"search",Dr("getSearch","setSearch")),Or(As,"searchParams",Dr("getSearchParams")),Or(As,"hash",Dr("getHash","setHash"))),uE(As,"toJSON",function(){return hE(this).serialize()},{enumerable:!0}),uE(As,"toString",function(){return hE(this).serialize()},{enumerable:!0}),Vp){var yO=Vp.createObjectURL,bO=Vp.revokeObjectURL;yO&&uE(bu,"createObjectURL",rO(yO,Vp)),bO&&uE(bu,"revokeObjectURL",rO(bO,Vp))}s3(bu,"URL"),Z8({global:!0,constructor:!0,forced:!e3,sham:!Pb},{URL:bu});var R3=yt,CO=T,w3=jo,RO=as,A3=rE,Jb=cn("URL"),I3=A3&&CO(function(){Jb.canParse()}),O3=CO(function(){return Jb.canParse.length!==1});R3({target:"URL",stat:!0,forced:!I3||O3},{canParse:function(e){var t=w3(arguments.length,1),n=RO(e),i=t<2||arguments[1]===void 0?void 0:RO(arguments[1]);try{return!!new Jb(n,i)}catch{return!1}}});var N3=yt,D3=jo,wO=as,P3=rE,L3=cn("URL");N3({target:"URL",stat:!0,forced:!P3},{parse:function(e){var t=D3(arguments.length,1),n=wO(e),i=t<2||arguments[1]===void 0?void 0:wO(arguments[1]);try{return new L3(n,i)}catch{return null}}});var vE=E(os.URL);let AO=!0,IO=!0;function SE(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function Ll(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(c,d){if(c!==t)return s.apply(this,arguments);const p=f=>{const m=n(f);m&&(d.handleEvent?d.handleEvent(m):d(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,p),s.apply(this,[c,p])};const o=i.removeEventListener;i.removeEventListener=function(c,d){if(c!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(d))return o.apply(this,arguments);const p=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,p])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function x3(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(AO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function k3(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(IO=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function OO(){if(typeof window=="object"){if(AO)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Xb(e,t){IO&&console.warn(e+" is deprecated, please use "+t+" instead.")}function NO(e){return Object.prototype.toString.call(e)==="[object Object]"}function DO(e){var t;return NO(e)?ks(t=Object.keys(e)).call(t,function(n,i){const s=NO(e[i]),o=s?DO(e[i]):e[i],c=s&&!Object.keys(o).length;return o===void 0||c?n:Object.assign(n,{[i]:o})},{}):e}function Qb(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?Qb(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(s=>{Qb(e,e.get(s),n)})}))}function PO(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const o=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&o.push(c)}),o.forEach(c=>{e.forEach(d=>{d.type===i&&d.trackId===c.id&&Qb(e,d,s)})}),s}const LO=OO;function xO(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const d={};return Object.keys(c).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const f=typeof c[p]=="object"?c[p]:{ideal:c[p]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const m=function(g,v){return g?g+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(f.ideal!==void 0){d.optional=d.optional||[];let g={};typeof f.ideal=="number"?(g[m("min",p)]=f.ideal,d.optional.push(g),g={},g[m("max",p)]=f.ideal,d.optional.push(g)):(g[m("",p)]=f.ideal,d.optional.push(g))}f.exact!==void 0&&typeof f.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[m("",p)]=f.exact):["min","max"].forEach(g=>{f[g]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[m(g,p)]=f[g])})}),c.advanced&&(d.optional=(d.optional||[]).concat(c.advanced)),d},s=function(c,d){if(t.version>=61)return d(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const p=function(f,m,g){m in f&&!(g in f)&&(f[g]=f[m],delete f[m])};p((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),p(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let p=c.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const f=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete c.video.facingMode,p.exact==="environment"||p.ideal==="environment"?m=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(g=>{let v=(g=g.filter(y=>y.kind==="videoinput")).find(y=>m.some(D=>{var A;return ve(A=y.label.toLowerCase()).call(A,D)}));return!v&&g.length&&ve(m).call(m,"back")&&(v=g[g.length-1]),v&&(c.video.deviceId=p.exact?{exact:v.deviceId}:{ideal:v.deviceId}),c.video=i(c.video),LO("chrome: "+JSON.stringify(c)),d(c)})}c.video=i(c.video)}return LO("chrome: "+JSON.stringify(c)),d(c)},o=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,d,p){s(c,f=>{n.webkitGetUserMedia(f,d,m=>{p&&p(o(m))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(d){return s(d,p=>c(p).then(f=>{if(p.audio&&!f.getAudioTracks().length||p.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>Te.reject(o(f))))}}}function kO(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function MO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ll(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function jO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=s.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){let p=s.apply(this,arguments);return p||(p=t(this,c),this._senders.push(p)),p};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const d=this._senders.indexOf(c);d!==-1&&this._senders.splice(d,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const c=this._senders.find(d=>d.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function UO(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,s]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const o=function(d){const p={};return d.result().forEach(f=>{const m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(g=>{m[g]=f.stat(g)}),p[m.id]=m}),p},c=function(d){return new Map(Object.keys(d).map(p=>[p,d[p]]))};if(arguments.length>=2){const d=function(p){i(c(o(p)))};return t.apply(this,[d,n])}return new Te((d,p)=>{t.apply(this,[function(f){d(c(o(f)))},p])}).then(i,s)}}function VO(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>PO(o,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Ll(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>PO(s,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,s,o;return this.getSenders().forEach(c=>{c.track===n&&(i?o=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(s?o=!0:s=c),c.track===n)),o||i&&s?Te.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Te.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function FO(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(p=>{if(this.getSenders().find(m=>m.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const d=this.getSenders().filter(p=>c.indexOf(p)===-1);this._shimmedLocalStreams[o.id]=[o].concat(d)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const d=this._shimmedLocalStreams[c].indexOf(o);d!==-1&&this._shimmedLocalStreams[c].splice(d,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),s.apply(this,arguments)}}function BO(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return FO(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const f=new e.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}i.apply(this,[p])};const s=e.RTCPeerConnection.prototype.removeStream;function o(p,f){let m=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(g=>{const v=p._reverseStreams[g],y=p._streams[v.id];m=m.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[f.id];if(v)v.addTrack(p),Te.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([p]);this._streams[f.id]=y,this._reverseStreams[y.id]=f,this.addStream(y)}return this.getSenders().find(y=>y.track===p)},["createOffer","createAnswer"].forEach(function(p){const f=e.RTCPeerConnection.prototype[p],m={[p](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[v=>{const y=o(this,v);g[0].apply(null,[y])},v=>{g[1]&&g[1].apply(null,v)},arguments[2]]):f.apply(this,arguments).then(v=>o(this,v))}};e.RTCPeerConnection.prototype[p]=m[p]});const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(p,f){let m=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(g=>{const v=p._reverseStreams[g],y=p._streams[v.id];m=m.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:m})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const p=d.get.apply(this);return p.type===""?p:o(this,p)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>p.track===g)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zb(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function GO(e,t){Ll(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var HO=Object.freeze({__proto__:null,fixNegotiationNeeded:GO,shimAddTrackRemoveTrack:BO,shimAddTrackRemoveTrackWithNative:FO,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const s=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},s&&(n.video.mandatory.maxWidth=s),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:jO,shimGetStats:UO,shimGetUserMedia:xO,shimMediaStream:kO,shimOnTrack:MO,shimPeerConnection:Zb,shimSenderReceiverGetStats:VO});function WO(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,o,c){Xb("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(o,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(c,d,p){d in c&&!(p in c)&&(c[p]=c[d],delete c[d])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c.audio,"autoGainControl","mozAutoGainControl"),s(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const d=c.apply(this,arguments);return s(d,"mozAutoGainControl","autoGainControl"),s(d,"mozNoiseSuppression","noiseSuppression"),d}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d,"autoGainControl","mozAutoGainControl"),s(d,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[d])}}}}function KO(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;return i.apply(this,[s||null]).then(d=>{if(t.version<53&&!o)try{d.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;d.forEach((f,m)=>{d.set(m,Object.assign({},f,{type:n[f.type]||f.type}))})}return d}).then(o,c)}}function zO(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Te.resolve(new Map)}}function YO(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ll(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function qO(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Xb("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&ve(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function $O(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function JO(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(i){const{sender:o}=s,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function XO(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function QO(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Te.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ZO(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Te.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var eN=Object.freeze({__proto__:null,shimAddTransceiver:JO,shimCreateAnswer:ZO,shimCreateOffer:QO,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Te.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:XO,shimGetUserMedia:WO,shimOnTrack:KO,shimPeerConnection:eC,shimRTCDataChannel:$O,shimReceiverGetStats:YO,shimRemoveStream:qO,shimSenderGetStats:zO});function tN(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),ve(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(s=>t.call(this,s,n)),n.getVideoTracks().forEach(s=>t.call(this,s,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(c=>{var d;this._localStreams?ve(d=this._localStreams).call(d,c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(s=>{ve(i).call(i,s.track)&&this.removeTrack(s)})})}}function nN(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),ve(o=this._remoteStreams).call(o,s))return;this._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,this.dispatchEvent(c)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,n.dispatchEvent(o)})}),t.apply(n,arguments)}}}function iN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,o=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(p,f){const m=arguments.length>=2?arguments[2]:arguments[0],g=n.apply(this,[m]);return f?(g.then(p,f),Te.resolve()):g},t.createAnswer=function(p,f){const m=arguments.length>=2?arguments[2]:arguments[0],g=i.apply(this,[m]);return f?(g.then(p,f),Te.resolve()):g};let d=function(p,f,m){const g=s.apply(this,[p]);return m?(g.then(f,m),Te.resolve()):g};t.setLocalDescription=d,d=function(p,f,m){const g=o.apply(this,[p]);return m?(g.then(f,m),Te.resolve()):g},t.setRemoteDescription=d,d=function(p,f,m){const g=c.apply(this,[p]);return m?(g.then(f,m),Te.resolve()):g},t.addIceCandidate=d}function sN(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>i(rN(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,s){t.mediaDevices.getUserMedia(n).then(i,s)}).bind(t))}function rN(e){return e&&e.video!==void 0?Object.assign({},e,{video:DO(e.video)}):e}function oN(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const s=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Xb("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(n.iceServers[o])}n.iceServers=s}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function aN(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cN(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function lN(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var dN=Object.freeze({__proto__:null,shimAudioContext:lN,shimCallbacksAPI:iN,shimConstraints:rN,shimCreateOfferLegacy:cN,shimGetUserMedia:sN,shimLocalStreamsAPI:tN,shimRTCIceServerUrls:oN,shimRemoteStreamsAPI:nN,shimTrackEventTransceiver:aN}),uN=`	
\v\f\r                　\u2028\u2029\uFEFF`,M3=wi,j3=as,tC=uN,hN=G("".replace),U3=RegExp("^["+tC+"]+"),V3=RegExp("(^|[^"+tC+"])["+tC+"]+$"),nC=function(e){return function(t){var n=j3(M3(t));return 1&e&&(n=hN(n,U3,"")),2&e&&(n=hN(n,V3,"$1")),n}},F3={start:nC(1),end:nC(2),trim:nC(3)},B3=ru.PROPER,G3=T,pN=uN,H3=F3.trim;yt({target:"String",proto:!0,forced:function(e){return G3(function(){return!!pN[e]()||"​᠎"[e]()!=="​᠎"||B3&&pN[e].name!==e})}("trim")},{trim:function(){return H3(this)}});var W3=xs("String","trim"),K3=q,z3=W3,iC=String.prototype,Y3=function(e){var t=e.trim;return typeof e=="string"||e===iC||K3(iC,e)&&t===iC.trim?z3:t},Li=E(Y3),fN={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":s.relatedAddress=i[o+1];break;case"rport":s.relatedPort=parseInt(i[o+1],10);break;case"tcptype":s.tcpType=i[o+1];break;case"ufrag":s.ufrag=i[o+1],s.usernameFragment=i[o+1];break;default:s[i[o]]===void 0&&(s[i[o]]=i[o+1])}return s},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const s=n.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let s;const o=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)s=o[c].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(n){let i="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?o.push(c+"="+n.parameters[c]):o.push(c)}),i+="a=fmtp:"+s+" "+o.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+s+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(s.attribute=n.substring(i+1,o),s.value=n.substring(o+1)):s.attribute=n.substring(i+1),s},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let s="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{s+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),s},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const s=t.matchPrefix(n+i,"a=ice-ufrag:")[0],o=t.matchPrefix(n+i,"a=ice-pwd:")[0];return s&&o?{usernameFragment:s.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(n)[0].split(" ");i.profile=s[2];for(let c=3;c<s.length;c++){const d=s[c],p=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(p){const f=t.parseRtpMap(p),m=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(f.parameters=m.length?t.parseFmtp(m[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(t.parseExtmap(c))});const o=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(c=>{o.forEach(d=>{c.rtcpFeedback.find(p=>p.type===d.type&&p.parameter===d.parameter)||c.rtcpFeedback.push(d)})}),i},t.writeRtpDescription=function(n,i){let s="";s+="m="+n+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{s+=t.writeRtpMap(c),s+=t.writeFmtp(c),s+=t.writeRtcpFb(c)});let o=0;return i.codecs.forEach(c=>{c.maxptime>o&&(o=c.maxptime)}),o>0&&(s+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{s+=t.writeExtmap(c)}),s},t.parseRtpEncodingParameters=function(n){const i=[],s=t.parseRtpParameters(n),o=s.fecMechanisms.indexOf("RED")!==-1,c=s.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),p=d.length>0&&d[0].ssrc;let f;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===p&&(f=m[0][1]),s.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:p,codecPayloadType:parseInt(v.parameters.apt,10)};p&&f&&(y.rtx={ssrc:f}),i.push(y),o&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:p,mechanism:c?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&p&&i.push({ssrc:p});let g=t.matchPrefix(n,"b=");return g.length&&(g=g[0].indexOf("b=TIAS:")===0?parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?1e3*parseInt(g[0].substring(5),10)*.95-16e3:void 0,i.forEach(v=>{v.maxBitrate=g})),i},t.parseRtcpParameters=function(n){const i={},s=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const o=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let o;s.length>0&&(o=parseInt(s[0].substring(19),10)),isNaN(o)&&(o=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,i){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,s){let o;const c=i!==void 0?i:2;return o=n||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const s=t.splitLines(n);for(let o=0;o<s.length;o++)switch(s[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[o].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(fN);var mN=fN.exports,Cu=E(mN),q3=u({__proto__:null,default:Cu},[mN]);function TE(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),s=Cu.parseCandidate(n.candidate),o=Object.assign(i,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Ll(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function sC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ll(e,"icecandidate",t=>{if(t.candidate){const n=Cu.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function yE(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:i}=this.getConfiguration();i==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(i){if(!i||!i.sdp)return!1;const s=Cu.splitSections(i.sdp);return s.shift(),s.some(o=>{const c=Cu.parseMLine(o);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const i=function(p){const f=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const m=parseInt(f[1],10);return m!=m?-1:m}(arguments[0]),s=function(p){let f=65536;return t.browser==="firefox"&&(f=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),f}(i),o=function(p,f){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const g=Cu.matchPrefix(p.sdp,"a=max-message-size:");return g.length>0?m=parseInt(g[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(m=2147483637),m}(arguments[0],i);let c;c=s===0&&o===0?Number.POSITIVE_INFINITY:s===0||o===0?Math.max(s,o):Math.min(s,o);const d={};Object.defineProperty(d,"maxMessageSize",{get:()=>c}),this._sctp=d}return n.apply(this,arguments)}}function bE(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const o=i.send;i.send=function(){const c=arguments[0],d=c.length||c.size||c.byteLength;if(i.readyState==="open"&&s.sctp&&d>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},Ll(e,"datachannel",i=>(t(i.channel,i.target),i))}function rC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const o=s.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",s);o.dispatchEvent(c)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function oC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>Li(o).call(o)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function CE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Te.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Te.resolve())})}function RE(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var $3=Object.freeze({__proto__:null,removeExtmapAllowMixed:oC,shimAddIceCandidateNullOrEmpty:CE,shimConnectionState:rC,shimMaxMessageSize:yE,shimParameterlessSetLocalDescription:RE,shimRTCIceCandidate:TE,shimRTCIceCandidateRelayProtocol:sC,shimSendThrowTypeError:bE});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=OO,i=function(o){const c={browser:null,version:null};if(o===void 0||!o.navigator)return c.browser="Not a browser.",c;const{navigator:d}=o;if(d.mozGetUserMedia)c.browser="firefox",c.version=SE(d.userAgent,/Firefox\/(\d+)\./,1);else if(d.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)c.browser="chrome",c.version=SE(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!d.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=SE(d.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return c}(e),s={browserDetails:i,commonShim:$3,extractVersion:SE,disableLog:x3,disableWarnings:k3,sdp:q3};switch(i.browser){case"chrome":if(!HO||!Zb||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=HO,CE(e,i),RE(e),xO(e,i),kO(e),Zb(e,i),MO(e),BO(e,i),jO(e),UO(e),VO(e),GO(e,i),TE(e),sC(e),rC(e),yE(e,i),bE(e),oC(e,i);break;case"firefox":if(!eN||!eC||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=eN,CE(e,i),RE(e),WO(e,i),eC(e,i),KO(e),qO(e),zO(e),YO(e),$O(e),JO(e),XO(e),QO(e),ZO(e),TE(e),rC(e),yE(e,i),bE(e);break;case"safari":if(!dN||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=dN,CE(e,i),RE(e),oN(e),cN(e),iN(e),tN(e),nN(e),aN(e),sN(e),lN(e),TE(e),sC(e),yE(e,i),bE(e),oC(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var _N=tc,J3=TypeError,EN=wo.match(/firefox\/(\d+)/i),X3=!!EN&&+EN[1],Q3=/MSIE|Trident/.test(wo),gN=wo.match(/AppleWebKit\/(\d+)\./),Z3=!!gN&&+gN[1],eG=yt,vN=G,tG=ii,nG=Sr,SN=Do,iG=function(e,t){if(!delete e[t])throw new J3("Cannot delete property "+_N(t)+" of "+_N(e))},TN=as,aC=T,sG=A0,rG=ml,yN=X3,oG=Q3,bN=ha,CN=Z3,Nc=[],RN=vN(Nc.sort),aG=vN(Nc.push),cG=aC(function(){Nc.sort(void 0)}),lG=aC(function(){Nc.sort(null)}),dG=rG("sort"),wN=!aC(function(){if(bN)return bN<70;if(!(yN&&yN>3)){if(oG)return!0;if(CN)return CN<603;var e,t,n,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Nc.push({k:t+i,v:n})}for(Nc.sort(function(o,c){return c.v-o.v}),i=0;i<Nc.length;i++)t=Nc[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});eG({target:"Array",proto:!0,forced:cG||!lG||!dG||!wN},{sort:function(e){e!==void 0&&tG(e);var t=nG(this);if(wN)return e===void 0?RN(t):RN(t,e);var n,i,s=[],o=SN(t);for(i=0;i<o;i++)i in t&&aG(s,t[i]);for(sG(s,function(c){return function(d,p){return p===void 0?-1:d===void 0?1:c!==void 0?+c(d,p)||0:TN(d)>TN(p)?1:-1}}(e)),n=SN(s),i=0;i<n;)t[i]=s[i++];for(;i<o;)iG(t,i++);return t}});var uG=xs("Array","sort"),hG=q,pG=uG,cC=Array.prototype,fG=function(e){var t=e.sort;return e===cC||hG(cC,e)&&t===cC.sort?pG:t},Wp=E(fG),lC=Y;yt({global:!0,forced:lC.globalThis!==lC},{globalThis:lC});var AN=E(Y),dC={exports:{}};(function(e,t){(function(n,i){var s="function",o="undefined",c="object",d="string",p="major",f="model",m="name",g="type",v="vendor",y="version",D="architecture",A="console",I="mobile",k="tablet",M="smarttv",H="wearable",J="embedded",$="Amazon",z="Apple",oe="ASUS",de="BlackBerry",be="Browser",Re="Chrome",dt="Firefox",ut="Google",$t="Huawei",wn="LG",vn="Microsoft",ss="Motorola",ae="Opera",Ee="Samsung",Pe="Sharp",ce="Sony",C="Xiaomi",F="Zebra",B="Facebook",he="Chromium OS",Xe="Mac OS",Vt=function(Vn){for(var $n={},nn=0;nn<Vn.length;nn++)$n[Vn[nn].toUpperCase()]=Vn[nn];return $n},qn=function(Vn,$n){return typeof Vn===d&&fs($n).indexOf(fs(Vn))!==-1},fs=function(Vn){return Vn.toLowerCase()},za=function(Vn,$n){if(typeof Vn===d)return Vn=Vn.replace(/^\s\s*/,""),typeof $n===o?Vn:Vn.substring(0,350)},ld=function(Vn,$n){for(var nn,Ns,ia,An,Tt,ms,Qc=0;Qc<$n.length&&!Tt;){var To=$n[Qc],eV=$n[Qc+1];for(nn=Ns=0;nn<To.length&&!Tt&&To[nn];)if(Tt=To[nn++].exec(Vn))for(ia=0;ia<eV.length;ia++)ms=Tt[++Ns],typeof(An=eV[ia])===c&&An.length>0?An.length===2?typeof An[1]==s?this[An[0]]=An[1].call(this,ms):this[An[0]]=An[1]:An.length===3?typeof An[1]!==s||An[1].exec&&An[1].test?this[An[0]]=ms?ms.replace(An[1],An[2]):i:this[An[0]]=ms?An[1].call(this,ms,An[2]):i:An.length===4&&(this[An[0]]=ms?An[3].call(this,ms.replace(An[1],An[2])):i):this[An]=ms||i;Qc+=2}},Yf=function(Vn,$n){for(var nn in $n)if(typeof $n[nn]===c&&$n[nn].length>0){for(var Ns=0;Ns<$n[nn].length;Ns++)if(qn($n[nn][Ns],Vn))return nn==="?"?i:nn}else if(qn($n[nn],Vn))return nn==="?"?i:nn;return Vn},Ev={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},gv={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,ae+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[m,ae]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+be]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+be],y],[/\bfocus\/([\w\.]+)/i],[y,[m,dt+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,ae+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,ae+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI "+be]],[/fxios\/([-\w\.]+)/i],[y,[m,dt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+be]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+be],y],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,B],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,Re+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Re+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+be]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,Yf,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,dt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,y],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,fs]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",fs]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,fs]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[v,Ee],[g,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[v,Ee],[g,I]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[v,z],[g,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[v,z],[g,k]],[/(macintosh);/i],[f,[v,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[v,Pe],[g,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[v,$t],[g,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[v,$t],[g,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[v,C],[g,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[v,C],[g,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[v,"OPPO"],[g,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[v,"Vivo"],[g,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[v,"Realme"],[g,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[v,ss],[g,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[v,ss],[g,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[v,wn],[g,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[v,wn],[g,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[v,"Lenovo"],[g,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[v,"Nokia"],[g,I]],[/(pixel c)\b/i],[f,[v,ut],[g,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[v,ut],[g,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[v,ce],[g,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[v,ce],[g,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[v,"OnePlus"],[g,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[v,$],[g,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[v,$],[g,I]],[/(playbook);[-\w\),; ]+(rim)/i],[f,v,[g,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[v,de],[g,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[v,oe],[g,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[v,oe],[g,I]],[/(nexus 9)/i],[f,[v,"HTC"],[g,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[f,/_/g," "],[g,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[v,"Acer"],[g,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[v,"Meizu"],[g,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,f,[g,I]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,f,[g,k]],[/(surface duo)/i],[f,[v,vn],[g,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[v,"Fairphone"],[g,I]],[/(u304aa)/i],[f,[v,"AT&T"],[g,I]],[/\bsie-(\w*)/i],[f,[v,"Siemens"],[g,I]],[/\b(rct\w+) b/i],[f,[v,"RCA"],[g,k]],[/\b(venue[\d ]{2,7}) b/i],[f,[v,"Dell"],[g,k]],[/\b(q(?:mv|ta)\w+) b/i],[f,[v,"Verizon"],[g,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[v,"Barnes & Noble"],[g,k]],[/\b(tm\d{3}\w+) b/i],[f,[v,"NuVision"],[g,k]],[/\b(k88) b/i],[f,[v,"ZTE"],[g,k]],[/\b(nx\d{3}j) b/i],[f,[v,"ZTE"],[g,I]],[/\b(gen\d{3}) b.+49h/i],[f,[v,"Swiss"],[g,I]],[/\b(zur\d{3}) b/i],[f,[v,"Swiss"],[g,k]],[/\b((zeki)?tb.*\b) b/i],[f,[v,"Zeki"],[g,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],f,[g,k]],[/\b(ns-?\w{0,9}) b/i],[f,[v,"Insignia"],[g,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[v,"NextBook"],[g,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],f,[g,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],f,[g,I]],[/\b(ph-1) /i],[f,[v,"Essential"],[g,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[v,"Envizen"],[g,k]],[/\b(trio[-\w\. ]+) b/i],[f,[v,"MachSpeed"],[g,k]],[/\btu_(1491) b/i],[f,[v,"Rotor"],[g,k]],[/(shield[\w ]+) b/i],[f,[v,"Nvidia"],[g,k]],[/(sprint) (\w+)/i],[v,f,[g,I]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[v,vn],[g,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[v,F],[g,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[v,F],[g,I]],[/smart-tv.+(samsung)/i],[v,[g,M]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[v,Ee],[g,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,wn],[g,M]],[/(apple) ?tv/i],[v,[f,z+" TV"],[g,M]],[/crkey/i],[[f,Re+"cast"],[v,ut],[g,M]],[/droid.+aft(\w)( bui|\))/i],[f,[v,$],[g,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[v,Pe],[g,M]],[/(bravia[\w ]+)( bui|\))/i],[f,[v,ce],[g,M]],[/(mitv-\w{5}) bui/i],[f,[v,C],[g,M]],[/Hbbtv.*(technisat) (.*);/i],[v,f,[g,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,za],[f,za],[g,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,f,[g,A]],[/droid.+; (shield) bui/i],[f,[v,"Nvidia"],[g,A]],[/(playstation [345portablevi]+)/i],[f,[v,ce],[g,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[v,vn],[g,A]],[/((pebble))app/i],[v,f,[g,H]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[v,z],[g,H]],[/droid.+; (glass) \d/i],[f,[v,ut],[g,H]],[/droid.+; (wt63?0{2,3})\)/i],[f,[v,F],[g,H]],[/(quest( 2| pro)?)/i],[f,[v,B],[g,H]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[g,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[g,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[g,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,I]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[y,Yf,Ev]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[y,Yf,Ev]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,Xe],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,de]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,dt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,Re+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,he],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,y]]},fr=function(Vn,$n){if(typeof Vn===c&&($n=Vn,Vn=i),!(this instanceof fr))return new fr(Vn,$n).getResult();var nn=typeof n!==o&&n.navigator?n.navigator:i,Ns=Vn||(nn&&nn.userAgent?nn.userAgent:""),ia=nn&&nn.userAgentData?nn.userAgentData:i,An=$n?function(Tt,ms){var Qc={};for(var To in Tt)ms[To]&&ms[To].length%2==0?Qc[To]=ms[To].concat(Tt[To]):Qc[To]=Tt[To];return Qc}(gv,$n):gv;return this.getBrowser=function(){var Tt={};return Tt[m]=i,Tt[y]=i,ld.call(Tt,Ns,An.browser),Tt[p]=function(ms){return typeof ms===d?ms.replace(/[^\d\.]/g,"").split(".")[0]:i}(Tt[y]),nn&&nn.brave&&typeof nn.brave.isBrave==s&&(Tt[m]="Brave"),Tt},this.getCPU=function(){var Tt={};return Tt[D]=i,ld.call(Tt,Ns,An.cpu),Tt},this.getDevice=function(){var Tt={};return Tt[v]=i,Tt[f]=i,Tt[g]=i,ld.call(Tt,Ns,An.device),!Tt[g]&&ia&&ia.mobile&&(Tt[g]=I),Tt[f]=="Macintosh"&&nn&&typeof nn.standalone!==o&&nn.maxTouchPoints&&nn.maxTouchPoints>2&&(Tt[f]="iPad",Tt[g]=k),Tt},this.getEngine=function(){var Tt={};return Tt[m]=i,Tt[y]=i,ld.call(Tt,Ns,An.engine),Tt},this.getOS=function(){var Tt={};return Tt[m]=i,Tt[y]=i,ld.call(Tt,Ns,An.os),!Tt[m]&&ia&&ia.platform!="Unknown"&&(Tt[m]=ia.platform.replace(/chrome os/i,he).replace(/macos/i,Xe)),Tt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ns},this.setUA=function(Tt){return Ns=typeof Tt===d&&Tt.length>350?za(Tt,350):Tt,this},this.setUA(Ns),this};fr.VERSION="0.7.34",fr.BROWSER=Vt([m,y,p]),fr.CPU=Vt([D]),fr.DEVICE=Vt([f,v,g,A,I,M,k,H,J]),fr.ENGINE=fr.OS=Vt([m,y]),e.exports&&(t=e.exports=fr),t.UAParser=fr;var Xc=typeof n!==o&&(n.jQuery||n.Zepto);if(Xc&&!Xc.ua){var dd=new fr;Xc.ua=dd.getResult(),Xc.ua.get=function(){return dd.getUA()},Xc.ua.set=function(Vn){dd.setUA(Vn);var $n=dd.getResult();for(var nn in $n)Xc.ua[nn]=$n[nn]}}})(typeof window=="object"?window:_)})(dC,dC.exports);var mG=E(dC.exports),_G=br,EG=Xn,gG=Ds,vG=Lo,SG=yn("iterator"),TG=Object,yG=function(e){if(gG(e))return!1;var t=TG(e);return t[SG]!==void 0||"@@iterator"in t||EG(vG,_G(t))},bG=E(yG),IN=Q_.clear;yt({global:!0,bind:!0,enumerable:!0,forced:Y.clearImmediate!==IN},{clearImmediate:IN});var ON=Y,CG=pe,RG=Me,wG=Md,AG=wo,IG=io,OG=jo,NG=ON.Function,DG=/MSIE .\./.test(AG)||wG==="BUN"&&function(){var e=ON.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),PG=yt,NN=Y,DN=Q_.set,LG=function(e,t){var n=1;return DG?function(i,s){var o=OG(arguments.length,1)>n,c=RG(i)?i:NG(i),d=o?IG(arguments,n):[],p=o?function(){CG(c,this,d)}:c;return e(p)}:e},PN=NN.setImmediate?LG(DN):DN;PG({global:!0,bind:!0,enumerable:!0,forced:NN.setImmediate!==PN},{setImmediate:PN});var LN=E(os.setImmediate),xG=Y,kG=WI,MG=ii,jG=jo,UG=rt;yt({global:!0,enumerable:!0,dontCallGetSet:!0,forced:T(function(){return UG&&Object.getOwnPropertyDescriptor(xG,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){jG(arguments.length,1),kG(MG(e))}});var xN=E(os.queueMicrotask);function kN(e,t){return function(){return e.apply(t,arguments)}}const{toString:VG}=Object.prototype,{getPrototypeOf:uC}=Object,wE=(hC=Object.create(null),e=>{const t=VG.call(e);return hC[t]||(hC[t]=t.slice(8,-1).toLowerCase())});var hC;const ao=e=>(e=e.toLowerCase(),t=>wE(t)===e),AE=e=>t=>typeof t===e,{isArray:Ru}=Array,Kp=AE("undefined"),MN=ao("ArrayBuffer"),FG=AE("string"),sr=AE("function"),jN=AE("number"),IE=e=>e!==null&&typeof e=="object",OE=e=>{if(wE(e)!=="object")return!1;const t=uC(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||bG(e))},BG=ao("Date"),GG=ao("File"),HG=ao("Blob"),WG=ao("FileList"),KG=ao("URLSearchParams"),[zG,YG,qG,$G]=["ReadableStream","Request","Response","Headers"].map(ao);function zp(e,t){let n,i,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ru(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const o=s?Object.getOwnPropertyNames(e):Object.keys(e),c=o.length;let d;for(n=0;n<c;n++)d=o[n],t.call(null,e[d],d,e)}}function UN(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,s=n.length;for(;s-- >0;)if(i=n[s],t===i.toLowerCase())return i;return null}const xl=AN!==void 0?AN:typeof self<"u"?self:typeof window<"u"?window:l,VN=e=>!Kp(e)&&e!==xl,JG=(pC=typeof Uint8Array<"u"&&uC(Uint8Array),e=>pC&&e instanceof pC);var pC;const XG=ao("HTMLFormElement"),FN=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),QG=ao("RegExp"),BN=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};zp(n,(s,o)=>{let c;(c=t(s,o,e))!==!1&&(i[o]=c||s)}),Object.defineProperties(e,i)},fC="abcdefghijklmnopqrstuvwxyz",GN="0123456789",HN={DIGIT:GN,ALPHA:fC,ALPHA_DIGIT:fC+fC.toUpperCase()+GN},ZG=ao("AsyncFunction"),WN=(KN=typeof LN=="function",zN=sr(xl.postMessage),KN?LN:zN?(mC="axios@".concat(Math.random()),NE=[],xl.addEventListener("message",e=>{let{source:t,data:n}=e;t===xl&&n===mC&&NE.length&&NE.shift()()},!1),e=>{NE.push(e),xl.postMessage(mC,"*")}):e=>setTimeout(e));var KN,zN,mC,NE;const eH=xN!==void 0?xN.bind(xl):typeof process<"u"&&process.nextTick||WN;var Se={isArray:Ru,isArrayBuffer:MN,isBuffer:function(e){return e!==null&&!Kp(e)&&e.constructor!==null&&!Kp(e.constructor)&&sr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||sr(e.append)&&((t=wE(e))==="formdata"||t==="object"&&sr(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&MN(e.buffer),t},isString:FG,isNumber:jN,isBoolean:e=>e===!0||e===!1,isObject:IE,isPlainObject:OE,isReadableStream:zG,isRequest:YG,isResponse:qG,isHeaders:$G,isUndefined:Kp,isDate:BG,isFile:GG,isBlob:HG,isRegExp:QG,isFunction:sr,isStream:e=>IE(e)&&sr(e.pipe),isURLSearchParams:KG,isTypedArray:JG,isFileList:WG,forEach:zp,merge:function e(){const{caseless:t}=VN(this)&&this||{},n={},i=(s,o)=>{const c=t&&UN(n,o)||o;OE(n[c])&&OE(s)?n[c]=e(n[c],s):OE(s)?n[c]=e({},s):Ru(s)?n[c]=s.slice():n[c]=s};for(let s=0,o=arguments.length;s<o;s++)arguments[s]&&zp(arguments[s],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return zp(t,(s,o)=>{n&&sr(s)?e[o]=kN(s,n):e[o]=s},{allOwnKeys:i}),e},trim:e=>Li(e)?Li(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let s,o,c;const d={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),o=s.length;o-- >0;)c=s[o],i&&!i(c,e,t)||d[c]||(t[c]=e[c],d[c]=!0);e=n!==!1&&uC(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:wE,kindOfTest:ao,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Ru(e))return e;let t=e.length;if(!jN(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:XG,hasOwnProperty:FN,hasOwnProp:FN,reduceDescriptors:BN,freezeMethods:e=>{BN(e,(t,n)=>{if(sr(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];sr(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=s=>{s.forEach(o=>{n[o]=!0})};return Ru(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:UN,global:xl,isContextDefined:VN,ALPHABET:HN,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HN.ALPHA_DIGIT,n="";const{length:i}=t;for(;e--;)n+=t[Math.random()*i|0];return n},isSpecCompliantForm:function(e){return!!(e&&sr(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(i,s)=>{if(IE(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[s]=i;const o=Ru(i)?[]:{};return zp(i,(c,d)=>{const p=n(c,s+1);!Kp(p)&&(o[d]=p)}),t[s]=void 0,o}}return i};return n(e,0)},isAsyncFn:ZG,isThenable:e=>e&&(IE(e)||sr(e))&&sr(e.then)&&sr(e.catch),setImmediate:WN,asap:eH};function jt(e,t,n,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),s&&(this.response=s,this.status=s.status?s.status:null)}Se.inherits(jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Se.toJSONObject(this.config),code:this.code,status:this.status}}});const YN=jt.prototype,qN={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{qN[e]={value:e}}),Object.defineProperties(jt,qN),Object.defineProperty(YN,"isAxiosError",{value:!0}),jt.from=(e,t,n,i,s,o)=>{const c=Object.create(YN);return Se.toFlatObject(e,c,function(d){return d!==Error.prototype},d=>d!=="isAxiosError"),jt.call(c,e.message,t,n,i,s),c.cause=e,c.name=e.name,o&&Object.assign(c,o),c};function _C(e){return Se.isPlainObject(e)||Se.isArray(e)}function $N(e){return Se.endsWith(e,"[]")?e.slice(0,-2):e}function JN(e,t,n){return e?e.concat(t).map(function(i,s){return i=$N(i),!n&&s?"["+i+"]":i}).join(n?".":""):t}const tH=Se.toFlatObject(Se,{},null,function(e){return/^is[A-Z]/.test(e)});function DE(e,t,n){if(!Se.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Se.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!Se.isUndefined(y[v])})).metaTokens,s=n.visitor||f,o=n.dots,c=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&Se.isSpecCompliantForm(t);if(!Se.isFunction(s))throw new TypeError("visitor must be a function");function p(v){if(v===null)return"";if(Se.isDate(v))return v.toISOString();if(!d&&Se.isBlob(v))throw new jt("Blob is not supported. Use a Buffer instead.");return Se.isArrayBuffer(v)||Se.isTypedArray(v)?d&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function f(v,y,D){let A=v;if(v&&!D&&typeof v=="object"){if(Se.endsWith(y,"{}"))y=i?y:y.slice(0,-2),v=JSON.stringify(v);else if(Se.isArray(v)&&function(I){return Se.isArray(I)&&!I.some(_C)}(v)||(Se.isFileList(v)||Se.endsWith(y,"[]"))&&(A=Se.toArray(v)))return y=$N(y),A.forEach(function(I,k){!Se.isUndefined(I)&&I!==null&&t.append(c===!0?JN([y],k,o):c===null?y:y+"[]",p(I))}),!1}return!!_C(v)||(t.append(JN(D,y,o),p(v)),!1)}const m=[],g=Object.assign(tH,{defaultVisitor:f,convertValue:p,isVisitable:_C});if(!Se.isObject(e))throw new TypeError("data must be an object");return function v(y,D){if(!Se.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+D.join("."));m.push(y),Se.forEach(y,function(A,I){(!(Se.isUndefined(A)||A===null)&&s.call(t,A,Se.isString(I)?Li(I).call(I):I,D,g))===!0&&v(A,D?D.concat(I):[I])}),m.pop()}}(e),t}function XN(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function EC(e,t){this._pairs=[],e&&DE(e,this,t)}const QN=EC.prototype;function nH(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ZN(e,t,n){if(!t)return e;const i=n&&n.encode||nH;Se.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let o;if(o=s?s(t,n):Se.isURLSearchParams(t)?t.toString():new EC(t,n).toString(i),o){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}QN.append=function(e,t){this._pairs.push([e,t])},QN.toString=function(e){const t=e?function(n){return e.call(this,n,XN)}:XN;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var eD=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Se.forEach(this.handlers,function(t){t!==null&&e(t)})}},tD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},nD={exports:{}},iH=yt,sH=rt,iD=Rs.f;iH({target:"Object",stat:!0,forced:Object.defineProperty!==iD,sham:!sH},{defineProperty:iD});var sD=os.Object,rH=nD.exports=function(e,t,n){return sD.defineProperty(e,t,n)};sD.defineProperty.sham&&(rH.sham=!0);var rD=E(nD.exports),oH=TypeError,oD=Cr,aH=Al,cH=Ei,lH=yn("species"),aD=Array,dH=function(e){var t;return oD(e)&&(t=e.constructor,(aH(t)&&(t===aD||oD(t.prototype))||cH(t)&&(t=t[lH])===null)&&(t=void 0)),t===void 0?aD:t},cD=function(e,t){return new(dH(e))(t===0?0:t)},uH=T,hH=ha,pH=yn("species"),lD=function(e){return hH>=51||!uH(function(){var t=[];return(t.constructor={})[pH]=function(){return{foo:1}},t[e](Boolean).foo!==1})},fH=yt,mH=T,_H=Cr,EH=Ei,gH=Sr,vH=Do,dD=function(e){if(e>9007199254740991)throw oH("Maximum allowed index exceeded");return e},uD=Ob,SH=cD,TH=lD,yH=ha,hD=yn("isConcatSpreadable"),bH=yH>=51||!mH(function(){var e=[];return e[hD]=!1,e.concat()[0]!==e}),CH=function(e){if(!EH(e))return!1;var t=e[hD];return t!==void 0?!!t:_H(e)};fH({target:"Array",proto:!0,arity:1,forced:!bH||!TH("concat")},{concat:function(e){var t,n,i,s,o,c=gH(this),d=SH(c,0),p=0;for(t=-1,i=arguments.length;t<i;t++)if(CH(o=t===-1?c:arguments[t]))for(s=vH(o),dD(p+s),n=0;n<s;n++,p++)n in o&&uD(d,p,o[n]);else dD(p+1),uD(d,p++,o);return d.length=p,d}});var pD={},RH=fe,wH=qe,fD=Bd.f,AH=io,mD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];pD.f=function(e){return mD&&RH(e)==="Window"?function(t){try{return fD(t)}catch{return AH(mD)}}(e):fD(wH(e))};var wu={},IH=yn;wu.f=IH;var _D=os,OH=Xn,NH=wu,DH=Rs.f,oi=function(e){var t=_D.Symbol||(_D.Symbol={});OH(t,e)||DH(t,e,{value:NH.f(e)})},PH=We,LH=cn,xH=yn,kH=eo,ED=function(){var e=LH("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=xH("toPrimitive");t&&!t[i]&&kH(t,i,function(s){return PH(n,this)},{arity:1})},MH=qr,jH=Kr,UH=Sr,VH=Do,FH=cD,gD=G([].push),Dc=function(e){var t=e===1,n=e===2,i=e===3,s=e===4,o=e===6,c=e===7,d=e===5||o;return function(p,f,m,g){for(var v,y,D=UH(p),A=jH(D),I=VH(A),k=MH(f,m),M=0,H=g||FH,J=t?H(p,I):n||c?H(p,0):void 0;I>M;M++)if((d||M in A)&&(y=k(v=A[M],M,D),e))if(t)J[M]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return M;case 2:gD(J,v)}else switch(e){case 4:return!1;case 7:gD(J,v)}return o?-1:i||s?s:J}},vD={forEach:Dc(0),map:Dc(1),filter:Dc(2),some:Dc(3),every:Dc(4),find:Dc(5),findIndex:Dc(6),filterReject:Dc(7)},PE=yt,Yp=Y,gC=We,BH=G,Au=rt,Iu=ec,GH=T,Gi=Xn,HH=q,vC=In,LE=qe,SC=Uh,WH=as,TC=Ni,Ou=vc,SD=Wd,KH=Bd,TD=pD,zH=_l,yD=Ze,bD=Rs,YH=fp,CD=Kt,RD=eo,qH=ri,yC=Yr,wD=Gd,AD=Mh,$H=yn,JH=wu,XH=oi,QH=ED,ZH=to,ID=Ta,xE=vD.forEach,Us=Ud("hidden"),kE="Symbol",qp="prototype",eW=ID.set,OD=ID.getterFor(kE),co=Object[qp],kl=Yp.Symbol,ME=kl&&kl[qp],tW=Yp.RangeError,nW=Yp.TypeError,bC=Yp.QObject,ND=yD.f,Ml=bD.f,DD=TD.f,iW=CD.f,PD=BH([].push),Da=yC("symbols"),$p=yC("op-symbols"),sW=yC("wks"),CC=!bC||!bC[qp]||!bC[qp].findChild,LD=function(e,t,n){var i=ND(co,t);i&&delete co[t],Ml(e,t,n),i&&e!==co&&Ml(co,t,i)},RC=Au&&GH(function(){return Ou(Ml({},"a",{get:function(){return Ml(this,"a",{value:7}).a}})).a!==7})?LD:Ml,wC=function(e,t){var n=Da[e]=Ou(ME);return eW(n,{type:kE,tag:e,description:t}),Au||(n.description=t),n},jE=function(e,t,n){e===co&&jE($p,t,n),vC(e);var i=SC(t);return vC(n),Gi(Da,i)?(n.enumerable?(Gi(e,Us)&&e[Us][i]&&(e[Us][i]=!1),n=Ou(n,{enumerable:TC(0,!1)})):(Gi(e,Us)||Ml(e,Us,TC(1,Ou(null))),e[Us][i]=!0),RC(e,i,n)):Ml(e,i,n)},AC=function(e,t){vC(e);var n=LE(t),i=SD(n).concat(jD(n));return xE(i,function(s){Au&&!gC(xD,n,s)||jE(e,s,n[s])}),e},xD=function(e){var t=SC(e),n=gC(iW,this,t);return!(this===co&&Gi(Da,t)&&!Gi($p,t))&&(!(n||!Gi(this,t)||!Gi(Da,t)||Gi(this,Us)&&this[Us][t])||n)},kD=function(e,t){var n=LE(e),i=SC(t);if(n!==co||!Gi(Da,i)||Gi($p,i)){var s=ND(n,i);return!s||!Gi(Da,i)||Gi(n,Us)&&n[Us][i]||(s.enumerable=!0),s}},MD=function(e){var t=DD(LE(e)),n=[];return xE(t,function(i){Gi(Da,i)||Gi(wD,i)||PD(n,i)}),n},jD=function(e){var t=e===co,n=DD(t?$p:LE(e)),i=[];return xE(n,function(s){!Gi(Da,s)||t&&!Gi(co,s)||PD(i,Da[s])}),i};Iu||(kl=function(){if(HH(ME,this))throw new nW("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?WH(arguments[0]):void 0,t=AD(e),n=function(i){var s=this===void 0?Yp:this;s===co&&gC(n,$p,i),Gi(s,Us)&&Gi(s[Us],t)&&(s[Us][t]=!1);var o=TC(1,i);try{RC(s,t,o)}catch(c){if(!(c instanceof tW))throw c;LD(s,t,o)}};return Au&&CC&&RC(co,t,{configurable:!0,set:n}),wC(t,e)},RD(ME=kl[qp],"toString",function(){return OD(this).tag}),RD(kl,"withoutSetter",function(e){return wC(AD(e),e)}),CD.f=xD,bD.f=jE,YH.f=AC,yD.f=kD,KH.f=TD.f=MD,zH.f=jD,JH.f=function(e){return wC($H(e),e)},Au&&qH(ME,"description",{configurable:!0,get:function(){return OD(this).description}})),PE({global:!0,constructor:!0,wrap:!0,forced:!Iu,sham:!Iu},{Symbol:kl}),xE(SD(sW),function(e){XH(e)}),PE({target:kE,stat:!0,forced:!Iu},{useSetter:function(){CC=!0},useSimple:function(){CC=!1}}),PE({target:"Object",stat:!0,forced:!Iu,sham:!Au},{create:function(e,t){return t===void 0?Ou(e):AC(Ou(e),t)},defineProperty:jE,defineProperties:AC,getOwnPropertyDescriptor:kD}),PE({target:"Object",stat:!0,forced:!Iu},{getOwnPropertyNames:MD}),QH(),ZH(kl,kE),wD[Us]=!0;var UD=ec&&!!Symbol.for&&!!Symbol.keyFor,rW=yt,oW=cn,aW=Xn,cW=as,VD=Yr,lW=UD,IC=VD("string-to-symbol-registry"),dW=VD("symbol-to-string-registry");rW({target:"Symbol",stat:!0,forced:!lW},{for:function(e){var t=cW(e);if(aW(IC,t))return IC[t];var n=oW("Symbol")(t);return IC[t]=n,dW[n]=t,n}});var uW=yt,hW=Xn,pW=ll,fW=tc,mW=UD,FD=Yr("symbol-to-string-registry");uW({target:"Symbol",stat:!0,forced:!mW},{keyFor:function(e){if(!pW(e))throw new TypeError(fW(e)+" is not a symbol");if(hW(FD,e))return FD[e]}});var BD=Cr,_W=Me,GD=fe,EW=as,HD=G([].push),gW=yt,WD=cn,KD=pe,vW=We,Jp=G,zD=T,YD=Me,qD=ll,$D=io,SW=function(e){if(_W(e))return e;if(BD(e)){for(var t=e.length,n=[],i=0;i<t;i++){var s=e[i];typeof s=="string"?HD(n,s):typeof s!="number"&&GD(s)!=="Number"&&GD(s)!=="String"||HD(n,EW(s))}var o=n.length,c=!0;return function(d,p){if(c)return c=!1,p;if(BD(this))return p;for(var f=0;f<o;f++)if(n[f]===d)return p}}},TW=ec,yW=String,Pc=WD("JSON","stringify"),UE=Jp(/./.exec),JD=Jp("".charAt),bW=Jp("".charCodeAt),CW=Jp("".replace),RW=Jp(1 .toString),wW=/[\uD800-\uDFFF]/g,XD=/^[\uD800-\uDBFF]$/,QD=/^[\uDC00-\uDFFF]$/,ZD=!TW||zD(function(){var e=WD("Symbol")("stringify detection");return Pc([e])!=="[null]"||Pc({a:e})!=="{}"||Pc(Object(e))!=="{}"}),eP=zD(function(){return Pc("\uDF06\uD834")!=='"\\udf06\\ud834"'||Pc("\uDEAD")!=='"\\udead"'}),AW=function(e,t){var n=$D(arguments),i=SW(t);if(YD(i)||e!==void 0&&!qD(e))return n[1]=function(s,o){if(YD(i)&&(o=vW(i,this,yW(s),o)),!qD(o))return o},KD(Pc,null,n)},IW=function(e,t,n){var i=JD(n,t-1),s=JD(n,t+1);return UE(XD,e)&&!UE(QD,s)||UE(QD,e)&&!UE(XD,i)?"\\u"+RW(bW(e,0),16):e};Pc&&gW({target:"JSON",stat:!0,arity:3,forced:ZD||eP},{stringify:function(e,t,n){var i=$D(arguments),s=KD(ZD?AW:Pc,null,i);return eP&&typeof s=="string"?CW(s,wW,IW):s}});var tP=_l,OW=Sr;yt({target:"Object",stat:!0,forced:!ec||T(function(){tP.f(1)})},{getOwnPropertySymbols:function(e){var t=tP.f;return t?t(OW(e)):[]}}),oi("asyncIterator"),oi("hasInstance"),oi("isConcatSpreadable"),oi("iterator"),oi("match"),oi("matchAll"),oi("replace"),oi("search"),oi("species"),oi("split");var NW=ED;oi("toPrimitive"),NW();var DW=cn,PW=to;oi("toStringTag"),PW(DW("Symbol"),"Symbol"),oi("unscopables"),to(Y.JSON,"JSON",!0);var LW=os.Symbol,xW=yn,kW=Rs.f,nP=xW("metadata"),iP=Function.prototype;iP[nP]===void 0&&kW(iP,nP,{value:null}),oi("asyncDispose"),oi("dispose"),oi("metadata");var MW=LW,jW=G,OC=cn("Symbol"),UW=OC.keyFor,VW=jW(OC.prototype.valueOf),sP=OC.isRegisteredSymbol||function(e){try{return UW(VW(e))!==void 0}catch{return!1}};yt({target:"Symbol",stat:!0},{isRegisteredSymbol:sP});for(var FW=Yr,rP=cn,BW=G,GW=ll,HW=yn,VE=rP("Symbol"),oP=VE.isWellKnownSymbol,aP=rP("Object","getOwnPropertyNames"),WW=BW(VE.prototype.valueOf),cP=FW("wks"),NC=0,lP=aP(VE),KW=lP.length;NC<KW;NC++)try{var dP=lP[NC];GW(VE[dP])&&HW(dP)}catch{}var uP=function(e){if(oP&&oP(e))return!0;try{for(var t=WW(e),n=0,i=aP(cP),s=i.length;n<s;n++)if(cP[i[n]]==t)return!0}catch{}return!1};yt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:uP}),oi("customMatcher"),oi("observable"),yt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:sP}),yt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:uP}),oi("matcher"),oi("metadataKey"),oi("patternMatch"),oi("replaceAll");var Nu=E(MW),hP=E(wu.f("iterator"));function Xp(e){return Xp=typeof Nu=="function"&&typeof hP=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Nu=="function"&&t.constructor===Nu&&t!==Nu.prototype?"symbol":typeof t},Xp(e)}var zW=E(wu.f("toPrimitive"));function YW(e){var t=function(n,i){if(Xp(n)!=="object"||n===null)return n;var s=n[zW];if(s!==void 0){var o=s.call(n,i||"default");if(Xp(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return Xp(t)==="symbol"?t:String(t)}function N(e,t,n){return(t=YW(t))in e?rD(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var pP=E(y8),qW={isBrowser:!0,classes:{URLSearchParams:pP!==void 0?pP:EC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const DC=typeof window<"u"&&typeof document<"u",PC=typeof navigator=="object"&&navigator||void 0,$W=DC&&(!PC||["ReactNative","NativeScript","NS"].indexOf(PC.product)<0),JW=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",XW=DC&&window.location.href||"http://localhost";function fP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function mP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fP(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fP(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var cs=mP(mP({},Object.freeze({__proto__:null,hasBrowserEnv:DC,hasStandardBrowserEnv:$W,hasStandardBrowserWebWorkerEnv:JW,navigator:PC,origin:XW})),qW),QW=In,ZW=We,e9=Xn,t9=q,n9=function(){var e=QW(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},_P=RegExp.prototype,EP=function(e){var t=e.flags;return t!==void 0||"flags"in _P||e9(e,"flags")||!t9(_P,e)?t:ZW(n9,e)},i9=Eb.charAt,gP=We,s9=In,r9=Me,o9=fe,a9=/./.exec,c9=TypeError,l9=yt,vP=We,SP=Fe,d9=Ip,FE=Lt,TP=wi,yP=Ad,Qp=as,u9=In,h9=Ds,p9=fe,f9=Wm,bP=EP,m9=Td,_9=T,E9=lu,g9=function(e,t,n){return t+(n?i9(e,t).length:1)},v9=function(e,t){var n=e.exec;if(r9(n)){var i=gP(n,e,t);return i!==null&&s9(i),i}if(o9(e)==="RegExp")return gP(a9,e,t);throw new c9("RegExp#exec called on incompatible receiver")},CP=Ta,S9=yn("matchAll"),RP="RegExp String",wP=RP+" Iterator",T9=CP.set,y9=CP.getterFor(wP),b9=TypeError,LC=SP("".indexOf),BE=SP("".matchAll),xC=!!BE&&!_9(function(){BE("a",/./)}),C9=d9(function(e,t,n,i){T9(this,{type:wP,regexp:e,string:t,global:n,unicode:i,done:!1})},RP,function(){var e=y9(this);if(e.done)return FE(void 0,!0);var t=e.regexp,n=e.string,i=v9(t,n);return i===null?(e.done=!0,FE(void 0,!0)):e.global?(Qp(i[0])===""&&(t.lastIndex=g9(n,yP(t.lastIndex),e.unicode)),FE(i,!1)):(e.done=!0,FE(i,!1))}),AP=function(e){var t,n,i,s=u9(this),o=Qp(e),c=E9(s,RegExp),d=Qp(bP(s));return t=new c(c===RegExp?s.source:s,d),n=!!~LC(d,"g"),i=!!~LC(d,"u"),t.lastIndex=yP(s.lastIndex),new C9(t,o,n,i)};l9({target:"String",proto:!0,forced:xC},{matchAll:function(e){var t,n,i,s,o=TP(this);if(h9(e)){if(xC)return BE(o,e)}else{if(f9(e)&&(t=Qp(TP(bP(e))),!~LC(t,"g")))throw new b9("`.matchAll` does not allow non-global regexes");if(xC)return BE(o,e);if((i=m9(e,S9))===void 0&&p9(e)==="RegExp"&&(i=AP),i)return vP(i,e,o)}return n=Qp(o),s=new RegExp(e,"g"),vP(AP,s,n)}});var R9=xs("String","matchAll"),w9=q,A9=R9,kC=String.prototype,I9=function(e){var t=e.matchAll;return typeof e=="string"||e===kC||w9(kC,e)&&t===kC.matchAll?A9:t},O9=E(I9);function IP(e){function t(n,i,s,o){let c=n[o++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),p=o>=n.length;return c=!c&&Se.isArray(s)?s.length:c,p?(Se.hasOwnProp(s,c)?s[c]=[s[c],i]:s[c]=i,!d):(s[c]&&Se.isObject(s[c])||(s[c]=[]),t(n,i,s[c],o)&&Se.isArray(s[c])&&(s[c]=function(f){const m={},g=Object.keys(f);let v;const y=g.length;let D;for(v=0;v<y;v++)D=g[v],m[D]=f[D];return m}(s[c])),!d)}if(Se.isFormData(e)&&Se.isFunction(e.entries)){const n={};return Se.forEachEntry(e,(i,s)=>{t(function(o){return O9(Se).call(Se,/\w+|\[(\w*)]/g,o).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),s,n,0)}),n}return null}const MC={transitional:tD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=Se.isObject(e);if(s&&Se.isHTMLForm(e)&&(e=new FormData(e)),Se.isFormData(e))return i?JSON.stringify(IP(e)):e;if(Se.isArrayBuffer(e)||Se.isBuffer(e)||Se.isStream(e)||Se.isFile(e)||Se.isBlob(e)||Se.isReadableStream(e))return e;if(Se.isArrayBufferView(e))return e.buffer;if(Se.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,d){return DE(c,new cs.classes.URLSearchParams,Object.assign({visitor:function(p,f,m,g){return cs.isNode&&Se.isBuffer(p)?(this.append(f,p.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},d))}(e,this.formSerializer).toString();if((o=Se.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return DE(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),function(c,d,p){if(Se.isString(c))try{return(d||JSON.parse)(c),Li(Se).call(Se,c)}catch(f){if(f.name!=="SyntaxError")throw f}return(0,JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){const t=this.transitional||MC.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Se.isResponse(e)||Se.isReadableStream(e))return e;if(e&&Se.isString(e)&&(n&&!this.responseType||i)){const s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?jt.from(o,jt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:cs.classes.FormData,Blob:cs.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Se.forEach(["delete","get","head","post","put","patch"],e=>{MC.headers[e]={}});var jC=MC;const N9=Se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),OP=Symbol("internals");function Zp(e){var t;return e&&Li(t=String(e)).call(t).toLowerCase()}function GE(e){return e===!1||e==null?e:Se.isArray(e)?e.map(GE):String(e)}function UC(e,t,n,i,s){return Se.isFunction(i)?i.call(this,t,n):(s&&(t=n),Se.isString(t)?Se.isString(i)?t.indexOf(i)!==-1:Se.isRegExp(i)?i.test(t):void 0:void 0)}class HE{constructor(t){t&&this.set(t)}set(t,n,i){const s=this;function o(p,f,m){const g=Zp(f);if(!g)throw new Error("header name must be a non-empty string");const v=Se.findKey(s,g);(!v||s[v]===void 0||m===!0||m===void 0&&s[v]!==!1)&&(s[v||f]=GE(p))}const c=(p,f)=>Se.forEach(p,(m,g)=>o(m,g,f));if(Se.isPlainObject(t)||t instanceof this.constructor)c(t,n);else if(Se.isString(t)&&(t=Li(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Li(d=t).call(d)))c((p=>{const f={};let m,g,v;return p&&p.split(`
`).forEach(function(y){var D,A;v=y.indexOf(":"),m=Li(D=y.substring(0,v)).call(D).toLowerCase(),g=Li(A=y.substring(v+1)).call(A),!m||f[m]&&N9[m]||(m==="set-cookie"?f[m]?f[m].push(g):f[m]=[g]:f[m]=f[m]?f[m]+", "+g:g)}),f})(t),n);else if(Se.isHeaders(t))for(const[p,f]of t.entries())o(f,p,i);else t!=null&&o(n,t,i);var d;return this}get(t,n){if(t=Zp(t)){const i=Se.findKey(this,t);if(i){const s=this[i];if(!n)return s;if(n===!0)return function(o){const c=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=d.exec(o);)c[p[1]]=p[2];return c}(s);if(Se.isFunction(n))return n.call(this,s,i);if(Se.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Zp(t)){const i=Se.findKey(this,t);return!(!i||this[i]===void 0||n&&!UC(0,this[i],i,n))}return!1}delete(t,n){const i=this;let s=!1;function o(c){if(c=Zp(c)){const d=Se.findKey(i,c);!d||n&&!UC(0,i[d],d,n)||(delete i[d],s=!0)}}return Se.isArray(t)?t.forEach(o):o(t),s}clear(t){const n=Object.keys(this);let i=n.length,s=!1;for(;i--;){const o=n[i];t&&!UC(0,this[o],o,t,!0)||(delete this[o],s=!0)}return s}normalize(t){const n=this,i={};return Se.forEach(this,(s,o)=>{var c;const d=Se.findKey(i,o);if(d)return n[d]=GE(s),void delete n[o];const p=t?function(f){return Li(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,g,v)=>g.toUpperCase()+v)}(o):Li(c=String(o)).call(c);p!==o&&delete n[o],n[p]=GE(s),i[p]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Se.forEach(this,(i,s)=>{i!=null&&i!==!1&&(n[s]=t&&Se.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s.forEach(c=>n.set(c)),n}static accessor(t){const n=(this[OP]=this[OP]={accessors:{}}).accessors,i=this.prototype;function s(o){const c=Zp(o);n[c]||(function(d,p){const f=Se.toCamelCase(" "+p);["get","set","has"].forEach(m=>{Object.defineProperty(d,m+f,{value:function(g,v,y){return this[m].call(this,p,g,v,y)},configurable:!0})})}(i,o),n[c]=!0)}return Se.isArray(t)?t.forEach(s):s(t),this}}HE.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Se.reduceDescriptors(HE.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[i]=s}}}),Se.freezeMethods(HE);var lo=HE;function VC(e,t){const n=this||jC,i=t||n,s=lo.from(i.headers);let o=i.data;return Se.forEach(e,function(c){o=c.call(n,o,s.normalize(),t?t.status:void 0)}),s.normalize(),o}function NP(e){return!(!e||!e.__CANCEL__)}function Du(e,t,n){jt.call(this,e??"canceled",jt.ERR_CANCELED,t,n),this.name="CanceledError"}function DP(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new jt("Request failed with status code "+n.status,[jt.ERR_BAD_REQUEST,jt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Se.inherits(Du,jt,{__CANCEL__:!0});const WE=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const s=function(o,c){o=o||10;const d=new Array(o),p=new Array(o);let f,m=0,g=0;return c=c!==void 0?c:1e3,function(v){const y=Date.now(),D=p[g];f||(f=y),d[m]=v,p[m]=y;let A=g,I=0;for(;A!==m;)I+=d[A++],A%=o;if(m=(m+1)%o,m===g&&(g=(g+1)%o),y-f<c)return;const k=D&&y-D;return k?Math.round(1e3*I/k):void 0}}(50,250);return function(o,c){let d,p,f=0,m=1e3/c;const g=function(v){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),d=null,p&&(clearTimeout(p),p=null),o.apply(null,v)};return[function(){const v=Date.now(),y=v-f;for(var D=arguments.length,A=new Array(D),I=0;I<D;I++)A[I]=arguments[I];y>=m?g(A,v):(d=A,p||(p=setTimeout(()=>{p=null,g(d)},m-y)))},()=>d&&g(d)]}(o=>{const c=o.loaded,d=o.lengthComputable?o.total:void 0,p=c-i,f=s(p);i=c,e({loaded:c,total:d,progress:d?c/d:void 0,bytes:p,rate:f||void 0,estimated:f&&d&&c<=d?(d-c)/f:void 0,event:o,lengthComputable:d!=null,[t?"download":"upload"]:!0})},n)},PP=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},LP=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Se.asap(()=>e(...n))};var D9=cs.hasStandardBrowserEnv?((e,t)=>n=>(n=new vE(n,cs.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new vE(cs.origin),cs.navigator&&/(msie|trident)/i.test(cs.navigator.userAgent)):()=>!0,P9=cs.hasStandardBrowserEnv?{write(e,t,n,i,s,o){const c=[e+"="+encodeURIComponent(t)];Se.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Se.isString(i)&&c.push("path="+i),Se.isString(s)&&c.push("domain="+s),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function xP(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(e,t):t}function kP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}const MP=e=>e instanceof lo?function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?kP(Object(i),!0).forEach(function(s){N(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):kP(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},e):e;function jl(e,t){t=t||{};const n={};function i(f,m,g,v){return Se.isPlainObject(f)&&Se.isPlainObject(m)?Se.merge.call({caseless:v},f,m):Se.isPlainObject(m)?Se.merge({},m):Se.isArray(m)?m.slice():m}function s(f,m,g,v){return Se.isUndefined(m)?Se.isUndefined(f)?void 0:i(void 0,f,0,v):i(f,m,0,v)}function o(f,m){if(!Se.isUndefined(m))return i(void 0,m)}function c(f,m){return Se.isUndefined(m)?Se.isUndefined(f)?void 0:i(void 0,f):i(void 0,m)}function d(f,m,g){return g in t?i(f,m):g in e?i(void 0,f):void 0}const p={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(f,m,g)=>s(MP(f),MP(m),0,!0)};return Se.forEach(Object.keys(Object.assign({},e,t)),function(f){const m=p[f]||s,g=m(e[f],t[f],f);Se.isUndefined(g)&&m!==d||(n[f]=g)}),n}var jP=e=>{const t=jl({},e);let n,{data:i,withXSRFToken:s,xsrfHeaderName:o,xsrfCookieName:c,headers:d,auth:p}=t;if(t.headers=d=lo.from(d),t.url=ZN(xP(t.baseURL,t.url),e.params,e.paramsSerializer),p&&d.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),Se.isFormData(i)){if(cs.hasStandardBrowserEnv||cs.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if((n=d.getContentType())!==!1){const[f,...m]=n?n.split(";").map(g=>Li(g).call(g)).filter(Boolean):[];d.setContentType([f||"multipart/form-data",...m].join("; "))}}if(cs.hasStandardBrowserEnv&&(s&&Se.isFunction(s)&&(s=s(t)),s||s!==!1&&D9(t.url))){const f=o&&c&&P9.read(c);f&&d.set(o,f)}return t},L9=typeof XMLHttpRequest<"u"&&function(e){return new Te(function(t,n){const i=jP(e);let s=i.data;const o=lo.from(i.headers).normalize();let c,d,p,f,m,{responseType:g,onUploadProgress:v,onDownloadProgress:y}=i;function D(){f&&f(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let A=new XMLHttpRequest;function I(){if(!A)return;const M=lo.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());DP(function(H){t(H),D()},function(H){n(H),D()},{data:g&&g!=="text"&&g!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:M,config:e,request:A}),A=null}A.open(i.method.toUpperCase(),i.url,!0),A.timeout=i.timeout,"onloadend"in A?A.onloadend=I:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(I)},A.onabort=function(){A&&(n(new jt("Request aborted",jt.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new jt("Network Error",jt.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let M=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const H=i.transitional||tD;i.timeoutErrorMessage&&(M=i.timeoutErrorMessage),n(new jt(M,H.clarifyTimeoutError?jt.ETIMEDOUT:jt.ECONNABORTED,e,A)),A=null},s===void 0&&o.setContentType(null),"setRequestHeader"in A&&Se.forEach(o.toJSON(),function(M,H){A.setRequestHeader(H,M)}),Se.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),g&&g!=="json"&&(A.responseType=i.responseType),y&&([p,m]=WE(y,!0),A.addEventListener("progress",p)),v&&A.upload&&([d,f]=WE(v),A.upload.addEventListener("progress",d),A.upload.addEventListener("loadend",f)),(i.cancelToken||i.signal)&&(c=M=>{A&&(n(!M||M.type?new Du(null,e,A):M),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const k=function(M){const H=/^([-+\w]{1,25})(:?\/\/|:)/.exec(M);return H&&H[1]||""}(i.url);k&&cs.protocols.indexOf(k)===-1?n(new jt("Unsupported protocol "+k+":",jt.ERR_BAD_REQUEST,e)):A.send(s||null)})},x9=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,s=new AbortController;const o=function(f){if(!i){i=!0,d();const m=f instanceof Error?f:this.reason;s.abort(m instanceof jt?m:new Du(m instanceof Error?m.message:m))}};let c=t&&setTimeout(()=>{c=null,o(new jt("timeout ".concat(t," of ms exceeded"),jt.ETIMEDOUT))},t);const d=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(o):f.removeEventListener("abort",o)}),e=null)};e.forEach(f=>f.addEventListener("abort",o));const{signal:p}=s;return p.unsubscribe=()=>Se.asap(d),p}},FC=E(b0),UP=wu.f("asyncIterator"),k9=E(UP);function BC(e,t){this.v=e,this.k=t}function ef(e){var t,n;function i(o,c){try{var d=e[o](c),p=d.value,f=p instanceof BC;FC.resolve(f?p.v:p).then(function(m){if(f){var g=o==="return"?"return":"next";if(!p.k||m.done)return i(g,m);m=e[g](m).value}s(d.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){s("throw",m)}}function s(o,c){switch(o){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(o,c){return new FC(function(d,p){var f={key:o,arg:c,resolve:d,reject:p,next:null};n?n=n.next=f:(t=n=f,i(o,c))})},typeof e.return!="function"&&(this.return=void 0)}function rr(e){return function(){return new ef(e.apply(this,arguments))}}function ft(e){return new BC(e,0)}function KE(e){var t={},n=!1;function i(s,o){return n=!0,{done:!1,value:new BC(o=new FC(function(c){c(e[s](o))}),1)}}return t[Nu!==void 0&&hP||"@@iterator"]=function(){return this},t.next=function(s){return n?(n=!1,s):i("next",s)},typeof e.throw=="function"&&(t.throw=function(s){if(n)throw n=!1,s;return i("throw",s)}),typeof e.return=="function"&&(t.return=function(s){return n?(n=!1,s):i("return",s)}),t}ef.prototype[typeof Nu=="function"&&k9||"@@asyncIterator"]=function(){return this},ef.prototype.next=function(e){return this._invoke("next",e)},ef.prototype.throw=function(e){return this._invoke("throw",e)},ef.prototype.return=function(e){return this._invoke("return",e)};var GC=E(UP);function HC(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=GC,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new zE(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function zE(e){function t(n){if(Object(n)!==n)return Te.reject(new TypeError(n+" is not an object."));var i=n.done;return Te.resolve(n.value).then(function(s){return{value:s,done:i}})}return zE=function(n){this.s=n,this.n=n.next},zE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Te.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Te.reject(n):t(i.apply(this.s,arguments))}},new zE(e)}const M9=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,s=0;for(;s<n;)i=s+t,yield e.slice(s,i),s=i},j9=function(){var e=rr(function*(t,n){var i,s=!1,o=!1;try{for(var c,d=HC(U9(t));s=!(c=yield ft(d.next())).done;s=!1){const p=c.value;yield*KE(HC(M9(p,n)))}}catch(p){o=!0,i=p}finally{try{s&&d.return!=null&&(yield ft(d.return()))}finally{if(o)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),U9=function(){var e=rr(function*(t){if(t[GC])return void(yield*KE(HC(t)));const n=t.getReader();try{for(;;){const{done:i,value:s}=yield ft(n.read());if(i)break;yield s}}finally{yield ft(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),VP=(e,t,n,i)=>{const s=j9(e,t);let o,c=0,d=p=>{o||(o=!0,i&&i(p))};return new ReadableStream({async pull(p){try{const{done:f,value:m}=await s.next();if(f)return d(),void p.close();let g=m.byteLength;if(n){let v=c+=g;n(v)}p.enqueue(new Uint8Array(m))}catch(f){throw d(f),f}},cancel:p=>(d(p),s.return())},{highWaterMark:2})};function FP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function BP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FP(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FP(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const YE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",GP=YE&&typeof ReadableStream=="function",V9=YE&&(typeof TextEncoder=="function"?(HP=new TextEncoder,e=>HP.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var HP;const WP=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},F9=GP&&WP(()=>{let e=!1;const t=new Request(cs.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),WC=GP&&WP(()=>Se.isReadableStream(new Response("").body)),qE={stream:WC&&(e=>e.body)};var KP;YE&&(KP=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!qE[e]&&(qE[e]=Se.isFunction(KP[e])?t=>t[e]():(t,n)=>{throw new jt("Response type '".concat(e,"' is not supported"),jt.ERR_NOT_SUPPORT,n)})}));const B9=async(e,t)=>{const n=Se.toFiniteNumber(e.getContentLength());return n??(async i=>i==null?0:Se.isBlob(i)?i.size:Se.isSpecCompliantForm(i)?(await new Request(cs.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Se.isArrayBufferView(i)||Se.isArrayBuffer(i)?i.byteLength:(Se.isURLSearchParams(i)&&(i+=""),Se.isString(i)?(await V9(i)).byteLength:void 0))(t)};var G9=YE&&(async e=>{let{url:t,method:n,data:i,signal:s,cancelToken:o,timeout:c,onDownloadProgress:d,onUploadProgress:p,responseType:f,headers:m,withCredentials:g="same-origin",fetchOptions:v}=jP(e);f=f?(f+"").toLowerCase():"text";let y,D=x9([s,o&&o.toAbortSignal()],c);const A=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let I;try{if(p&&F9&&n!=="get"&&n!=="head"&&(I=await B9(m,i))!==0){let $,z=new Request(t,{method:"POST",body:i,duplex:"half"});if(Se.isFormData(i)&&($=z.headers.get("content-type"))&&m.setContentType($),z.body){const[oe,de]=PP(I,WE(LP(p)));i=VP(z.body,65536,oe,de)}}Se.isString(g)||(g=g?"include":"omit");const k="credentials"in Request.prototype;y=new Request(t,BP(BP({},v),{},{signal:D,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:k?g:void 0}));let M=await fetch(y);const H=WC&&(f==="stream"||f==="response");if(WC&&(d||H&&A)){const $={};["status","statusText","headers"].forEach(be=>{$[be]=M[be]});const z=Se.toFiniteNumber(M.headers.get("content-length")),[oe,de]=d&&PP(z,WE(LP(d),!0))||[];M=new Response(VP(M.body,65536,oe,()=>{de&&de(),A&&A()}),$)}f=f||"text";let J=await qE[Se.findKey(qE,f)||"text"](M,e);return!H&&A&&A(),await new Te(($,z)=>{DP($,z,{data:J,headers:lo.from(M.headers),status:M.status,statusText:M.statusText,config:e,request:y})})}catch(k){throw A&&A(),k&&k.name==="TypeError"&&/fetch/i.test(k.message)?Object.assign(new jt("Network Error",jt.ERR_NETWORK,e,y),{cause:k.cause||k}):jt.from(k,k&&k.code,e,y)}});const zP={http:null,xhr:L9,fetch:G9};Se.forEach(zP,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const YP=e=>"- ".concat(e),H9=e=>Se.isFunction(e)||e===null||e===!1;var qP=e=>{e=Se.isArray(e)?e:[e];const{length:t}=e;let n,i;const s={};for(let o=0;o<t;o++){let c;if(n=e[o],i=n,!H9(n)&&(i=zP[(c=String(n)).toLowerCase()],i===void 0))throw new jt("Unknown adapter '".concat(c,"'"));if(i)break;s[c||"#"+o]=i}if(!i){const o=Object.entries(s).map(c=>{let[d,p]=c;return"adapter ".concat(d," ")+(p===!1?"is not supported by the environment":"is not available in the build")});throw new jt("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map(YP).join(`
`):" "+YP(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function KC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Du(null,e)}function $P(e){return KC(e),e.headers=lo.from(e.headers),e.data=VC.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),qP(e.adapter||jC.adapter)(e).then(function(t){return KC(e),t.data=VC.call(e,e.transformResponse,t),t.headers=lo.from(t.headers),t},function(t){return NP(t)||(KC(e),t&&t.response&&(t.response.data=VC.call(e,e.transformResponse,t.response),t.response.headers=lo.from(t.response.headers))),Te.reject(t)})}const W9="1.7.9",$E={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{$E[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const JP={};$E.transitional=function(e,t,n){function i(s,o){return"[Axios v1.7.9] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,c)=>{if(e===!1)throw new jt(i(o," has been removed"+(t?" in "+t:"")),jt.ERR_DEPRECATED);return t&&!JP[o]&&(JP[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,o,c)}},$E.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var JE={assertOptions:function(e,t,n){if(typeof e!="object")throw new jt("options must be an object",jt.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let s=i.length;for(;s-- >0;){const o=i[s],c=t[o];if(c){const d=e[o],p=d===void 0||c(d,o,e);if(p!==!0)throw new jt("option "+o+" must be "+p,jt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new jt("Unknown option "+o,jt.ERR_BAD_OPTION)}},validators:$E};const Fo=JE.validators;let XE=class{constructor(e){this.defaults=e,this.interceptors={request:new eD,response:new eD}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=jl(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&JE.assertOptions(n,{silentJSONParsing:Fo.transitional(Fo.boolean),forcedJSONParsing:Fo.transitional(Fo.boolean),clarifyTimeoutError:Fo.transitional(Fo.boolean)},!1),i!=null&&(Se.isFunction(i)?t.paramsSerializer={serialize:i}:JE.assertOptions(i,{encode:Fo.function,serialize:Fo.function},!0)),JE.assertOptions(t,{baseUrl:Fo.spelling("baseURL"),withXsrfToken:Fo.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&Se.merge(s.common,s[t.method]);s&&Se.forEach(["delete","get","head","post","put","patch","common"],y=>{delete s[y]}),t.headers=lo.concat(o,s);const c=[];let d=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(d=d&&y.synchronous,c.unshift(y.fulfilled,y.rejected))});const p=[];let f;this.interceptors.response.forEach(function(y){p.push(y.fulfilled,y.rejected)});let m,g=0;if(!d){const y=[$P.bind(this),void 0];for(y.unshift.apply(y,c),y.push.apply(y,p),m=y.length,f=Te.resolve(t);g<m;)f=f.then(y[g++],y[g++]);return f}m=c.length;let v=t;for(g=0;g<m;){const y=c[g++],D=c[g++];try{v=y(v)}catch(A){D.call(this,A);break}}try{f=$P.call(this,v)}catch(y){return Te.reject(y)}for(g=0,m=p.length;g<m;)f=f.then(p[g++],p[g++]);return f}getUri(e){return ZN(xP((e=jl(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Se.forEach(["delete","get","head","options"],function(e){XE.prototype[e]=function(t,n){return this.request(jl(n||{},{method:e,url:t,data:(n||{}).data}))}}),Se.forEach(["post","put","patch"],function(e){function t(n){return function(i,s,o){return this.request(jl(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}XE.prototype[e]=t(),XE.prototype[e+"Form"]=t(!0)});var QE=XE;class zC{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Te(function(s){n=s});const i=this;this.promise.then(s=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](s);i._listeners=null}),this.promise.then=s=>{let o;const c=new Te(d=>{i.subscribe(d),o=d}).then(s);return c.cancel=function(){i.unsubscribe(o)},c},t(function(s,o,c){i.reason||(i.reason=new Du(s,o,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new zC(function(i){t=i}),cancel:t}}}var K9=zC;const YC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(YC).forEach(e=>{let[t,n]=e;YC[n]=t});var z9=YC;const Ai=function e(t){const n=new QE(t),i=kN(QE.prototype.request,n);return Se.extend(i,QE.prototype,n,{allOwnKeys:!0}),Se.extend(i,n,null,{allOwnKeys:!0}),i.create=function(s){return e(jl(t,s))},i}(jC);Ai.Axios=QE,Ai.CanceledError=Du,Ai.CancelToken=K9,Ai.isCancel=NP,Ai.VERSION=W9,Ai.toFormData=DE,Ai.AxiosError=jt,Ai.Cancel=Ai.CanceledError,Ai.all=function(e){return Te.all(e)},Ai.spread=function(e){return function(t){return e.apply(null,t)}},Ai.isAxiosError=function(e){return Se.isObject(e)&&e.isAxiosError===!0},Ai.mergeConfig=jl,Ai.AxiosHeaders=lo,Ai.formToJSON=e=>IP(Se.isHTMLForm(e)?new FormData(e):e),Ai.getAdapter=qP,Ai.HttpStatusCode=z9,Ai.default=Ai;var Zi=Ai;const Y9=()=>{};function tf(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Y9};return e.promise=new Te((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const ZE=new Map,eg=new Map,Bo=new Map;let Kn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),bt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const XP=new mG;let uo=XP.getResult(),qC=null;function Et(e){if(!qC){uo=XP.getResult();const t=function(d){if(d.engine.name==="Blink"&&d.browser.name!=="WeChat")return bt.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return bt.CHROME;case"Safari":case"Mobile Safari":return bt.SAFARI;case"Edge":return bt.EDGE;case"Firefox":return bt.FIREFOX;case"QQ":case"QQBrowser":return bt.QQ;case"Opera":return bt.OPERA;case"WeChat":return bt.WECHAT;default:return d.browser.name||""}}(uo),n=QP(uo),i=function(d){return d.os.name==="Windows"?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||""}(uo),s=uo.os.version,o=QP(uo,!1),c=uo.device.type;if(!(t&&n&&i&&s))return{name:t,version:n,os:i,osVersion:s,browserVersion:o,deviceType:c};qC={name:t,version:n,os:i,osVersion:s,browserVersion:o,deviceType:c}}return qC}function QP(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function tg(){return Et().os}function ZP(){const e=Et();return"".concat(e.os," ").concat(e.osVersion)}function ng(){const e=Et();return!!(uo.engine.name==="WebKit"&&e.os===Kn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==bt.SAFARI||Hi()&&e.name!==bt.SAFARI)}function Pa(){return Et().name===bt.CHROME}function hi(){return Et().name===bt.SAFARI}function e1(){return Et().name===bt.EDGE}function _n(){return Et().name===bt.FIREFOX}function Hi(){return Et().os===Kn.IOS}function Pu(e){const t=Et();return!(t.name!==bt.CHROME||!t.osVersion)&&Number(t.version)>=e}function t1(e){const t=Et();return!(t.name!==bt.CHROME||!t.osVersion)&&Number(t.version)<e}function $C(e,t,n){const i=Et();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function JC(e){const t=Et();return!(t.name!==bt.EDGE||!t.osVersion)&&Number(t.version)>=e}function n1(e){const t=Et();return!(t.name!==bt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function i1(e,t,n){const i=Et();if(i.os!==Kn.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function s1(e,t,n){const i=Et();if(i.name!==bt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const s=i.browserVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function XC(e){const t=Et();return!(t.name!==bt.OPERA||!t.osVersion)&&Number(t.version)>=e}function r1(){const e=Et();if(e.os!==Kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Lu(){const e=Et();if(e.os!==Kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function QC(){const e=Et();if(e.os!==Kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function o1(){const e=Et();if(e.os!==Kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Pr(){return hi()&&navigator.maxTouchPoints>0}function a1(){return Et().name===bt.WECHAT}function c1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ZC(){const e=tg();return function(){const{deviceType:t}=Et();return t==="mobile"||t==="tablet"}()||e===Kn.ANDROID||e===Kn.IOS||e===Kn.HARMONY_OS}function La(){const e=Et();return e.name!==bt.EDGE&&e.name!==bt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function ig(){return tg()===Kn.ANDROID}function nf(){const e=Et();return ig()&&(e.name===bt.CHROME||e.name===bt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Je(e,t,n){return(t=function(i){var s=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?l1(Object(n),!0).forEach(function(i){Je(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l1(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let L=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class re extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Je(this,"code",void 0),Je(this,"message",void 0),Je(this,"data",void 0),Je(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return t==="error"&&(n||console).error(this.toString()),t==="warning"&&(n||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function xa(e,t){if(typeof e!="boolean")throw new re(L.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Wn(e,t,n){if(!ve(n).call(n,e))throw new re(L.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Ut(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(e))throw new re(L.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function eR(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new re(L.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Ut(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Ut(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Ut(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Ut(e.ideal,"".concat(t,".ideal"),1,1/0)}else Ut(e,t,1,1/0)}function ai(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new re(L.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!d1(e,n,i,s))throw new re(L.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function ka(e,t){if(!Array.isArray(e))throw new re(L.INVALID_PARAMS,"".concat(t," should be an array"))}function pn(e){return e==null}function d1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(s){if(typeof s!="string")return!1;for(let o=0;o<s.length;o+=1){const c=s.charCodeAt(o);if(c<0||c>255)return!1}return!0}(e))}var sf=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(sf||{}),tR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(tR||{});const u1=new class{constructor(){Je(this,"_clientSize",null),Je(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Je(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Je(this,"getStyle",e=>window.getComputedStyle(e,null)),Je(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:s,visibility:o,opacity:c,filter:d}=i;return(s==="none"||ve(t=["hidden","collapse"]).call(t,o)||Number(c)<.1)&&(n=!1),!!n&&(d&&d.split(" ").filter(p=>{var f;const m=p.split("(")[0];return ve(f=["brightness","blur","opacity"]).call(f,m)}).map(p=>{const[f,m]=p.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(p=>{const[f,m]=p;switch(f){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),Je(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const s=c=>t(c);let o=e;for(;o&&i;)s(o)||(n=!1,i=!1),o=o.parentElement,o||(i=!1);return n}),Je(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Je(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:s,top:o,bottom:c}=e.getBoundingClientRect(),d=this.getClientWidth(),p=this.getClientHeight();return{width:t,height:n,left:i,right:s,top:o,bottom:c,clientWidth:d,clientHeight:p,clientMin:Math.min(d,p)}}),Je(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Je(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Je(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),Je(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,s=e/6,o=t/6,c=[],d=10**6;for(let p=0;p<5;p++)for(let f=0;f<5;f++){const m=(n*d+(p===0?.1:p===4?(s*p*d-1e5)/d:s*p)*d)/d,g=(i*d+(f===0?.1:f===4?(o*f*d-1e5)/d:o*f)*d)/d;c.push({x:m,y:g})}return[...c]}),Je(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Je(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Je(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:s,clientWidth:o,clientMin:c}=this._clientSize;let d,p,f,m;if(e<0)d=0;else{if(!(e<o))return!1;d=e}if(t<0)return!1;if(p=t<o?t:o,n<0)f=0;else{if(!(n<s))return!1;f=n}if(i<0)return!1;m=i<s?i:s;const g=p-d,v=m-f;return this.checkSizeIsVisible(g,v,c)}),Je(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Je(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(sf.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(sf.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(sf.SIZE)}}return this.returnHiddenResult(sf.STYLE)}return this.returnHiddenResult(tR.UNMOUNTED)}return this.returnHiddenResult(tR.INVALID_HTML_ELEMENT)}),Je(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function nR(e){return new TextEncoder().encode(e)}const h1=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},iR=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",nR(e)),16);let dn=class{constructor(){Je(this,"_events",{}),Je(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(o=>o);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(let o=0;o<t.length;o+=1){const c=t[o];c.once&&this.off(e,c.listener),c.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,n)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},rf=null;function p1(){if(rf)return rf;if(window.electron)return rf=window.electron;if(!window.require)return null;try{return rf=window.require("electron"),rf}catch{return null}}let Mn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),fn=function(e){return e.TRACER="tracer",e}({});function f1(e){return Ut(e.timeout,"config.timeout",0,1e5),Ut(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ut(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ut(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let q9=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),wt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function of(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function m1(e){return ai(e.turnServerURL,"turnServerURL"),ai(e.username,"username"),ai(e.password,"password"),e.udpport&&Ut(e.udpport,"udpport",1,99999,!0),e.forceturn&&xa(e.forceturn,"forceturn"),e.security&&xa(e.security,"security"),e.tcpport&&Ut(e.tcpport,"tcpport",1,99999,!0),!0}function sR(e){return e.level!==void 0&&Wn(e.level,"level",[1,2,3]),e.delay!==void 0&&Ut(e.delay,"delay",0,3e3,!0),!0}let at=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),pi=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Is=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),xu=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function fi(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return e.getListeners(t).length===0?Te.reject(new re(L.UNEXPECTED_ERROR,"can not emit promise")):new Te((o,c)=>{e.emit(t,...i,o,c)})}function zt(e,t){if(e.getListeners(t).length===0)return Te.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return fi(e,t,...i)}function Vs(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return af(e,t,...i)}function af(e,t){let n=null,i=null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];if(e.emit(t,...o,d=>{n=d},d=>{i=d}),i!==null)throw i;if(n===null)throw new re(L.UNEXPECTED_ERROR,"handler is not sync");return n}const Nn=new class extends dn{set networkState(e){this.emit(xu.NETWORK_STATE_CHANGE,e,this._networkState),e===Is.ONLINE?this.emit(xu.ONLINE):e===Is.OFFLINE&&(this.onlineWaiter=new Te(t=>{this.once(xu.ONLINE,()=>{this.onlineWaiter=void 0,t(Is.ONLINE)})}),this.emit(xu.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Is.ONLINE}constructor(){super(),Je(this,"_moduleName","network-indicator"),Je(this,"_networkState",Is.ONLINE),Je(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Is.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Is.OFFLINE})}};function sg(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ku(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function rg(e){Te!==void 0?Te.resolve().then(e):setTimeout(e,0)}function En(e){return JSON.parse(JSON.stringify(e))}function Ul(e){try{return En(e)}catch{return e}}const _1={};function Lc(e,t){_1[t]||(_1[t]=!0,e())}function Vl(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function xc(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function E1(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function g1(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=ks(t).call(t,(c,d)=>c+d.length,0),s=new Uint8Array(new ArrayBuffer(i));let o=0;return t.forEach(c=>{s.set(c,o),o+=c.length}),s}function Go(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function v1(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Go(n):n.size}),t+138}function $9(e){const t=new re(L.TIMEOUT,"timeout");return new Te((n,i)=>{window.setTimeout(()=>i(t),e)})}function ci(e){return new Te(t=>{window.setTimeout(t,e)})}function Yt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Yt(e-n.length,"")}function Fl(){return Yt(32,"").toUpperCase()}const og=()=>{},S1=new class{constructor(){Je(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var s=arguments.length,o=new Array(s>4?s-4:0),c=4;c<s;c++)o[c-4]=arguments[c];if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const p=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:p,args:o,skipFn:i})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,Ie(Ie({},d),{},{fn:e,args:o,skipFn:i}))}else{const d=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:o,skipFn:i})}}},T1=S1.throttleByKey.bind(S1);function y1(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function rR(e,t){if(!y1(e)||!y1(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=rR(e[i],t[i]);return n}{const n=Ie({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=rR(e[i],t[i]):n[i]=t[i]);return n}}function b1(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function oR(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function C1(e){const t="0123456789abcdef";function n(H){let J,$="";for(J=0;J<=3;J++)$+=t.charAt(H>>8*J+4&15)+t.charAt(H>>8*J&15);return $}function i(H,J){const $=(65535&H)+(65535&J);return(H>>16)+(J>>16)+($>>16)<<16|65535&$}function s(H,J,$,z,oe,de){return i(function(be,Re){return be<<Re|be>>>32-Re}(i(i(J,H),i(z,de)),oe),$)}function o(H,J,$,z,oe,de,be){return s(J&$|~J&z,H,J,oe,de,be)}function c(H,J,$,z,oe,de,be){return s(J&z|$&~z,H,J,oe,de,be)}function d(H,J,$,z,oe,de,be){return s(J^$^z,H,J,oe,de,be)}function p(H,J,$,z,oe,de,be){return s($^(J|~z),H,J,oe,de,be)}const f=function(H){let J;const $=1+(H.length+8>>6),z=new Array(16*$);for(J=0;J<16*$;J++)z[J]=0;for(J=0;J<H.length;J++)z[J>>2]|=H.charCodeAt(J)<<J%4*8;return z[J>>2]|=128<<J%4*8,z[16*$-2]=8*H.length,z}(e);let m,g,v,y,D,A=1732584193,I=-271733879,k=-1732584194,M=271733878;for(m=0;m<f.length;m+=16)g=A,v=I,y=k,D=M,A=o(A,I,k,M,f[m+0],7,-680876936),M=o(M,A,I,k,f[m+1],12,-389564586),k=o(k,M,A,I,f[m+2],17,606105819),I=o(I,k,M,A,f[m+3],22,-1044525330),A=o(A,I,k,M,f[m+4],7,-176418897),M=o(M,A,I,k,f[m+5],12,1200080426),k=o(k,M,A,I,f[m+6],17,-1473231341),I=o(I,k,M,A,f[m+7],22,-45705983),A=o(A,I,k,M,f[m+8],7,1770035416),M=o(M,A,I,k,f[m+9],12,-1958414417),k=o(k,M,A,I,f[m+10],17,-42063),I=o(I,k,M,A,f[m+11],22,-1990404162),A=o(A,I,k,M,f[m+12],7,1804603682),M=o(M,A,I,k,f[m+13],12,-40341101),k=o(k,M,A,I,f[m+14],17,-1502002290),I=o(I,k,M,A,f[m+15],22,1236535329),A=c(A,I,k,M,f[m+1],5,-165796510),M=c(M,A,I,k,f[m+6],9,-1069501632),k=c(k,M,A,I,f[m+11],14,643717713),I=c(I,k,M,A,f[m+0],20,-373897302),A=c(A,I,k,M,f[m+5],5,-701558691),M=c(M,A,I,k,f[m+10],9,38016083),k=c(k,M,A,I,f[m+15],14,-660478335),I=c(I,k,M,A,f[m+4],20,-405537848),A=c(A,I,k,M,f[m+9],5,568446438),M=c(M,A,I,k,f[m+14],9,-1019803690),k=c(k,M,A,I,f[m+3],14,-187363961),I=c(I,k,M,A,f[m+8],20,1163531501),A=c(A,I,k,M,f[m+13],5,-1444681467),M=c(M,A,I,k,f[m+2],9,-51403784),k=c(k,M,A,I,f[m+7],14,1735328473),I=c(I,k,M,A,f[m+12],20,-1926607734),A=d(A,I,k,M,f[m+5],4,-378558),M=d(M,A,I,k,f[m+8],11,-2022574463),k=d(k,M,A,I,f[m+11],16,1839030562),I=d(I,k,M,A,f[m+14],23,-35309556),A=d(A,I,k,M,f[m+1],4,-1530992060),M=d(M,A,I,k,f[m+4],11,1272893353),k=d(k,M,A,I,f[m+7],16,-155497632),I=d(I,k,M,A,f[m+10],23,-1094730640),A=d(A,I,k,M,f[m+13],4,681279174),M=d(M,A,I,k,f[m+0],11,-358537222),k=d(k,M,A,I,f[m+3],16,-722521979),I=d(I,k,M,A,f[m+6],23,76029189),A=d(A,I,k,M,f[m+9],4,-640364487),M=d(M,A,I,k,f[m+12],11,-421815835),k=d(k,M,A,I,f[m+15],16,530742520),I=d(I,k,M,A,f[m+2],23,-995338651),A=p(A,I,k,M,f[m+0],6,-198630844),M=p(M,A,I,k,f[m+7],10,1126891415),k=p(k,M,A,I,f[m+14],15,-1416354905),I=p(I,k,M,A,f[m+5],21,-57434055),A=p(A,I,k,M,f[m+12],6,1700485571),M=p(M,A,I,k,f[m+3],10,-1894986606),k=p(k,M,A,I,f[m+10],15,-1051523),I=p(I,k,M,A,f[m+1],21,-2054922799),A=p(A,I,k,M,f[m+8],6,1873313359),M=p(M,A,I,k,f[m+15],10,-30611744),k=p(k,M,A,I,f[m+6],15,-1560198380),I=p(I,k,M,A,f[m+13],21,1309151649),A=p(A,I,k,M,f[m+4],6,-145523070),M=p(M,A,I,k,f[m+11],10,-1120210379),k=p(k,M,A,I,f[m+2],15,718787259),I=p(I,k,M,A,f[m+9],21,-343485551),A=i(A,g),I=i(I,v),k=i(k,y),M=i(M,D);return n(A)+n(I)+n(k)+n(M)}let J9=1,R1=console,vi=class{static setLogger(e){R1=e}constructor(e,t){Je(this,"id",void 0),Je(this,"lockingPromise",Te.resolve()),Je(this,"locks",0),Je(this,"name",""),Je(this,"lockId",void 0),this.lockId=J9++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");R1.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Te(s=>{t=()=>{this.locks-=1,this.logger("unlocked",e),s()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Mu(e,t){return function(n,i,s){const o=s.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const d=await c.lock("From ".concat(e,".").concat(i));try{for(var p=arguments.length,f=new Array(p),m=0;m<p;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{d()}},s}}const jn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function aR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function ho(e,t,n,i){const s=Object.assign({},jn,i);let o=s.timeout;const c=async()=>{await function(f){return new Te(m=>{window.setTimeout(m,f)})}(o),o*=s.timeoutFactor,o=Math.min(s.maxRetryTimeout,o)};let d=!1;const p=new Te(async(f,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let g=0;g<s.maxRetryCount;g+=1){if(d)return m(new re(L.OPERATION_ABORTED));try{const v=await e();if(!t(v,g)||g+1===s.maxRetryCount)return f(v);await c()}catch(v){if(!n(v,g)||g+1===s.maxRetryCount)return m(v);await c()}}});return p.cancel=()=>d=!0,p}let ag,w1=class{constructor(e){Je(this,"input",[]),Je(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ks(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},cg=0,cR=0;function lR(e,t,n,i){return new Te((s,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),cg+=Go(t.data)):n&&(t.data.size?cg+=t.data.size:t.data instanceof FormData?cg+=v1(t.data):cg+=Go(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Zi.request(t).then(c=>{typeof c.data=="string"?cR+=Go(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?cR+=c.data.byteLength:cR+=Go(JSON.stringify(c.data)),s(c.data)}).catch(c=>{Zi.isCancel(c)?o(new re(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new re(L.NETWORK_TIMEOUT,c.message)):c.response?o(new re(L.NETWORK_RESPONSE_ERROR,c.response.status)):o(new re(L.NETWORK_ERROR,c.message))})})}async function X9(e,t){const n=new Blob([t.data],{type:"buffer"});return await lR(e,Ie(Ie({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const A1=()=>window.isSecureContext!==void 0;function Lr(e){if(Array.isArray(e))return e.map(n=>n);if(!I1(e))return e;const t={};for(const n in e){const i=e[n];I1(i)||Array.isArray(i)?t[n]=Lr(i):t[n]=i}return t}function I1(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let dR=class{constructor(e){Je(this,"input",[]),Je(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ho={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},cf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ho,remoteCandidate:Ho},updateInterval:0},O1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},N1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},D1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},P1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};let uR=class{constructor(e,t){Je(this,"onFirstVideoReceived",void 0),Je(this,"onFirstVideoDecoded",void 0),Je(this,"onFirstAudioReceived",void 0),Je(this,"onFirstVideoDecodedTimeout",void 0),Je(this,"onFirstAudioDecoded",void 0),Je(this,"onSelectedLocalCandidateChanged",void 0),Je(this,"onSelectedRemoteCandidateChanged",void 0),Je(this,"videoIsReady",!1),Je(this,"videoIsReady2",{}),Je(this,"pc",void 0),Je(this,"options",void 0),Je(this,"intervalTimer",void 0),Je(this,"stats",Lr(cf)),Je(this,"isFirstVideoReceived",{}),Je(this,"isFirstVideoDecoded",{}),Je(this,"isFirstAudioReceived",{}),Je(this,"isFirstAudioDecoded",{}),Je(this,"isFirstVideoDecodedTimeout",{}),Je(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Te(e=>{e({local:Ie({},Ho),remote:Ie({},Ho)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,o=0,c=0;for(const d of n)e[d].forEach((p,f)=>{if(!this.lossRateWindowStats[t-1][d][f]||!this.lossRateWindowStats[0][d][f])return;const m=this.lossRateWindowStats[t-1][d][f].packets-this.lossRateWindowStats[0][d][f].packets,g=this.lossRateWindowStats[t-1][d][f].packetsLost-this.lossRateWindowStats[0][d][f].packetsLost;d==="videoSend"||d==="audioSend"?(i+=m,o+=g):(s+=m,c+=g),Number.isNaN(m)||Number.isNaN(m)?p.packetLostRate=0:p.packetLostRate=m<=0||g<=0?0:g/(m+g)});e.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),e.recvPacketLossRate=s<=0||c<=0?0:c/(s+c)}},Q9=class extends uR{constructor(){super(...arguments),Je(this,"_stats",cf),Je(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Lr(cf);const n=t.filter(s=>s.type==="ssrc");this.processSSRCStats(n);const i=t.find(s=>s.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=ve(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=Lr(N1);s.codec=t.googCodecName,s.adaptionChangeReason="none",t.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(t.googAvgEncodeMs),s.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.firsCount=Number(t.googFirReceived),s.nacksCount=Number(t.googNacksReceived),s.plisCount=Number(t.googPlisReceived),s.frameCount=Number(t.framesEncoded),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=Lr(O1),o=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(s.codec=t.googCodecName,s.targetDelayMs=Number(t.googTargetDelayMs),s.renderDelayMs=Number(t.googRenderDelayMs),s.currentDelayMs=Number(t.googCurrentDelayMs),s.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),s.decodeMs=Number(t.googDecodeMs),s.maxDecodeMs=Number(t.googMaxDecodeMs),s.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},s.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},s.decodeFrameRate=Number(t.googFrameRateDecoded),s.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},s.jitterBufferMs=Number(t.googJitterBufferMs),s.firsCount=Number(t.googFirsSent),s.nacksCount=Number(t.googNacksSent),s.plisCount=Number(t.googPlisSent),s.framesDecodeCount=Number(t.framesDecoded),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const c=o.stats,d=Date.now()-o.lts;s.framesDecodeFreezeTime=c.framesDecodeFreezeTime,s.framesDecodeInterval=c.framesDecodeInterval,s.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=d,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:Ie({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=Lr(P1);s.codec=t.googCodecName,s.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,s.decodingCNG=Number(t.googDecodingCNG),s.decodingCTN=Number(t.googDecodingCTN),s.decodingCTSG=Number(t.googDecodingCTSG),s.decodingNormal=Number(t.googDecodingNormal),s.decodingPLC=Number(t.googDecodingPLC),s.decodingPLCCNG=Number(t.googDecodingPLCCNG),s.expandRate=Number(t.googExpandRate),s.accelerateRate=Number(t.googAccelerateRate),s.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),s.speechExpandRate=Number(t.googSpeechExpandRate),s.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),s.jitterBufferMs=Number(t.googJitterBufferMs),s.jitterMs=Number(t.googJitterReceived),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),s.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=Lr(D1);s.codec=t.googCodecName,s.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,s.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new Te((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(s=>{i[s]=n.stat(s)}),t.push(i)}),t}},lf=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),lg=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),hR=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Fs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var ju=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(ju||{});function df(e,t,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ju.kNone;if(!t)return;const o=Number(t[n]);if(typeof o!="number")return;const c=Number(t[i]);if(typeof c!="number")return;if(!e)return c?o/c*s:void 0;const d=Number(e[n]);if(typeof d!="number")return;const p=Number(e[i]);if(typeof p!="number")return;const f=c-p;return f?(o-d)/f*s:void 0}let L1=class extends uR{constructor(){super(...arguments),Je(this,"_stats",cf),Je(this,"report",void 0),Je(this,"lastDecodeVideoReceiverStats",new Map),Je(this,"lastVideoFramesRecv",new Map),Je(this,"lastVideoFramesSent",new Map),Je(this,"lastVideoFramesDecode",new Map),Je(this,"lastVideoFramesOutput",new Map),Je(this,"lastVideoJBDelay",new Map),Je(this,"lastAudioJBDelay",new Map),Je(this,"mediaBytesSent",new Map),Je(this,"mediaBytesRetransmit",new Map),Je(this,"mediaBytesTargetEncode",new Map),Je(this,"lastDecodeAudioReceiverStats",new Map),Je(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Lr(cf),this.report.forEach(e=>{switch(e.type){case Fs.OUTBOUND:case Fs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===Fs.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Fs.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Fs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Fs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ie({},Ho),remote:Ie({},Ho)};return e.forEach(n=>{let i;if(n.type===Fs.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===Fs.CANDIDATE_PAIR&&n.selected&&(i=n),i){const s=(o,c)=>{o.type=c.type,o.id=c.id,c.address&&(o.address=c.address),c.candidateType&&(o.candidateType=c.candidateType),c.port&&(o.port=c.port),c.priority&&(o.priority=c.priority),c.protocol&&(o.protocol=c.protocol),c.relayProtocol&&(o.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const o=e.get(i.localCandidateId);o&&s(t.local,o)}if(i.remoteCandidateId){const o=e.get(i.remoteCandidateId);o&&s(t.remote,o)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Fs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Fs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Fs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ie({},t),Ie({},this.stats.selectedCandidatePair.localCandidate)),e.type===Fs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ie({},t),Ie({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=Lr(P1),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=df(n,t,"totalProcessingDelay","jitterBufferEmittedCount",ju.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ie({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(c=>c.ssrc===e.ssrc);t||(t=Lr(O1),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),s=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const c=t.decodedFrame?t.decodedFrame.width:0,d=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,d),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const c=n.stats,d=o-n.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&d>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=d,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=df(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=df(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",ju.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=df(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",ju.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=df(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",ju.kMillisecondsFromSeconds),i&&o-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(s&&o-s.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):s?t.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ie({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=Lr(N1),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new dR(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const s=new dR(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const s=new dR(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-i.lastFrameCount,o=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*o/s}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,Fs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Lr(D1),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Fs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const i=Array.from(js(n=this.report).call(n)).find(s=>s.type===t&&s.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,s,o,c;const d=t?this.report.get(t):void 0,p=(i=d==null?void 0:d.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof p!="number")return;let f=(s=d==null?void 0:d.frameWidth)!==null&&s!==void 0?s:e.frameWidth,m=(o=d==null?void 0:d.frameHeight)!==null&&o!==void 0?o:e.frameHeight,g=(c=d==null?void 0:d.framesPerSecond)!==null&&c!==void 0?c:e.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),g==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(g=Math.round((p-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:v,rate:g})):y?g=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:p,lts:v,rate:0})}n.sentFrame={width:f,height:m,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(e,t,n){var i,s,o,c,d;const p=t?this.report.get(t):void 0,f=(i=p==null?void 0:p.framesReceived)!==null&&i!==void 0?i:e.framesReceived,m=(s=p==null?void 0:p.frameWidth)!==null&&s!==void 0?s:e.frameWidth,g=(o=p==null?void 0:p.frameHeight)!==null&&o!==void 0?o:e.frameHeight,v=(c=p==null?void 0:p.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,y=(d=p==null?void 0:p.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount;if(typeof f=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=f;let I=0;D&&A-D.lts>=800?(I=Math.round((f-D.count)/((A-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:A,rate:I})):D?I=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:A,rate:0}),n.receivedFrame={width:m||0,height:g||0,frameRate:I||0},n.decodedFrame={width:m||0,height:g||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:g||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=D.jitterBufferMs;const I=y-D.jitterBufferEmittedCount;I>0&&(A=1e3*(v-D.jitterBufferDelay)/I),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,s,o,c;const d=t?this.report.get(t):void 0,p=(i=(s=d==null?void 0:d.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&i!==void 0?i:0,f=(o=(c=d==null?void 0:d.echoReturnLossEnhancement)!==null&&c!==void 0?c:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;n.aecReturnLoss=p,n.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,n){var i,s,o,c,d,p,f;const m=t?this.report.get(t):void 0,g=(i=m==null?void 0:m.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,v=(s=m==null?void 0:m.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,y=(o=m==null?void 0:m.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,D=(c=m==null?void 0:m.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount,A=(d=m==null?void 0:m.audioLevel)!==null&&d!==void 0?d:e==null?void 0:e.audioLevel,I=(p=m==null?void 0:m.totalSamplesDuration)!==null&&p!==void 0?p:e==null?void 0:e.totalSamplesDuration,k=(f=m==null?void 0:m.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples;if(g&&v&&(n.accelerateRate=g/v),y&&D){const H=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let J=H.jitterBufferMs;const $=D-H.jitterBufferEmittedCount;$>0&&(J=1e3*(y-H.jitterBufferDelay)/$),n.jitterBufferMs=Math.round(J),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:D,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=A;let M=1920;I&&v&&(M=v/I/50,n.receivedFrames=Math.round(v/M)),k&&(n.droppedFrames=Math.round(k/M))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(s=>{e+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{t=t===null?s.diffMean():t+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},Z9=class extends uR{updateStats(){return Te.resolve()}};function pR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return o?o<76?new Q9(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new L1(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(c){if(!window.RTCStatsReport)return!1;const d=c.getStats();return!!(d instanceof Te||function(p){return!!p&&(typeof p=="object"||typeof p=="function")&&typeof p.then=="function"}(d))}(e)?new L1(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new Z9(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s})}const x1="websdk_ng_install_id";function fR(){try{if(V("INSTALL_ID"))return V("INSTALL_ID");let e=window.localStorage.getItem(x1);return e||(e=Fl(),window.localStorage.setItem(x1,e)),xt("INSTALL_ID",e),e}catch{return}}const or=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.1"),mR=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Bl=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const mi=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),s=[];for(let d=0;d<6;d++)s.push("1");const o=s.join(""),c={};return c[e]=i,c[t]=o,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=mi;const dg={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},_R={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ER="v4.23.1-0-gea45199f-dirty(1/16/2025, 3:18:04 PM)",gR={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"]},un=Ie(Ie(Ie({},gR),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:_R,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},dg),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function xt(e,t,n){var i,s,o;ve(i=Object.keys(un)).call(i,e)&&(!n&&ve(s=Object.keys(po)).call(s,e)||(un[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"||t!==!0||(un.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,un.USE_NEW_NETWORK_CONFIG=o,o&&(un.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],un.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],un.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],un.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],un.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",un.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",un.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(un.ENABLE_INSTANT_VIDEO=!0,un.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(un.ENABLE_AUT_CC=!0)))}function V(e){return un[e]}mR||(un.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],un.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],un.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],un.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],un.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],un.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],un.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",un.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",un.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",un.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",un.AREAS=["NORTH_AMERICA","OVERSEA"]);let k1=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const po={};var ct=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ct||{});let e7=class{constructor(e,t,n,i){Je(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Bl.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(t,n){switch(n.type){case ct.SET_SESSION_ID:return Ie(Ie({},t),{},{sessionId:n.sessionId});case ct.SET_P2P_ID:return Ie(Ie({},t),{},{p2pId:n.p2pId});case ct.SET_UID:return Ie(Ie({},t),{},{uid:n.uid});case ct.SET_INT_UID:return Ie(Ie({},t),{},{intUid:n.intUid});case ct.SET_PUB_ID:return Ie(Ie({},t),{},{pubId:n.pubId});case ct.KEY_METRIC_CLIENT_CREATED:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{clientCreated:n.metric})});case ct.KEY_METRIC_JOIN_START:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{joinStart:n.metric})});case ct.AVOID_JOIN_START:return Ie(Ie({},t),{},{avoidJoinStart:n.avoidJoinStart});case ct.KEY_METRIC_JOIN_END:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{joinEnd:n.metric})});case ct.KEY_METRIC_REQUEST_AP_START:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{requestAPStart:n.metric})});case ct.KEY_METRIC_REQUEST_AP_END:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{requestAPEnd:n.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_START:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{joinGatewayStart:n.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_END:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{joinGatewayEnd:n.metric})});case ct.KEY_METRIC_PEER_CONNECTION_START:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{peerConnectionStart:n.metric})});case ct.KEY_METRIC_PEER_CONNECTION_END:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{peerConnectionEnd:n.metric})});case ct.KEY_METRIC_DESCRIPTION_START:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{descriptionStart:n.metric})});case ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{signalChannelOpen:n.metric})});case ct.KEY_METRIC_ICE_CONNECTION_END:return Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{iceConnectionEnd:n.metric})});case ct.KEY_METRIC_PUBLISH:{const i=t.keyMetrics.publish,s=i.findIndex(o=>o.trackId===n.metric.trackId);return s!==-1?(i[s]=Ie(Ie({},i[s]),n.metric),Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{publish:[...i]})})):Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,n.metric]})})}case ct.KEY_METRIC_SUBSCRIBE:{const i=t.keyMetrics.subscribe,s=i.findIndex(o=>o.userId===n.metric.userId&&o.type===n.metric.type);return s!==-1?(i[s]=Ie(Ie({},i[s]),n.metric),Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{subscribe:[...i]})})):Ie(Ie({},t),{},{keyMetrics:Ie(Ie({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,n.metric]})})}case ct.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=n.mode,t;case ct.RECORD_JOIN_CHANNEL_SERVICE:return typeof n.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,n.record]:(t.joinChannelServiceRecords[n.index]=Ie(Ie({},t.joinChannelServiceRecords[n.index]),n.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case ct.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case ct.SET_USE_P2P:return Ie(Ie({},t),{},{useP2P:n.val});case ct.SET_TRANSPORT_TYPE:return Ie(Ie({},t),{},{p2pTransport:n.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:ct.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ct.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ct.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ct.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ct.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ct.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ct.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:ct.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ct.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ct.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ct.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,i){this.dispatch({type:ct.KEY_METRIC_PUBLISH,metric:Ie(Ie({trackId:e,type:t},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(e,t,n,i,s,o,c){this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie(Ie(Ie({userId:e,type:t},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),s&&{firstFrame:s}),o&&{streamAdded:o}),c&&{firstDecoded:c})})}massSubscribe(e,t,n,i){e.forEach(s=>{this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie({userId:s.userId,type:s.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(n=>n.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:Ie(Ie({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ct.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:ct.AVOID_JOIN_START,avoidJoinStart:e})}},ug=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let t7=0;var M1=(()=>{var e={8:(i,s,o)=>{o.r(s),o.d(s,{Parser:()=>be,Printer:()=>wn,parse:()=>Ee,print:()=>Pe});const c=`
`,d="".concat("\r").concat(c),p=" ";let f;function m(ce){return ce>="0"&&ce<="9"}function g(ce){return ce>="!"&&ce<="~"}function v(ce){return g(ce)||ce>=""&&ce<="ÿ"}function y(ce){return ce==="!"||ce>="#"&&ce<="'"||ce>="*"&&ce<="+"||ce>="-"&&ce<="."||ce>="0"&&ce<="9"||ce>="A"&&ce<="Z"||ce>="^"&&ce<="~"}function D(ce){return ce>="1"&&ce<="9"}function A(ce){return ce>="A"&&ce<="Z"||ce>="a"&&ce<="z"}function I(ce){return ce==="d"||ce==="h"||ce==="m"||ce==="s"}function k(ce){return ce>""&&ce<"	"||ce>"\v"&&ce<"\f"||ce>""&&ce<"ÿ"}function M(ce){return A(ce)||m(ce)||ce==="+"||ce==="/"}function H(ce){return m(ce)||A(ce)||ce==="+"||ce==="/"||ce==="-"||ce==="_"}function J(ce){return A(ce)||m(ce)||ce==="+"||ce==="/"}function $(ce,C){var F=Object.keys(ce);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(ce);C&&(B=B.filter(function(he){return Object.getOwnPropertyDescriptor(ce,he).enumerable})),F.push.apply(F,B)}return F}function z(ce){for(var C=1;C<arguments.length;C++){var F=arguments[C]!=null?arguments[C]:{};C%2?$(Object(F),!0).forEach(function(B){oe(ce,B,F[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(F)):$(Object(F)).forEach(function(B){Object.defineProperty(ce,B,Object.getOwnPropertyDescriptor(F,B))})}return ce}function oe(ce,C,F){return C in ce?Object.defineProperty(ce,C,{value:F,enumerable:!0,configurable:!0,writable:!0}):ce[C]=F,ce}(function(ce){ce.VERSION="v",ce.ORIGIN="o",ce.SESSION_NAME="s",ce.INFORMATION="i",ce.URI="u",ce.EMAIL="e",ce.PHONE="p",ce.CONNECTION="c",ce.BANDWIDTH="b",ce.TIME="t",ce.REPEAT="r",ce.ZONE_ADJUSTMENTS="z",ce.KEY="k",ce.ATTRIBUTE="a",ce.MEDIA="m"})(f||(f={}));class de{consumeText(C,F){let B=F;for(;B<C.length;){const he=C[B];if(he==="\0"||he==="\r"||he===c)break;B+=1}if(B-F==0)throw new Error("Invalid text, at ".concat(C));return B}consumeUnicastAddress(C,F,B){return this.consumeTill(C,F,p)}consumeOneOrMore(C,F,B){let he=F;for(;B(C[he]);)he++;if(he-F==0)throw new Error("Invalid rule at ".concat(F,"."));return he}consumeSpace(C,F){if(C[F]===p)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(C,F){let B=F;for(let he=0;he<4;he++)if(B=this.consumeDecimalUChar(C,B),he!==3){if(C[B]!==".")throw new Error("Invalid IP4 address.");B++}return B}consumeDecimalUChar(C,F){let B=F;for(let Xe=0;Xe<3&&m(C[B]);Xe++,B++);if(B-F==0)throw new Error("Invalid decimal uchar.");const he=parseInt(C.slice(F,B));if(he>=0&&he<=255)return B;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,F){let B=this.consumeHexpart(C,F);return C[B]===":"&&(B+=1,B=this.consumeIP4Address(C,B)),B}consumeHexpart(C,F){let B=F;if(C[B]===":"&&C[B+1]===":"){B+=2;try{B=this.consumeHexseq(C,B)}catch{}return B}if(B=this.consumeHexseq(C,B),C[B]===":"&&C[B+1]===":"){B+=2;try{B=this.consumeHexseq(C,B)}catch{}return B}return B}consumeHexseq(C,F){let B=F;for(;B=this.consumeHex4(C,B),C[B]===":"&&C[B+1]!==":";)B+=1;return B}consumeHex4(C,F){let B=0;for(;B<4;B++)if(!((he=C[F+B])>="0"&&he<="9"||he>="a"&&he<="f"||he>="A"&&he<="F")){if(B===0)throw new Error("Invalid hex 4");break}var he;return F+B}consumeFQDN(C,F){let B=F;for(;m(C[B])||A(C[B])||C[B]==="-"||C[B]===".";)B+=1;if(B-F<4)throw new Error("Invalid FQDN");return B}consumeExtnAddr(C,F){return this.consumeOneOrMore(C,F,v)}consumeMulticastAddress(C,F,B){switch(B){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,F);default:try{return this.consumeFQDN(C,F)}catch{return this.consumeExtnAddr(C,F)}}}consumeIP6MulticastAddress(C,F){const B=this.consumeHexpart(C,F);return C[B]==="/"?this.consumeInteger(C,B+1):B}consumeIP4MulticastAddress(C,F){let B=F+3;const he=C.slice(F,B),Xe=parseInt(he);if(Xe<224||Xe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Vt=0;Vt<3;Vt++){if(C[B]!==".")throw new Error("Invalid IP4 multicast address.");B+=1,B=this.consumeDecimalUChar(C,B)}return C[B]==="/"&&(B+=1),B=this.consumeTTL(C,B),C[B]==="/"&&(B=this.consumeInteger(C,B)),B}consumeInteger(C,F){if(!D(C[F]))throw new Error("Invalid integer.");for(F+=1;m(C[F]);)F+=1;return F}consumeTTL(C,F){if(C[F]==="0")return F+1;if(!D(C[F]))throw new Error("Invalid TTL.");F+=1;for(let B=0;B<2&&m(C[F]);B++)F+=1;return F}consumeToken(C,F){return this.consumeOneOrMore(C,F,y)}consumeTime(C,F){let B=F;if(C[B]==="0")return B+1;for(D(C[B])&&(B+=1);m(C[B]);)B++;if(B-F<10)throw new Error("Invalid time");return B}consumeAddress(C,F){return this.consumeTill(C,F,p)}consumeTypedTime(C,F){let B=F;return B=this.consumeOneOrMore(C,B,m),I(C[B])?B+1:B}consumeRepeatInterval(C,F){if(!D(C[F]))throw new Error("Invalid repeat interval");for(F+=1;m(C[F]);)F+=1;return I(C[F])&&(F+=1),F}consumePort(C,F){return this.consumeOneOrMore(C,F,m)}consume(C,F,B){for(let he=0;he<B.length;he++){if(F+he>=C.length)throw new Error("consume exceeding value length");if(C[F+he]!==B[he])throw new Error("consume ".concat(B," failed at ").concat(he))}return F+B.length}consumeTill(C,F,B){let he=F;for(;he<C.length&&(typeof B!="string"||C[he]!==B)&&(typeof B!="function"||!B(C[he]));)he++;return he}}class be extends de{constructor(){super(),oe(this,"records",[]),oe(this,"currentLine",0)}parse(C){const F=this.probeEOL(C);this.records=C.split(F).filter(dd=>!!Li(dd).call(dd)).map(this.parseLine),this.currentLine=0;const B=this.parseVersion(),he=this.parseOrigin(),Xe=this.parseSessionName(),Vt=this.parseInformation(),qn=this.parseUri(),fs=this.parseEmail(),za=this.parsePhone(),ld=this.parseConnection(),Yf=this.parseBandWidth(),Ev=this.parseTimeFields(),gv=this.parseKey(),fr=this.parseSessionAttribute(),Xc=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:B,origin:he,sessionName:Xe,information:Vt,uri:qn,emails:fs,phones:za,connection:ld,bandwidths:Yf,timeFields:Ev,key:gv,attributes:fr,mediaDescriptions:Xc}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let F=0;F<C.length;F++)if(C[F]===c)return C[F-1]==="\r"?d:c;throw new Error("Invalid newline character.")}parseLine(C,F){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const B=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:B,value:C.slice(2),line:F,cur:0}}parseSessionAttribute(){const C=new dt;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==f.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(F,he=>y(he)&&he!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,B.attValue=this.extractOneOrMore(F,k)),C.parse(B),this.currentLine++}return C.digest()}parseMediaAttributes(C){const F=new ut(C);for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==f.ATTRIBUTE)break;const he={attField:this.extractOneOrMore(B,Xe=>y(Xe)&&Xe!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,he.attValue=this.extractOneOrMore(B,k)),F.parse(he),this.currentLine++}return F.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===f.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===f.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const B=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let he=!1;C.value[C.cur]==="-"&&(he=!0,C.cur+=1);const Xe=this.extract(C,this.consumeTypedTime);F.push({time:B,typedTime:Xe,back:he})}catch{break}if(F.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==f.REPEAT)break;{const B=this.extract(F,this.consumeRepeatInterval),he=this.parseTypedTime(F);C.push({repeatInterval:B,typedTimes:he}),this.currentLine++}}return C}parseTypedTime(C){const F=[];for(;;)try{this.consumeSpaceForRecord(C),F.push(this.extract(C,this.consumeTypedTime))}catch{break}if(F.length===0)throw new Error("Invalid typed time.");return F}parseTime(){const C=this.getCurrentRecord(),F=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const B=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:B}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==f.BANDWIDTH)break;{const B=this.extractOneOrMore(F,y);if(F.value[F.cur]!==":")throw new Error("Invalid bandwidth field.");F.cur++;const he=this.extractOneOrMore(F,m);C.push({bwtype:B,bandwidth:he}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==f.VERSION)throw new Error("first sdp record must be version");const F=C.value.slice(0,this.consumeOneOrMore(C.value,0,m));if(F.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,F}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(C,v);this.consumeSpaceForRecord(C);const B=this.extractOneOrMore(C,m);this.consumeSpaceForRecord(C);const he=this.extractOneOrMore(C,m);this.consumeSpaceForRecord(C);const Xe=this.extractOneOrMore(C,y);this.consumeSpaceForRecord(C);const Vt=this.extractOneOrMore(C,y);this.consumeSpaceForRecord(C);const qn=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:B,sessVersion:he,nettype:Xe,addrtype:Vt,unicastAddress:qn}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===f.SESSION_NAME){const F=this.extract(C,this.consumeText);return this.currentLine++,F}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==f.INFORMATION)return;const F=this.extract(C,this.consumeText);return this.currentLine++,F}parseUri(){const C=this.getCurrentRecord();if(C.type===f.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==f.EMAIL)break;C.push(F.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==f.PHONE)break;C.push(F.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===f.CONNECTION){const F=this.extractOneOrMore(C,y);this.consumeSpaceForRecord(C);const B=this.extractOneOrMore(C,y);this.consumeSpaceForRecord(C);const he=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:B,address:he}}}parseMedia(){const C=this.getCurrentRecord(),F=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let B=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,B+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const he=[];for(he.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,he.push(this.extract(C,this.consumeToken));if(he.length===0)throw new Error("Invalid proto");const Xe=this.parseFmt(C);return this.currentLine++,{mediaType:F,port:B,protos:he,fmts:Xe}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===f.TIME;){const F=this.parseTime(),B=this.parseRepeat(),he=this.parseZone();C.push({time:F,repeats:B,zones:he})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const F=this.parseMedia(),B=this.parseInformation(),he=this.parseConnections(),Xe=this.parseBandWidth(),Vt=this.parseKey(),qn=this.parseMediaAttributes(F);C.push({media:F,information:B,connections:he,bandwidths:Xe,key:Vt,attributes:qn})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const F=[];for(;;)try{this.consumeSpaceForRecord(C),F.push(this.extract(C,this.consumeToken))}catch{break}if(F.length===0)throw new Error("Invalid fmts");return F}extract(C,F){for(var B=arguments.length,he=new Array(B>2?B-2:0),Xe=2;Xe<B;Xe++)he[Xe-2]=arguments[Xe];const Vt=F.call(this,C.value,C.cur,...he),qn=C.value.slice(C.cur,Vt);return C.cur=Vt,qn}extractOneOrMore(C,F){const B=this.consumeOneOrMore(C.value,C.cur,F),he=C.value.slice(C.cur,B);return C.cur=B,he}consumeSpaceForRecord(C){if(C.value[C.cur]!==p)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class Re extends de{constructor(){super(...arguments),oe(this,"attributes",void 0),oe(this,"digested",!1)}extractOneOrMore(C,F,B){const he=this.consumeOneOrMore(C.attValue,C._cur,F),Xe=C.attValue.slice(C._cur,he),[Vt,qn]=B||[];if(typeof Vt=="number"&&Xe.length<Vt)throw new Error("error in length, should be more or equal than ".concat(Vt," characters."));if(typeof qn=="number"&&Xe.length>qn)throw new Error("error in length, should be less or equal than ".concat(qn," characters."));return C._cur=he,Xe}consumeAttributeSpace(C){if(C.attValue[C._cur]!==p)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,F){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var B=arguments.length,he=new Array(B>2?B-2:0),Xe=2;Xe<B;Xe++)he[Xe-2]=arguments[Xe];const Vt=F.call(this,C.attValue,C._cur,...he),qn=C.attValue.slice(C._cur,Vt);return C._cur=Vt,qn}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,F){if(!C.attValue)throw new Error;for(let B=0;B<F.length;B++)if(F[B]!==C.attValue[C._cur+B])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,M,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,M,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(C);){F.push(this.extractOneOrMore(C,M));try{this.consumeAttributeSpace(C)}catch(B){if(this.atEnd(C))break;throw B}}this.attributes.iceOptions=F}parseFingerprint(C){const F=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:B})}parseExtmap(C){const F=this.extractOneOrMore(C,m);let B;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),B=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const he=this.extract(C,this.consumeTill,p),Xe=z(z({entry:parseInt(F,10)},B&&{direction:B}),{},{extensionName:he});this.peekChar(C)===p&&(this.consumeAttributeSpace(C),Xe.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(Xe)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(C,this.consumeTill);if(F!=="active"&&F!=="passive"&&F!=="actpass"&&F!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class dt extends Re{constructor(){super(...arguments),oe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(F){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),F}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const F=this.extract(C,this.consumeToken),B=[];for(;!this.atEnd(C)&&this.peekChar(C)===p;)this.consumeAttributeSpace(C),B.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:B})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,H)}parseIdentity(C){const F=this.extractOneOrMore(C,J),B=[];for(;!this.atEnd(C)&&this.peekChar(C)===p;){this.consumeAttributeSpace(C);const he=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const Xe=this.extractOneOrMore(C,Vt=>Vt!==p&&k(Vt));B.push({name:he,value:Xe})}this.attributes.identities.push({assertionValue:F,extensions:B})}parseMsidSemantic(C){this.peekChar(C)===p&&this.consumeAttributeSpace(C);const F={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),F.applyForAll=!0;break}{const B=this.extract(C,this.consumeTill,p);F.identifierList.push(B)}}this.attributes.msidSemantic=F}}class ut extends Re{constructor(C){super(),oe(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(F){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),F}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const F=this.extractOneOrMore(C,M,[1,32]);this.consumeAttributeSpace(C);const B=this.extractOneOrMore(C,m,[1,5]);this.consumeAttributeSpace(C);const he=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const Xe=this.extractOneOrMore(C,m,[1,10]);this.consumeAttributeSpace(C);const Vt=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const qn=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const fs={foundation:F,componentId:B,transport:he,priority:Xe,connectionAddress:Vt,port:qn,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),fs.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),fs.relPort=this.extract(C,this.consumePort));this.peekChar(C)===p;){this.consumeAttributeSpace(C);const za=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),fs.extension[za]=this.extractOneOrMore(C,g)}this.attributes.candidates.push(fs)}parseRemoteCandidate(C){const F=[];for(;;){const B=this.extractOneOrMore(C,m,[1,5]);this.consumeAttributeSpace(C);const he=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Xe=this.extract(C,this.consumePort);F.push({componentId:B,connectionAddress:he,port:Xe});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const F=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const he={encodingName:B,clockRate:this.extractOneOrMore(C,m)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),he.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const Xe=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Xe?Xe.rtpMap=he:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:he,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const F=this.extractOneOrMore(C,m);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,":");let he;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),he=this.extract(C,this.consumeTill));const Xe=this.attributes.ssrcs.find(Vt=>Vt.ssrcId===parseInt(F,10));Xe?Xe.attributes[B]=he:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[B]:he}})}parseFmtp(C){const F=this.extract(C,this.consumeTill,p);this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill),he={};B.split(";").forEach(Vt=>{let[qn,fs]=Vt.split("=");qn=Li(qn).call(qn);const za=typeof fs=="string"?Li(fs).call(fs):null;typeof qn=="string"&&qn.length>0&&(he[qn]=za)});const Xe=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Xe?Xe.fmtp={parameters:he}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:he}})}parseFmtParameters(C){const F={},B=this.extract(C,this.consumeTill,"=");C._cur++;const he=this.extract(C,this.consumeTill,";");for(F[B]=he;C.attValue[C._cur]===";";){const Xe=this.extract(C,this.consumeTill,"=");C._cur++;const Vt=this.extract(C,this.consumeTill,";");F[Xe]=Vt}return F}parseRtcpFb(C){let F="";F=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,p),this.consumeAttributeSpace(C);const B=this.extract(C,this.consumeTill,p);let he;if(B==="trr-int")he={type:B,interval:this.extract(C,this.consumeTill)};else{const Xe={type:B};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),Xe.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===p&&(Xe.additional=this.extract(C,this.consumeTill))),he=Xe}if(F==="*")this.attributes.rtcpFeedbackWildcards.push(he);else{const Xe=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Xe?Xe.rtcpFeedbacks.push(he):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[he]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(C,this.consumePort)};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),F.netType=this.extractOneOrMore(C,y),this.consumeAttributeSpace(C),F.addressType=this.extractOneOrMore(C,y),this.consumeAttributeSpace(C),F.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(C){const F={id:this.extractOneOrMore(C,y,[1,64])};this.peekChar(C)===p&&(this.consumeAttributeSpace(C),F.appdata=this.extractOneOrMore(C,y,[1,64])),this.attributes.msids.push(F)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const F=this.extractOneOrMore(C,he=>A(he)||m(he)||he==="_"||he==="-");this.consumeAttributeSpace(C);const B={id:F,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===p){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const he=[];for(;;){const Xe=this.extract(C,this.consumeToken);he.push(Xe);try{this.extract(C,this.consume,",")}catch{break}}B.payloads=he,this.peekChar(C)===p&&this.extract(C,this.consume,p)}for(;;){const he=this.extract(C,this.consumeToken);switch(he){case"depend":{const Xe={type:he,rids:this.extract(C,this.consume,"=").split(",")};B.params.push(Xe);break}default:{const Xe={type:he};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),Xe.val=this.extract(C,this.consumeTill,";")),B.params.push(Xe)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(B)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,m,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const F=this.extract(C,this.consumeToken),B=[];for(;;)try{this.consumeAttributeSpace(C);const he=this.extract(C,this.consumeInteger);B.push(parseInt(he,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:B})}}function $t(ce,C,F){return C in ce?Object.defineProperty(ce,C,{value:F,enumerable:!0,configurable:!0,writable:!0}):ce[C]=F,ce}class wn{constructor(){$t(this,"eol",d)}print(C,F){let B="";return F&&(this.eol=F),B+=this.printVersion(C.version),B+=this.printOrigin(C.origin),B+=this.printSessionName(C.sessionName),B+=this.printInformation(C.information),B+=this.printUri(C.uri),B+=this.printEmail(C.emails),B+=this.printPhone(C.phones),B+=this.printConnection(C.connection),B+=this.printBandwidth(C.bandwidths),B+=this.printTimeFields(C.timeFields),B+=this.printKey(C.key),B+=this.printSessionAttributes(C.attributes),B+=this.printMediaDescription(C.mediaDescriptions),B}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let F="";for(const B of C)F+="e=".concat(B).concat(this.eol);return F}printPhone(C){let F="";for(const B of C)F+="e=".concat(B).concat(this.eol);return F}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let F="";for(const B of C)F+="b=".concat(B.bwtype,":").concat(B.bandwidth).concat(this.eol);return F}printTimeFields(C){let F="";for(const B of C){F+="t=".concat(B.time.startTime," ").concat(B.time.startTime).concat(this.eol);for(const he of B.repeats)F+="r=".concat(he.repeatInterval," ").concat(he.typedTimes.join(" ")).concat(this.eol);B.zoneAdjustments&&(F+="z=",F+="z=".concat(B.zoneAdjustments.map(he=>"".concat(he.time," ").concat(he.back?"-":""," ").concat(he.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let F="";for(const B of C)F+="a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol);return F}printMediaDescription(C){let F="";for(const B of C)F+=this.printMedia(B.media),F+=this.printInformation(B.information),F+=this.printConnections(B.connections),F+=this.printBandwidth(B.bandwidths),F+=this.printKey(B.key),F+=this.printMediaAttributes(B);return F}printConnections(C){let F="";for(const B of C)F+=this.printConnection(B);return F}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new ss(this.eol).print(C)}printMediaAttributes(C){return new ae(this.eol).print(C)}}class vn{constructor(C){$t(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(p)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(p).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(p).concat(F.extensionName).concat(F.extensionAttributes?"".concat(p).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ss extends vn{print(C){let F="";return F+=this.printGroups(C.groups),F+=this.printMsidSemantic(C.msidSemantic),F+=this.printIceLite(C.iceLite),F+=this.printIceUfrag(C.iceUfrag),F+=this.printIcePwd(C.icePwd),F+=this.printIceOptions(C.iceOptions),F+=this.printFingerprints(C.fingerprints),F+=this.printSetup(C.setup),F+=this.printTlsId(C.tlsId),F+=this.printIdentity(C.identities),F+=this.printExtmap(C.extmaps),F+=this.printUnrecognized(C.unrecognized),F}printGroups(C){let F="";return C.length>0&&(F+=C.map(B=>"a=group:".concat(B.semantic).concat(B.identificationTag.map(he=>"".concat(p).concat(he)).join("")).concat(this.eol)).join("")),F}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(B=>"".concat(p).concat(B.name).concat(B.value?"=".concat(B.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let F="a=msid-semantic:".concat(C.semantic);return C.applyForAll?F+="".concat(p,"*"):C.identifierList.length>0&&(F+=C.identifierList.map(B=>"".concat(p).concat(B))),F+this.eol}}class ae extends vn{print(C){const F=C.attributes;let B="";return B+=this.printRTCP(F.rtcp),B+=this.printIceUfrag(F.iceUfrag),B+=this.printIcePwd(F.icePwd),B+=this.printIceOptions(F.iceOptions),B+=this.printCandidates(F.candidates),B+=this.printRemoteCandidatesList(F.remoteCandidatesList),B+=this.printEndOfCandidates(F.endOfCandidates),B+=this.printFingerprints(F.fingerprints),B+=this.printSetup(F.setup),B+=this.printMid(F.mid),B+=this.printExtmap(F.extmaps),B+=this.printRTPRelated(F),B+=this.printPtime(F.ptime),B+=this.printMaxPtime(F.maxPtime),B+=this.printDirection(F.direction),B+=this.printSSRCGroups(F.ssrcGroups),B+=this.printSSRC(F.ssrcs),B+=this.printRTCPMux(F.rtcpMux),B+=this.printRTCPMuxOnly(F.rtcpMuxOnly),B+=this.printRTCPRsize(F.rtcpRsize),B+=this.printMSId(F.msids),B+=this.printImageattr(F.imageattr),B+=this.printRid(F.rids),B+=this.printSimulcast(F.simulcast),B+=this.printSCTPPort(F.sctpPort),B+=this.printMaxMessageSize(F.maxMessageSize),B+=this.printUnrecognized(F.unrecognized),B}printCandidates(C){return C.map(F=>"a=candidate:".concat(F.foundation).concat(p).concat(F.componentId).concat(p).concat(F.transport).concat(p).concat(F.priority).concat(p).concat(F.connectionAddress).concat(p).concat(F.port).concat(p,"typ").concat(p).concat(F.type).concat(F.relAddr?"".concat(p,"raddr").concat(p).concat(F.relAddr):"").concat(F.relPort?"".concat(p,"rport").concat(p).concat(F.relPort):"").concat(Object.keys(F.extension).map(B=>"".concat(p).concat(B).concat(p).concat(F.extension[B])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(F=>"a=remote-candidates:".concat(F.join(p)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const F=C.payloads;let B="";B+=C.rtcpFeedbackWildcards.map(he=>this.printRTCPFeedback("*",he)).join("");for(const he of F)B+=this.printRtpMap(he.payloadType,he.rtpMap),B+=this.printFmtp(he.payloadType,he.fmtp),B+=he.rtcpFeedbacks.map(Xe=>this.printRTCPFeedback(he.payloadType,Xe)).join("");return B}printFmtp(C,F){if(!F)return"";const B=Object.keys(F.parameters);return B.length===1&&F.parameters[B[0]]===null?"a=fmtp:".concat(C).concat(p).concat(B[0]).concat(this.eol):"a=fmtp:".concat(C).concat(p).concat(Object.keys(F.parameters).map(he=>"".concat(he,"=").concat(F.parameters[he])).join(";")).concat(this.eol)}printRtpMap(C,F){return F?"a=rtpmap:".concat(C).concat(p).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,F){let B="a=rtcp-fb:".concat(C).concat(p),he=F;return he.type==="trr-int"?B+="ttr-int".concat(p).concat(he.interval):(B+="".concat(he.type),he.parameter&&(B+="".concat(p).concat(he.parameter),he.additional&&(B+="".concat(p).concat(he.additional)))),B+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(F=>Object.keys(F.attributes).map(B=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(p).concat(B).concat(F.attributes[B]?":".concat(F.attributes[B]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let F="a=rtcp:".concat(C.port);return C.netType&&(F+="".concat(p).concat(C.netType)),C.addressType&&(F+="".concat(p).concat(C.addressType)),C.address&&(F+="".concat(p).concat(C.address)),F+this.eol}printMSId(C){return C.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(p).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(C){return C.map(F=>{let B="a=rid:".concat(F.id).concat(p).concat(F.direction);return F.payloads&&(B+="".concat(p,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(B+="".concat(p).concat(F.params.map(he=>he.type==="depend"?"depend=".concat(he.rids.join(",")):"".concat(he.type,"=").concat(he.val)).join(";"))),B+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(B=>"".concat(p).concat(B.toString(10))).join("")).concat(this.eol)).join("")}}function Ee(ce){return new be().parse(ce)}function Pe(ce,C){return new wn().print(ce,C)}}},t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}return n.d=(i,s)=>{for(var o in s)n.o(s,o)&&!n.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:s[o]})},n.o=(i,s)=>Object.prototype.hasOwnProperty.call(i,s),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function ls(e){return M1.parse(e)}function kc(e,t){return M1.print(e,t)}var n7=xs("Array","keys"),i7=br,s7=Xn,r7=q,o7=n7,vR=Array.prototype,a7={DOMTokenList:!0,NodeList:!0},c7=function(e){var t=e.keys;return e===vR||r7(vR,e)&&t===vR.keys||s7(a7,i7(e))?o7:t},Bs=E(c7);function mn(e,t,n){return(t=function(i){var s=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j1(Object(n),!0).forEach(function(i){mn(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j1(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const U1=new class extends dn{constructor(){super(...arguments),mn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class l7{constructor(t){mn(this,"logger",void 0),mn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function SR(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function V1(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const ar={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},hg=Date.now(),uf=e=>{for(const t in ar)if(Object.prototype.hasOwnProperty.call(ar,t)&&ar[t]===e)return t;return"DEFAULT"},b=new class{constructor(){mn(this,"proxyServerURL",void 0),mn(this,"logLevel",ar.DEBUG),mn(this,"uploadState","collecting"),mn(this,"uploadLogWaitingList",[]),mn(this,"uploadLogUploadingList",[]),mn(this,"uploadErrorCount",0),mn(this,"currentLogID",0),mn(this,"url",void 0),mn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[ar.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[ar.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[ar.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[ar.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[ar.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){xt("UPLOAD_LOG",!0)}disableLogUpload(){xt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new l7(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hg<100)return void setTimeout(()=>{this.log(...t)},Date.now()-hg);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=SR()+" Agora-SDK [".concat(uf(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=SR()+" %cAgora-SDK [".concat(uf(i),"]:");let o=[];if(!V("USE_NEW_LOG"))switch(i){case ar.DEBUG:o=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case ar.INFO:o=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case ar.WARNING:o=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case ar.ERROR:o=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hg<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-hg);const i=Math.max(0,Math.min(4,t[0]));t[0]=SR()+" Agora-SDK [".concat(uf(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!V("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=V1()+" Agora-SDK [".concat(uf(e),"]:"):n[0]=V1()+" Agora-SDK [".concat(uf(e),"]:");let s="";n.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),s+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:or,process_id:V("PROCESS_ID"),payload:JSON.stringify(e)};return ho(async()=>{const n=await Zi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(s=>s.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),U1.reportLogUploadError(i),!0},{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var F1;function d7(e){return ai(e.reportId,"params.reportId",0,100,!1),ai(e.category,"params.category",0,100,!1),ai(e.event,"params.event",0,100,!1),ai(e.label,"params.label",0,100,!1),Ut(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(F1={}).FREE="free",F1.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const u7={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let zn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),sn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let h7=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function He(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const s=i.value;if(typeof s=="function"){const o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var c,d=arguments.length,p=new Array(d),f=0;f<d;f++)p[f]=arguments[f];let m=p;if(e.argsMap)try{m=e.argsMap(this,...p)}catch(v){b.warning(v),m=[]}try{JSON.stringify(m)}catch{b.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const g=(e.report||xe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:m,tag:fn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const v=s.apply(this,p);return v instanceof Te?v.then(y=>(g.onSuccess(e.reportResult&&y),y)).catch(y=>{throw g.onError(y),y}):(g.onSuccess(e.reportResult&&v),v)}catch(v){throw g.onError(v),v}}}return i}}const xe=new class{constructor(){mn(this,"baseInfoMap",new Map),mn(this,"proxyServer",void 0),mn(this,"eventUploadTimer",void 0),mn(this,"setSessionIdTimer",void 0),mn(this,"url",void 0),mn(this,"sids",new Set),mn(this,"backupUrl",void 0),mn(this,"_appId",void 0),mn(this,"_aid",0),mn(this,"keyEventUploadPendingItems",[]),mn(this,"normalEventUploadPendingItems",[]),mn(this,"apiInvokeUploadPendingItems",[]),mn(this,"apiInvokeCount",0),mn(this,"apiInvokeLoggedCount",0),mn(this,"ltsList",[]),mn(this,"lastSendNormalEventTime",Date.now()),mn(this,"customReportCounterTimer",void 0),mn(this,"customReportCount",0),mn(this,"extApiInvoke",async e=>{for(const t of e){const n=st(st({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:fn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,o=!!V("SHOW_REPORT_INVOKER_LOG"),c=!!V("SHOW_REPORT_USER_INVOKER_LOG"),d=o||c&&t.id;d&&(this.apiInvokeLoggedCount+=1);const p=this.apiInvokeLoggedCount;function f(y,D){if(d){let A="[apiInvoke-".concat(p,"]");t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]")),b.info("".concat(A," ").concat(y),y==="start"?t.options:D||"")}}const m=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});f("start");let g=!1;ci(t.timeout).then(()=>{g||(this.sendApiInvoke(st(st({},m()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});const v=new re(L.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{const D=()=>{if(g)throw v;return g=!0,this.sendApiInvoke(st(st({},m()),{},{success:!0},t.reportResult&&{result:y})),f("onSuccess"),y};return n?T1(D,t.name+"Success",n,()=>g=!0):D()},onError:y=>{const D=()=>{if(g)throw y;g=!0,this.sendApiInvoke(st(st({},m()),{},{success:!1,error:y})),f("onFailure",y.toString())};return n?T1(D,t.name+"Error",n,()=>g=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:mR?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:c,channelMode:d,isABTestSuccess:p,lsid:f,clientRole:m}=t,g=Date.now(),v=st(st({},i),{},{eventType:zn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:ER,lts:g,elapse:g-n,extend:JSON.stringify(s),mode:t.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:or,stringUid:o,channelProfile:c,channelMode:d,isABTestSuccess:p,lsid:f,clientType:ve(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:V("PROCESS_ID"),extensionID:V("PLUGIN_INFO").join(",")||""});var y;this.send({type:sn.SESSION,data:v},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{role:t.role,eventType:zn.JOIN_CHOOSE_SERVER,lts:s,eventElapse:t.elapse||s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:sn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{eventType:zn.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:sn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=Date.now(),{firstSuccess:o,avoidJoinStartTime:c,addr:d,isProxy:p}=t,f=s-(o&&c?c:n.startTime),m=st(st({},i),{},{eventType:zn.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:f,eventElapse:s-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:fR(),isABTestSuccess:t.isABTestSuccess?1:0}),g=m.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),o)this.send({type:sn.JOIN_GATEWAY,data:m},!0);else{let v;if(d)if(p){const D=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=d.match(/p=[0-9]{1,6}/g);v={isSuccess:g,gatewayIp:D&&D.length?D[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:p?1:0}}else{const D=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=d.match(/(:|p=)[0-9]{1,6}/g);v={isSuccess:g,gatewayIp:D&&D.length?D[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(/:|p=/g)[1]:"",isProxy:p?1:0}}else v={isSuccess:g,gatewayIp:"",port:"",isProxy:p?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const y=Object.assign({},m,v,{eventType:zn.REJOIN_GATEWAY});this.send({type:sn.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),s=st(st({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:sn.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{eventType:zn.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:sn.PUBLISH,data:o},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=st(st({},s),{},{eventType:zn.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:sn.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;const n=[...Bs(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const o=s.info,c=Date.now(),d=st(st({},o),{},{eventType:zn.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-s.startTime,status:e.status?1:2});this.send({type:sn.WS_COMPRESSOR_INIT,data:d},!0)}firstRemoteVideoDecode(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=st(st(st({},o),i),{},{elapse:c-s.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:n,data:d},!0)}firstRemoteFrame(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=st(st(st({},o),i),{},{elapse:c-s.startTime,eventType:t,lts:c});this.send({type:n,data:d},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-n.startTime,eventType:zn.AB_TEST,lts:s});this.send({type:sn.AB_TEST,data:o},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-n.startTime,eventType:zn.PC_STATS,lts:s,preallocation:t.preallocation?1:0});this.send({type:sn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:zn.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:sn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=st(st(st({},o),i),{},{eventType:t,lts:c});this.send({type:n,data:d},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{eventType:zn.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:sn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{eventType:zn.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:sn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{eventType:zn.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:sn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?b.debug("reportProxyServerurl: ".concat(e)):b.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:sn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now();(function(o,c,d){const p=o[c];if(!p||typeof p!="string")return[o];o[c]="";const f=Go(JSON.stringify(o));let m=0;const g=[];let v=0;for(let y=0;y<p.length;y++)v+=p.charCodeAt(y)<=127?1:3,v<=d-f||(g[g.length]=Ie(Ie({},o),{},{[c]:p.substring(m,y)}),m=y,v=p.charCodeAt(y)<=127?1:3);return m!==p.length-1&&(g[g.length]=Ie(Ie({},o),{},{[c]:p.substring(m)})),g})(st(st(st({},i),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:sn.WORKER_EVENT,data:o},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:sn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:sn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=st(st(st({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:sn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new re(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(s=>({type:sn.USER_ANALYTICS,data:st(st({sid:e},s),{},{lts:n})}));try{V("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(s){throw b.error("send custom report message failed",s.toString()),new re(L.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const t=V("NOT_REPORT_EVENT");if(e.tag&&ve(t)&&ve(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:o}=n.info;let c;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof re){const{code:p,message:f}=e.error;c=p||f||e.error.toString()}else c=e.error.toString();const d={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:sn.API_INVOKE,data:d},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const o=e.shift();n.length<20?n.push(o):i.push(o)}e.push(...i);for(const o of[...n]){var s;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Wp(s=this.ltsList).call(s,(c,d)=>c-d))}return t||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&n.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>c=>{V("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),b.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Nn.networkState===Is.OFFLINE&&await Te.race([Nn.onlineWaiter,ci(2*jn.maxRetryTimeout)]);const t=s=>{let o=new Uint8Array;return s.forEach(c=>{const d=nR(JSON.stringify(c.data)),p=new ArrayBuffer(5),f=(g=>{let v=0;return Object.entries(sn).forEach(y=>{let[D,A]=y;A===g.type&&(v=h7[D])}),v})(c),m=new DataView(p);m.setUint16(0,d.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),o=h1(o,new Uint8Array(p)),o=h1(o,d)}),o},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await lR(i,{timeout:1e4,data:t(e),headers:st(st({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(s===1)throw o;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(d=>{const p=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return p&&p.info.vid&&+p.info.vid||0})(e[0]),i=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(d=>JSON.stringify(d)),vid:n,aid:i};Nn.networkState===Is.OFFLINE&&await Te.race([Nn.onlineWaiter,ci(2*jn.maxRetryTimeout)]);const o=t?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(o));for(let d=0;d<2;d+=1){d===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(o)));try{t?await X9(c,{timeout:1e4,data:s}):await lR(c,{timeout:1e4,data:s})}catch(p){if(d===1)throw p;continue}return}}createBaseInfo(e,t){const n=Object.assign({},u7);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:fn.TRACER}).onSuccess()}};U1.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Nn.networkState,xe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:fn.TRACER}).onSuccess("logUploadError")});class Q extends re{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),mn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,b)}throw(){super.throw(b)}}const li={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function gt(){return li}function B1(){return"setSinkId"in HTMLAudioElement.prototype&&(!V("RESTRICTION_SET_PLAYBACK_DEVICE")||(Pa()||e1())&&!ZC())}function G1(){return!li.supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&La()}let di=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Uu(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function mt(e,t,n,i,s){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:s}}function xr(e,t,n,i,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:s}}function TR(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const p7={"90p":mt(160,90),"90p_1":mt(160,90),"120p":mt(160,120,15,30,65),"120p_1":mt(160,120,15,30,65),"120p_3":mt(120,120,15,30,50),"120p_4":mt(212,120),"180p":mt(320,180,15,30,140),"180p_1":mt(320,180,15,30,140),"180p_3":mt(180,180,15,30,100),"180p_4":mt(240,180,15,30,120),"240p":mt(320,240,15,40,200),"240p_1":mt(320,240,15,40,200),"240p_3":mt(240,240,15,40,140),"240p_4":mt(424,240,15,40,220),"360p":mt(640,360,15,80,400),"360p_1":mt(640,360,15,80,400),"360p_3":mt(360,360,15,80,260),"360p_4":mt(640,360,30,80,600),"360p_6":mt(360,360,30,80,400),"360p_7":mt(480,360,15,80,320),"360p_8":mt(480,360,30,80,490),"360p_9":mt(640,360,15,80,800),"360p_10":mt(640,360,24,80,800),"360p_11":mt(640,360,24,80,1e3),"480p":mt(640,480,15,100,500),"480p_1":mt(640,480,15,100,500),"480p_2":mt(640,480,30,100,1e3),"480p_3":mt(480,480,15,100,400),"480p_4":mt(640,480,30,100,750),"480p_6":mt(480,480,30,100,600),"480p_8":mt(848,480,15,100,610),"480p_9":mt(848,480,30,100,930),"480p_10":mt(640,480,10,100,400),"720p":mt(1280,720,15,120,1130),"720p_auto":mt(1280,720,30,900,3e3),"720p_1":mt(1280,720,15,120,1130),"720p_2":mt(1280,720,30,120,2e3),"720p_3":mt(1280,720,30,120,1710),"720p_5":mt(960,720,15,120,910),"720p_6":mt(960,720,30,120,1380),"1080p":mt(1920,1080,15,120,2080),"1080p_1":mt(1920,1080,15,120,2080),"1080p_2":mt(1920,1080,30,120,3e3),"1080p_3":mt(1920,1080,30,120,3150),"1080p_5":mt(1920,1080,60,120,4780),"1440p":mt(2560,1440,30,120,4850),"1440p_1":mt(2560,1440,30,120,4850),"1440p_2":mt(2560,1440,60,120,7350),"4k":mt(3840,2160,30,120,8910),"4k_1":mt(3840,2160,30,120,8910),"4k_3":mt(3840,2160,60,120,13500)},f7={"480p":xr(640,480,5),"480p_1":xr(640,480,5),"480p_2":xr(640,480,30),"480p_3":xr(640,480,15),"720p":xr(1280,720,5),"720p_auto":mt(1280,720,30,900,3e3),"720p_1":xr(1280,720,5),"720p_2":xr(1280,720,30),"720p_3":xr(1280,720,15),"1080p":xr(1920,1080,5),"1080p_1":xr(1920,1080,5),"1080p_2":xr(1920,1080,30),"1080p_3":xr(1920,1080,15)},m7={"1SL1TL":TR(1,1),"3SL3TL":TR(3,3),"2SL3TL":TR(2,3)};function Wo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},p7[e]):e}function yR(e){return typeof e=="string"?Object.assign({},f7[e]):e}function pg(e){return typeof e=="string"?Object.assign({},m7[e]):e}const _7={speech_low_quality:Uu(16e3,!1),speech_standard:Uu(32e3,!1,18),music_standard:Uu(48e3,!1),standard_stereo:Uu(48e3,!0,56),high_quality:Uu(48e3,!1,128),high_quality_stereo:Uu(48e3,!0,192)};function fg(e){return typeof e=="string"?Object.assign({},_7[e]):e}const Vu=[];function H1(e){return Wn(e,"mediaSource",["screen","window","application"]),!0}let Ne=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),qt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Fu=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),E7=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),g7=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Gl=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Bu=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Gu=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Hu=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Gs=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const bR={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},CR={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},W1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},v7={uplinkNetworkQuality:0,downlinkNetworkQuality:0},K1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Wi=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Hs=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),hf=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Hl=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),xi=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Ko=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const RR={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let mg=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function _t(e,t,n,i,s){var o,c,d={};return Object.keys(i).forEach(function(p){d[p]=i[p]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=ks(o=l_(c=n.slice()).call(c)).call(o,function(p,f){return f(e,t,p)||p},d),s&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(s):void 0,d.initializer=void 0),d.initializer===void 0?(Object.defineProperty(e,t,d),null):d}function X(e,t,n){return(t=function(i){var s=function(o){if(typeof o!="object"||!o)return o;var c=o[Symbol.toPrimitive];if(c!==void 0){var d=c.call(o,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(i);return typeof s=="symbol"?s:s+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function rn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z1(Object(n),!0).forEach(function(i){X(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z1(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Y1 extends dn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Gl.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),X(this,"trackMediaType",void 0),X(this,"_ID",void 0),X(this,"_rtpTransceiver",void 0),X(this,"_lowRtpTransceiver",void 0),X(this,"_hints",[]),X(this,"_isClosed",!1),X(this,"_originMediaStreamTrack",void 0),X(this,"mediaStreamTrack",void 0),X(this,"_external",{}),this._ID=n||Yt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){ve(Vu).call(Vu,i)||Vu.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Lc(()=>{var n;xe.reportApiInvoke(null,{name:Mn.GET_MEDIA_STREAM_TRACK,options:[],tag:fn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Fu.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Vu.indexOf(t);n!==-1&&Vu.splice(n,1)}(this),this.emit(Bu.CLOSED),this.removeAllListeners(Gl.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Fu.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Gl.TRANSCEIVER_UPDATED,t,n)}}class Wu extends Y1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),X(this,"_enabled",!0),X(this,"_muted",!1),X(this,"_isExternalTrack",!1),X(this,"_isClosed",!1),X(this,"_enabledMutex",void 0),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new vi("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,b.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ne.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Ne.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bu.TRACK_ENDED)}stateCheck(t,n){if(b.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),xa(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new re(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",b);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new re(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",b)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Te.resolve([])}}const q1=window.AudioContext||window.webkitAudioContext;let Ws=null;const kt=new class extends dn{constructor(){super(...arguments),X(this,"prevState",void 0),X(this,"curState",void 0),X(this,"currentTime",void 0),X(this,"currentTimeStuckAt",void 0),X(this,"interruptDetectorTrack",void 0),X(this,"onLocalAudioTrackMute",()=>{b.info("ios15-interruption-start"),this.emit(di.IOS_15_16_INTERRUPTION_START)}),X(this,"onLocalAudioTrackUnmute",async()=>{b.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?b.info("ios15-interruption-end-canceled"):(Ws&&await Ws.suspend(),this.emit(di.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){b.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){b.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ku(){if(!Ws){if(function(){if(!q1)return void b.error("your browser is not support web audio");b.info("create audio context");const e=rn({},V("WEBAUDIO_INIT_OPTIONS"));b.debug("audio context init option:",JSON.stringify(e)),Ws=new q1(e),kt.curState=Ws.state,Ws.onstatechange=()=>{kt.prevState=kt.curState,kt.curState=Ws?Ws.state:void 0;const{prevState:t,curState:n}=kt,i=n==="running",s=n==="interrupted",o=t==="running",c=t==="suspended",d=t==="interrupted",p=Et().osVersion;(Hi()||Pr())&&o&&s&&(b.info("ios".concat(p,"-interruption-start")),kt.emit(di.IOS_INTERRUPTION_START)),(Hi()||Pr())&&(c||d)&&i&&(b.info("ios".concat(p,"-interruption-end")),kt.emit(di.IOS_INTERRUPTION_END)),t!==n&&kt.emit(di.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Ws)===null||t===void 0?void 0:t.currentTime;kt.currentTime!==n?(kt.currentTimeStuckAt&&(b.debug("AudioContext current time resume at ".concat(n)),kt.currentTimeStuckAt=void 0),kt.currentTime=n):(n!==kt.currentTimeStuckAt&&(xe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:fn.TRACER}).onSuccess(),b.warning("AudioContext current time stuck at ".concat(n))),kt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,o=!1,c=!1;function d(A){t.state==="running"?p(!1):Hi()||Pr()?t.state==="suspended"&&(p(!0),A&&t.resume().then(f,f)):t.state!=="closed"&&(p(!0),A&&t.resume().then(f,f))}function p(A){if(s!==A){s=A;for(let I=0,k=n;I<k.length;I+=1){const M=k[I];A?window.addEventListener(M,m,{capture:!0,passive:!0}):window.removeEventListener(M,m,{capture:!0,passive:!0})}}}function f(){d(!1)}function m(){d(!0)}function g(A){if(!c)if(i.paused)if(A){let I;v(!1),c=!0;try{I=i.play(),I?I.then(y,y):(i.addEventListener("playing",y),i.addEventListener("abort",y),i.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(A){if(o!==A){o=A;for(let I=0,k=n;I<k.length;I++){const M=k[I];A?window.addEventListener(M,D,{capture:!0,passive:!0}):window.removeEventListener(M,D,{capture:!0,passive:!0})}}}function y(){i.removeEventListener("playing",y),i.removeEventListener("abort",y),i.removeEventListener("error",y),c=!1,g(!1)}function D(){g(!0)}if(Hi()){const A=t.createMediaStreamDestination(),I=document.createElement("div");I.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=I.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=A.stream,g(!0)}kt.on(di.STATE_CHANGE,function(){d(!0)}),d(!1)}(Ws)}(),!Ws)throw new re(L.NOT_SUPPORTED,"can not create audio context");return Ws}return Ws}function Wl(e){if(function(){if(wR!==null)return wR;const i=Ku(),s=i.createBufferSource(),o=i.createGain(),c=i.createGain();s.connect(o),s.connect(c),s.disconnect(o);let d=!1;try{s.disconnect(o)}catch{d=!0}return s.disconnect(),wR=d,d}())return;const t=e.connect,n=e.disconnect;e.connect=(i,s,o)=>{var c;return e._inputNodes||(e._inputNodes=[]),ve(c=e._inputNodes).call(c,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,s,o)):t.call(e,i,s)),e},e.disconnect=(i,s,o)=>{n.call(e),i?sg(e._inputNodes,i):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let wR=null;function AR(e,t){let n=!1;const i=1/t;if(V("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{n?window.clearInterval(s):e(performance.now()/1e3)},1e3*i)}else{const s=Ku();let o=s.createGain();o.gain.value=0,o.connect(s.destination);const c=()=>{if(n)return void(o=null);const d=s.createOscillator();d.onended=c,d.connect(o),d.start(0),d.stop(s.currentTime+i),e(s.currentTime)};c()}return()=>{n=!0}}class $1{constructor(){X(this,"context",void 0),X(this,"analyserNode",void 0),X(this,"sourceNode",void 0),this.context=Ku(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Hi()||Pr()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const n=ks(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{b.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class J1 extends dn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),X(this,"outputNode",void 0),X(this,"outputTrack",void 0),X(this,"isPlayed",!1),X(this,"sourceNode",void 0),X(this,"context",void 0),X(this,"audioBufferNode",void 0),X(this,"destNode",void 0),X(this,"audioOutputLevel",0),X(this,"volumeLevelAnalyser",void 0),X(this,"_processedNode",void 0),X(this,"playNode",void 0),X(this,"isDestroyed",!1),X(this,"onNoAudioInput",void 0),X(this,"isNoAudioInput",!1),X(this,"_noAudioInputCount",0),this.context=Ku(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Wl(this.outputNode),this.volumeLevelAnalyser=new $1}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Gs.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const o=i.outputBuffer.getChannelData(s);for(let c=0;c<o.length;c+=1)o[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!gt().webAudioMediaStreamDest)throw new re(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&rg(()=>{kt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Hi()||Pr()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let s=!1;for(let o=0;o<i.length;o++)i[o]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await ci(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class X1 extends J1{get isFreeze(){return!1}constructor(t,n,i){var s;if(super(),X(this,"sourceNode",void 0),X(this,"track",void 0),X(this,"clonedTrack",void 0),X(this,"audioElement",void 0),X(this,"isCurrentTrackCloned",!1),X(this,"isRemoteTrack",!1),X(this,"originVolumeLevelAnalyser",void 0),X(this,"rebuildWebAudio",async()=>{if(b.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void b.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>b.info("resume success")),b.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),Wl(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Wl(this.outputNode),this.emit(Gs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new re(L.UNEXPECTED_ERROR);this.track=t;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(o),Wl(this.sourceNode),i){const d=i.clone();d.enabled=!0,this.clonedTrack=d,b.debug("create an unmuted track ".concat(d.id," from the original track ").concat(i.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([d]));Wl(p),this.originVolumeLevelAnalyser=new $1,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const c=Et();n&&c.os===Kn.IOS&&Number((s=c.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(kt.on(di.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Wl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Gs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),kt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),b.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Wl(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Q1(e,t,n){const i=(o,c)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||c:o:c,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function S7(e,t){const n=await Z1(e.mediaSource),{sourceId:i,audio:s}=await function(o){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Te((d,p)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(k);const M=new Error("NotAllowedError");M.name="NotAllowedError",p(M)};let A=c;const I=document.createElement("div");if(c){const M=document.createElement("input");M.setAttribute("type","checkbox");const H=document.createElement("span");M.setAttribute("style","margin-right: 6px;"),H.innerText="Share audio",M.checked=A,M.onchange=()=>{A=M.checked},I.appendChild(M),I.appendChild(H)}y.appendChild(I),y.appendChild(D),m.appendChild(g),m.appendChild(v),m.appendChild(y);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(f),k.appendChild(m),document.body.appendChild(k),o.map(M=>{if(M.id){const H=document.createElement("div");H.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=M.thumbnail;try{const{width:$}=J.getSize();$>1920&&(J=J.resize({width:1920}))}catch($){throw $&&$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),$}H.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+M.name.replace(/[\u00A0-\u9999<>\&]/g,function($){return"&#"+$.charCodeAt(0)+";"})+"</span>",H.onclick=()=>{document.body.removeChild(k),d({sourceId:M.id,audio:A})},v.appendChild(H)}})})}(n,t);return await Q1(i,e,s)}async function Z1(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=p1();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new re(L.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new Te((o,c)=>{n.desktopCapturer.getSources({types:t},(d,p)=>{d?c(d):o(p)})}));try{return await i}catch(o){throw new re(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const IR=new vi("safari");let eL=!1,tL=!1;async function Ks(e,t){let n=0,i=null;for(;n<2;)try{i=await T7(e,t,n>0);break}catch(s){if(s instanceof re)throw b.error("[".concat(t,"] ").concat(s.toString())),s;const o=_g(s.name||s.code||s,s.message);if(o.code===L.MEDIA_OPTION_INVALID){b.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await ci(500);continue}throw b.error("[".concat(t,"] ").concat(o.toString())),o}if(!i)throw new re(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function T7(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new re(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=gt(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return b.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(p1())e.screen.sourceId?zu(s,await Q1(e.screen.sourceId,e.screen,!!e.screenAudio)):zu(s,await S7(e.screen,!!e.screenAudio));else if(Pa()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new re(L.NOT_SUPPORTED,"This browser does not support screen sharing");b.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(c=e.screen.extensionId,d=t,new Te((y,D)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},A=>{if(!A||!A.streamId)return b.error("[".concat(d,"] No response from Chrome Plugin. Plugin not installed properly"),A),void D(new re(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(A.streamId)})}catch(A){b.error("[".concat(d,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),D(new re(L.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=v,zu(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var o;e.screen.mediaSource&&H1(e.screen.mediaSource);const v={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:I}=e.screen,k={selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:I};!y&&delete k.selfBrowserSurface,!D&&delete k.surfaceSwitching,!A&&delete k.systemAudio,!I&&delete k.preferCurrentTab,b.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:v,audio:e.screenAudio,controls:k})),zu(s,await navigator.mediaDevices.getDisplayMedia(rn({video:v,audio:e.screenAudio},k)))}else{if(!_n())throw b.error("[".concat(t,"] This browser does not support screenSharing")),new re(L.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&H1(e.screen.mediaSource);const v={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};b.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(v))),zu(s,await navigator.mediaDevices.getUserMedia(v))}}var c,d;if(!e.video&&!e.audio)return s;let p={video:e.video,audio:e.audio},f=V("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),p=rR(p,f)}catch{}b.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(p)),Et();let m,g=null;(hi()||Hi()||ng())&&(g=await IR.lock());try{m=await navigator.mediaDevices.getUserMedia(p)}catch(v){throw g&&g(),v}return p.audio&&(eL=!0),p.video&&(tL=!0),zu(s,m),g&&g(),s}function _g(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new re(L.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new re(L.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new re(L.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new re(L.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new re(L.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new re(L.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return b.error("getUserMedia unexpected error",e),new re(L.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function zu(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const zs=new class extends dn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Hl.STATE_CHANGE,e),this._state=e)}constructor(){super(),X(this,"_state",hf.IDLE),X(this,"isAccessMicrophonePermission",!1),X(this,"isAccessCameraPermission",!1),X(this,"lastAccessMicrophonePermission",!1),X(this,"lastAccessCameraPermission",!1),X(this,"checkdeviceMatched",!1),X(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(ig()||tg()===Kn.HARMONY_OS)&&La())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>b.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new re(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let o=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;s.audio&&(o=!1),s.video&&(c=!1);let d=null,p=null,f=null;if(!n&&(o||c)){if(IR.isLocked&&(b.debug("[device manager] wait GUM lock"),(await IR.lock())(),b.debug("[device manager] GUM unlock")),eL&&(o=!1,this.isAccessMicrophonePermission=!0),tL&&(c=!1,this.isAccessCameraPermission=!0),b.debug("[device manager] check media device permissions",e,t,o,c),o&&c){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const g=_g(m.name||m.code||m,m.message);if(g.code===L.PERMISSION_DENIED)throw g;b.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{d=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const g=_g(m.name||m.code||m,m.message);if(g.code===L.PERMISSION_DENIED)throw g;b.warning("getUserMedia failed in getDevices",g)}this.isAccessMicrophonePermission=!0}else if(c){try{p=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const g=_g(m.name||m.code||m,m.message);if(g.code===L.PERMISSION_DENIED)throw g;b.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0}b.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return d&&d.getTracks().forEach(g=>g.stop()),p&&p.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),d=null,p=null,f=null,m}catch(m){return d&&d.getTracks().forEach(g=>g.stop()),p&&p.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),d=null,p=null,f=null,new re(L.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new re(L.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=hf.INITING;try{await this.updateDevicesInfo(),this.state=hf.INITEND}catch(e){throw b.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=hf.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new re(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),o=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");s&&o?o.groupId===s.groupId?b.debug("[device-check] default input ".concat(s.label," and output ").concat(o.label," is the same group")):b.debug("[device-check] default input ".concat(s.label," and output ").concat(o.label," is not the same group")):b.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;const o=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),c),n.push(c)}o&&(o.updateAt=t)}),this.deviceInfoMap.forEach((s,o)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",n.push(s))}),this.state!==hf.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Hl.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Hl.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Hl.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(s=>s.kind==="audioinput"),n=e.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){i.video=!0;break}return i}};let OR=!1;const Ys=new class extends dn{constructor(){super(...arguments),X(this,"onAutoplayFailed",void 0),X(this,"onAudioAutoplayFailed",void 0)}};function nL(){if(Et(),!OR){const e=t=>{t.preventDefault(),OR=!1,nf()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};OR=!0,nf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),b.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ys.onAutoplayFailed?Ys.onAutoplayFailed():Ys.onAudioAutoplayFailed?b.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):b.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ys.emit("autoplay-failed")}}function iL(e,t,n,i){if(!e)return;const s=xe.getBaseInfoBySessionId(e);if(!s)return;const o=s.info,c=Date.now(),d=rn(rn({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:c,elapse:c-s.startTime,cbRegistered:Ys.onAutoplayFailed||Ys.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});xe.send({type:sn.AUTOPLAY_FAILED,data:d},!0)}const y7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],es=new class{constructor(){X(this,"onAutoplayFailed",void 0),X(this,"elementMap",new Map),X(this,"elementStateMap",new Map),X(this,"elementsNeedToResume",[]),X(this,"sinkIdMap",new Map),X(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const s=this.elementStateMap.get(n),o=i.srcObject.getAudioTracks()[0],c=o&&o.readyState;if(b.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return i.pause(),void i.play();if(kt.curState==="running")return Lu()?(i.pause(),void i.play()):void(s&&s==="paused"&&i.play())}})}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(b.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),kt.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),kt.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),kt.on(di.STATE_CHANGE,()=>{Hi()&&kt.prevState==="suspended"&&kt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new re(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,xi.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{s.setSinkId(o).catch(d=>{b.warning("[".concat(t,"] set sink id failed"),d.toString())})}catch(d){b.warning("[".concat(t,"] set sink id failed"),d.toString())}const c=s.play();c&&c.then&&c.catch(d=>{i&&iL(i,"audio",d.message,t),b.warning("audio element play warning",d.toString()),this.elementMap.has(t)&&d.name==="NotAllowedError"&&(b.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),rg(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),nL()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){y7.forEach(n=>{t.addEventListener(n,i=>{const s=this.elementStateMap.get(e),o=i.type==="pause"?"paused":i.type;if(b.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(o)),i.type==="error"){const c=t==null?void 0:t.error;c&&b.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{b.debug("Auto resume audio element success")}).catch(n=>{b.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Te(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{nf()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Cn(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new re(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",b);for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];const d=i.apply(this,o);return d instanceof Te?new Te((p,f)=>{d.then(p).catch(f)}):d}),n}}class sL extends dn{constructor(t){super(),X(this,"name","VideoProcessorDestination"),X(this,"ID","0"),X(this,"_source",void 0),X(this,"videoContext",void 0),X(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new re(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new re(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Wi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Wi.ON_TRACK,void 0)}}class rL extends dn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"usageRegistry",[]),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await fi(this,Hs.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),zt(this,Hs.REQUEST_UPDATE_CONSTRAINTS,Array.from(js(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return b.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),zt(this,Hs.REQUEST_UPDATE_CONSTRAINTS,Array.from(js(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:o}of this.statsRegistry)try{const c=o();t.push({processorID:n,processorName:i,type:s,stats:c})}catch(c){b.error(new re(L.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Te&&(i=await i),t.push(rn(rn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class oL extends dn{constructor(t){super(),X(this,"name","AudioProcessorDestination"),X(this,"ID","0"),X(this,"inputTrack",void 0),X(this,"inputNode",void 0),X(this,"audioProcessorContext",void 0),X(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new re(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new re(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Wi.ON_TRACK,void 0),this.emit(Wi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Wi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Wi.ON_NODE,this.inputNode))}}class aL extends dn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"audioContext",void 0),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"usageRegistry",[]),X(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return fi(this,Hs.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return b.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),zt(this,Hs.REQUEST_UPDATE_CONSTRAINTS,Array.from(js(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),zt(this,Hs.REQUEST_UPDATE_CONSTRAINTS,Array.from(js(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:o}of this.statsRegistry)try{const c=o();t.push({processorID:n,processorName:i,type:s,stats:c})}catch(c){b.error(new re(L.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Te&&(i=await i),t.push(rn(rn({},i),{},{direction:this.direction}))}catch(i){b.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class NR extends dn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),X(this,"context",void 0),X(this,"processSourceNode",void 0),X(this,"outputTrack",void 0),X(this,"processedNode",void 0),X(this,"clonedTrack",void 0),X(this,"outputNode",void 0),this.outputNode=new b7}setVolume(){}createOutputTrack(){throw new re(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class b7{disconnect(){}connect(){}}function cL(e){return new Te((t,n)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const o=Hi()?"canplay":"playing";s.addEventListener(o,()=>{const c=s.videoWidth,d=s.videoHeight;!c&&_n()||(i=!0,s.srcObject=null,s.remove(),t([c,d]))}),s.srcObject=new MediaStream([e]),s.play().catch(og),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function Eg(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Wo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!c1()&&n.frameRate&&(t.frameRate=n.frameRate),e1()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),_n()&&(t.frameRate={ideal:30,max:30}),t}function lL(e){const t={};return c1()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Pa()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function dL(e){const t=lL(e);if(e.encoderConfig){const n=fg(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),ig()&&(t.sampleRate=void 0),t}const C7=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:s}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:c=i,height:d=s}=t;if(!o||!c||!d)return;c=oR(c),d=oR(d),o=oR(o);const{max:p,min:f}=function(y,D,A){const I=200*Math.pow(A/15,.6)*Math.pow(y*D/640/360,.75);return{min:Math.floor(I),max:Math.floor(4*I)}}(c,d,o),{bitrateMax:m,bitrateMin:g}=t||{};m||b.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(d,", fps: ").concat(o,"] => [brMax: ").concat(m,", brMin: ").concat(g,"]"));const{maxFramerate:v}=V("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(o=Math.min(o,v)),{frameRate:o,bitrateMax:m||p,bitrateMin:g||f,scaleResolutionDownBy:1,scale:0}},uL=async(e,t,n)=>await(async(i,s,o)=>{const c=function(f){const m=[];for(let g=0;g<f.length;g+=2)m.push(parseInt(f.slice(g,g+2),16));return Uint8Array.from(m)}(C1(""+s+o)).slice(0,16),d=c.slice(0,12),p=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},p,i))})(e.buffer,t,n),DR=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Te((n,i)=>{t.toBlob(async s=>{if(t.remove(),s){const o=await hL(s);n({buffer:o,width:t.width,height:t.height})}else i(new re(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},hL=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var pL,fL,mL,_L,EL,gL,vL,SL,TL,yL,bL,CL,RL,wL,AL,IL,OL,NL,hn,DL,PL,LL,xL,kL,ML,zo,jL,UL,VL,FL,BL,GL,HL,WL,KL,zL,YL,qL,$L,_i;let gn=(pL=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),fL=He({argsMap:(e,t)=>[e.getTrackId(),t]}),mL=Cn(),_L=Mu("LocalAudioTrack","_enabledMutex"),EL=He({argsMap:(e,t)=>[e.getTrackId(),t]}),gL=Cn(),vL=Mu("LocalAudioTrack","_enabledMutex"),SL=He({argsMap:(e,t)=>[e.getTrackId(),t]}),TL=Cn(),yL=Cn(),bL=Cn(),CL=He({argsMap:e=>[e.getTrackId()]}),RL=Cn(),wL=He({argsMap:e=>[e.getTrackId()]}),AL=Cn(),IL=He({argsMap:e=>[e.getTrackId()]}),OL=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),NL=He({argsMap:e=>[e.getTrackId()]}),_t((hn=class extends Wu{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?es.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),X(this,"trackMediaType",Hu.AUDIO),X(this,"_encoderConfig",void 0),X(this,"_trackSource",void 0),X(this,"metadata",[]),X(this,"_enabled",!0),X(this,"_volume",100),X(this,"_useAudioElement",!0),X(this,"_bypassWebAudio",!1),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_processorDestination",void 0),X(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new NR,V("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),hi()&&!Ws?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Ut(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&es.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void b.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,zt(this,Ne.NEED_REPLACE_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!B1())throw new re(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await es.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await zt(this,Ne.NEED_ENABLE_TRACK,this),b.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await zt(this,Ne.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await zt(this,Ne.NEED_MUTE_TRACK,this):await zt(this,Ne.NEED_UNMUTE_TRACK,this))}getStats(){return Lc(()=>{b.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Vs(this,Ne.GET_STATS)||rn({},bR)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Gs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Gs.ON_AUDIO_BUFFER),this._source.on(Gs.ON_AUDIO_BUFFER,n=>e(n))}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] start audio playback in element")),es.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?es.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&es.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Ne.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Te.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new re(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new re(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Wi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await zt(this,Ne.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Ne.NEED_REPLACE_TRACK,this))}),e.on(Wi.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Wi.ON_TRACK),e.removeAllListeners(Wi.ON_NODE)}bindProcessorContextEvents(e){e.on(Hs.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Hs.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof NR&&(this._trackSource=new X1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new aL(this._source.context,this.getTrackId(),"local"),t=new oL(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Gs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(es.stop(this.getTrackId()),this._source.play()),zt(this,Ne.NEED_REPLACE_MIXING_TRACK,this).then(()=>{b.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{b.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[pL],Object.getOwnPropertyDescriptor(hn.prototype,"setVolume"),hn.prototype),_t(hn.prototype,"setPlaybackDevice",[fL,mL],Object.getOwnPropertyDescriptor(hn.prototype,"setPlaybackDevice"),hn.prototype),_t(hn.prototype,"setEnabled",[_L,EL,gL],Object.getOwnPropertyDescriptor(hn.prototype,"setEnabled"),hn.prototype),_t(hn.prototype,"setMuted",[vL,SL,TL],Object.getOwnPropertyDescriptor(hn.prototype,"setMuted"),hn.prototype),_t(hn.prototype,"getStats",[yL],Object.getOwnPropertyDescriptor(hn.prototype,"getStats"),hn.prototype),_t(hn.prototype,"setAudioFrameCallback",[bL],Object.getOwnPropertyDescriptor(hn.prototype,"setAudioFrameCallback"),hn.prototype),_t(hn.prototype,"play",[CL,RL],Object.getOwnPropertyDescriptor(hn.prototype,"play"),hn.prototype),_t(hn.prototype,"stop",[wL,AL],Object.getOwnPropertyDescriptor(hn.prototype,"stop"),hn.prototype),_t(hn.prototype,"close",[IL],Object.getOwnPropertyDescriptor(hn.prototype,"close"),hn.prototype),_t(hn.prototype,"pipe",[OL],Object.getOwnPropertyDescriptor(hn.prototype,"pipe"),hn.prototype),_t(hn.prototype,"unpipe",[NL],Object.getOwnPropertyDescriptor(hn.prototype,"unpipe"),hn.prototype),hn),gg=(DL=He({argsMap:(e,t)=>[e.getTrackId(),t]}),PL=Cn(),LL=Mu("MicrophoneAudioTrack","_enabledMutex"),xL=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),kL=Cn(),ML=He({argsMap:e=>[e.getTrackId()]}),_t((zo=class extends gn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?fg(t.encoderConfig):{},i,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),X(this,"_config",void 0),X(this,"_deviceName","default"),X(this,"_constraints",void 0),X(this,"_originalConstraints",void 0),X(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Lu()||QC())&&kt.bindInterruptDetectorTrack(this)}async setDevice(e){if(b.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await zs.getDeviceById(e),n={};n.audio=rn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Ks(n,this.getTrackId())}catch(s){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Ks({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await zs.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}b.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return b.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),e),V("AUTO_RESET_AUDIO_ROUTE")&&(Hi()||Pr())){const c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await zt(this,Ne.NEED_DISABLE_TRACK,this)}catch(c){throw b.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const s=rn({},this._constraints),o=zs.searchDeviceIdByName(this._deviceName);o&&!s.deviceId&&(s.deviceId=o);try{n||(this._enabled=!0);const c=await Ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await zt(this,Ne.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),b.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}b.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Lu()||QC())&&kt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Hi()||Pr())&&this._enabled&&!this._isClosed&&kt.duringInterruption){const e=async()=>{kt.off(di.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};kt.on(di.IOS_INTERRUPTION_END,e)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bu.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=zs.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Ks({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Hs.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){i(s)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Hs.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[DL,PL],Object.getOwnPropertyDescriptor(zo.prototype,"setDevice"),zo.prototype),_t(zo.prototype,"setEnabled",[LL,xL,kL],Object.getOwnPropertyDescriptor(zo.prototype,"setEnabled"),zo.prototype),_t(zo.prototype,"close",[ML],Object.getOwnPropertyDescriptor(zo.prototype,"close"),zo.prototype),zo),R7=(jL=He({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),UL=Cn(),VL=He({argsMap:e=>[e.getTrackId()]}),FL=Cn(),BL=He({argsMap:e=>[e.getTrackId()]}),GL=Cn(),HL=He({argsMap:e=>[e.getTrackId()]}),WL=Cn(),KL=He({argsMap:e=>[e.getTrackId()]}),zL=Cn(),YL=He({argsMap:e=>[e.getTrackId()]}),qL=He({argsMap:e=>[e.getTrackId()]}),$L=Cn(),_t((_i=class extends gn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),X(this,"source",void 0),X(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Gs.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit(Bu.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Ut(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[jL,UL],Object.getOwnPropertyDescriptor(_i.prototype,"startProcessAudioBuffer"),_i.prototype),_t(_i.prototype,"pauseProcessAudioBuffer",[VL,FL],Object.getOwnPropertyDescriptor(_i.prototype,"pauseProcessAudioBuffer"),_i.prototype),_t(_i.prototype,"seekAudioBuffer",[BL,GL],Object.getOwnPropertyDescriptor(_i.prototype,"seekAudioBuffer"),_i.prototype),_t(_i.prototype,"resumeProcessAudioBuffer",[HL,WL],Object.getOwnPropertyDescriptor(_i.prototype,"resumeProcessAudioBuffer"),_i.prototype),_t(_i.prototype,"stopProcessAudioBuffer",[KL,zL],Object.getOwnPropertyDescriptor(_i.prototype,"stopProcessAudioBuffer"),_i.prototype),_t(_i.prototype,"close",[YL],Object.getOwnPropertyDescriptor(_i.prototype,"close"),_i.prototype),_t(_i.prototype,"setAudioBufferPlaybackSpeed",[qL,$L],Object.getOwnPropertyDescriptor(_i.prototype,"setAudioBufferPlaybackSpeed"),_i.prototype),_i);class Bn extends gn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Ku().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Yt(8,"track-mix-")),X(this,"trackList",void 0),X(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(b.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):b.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){b.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}sg(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Bn?n.emit(Gl.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class w7 extends J1{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Gs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),X(this,"audioBuffer",void 0),X(this,"sourceNode",void 0),X(this,"startPlayTime",0),X(this,"startPlayOffset",0),X(this,"pausePlayTime",0),X(this,"options",void 0),X(this,"currentLoopCount",0),X(this,"currentPlaybackSpeed",100),X(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):b.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const JL=new Map;class PR{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(b.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){X(this,"trackId",void 0),X(this,"config",void 0),X(this,"onFirstVideoFrameDecoded",void 0),X(this,"onVideoStateChanged",void 0),X(this,"freezeTimeCounterList",[]),X(this,"renderFreezeAccTime",0),X(this,"isKeepLastFrame",!1),X(this,"timeUpdatedCount",0),X(this,"freezeTime",0),X(this,"playbackTime",0),X(this,"lastTimeUpdatedTime",0),X(this,"autoplayFailed",!1),X(this,"videoTrack",void 0),X(this,"videoElement",void 0),X(this,"cacheVideoElement",void 0),X(this,"renderStats",void 0),X(this,"_videoState",Ko.VideoStateStopped),X(this,"videoElementCheckInterval",void 0),X(this,"videoElementFreezeTimeout",void 0),X(this,"_videoElementStatus",xi.NONE),X(this,"isGettingVideoDimensions",!1),X(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return b.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),X(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&kt.curState==="running"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ZP())),o1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),X(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=xi.PLAYING;break;case"loadeddata":if(this.videoState=Ko.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=xi.CANPLAY;break;case"stalled":this.videoElementStatus=xi.STALLED;break;case"suspend":this.videoElementStatus=xi.SUSPEND;break;case"pause":this.videoElementStatus=xi.PAUSED,Hi()||Pr()||hi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=xi.WAITING;break;case"abort":this.videoElementStatus=xi.ABORT;break;case"ended":this.videoElementStatus=xi.ENDED;break;case"emptied":this.videoElementStatus=xi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=xi.ERROR,b.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ma.lastVisibleTime<Ma.lastHiddenTime||o<Ma.lastHiddenTime||o<Ma.lastVisibleTime)return;for(s>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(b.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ZP())),o1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),kt.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),kt.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(s=>{t&&iL(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(b.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):b.warning("[".concat(this.trackId,"] play warning: "),s)});const i=Et();if((i.name==="Safari"&&Number(i.version)===15||Lu())&&n&&n.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return b.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new Te((o,c)=>{i.toBlob(async d=>{if(i.remove(),d){const p=await hL(d);o({buffer:p,width:i.width,height:i.height})}else c(new re(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await DR(t)}destroy(){this.renderStats=void 0,kt.off(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),kt.off(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ko.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=xi.INIT,!this.videoElementCheckInterval&&(XL.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=xi.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let o;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(d,V("VIDEO_FREEZE_DURATION")))},d=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ko.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ko.VideoStateFrozen:document.addEventListener("visibilitychange",c))},p=(f,m)=>{if(this.videoElementStatus===xi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=m.mediaTime):this.renderStats={lastTs:m.mediaTime,curTs:m.mediaTime,lastRenderNum:0,renderNum:0},o){const y=m.presentationTime-o.presentationTime;this.videoState===Ko.VideoStateStarting&&(this.videoState=Ko.VideoStateDecoding),this.videoState===Ko.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(d,V("VIDEO_FREEZE_DURATION"))),y<V("VIDEO_FREEZE_DURATION")&&this.videoState===Ko.VideoStateFrozen&&(this.videoState=Ko.VideoStateDecoding),y>V("VIDEO_FREEZE_DURATION")&&Ma.lastVisibleTime>=Ma.lastHiddenTime&&o.timestamp>Ma.lastVisibleTime&&o.timestamp>Ma.lastHiddenTime&&(this.renderFreezeAccTime+=y)}o=rn(rn({},m),{},{timestamp:f})}var g,v;V("ENABLE_VIDEO_FRAME_CALLBACK")&&((g=(v=this.videoElement).requestVideoFrameCallback)===null||g===void 0||g.call(v,p))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,p)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),ig()&&!V("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Et();i.name==="Safari"&&Number(i.version)===15||Lu()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_n()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_n()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(o=>{b.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){XL.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=xi.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{b.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{b.error(i)}),this.autoplayFailed=!1,nf()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};nf()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),nL()}}const XL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class QL extends PR{constructor(t){super(t),X(this,"container",void 0),X(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await DR(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var ZL,ex,tx,nx,ix,sx,rx,ox,ax,cx,lx,dx,ux,hx,px,fx,mx,_x,Ex,gx,vx,Sx,Tx,yx,ht,bx,Cx,Rx,wx,Ax,Ix,Ox,Nx,qs;let tn=(ZL=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),ex=Cn(),tx=He({argsMap:e=>[e.getTrackId()]}),nx=Mu("LocalVideoTrack","_enabledMutex"),ix=He({argsMap:(e,t)=>[e.getTrackId(),t]}),sx=Cn(),rx=Mu("LocalVideoTrack","_enabledMutex"),ox=He({argsMap:(e,t)=>[e.getTrackId(),t]}),ax=Cn(),cx=He({argsMap:(e,t)=>[e.getTrackId(),t]}),lx=Cn(),dx=Cn(),ux=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),hx=Cn(),px=Cn(),fx=Cn(),mx=Cn(),_x=Cn(),Ex=Cn(),gx=Cn(),vx=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Sx=He({argsMap:e=>[e.getTrackId()]}),Tx=He({argsMap:e=>[e.getTrackId()]}),yx=He({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),ht=class jB extends Wu{get videoHeight(){if(hi()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(hi()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,s,o,c){if(super(t,o),X(this,"trackMediaType",Hu.VIDEO),X(this,"_player",void 0),X(this,"isUseScaleResolutionDownBy",!1),X(this,"_videoVisibleTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"_encoderConfig",void 0),X(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),X(this,"_optimizationMode",void 0),X(this,"_videoHeight",void 0),X(this,"_videoWidth",void 0),X(this,"_forceBitrateLimit",void 0),X(this,"_enabled",!0),X(this,"_processorDestination",void 0),X(this,"_processorContext",void 0),hi()){const{width:d,height:p}=t.getSettings();this._videoWidth=d,this._videoHeight=p}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=s,this._hints=c||[],this._hints.indexOf(qt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if($C(bt.CHROME,115)&&tg().indexOf("Windows")!==-1){const d=function(p,f){if("VideoFrame"in window&&"TransformStream"in window&&gt().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(p),g=new MediaStreamTrackGenerator({kind:"video"});let v,y,D=Date.now();const A=()=>{I&&(clearInterval(I),I=void 0),v&&(v.close(),v=void 0),p.stop(),y=void 0,g.removeEventListener("ended",A)};let I=window.setInterval(()=>{if(y&&v&&Date.now()-D>1e3)try{g.readyState==="live"?y.enqueue(v.clone()):A()}catch{A()}},1e3);const k=new TransformStream({transform:(M,H)=>{g.readyState==="live"?(y=H,D=Date.now(),v===void 0?(v=M,H.enqueue(M.clone())):(H.enqueue(v),v=M)):M.close()}});return g.addEventListener("ended",A),m.readable.pipeThrough(k).pipeTo(g.writable),g}}(t);d&&(b.info("local screen video track begin to inject frame"),this._mediaStreamTrack=d)}n&&this._hints.indexOf(qt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new rL(this.getTrackId(),"local"),this._processorDestination=new sL(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=rn(rn(rn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new PR(i):this._player=new QL(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Bu.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await zt(this,Ne.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await zt(this,Ne.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,b.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await zt(this,Ne.NEED_MUTE_TRACK,this):await zt(this,Ne.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Wo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=Eg({encoderConfig:t});(hi()||Hi()||Pr())&&(i.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new re(L.UNEXPECTED_ERROR,s.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(b)}}getStats(){return Lc(()=>{b.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Vs(this,Ne.GET_STATS)||rn({},CR)}async setBeautyEffect(t){b.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await DR(t)}async setBitrateLimit(t){b.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void b.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await zt(this,Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,b.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return b.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,b.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){cL(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(og)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new re(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");b.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Wo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(b)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:s,bitrateMin:o}=this._encoderConfig;if(o==null||s==null){const{max:c,min:d}=function(p,f,m,g,v){const y=V("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:g,max:v};if(v===void 0){var D;const I=Math.floor(200*Math.pow(m/15,.6)*Math.pow(p*f/640/360,.75));v=y==="STANDARD_BITRATE"?4*I:2*I,g=(D=g)!==null&&D!==void 0?D:I}else{var A;g=(A=g)!==null&&A!==void 0?A:Math.floor(v/10)}return{min:g,max:v}}(t,n,i,o,s);this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,b.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:o,slot:c}=s;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const d=u1.checkOneElementVisible(o),p=Object.assign({},d);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const f=xe.reportApiInvoke(null,{tag:fn.TRACER,name:Mn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(i){throw new re(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new re(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=rn(rn({},i),Wo(t))),i=Ul(i);const s=Yt(8,"track-video-cloned-"),o=new jB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Ul(this._scalabilityMode),this._optimizationMode,s,Ul(this._hints));return t&&i&&o.setEncoderConfiguration(i),b.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),o}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new re(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new re(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Lc(()=>{xe.reportApiInvoke(null,{name:Mn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:fn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!V("ENABLE_VIDEO_SEI")||!V("ENABLE_ENCODED_TRANSFORM"))return void b.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new re(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void b.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const s=i.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",t):b.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await zt(this,Ne.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zt(this,Ne.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hs.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hs.REQUEST_CONSTRAINTS)}},_t(ht.prototype,"play",[ZL,ex],Object.getOwnPropertyDescriptor(ht.prototype,"play"),ht.prototype),_t(ht.prototype,"stop",[tx],Object.getOwnPropertyDescriptor(ht.prototype,"stop"),ht.prototype),_t(ht.prototype,"setEnabled",[nx,ix,sx],Object.getOwnPropertyDescriptor(ht.prototype,"setEnabled"),ht.prototype),_t(ht.prototype,"setMuted",[rx,ox,ax],Object.getOwnPropertyDescriptor(ht.prototype,"setMuted"),ht.prototype),_t(ht.prototype,"setEncoderConfiguration",[cx,lx],Object.getOwnPropertyDescriptor(ht.prototype,"setEncoderConfiguration"),ht.prototype),_t(ht.prototype,"getStats",[dx],Object.getOwnPropertyDescriptor(ht.prototype,"getStats"),ht.prototype),_t(ht.prototype,"setBeautyEffect",[ux,hx],Object.getOwnPropertyDescriptor(ht.prototype,"setBeautyEffect"),ht.prototype),_t(ht.prototype,"getCurrentFrameData",[px],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameData"),ht.prototype),_t(ht.prototype,"getCurrentFrameImage",[fx],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameImage"),ht.prototype),_t(ht.prototype,"setBitrateLimit",[mx],Object.getOwnPropertyDescriptor(ht.prototype,"setBitrateLimit"),ht.prototype),_t(ht.prototype,"setOptimizationMode",[_x],Object.getOwnPropertyDescriptor(ht.prototype,"setOptimizationMode"),ht.prototype),_t(ht.prototype,"setScalabiltyMode",[Ex],Object.getOwnPropertyDescriptor(ht.prototype,"setScalabiltyMode"),ht.prototype),_t(ht.prototype,"updateMediaStreamTrackResolution",[gx],Object.getOwnPropertyDescriptor(ht.prototype,"updateMediaStreamTrackResolution"),ht.prototype),_t(ht.prototype,"pipe",[vx],Object.getOwnPropertyDescriptor(ht.prototype,"pipe"),ht.prototype),_t(ht.prototype,"unpipe",[Sx],Object.getOwnPropertyDescriptor(ht.prototype,"unpipe"),ht.prototype),_t(ht.prototype,"close",[Tx],Object.getOwnPropertyDescriptor(ht.prototype,"close"),ht.prototype),_t(ht.prototype,"replaceTrack",[yx],Object.getOwnPropertyDescriptor(ht.prototype,"replaceTrack"),ht.prototype),ht),LR=(bx=He({argsMap:(e,t)=>[e.getTrackId(),t]}),Cx=Cn(),Rx=Mu("CameraVideoTrack","_enabledMutex"),wx=He({argsMap:(e,t)=>[e.getTrackId(),t]}),Ax=Cn(),Ix=He({argsMap:(e,t)=>[e.getTrackId(),t]}),Ox=Cn(),Nx=He({argsMap:e=>[e.getTrackId()]}),qs=class UB extends tn{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,s,o,c){super(t,Wo(n.encoderConfig),s,o,c),X(this,"_config",void 0),X(this,"_originalConstraints",void 0),X(this,"_constraints",void 0),X(this,"_enabled",!0),X(this,"_deviceName","default"),X(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Lu()||QC())&&!function(){const d=Et();if(d.os!==Kn.IOS||!d.osVersion)return!1;const p=d.osVersion.split(".");return Number(p[0])===15&&Number(p[1])>=2}()&&a1()&&this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Wo(this._config.encoderConfig),kt.on(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),kt.on(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(b.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await zs.getDeviceById(t),i={};i.video=rn({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Ks(i,this.getTrackId())}catch(o){throw b.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),s=await Ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await zs.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw b.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}b.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){b.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:rn(rn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ks(n,this.getTrackId())}catch(s){throw b.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await Ks({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=rn({},n.video),b.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(b.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ks({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await zt(this,Ne.NEED_ENABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),b.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await zt(this,Ne.NEED_DISABLE_TRACK,this)}catch(i){throw b.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}b.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new re(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Wo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=En(this._config);i.encoderConfig=t;const s=Eg(i);(hi()||Hi()||Pr())&&(s.deviceId=void 0),b.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(o){const c=new re(L.UNEXPECTED_ERROR,o.toString());throw b.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await zt(this,Ne.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(b)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Hi()||Pr())&&this._enabled&&!this._isClosed&&kt.duringInterruption){const t=async()=>{kt.off(di.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(b.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};kt.on(di.IOS_INTERRUPTION_END,t)}else b.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bu.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=zs.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const s=await Ks({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),kt.off(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),kt.off(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=rn(rn({},i),Wo(t))),i=Ul(i);const s=Yt(8,"track-cam-cloned-"),o=new UB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ul(rn(rn({},this._config),{},{encoderConfig:i})),Ul(this._constraints),Ul(this._scalabilityMode),this._optimizationMode,s);return t&&i&&o.setEncoderConfiguration(i),b.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(Hs.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){i(s)}}),this.processorContext.on(Hs.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},_t(qs.prototype,"setDevice",[bx,Cx],Object.getOwnPropertyDescriptor(qs.prototype,"setDevice"),qs.prototype),_t(qs.prototype,"setEnabled",[Rx,wx,Ax],Object.getOwnPropertyDescriptor(qs.prototype,"setEnabled"),qs.prototype),_t(qs.prototype,"setEncoderConfiguration",[Ix,Ox],Object.getOwnPropertyDescriptor(qs.prototype,"setEncoderConfiguration"),qs.prototype),_t(qs.prototype,"close",[Nx],Object.getOwnPropertyDescriptor(qs.prototype,"close"),qs.prototype),qs);function xR(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=rn(rn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?b.debug("[".concat(e,"] set content hint to"),n.optimizationMode):b.debug("[".concat(e,"] set content hint failed")))):b.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Dx,Px,Lx,xx,cr,kx,Mx,jx,Ux,Vx,Fx,ki;class Bx extends Y1{getUserId(){return this._userId}constructor(t,n,i,s){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(Yt(5,""))),X(this,"_userId",void 0),X(this,"_uintId",void 0),X(this,"_isDestroyed",!1),X(this,"store",void 0),X(this,"processor",void 0),X(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,b.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Yu=(Dx=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Px=He({argsMap:e=>[e.getTrackId()]}),Lx=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),xx=He({argsMap:e=>[e.getTrackId()]}),_t((cr=class extends Bx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),X(this,"_videoVisibleTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"trackMediaType",Hu.VIDEO),X(this,"_videoWidth",void 0),X(this,"_videoHeight",void 0),X(this,"_player",void 0),X(this,"processorDestination",void 0),X(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new rL(this.getTrackId(),"remote"),this.processorDestination=new sL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Lc(()=>{b.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Vs(this,Ne.GET_STATS)||rn({},K1)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(b.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}b.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=rn(rn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new PR(n):this._player=new QL(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Gu.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Gu.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Gu.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,b.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){cL(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(og)}_updatePlayerSource(){b.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=u1.checkOneElementVisible(s),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const p=xe.reportApiInvoke(null,{tag:fn.TRACER,name:Mn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new re(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new re(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Gl.SEI_RECEIVED,e)}}).prototype,"play",[Dx],Object.getOwnPropertyDescriptor(cr.prototype,"play"),cr.prototype),_t(cr.prototype,"stop",[Px],Object.getOwnPropertyDescriptor(cr.prototype,"stop"),cr.prototype),_t(cr.prototype,"pipe",[Lx],Object.getOwnPropertyDescriptor(cr.prototype,"pipe"),cr.prototype),_t(cr.prototype,"unpipe",[xx],Object.getOwnPropertyDescriptor(cr.prototype,"unpipe"),cr.prototype),cr),qu=(kx=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Mx=He({argsMap:(e,t)=>[e.getTrackId(),t]}),jx=He({argsMap:e=>[e.getTrackId()]}),Ux=He({argsMap:e=>[e.getTrackId()]}),Vx=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Fx=He({argsMap:e=>[e.getTrackId()]}),_t((ki=class extends Bx{get isPlaying(){return this._useAudioElement?es.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),X(this,"trackMediaType",Hu.AUDIO),X(this,"_source",void 0),X(this,"_useAudioElement",!0),X(this,"_volume",100),X(this,"processorContext",void 0),X(this,"processorDestination",void 0),X(this,"_played",!1),X(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new NR,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new X1(e,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Gs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Gu.FIRST_FRAME_DECODED)}),this.processorContext=new aL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new oL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Gs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Gs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Gs.ON_AUDIO_BUFFER),this._source.on(Gs.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?es.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!B1())throw new re(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await es.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Lc(()=>{b.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Vs(this,Ne.GET_STATS)||rn({},W1)}play(){b.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(b.debug("[".concat(this.getTrackId(),"] use audio element to play")),es.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){b.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?es.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];b.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&es.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new re(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new re(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new re(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Wi.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK),this.processorDestination.removeAllListeners(Wi.ON_NODE)}}).prototype,"setVolume",[kx],Object.getOwnPropertyDescriptor(ki.prototype,"setVolume"),ki.prototype),_t(ki.prototype,"setPlaybackDevice",[Mx],Object.getOwnPropertyDescriptor(ki.prototype,"setPlaybackDevice"),ki.prototype),_t(ki.prototype,"play",[jx],Object.getOwnPropertyDescriptor(ki.prototype,"play"),ki.prototype),_t(ki.prototype,"stop",[Ux],Object.getOwnPropertyDescriptor(ki.prototype,"stop"),ki.prototype),_t(ki.prototype,"pipe",[Vx],Object.getOwnPropertyDescriptor(ki.prototype,"pipe"),ki.prototype),_t(ki.prototype,"unpipe",[Fx],Object.getOwnPropertyDescriptor(ki.prototype,"unpipe"),ki.prototype),ki);const Ma=new class extends dn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),X(this,"_lastHiddenTime",0),X(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),b.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Gx extends dn{constructor(t,n){super(),X(this,"trackMediaType",Hu.DATA),X(this,"_version",1),X(this,"_type",3),X(this,"_config",void 0),X(this,"_originDataChannel",void 0),X(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),X(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),X(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return V("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Te((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var s;n(new re(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new re(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new re(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[mg.OPEN,mg.CLOSE,mg.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,s]=n;t.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class A7 extends Gx{constructor(t){super(t),X(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(i).getUint8(3);if(s!==this.id)return void(V("SHOW_DATASTREAM2_LOG")&&b.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(mg.MESSAGE,o)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class I7 extends Gx{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function vg(){const e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>vE.revokeObjectURL(e),0),new Worker(vE.createObjectURL(e))}var $u=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e}($u||{});function Hx(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==71)return;const i=e.getUint16(1),s=3+i,o=new Uint8Array(e.byteLength-s);o.set(new Uint8Array(e.buffer,s,e.byteLength-s));const c={m:n,tlvLen:i,tlv:[],frame:o};let d=3;for(;d<s;){const p=e.getUint8(d),f=e.getUint16(d+1),m=3;if(p===$u.AUDIO_LEVEL){let g=e.getUint8(d+m);for(let v=1;v<f;v++)g=g<<8|e.getUint8(d+m+v);c.tlv.push({tag:p,length:f,value:t?127^g>>1:127&g})}else if(p===$u.METADATA){const g=new Uint8Array(f);for(let v=0;v<f;v++)g[v]=e.getUint8(d+m+v);c.tlv.push({tag:p,length:f,value:g})}d+=m+f}return c}const Sg=new Map;async function O7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!gt().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(Sg.has(e)||!e.track)return;const n={track:e.track};if(Pa()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const p=t.metadata&&t.metadata();p?function(f,m){const{chunk:g,controller:v}=m;g.data=function(y,D,A){const I=A.byteLength,k=I+1+2,M=3+k,H=new ArrayBuffer(y.byteLength+M),J=new DataView(H);J.setUint8(0,71),J.setUint16(1,k),J.setUint8(3,D),J.setUint16(4,I);for(let z=0;z<I;z++)J.setUint8(6+z,A[z]);const $=new Uint8Array(J.buffer);return $.set(new Uint8Array(y),M),$.buffer}(g.data,$u.METADATA,f),v.enqueue(g)}(p,{sender:e,chunk:c,controller:d}):d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const s=vg(),o=new MessageChannel;await new Te(d=>s.onmessage=p=>{p.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(s,{name:"tx",port:o.port2},[o.port2]);e.transform=c,await new Te(d=>s.onmessage=p=>{p.data==="started"&&d(void 0)}),o.port1.onmessage=d=>{var p;d.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const s=Sg.get(e);if(s){Sg.delete(e);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){b.warning(d&&d.message)}}}Sg.set(e,n),e.track.addEventListener("ended",i)}const Tg=127,Kl=1e-10,kR=139/13,yg=new Map;function MR(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let s=0;return yg.has(i)?s=yg.get(i):(s=Math.log(function(c,d){const p=c-d;d<p&&(d=p);let f=1;for(let m=c,g=1;m>d;m--,g++)f=f*m/g;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,yg.set(i,s)),s<Kl&&(s=Kl),s}function Wx(e,t,n){const i=t.length,s=e.length/i;let o=!1;for(let c=0,d=0;c<i;c++){let p=0;for(let f=d+s;d<f;d++)e[d]>n&&p++;t[c]!==p&&(t[c]=p,o=!0)}return o}window.cache=yg;let N7=0;class Kx{constructor(t){X(this,"id",void 0),X(this,"immediates",[]),X(this,"lastNonSilence",-1),X(this,"immediateSpeechActivityScore",Kl),X(this,"lastLevelChangedTime",Date.now()),X(this,"levels",[]),X(this,"longs",[]),X(this,"longSpeechActivityScore",Kl),X(this,"mediums",[]),X(this,"mediumSpeechActivityScore",Kl),X(this,"minLevel",0),X(this,"nextMinLevel",0),X(this,"nextMinLevelWindowLength",0),X(this,"energyScore",0),this.id=t||"".concat(N7++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+kR;let s=!1;for(let o=0;o<t.length;++o){let c=n[o];c<i&&(c=0);const d=Math.floor(c/kR);t[o]!==d&&(t[o]=d,s=!0)}return s}computeLongs(){return Wx(this.mediums,this.longs,4)}computeMediums(){return Wx(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=MR(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=MR(this.longs[0],10,47),this.longSpeechActivityScore>Kl&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=MR(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(l_(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>Tg&&(i=Tg),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+kR?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>Tg&&(n=Tg),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class D7{constructor(t){X(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class jR{constructor(t,n,i){X(this,"isDominant",void 0),X(this,"energyRanking",void 0),X(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class P7 extends dn{constructor(t){super(),X(this,"dominantId",null),X(this,"lastDecisionTime",0),X(this,"lastLevelChangedTime",0),X(this,"lastLevelIdleTime",0),X(this,"relativeSpeechActivities",[]),X(this,"speakers",new Map),X(this,"enableSilence",!1),X(this,"timeoutToSilenceInterval",0),X(this,"decisionMaker",null),X(this,"loudest",[]),X(this,"numLoudestToTrack",3),X(this,"energyExpireTimeMs",250),X(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),s=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const o=s.levelChanged(n,i);return this.updateLoudestList(s,o,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new Kx(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const s=t.id===this.dominantId;if(n<0){let p=0;for(;p<this.loudest.length&&this.loudest[p]!==t;)++p;return new jR(s,p,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new jR(s,0,t.energyScore);const o=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const p=this.loudest[c];if(p.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(p.id!==t.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let d=0;for(;d<this.loudest.length&&!(this.loudest[d].energyScore<t.energyScore);)++d;return d<this.numLoudestToTrack&&(this.loudest.splice(d,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new jR(s,d,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new D7(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const s=this.speakers.size;let o=null;if(s===0)o=null;else if(s===1){var c;const d=js(c=this.speakers).call(c).next().value;this.enableSilence&&d&&(o=d.id,d.evaluateSpeechActivityScores(t),t-d.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let d=this.dominantId==null?null:this.speakers.get(this.dominantId);if(d==null){const m=this.speakers.entries().next();m.value&&(o=m.value[0],d=m.value[1])}else o=d.id;d!=null&&d.evaluateSpeechActivityScores(t);const p=this.relativeSpeechActivities;let f=2;for(const m of this.speakers.entries()){const[g,v]=m;if(v===d)continue;v.evaluateSpeechActivityScores(t);for(let I=0;I<p.length;++I){const k=d==null?Kl:d.getSpeechActivityScore(I);p[I]=Math.log(v.getSpeechActivityScore(I)/k)}const y=p[0],D=p[1],A=p[2];y>3&&D>2&&A>0&&D>f&&(f=D,o=g)}this.enableSilence&&d!=null&&o===d.id&&t-d.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(n=this.dominantId,this.dominantId=o,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let s=300-(t-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=t,this.makeDecision(t),s=300-(Date.now()-t)),s>0&&i>s&&(i=s),i}timeoutIdleLevels(t){const n=[];for(const s of js(i=this.speakers).call(i)){var i;const o=t-s.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||s.id!==this.dominantId)?n.push(s.id):300<o&&s.levelTimedOut()}n.forEach(s=>this.speakers.delete(s))}}const Ju=new Map;let fo=null,bg=null,zl=[];const L7=1e3/15,mo=new Map,Cg=new Map;class x7{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){X(this,"id",void 0),X(this,"track",void 0),X(this,"score",0),X(this,"active",!0),X(this,"muted",!1),X(this,"timer",0),X(this,"actives",0),X(this,"inactives",0),this.id=t,this.track=n,this.setActive(mo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const s=[],o=[];return Array.from(js(mo).call(mo)).forEach(c=>{c.active?s.push(c):o.push(c)}),{actives:s,inactives:o}}();if(n.length>3){let s;n.forEach(o=>{(!s||s.score>o.score)&&(s=o)}),s&&s.setActive(!1)}if(n.length<3&&i.length>0){let s;i.forEach(o=>{(!s||s.score<o.score)&&o.id!==this.id&&(s=o)}),s&&t&&!this.active&&(s.samples>40&&s.activeRate-this.activeRate>.4?s.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(js(mo).call(mo)).forEach(s=>{!s.active||s.id===n||s.samples<40||(!i||s.score<i.score)&&(i=s)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(js(mo).call(mo)).forEach(s=>{s.active||s.id===n||s.samples<40||(!i||s.score>i.score)&&(i=s)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>L7&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Rg;function zx(e){const t=mo.get(e);t&&(mo.delete(e),t.clearTimer())}const wg=new Map,k7=new Map;async function UR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!gt().supportWebRTCEncodedTransform)return void b.warning("browser not support audio encoded transform");if(wg.has(e))return;const n={track:e.track};if(Pa()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");$C(bt.CHROME,87,116)||(t.enableTopn=!1);let s=null;try{s=e.createEncodedStreams()}catch(c){return void b.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(p,f,m){var g;const v=Hx(new DataView(f.data));if(!v)return m.enqueue(f);const y=p.track.id;k7.set(y,p.track);const D=(g=v.tlv.find(J=>J.tag===$u.AUDIO_LEVEL))===null||g===void 0?void 0:g.value;let A=0;typeof D=="number"&&(A=127-D);const I=Math.round(Math.pow(10,A/60)-1),{selected:k,speaker:M}=function(J,$){let z=Ju.get(J);if(z||(z=function(oe){const de=new Kx;return Ju.set(oe,de),fo||(fo=new P7(V("TOPN_SILENCE_THRESHOLD")||500),fo.on("ActiveSpeakerChanged",be=>{be!=null&&(bg=be)})),fo.addSpeakers([de]),de}(J)),Ju.size<=3)return{selected:!0,speaker:z};if(!fo)throw new Error("no active speaker detector");return fo.levelChanged(z.id,$),zl=fo.loudest.map(oe=>oe.id),bg&&!ve(zl).call(zl,bg)&&zl.length>=3&&zl.pop(),{selected:ve(zl).call(zl,z.id)||z.id===bg,speaker:z}}(p,I),H=function(J,$,z){const oe=mo.get(J)||new x7(J,$);return oe.score=z,mo.set(J,oe),function(de){if(Cg.set(de,!0),!Rg)return void(Rg=Date.now());const be=Date.now();be-Rg>1e3&&(Cg.get(de)?Cg.set(de,!1):(zx(de),Cg.delete(de)),Rg=be)}(J),oe}(y,p.track,M.energyScore);H.addSample(k),H.active&&(f.data=v.frame.buffer,m.enqueue(f))}(e,c,d):t.enableMetadata?function(p,f,m){const g=Hx(new DataView(p.data));if(!g)return f.enqueue(p);const v=g.tlv.find(y=>y.tag===$u.METADATA);v&&m&&v.value instanceof Uint8Array&&m(v.value),p.data=g.frame.buffer,f.enqueue(p)}(c,d,t.onMetadata):d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const s=vg(),o=new MessageChannel;await new Te(d=>s.onmessage=p=>{p.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(s,{name:"rx",port:o.port2},[o.port2]);e.transform=c,await new Te(d=>s.onmessage=p=>{p.data==="started"&&d(void 0)}),o.port1.onmessage=d=>{var p;d.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id&&(b.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=s}function i(){e.track.removeEventListener("ended",i),function(s){const o=wg.get(s);if(o){(function(p){const f=Ju.get(p);f&&(Ju.delete(p),fo&&(fo.removeSpeakers([f]),Ju.size===0&&(fo.destroy(),fo=null)))})(s),zx(s.track.id),wg.delete(s);try{var c,d;(c=o.controller)===null||c===void 0||c.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(p){b.warning(p&&p.message)}}}(e)}wg.set(e,n),e.track.addEventListener("ended",i)}function M7(e,t,n){let i=new Uint8Array(e,t,n),s=[],o=0;for(;s.length<n;)o+3<n&&i[o]===0&&i[o+1]===0&&i[o+2]===3&&(i[o+3]===0||i[o+3]===1||i[o+3]===2||i[o+3]===3)?(s.push(i[o],i[o+1],i[o+3]),o+=4):(s.push(i[o]),o++);return new Uint8Array(s)}const Ag=new Map;async function j7(e,t){if(!gt().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(Ag.has(e)||!e.track)return;const n={track:e.track};if(Pa()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(d){return void b.error("create video-encoded-streams error",d&&d.message)}const o=[];t.on("sei-to-send",d=>{o.push(d)});const c=new TransformStream({transform(d,p){n.controller||(n.controller=p),e.track&&e.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const f=o.shift();f&&(d.data=function(m,g){const v=function(M){const H=M.length;let J=[],$=0;for(;$<H;)$+2<H&&M[$]===0&&M[$+1]===0&&(M[$+2]===0||M[$+2]===1||M[$+2]===2||M[$+2]===3)?(J.push(M[$],M[$+1],3,M[$+2]),$+=3):(J.push(M[$]),$++);return new Uint8Array(J)}(g),y=v.length,D=Math.floor(y/255),A=y%255,I=new Uint8Array(6+D+1+y+m.byteLength);I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=6,I[5]=101;let k=0;for(;k<D;)I[6+k]=255,k++;return I[6+k]=A,k++,I.set(v,6+k),I.set(new Uint8Array(m),6+k+y),I.buffer}(d.data,f)),p.enqueue(d)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else{if(!hi())return;{if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const s=vg(),o=new MessageChannel;await new Te(d=>s.onmessage=p=>{p.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(s,{name:"tx",port:o.port2},[o.port2]);e.transform=c,await new Te(d=>s.onmessage=p=>{p.data==="started"&&d(void 0)}),t.on("sei-to-send",d=>{o.port1.postMessage({sei:d})}),o.port1.onmessage=d=>{var p;d.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=s}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const s=Ag.get(e);if(s){Ag.delete(e);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){b.warning(d&&d.message)}}}Ag.set(e,n),e.track.addEventListener("ended",i)}const pf=new Map;async function VR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!gt().supportWebRTCEncodedTransform)return void b.warning("browser not support video encoded transform");if(!e.track)return;if(pf.has(e)){const s=pf.get(e);return void(s&&(s.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Pa()){if(!e.createEncodedStreams)return void b.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(c){return void b.error("create video-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const p=function(f){const m=new DataView(f.data);let g=0;for(;g+4<f.data.byteLength;){if(m.getUint8(g+0)===0&&m.getUint8(g+1)===0&&m.getUint8(g+2)===0&&m.getUint8(g+3)===1&&m.getUint8(g+4)===6){let v=g+6,y=0,D=0;for(;(D=m.getUint8(v++))===255;)y+=255;y+=D;const A=M7(f.data,v,y);return new Uint8Array(A)}g++}return null}(c);p&&n.onSei&&n.onSei(p),d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void b.warning("browser not support RTCRtpScriptTransform");const s=vg(),o=new MessageChannel;await new Te(d=>s.onmessage=p=>{p.data==="registered"&&d(void 0)});const c=new RTCRtpScriptTransform(s,{name:"rx",port:o.port2},[o.port2]);e.transform=c,await new Te(d=>s.onmessage=p=>{p.data==="started"&&d(void 0)}),o.port1.onmessage=d=>{var p;d.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==n.track.id?(b.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):d.data.sei&&n.onSei&&n.onSei(d.data.sei)},n.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(s){const o=pf.get(s);if(o){pf.delete(s);try{var c,d;(c=o.controller)===null||c===void 0||c.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(p){b.warning(p&&p.message)}}})(e)}pf.set(e,n),e.track.addEventListener("ended",i)}(function(){const e=Et();li.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),li.getStreamFromExtension=e.name===bt.CHROME&&Number(e.version)>34,li.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),li.supportMinBitrate=e.name===bt.CHROME||e.name===bt.EDGE,li.supportSetRtpSenderParameters=function(){const t=Et();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!La()||!(!hi()&&!ng())||t.name===bt.FIREFOX&&Number(t.version)>=64)}(),e.name===bt.SAFARI&&(Number(e.version)>=14?li.supportDualStream=!0:li.supportDualStream=!1),li.webAudioMediaStreamDest=function(){const t=Et();return!(t.name===bt.SAFARI&&Number(t.version)<12)}(),li.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",li.supportWebGL=typeof WebGLRenderingContext<"u",li.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,La()||(li.webAudioWithAEC=!0),li.supportShareAudio=function(){const t=Et();return(t.os===Kn.WIN_10||t.os===Kn.WIN_81||t.os===Kn.WIN_7||t.os===Kn.LINUX||t.os===Kn.MAC_OS||t.os===Kn.CHROMIUM_OS)&&t.name===bt.CHROME&&Number(t.version)>=74}(),li.supportDataChannel=!!(Pu(76)||function(t){const n=Et();return!(n.name!==bt.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||n1(14)),li.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!_n()&&!!t&&t.prototype.setConfiguration instanceof Function}(),li.supportWebRTCEncodedTransform=function(){const t=Et();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),li.supportWebRTCInsertableStream=function(){const t=Et();return(t.name===bt.CHROME||t.name===bt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),li.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,li.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rg(()=>{li.supportDualStreamEncoding=function(){const t=Et();return!!V("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),b.debug("browser ua: ",navigator.userAgent),b.info("browser info: ",e),b.info("browser compatibility: ",li)})})();const U7=["CHINA","GLOBAL"],Yx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Yl=[],Xu=[];function ql(e,t){return!!t&&Yl.some(n=>n.uid===e&&n.channelName===t)}function FR(){return Xu.length>0}var V7=vD.forEach,qx=ml("forEach")?[].forEach:function(e){return V7(this,e,arguments.length>1?arguments[1]:void 0)};yt({target:"Array",proto:!0,forced:[].forEach!==qx},{forEach:qx});var F7=xs("Array","forEach"),B7=br,G7=Xn,H7=q,W7=F7,BR=Array.prototype,K7={DOMTokenList:!0,NodeList:!0},z7=function(e){var t=e.forEach;return e===BR||H7(BR,e)&&t===BR.forEach||G7(K7,B7(e))?W7:t},Y7=E(z7),q7=Sr,$x=Wd;yt({target:"Object",stat:!0,forced:T(function(){$x(1)})},{keys:function(e){return $x(q7(e))}});var Jx=E(os.Object.keys),$7=E(cp),J7=E(c_),X7=yt,Xx=Cr,Q7=Al,Z7=Ei,Qx=Jh,eK=Do,tK=qe,nK=Ob,iK=yn,sK=io,rK=lD("slice"),oK=iK("species"),GR=Array,aK=Math.max;X7({target:"Array",proto:!0,forced:!rK},{slice:function(e,t){var n,i,s,o=tK(this),c=eK(o),d=Qx(e,c),p=Qx(t===void 0?c:t,c);if(Xx(o)&&(n=o.constructor,(Q7(n)&&(n===GR||Xx(n.prototype))||Z7(n)&&(n=n[oK])===null)&&(n=void 0),n===GR||n===void 0))return sK(o,d,p);for(i=new(n===void 0?GR:n)(aK(p-d,0)),s=0;d<p;d++,s++)d in o&&nK(i,s,o[d]);return i.length=s,i}});var cK=xs("Array","slice"),lK=q,dK=cK,HR=Array.prototype,uK=function(e){var t=e.slice;return e===HR||lK(HR,e)&&t===HR.slice?dK:t},hK=E(uK);function De(e,t,n,i,s){var o,c,d,p={};return Y7(o=Jx(i)).call(o,function(f){p[f]=i[f]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=$7(c=J7(d=hK(n).call(n)).call(d)).call(c,function(f,m){return m(e,t,f)||f},p),s&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(s):void 0,p.initializer=void 0),p.initializer===void 0&&(rD(e,t,p),p=null),p}let Ig=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),WR=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),kr=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Ki=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ge=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Xt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),$e=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ze=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),ff=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),lt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),zi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),et=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Og(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw b.error("Invalid Channel Name ".concat(e)),new Q(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Ng(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||d1(e,1,255)))throw new Q(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&b.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ja=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const pK={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},KR={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function zR(e,t){ai(e.url,"".concat(t,".url"),1,1e3,!1),pn(e.x)||Ut(e.x,"".concat(t,".x"),0,1e4),pn(e.y)||Ut(e.y,"".concat(t,".y"),0,1e4),pn(e.width)||Ut(e.width,"".concat(t,".width"),0,1e4),pn(e.height)||Ut(e.height,"".concat(t,".height"),0,1e4),pn(e.zOrder)||Ut(e.zOrder,"".concat(t,".zOrder"),0,255),pn(e.alpha)||Ut(e.alpha,"".concat(t,".alpha"),0,1,!1)}const fK={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Mc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),YR=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Gn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Zx(e){if(!e.channelName)throw new Q(L.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Q(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ai(e.token,"info.token",1,2047),Ng(e.uid),Og(e.channelName),!0}let Yi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Ua=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ds=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Qu=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Nt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),ei=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),Dg=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Yn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),St=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const ek=[St.AFRICA,St.ASIA,St.CHINA,St.EUROPE,St.GLOBAL,St.INDIA,St.JAPAN,St.NORTH_AMERICA,St.OCEANIA,St.OVERSEA,St.SOUTH_AMERICA];let Si=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Pg={CHINA:{},ASIA:{CODE:Si.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Si.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Si.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Si.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Si.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Si.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Si.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Si.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Si.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Si.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Si.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Si.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Si.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};mR&&(Pg.CHINA={CODE:Si.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let mf=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function tk(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class nk extends dn{constructor(t,n){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"onICECandidateError",void 0),N(this,"getLocalVideoStats",void 0)}}class ik extends nk{constructor(t,n){super(t,n),N(this,"establishPromise",void 0)}}let Oe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ii=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Va=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const sk=["disconnected","failed"];let le=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),At=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ve=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Mr=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),jr=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ti=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rk=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Yo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),lr=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),_o=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Zu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Rn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),eh=function(e){return e.ABORT="abort",e}({}),jc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),mK=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const _K={[Ig.ACCESS_POINT]:{[Ki.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ki.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ki.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ki.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ki.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ki.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ig.UNILBS]:{[kr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[kr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[kr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[kr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[kr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[kr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[kr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[kr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[kr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[kr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[kr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[kr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ig.STRING_UID_ALLOCATOR]:{[WR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[WR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[WR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function th(e){const t=_K[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Ig.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const EK={[Ge.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ge.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ge.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ge.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ge.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ge.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ge.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ge.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ge.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ge.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ge.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ge.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ge.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ge.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ge.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ge.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ge.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ge.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ge.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ge.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ge.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ge.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ge.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ge.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ge.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ge.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ge.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ge.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ge.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ge.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ge.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ge.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ge.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ge.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ge.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ge.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ge.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ge.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ge.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ge.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ge.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ge.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ge.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ge.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ge.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ge.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ge.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ge.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ge.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ge.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ge.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ge.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ge.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ge.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ge.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ge.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ge.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ge.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ge.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ge.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ge.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ge.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ge.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function _f(e){return EK[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function ok(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function qR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ok(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ok(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ak(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:s}=e;if(t){const o=V("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const gK=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,vK=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,SK=/wss:\/\/(.+):([0-9]+)\/?/,TK=/wss:\/\/(.[^\/]+)\/?/;let yK=0;class bK{constructor(t,n){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++yK,this.try443PortDuration=V("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];b.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...s)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const s=V("GATEWAY_DOMAINS"),o=Date.now(),c=[],d=s.find(v=>{var y;return ve(y=t.host).call(y,v)});d||(this.useDoubleDomain=!1);const p=[];if(this.useDoubleDomain)s.forEach(v=>{p.push(ak(qR(qR({},t),{},{host:t.host.replace(d,v)}),n))});else{const v=qR({},t);if(n&&d){const y=s.find(D=>D!==d);y&&(v.host=v.host.replace(d,y))}p.push(ak(v,n))}try{p.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",c.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),c.forEach(y=>y.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new Q(L.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const f=tf();this.store&&this.store.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},this.recordIndex),c.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,f.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(v.readyState));const D=c.every(A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),f.reject({code:y.code,reason:Dg.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),g()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...c);const m=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},g=()=>{if(f.isResolved)return m();Et().os===Kn.MAC_OS&&_n()&&m(),this.createWebSocket(t,!0,!0).then(v=>{f.resolve(v)}).catch(v=>{this.isNormalPortFailed&&f.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,g()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,n,i,s){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(o){let c,d,p;return[,c,d,p]=o.match(gK)||[],c||([,d,p]=o.match(vK)||[]),d&&p||([,d,p]=o.match(SK)||[]),d&&p||([,d]=o.match(TK)||[]),d||b.warning("un-destructible url: ",o),{proxy:c,host:d,port:p||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(b.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function ck(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}class lk extends dn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ve(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(et.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(et.CONNECTED):this._state==="closed"?this.emit(et.CLOSED):this._state==="failed"&&this.emit(et.FAILED))}resetReconnectCount(t){b.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",void 0),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=function(g){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?ck(Object(y),!0).forEach(function(D){N(g,D,y[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(y)):ck(Object(y)).forEach(function(D){Object.defineProperty(g,D,Object.getOwnPropertyDescriptor(y,D))})}return g}({},n),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=o,this._initMutex=new vi("websocket",c?c.clientId:void 0);const{timeout:d,timeoutFactor:p}=n,f=Math.max(300,Math.floor(3*d/5)),m=Math.max(1.2,Math.floor(8*p)/10);Is.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),Nn.on(xu.NETWORK_STATE_CHANGE,(g,v)=>{g!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(g)),g===Is.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=p))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const s=tf(),o=this.urls[this.currentURLIndex];V("ENABLE_PREALLOC_PC")&&this.emit(rk.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(et.CLOSED,()=>{s.reject(new re(L.WS_DISCONNECT))}),this.once(et.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void b.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),b.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new re(L.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new re(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=tf();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=m=>{var g;(g=this.store)===null||g===void 0||g.signalChannelOpen(),b.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async m=>{var g;if(b.debug("[".concat(this.name,"] websocket close ").concat((g=this.websocket)===null||g===void 0?void 0:g.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new re(L.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Vs(this,et.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void b.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new re(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},c=m=>{this.emit(et.ON_MESSAGE,m)},d=m=>{b.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=V("GATEWAY_WSS_ADDRESS")),b.debug("[".concat(this.name,"] start connect, url:"),t);const p=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,s&&s(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=c,this.websocket.onerror=d,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinGatewayRecordIndex=p}catch(m){const g=this.state==="closed",v=m instanceof re,y=v&&m.code===L.WS_ABORT,D=v&&m.code===L.WS_ERR,A=v?m.message:m&&(m.reason||m.toString());b.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},p),g||D?(i.reject(g?new re(L.WS_DISCONNECT,"websocket is closed: ".concat(A)):new re(L.WS_ERR,"init websocket failed: ".concat(A))),D&&b.error("[".concat(this.name,"] init websocket failed: ").concat(A))):o&&o(m)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;b.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Nn.isOnline||!Nn.onlineWaiter||(this.onlineReconnectListener=Nn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=aR(this.reconnectCount,this.retryConfig);b.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await Te.race([ci(c),this.onlineReconnectListener||new Te(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(c,d)=>{this.emit(et.RECONNECT_CREATE_CONNECTION,d),await this.createWebSocketConnection(c)};try{if(t==="retry")await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);b.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(b.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await fi(this,et.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(c){var o;b.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const d=c==null||(o=c.data)===null||o===void 0?void 0:o.desc;return Array.isArray(d)&&ve(d).call(d,"dynamic key expired")?(this.emit(et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class $R extends lk{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=tf(),s=function(c,d){return new bK(c,d)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new re(L.WS_ABORT,"choose best websocket aborted"))};const o=V("GATEWAY_DOMAINS");return b.debug("[choose-best-ws] currentDomain: ",t,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ef extends lk{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Te((i,s)=>{let o=!1;const c=[];this.closeEstablishingWs=()=>{b.debug("[choose-best-ws] close establishing websockets"),c.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),s(new re(L.WS_ABORT,"choose best websocket aborted"))};const d=V("GATEWAY_DOMAINS");let p;const f=t.indexOf("?h="),m=d.find(D=>f!==-1?ve(t).call(t,D,f):ve(t).call(t,D));b.debug("[choose-best-ws] currentDomain: ",m,", domains: ",d);let g=!this.tryDoubleDomain||!m;if(!g&&m){var v;const D=Date.now();try{d.forEach(A=>{const I=f===-1?t.replace(m,A):t.substr(0,f)+t.substr(f).replace(m,A),k=new WebSocket(I);k.binaryType="arraybuffer",c.push(k),b.debug("[choose-best-ws] ws is connecting:",k.url)})}catch{for(b.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(I=>I.close());c.length;)c.pop();g=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:c.map(A=>A.url),service:"gateway"},n),c.forEach(A=>{A.onopen=()=>{if(o)return;const I=Date.now()-D;b.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),c.filter(k=>k!==A).forEach(k=>{b.debug("[choose-best-ws]close backup websocket: ".concat(k.url)),k.close()}),o=!0,i(A)},A.onclose=I=>{p=I,!o&&(c.find(k=>!(k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING))||(b.debug("[choose-best-ws] all websocket is closed"),o=!0,s(p)))},A.onmessage=I=>{b.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(I.data))}}),ci(this.forceCloseTimeout).then(()=>{c.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(g){var y;let D;b.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),c.push(D),D.binaryType="arraybuffer"}catch(A){const I=new re(L.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return b.error("[".concat(this.name,"]").concat(I)),void s(I)}D.onopen=()=>{i(D)},D.onclose=A=>{s(A)},D.onmessage=A=>{b.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(A.data))},ci(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class CK extends dn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Xt.CONNECTED?this.emit($e.WS_CONNECTED):t===Xt.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):t===Xt.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",Xt.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new w1(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const o="res-@".concat(s._id);this.emit(o,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===lt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===lt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(wt.UID_BANNED);break;case 15:this.close(wt.IP_BANNED);break;case 16:this.close(wt.CHANNEL_BANNED)}if(s._type===lt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ge.ERR_LICENSE_MISSING:this.close(wt.LICENSE_MISSING);break;case Ge.ERR_LICENSE_EXPIRED:this.close(wt.LICENSE_EXPIRED);break;case Ge.ERR_LICENSE_MINUTES_EXCEEDED:this.close(wt.LICENSE_MINUTES_EXCEEDED);break;case Ge.ERR_LICENSE_PERIOD_INVALID:this.close(wt.LICENSE_PERIOD_INVALID);break;case Ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(wt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ge.ERR_LICENSE_ILLEGAL:this.close(wt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xt.CONNECTED&&this.reconnect("retry",pi.OFFLINE)})}async request(t,n,i,s){const o=Yt(6,""),c={_id:o,_type:t,_message:n},d=this.websocket.connectionID,p=()=>new Te((D,A)=>{if(this.connectionState===Xt.CONNECTED)return D();const I=()=>{this.off($e.WS_CLOSED,k),D()},k=()=>{this.off($e.WS_CONNECTED,I),A(new Q(L.WS_ABORT))};this.once($e.WS_CONNECTED,I),this.once($e.WS_CLOSED,k),t!==ze.PUBLISH&&t!==ze.PUBLISH_DATASTREAM&&t!==ze.SUBSCRIBE&&t!==ze.SUBSCRIBE_DATASTREAM&&t!==ze.UNSUBSCRIBE&&t!==ze.UNSUBSCRIBE_DATASTREAM&&t!==ze.UNPUBLISH&&t!==ze.UNPUBLISH_DATASTREAM&&t!==ze.CONTROL&&t!==ze.RESTART_ICE||this.once($e.DISCONNECT_P2P,()=>{A(new Q(L.DISCONNECT_P2P))}),t!==ze.PUBLISH&&t!==ze.RESTART_ICE||this.once($e.ABORT_P2P_EXECUTION,()=>{A(new Q(L.DISCONNECT_P2P))})});if(this.connectionState!==Xt.CONNECTING&&this.connectionState!==Xt.RECONNECTING||t===ze.JOIN||t===ze.REJOIN||await p(),this.websocket.sendMessage(c,!0),s)return;const f=new Te((D,A)=>{let I=!1;const k=(H,J)=>{I=!0,D({isSuccess:H==="success",message:J||{}}),this.off($e.WS_CLOSED,M),this.off($e.WS_RECONNECTING,M),this.emit($e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(o),k);const M=()=>{A(new Q(L.WS_ABORT,"type: ".concat(t))),this.off($e.WS_CLOSED,M),this.off($e.WS_RECONNECTING,M),this.off("res-@".concat(o),k)};this.once($e.WS_CLOSED,M),this.once($e.WS_RECONNECTING,M),ci(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||I||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit($e.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await f}catch(D){if(this.connectionState===Xt.CLOSED||t===ze.LEAVE)throw new Q(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===ze.JOIN||t===ze.REJOIN?null:(await p(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),v=_f(g),y=new Q(L.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:v.desc});return v.action==="success"?m.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(v.desc,", action: ").concat(v.action)),g===Ge.ERR_TOO_MANY_BROADCASTERS?((t===ze.JOIN||t===ze.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(g===Ge.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pi.MULTI_IP)):this.reconnect(v.action,pi.SERVER_ERROR),t===ze.JOIN||t===ze.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Te(i=>{const s=o=>{(!n||n(o))&&(this.off(t,s),i(o))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(ff.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xt.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Te((n,i)=>{this.once($e.WS_CONNECTED,()=>n(this.joinResponse)),this.once($e.WS_CLOSED,s=>i(this.initError||new Q(L.WS_ABORT,s))),this.connectionState=Xt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||wt.LEAVE,this.connectionState=Xt.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION);const t=await fi(this,$e.REQUEST_JOIN_INFO),n=await this.request(ze.JOIN,t);if(!n)return this.emit($e.REPORT_JOIN_GATEWAY,Dg.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Q(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=af(this,$e.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ze.REJOIN,t);return!!n&&(this.connectionState=Xt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(lt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(lt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(lt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(lt.MUTE_AUDIO,{uid:i.uid}):this.emit(lt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(lt.MUTE_VIDEO,{uid:i.uid}):this.emit(lt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(lt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(lt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(lt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(lt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){b.debug("[".concat(this.clientId,"] receive notification: "),t);const n=_f(t.code);if(t.code===28&&"detail"in t&&(b.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit($e.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(wt.UID_BANNED),void this.close()):void this.reconnect(n.action,pi.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=V("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(b.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",pi.TIMEOUT):this.request(ze.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(ze.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(ff.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(et.RECONNECT_CREATE_CONNECTION,t=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(et.CLOSED,()=>{this.connectionState=Xt.CLOSED}),this.websocket.on(et.FAILED,()=>{this._disconnectedReason=wt.NETWORK_ERROR,this.connectionState=Xt.CLOSED}),this.websocket.on(et.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Xt.CONNECTED?this.connectionState=Xt.RECONNECTING:this.connectionState=Xt.CONNECTING}),this.websocket.on(et.WILL_RECONNECT,(t,n,i)=>{const s=af(this,$e.IS_P2P_DISCONNECTED),o=s||t!=="retry";s&&t==="retry"&&(b.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Dg.P2P_DISCONNECTED),o&&(b.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit($e.REPORT_JOIN_GATEWAY,n||Dg.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit($e.DISCONNECT_P2P)),i(t)}),this.websocket.on(et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{b.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",pi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit($e.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Q){if(t.code===L.UNEXPECTED_RESPONSE&&t.data.code===Ge.ERR_NO_AUTHORIZED)return this.initError=new Q(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(wt.TOKEN_EXPIRE);b.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pi.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(et.REQUEST_NEW_URLS,(t,n)=>{fi(this,$e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(rk.PRE_CONNECT_PC,()=>{this.emit($e.PRE_CONNECT_PC)})}}let RK=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Dn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function dk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Lg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function nh(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(b.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function JR(e,t){e.addresses||(e.addresses=[]);const n=function(d,p){if(V("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return d.map(g=>{let{ip:v,port:y}=g;return{address:"".concat(v,":").concat(y)}});const f=V("GATEWAY_DOMAINS");let m=f[1]&&ve(p).call(p,f[1])?1:0;return d.map(g=>{let{domain_prefix:v,port:y,ip:D}=g;if(v)return{address:"".concat(v,".").concat(f[m++%f.length],":").concat(y)};const A=/^[\.\:\d]+$/.test(D),I=A?"".concat(D.replace(/[^\d]/g,"-"),".").concat(f[m++%f.length],":").concat(y):"".concat(D,":").concat(y);return A||b.debug("Cannot recognized as ip address: ".concat(D,", use as host")),{ip:D,port:y,address:I}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const d=i.split(";");for(let p=0;p<d.length;p++){var s;const f=Li(s=d[p]).call(s);n[p]&&f&&(n[p].ip6=f)}}const o=e.detail&&e.detail.candidate;let c;if(o){const[d,p]=o.split(":");d&&p&&(c={port:Number(p),ip:d,address:"".concat(d,":").concat(p)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Os(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function uk(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Os(t.width),"x").concat(Os(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function hk(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function gf(e,t){let n,i,s;switch(t){case Dn.CHOOSE_SERVER:i=4096,s="choose server";break;case Dn.CLOUD_PROXY:i=1048576,s="proxy";break;case Dn.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case Dn.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new Q(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===i&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(c=>Lg(Lg({},c),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:Lg(Lg({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!n)throw new Q(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function pk(e,t){return await Te.all(e.addresses.map(async n=>({address:nh(n.ip),tcpport:n.port,udpport:n.port,username:t&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():mi.username,password:t&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await iR(t.toString()):mi.password})))}function XR(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,s=t.videoWidth||n.width;return i&&s?Math.max(Math.min(i,s)/Math.min(Os(e.height),Os(e.width)),1):(b.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Uc(e){let{candidateType:t,relayProtocol:n,type:i,address:s,port:o,protocol:c}=e;const d={candidateType:t,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const p=s.split(".");p.length>=4&&(p[1]="*",p[2]="*"),d.address=p.join("."),d.port=o}return d}function xg(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V("SVC_MODE");if(V("ENABLE_SVC"))return function(t){return t in lg}(e)?e:lg.L1T3}const fk={[Oe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Oe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function kg(e,t,n){t.forEach(i=>{var s;const o=fk[e].find(d=>{var p;let{key:f}=d;return ve(p=i.extensionName).call(p,f)});if(!o)return;const c=n.find(d=>{let{extensionName:p}=d;return ve(p).call(p,o.key)});c&&ve(s=c.extensionName).call(s,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function ih(e,t){t.forEach(n=>{var i;const s=fk[e].find(o=>{var c;let{key:d}=o;return ve(c=n.extensionName).call(c,d)});ve(i=n.extensionName).call(i,"gdpr_forbidden")&&s&&(n.extensionName=s.extensionName)})}function mk(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ve(e).call(e,"abs-send-time")}function Mg(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ve(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Ek(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_k(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_k(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function vf(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:o,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:p}=t,{useXR:f}=n;let m=[],g=[],v=[],y=[],D=!1,A=!1;if(ls(e).mediaDescriptions.forEach(k=>{i&&i!==k.attributes.direction||(k.media.mediaType!=="video"||D||(g=k.attributes.payloads,y=k.attributes.extmaps,D=!0),k.media.mediaType!=="audio"||A||(m=k.attributes.payloads,v=k.attributes.extmaps,A=!0))}),!y||g.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!v||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(g.forEach(k=>{var M;(M=k.rtpMap)!==null&&M!==void 0&&M.clockRate&&(k.rtpMap.clockRate=parseInt(k.rtpMap.clockRate)),f&&k.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(k=>{var M;(M=k.rtpMap)!==null&&M!==void 0&&M.clockRate&&(k.rtpMap.clockRate=parseInt(k.rtpMap.clockRate)),f&&k.rtcpFeedbacks.push({type:"rrtr"})}),s&&(m=m.filter(k=>{var M;return((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"}),g=g.filter(k=>{var M;return((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())!=="rtx"})),o&&(g=g.filter(k=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),c&&(m=m.filter(k=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName)||"")})),d&&(d==null?void 0:d.length)>0&&(m=m.filter(k=>{var M;return ve(d).call(d,((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLowerCase())||"")})),p&&(p==null?void 0:p.length)>0){const k=g.filter(M=>{var H;return ve(p).call(p,((H=M.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"")});g=k.concat(s?[]:ew(k,g))}const I=V("UNSUPPORTED_VIDEO_CODEC");return I&&I.length>0&&(g=g.filter(k=>!(k.rtpMap&&ve(I).call(I,k.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:g,audioExtensions:v,videoExtensions:y}}function Vc(e){const t=ls(e);let n,i;for(const s of t.mediaDescriptions){if(!n){const o=s.attributes.iceUfrag,c=s.attributes.icePwd;if(!o||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:c}}if(!i){const o=s.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function gk(e,t){const n=[],i=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),s=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),o=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(c=>{var d;const p=(d=i.find(f=>f.ssrcIds[0]===c))===null||d===void 0?void 0:d.ssrcIds[1];n.push({ssrcId:c,rtx:t?p:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],d=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?d:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function vk(e,t,n){const{cname:i}=e;let s=[];t&&(s=Sk(t)),s.length===0&&(s=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),b.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}const p=Ug(e.rtpCapabilities),f=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{f.push({kind:Oe.VIDEO,ssrcId:m.v,rtx:m.v_rtx,mslabel:"".concat(m.v,"_").concat(m.a)},{kind:Oe.AUDIO,ssrcId:m.a,mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:o,iceParameters:c,candidates:s,rtpCapabilities:p,setup:d,cname:i,preSSRCs:f}}function Sk(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],b.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),b.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function $l(e,t,n){const i=[],s=[];return e.forEach(o=>{let{ssrcId:c,rtx:d}=o;const p=Yt(8,"track-"),f={ssrcId:c,attributes:Ek({label:p,mslabel:n=n||Yt(10,""),msid:"".concat(n," ").concat(p)},t&&{cname:t})};if(i.push(f),d!==void 0){const m={ssrcId:d,attributes:Ek({label:p,mslabel:n,msid:"".concat(n," ").concat(p)},t&&{cname:t})};i.push(m),s.push({semantic:"FID",ssrcIds:[c,d]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:c}=o;return c})}),{ssrcs:i,ssrcGroups:s}}function sh(e,t){t instanceof gn&&e.attributes.payloads.forEach(n=>{var i;const s=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=t._encoderConfig;o&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(o.bitrate&&!_n()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function QR(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function ZR(e,t){var n;if(!(t instanceof tn&&t._encoderConfig&&t._hints.indexOf(qt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;gt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(s=>{var o,c;ve(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),gt().supportMinBitrate&&!ve(n=t._hints).call(n,qt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(s=>{var o,c;ve(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function Tk(e){if(e.media.mediaType!=="video")return;const t=Et();if(t.name!==bt.SAFARI&&t.os!==Kn.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function jg(e,t,n){if(!t)return;let i,s;if(e.media.mediaType==="video"?(i=n.videoExtensions,s=n.videoCodecs):(i=n.audioExtensions,s=n.audioCodecs),t.twcc===!0){const o=i.find(c=>Mg(c.extensionName));if(o){const c=o.extensionName;e.attributes.extmaps.find(p=>Mg(p.extensionName))||e.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(p,f){return f.filter(m=>!!p.find(g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(s,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="transport-cc")||p.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const o=e.attributes.extmaps.findIndex(c=>Mg(c.extensionName));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}if(t.remb===!0){const o=i.find(c=>mk(c.extensionName));if(o){const c=o.extensionName;e.attributes.extmaps.find(p=>p.extensionName===c)||e.attributes.extmaps.push({entry:o.entry,extensionName:c}),function(p,f){return f.filter(m=>!!p.find(g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(s,e.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(f=>f.type==="goog-remb")||p.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const o=e.attributes.extmaps.findIndex(c=>mk(c.extensionName));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(c=>{const d=c.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}}function yk(e,t,n){if(_n()||e.media.mediaType!=="video"||!(t instanceof tn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!V("SIMULCAST")||n==="vp9"&&V("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(d=>d.semantic==="FID"&&d.ssrcIds[0]===s.ssrcId),c={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let d=1;d<i;d++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+d,attributes:En(s.attributes)}),c.ssrcIds.push(s.ssrcId+d),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+d,attributes:En(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+d,o.ssrcIds[1]+d]}));e.attributes.ssrcGroups.unshift(c)}async function bk(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:s,recv:o,sendrecv:c}=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const m=vf(f,d,p,"sendonly"),g=vf(f,d,p,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ur(m,g,"videoExtensions",v,y,D),Ur(m,g,"videoCodecs",v,y,D),Ur(m,g,"audioExtensions",v,y,D),Ur(m,g,"audioCodecs",v,y,D),V("RAISE_H264_BASELINE_PRIORITY")){const A=[],I=[];D.videoCodecs.forEach((k,M)=>{var H;if(((H=k.rtpMap)===null||H===void 0?void 0:H.encodingName.toLocaleLowerCase())==="h264"){var J,$;const z=D.videoCodecs[M+1],oe=z&&Ik(k,z),de=(J=k.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"],be=($=k.fmtp)===null||$===void 0?void 0:$.parameters["packetization-mode"];!de||de!==V("FIRST_H264_PROFILE_LEVEL_ID")||V("FIRST_PACKETIZATION_MODE")&&be!==V("FIRST_PACKETIZATION_MODE")?oe?I.push([k,z]):I.push([k]):oe?A.push([k,z]):A.push([k])}}),A.length>0&&I.length>0&&(b.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((k,M)=>{var H;if(((H=k.rtpMap)===null||H===void 0?void 0:H.encodingName.toLocaleLowerCase())==="h264"){const J=Ik(k,D.videoCodecs[M+1]),$=A.shift()||I.shift()||[];$.length>0&&(J?D.videoCodecs.splice(M,2,...$):D.videoCodecs.splice(M,1,...$))}}),y.videoCodecs=y.videoCodecs.filter(k=>{var M,H;return!(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((H=k.fmtp)===null||H===void 0?void 0:H.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))}),V("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(k=>{var M,H;return!(((M=k.rtpMap)===null||M===void 0?void 0:M.encodingName.toLocaleLowerCase())==="h264"&&((H=k.fmtp)===null||H===void 0?void 0:H.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:v,recv:y,sendrecv:D}}(e,t,i);try{n.close()}catch{}return{send:s,recv:o,sendrecv:c}}function Ck(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=vf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ur(e,t,"videoExtensions",n,i,s),Ur(e,t,"videoCodecs",n,i,s),Ur(e,t,"audioExtensions",n,i,s),Ur(e,t,"audioCodecs",n,i,s),V("RAISE_H264_BASELINE_PRIORITY")){const o=s.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){const c=s.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<o){b.debug("raising H264 baseline profile priority");const d=s.videoCodecs[o];s.videoCodecs.splice(o,1),s.videoCodecs.splice(c,0,d)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(d=>!(d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:s}}function Ur(e,t,n,i,s,o){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(d=>{t[n].some((p,f)=>{if(d.entry===p.entry&&d.extensionName===p.extensionName)return c.push(f),!0})?o[n].push(d):i[n].push(d)}),void t[n].forEach((d,p)=>{c.indexOf(p)===-1&&s[n].push(d)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(d=>{t[n].some((p,f)=>{if(d.payloadType===p.payloadType&&JSON.stringify(d)===JSON.stringify(p))return c.push(f),!0})?o[n].push(d):i[n].push(d)}),void t[n].forEach((d,p)=>{c.indexOf(p)===-1&&s[n].push(d)})}}function Ug(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,o;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...i.audioCodecs],o.videoCodecs=[...n.videoCodecs,...i.videoCodecs],o.audioExtensions=[...n.audioExtensions,...i.audioExtensions],o.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):o=i,{send:s,recv:o}}function rh(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Sf(e,t,n,i){let s=[];if(e===Oe.VIDEO){if(V("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(s=t.videoCodecs.filter(o=>{var c;return ve(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===V("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let o=[];const c=[],d=[],p=[];if(n.videoCodecs.forEach(f=>{const m=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";ve(m).call(m,i)?o.push(f):ve(m).call(m,"vp9")?c.push(f):ve(m).call(m,"vp8")?d.push(f):ve(m).call(m,"h264")&&p.push(f)}),o.length===0){let f="";c.length!==0?(o=c,f="vp9"):d.length!==0?(o=d,f="vp8"):p.length!==0&&(o=p,f="h264"),b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}o.length!==0&&(s=t.videoCodecs.filter(f=>o.some(m=>m.payloadType===f.payloadType)))}if(s.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),V("USE_PUB_RTX")||V("USE_SUB_RTX")){const o=ew(s,t.videoCodecs);s=[...s,...o]}}else s=t.audioCodecs.filter(o=>{var c;return ve(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),s.length===0&&(b.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(o=>{var c;return ve(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return s}function ew(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&ve(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Vg(e,t,n){const i=t.toString(),s=wk(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let c=o.sdp;c=Rk(c,n||{}),s==null||s(c||""),await e.setLocalDescription({type:"answer",sdp:c})}function Rk(e,t,n){const i=ls(e),{useXR:s}=t;return i.mediaDescriptions.forEach(o=>{var c;o.attributes.mid&&(Array.isArray(n)&&!ve(n).call(n,o.attributes.mid)||(o.media.mediaType==="audio"&&rh(o),s&&ve(c=["audio","video"]).call(c,o.media.mediaType)&&o.attributes.payloads.forEach(d=>{d.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&d.rtcpFeedbacks.push({type:"rrtr"})})))}),kc(i)}function wk(e,t,n,i){if(V("SDP_LOGGING"))return b.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?s=>{wk(s,"answer",n==="local"?"remote":"local",i)}:void 0}function Ak(e){const t=V("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>ve(e).call(e,n))}function Ik(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function Ok(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function dr(e,t){return typeof V(e)===t?V(e):void 0}function wK(){try{const e=V("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Ok(Object(i),!0).forEach(function(s){N(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ok(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},e)}catch(e){return b.debug("handle gateway attributes failed: ",e),{}}}const Nk={};function Jl(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&b.debug("install service ".concat(e.name)),Nk[e.name]=e}function Fc(e){const t=Nk[e];if(!t)throw new re(L.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function Dk(e,t){return Fc("DataStream").create(e,t)}function Pk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Fa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const tw=new Map;class AK extends dn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(ei.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(ei.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){b.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,s,o;super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:Fa(Fa({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(s=(o=Fc("P2PChannel")).createSubmodule)===null||s===void 0?void 0:s.call(o,i)):new CK(Fa(Fa({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let o=tw.get(t.cname);if(o||(o=new Map,tw.set(t.cname,o)),this._isProactiveJoin=!0,o.has(t.uid)){const f=new Q(L.UID_CONFLICT);throw xe.joinGateway(t.sid,{lts:s,succ:!1,ec:f.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),f}o.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=s;const d=t.proxyServer;try{b.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const f=t.gatewayAddrs.map(m=>{let{address:g}=m;const[v,y]=g.split(":"),D={host:v,port:y};return t.proxyServer&&(D.proxy=t.proxyServer),D});c=(await this.signal.init(f)).uid,b.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(f){var p;throw b.error("[".concat(this.store.clientId,"] User join failed"),f.toString()),xe.joinGateway(t.sid,{lts:s,succ:!1,ec:((p=f.data)===null||p===void 0?void 0:p.desc)||f.code,errorMsg:f.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!d,signalChannel:"0",preload:t.preload}),o.delete(t.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),b.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{b.warning("[".concat(this.store.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ei.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ei.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ei.NETWORK_QUALITY,{uplinkNetworkQuality:hk(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:hk(this._statsCollector.trafficStats.B_dnq)}):this.emit(ei.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==wt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Xt.CONNECTED||await function(i,s){return s===1/0?i:Te.race([i,$9(s)])}(this.signal.request(ze.LEAVE,void 0,!0),3e3)}catch(i){b.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==wt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(await this.signal.request(ze.PUBLISH,s,!0))._message}catch(o){if(i&&o.data&&o.data.code===Ge.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw o}}async publishDataChannel(t,n,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(s=n.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ze.PUBLISH_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===Ge.ERR_PUBLISH_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw c}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ze.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Te.all(t.map(n=>this.signal.request(ze.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){b.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX")||void 0,extend:V("SUB_EXTEND"),svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return await this.signal.request(ze.PRE_SUBSCRIBE,s,!0)}catch(o){if(i&&o.data&&o.data.code===Ge.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(t,n,!1);throw o}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return(await this.signal.request(ze.SUBSCRIBE,s,!0))._message}catch(o){if(i&&o.data&&o.data.code===Ge.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw o}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ze.SUBSCRIBE_DATASTREAM,s,!0)}catch(o){if(i&&o.data&&o.data.code===Ge.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw o}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!V("USE_SUB_RTX"),twcc:!!V("SUBSCRIBE_TWCC"),svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return await this.signal.request(ze.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(n&&s.data&&s.data.code===Ge.ERR_SUBSCRIBE_REQUEST_INVALID)return b.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,o=i.width,c=i.height,d=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(d=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(d=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,s||(d=!1)),d?{stream_type:0,width:o,height:c,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(ze.SET_VIDEO_PROFILE,n);b.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ze.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){b.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Te.all(t.map(i=>this.signal.request(ze.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){b.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(ze.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){b.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(ze.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ze.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ze.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),V("CLIENT_ROLE_OPTIONS")&&(b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(V("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},V("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),V("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},V("CLIENT_ROLE_OPTIONS")),b.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(V("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(ze.SET_CLIENT_ROLE,{role:t,level:s,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(ze.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ze.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ze.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ze.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ze.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Fa({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ze.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=tw.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:mi.username,password:mi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Fa(Fa({},mi),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ze.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&rg(()=>{this.emit(ei.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new Q(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=V("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var s;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ei.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,ve(Xu).call(Xu,s)||Xu.push(s);const o=!(_n()||t1(87)||G1())&&typeof V("ENABLE_PRE_SUB")=="boolean"&&V("ENABLE_PRE_SUB"),c=!G1()&&dr("ENABLE_PREALLOC_PC","boolean"),d=wK(),p=Fa({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:or,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:Fa({enableEncodedTransform:!!V("ENABLE_AUDIO_METADATA")&&Pu(87)||!!V("ENABLE_AUDIO_TOPN")&&$C(bt.CHROME,87,116)||void 0,enableAudioMetadata:!!V("ENABLE_AUDIO_METADATA")&&Pu(87),topnSmoothLevel:V("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:V("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:V("TOPN_SWITCH_HOLD_MS"),topnAudioGain:V("TOPN_AUDIO_GAIN"),enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:dr("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:dr("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:dr("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:V("USE_PUB_RTX")===!0||V("USE_SUB_RTX")===!0||void 0,disableFEC:V("DISABLE_FEC"),enableNTPReport:!!V("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!V("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!V("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:dr("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!V("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!V("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:dr("USE_XR","boolean"),enableLossbasedBwe:dr("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!V("ENABLE_AUT_CC")||void 0,enableCCFallback:dr("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:o?dr("PRE_SUB_NUM","number"):void 0,enablePubTWCC:dr("PUBLISH_TWCC","boolean"),enableSubTWCC:dr("SUBSCRIBE_TWCC","boolean"),enablePubRTX:dr("USE_PUB_RTX","boolean"),enableSubRTX:dr("USE_SUB_RTX","boolean"),enableSubSVC:V("ENABLE_SVC")?V("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0,enableSvcExtended:V("ENABLE_SVC")&&Array.isArray(V("SVC_EXTENDED"))&&V("SVC_EXTENDED").length!==0?V("SVC_EXTENDED"):void 0},d)},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(p.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(p.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(p.aes_secret=this.joinInfo.aespassword,p.aes_encrypt=!0):p.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(p.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(p.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(p.default_video_stream=this.joinInfo.defaultVideoStream),p}getRejoinMessage(){if(!this.joinInfo)throw new Q(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($e.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on($e.WS_RECONNECTING,t=>{this.joinInfo&&xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||pi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",xe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on($e.WS_CLOSED,t=>{let n;switch(t){case wt.LEAVE:n=pi.LEAVE;break;case wt.UID_BANNED:case wt.IP_BANNED:case wt.CHANNEL_BANNED:case wt.SERVER_ERROR:n=pi.SERVER_ERROR;break;case wt.FALLBACK:n=pi.FALLBACK;break;case wt.LICENSE_MISSING:case wt.LICENSE_EXPIRED:case wt.LICENSE_MINUTES_EXCEEDED:case wt.LICENSE_PERIOD_INVALID:case wt.LICENSE_MULTIPLE_SDK_SERVICE:case wt.LICENSE_ILLEGAL:case wt.TOKEN_EXPIRE:n=t;break;default:n=pi.NETWORK_ERROR}b.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+pi.NETWORK_ERROR)),this.joinInfo&&xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===wt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==wt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on($e.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=V("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(b.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void b.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));xt("EVENT_REPORT_DOMAIN",t[1]),xt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),xt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(lt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on($e.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new Q(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,fi(this,ei.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on($e.REQUEST_JOIN_INFO,async(t,n,i)=>{var s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:o,dtlsParameters:c,rtpCapabilities:d}=await fi(this,ei.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(s=this.joinInfo)===null||s===void 0?void 0:s.turnServer});try{t(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:c,rtpCapabilities:d,version:"2"}}))}catch(p){n(p)}}),this.signal.on($e.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on($e.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,s="";var o;t instanceof Q?(i=((o=t.data)===null||o===void 0?void 0:o.desc)||t.code,s=t.message):i=t,xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:s,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on($e.IS_P2P_DISCONNECTED,t=>{t(af(this,ei.IS_P2P_DISCONNECTED))}),this.signal.on($e.DISCONNECT_P2P,()=>{this.emit(ei.DISCONNECT_P2P)}),this.signal.on($e.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($e.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on($e.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(ei.JOIN_RESPONSE,t,n)}),this.signal.on($e.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=V("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const i=Sk(t);this.emit(ei.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on($e.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof V("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(V("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ze.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(ze.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw b.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ze.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(ze.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw b.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ze.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(s=>s.stream_type===Nt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ze.CONTROL,i,!0,!0)}catch(s){throw b.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,n){const i={action:t.find(s=>s.stream_type===Nt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ze.CONTROL,i,!0,!0)}catch(s){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,n){const i={action:t===Oe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ze.CONTROL,i,!0,!0)}catch(s){throw b.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,n){const i={action:t===Oe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ze.CONTROL,i,!0,!0)}catch(s){throw b.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ze.RESTART_ICE,n,!0)}catch(i){throw b.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||pi.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!V("GATEWAY_WSS_ADDRESS"))return V("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(b.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ze.SET_PARAMETER,{enablePublishAudioFilter:t})}}let Fg=0,nw=0;function Eo(e,t,n,i){return new Te((s,o)=>{t.timeout=t.timeout||V("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Fg+=Go(t.data)):n&&(t.data.size?Fg+=t.data.size:t.data instanceof FormData?Fg+=v1(t.data):Fg+=Go(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Zi.request(t).then(c=>{typeof c.data=="string"?nw+=Go(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?nw+=c.data.byteLength:nw+=Go(JSON.stringify(c.data)),i&&s({data:c.data,headers:c.headers}),s(c.data)}).catch(c=>{Zi.isCancel(c)?o(new Q(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new Q(L.NETWORK_TIMEOUT,c.message)):c.response?o(new Q(L.NETWORK_RESPONSE_ERROR,c.response.status)):o(new Q(L.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(ae){var Ee=0;return function(){return Ee<ae.length?{done:!1,value:ae[Ee++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(ae,Ee,Pe){return ae==Array.prototype||ae==Object.prototype||(ae[Ee]=Pe.value),ae},i,s=function(ae){ae=[typeof globalThis=="object"&&globalThis,ae,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var Ee=0;Ee<ae.length;++Ee){var Pe=ae[Ee];if(Pe&&Pe.Math==Math)return Pe}throw Error("Cannot find global object")}(this);function o(ae,Ee){if(Ee)e:{var Pe=s;ae=ae.split(".");for(var ce=0;ce<ae.length-1;ce++){var C=ae[ce];if(!(C in Pe))break e;Pe=Pe[C]}(Ee=Ee(ce=Pe[ae=ae[ae.length-1]]))!=ce&&Ee!=null&&n(Pe,ae,{configurable:!0,writable:!0,value:Ee})}}function c(ae){return(ae={next:ae})[Symbol.iterator]=function(){return this},ae}function d(ae){var Ee=typeof Symbol<"u"&&Symbol.iterator&&ae[Symbol.iterator];return Ee?Ee.call(ae):{next:t(ae)}}if(o("Symbol",function(ae){function Ee(C,F){this.A=C,n(this,"description",{configurable:!0,writable:!0,value:F})}if(ae)return ae;Ee.prototype.toString=function(){return this.A};var Pe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ce=0;return function C(F){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new Ee(Pe+(F||"")+"_"+ce++,F)}}),o("Symbol.iterator",function(ae){if(ae)return ae;ae=Symbol("Symbol.iterator");for(var Ee="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Pe=0;Pe<Ee.length;Pe++){var ce=s[Ee[Pe]];typeof ce=="function"&&typeof ce.prototype[ae]!="function"&&n(ce.prototype,ae,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return ae}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var p;e:{var f={};try{f.__proto__={a:!0},p=f.a;break e}catch{}p=!1}i=p?function(ae,Ee){if(ae.__proto__=Ee,ae.__proto__!==Ee)throw new TypeError(ae+" is not extensible");return ae}:null}var m=i;function g(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(ae){if(ae.m)throw new TypeError("Generator is already running");ae.m=!0}function y(ae,Ee){return ae.h=3,{value:Ee}}function D(ae){this.g=new g,this.G=ae}function A(ae,Ee,Pe,ce){try{var C=Ee.call(ae.g.j,Pe);if(!(C instanceof Object))throw new TypeError("Iterator result "+C+" is not an object");if(!C.done)return ae.g.m=!1,C;var F=C.value}catch(B){return ae.g.j=null,ae.g.s(B),I(ae)}return ae.g.j=null,ce.call(ae.g,F),I(ae)}function I(ae){for(;ae.g.h;)try{var Ee=ae.G(ae.g);if(Ee)return ae.g.m=!1,{value:Ee.value,done:!1}}catch(Pe){ae.g.v=void 0,ae.g.s(Pe)}if(ae.g.m=!1,ae.g.l){if(Ee=ae.g.l,ae.g.l=null,Ee.F)throw Ee.D;return{value:Ee.return,done:!0}}return{value:void 0,done:!0}}function k(ae){this.next=function(Ee){return ae.o(Ee)},this.throw=function(Ee){return ae.s(Ee)},this.return=function(Ee){return function(Pe,ce){v(Pe.g);var C=Pe.g.j;return C?A(Pe,"return"in C?C.return:function(F){return{value:F,done:!0}},ce,Pe.g.return):(Pe.g.return(ce),I(Pe))}(ae,Ee)},this[Symbol.iterator]=function(){return this}}function M(ae,Ee){return Ee=new k(new D(Ee)),m&&ae.prototype&&m(Ee,ae.prototype),Ee}if(g.prototype.o=function(ae){this.v=ae},g.prototype.s=function(ae){this.l={D:ae,F:!0},this.h=this.C||this.u},g.prototype.return=function(ae){this.l={return:ae},this.h=this.u},D.prototype.o=function(ae){return v(this.g),this.g.j?A(this,this.g.j.next,ae,this.g.o):(this.g.o(ae),I(this))},D.prototype.s=function(ae){return v(this.g),this.g.j?A(this,this.g.j.throw,ae,this.g.o):(this.g.s(ae),I(this))},o("Array.prototype.entries",function(ae){return ae||function(){return function(Ee,Pe){Ee instanceof String&&(Ee+="");var ce=0,C=!1,F={next:function(){if(!C&&ce<Ee.length){var B=ce++;return{value:Pe(B,Ee[B]),done:!1}}return C=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F}(this,function(Ee,Pe){return[Ee,Pe]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var H=function(ae,Ee){for(var Pe=0;Pe<ae.length;Pe++)Ee(ae[Pe])},J=function(ae){return ae.replace(/\r?\n|\r/g,`\r
`)},$=function(ae,Ee,Pe){return Ee instanceof Blob?(Pe=Pe!==void 0?Pe+"":typeof Ee.name=="string"?Ee.name:"blob",Ee.name===Pe&&Object.prototype.toString.call(Ee)!=="[object Blob]"||(Ee=new File([Ee],Pe)),[String(ae),Ee]):[String(ae),String(Ee)]},z=function(ae,Ee){if(ae.length<Ee)throw new TypeError(Ee+" argument required, but only "+ae.length+" present.")},oe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,de=oe.FormData,be=oe.XMLHttpRequest&&oe.XMLHttpRequest.prototype.send,Re=oe.Request&&oe.fetch,dt=oe.navigator&&oe.navigator.sendBeacon,ut=oe.Element&&oe.Element.prototype,$t=oe.Symbol&&Symbol.toStringTag;$t&&(Blob.prototype[$t]||(Blob.prototype[$t]="Blob"),"File"in oe&&!File.prototype[$t]&&(File.prototype[$t]="File"));try{new File([],"")}catch{oe.File=function(Ee,Pe,ce){return Ee=new Blob(Ee,ce||{}),Object.defineProperties(Ee,{name:{value:Pe},lastModified:{value:+(ce&&ce.lastModified!==void 0?new Date(ce.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),$t&&Object.defineProperty(Ee,$t,{value:"File"}),Ee}}var wn=function(ae){return ae.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},vn=function(ae){this.i=[];var Ee=this;ae&&H(ae.elements,function(Pe){if(Pe.name&&!Pe.disabled&&Pe.type!=="submit"&&Pe.type!=="button"&&!Pe.matches("form fieldset[disabled] *"))if(Pe.type==="file"){var ce=Pe.files&&Pe.files.length?Pe.files:[new File([],"",{type:"application/octet-stream"})];H(ce,function(C){Ee.append(Pe.name,C)})}else Pe.type==="select-multiple"||Pe.type==="select-one"?H(Pe.options,function(C){!C.disabled&&C.selected&&Ee.append(Pe.name,C.value)}):Pe.type==="checkbox"||Pe.type==="radio"?Pe.checked&&Ee.append(Pe.name,Pe.value):(ce=Pe.type==="textarea"?J(Pe.value):Pe.value,Ee.append(Pe.name,ce))})};if((e=vn.prototype).append=function(ae,Ee,Pe){z(arguments,2),this.i.push($(ae,Ee,Pe))},e.delete=function(ae){z(arguments,1);var Ee=[];ae=String(ae),H(this.i,function(Pe){Pe[0]!==ae&&Ee.push(Pe)}),this.i=Ee},e.entries=function ae(){var Ee,Pe=this;return M(ae,function(ce){if(ce.h==1&&(Ee=0),ce.h!=3)return Ee<Pe.i.length?ce=y(ce,Pe.i[Ee]):(ce.h=0,ce=void 0),ce;Ee++,ce.h=2})},e.forEach=function(ae,Ee){z(arguments,1);for(var Pe=d(this),ce=Pe.next();!ce.done;ce=Pe.next()){var C=d(ce.value);ce=C.next().value,C=C.next().value,ae.call(Ee,C,ce,this)}},e.get=function(ae){z(arguments,1);var Ee=this.i;ae=String(ae);for(var Pe=0;Pe<Ee.length;Pe++)if(Ee[Pe][0]===ae)return Ee[Pe][1];return null},e.getAll=function(ae){z(arguments,1);var Ee=[];return ae=String(ae),H(this.i,function(Pe){Pe[0]===ae&&Ee.push(Pe[1])}),Ee},e.has=function(ae){z(arguments,1),ae=String(ae);for(var Ee=0;Ee<this.i.length;Ee++)if(this.i[Ee][0]===ae)return!0;return!1},e.keys=function ae(){var Ee,Pe,ce,C,F=this;return M(ae,function(B){if(B.h==1&&(Ee=d(F),Pe=Ee.next()),B.h!=3)return Pe.done?void(B.h=0):(ce=Pe.value,C=d(ce),y(B,C.next().value));Pe=Ee.next(),B.h=2})},e.set=function(ae,Ee,Pe){z(arguments,2),ae=String(ae);var ce=[],C=$(ae,Ee,Pe),F=!0;H(this.i,function(B){B[0]===ae?F&&(F=!ce.push(C)):ce.push(B)}),F&&ce.push(C),this.i=ce},e.values=function ae(){var Ee,Pe,ce,C,F=this;return M(ae,function(B){if(B.h==1&&(Ee=d(F),Pe=Ee.next()),B.h!=3)return Pe.done?void(B.h=0):(ce=Pe.value,(C=d(ce)).next(),y(B,C.next().value));Pe=Ee.next(),B.h=2})},vn.prototype._asNative=function(){for(var ae=new de,Ee=d(this),Pe=Ee.next();!Pe.done;Pe=Ee.next()){var ce=d(Pe.value);Pe=ce.next().value,ce=ce.next().value,ae.append(Pe,ce)}return ae},vn.prototype._blob=function(){var ae="----formdata-polyfill-"+Math.random(),Ee=[],Pe="--"+ae+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ce,C){return typeof ce=="string"?Ee.push(Pe+wn(J(C))+`"\r
\r
`+J(ce)+`\r
`):Ee.push(Pe+wn(J(C))+'"; filename="'+wn(ce.name)+`"\r
Content-Type: `+(ce.type||"application/octet-stream")+`\r
\r
`,ce,`\r
`)}),Ee.push("--"+ae+"--"),new Blob(Ee,{type:"multipart/form-data; boundary="+ae})},vn.prototype[Symbol.iterator]=function(){return this.entries()},vn.prototype.toString=function(){return"[object FormData]"},ut&&!ut.matches&&(ut.matches=ut.matchesSelector||ut.mozMatchesSelector||ut.msMatchesSelector||ut.oMatchesSelector||ut.webkitMatchesSelector||function(ae){for(var Ee=(ae=(this.document||this.ownerDocument).querySelectorAll(ae)).length;0<=--Ee&&ae.item(Ee)!==this;);return-1<Ee}),$t&&(vn.prototype[$t]="FormData"),be){var ss=oe.XMLHttpRequest.prototype.setRequestHeader;oe.XMLHttpRequest.prototype.setRequestHeader=function(ae,Ee){ss.call(this,ae,Ee),ae.toLowerCase()==="content-type"&&(this.B=!0)},oe.XMLHttpRequest.prototype.send=function(ae){ae instanceof vn?(ae=ae._blob(),this.B||this.setRequestHeader("Content-Type",ae.type),be.call(this,ae)):be.call(this,ae)}}Re&&(oe.fetch=function(ae,Ee){return Ee&&Ee.body&&Ee.body instanceof vn&&(Ee.body=Ee.body._blob()),Re.call(this,ae,Ee)}),dt&&(oe.navigator.sendBeacon=function(ae,Ee){return Ee instanceof vn&&(Ee=Ee._asNative()),dt.call(this,ae,Ee)}),oe.FormData=vn}})();const Tf=()=>{const e=V("AREAS");return e.length===0&&e.push(St.GLOBAL),ks(e).call(e,(t,n,i)=>{const s=Lk(n);return s?i===0?s:"".concat(t,",").concat(s):t},"")},Lk=e=>e===St.OVERSEA?"".concat(Si.ASIA,",").concat(Si.EUROPE,",").concat(Si.AFRICA,",").concat(Si.NORTH_AMERICA,",").concat(Si.SOUTH_AMERICA,",").concat(Si.OCEANIA):Si[e],Bg={GLOBAL:{ASIA:[St.CHINA,St.JAPAN,St.INDIA,St.KOREA,St.HKMC],EUROPE:[],NORTH_AMERICA:[St.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Gg=Object.keys(Bg[St.GLOBAL]),iw=[St.CHINA,St.NORTH_AMERICA,St.EUROPE,St.ASIA,St.JAPAN,St.INDIA,St.OCEANIA,St.SOUTH_AMERICA,St.AFRICA,St.KOREA,St.HKMC,St.US],IK=function(e,t){let n=[];if(ve(e).call(e,St.GLOBAL)){const o=[St.GLOBAL,St.OVERSEA],c=Object.keys(Pg);if(t===St.GLOBAL)throw new Q(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===St.CHINA)n=[St.OVERSEA];else if(s=t,ve(Gg).call(Gg,s)){const d=(i=t,Bg[St.GLOBAL][i]||[]),p=[...o,t,...d];n=c.filter(f=>!ve(p).call(p,f))}else if(function(d){let p=!1;return Gg.forEach(f=>{var m;ve(m=Bg[St.GLOBAL][f]).call(m,d)&&(p=!0)}),p}(t)){const d=function(f){let m;return Gg.forEach(g=>{var v;ve(v=Bg[St.GLOBAL][g]).call(v,f)&&(m=g)}),m}(t),p=[...o,d,t];n=c.filter(f=>!ve(p).call(p,f))}else n=e;n=function(d){const p=[];return iw.forEach(f=>{ve(d).call(d,f)&&p.push(f)}),p.concat(d.filter(f=>!ve(iw).call(iw,f)))}(n)}else n=e;var i,s;return n};function xk(e){var t,n;if(!e&&ve(t=V("AREAS")).call(t,St.EXTENSIONS))return b.debug("update area from ap : reset"),void sw(U7,!0);if(!ve(n=V("AREAS")).call(n,St.GLOBAL)||!e)return;let i=Pg.EXTENSIONS;i&&(i={CODE:Lk(St.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},b.debug("update area from ap success: ".concat(e,",config is "),i),xt("AREAS",[St.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?xt(s,i[s][0]):xt(s,i[s])}))}function sw(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=xe.reportApiInvoke(null,{name:Mn.SET_AREA,options:e,tag:fn.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!ve(ek).call(ek,o))throw new Q(L.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:o,excludedArea:c}=e;if(!o)throw new Q(L.INVALID_PARAMS,"area code is needed");let d=o;typeof o=="string"&&(d=[o]),i=c?IK(d,c):d}if(!t){if(po.AREAS){const o=new Q(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void b.warning("setArea is prohibited because of config-distribute")}if(ve(i).call(i,St.GLOBAL)&&V("AREAS")===St.EXTENSIONS){const o=new Q(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void b.warning("setArea is prohibited because of ap extensions")}}xt("AREAS",i,t);const s=(o=>{const c={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(d=>{const p=Pg[d],f=Object.keys(p);f&&f.map(m=>{m!=="CODE"&&(c[m]=c[m].concat(p[m]))})}),c})(i);Object.keys(s).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?xt(o,s[o][0]):xt(o,s[o])}),b.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function kk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let rw=1;function OK(e,t,n,i,s){rw+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:rw,requestId:rw,version:or,cname:n.cname},c={service_name:t,json_body:JSON.stringify(o)};let d,p,f=e[0];return ho(async()=>{d=Date.now();const m=await Eo(f,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-d,m.code!==0){const y=new Q(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:p});throw b.error(y.toString()),y}const g=JSON.parse(m.json_body);if(g.code!==200){const y=new Q(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(g.code,", reason: ").concat(g.reason),{code:g.code,responseTime:p});throw b.error(y.toString()),y}if(!g.servers||g.servers.length===0){const y=new Q(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:g.code,responseTime:p});throw b.error(y.toString()),y}const v=function(y,D){return{addressList:y.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:y.workerToken,vid:y.vid}}(g,t);return V("LIVE_STREAMING_ADDRESS")&&(v.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),qo(qo({},v),{},{responseTime:p})},(m,g)=>(xe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:g===0,responseTime:p,serverIp:e[g%e.length]}),!1),(m,g)=>(xe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:p,serverIp:e[g%e.length]}),!!(m.code!==L.OPERATION_ABORTED&&m.code!==L.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=e[(g+1)%e.length],!0)),s)}let ow=1;function Mk(e,t,n,i){let{url:s,areaCode:o}=e;const{clientId:c,sid:d}=t,p=Date.now();let f;const m=t.role,[g,v]=cw(t,o,[Dn.CHOOSE_SERVER]);let y=Nn.networkState;return ho(async()=>{y&&Nn.networkState===Is.OFFLINE&&Nn.onlineWaiter&&await Te.race([Nn.onlineWaiter,ci(i&&i.maxRetryTimeout||jn.maxRetryTimeout)]),y=Nn.networkState;const{data:D,headers:A}=await Eo(s,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=A.http3==="1"?1:-1,xe.reportResourceTiming(s,d),Uk(D,s,t,p,[Dn.CHOOSE_SERVER],f);const I=gf(D,Dn.CHOOSE_SERVER);return aw(I),JR(I,s)},D=>(D&&xe.joinChooseServer(d,{role:m,lts:p,succ:!0,csAddr:s,opid:v,serverList:D.gatewayAddrs.map(A=>A.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Dn.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==L.OPERATION_ABORTED&&(D.code===L.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(xe.joinChooseServer(d,{role:m,lts:p,succ:!1,csAddr:s,serverList:null,opid:v,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Dn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),b.warning("[".concat(c||"sid-".concat(d.slice(0,6)),"] Choose server network error, retry"),D),!0)),i)}function jk(e,t,n,i){let s,{url:o,areaCode:c,serviceIds:d}=e;const p=Date.now(),f=t.role,[m,g]=cw(t,c,d);let v;return ho(async()=>{v&&Nn.networkState===Is.OFFLINE&&Nn.onlineWaiter&&await Te.race([Nn.onlineWaiter,ci(i&&i.maxRetryTimeout||jn.maxRetryTimeout)]),v=Nn.networkState;const{data:y,headers:D}=await Eo(o,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=D.http3==="1"?1:-1,xe.reportResourceTiming(o,t.sid),Uk(y,o,t,p,d,s);const A=gf(y,Dn.CHOOSE_SERVER),I=gf(y,t.cloudProxyServer==="proxy5"?Dn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Dn.CLOUD_PROXY:Dn.CLOUD_PROXY_FALLBACK);return aw(A),{gatewayInfo:JR(A,o),proxyInfo:I,url:o}},y=>(y.gatewayInfo&&xe.joinChooseServer(t.sid,{role:f,lts:p,succ:!0,csAddr:o,serverList:y.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:g,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38]}),y.proxyInfo&&xe.joinWebProxyAP(t.sid,{lts:p,sucess:1,apServerAddr:o,turnServerAddrList:y.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1),y=>y.code!==L.OPERATION_ABORTED&&(y.code===L.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(xe.joinWebProxyAP(t.sid,{lts:p,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:v})}),b.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),i)}const Uk=(e,t,n,i,s,o)=>{const{sid:c,clientId:d,cloudProxyServer:p}=n,f=[],m=g=>{g.flag===4096?xe.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||xe.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:g.error.code,eventType:p,unilbsServerIds:s.toString()})};if(e.response_body.forEach(g=>{const v=g.buffer.code;if(g.uri===23&&v===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{const y={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:g.buffer.flag};f.push(y),m(y)}if(v!==0){const y=th(v),D={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?b.warning(D.error.toString()):f.push(D),m(D)}}),f.length)throw b.warning("[".concat(d||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry)).join(" | "))),new Q(L.CAN_NOT_GET_GATEWAY_SERVER,f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message)).join(" | "),{retry:!!f.find(g=>g.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(g=>{var v;return g==null||(v=g.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(g=>!!g))]})},aw=e=>{var t,n,i,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(V("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?xk(e.detail[23].toLowerCase()):xk()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],d=c==null?void 0:c.split(";");for(let p=0;p<d.length;p++){var o;const f=Li(o=d[p]).call(o);e.addresses[p]&&d&&(e.addresses[p].fingerprint=f)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){b.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const c=V("GATEWAY_ADDRESS").map(d=>{var p,f;const m=(p=(f=e.addresses.find(g=>g.ip===d.ip&&g.port===d.port))===null||f===void 0?void 0:f.fingerprint)!==null&&p!==void 0?p:"";return{ip:d.ip,port:d.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=c}},NK=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=th(n.buffer.code);throw new Q(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw b.debug("update ticket request received ap response without response body:",t),new Q(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},cw=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),s=e.role==="host"?"1":e.role==="audience"?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:qo(qo(qo({6:e.stringUid,11:t,12:V("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]},DK=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,n]};let oh=0;function ah(e){return Te.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const yf=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:s,promisesCollector:o}=e,c=0;const d=t;let p,f=0;const m=async()=>{const g=(()=>{const v=c*d,y=v+d;return n.slice(v,y).map(i)})();o&&o.push(...g);try{p=await ah(g)}catch(v){if(f+=d,c++,!(f>=n.length))return void await m();s(v)}g.forEach(v=>v.cancel())};return await m(),p},Vk=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const s=t.length;let o=0;const c=async()=>{const d=n(t.shift());try{return await d}catch(p){if(o++,o>=s||i!=null&&i(p))throw p;return c()}};return c()};async function lw(e,t,n,i){return{gatewayInfo:await async function(o,c,d,p){let f=null;const m=[],g=async()=>{const y=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(I=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Tf()})),D=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),A=await yf({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(b.debug("[".concat(o.clientId,"] Connect to choose_server:"),I.url),Mk(I,o,c,d)),allFailedhandler:I=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},D),I[0]},promisesCollector:m});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},v=async()=>{if(await ci(1e3),f!==null)return f;const y=V("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Tf()})),D=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),A=await yf({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(b.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),I.url),Mk(I,o,c,d)),allFailedhandler:I=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},D),I[0]},promisesCollector:m});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};try{return f=await ah([g(),v()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),f}catch(y){throw y[0]}}(e,t,n,i)}}async function Fk(e,t,n,i,s){const o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await lw(e,t,n,s);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await Hk(e,t,n,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:v};const D=y.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||mi.tcpport,udpport:A.udpport||mi.udpport,username:A.username||mi.username,password:A.password||mi.password,forceturn:!1,security:!0}));if(s.useP2P){var c;const A=(c=e.uid)!==null&&c!==void 0?c:v.uid,I="glb:".concat(A.toString()),k=await iR(I),M=y.map(H=>({turnServerURL:H.address,tcpport:H.tcpport||mi.tcpport,udpport:H.udpport||mi.udpport,username:I,password:k,forceturn:!1,security:!0}));D.push(...M)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:v}}return await lw(e,t,n,s)}const{proxyInfo:d,gatewayInfo:p}=await Hk(e,t,n,s),f={gatewayInfo:p},m=d.map(v=>({turnServerURL:v.address,tcpport:o==="proxy3"?void 0:v.tcpport?v.tcpport:mi.tcpport,udpport:o==="proxy4"?void 0:v.udpport?v.udpport:mi.udpport,username:v.username||mi.username,password:v.password||mi.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(s.useP2P){var g;const v=(g=e.uid)!==null&&g!==void 0?g:p.uid,y="glb:".concat(v.toString()),D=await iR(y),A=d.map(I=>({turnServerURL:I.address,tcpport:o==="proxy3"?void 0:I.tcpport||mi.tcpport,udpport:o==="proxy4"?void 0:I.udpport||mi.udpport,username:y,password:D,forceturn:o!=="proxy4",security:o==="proxy5"}));m.push(...A)}return e.turnServer={mode:"manual",servers:m},b.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),f}async function Bk(e,t,n,i,s){const o=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?o.map(p=>"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v1")):o.map(p=>"https://".concat(p,"/api/v1"));const d=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const p=await async function(f,m,g,v,y){const D=Date.now(),A={sid:g.sid,opid:10,appid:g.appId,string_uid:m};let I=f[0];const k=await ho(()=>Eo(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(M,H)=>{if(M.code===0){if(M.uid<=0||M.uid>=Math.pow(2,32))throw b.error("Invalid Uint Uid ".concat(m," => ").concat(M.uid),M),xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:I,stringUid:A.string_uid,uid:M.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new Q(L.INVALID_UINT_UID_FROM_STRING_UID);return xe.reqUserAccount(A.sid,{lts:D,success:!0,serverAddr:I,stringUid:A.string_uid,uid:M.uid,errorCode:null,extend:A}),!1}const J=th(M.code);return J.retry&&(I=f[(H+1)%f.length]),xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:I,stringUid:A.string_uid,uid:M.uid,errorCode:J.desc,extend:A}),J.retry},(M,H)=>M.code!==L.OPERATION_ABORTED&&(xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:I,stringUid:A.string_uid,uid:null,errorCode:M.code,extend:A}),I=f[(H+1)%f.length],!0),y);if(k.code!==0){const M=th(k.code);throw new Q(L.UNEXPECTED_RESPONSE,M.desc)}return k}(c,e,t,n,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},d),p.uid}catch(p){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},d),p}}async function PK(e,t,n){const i=V("ACCOUNT_REGISTER");let s=[];s=t.proxyServer?i.map(o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1")):i.map(o=>"https://".concat(o,"/api/v1"));try{return await Vk({referenceList:s,asyncMapHandler:c=>async function(d,p,f,m){const g=Date.now(),v={sid:f.sid,opid:10,appid:f.appId,string_uid:p};try{const y=await Eo(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const D=th(y.code);throw new Q(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new Q(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:g,url:d,req:v,uid:y.uid,elapse:Date.now()-g}}catch(y){throw y}}(c,e,t,n),closeFn:c=>c.code===L.OPERATION_ABORTED||c.code===L.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(o){throw o}}async function LK(e,t,n){const i=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")),s=i.map(p=>function(f,m,g,v){const y=Et(),D={flag:64,cipher_method:0,features:qo(qo(qo(qo(qo({install_id:fR(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:or,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:RK.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return ho(()=>Eo(f,{data:D,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==L.OPERATION_ABORTED,v)}(p,e,t,n));let o=null,c=null,d={};try{o=await ah(s)}catch(p){if(p.code===L.OPERATION_ABORTED)throw p;c=p}if(s.forEach(p=>p.cancel()),xe.reportApiInvoke(e.sid,{name:Mn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:o}}).onSuccess(),o&&o.test_tags)try{d=function(p){if(!p.test_tags)return{};const f=p.test_tags,m=Object.keys(f),g={};return m.forEach(v=>{var y;const D=Li(y=v.slice(4)).call(y),A=JSON.parse(f[v]),I=A[1];g[D]={tag:A[0]||"",value:I}}),g}(o)}catch{}return d}async function Gk(e,t){const n=V("WEBCS_DOMAIN").concat(V("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Tf(),serviceIds:[Dn.CHOOSE_SERVER,Dn.CLOUD_PROXY_FALLBACK]}));try{return await Vk({referenceList:n,asyncMapHandler:s=>async function(o,c,d){let p,{url:f,areaCode:m,serviceIds:g}=o;const v=Date.now(),[y,D]=cw(c,m,g);let A=Nn.networkState;try{A&&Nn.networkState===Is.OFFLINE&&Nn.onlineWaiter&&await Te.race([Nn.onlineWaiter,ci(jn.maxRetryTimeout)]),A=Nn.networkState;const{data:I,headers:k}=await Eo(f,{data:y,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=k.http3==="1"?1:-1,($=>{const z=[];if($.response_body.forEach(oe=>{const de=oe.buffer.code;if(oe.uri===23&&de===0&&!oe.buffer.edges_services)if(oe.buffer.flag===4194310)oe.buffer.edges_services=[];else{const be={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:$.detail[502]}),flag:oe.buffer.flag};z.push(be)}if(de!==0){const be=th(de),Re={error:new Q(L.CAN_NOT_GET_GATEWAY_SERVER,be.desc,{desc:be.desc,retry:be.retry,csIp:$.detail[502]}),flag:oe.buffer.flag};oe.buffer.flag===4194310?b.warning(Re.error.toString()):z.push(Re)}}),z.length)throw new Q(L.CAN_NOT_GET_GATEWAY_SERVER,z.map(oe=>"flag: ".concat(oe.flag,", message: ").concat(oe.error.message)).join(" | "),{retry:!!z.find(oe=>oe.error.data.retry),csIp:$.detail[502],desc:[...new Set(z.map(oe=>{var de;return oe==null||(de=oe.error)===null||de===void 0||(de=de.data)===null||de===void 0?void 0:de.desc}).filter(oe=>!!oe))]})})(I);const H=gf(I,Dn.CHOOSE_SERVER),J=gf(I,Dn.CLOUD_PROXY_FALLBACK);return aw(H),{gatewayInfo:JR(H,f),proxyInfo:J,opid:D,requestTime:v,url:f,isHttp3:p,elapse:Date.now()-v}}catch(I){throw I}}(s,e,t),closeFn:s=>s.code===L.OPERATION_ABORTED||s.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(i){throw i}}async function Hk(e,t,n,i){const s=V("PROXY_SERVER_TYPE3"),o=(y,D,A)=>{let I=A||s;return Array.isArray(I)&&(I=D%2==0?s[1]:s[0]),"https://".concat(I,"/ap/?url=").concat(y)};let c=null;const d=[],p=async()=>{const y=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((I,k)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(I,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):o("".concat(I,"/api/v2/transpond/webrtc?v=2"),k),{url:M,areaCode:Tf(),serviceIds:[Dn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Dn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Dn.CLOUD_PROXY:Dn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),A=await yf({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(b.debug("[".concat(e.clientId,"] Connect to choose_server:"),I.url),jk(I,e,t,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},D),I[0]},promisesCollector:d});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},f=async()=>{if(await ci(1e3),c!==null)return c;const y=V("WEBCS_DOMAIN_BACKUP_LIST").map((I,k)=>{let M;return M=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(I,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):o("".concat(I,"/api/v2/transpond/webrtc?v=2"),k),{url:M,areaCode:Tf(),serviceIds:[Dn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Dn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Dn.CLOUD_PROXY:Dn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(I=>I.url)}),A=await yf({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:I=>(b.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),I.url),jk(I,e,t,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},D),I[0]},promisesCollector:d});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};let m,g,v;try{({gatewayInfo:m,proxyInfo:g,url:v}=await ah([p(),f()]))}catch(y){throw y[0]}if(d.length&&d.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!g)throw new Q(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=v,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];ve(s).call(s,y)&&(e.proxyServer=y,b.setProxyServer(y),xe.setProxyServer(y))}return c={gatewayInfo:m,proxyInfo:await pk(g,m.uid)},c}async function xK(e,t,n){const i=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),s=i.map(o=>function(c,d,p,f){const m={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:or,cname:d.cname,uid:d.uid.toString(),requestId:ow,seq:ow};ow+=1;const g={service_name:"tele_channel",json_body:JSON.stringify(m)};return ho(async()=>{const v=await Eo(c,{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const D=new Q(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw b.error(D.toString()),D}const y=JSON.parse(v.json_body);if(y.code!==200){const D=new Q(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw b.error(D.toString()),D}if(!y.servers||y.servers.length===0){const D=new Q(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw b.error(D.toString()),D}return{vid:y.vid,workerToken:y.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,v=>!!(v.code!==L.OPERATION_ABORTED&&v.code!==L.UNEXPECTED_RESPONSE||v.data&&v.data.retry),f)}(o,e,t,n));try{const o=await ah(s);return s.forEach(c=>c.cancel()),o}catch(o){throw o[0]}}async function kK(e,t,n){let i=null;const s=[],o=async c=>{const d=V(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return c&&(await ci(1e3),i!==null)?i:await yf({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:p=>(b.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),p),function(f,m,g,v){const[y]=DK(m,[Dn.CHOOSE_SERVER]);let D=Nn.networkState;return ho(async()=>{D&&Nn.networkState===Is.OFFLINE&&Nn.onlineWaiter&&await Te.race([Nn.onlineWaiter,ci(v&&v.maxRetryTimeout||jn.maxRetryTimeout)]),D=Nn.networkState;const A=await Eo(f,{data:y,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0);return NK(A,f)},()=>!1,A=>A.code!==L.OPERATION_ABORTED&&(A.code===L.UPDATE_TICKET_FAILED?A.data.retry:(b.warning("[".concat(m.clientId,"] update ticket network error, retry"),A),!0)),v)}(p,e,t,n)),allFailedhandler:p=>{throw p[0]},promisesCollector:s})};try{return i=await ah([o(!1),o(!0)]),s.length&&s.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function Wk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function dw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Wk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class MK extends dn{get isSuccess(){return!!this.configs}constructor(t,n){super(),N(this,"configs",void 0),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",void 0),N(this,"mutableParamsRead",!1),N(this,"configCache",{}),N(this,"limit_bitrate",void 0),this.mutex=new vi("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,xe.reportApiInvoke(null,{options:void 0,name:Mn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:fn.TRACER}).onSuccess(JSON.stringify(po))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void b.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await LK(this.joinInfo,this.cancelToken,this.retryConfig),b.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(s){var o;const c=Wp(o=Object.keys(s).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(o);for(let f=0;f<c.length;f++)for(let m=c.length-1;m>f;m--){const g=c[m],v=s[g].value;if(typeof v.__priority=="number"){const y=v.__priority,D=c[m-1],A=s[D].value;if(typeof A.__priority=="number"){if(!(y>A.__priority))continue;{const I=g;c[m]=c[m-1],c[m-1]=I}}else{const I=g;c[m]=c[m-1],c[m-1]=I}}}const d=Date.now();let p={};return c.forEach(f=>{const m=s[f].value.__expires;m&&m<=d||(p[f]=s[f])}),p}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const s=new Q(L.NETWORK_RESPONSE_ERROR,i);b.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){tk(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(mf.UPDATE_BITRATE_LIMIT,t):this.emit(mf.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&dw({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),s=[];i.forEach(o=>{const c=t[o].value;n[o]=c;const d=c.__id;if(d&&this.configCache[o]&&this.configCache[o].__id===d)return;const p=c.__type,f=t[o].value,m=t[o].tag;let g=0;p?p===k1.REALTIME&&(g=1):Object.keys(f).some(v=>Object.prototype.hasOwnProperty.call(gR,v)||!FR()&&Object.prototype.hasOwnProperty.call(dg,v)?(g=1,!0):void 0),s.push({tag:m,isApplied:g,feature:o,params:JSON.stringify(c)})}),s.forEach(o=>{let{tag:c,feature:d,params:p,isApplied:f}=o;this.store.sessionId&&xe.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:c,feature:d,params:p,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){b.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(s){const o={};return Object.keys(s).forEach(c=>{const d=s[c].value,p=d.__expires,f=d.__type;Object.keys(d).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(o,m)||(o[m]=dw(dw({value:d[m]},p&&{expires:p}),f&&{type:f}))})}),o}(t);try{var i;const s=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,s&&tk(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(d){try{const p=Date.now();Object.keys(d).forEach(f=>{const{value:m,type:g,expires:v}=d[f];v&&v<=p||((g===k1.REALTIME||Object.prototype.hasOwnProperty.call(gR,f))&&(po[f]=m,un[f]=m,b.debug("Update realtime parameters from config distribute",f,m)),g||FR()||!Object.prototype.hasOwnProperty.call(dg,f)||(po[f]=m,un[f]=m,b.debug("Update gateway parameters from config distribute",f,m)))})}catch(p){b.error("Error update config immediately: ".concat(d),p.message)}}(n);const o=JSON.stringify(n),c=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",c),b.debug("Caching global parameters ".concat(o))}catch(s){b.error("Error caching global parameters:",s.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(un,i)){const{value:s,expires:o}=t[i];if(o&&o<=n)return;(function(c,d){try{return typeof c=="object"&&typeof d=="object"&&JSON.stringify(c)===JSON.stringify(d)}catch{return!1}})(un[i],s)||(po[i]=s,un[i]=s,this.emit(mf.UPDATE_CLIENT_ROLE_OPTIONS,s),b.debug("Updating client role options: ".concat(JSON.stringify(s))))}})}catch(n){b.error("Error handling global parameter config:",n.message)}}}class jK extends dn{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(V("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var o;const c=ve(o=s.result).call(o,!0);s.isPrevNormal&&!c&&this.emit("exception",Kk[t],t,n),!s.isPrevNormal&&c&&this.emit("exception",Kk[t]+2e3,t+"_RECOVER",n),s.isPrevNormal=c,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Bn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Os(n._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Bn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Kk={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ti=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function zk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Xl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class bf{constructor(t){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",lg.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new jK,this.exceptionMonitor.on("exception",(n,i,s)=>{this.onStatsException&&this.onStatsException(n,i,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(le.LocalAudioTrack)||Xl({},bR)}getLocalVideoTrackStats(){return this.localStats.get(le.LocalVideoTrack)||Xl({},CR)}getRemoteAudioTrackStats(t){const n=(o,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find(p=>p.peer_uid===o);return d&&(c.publishDuration=d.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var s;const o=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{audioStats:d}]=o;d&&(i[c]=n(c,d))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(n[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{networkStats:c}]=s;c&&(n[o]=c)});return n}getRemoteVideoTrackStats(t){const n=(o,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find(p=>p.peer_uid===o);return d&&(c.publishDuration=d.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var s;const o=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{videoStats:d}]=o;d&&(i[c]=n(c,d))});return i}getRTCStats(){let t=0,n=0,i=0,s=0;const o=this.localStats.get(le.LocalAudioTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(le.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const d=this.localStats.get(le.LocalVideoLowTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:g}=f;m&&(i+=m.receiveBytes,s+=m.receiveBitrate),g&&(i+=g.receiveBytes,s+=g.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),o=s!=null&&s.videoSSRC?Ti.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,c=s!=null&&s.audioSSRC?Ti.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>c?o:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&b.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const s=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,o=!i||n.framesDecodeCount>i.framesDecodeCount;return s||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,s]=n;switch(i){case le.LocalVideoTrack:case le.LocalVideoLowTrack:{const c=s,d=Xl({},CR),p=t.getStats(),f=t.getLocalMedia(i);if(p){const m=p.videoSend.find(g=>g.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){const g=t.getLocalVideoSize(),v=t.getEncoderConfig(le.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(d.codecType=m.codec),d.sendBytes=m.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,m.inputFrame?(d.captureFrameRate=m.inputFrame.frameRate,d.captureResolutionHeight=m.inputFrame.height,d.captureResolutionWidth=m.inputFrame.width):g&&(d.captureResolutionWidth=g.width,d.captureResolutionHeight=g.height),m.sentFrame?(d.sendFrameRate=m.sentFrame.frameRate,d.sendResolutionHeight=m.sentFrame.height,d.sendResolutionWidth=m.sentFrame.width):g&&(d.sendResolutionWidth=g.width,d.sendResolutionHeight=g.height),m.avgEncodeMs&&(d.encodeDelay=m.avgEncodeMs),v&&v.bitrateMax&&(d.targetSendBitrate=1e3*v.bitrateMax),d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(d.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(b.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(i,d),((c==null?void 0:c.sendResolutionWidth)!==d.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==d.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,d);break}case le.LocalAudioTrack:{const c=s,d=Xl({},bR),p=t.getStats(),f=t.getLocalMedia(i);if(p){const m=p.audioSend.find(g=>g.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(d.codecType=m.codec),m.inputLevel)d.sendVolumeLevel=Math.round(32767*m.inputLevel);else{const g=t.getLocalAudioVolume();g&&(d.sendVolumeLevel=Math.round(32767*g))}d.sendBytes=m.bytes,d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(le.LocalAudioTrack,d),d&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,d);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,s;let[o,{videoStats:c,audioStats:d,videoPcStats:p}]=n;const f=d,m=c,g=p,v=Xl({},W1),y=Xl({},K1),D=Xl({},v7),{audioTrack:A,videoTrack:I,audioSSRC:k,videoSSRC:M}=t.getRemoteMedia(o);let H;H=this.store.useP2P?t.getStats(!0):t.getStats();const J=(i=H)===null||i===void 0?void 0:i.audioRecv.find(de=>de.ssrc===k),$=(s=H)===null||s===void 0?void 0:s.videoRecv.find(de=>de.ssrc===M),z=this.trafficStats&&this.trafficStats.peer_delay.find(de=>de.peer_uid===o);if(J&&(J.codec!=="opus"&&J.codec!=="aac"&&J.codec!=="PCMU"&&J.codec!=="PCMA"&&J.codec!=="G722"||(v.codecType=J.codec),J.outputLevel?v.receiveLevel=Math.round(32767*J.outputLevel):A&&(v.receiveLevel=Math.round(32767*A.getVolumeLevel())),v.receiveBytes=J.bytes,v.receivePackets=J.packets,v.receivePacketsLost=J.packetsLost,v.receivePacketsDiscarded=J.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=f?8*Math.max(0,v.receiveBytes-f.receiveBytes):0,v.totalDuration=f?f.totalDuration+1:1,v.totalFreezeTime=f?f.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=J.jitterBufferMs,v.totalDuration>10&&bf.isRemoteAudioFreeze(A)&&(v.totalFreezeTime+=1)),$){var oe;$.codec!=="H264"&&$.codec!=="H265"&&$.codec!=="VP8"&&$.codec!=="VP9"&&$.codec!=="AV1X"&&$.codec!=="AV1"||(y.codecType=$.codec),y.receiveBytes=$.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=$.decodeFrameRate<0?0:$.decodeFrameRate,y.renderFrameRate=$.decodeFrameRate<0?0:$.decodeFrameRate,$.outputFrame&&(y.renderFrameRate=$.outputFrame.frameRate),$.receivedFrame?(y.receiveFrameRate=$.receivedFrame.frameRate,y.receiveResolutionHeight=$.receivedFrame.height,y.receiveResolutionWidth=$.receivedFrame.width):I&&(y.receiveResolutionHeight=I._videoHeight||0,y.receiveResolutionWidth=I._videoWidth||0),$.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round($.framesRateFirefox)),y.receivePackets=$.packets,y.receivePacketsLost=$.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const de=m?m.totalFreezeTime:0,be=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(oe=$.totalFreezesDuration)!==null&&oe!==void 0?oe:de||0,y.receiveDelay=$.jitterBufferMs||0;const Re=!!M&&t.getRemoteVideoIsReady(M);$.totalFreezesDuration===void 0&&I&&Re&&bf.isRemoteVideoFreeze(I,$,g)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-de)/(y.totalDuration-be),1))}z&&(v.end2EndDelay=z.B_ad,y.end2EndDelay=z.B_vd,v.transportDelay=z.B_ed,y.transportDelay=z.B_ed,v.currentPacketLossRate=z.B_ealr4/100,y.currentPacketLossRate=z.B_evlr4/100,D.uplinkNetworkQuality=z.B_punq?z.B_punq:0,D.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(o,{audioStats:v,videoStats:y,videoPcStats:$,networkStats:D}),A&&this.exceptionMonitor.setRemoteAudioStats(A,v),I&&this.exceptionMonitor.setRemoteVideoStats(I,y)})}}class Yk{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Zx(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Zx(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Og(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function qk(e){if(!(e instanceof Yk))return new Q(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new Q(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Q(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Bc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function $k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$k(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$k(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Cf="9",Xk=4e4;let UK=class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_originCandidates",void 0),N(this,"_iceParameters",void 0),N(this,"_isUseExtmapAllowMixed",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,e=En(e);const{iceParameters:n,dtlsParameters:i,candidates:s,rtpCapabilities:o,setup:c,localCapabilities:d,cname:p}=e;this._rtpCapabilities=o,this._candidates=s,this._originCandidates=En(s),this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=d,this.setup=c,this.cname=p,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const t=this.candidates,n=this.dtlsParameters,i=this.iceParameters,s=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let c=1;c<e;c++){const d=2*c+2e4,p=2*c+Xk,{ssrcs:f,ssrcGroups:m}=$l([{ssrcId:d}],this.cname),{ssrcs:g,ssrcGroups:v}=$l([{ssrcId:p,rtx:V("USE_SUB_RTX")?p+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Cf,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:s.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:s.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Cf,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:s.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:s.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return kc(this.sessionDesc)}send(e,t,n,i){const{ssrcs:s,ssrcGroups:o}=$l(t,this.cname,V("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(_n()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(e,s);let p;return d===-1||d===1&&(hi()||function(){const f=Et();return!(f.name!==bt.CHROME||!f.osVersion)&&Number(f.version)<=90}()||V("ENABLE_ENCODED_TRANSFORM")&&Pa())||d===0&&V("USE_SUB_RTX")||r1()?(p=this.createOrRecycleSendMedia(e,s,o,"sendonly",i),this.updateBundleMids()):(p=En(this.sessionDesc.mediaDescriptions[d]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(p,i)),_n()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(s=>{let{kind:o,ssrcMsg:c,mslabel:d}=s;return this.send(o,c,d)}),n=[];let i=!1;return t.forEach(s=>{let{mid:o,needExchangeSDP:c}=s;c&&(i=!0),n.push(o)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||_n()||r1()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((s,o)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",t,n,i[o])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||ls((n=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;const i=this.rtpCapabilities.send,s=this.localCapabilities.send;for(const o of t.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"){if(i.videoCodecs.length===0){const c=s.videoCodecs.filter(d=>{var p,f;return(p=d.rtpMap)===null||p===void 0?void 0:ve(f=p.encodingName.toLowerCase()).call(f,"vp8")})||[s.videoCodecs[0]];o.media.fmts=c.map(d=>d.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.videoCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:d}=$l([{ssrcId:Xk,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=d}}if(o.media.mediaType==="audio"){if(i.audioCodecs.length===0){const c=s.audioCodecs.filter(d=>{var p,f;return(p=d.rtpMap)===null||p===void 0?void 0:ve(f=p.encodingName.toLowerCase()).call(f,"opus")})||[s.audioCodecs[0]];o.media.fmts=c.map(d=>d.payloadType.toString(10)),o.attributes.payloads=c,o.attributes.extmaps=[]}else if(o.media.fmts=i.audioCodecs.map(c=>c.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,rh(o),V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:c,ssrcGroups:d}=$l([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=c,o.attributes.ssrcGroups=d}}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(Jk(Jk({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case Ii.TCP_RELAY:this._candidates=n;break;case Ii.UDP_TCP_RELAY:case Ii.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=En(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(_n()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!s||s!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Cf,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,s,o){const c=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,p=Sf(c,d,this.localCapabilities.send,c===Oe.VIDEO?i:s),f=c===Oe.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let g={media:{mediaType:c,port:Cf,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};g=this.mungRecvMediaDsec(g,e,o);const v=this.findFirstClosedMedia(c);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").filter(g=>{var v;return ve(v=Object.keys(ug)).call(v,g)}))],s=new Set(t);if(i.every(g=>s.has(g)))return b.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(g=>t.some(v=>{var y;return ve(y=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(y,v)}));if(o.length===0)return b.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const c=[...new Set(o.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||""))];let d;if(b.debug("updateRemoteCodec, from ".concat(i," to ").concat(c)),e.length===0)d=this.sessionDesc.mediaDescriptions.filter(g=>g.media.mediaType==="video"&&g.attributes.direction==="recvonly");else if(d=this.sessionDesc.mediaDescriptions.filter(g=>g.attributes.mid&&ve(e).call(e,g.attributes.mid)&&g.attributes.direction==="recvonly"),d.length!==e.length)return b.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(V("USE_PUB_RTX")||V("USE_SUB_RTX")){const g=ew(o,this.rtpCapabilities.recv.videoCodecs);o.push(...g)}this._rtpCapabilities.recv.videoCodecs=o;const p=this.localCapabilities.send,f=this.rtpCapabilities.recv,m=Sf(Oe.VIDEO,f,p,n);return d.forEach(g=>{const v=m.map(y=>y.payloadType.toString(10));b.debug("updateRemoteCodec mid: ".concat(g.attributes.mid,", from"),g.attributes.payloads,"to",m),g.attributes.payloads=m,g.media.fmts=v}),!0}createOrRecycleSendMedia(e,t,n,i,s){const o=this.rtpCapabilities.send,c=e===Oe.VIDEO?o.videoCodecs:o.audioCodecs,d=e===Oe.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:e,port:Cf,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,s);const m=this.findFirstClosedMedia(e);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=En(e);return QR(i),sh(i,t),ZR(i,t),Tk(i),jg(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=En(e);return jg(n,t,this.localCapabilities.recv),rh(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>_n()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function Qk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Ba(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qk(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var ch=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(ch||{});const Hg=new Map;function Zk(e,t,n,i){let{scale:s}=e;if(s===0&&i===ch.UP||s>=t.length-1&&i===ch.DOWN)return e;let o=Ba(Ba({},e),{},{scale:i===ch.DOWN?++s:--s});switch(n){case"maintain-framerate":o=Ba(Ba({},o),t[s].motion);break;case"maintain-resolution":o=Ba(Ba({},o),t[s].detail);break;case"balanced":o=Ba(Ba({},o),t[s].balanced)}return o}function eM(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:tM(t)};Hg.set(e,n)}else Hg.delete(e)}function tM(e){const t=Ba({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:s,bitrateMin:o}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:d,MAX_SCALE:p,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:g,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:I,BALANCE_RESOLUTION_FACTOR:k,MOTION_RESOLUTION_FACTOR:M,MOTION_BITRATE_FACTOR:H,DETAIL_FRAMERATE_FACTOR:J,DETAIL_BITRATE_FACTOR:$}=_R,z=Math.min(t.frameRate,d),oe=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*z),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o}}];for(let de=1;de<=p;de++){const be={bwe_up:Math.round(Math.pow(g,de)*n),bwe_down:Math.round(Math.pow(v,de+1)*n),fps_up:Math.round(Math.pow(D,de)*z),fps_down:Math.round(Math.pow(y,de+1)*z)},Re={scaleResolutionDownBy:s/Math.pow(k,de),frameRate:Math.max(Math.round(Math.pow(I,de)*i),c),bitrateMax:Math.max(Math.round(Math.pow(A,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow(A,de)*o),f)},dt={scaleResolutionDownBy:s/Math.pow(M,de),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(H,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow(H,de)*o),f)},ut={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(J,de)*i),c),bitrateMax:Math.max(Math.round(Math.pow($,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow($,de)*o),f)};oe.push({scale:de,threshold:be,balanced:Re,motion:dt,detail:ut})}return oe}function VK(e,t,n,i,s,o){const c=Hg.get(e)||{overUse:0,underUse:0,adaptationList:tM(s)},{adaptationList:d}=c;Hg.set(e,c);const{OVERUSE_TIMES_THRESHOLD:p,UNDERUSE_TIMES_THRESHOLD:f}=_R,{scale:m}=i;let g,v;return typeof t=="number"&&t>0&&function(y,D,A,I){if(D>=A.length)return!1;let{threshold:{fps_down:k}}=A[D];return V("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(k=A[0].threshold.fps_down),y<k}(t,m,d,o)&&(c.overUse++,v=lf.CPU,c.overUse>p)||typeof n=="number"&&n>0&&function(y,D,A){if(D>=A.length)return!1;const{threshold:{bwe_down:I}}=A[D];return y<I}(n,m,d)&&(c.overUse++,v=lf.BANDWIDTH,c.overUse>p)?(c.overUse=0,c.underUse=0,g=Zk(i,d,o,ch.DOWN),[g,v]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(y,D,A,I){if(D===0)return;let{threshold:{fps_up:k}}=A[D];return V("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(k=A[1].threshold.fps_up),y>k}(t,m,d,o)&&function(y,D,A){if(D===0)return;const{threshold:{bwe_up:I}}=A[D];return y>I}(n,m,d)&&(c.underUse++,c.underUse>f&&(c.overUse=0,c.underUse=0,g=Zk(i,d,o,ch.UP),g.scale===0&&(v=lf.NONE))),[g,v])}function nM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function uw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nM(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function FK(e){var t;return!!V("ENABLE_AG_ADAPTATION")&&!!(e instanceof LR||ve(t=e._hints).call(t,qt.CUSTOM_TRACK))&&(!!V("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=Et();if(i.os!==Kn.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return Number(s[0])>=n}(14)&&i1(17,4)||n1(14)&&s1(17,4)))}const Wg=new Map;function Kg(e,t){const n=Wg.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),Wg.delete(e)}t.qualityLimitationReason=lf.NONE,eM(e)}function BK(e,t){var n;let i;switch(t){case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoTrack:i=ve(n=e._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:i=Nt.Low}return i}function hw(e){const t=gt();if(e.some(n=>n._bypassWebAudio))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function pw(e,t){hw(e);const n=new Bn;return e.forEach(i=>n.addAudioTrack(i)),n}const GK=!gt().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&La();function zg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return GK?(n={spec:t,store:e},Fc("PlanBConnection").create(n)):new Ga(t,e)}function fw(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function iM(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(of(e.turnServer.servers))return!1;if(V("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var pt;function sM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function go(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sM(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ga=(pt=class nm extends ik{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ve(n=Object.keys(ug)).call(n,t)}))]}constructor(t,n){super(t,n),N(this,"id",Yt(5,"connection-")),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"forceTurn",!1),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:V("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preSSRCMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"supportAV1RtpSpec",!1),N(this,"mutex",void 0),N(this,"qualityLimitationReason",lf.NONE),this.store=n,this.forceTurn=iM(t),this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(nm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pR(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(s=>s.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void b.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();s==null||s(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else b.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Vc(i.sdp),o=await bk({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Ug(o),this.initialOffer=i,V("ENABLE_SVC")&&this.store.codec=="av1"){const d=await async function(){try{const p=new RTCPeerConnection;p.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:lg.L1T3}]});const f=await p.createOffer();if(!f.sdp)return void p.close();const m=ls(f.sdp).mediaDescriptions[0];if(!m)return;const g=m.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return p.close(),g}catch{return}}();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let c;return i.sdp&&Ak(i.sdp)&&(c=En(o),(n=c).send&&(ih(Oe.VIDEO,n.send.videoExtensions),ih(Oe.AUDIO,n.send.audioExtensions)),n.recv&&(ih(Oe.VIDEO,n.recv.videoExtensions),ih(Oe.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(ih(Oe.VIDEO,n.sendrecv.videoExtensions),ih(Oe.AUDIO,n.sendrecv.audioExtensions))),go(go({},s),{},{rtpCapabilities:c||o,offerSDP:i.sdp})}catch(i){throw new re(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Ak(this.initialOffer.sdp)&&(n=t.rtpCapabilities,i=this.localCapabilities,n.send&&(kg(Oe.VIDEO,n.send.videoExtensions,i.send.videoExtensions),kg(Oe.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(kg(Oe.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),kg(Oe.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new UK(go(go({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),o=Rk(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),V("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(V("PRELOAD_MEDIA_COUNT"));const f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const m=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(m)}const{preSSRCs:p}=t;if(Array.isArray(p)&&p.length>0){const{mids:f}=this.remoteSDP.batchSend(p.map(m=>({kind:m.kind,ssrcMsg:[{ssrcId:m.ssrcId,rtx:m.rtx}],mslabel:m.mslabel})));f.forEach((m,g)=>{this.preSSRCMap.set(p[g].ssrcId,m)}),await Vg(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(s){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}var n,i}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=t;if(Array.isArray(i)&&i.length>0){const{mids:s}=this.remoteSDP.batchSend(i.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));s.forEach((o,c)=>{this.preSSRCMap.set(i[c].ssrcId,o)})}await Vg(this.peerConnection,this.remoteSDP,this.extension),b.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var s=this;return rr(function*(){const o=yield ft(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],d=xg();t.forEach(I=>{const k=s.peerConnection.addTransceiver(I._mediaStreamTrack,go({direction:"sendonly"},I.trackMediaType==="video"&&s.supportAV1RtpSpec&&d?{sendEncodings:[{scalabilityMode:d}]}:{}));c.push(k),I._updateRtpTransceiver(k)}),_n()&&V("SIMULCAST")===!0&&(yield ft(s.applySimulcastForFirefox(c,t)));const p=yield ft(s.peerConnection.createOffer()),f=s.remoteSDP.predictReceivingMids(t.length),m=s.mungSendOfferSDP(p.sdp,t,f),g=ls(m),v=f.map(I=>{const k=g.mediaDescriptions.find(M=>M.attributes.mid===I);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return gk(k,V("USE_PUB_RTX"))});let y;try{y=yield v}catch(I){y=[],s.remoteSDP.receive(t,n,i,y);const k=s.remoteSDP.toString();throw yield ft(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ft(s.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield ft(s.stopSending(f,!0)),I}s.remoteSDP.receive(t,n,i,y);const D=s.remoteSDP.toString(),A=s.logSDPExchange(m,"offer","local","send");return yield ft(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ft(s.applySimulcastEncodings(c,t)),yield ft(s.applySendEncodings(c,t)),A==null||A(D),yield ft(s.peerConnection.setRemoteDescription({type:"answer",sdp:D})),c.map((I,k)=>{const M=f[k];return{localSSRC:v[k],id:M,transceiver:I}})}catch(c){throw c instanceof re?c:new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")b.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(o=>{o._updateOriginDataChannel(i)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),b.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else b.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof re?i:new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof re?n:new re(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(p=>{var f;Kg(this.id+p.mid,this),p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);c&&(await Vg(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const d=this.peerConnection.getTransceivers().find(p=>p.mid===o);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:o,transceiver:d}}catch(o){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Vg(this.peerConnection,this.remoteSDP,this.extension),b.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(s=>{const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:s,transceiver:o}})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[d,p]=c;if(p===o)return this.preSSRCMap.delete(d),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const o=this.remoteSDP.toString();s==null||s(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,d)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString();s==null||s(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return rr(function*(){const i=yield ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=gt().supportPCSetConfiguration,o=V("FORCE_TURN_TCP")||n.forceTurn;if(t===Ii.RELAY&&!s)return;if(s&&!o){const g=t===Ii.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==g&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(g,"]")),v.iceTransportPolicy=g,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(t);const c=yield ft(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Vc(c.sdp),{remoteIceParameters:p}=yield d.iceParameters;n.remoteSDP.restartICE(p);const f=n.remoteSDP.toString(),m=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ft(n.peerConnection.setLocalDescription(c)),m==null||m(f),yield ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(s){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{Kg(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return go(go({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new re(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(n)?_n()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(s=>s.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:s}=n.getSelectedCandidatePair();return{local:go(go({},Ho),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:go(go({},Ho),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),s=t.port?"local: ".concat(t.port):"";b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(t.url||"",", host_candidate:").concat(s)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(of(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&gt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(nh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!V("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in s?s.error:s)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var o;s&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:o}=i.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,s;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===t._mediaStreamTrack)),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!gt().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const d=function(A,I){return A.getTransceivers().find(k=>k.sender.track===I||k.receiver.track===I)}(this.peerConnection,t._mediaStreamTrack),p=C7(t);if(FK(t)&&d&&n&&p&&this.getLocalVideoStats&&ve(i=["vp8","vp9"]).call(i,this.store.codec)){var f;const A=o.degradationPreference||(ve(f=t._hints).call(f,qt.CUSTOM_TRACK)?V("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(I,k,M,H,J,$){if(Kg(I,M),J(k),H!=="balanced"&&H!=="maintain-framerate"&&H!=="maintain-resolution")return;let z=-1;eM(I,k);const oe=window.setInterval(()=>{const be=Wg.get(I);if(!V("ENABLE_AG_ADAPTATION")||!be)return Kg(I,M),void J(k);const Re=$();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const dt=Re.sendFrameRate,ut=Re.OutgoingAvailableBandwidth,[$t,wn]=VK(I,dt,ut,be.adaptationConfig,k,H);wn&&(M.qualityLimitationReason=wn),$t&&be.adaptationConfig.scale!==$t.scale&&(b.debug("[".concat(I,"] applyAdaptation: ").concat(M.qualityLimitationReason,`
           sendFps `).concat(dt,", bwe ").concat(ut,", switch from ").concat(be.adaptationConfig.scale," to ").concat($t.scale," ")),be.adaptationConfig=uw(uw({},be.adaptationConfig),$t),J($t))}},V("CHECK_LOCAL_STATS_INTERVAL")),de=uw({},k);Wg.set(I,{timer:oe,adaptationConfig:de,originConfig:k,adaptationFunc:J}),b.debug("[".concat(I,"] start adaptation, originConfig: ").concat(JSON.stringify(k),", degradationPreference: ").concat(H))})(this.id+d.mid,p,this,A,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:A,frameRate:I,scaleResolutionDownBy:k}=t._encoderConfig;A&&(c.maxBitrate=1e3*A),(ve(m=t._hints).call(m,qt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(I&&(c.maxFramerate=Os(I)),k&&k>=1&&(c.scaleResolutionDownBy=k))}const{maxFramerate:g}=V("ENCODER_CONFIG_LIMIT");if(g&&typeof g=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,g):g),V("DSCP_TYPE")&&La()){var v;const A=V("DSCP_TYPE");ve(v=["very-low","low","medium","high"]).call(v,A)&&(c.networkPriority=A)}const y=n.getParameters(),D=(s=y.encodings)===null||s===void 0?void 0:s[0];_n()&&!D&&(o.encodings=[c]),D&&Object.assign(D,c),Object.assign(y,o),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(A,I,k){try{var M;if(!gt().supportSetRtpSenderParameters||!function(oe){return oe==="vp9"||oe==="av1"}(A)||!V("ENABLE_SVC"))return;const H={},J={},$=I.getParameters(),z=(M=$.encodings)===null||M===void 0?void 0:M[0];J.scalabilityMode=xg(k),z&&Object.assign(z,J),Object.assign($,H),await I.setParameters($),b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify($.encodings)))}catch(H){b.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",H)}}(this.store.codec,n,V("SVC_MODE"))}async updateAdaptation(t,n){var i,s;if(!t)return b.debug("[updateAdaptation] no rtpSender found");if(!gt().supportSetRtpSenderParameters)return b.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:c,frameRate:d,scaleResolutionDownBy:p}=n;c&&(o.maxBitrate=1e3*c),d&&(o.maxFramerate=Os(d)),p&&p>=1&&ve(i=["vp8","vp9"]).call(i,this.store.codec)&&(o.scaleResolutionDownBy=p);const f=t.getParameters(),m=(s=f.encodings)===null||s===void 0?void 0:s[0];m&&Object.assign(m,o),Object.assign(f,{});try{await t.setParameters(f),b.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(g){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?b.debug("[updateAdaptation] peerConnection not connected}"):b.debug("[updateAdaptation] updateRtpSenderEncodings failed",g):b.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!gt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];o instanceof tn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,s.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const s=ls(t);return n.forEach((o,c)=>{const d=i[c],p=s.mediaDescriptions.find(f=>f.attributes.mid===d);p&&(sh(p,o),yk(p,o,this.store.codec))}),kc(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let p=0;p<t.length;p++){var i,s,o,c,d;const f=t[p],m=n[p];if(m instanceof tn&&!ve(i=m._hints).call(i,qt.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=m._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,g))}}}async applySimulcastEncodings(t,n){if(!_n()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof tn&&this.isVP8Simulcast(s)){const o=t[i],c={},d={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const p=o.sender.getParameters();await o.sender.setParameters(Object.assign(p,c))}}}isVP8Simulcast(t){var n,i,s,o,c;return!!(t instanceof tn&&V("SIMULCAST")&&this.store.codec==="vp8"&&!ve(n=t._hints).call(n,qt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(V("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(gt().supportPCSetConfiguration){const n=nm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},De(pt.prototype,"updateRemoteRTPCapabilities",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),De(pt.prototype,"connect",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),De(pt.prototype,"updateRemoteConnect",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteConnect"),pt.prototype),De(pt.prototype,"createDataChannels",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),De(pt.prototype,"receive",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),De(pt.prototype,"batchReceive",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"batchReceive"),pt.prototype),De(pt.prototype,"stopReceiving",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),De(pt.prototype,"muteRemote",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),De(pt.prototype,"unmuteRemote",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),De(pt.prototype,"muteLocal",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),De(pt.prototype,"unmuteLocal",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),De(pt.prototype,"close",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),De(pt.prototype,"updateEncoderConfig",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),De(pt.prototype,"updateSendParameters",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),De(pt.prototype,"replaceTrack",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),De(pt.prototype,"updateAdaptation",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"updateAdaptation"),pt.prototype),De(pt.prototype,"getRemoteSSRC",[ts],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function ts(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),p=0;p<c;p++)d[p]=arguments[p];return await i.apply(this,d)}finally{o()}},n}function mw(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Os(t.width),i.height=Os(t.height);const s=Os(t.framerate||15);document.body.append(n),document.body.append(i);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const c=i.getContext("2d");if(!c)throw new Q(L.UNEXPECTED_ERROR,"can not get canvas context");const d=gt(),p=i.captureStream(d.supportRequestFrame?0:s).getVideoTracks()[0];p.canvas||(p.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,g=n.videoHeight/m,v=i.width*g;Math.abs(v-i.height)>=2&&(b.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(v)),i.height=v)}c.drawImage(n,0,0,i.width,i.height),p.requestFrame&&p.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},i.stopCapture=AR(()=>i.startCapture&&i.startCapture(),s);const f=p.stop;return p.stop=()=>{f.call(p),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),b.debug("clean low stream renderer")},p}var Yg=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Yg||{}),Pn=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(Pn||{}),Ql=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Ql||{}),Ln=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Ln||{}),Zl=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Zl||{}),rM=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(rM||{}),$o=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}($o||{}),us=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e}(us||{}),oM=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(oM||{}),ns=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ns||{}),qg=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(qg||{});const $g=1e3,HK=Math.max(6,3);function Ke(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function aM(e){const t={[ns.CONN_TYPE]:0,[ns.RTT]:e.rtt,[ns.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[ns.CONN_TYPE]=1),n==="tcp"&&(t[ns.CONN_TYPE]=3),n==="tls"&&(t[ns.CONN_TYPE]=4);break}case"srflx":t[ns.CONN_TYPE]=2;break;case"unknown":t[ns.CONN_TYPE]=5;break;default:t[ns.CONN_TYPE]=0}return t}function cM(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class lM extends dn{constructor(t){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadBaseStatsStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastRefRecvStats",void 0),N(this,"lastRefSendStats",void 0),N(this,"lastFullRecvStats",void 0),N(this,"lastFullSendStats",void 0),N(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%3==0,i=t%6==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const d={};if(this.uploadTransportStarted&&s){const f=this.getTransportStats(s,o,n);f&&(d.misc=[f])}if(this.uploadOutboundStarted&&s){const f=this.getOutboundStats(s,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);f&&(d.outbound=[f])}if(this.uploadInboundStarted&&o){const f=this.getInboundStats(o,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);f&&(d.inbound=f)}const p=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;p&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[qg.RTC_PEER_CONNECTION_STATE]=hR[p]):d.misc=[{addition:{[qg.RTC_PEER_CONNECTION_STATE]:hR[p]}}]),this.requestUploadStats(d)}this.lastRecvStats=o,this.lastSendStats=s,i&&(this.lastFullRecvStats=o,this.lastFullSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const s=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(s&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[qg.RTC_PEER_CONNECTION_STATE]:hR[s.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===HK+1&&(t=1)},$g)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[ns.RTT]:t.rtt,[ns.CONN_TYPE]:void 0,[ns.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const s=aM(t);if(this.store.useP2P){if(n){const o=aM(n);s[ns.CONN_TYPE]+=o[ns.CONN_TYPE]<<3}s[ns.CONN_TYPE]+=110}else s[ns.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(t,n,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,d,p;return o.forEach(f=>{let[m,{track:g,ssrcs:v}]=f;switch(m){case le.LocalVideoLowTrack:case le.LocalVideoTrack:if(m===le.LocalVideoTrack){const y=function(I,k,M,H,J,$){const z=k.videoSend.find(Re=>Re.ssrc===I);if(!z)return;const oe={},{sentFrame:de,inputFrame:be}=z;if($&&(Ke(oe,Pn.QP_SUM,z.qpSumPerFrame),be&&de)){const Re=be.frameRate,dt=de.frameRate;oe[Pn.FREEZE]=function(ut,$t){let wn=!0;return wn=!(ut<=5)&&(ut<=10?$t<3:ut<=20?$t<4:$t<5),wn}(Re,dt)?1:0}if(J){switch(de&&(Ke(oe,Pn.HEIGHT,de.height),Ke(oe,Pn.WIDTH,de.width),Ke(oe,Pn.FRAME_RATE,de.frameRate)),oe[Pn.DISABLED]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0,z.adaptionChangeReason){case"none":oe[Pn.ADAPTATION]=0;break;case"cpu":oe[Pn.ADAPTATION]=1;break;case"bandwidth":oe[Pn.ADAPTATION]=2;break;case"other":oe[Pn.ADAPTATION]=3}let Re=0;z.adaptionChangeReason&&(Re+=cM(z.adaptionChangeReason)),k.qualityLimitationReason&&(Re+=cM(k.qualityLimitationReason)<<3),oe[Pn.ADAPTATION]=Re,oe[Pn.PLAYER_STATUS]=RR[H._player?H._player.videoElementStatus:"uninit"],Ke(oe,Pn.NACKS,z.nacksCount),Ke(oe,Pn.PLIS,z.plisCount),Ke(oe,Pn.FIRS,z.firsCount),Ke(oe,Pn.AVG_ENCODE,z.avgEncodeMs),Ke(oe,Pn.HUGE_FRAME_SENT,z.hugeFramesSent),Ke(oe,Pn.BYTES_RETRANSMIT,z.retransmittedBytesSent),Ke(oe,Pn.PACKAGES_RETRANSMIT,z.retransmittedPacketsSent),Ke(oe,Pn.KEY_FRAMES_ENCODED,z.keyFramesEncoded);const dt=M&&M.videoSend.find(ut=>ut.ssrc===I);if(dt){let ut=J?$g:6e3;dt.timestamp&&z.timestamp&&(ut=z.timestamp-dt.timestamp),dt.packets!=null&&z.packets!=null&&Ke(oe,Pn.PACKAGE_RATE,1e3*(z.packets-dt.packets)/ut),z.packetsLost!=null&&dt.packetsLost!=null&&Ke(oe,Pn.PACKAGE_LOST,z.packetsLost-dt.packetsLost),dt.bytes!=null&&z.bytes!=null&&Ke(oe,Pn.BITRATE,8*(z.bytes-dt.bytes)/ut)}}return oe}(v[0].ssrcId,t,n,g,i,s),D=g&&function(I,k,M,H){const J=k.videoSend.find(z=>z.ssrc===I);if(!J)return null;const $={};if(H){const z=J.inputFrame,oe=z&&z.height||M.videoHeight||0,de=z&&z.width||M.videoWidth||0,be=z&&z.frameRate||0;Ke($,Yg.HEIGHT,oe),Ke($,Yg.WIDTH,de),Ke($,Yg.FRAME_RATE,be)}return $}(v[0].ssrcId,t,g,i),A=function(I,k){const M={};return k&&(Ke(M,Pn.RETRANSMIT,I.bitrate.retransmit),Ke(M,Pn.TARGET_ENCODED,I.bitrate.targetEncoded),Ke(M,Pn.ACTUAL_ENCODED,I.bitrate.actualEncoded),Ke(M,Pn.TRANSMIT,I.bitrate.transmit),Ke(M,Pn.BANDWIDTH,I.sendBandwidth)),M}(t,i);d=Object.assign({},y,D,A)}else p=function(y,D,A,I){const k=D.videoSend.find(H=>H.ssrc===y);if(!k)return;const M={};if(I){const H=k.sentFrame;if(H&&(Ke(M,Ql.HEIGHT,H.height),Ke(M,Ql.WIDTH,H.width),Ke(M,Ql.FRAME_RATE,H.frameRate)),A){const J=A.videoSend.find($=>$.ssrc===y);if(J){let $=6e3;J.timestamp&&k.timestamp&&($=k.timestamp-J.timestamp),J.packets!=null&&k.packets!=null&&Ke(M,Ql.PACKAGE_RATE,1e3*(k.packets-J.packets)/$),k.packetsLost!=null&&J.packetsLost!=null&&Ke(M,Ql.PACKAGE_LOST,k.packetsLost-J.packetsLost),J.bytes!=null&&k.bytes!=null&&Ke(M,Ql.BITRATE,8*(k.bytes-J.bytes)/$)}}}return M}(v[0].ssrcId,t,n,i);break;case le.LocalAudioTrack:c=g&&function(y,D,A,I,k){const M=D.audioSend.find(J=>J.ssrc===y);if(!M)return;const H={};if(k){H[$o.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0;const J=100*I._source.getAccurateVolumeLevel(),$=M.inputLevel;if($!=null){const oe=Math.ceil(50*Math.log10(100*$+1));Ke(H,$o.LEVEL,oe)}Ke(H,rM.PCM_LEVEL,J),Ke(H,$o.AEC_RETURN_LOSS,M.aecReturnLoss),Ke(H,$o.AEC_RETURN_LOSS_ENH,M.aecReturnLossEnhancement),Ke(H,$o.BYTES_RETRANSMIT,M.retransmittedBytesSent),Ke(H,$o.PACKAGES_RETRANSMIT,M.retransmittedPacketsSent),H[$o.FREEZE]=0;const z=A&&A.audioSend.find(oe=>oe.ssrc===y);if(z){let oe=6e3;z.timestamp&&M.timestamp&&(oe=M.timestamp-z.timestamp),z.bytes!=null&&M.bytes!=null&&Ke(H,$o.BITRATE,8*(M.bytes-z.bytes)/oe),z.packets!=null&&M.packets!=null&&Ke(H,$o.PACKAGE_RATE,1e3*(M.packets-z.packets)/oe)}}return H}(v[0].ssrcId,t,n,g,i)}}),{high:d,low:p,audio:c}}getInboundStats(t,n,i,s){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],c=[];return o.forEach(d=>{let[p,f]=d;const m={peer:p.uid};if(f.has(Oe.VIDEO)&&p.videoTrack){const g=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,v=p.videoTrack?function(y,D,A,I,k,M,H,J){const $=D.videoRecv.find(ut=>ut.ssrc===y);if(!$)return;const z={},{receivedFrame:oe,outputFrame:de,decodeFrameRate:be}=$,Re=A&&A.videoRecv.find(ut=>ut.ssrc===y);if(Ke(z,Zl.FRAME_RATE_DECODE,be),$.framesRateFirefox&&Ke(z,Ln.FRAME_RATE,$.framesRateFirefox),oe&&Ke(z,Ln.FRAME_RATE,oe.frameRate),Ke(z,Ln.FRAMES_DROPPED,$.framesDroppedCount),Ke(z,Ln.BYTES_RETRANSMIT,$.retransmittedBytesReceived),Ke(z,Ln.PACKAGES_RETRANSMIT,$.retransmittedPacketsReceived),Ke(z,Ln.PACKAGES_DISCARDED,$.packetsDiscarded),Ke(z,Ln.AVG_DECODE,$.avgDecodeMs),Ke(z,Ln.AVG_PROCESSING_DELAY,$.avgProcessingDelayMs),Ke(z,Ln.AVG_ASSEMBLY_TIME,$.avgFramesAssembledFromMultiplePacketsMs),Ke(z,Ln.AVG_INTER_FRAME_DELAY,$.avgInterFrameDelayMs),Ke(z,Ln.KEY_FRAMES_DECODED,$.keyFramesDecoded),Re){const ut=D.timestamp-A.timestamp||$g*(J?6:H?3:1);$.packetsLost!=null&&Re.packetsLost!=null&&Ke(z,Ln.PACKAGE_LOST,$.packetsLost-Re.packetsLost),Re.bytes!=null&&$.bytes!=null&&Ke(z,Ln.BITRATE,8*($.bytes-Re.bytes)/ut),Re.packets!=null&&$.packets!=null&&Ke(z,Ln.PACKAGE_RATE,1e3*($.packets-Re.packets)/ut)}if(J&&(Ke(z,Ln.QP_SUM,$.qpSumPerFrame),z[Ln.FREEZE]=k&&bf.isRemoteVideoFreeze(I,$,Re)?1:0),H){var dt;oe?(Ke(z,Ln.HEIGHT,oe.height),Ke(z,Ln.WIDTH,oe.width)):I&&(Ke(z,Ln.HEIGHT,I._videoHeight||0),Ke(z,Ln.WIDTH,I._videoWidth||0)),de&&Ke(z,Zl.FRAME_RATE_OUTPUT,de.frameRate);const ut=(dt=I._player)===null||dt===void 0?void 0:dt.rendFrameRate.toFixed(0);if(ut&&Ke(z,Zl.FRAME_RATE_RENDER,+ut),Ke(z,Ln.JITTER_BUFFER,$.jitterBufferMs),Ke(z,Ln.CURRENT_DELAY,$.currentDelayMs),Ke(z,Ln.FIRS,$.firsCount),Ke(z,Ln.NACKS,$.nacksCount),Ke(z,Ln.PLIS,$.plisCount),I){z[Ln.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;const $t=I._player;if($t){const{freezeTimeCounterList:wn,renderFreezeAccTime:vn,videoElementStatus:ss}=$t;if(wn&&wn.length>0&&Ke(z,Zl.FREEZE_TIME,wn.splice(0,1)[0]),M&&Ma.visibility==="visible"&&ss===xi.PLAYING&&gt().supportRequestVideoFrameCallback){const ae=Math.min(6e3,vn);$t.renderFreezeAccTime=Math.max(0,vn-ae),Ke(z,Zl.FREEZE_TIME_RENDER,ae)}if(typeof $.totalFreezesDuration=="number"){const ae=Re&&Re.totalFreezesDuration?$.totalFreezesDuration-Re.totalFreezesDuration:$.totalFreezesDuration;Ke(z,Zl.FREEZE_DURATION,1e3*ae)}}}if(z[Ln.PLAYER_STATUS]=RR[I._player?I._player.videoElementStatus:"uninit"],Re&&$.totalInterFrameDelay!==void 0&&$.totalSquaredInterFrameDelay!==void 0&&Re.totalInterFrameDelay!==void 0&&Re.totalSquaredInterFrameDelay!==void 0){const $t=$.totalInterFrameDelay-Re.totalInterFrameDelay,wn=$.totalSquaredInterFrameDelay-Re.totalSquaredInterFrameDelay,vn=$.framesDecodeCount-Re.framesDecodeCount,ss=$t/vn*1e3,ae=Math.round(1e3*Math.sqrt((wn-Math.pow($t,2)/vn)/vn));!isNaN(ae)&&ss+ae>Math.max(3*ss,ss+150)&&(z[Ln.I_FRAME_DELAY]=ae)}}return z}(p._videoSSRC,t,n,p.videoTrack,g===!0,this.needUploadRenderFreezeTime,i,s):void 0;v&&(m.video=v)}if(f.has(Oe.AUDIO)&&p.audioTrack){const g=p.audioTrack?function(v,y,D,A,I,k){const M=y.audioRecv.find(z=>z.ssrc===v);if(!M)return;const H={},J=D&&D.audioRecv.find(z=>z.ssrc===v);if(Ke(H,us.JITTER,M.jitterMs),Ke(H,us.BYTES_RETRANSMIT,M.retransmittedBytesReceived),Ke(H,us.PACKAGES_RETRANSMIT,M.retransmittedPacketsReceived),Ke(H,us.PACKAGES_DISCARDED,M.packetsDiscarded),Ke(H,us.AVG_PROCESSING_DELAY,M.avgProcessingDelayMs),J){const z=y.timestamp-D.timestamp||$g*(k?6:I?3:1);M.packets!=null&&J.packets!=null&&Ke(H,us.PACKAGE_RATE,1e3*(M.packets-J.packets)/z),I&&J.bytes!=null&&M.bytes!=null&&Ke(H,us.BITRATE,8*(M.bytes-J.bytes)/z),M.packetsLost!=null&&J.packetsLost!=null&&Ke(H,us.PACKAGE_LOST,M.packetsLost-J.packetsLost)}if(k){const{receivedFrames:z,droppedFrames:oe}=M;z!=null&&oe!=null&&(H[us.FREEZE]=($=z)===0||100*oe/$>20?1:0)}var $;if(I){const z=100*A._source.getAccurateVolumeLevel(),oe=M.outputLevel;if(oe!=null){const de=Math.ceil(50*Math.log10(100*oe+1));Ke(H,oM.LEVEL,de)}if(Ke(H,us.PCM_LEVEL,z),A&&(H[us.DISABLED]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1),Ke(H,us.JITTER_BUFFER,M.jitterBufferMs),Ke(H,us.CURRENT_DELAY,M.jitterBufferMs),H[us.PLAYER_STATUS]=RR[es.getPlayerState(A.getTrackId())],J){const de=M.concealedSamples-J.concealedSamples;de>0&&Ke(H,us.CONCEALED_SAMPLES,de)}}return H}(p._audioSSRC,t,n,p.audioTrack,i,s):void 0;g&&(m.audio=g)}(m.video||m.audio)&&c.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof gg);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(ff.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(Oe.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),i.has(Oe.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let s=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of o)!f.muted&&f.enabled&&(s=s.concat(await f.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,m]of c)m.has(Oe.VIDEO)&&f.videoTrack&&(s=s.concat(await f.videoTrack.getProcessorUsage())),m.has(Oe.AUDIO)&&f.audioTrack&&(s=s.concat(await f.audioTrack.getProcessorUsage()));if(s.length===0)return;i.details=function(f,m){const g={};for(const{id:A,value:I,level:k,direction:M}of f){var v;const H=(v=m.get(A))!==null&&v!==void 0?v:0,J=I===2?H+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:H;var y,D;m.set(A,J),g[A]?(I===2&&(g[A].value=I),k>g[A].level&&(g[A].level=k),M==="remote"&&(g[A].remoteUidCount+=1),g[A].totalTs=(y=m.get(A))!==null&&y!==void 0?y:0):g[A]={value:I,level:k,remoteUidCount:M==="local"?0:1,totalTs:(D=m.get(A))!==null&&D!==void 0?D:0}}return Object.keys(g).map(A=>{const{level:I,value:k,totalTs:M}=g[A];return{id:A,level:I,value:k,totalTs:M}})}(s,t);const d=Date.now(),p=d>n?d:n+1;this.requestUpload&&this.requestUpload(ff.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:p})},V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const WK=V("ICE_RESTART_INTERVAL");let Jg=new Map,lh=new Map,Gc=[Ii.UDP_TCP_RELAY,Ii.TCP_RELAY,Ii.RELAY],_w=V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&gt().supportPCSetConfiguration;function dM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Jg.get(e.id);n&&(window.clearTimeout(n),Jg.delete(e.id));const i=lh.get(e.id);t&&i&&i.index===Gc.length-1&&(b.debug("[".concat(e.id,"] reset ICE restart policy")),lh.delete(e.id))}function uM(e,t,n){if(Jg.size===0&&lh.size===0&&(Array.isArray(V("RESTART_SEQUENCE"))&&V("RESTART_SEQUENCE").length>0&&!function(d,p){if(d.length!==p.length)return!1;for(let f=0;f<d.length;f+=1){const m=d[f];if(d.filter(g=>g===m).length!==p.filter(g=>g===m).length)return!1}return!0}(Gc,V("RESTART_SEQUENCE"))&&(Gc=V("RESTART_SEQUENCE").filter(d=>{var p;if(ve(p=Object.values(Ii)).call(p,d))return!0}),b.debug("use reconnection policy from config distribution, queues: ".concat(Gc.join(" => ")))),_w=V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&gt().supportPCSetConfiguration),Gc.length===0)return void n();let i,{index:s=0,type:o}=lh.get(e.id)||{};if(_w&&o===Ii.RELAY)return void n();let c=o&&s>=Gc.length-1;if(_w)o=Ii.RELAY;else{if(c)return void n();o?(s++,o=Gc[s]):(o=Gc[0],s=0)}b.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(s)),t(o),lh.set(e.id,{index:s,type:o}),i=window.setTimeout(()=>uM(e,t,n),WK),Jg.set(e.id,i)}var ot;function hM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function pM(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=GC,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Xg(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Xg(e){function t(n){if(Object(n)!==n)return Te.reject(new TypeError(n+" is not an object."));var i=n.done;return Te.resolve(n.value).then(function(s){return{value:s,done:i}})}return Xg=function(n){this.s=n,this.n=n.next},Xg.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Te.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Te.reject(n):t(i.apply(this.s,arguments))}},new Xg(e)}let Rf=(ot=class extends dn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ve.StateChange,t,this._state)}constructor(e,t){super(),N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",void 0),N(this,"_state",At.Disconnected),N(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?Va.FIRST_CONNECTION:Va.OLD_FIRST_CONNECTION),N(this,"_isStartRestartIce",!1),N(this,"_restartTimer",void 0),N(this,"_isTryConnecting",!1),N(this,"_iceError",null),N(this,"_forceTurn",!1),N(this,"_isWaitPcToRePub",!1),N(this,"handleMuteLocalTrack",async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==At.Connected)return void s(new re(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const d=c.find(f=>f[0]==="videoLowTrack");d&&d[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(f=>{let[,{id:m}]=f;return m}));const p=this.createMuteMessage(c);await zt(this,Ve.RequestMuteLocal,p),i()}catch(c){s(c)}finally{o()}}),N(this,"handleUnmuteLocalTrack",async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==At.Connected)return void s(new re(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const d=c.find(f=>f[0]==="videoLowTrack");if(d){const f=d[1];if(f.track._originMediaStreamTrack.stop(),!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}else{const m=mw(n,af(this,Ve.RequestLowStreamParameter));f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}await new Te((m,g)=>{this.handleReplaceTrack(f.track,m,g,!0)})}await this.connection.unmuteLocal(c.map(f=>{let[,{id:m}]=f;return m}));const p=this.createUnmuteMessage(c);await zt(this,Ve.RequestUnmuteLocal,p),i()}catch(c){s(c)}finally{o()}}),N(this,"handleUpdateVideoEncoder",async(n,i,s,o)=>{let c;o||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!p||p.track!==n||this.state!==At.Connected)return void i();const{id:f,track:m}=p;await this.connection.updateSendParameters(f,m),await this.connection.updateEncoderConfig(f,m),this.emit(Ve.UpdateVideoEncoder,m),i()}catch(p){s(p)}finally{var d;(d=c)===null||d===void 0||d()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==At.Connected)return void i();const{id:d,track:p}=c;await this.connection.updateSendParameters(d,p),i()}catch(c){s(c)}finally{o()}}),N(this,"handleReplaceMixingTrack",async(n,i,s,o)=>{if(!this.connection||this.state!==At.Connected)return void i();const c=pw([n]);let d;b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof o=="boolean"&&o||(d=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(f){s(f)}finally{var p;(p=d)===null||p===void 0||p()}}),N(this,"handleReplaceTrack",async(n,i,s,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var d;const f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:g}]=m;return n===g});if(!this.connection||!f||this.state!==At.Connected)return void i();if(await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(n,f[1].id)),this.isPlanB){const m=f[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],m)}if(f[0]===le.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding){const m=this.localTrackMap.get(le.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new Te((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}i()}catch(f){s(f)}finally{var p;(p=c)===null||p===void 0||p()}}),N(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lM(this.store),this.bindStatsUploaderEvents(),this.mutex=new vi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!gt().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&La(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&gt().supportPCSetConfiguration&&ZC(),this.shouldForwardP2PCreation&&(this.connection=zg(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=At.New,this._forceTurn=iM(e),b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=zg(this.store,e),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new re(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=V("NEW_ICE_RESTART")?Va.FIRST_CONNECTION:Va.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new re(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");V("ENABLE_PREALLOC_PC")&&this.state===At.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=At.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(s=>{var o;let[c]=s;return ve(o=[le.LocalVideoLowTrack,le.LocalVideoTrack]).call(o,c)}),n=t.map(s=>{let[,{id:o}]=s;return o}),i=t.map(s=>{let[o]=s;return o});if(this.connection instanceof Ga){if(xe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ve(e).call(e,this.store.codec)){const s=["vp9","vp8","h264"].find(o=>ve(e).call(e,o));s&&(this.store.codec=s,b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ga&&this.connection.peerConnectionState!=="closed"&&ve(e=[At.New,At.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==At.Connected){if(this.state===At.Disconnected)throw new re(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;ve(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return rr(function*(){const s=yield ft(i.mutex.lock("From P2PChannel.publish"));try{var o;const c=i.connection&&ve(o=["disconnected","failed"]).call(o,i.connection.peerConnectionState);if(!i.connection||i.state!==At.Connected||c){if(i.state===At.Disconnected)throw new re(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const p=e.filter(f=>i.pendingLocalTracks.indexOf(f)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(p),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Ti.markPublishStart(i.store.clientId,i.store.pubId);const d=i.filterTobePublishedTracks(e,t,n);if(d.length===0)return void(yield ft(i.tryToUnmuteAudio(e)));yield*KE(pM(i.doPublish(i.connection,d)))}finally{s()}})()}doPublish(e,t){var n=this;return rr(function*(){t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===le.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(t);const i=t.map(v=>{let{track:y}=v;return y}),s=yield ft(e.send(i,n.store.codec,n.store.audioCodec)),o=(yield ft(s.next())).value,c=n.createGatewayPublishMessage(t,o);let d;try{d=yield c}catch(v){throw s.throw(v),(v==null?void 0:v.code)===L.WS_ABORT&&t.forEach(y=>{let{track:D}=y;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(t),v}const p=n.mapPubResToRemoteConfig(c,d,i),f=(yield ft(s.next(p))).value;if(n.state===At.Disconnected)throw new re(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");V("ENABLE_VIDEO_SEI");const m=V("ENABLE_ENCODED_TRANSFORM"),g=V("ENABLE_AUDIO_METADATA");i.forEach(async v=>{const y=v.getRTCRtpTransceiver();y&&m&&(v.trackMediaType===Oe.VIDEO?await j7(y.sender,v):v.trackMediaType===Oe.AUDIO&&await O7(y.sender,{metadata:g?()=>{const D=v.metadata.shift();return D&&D.value}:void 0}))}),t.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,f),n.statsUploader.startUploadOutboundStats(),t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===le.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof tn))return b.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,s=function(o,c){const d={};return o.height&&o.width&&(d.scaleResolutionDownBy=XR(o,c)),d.maxFramerate=o.framerate?Os(o.framerate):void 0,d.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,d}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==le.LocalVideoLowTrack||!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const o=i._originMediaStreamTrack;if(!o.canvas)return b.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,d){const p=c.canvas;d.width&&(p.width=Os(d.width)),d.height&&(p.height=Os(d.height)),d.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=AR(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},Os(d.framerate)))})(o,e)}s.maxBitrate!=null&&(i._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=s.maxFramerate:i._encoderConfig.frameRate={max:s.maxFramerate}),b.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return rr(function*(){if(!t.connection||t.state!==At.Connected)return;const n=yield ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(le.LocalVideoTrack);if(!s)throw new re(L.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(le.LocalVideoLowTrack))throw new re(L.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:t.getLowVideoTrack(s.track,e),type:le.LocalVideoLowTrack}];if(yield*KE(pM(t.doPublish(t.connection,o))),s.track.muted||!s.track.enabled){var i;const c=(i=t.localTrackMap.get(le.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield ft(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Ve.RequestRePublish,this.pendingLocalTracks),this.emit(Ve.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(b.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await fi(this,Ve.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==Oe.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Oe.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await fi(this,Ve.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Oe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ve.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==At.Connected)return void e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==At.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==At.Connected)return;const e=this.localTrackMap.get(le.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[le.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==At.Connected)throw new re(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const o=this.pendingRemoteDataChannels.findIndex(c=>{let{user:d,id:p}=c;return d.uid===e.uid&&p===i.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,s){var o;if(!this.connection||this.state!==At.Connected)throw new re(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let c,d,p;const f=this.connection.getPreMedia(n);if(f)b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),p=f.transceiver,c=f.track,d=f.id;else if(s){const v=s.find(D=>{let{stream_type:A}=D;return A===t});if(!v)throw new re(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const y=await this.connection.receive(t,v.ssrcs,String(e._uintid),v.attributes);this.connection instanceof Ga&&(p=y.transceiver),c=y.track,d=y.id}else{const v=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof Ga&&(p=v.transceiver),c=v.track,d=v.id}t===Oe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new qu(c,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Yu(c,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack)),p&&V("ENABLE_ENCODED_TRANSFORM")&&(t==Oe.VIDEO?await VR(p.receiver,{onSei:V("ENABLE_VIDEO_SEI")&&(v=>{var y;return(y=e._videoTrack)===null||y===void 0?void 0:y._onSei(v)})}):t==Oe.AUDIO&&await UR(p.receiver,{enableTopn:!!V("ENABLE_AUDIO_TOPN"),enableMetadata:!!V("ENABLE_AUDIO_METADATA"),onMetadata:v=>{this.safeEmit(Ve.AudioMetadata,v)}}));const m=this.remoteUserMap.get(e);m?m.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(v=>{let{user:y,kind:D}=v;return y.uid===e.uid&&t===D});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Ve.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==At.Connected)throw new re(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(s=>{var o;let{user:c,mediaType:d}=s;return!((o=this.remoteUserMap.get(c))!==null&&o!==void 0&&o.has(d))});const t=[],n=new Map;e.forEach(s=>{if(!this.connection)return;const o=this.connection.getPreMedia(s.ssrcId);o?n.set(s.ssrcId,o):t.push(s)});const i=await this.connection.batchReceive(t.map(s=>{let{user:o,mediaType:c,ssrcId:d,rtxSsrcId:p}=s;return{kind:c,ssrcMsg:[{ssrcId:d,rtx:p}],mslabel:String(o._uintid)}}));t.forEach((s,o)=>{n.set(s.ssrcId,i[o])});for(const{user:s,mediaType:o,ssrcId:c}of e){const d=n.get(c);if(!d)return void b.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(c));const{track:p,id:f,transceiver:m}=d;m&&V("ENABLE_ENCODED_TRANSFORM")&&(o==Oe.VIDEO?await VR(m.receiver,{onSei:V("ENABLE_VIDEO_SEI")&&(y=>{var D;return(D=s._videoTrack)===null||D===void 0?void 0:D._onSei(y)})}):o==Oe.AUDIO&&await UR(m.receiver,{enableTopn:!!V("ENABLE_AUDIO_TOPN"),enableMetadata:!!V("ENABLE_AUDIO_METADATA"),onMetadata:y=>{this.safeEmit(Ve.AudioMetadata,y)}})),o===Oe.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(p):(s._audioTrack=new qu(p,s.uid,s._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),m&&s._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(p):(s._videoTrack=new Yu(p,s.uid,s._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),m&&s._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(s,s._videoTrack)),V("ENABLE_VIDEO_SEI")&&m&&(o==Oe.VIDEO?await VR(m.receiver,{onSei:y=>{var D;(D=s._videoTrack)===null||D===void 0||D._onSei(y)}}):o==Oe.AUDIO&&await UR(m.receiver));const g=this.remoteUserMap.get(s);g?g.set(o,f):this.remoteUserMap.set(s,new Map([[o,f]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:D,kind:A}=y;return D.uid===s.uid&&o===A});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Ve.MediaReconnectEnd,s.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:p}=c;return t!==void 0?d.uid===e.uid&&t===p:d.uid===e.uid});if(i.forEach(c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),this.connection&&this.state===At.Connected||n||i.forEach(c=>{let{kind:d}=c;var p;if(d===Oe.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(d===Oe.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==At.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const o=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:p}]=c;var f,m;if(p===Oe.VIDEO&&d._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),p===Oe.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0);else if(p===Oe.AUDIO){var g;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((g=d._audioTrack)===null||g===void 0||g._destroy(),d._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(s=>{const o=this.pendingRemoteDataChannels.findIndex(c=>c.id===s.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(s=>{s._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(s=>{i&&i.delete(s.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(s=>s.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:o}of e){const c=this.pendingRemoteTracks.filter(d=>{let{user:p,kind:f}=d;return o!==void 0?p.uid===s.uid&&o===f:p.uid===s.uid});c.forEach(d=>{const p=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(p,1)}),t=t.concat(c)}if(!this.connection||this.state!==At.Connected)return void t.forEach(s=>{let{user:o,kind:c}=s;var d;if(c===Oe.AUDIO)(d=o._audioTrack)===null||d===void 0||d._destroy(),o._audioTrack=void 0;else if(c===Oe.VIDEO){var p;(p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0}});const n=ks(e).call(e,(s,o)=>{let{user:c,mediaType:d}=o;const p=this.filterTobeUnSubscribedTracks(c,d);return s.concat(p)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(s=>{let[,{id:o}]=s;return o}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(s=>{let[o,{kind:c}]=s;var d,p;if(c===Oe.VIDEO&&o._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Oe.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0;else if(c===Oe.AUDIO){var f;this.unbindRemoteTrackEvents(o._audioTrack),(f=o._audioTrack)===null||f===void 0||f._destroy(),o._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==At.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void b.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Oe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||b.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(le.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return s!==le.LocalAudioTrack}).filter(i=>{let[s]=i;return!(e&&s===le.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===le.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,s){if(e){const c=this.localTrackMap.get(le.LocalAudioTrack),d=i?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);xe.publish(this.store.sessionId,{eventElapse:Ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(qt.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var o;n||(n=[]);const c=n.find(p=>p instanceof gn),d=i?(o=this.localTrackMap.get(le.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(p=>p instanceof tn);xe.publish(this.store.sessionId,{eventElapse:Ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(qt.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===Oe.VIDEO?n._videoSSRC:n._audioSSRC;s&&xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Oe.VIDEO,audio:i===Oe.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:Ti.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new vi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=zg(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=At.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof tn||t&&t.track instanceof gn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Bs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Wp(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=At.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=zg(this.store),this.emit(Ve.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case le.LocalVideoTrack:ve(t=i._hints).call(t,qt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case le.LocalAudioTrack:i instanceof Bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case le.LocalVideoLowTrack:}}),this.emit(Ve.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Bs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ve.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Bs(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:s}=n;if((e instanceof Bc?e.uid:e)===i.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof Bc?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return rr(function*(){if(!t.connection||t.state!==At.Connected)return;const n=yield ft(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield ft(t.connection.restartICE(e));const o=yield ft(i.next());if(o.done)return;const c=o.value,d=yield c;switch(fw(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ii.UDP_TCP_RELAY:t._pcStatsUploadType=Va.UDP_TCP_RESTART;break;case Ii.TCP_RELAY:t._pcStatsUploadType=Va.TCP_RESTART;break;case Ii.RELAY:t._pcStatsUploadType=Va.RELAY_RESTART;break;default:t._pcStatsUploadType=Va.OLD_RESTART}t._isTryConnecting=!0,i.next(d)}catch(o){var s;(s=i)===null||s===void 0||s.throw(o)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalAudioTrack),i=e.videoSend.find(y=>y.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(y=>y.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!s)return 1;const o=Vs(this,Ve.NeedSignalRTT),c=i?i.rttMs:void 0,d=s?s.rttMs:void 0,p=c&&d?(c+d)/2:c||d,f=(p&&o?(p+o)/2:p||o)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t==null?void 0:t.track;if(v&&v._encoderConfig&&v._hints.indexOf(qt.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return Yx[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const s=i._audioSSRC,o=i._videoSSRC,c=e.audioRecv.find(D=>D.ssrc===s),d=e.videoRecv.find(D=>D.ssrc===o);if(!c&&!d)return void(t+=1);const p=Vs(this,Ve.NeedSignalRTT),f=e.rtt,m=(f&&p?(f+p)/2:f||p)||0,g=c?c.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;g&&(y=.6*v*100/50+.2*m/1500+.2*g/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Te((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(b.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==At.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(!i)return;const s=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const o=i[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,o)}if(s===le.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding){const o=this.localTrackMap.get(le.LocalVideoLowTrack);if(o){const c=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=c,o.track._originMediaStreamTrack=c,await new Te((d,p)=>{this.handleReplaceTrack(o.track,d,p,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],s=this.getAllTracks();e=ku(e=e.filter(p=>s.indexOf(p)===-1));let o,c=!1;const d=this.localTrackMap.get(le.LocalAudioTrack);for(const p of e){if(p instanceof tn&&(this.localTrackMap.has(le.LocalVideoTrack)||c?new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:p,type:le.LocalVideoTrack}),c=!0),t)){const f=this.getLowVideoTrack(p,n);i.push({track:f,type:le.LocalVideoLowTrack})}if(p instanceof gn)if(d){const f=d.track;if(f instanceof Bn)hw([p]),f.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{const m=pw([f,p]);b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(f,m)}}else o instanceof Bn?(hw([p]),o.addAudioTrack(p)):o||!p._useAudioElement&&gt().webAudioMediaStreamDest&&!p._bypassWebAudio?o=pw(o?[p,o]:[p]):o=p}return o&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:le.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=ku(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof gn){const s=this.localTrackMap.get(le.LocalAudioTrack);if(!s)continue;s.track instanceof Bn?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([le.LocalAudioTrack,s]),s.track.close())):t.push([le.LocalAudioTrack,s])}if(i instanceof tn){const s=this.localTrackMap.get(le.LocalVideoTrack);if(!s)continue;t.push([le.LocalVideoTrack,s]);const o=this.localTrackMap.get(le.LocalVideoLowTrack);o&&t.push([le.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=ku(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=ku(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case le.LocalVideoTrack:n.addListener(Ne.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ne.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bn?e.trackList.forEach(n=>{n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ne.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case le.LocalVideoTrack:n.off(Ne.GET_STATS,this.handleGetLocalVideoStats),n.off(Ne.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bn?e.trackList.forEach(t=>{t.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ne.GET_STATS,this.handleGetLocalAudioStats),t.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ne.GET_STATS,this.handleGetLocalAudioStats),e.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ne.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Yu&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof qu&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ne.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Oe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Oe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var s;let o,c,{track:d,type:p}=n;switch(p){case le.LocalAudioTrack:o=Nt.Audio,c={dtx:d instanceof gg&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case le.LocalVideoTrack:o=ve(s=d._hints).call(s,qt.SCREEN_TRACK)?Nt.Screen:Nt.High,c=Jo(Jo({},uk(d)),{},{codec:this.store.codec,svc_mode:xg()});break;case le.LocalVideoLowTrack:o=Nt.Low,c=Jo(Jo({},uk(d)),{},{codec:this.store.codec,svc_mode:xg()})}return{stream_type:o,attributes:c,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:s,type:o}=n;this.localTrackMap.set(o,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ve.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ga&&dM(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Va.DISCONNECTED_OR_FAILED,Vs(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(s=>s.getTrackId()),i=this.pendingLocalDataChannels.map(s=>"dc_".concat(s.id));xe.reportApiInvoke(this.store.sessionId,{name:Mn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:fn.TRACER}).onSuccess(),this.republish()}if(V("NEW_ICE_RESTART")&&e instanceof Ga&&!_n()&&!this._forceTurn){if(ve(sk).call(sk,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=s=>{fw(e)&&(b.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(s)),Vs(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ve.RequestRestartICE,s))},i=()=>{fw(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),b.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{uM(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&V("ICE_RESTART")&&Vs(this,Ve.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ve.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(b.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ve.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:fn.TRACER}).onSuccess(),this.emit(Ve.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(Gu.FIRST_FRAME_DECODED),xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);i&&xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);i&&xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&i===s||this.emit(Ve.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Uc(n))," -> ").concat(JSON.stringify(Uc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Uc(n))," -> ").concat(JSON.stringify(Uc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Jo(Jo({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ga&&function(t){lh.delete(t.id),dM(t)}(e),e.close(),this.emit(Ve.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof gn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive||t.push([le.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(i&&(t.push(i),i[0]===le.LocalVideoTrack)){const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof gn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive&&t.push([le.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(i)if(i[0]===le.LocalVideoTrack){t.push(i);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(s=>{let[o,c]=s;n.push([e,{kind:o,id:c}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:s,id:o}]=n;switch(s){case Oe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Oe.VIDEO,ssrcId:i._videoSSRC}));case Oe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Oe.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:s}]=n;if(t.has(i)){let o=t.get(i);s===Oe.VIDEO?o|=Yn.Video:o|=Yn.Audio,t.set(i,o)}else s===Oe.VIDEO?t.set(i,Yn.Video):t.set(i,Yn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,s]=n;return{stream_id:i.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Te((i,s)=>{this.handleUpdateVideoEncoder(t.track,i,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Te((i,s)=>{this.handleUpdateVideoEncoder(n.track,i,s,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((i,s)=>{var o;let{stream_type:c}=i;const d=(o=t.find(p=>{let{stream_type:f}=p;return c===f}))===null||o===void 0?void 0:o.attributes;if(d&&V("DISABLE_SCREEN_SHARE_REMB")){const p=n[s]._hints;(ve(p).call(p,qt.SCREEN_TRACK)||ve(p).call(p,qt.SCREEN_LOW_TRACK))&&(d.remb=!1,b.debug("disable remb for screen share, hints:",p))}return d})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof gn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(o=>{let[,{id:c}]=o;return c})));const s=this.createUnmuteMessage(i);return void await zt(this,Ve.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ve.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ve.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ci(aR(this.dtlsFailedCount,jn)),this.emit(Ve.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await fi(this,Ve.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ve.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof tn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof tn).length>1)throw new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof gn).length>1&&(e.some(t=>t instanceof gn&&t._bypassWebAudio)||!gt().webAudioMediaStreamDest))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof tn&&this.pendingLocalTracks.some(n=>n instanceof tn))throw new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof gn&&this.pendingLocalTracks.some(n=>n instanceof gn)&&(!gt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof gn&&n._bypassWebAudio)))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding,s=Jo(Jo({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=i?e._mediaStreamTrack.clone():mw(e,s);const c=Yt(8,"track-low-"),d=new tn(o,Jo(Jo({},i&&{scaleResolutionDownBy:XR(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,c);return d.on(Gl.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,Fu.LOW_STREAM)}),d._hints.push(qt.LOW_STREAM),ve(n=e._hints).call(n,qt.SCREEN_TRACK)&&d._hints.push(qt.SCREEN_LOW_TRACK),e.on("sei-to-send",p=>{d.emit("sei-to-send",p)}),e.addListener(Ne.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ga){var s,o,c,d;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:m,peerConnectionState:g}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();xe.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:f,dtlsstate:m,connectionstate:g,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(s=v==null?void 0:v.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(o=v.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(c=y.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(d=y.candidateType)!==null&&d!==void 0?d:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,i){var s;const o=Array.from(Bs(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find(p=>p.userId===o.uid&&p.type==="video");xe.firstRemoteVideoDecode(this.store.sessionId,zn.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:i?1:0,firstFrame:(d==null?void 0:d.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const o=await this.connection.getRemoteSSRC(s);return o!==void 0&&o!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Fu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},De(ot.prototype,"startP2PConnection",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"startP2PConnection"),ot.prototype),De(ot.prototype,"connect",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"connect"),ot.prototype),De(ot.prototype,"updateRemoteRTPCapabilities",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"updateRemoteRTPCapabilities"),ot.prototype),De(ot.prototype,"publishDataChannel",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"publishDataChannel"),ot.prototype),De(ot.prototype,"unpublish",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unpublish"),ot.prototype),De(ot.prototype,"unpublishDataChannel",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unpublishDataChannel"),ot.prototype),De(ot.prototype,"unpublishLowStream",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unpublishLowStream"),ot.prototype),De(ot.prototype,"subscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"subscribeDataChannel"),ot.prototype),De(ot.prototype,"subscribe",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"subscribe"),ot.prototype),De(ot.prototype,"massSubscribe",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"massSubscribe"),ot.prototype),De(ot.prototype,"unsubscribe",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unsubscribe"),ot.prototype),De(ot.prototype,"unsubscribeDataChannel",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unsubscribeDataChannel"),ot.prototype),De(ot.prototype,"massUnsubscribe",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"massUnsubscribe"),ot.prototype),De(ot.prototype,"muteRemote",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"muteRemote"),ot.prototype),De(ot.prototype,"unmuteRemote",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"unmuteRemote"),ot.prototype),De(ot.prototype,"hasRemoteMediaWithLock",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"hasRemoteMediaWithLock"),ot.prototype),De(ot.prototype,"disconnectForReconnect",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"disconnectForReconnect"),ot.prototype),De(ot.prototype,"updateBitrateLimit",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"updateBitrateLimit"),ot.prototype),De(ot.prototype,"remoteMediaSsrcChanged",[Mi],Object.getOwnPropertyDescriptor(ot.prototype,"remoteMediaSsrcChanged"),ot.prototype),ot);function Mi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,d=new Array(c),p=0;p<c;p++)d[p]=arguments[p];return await i.apply(this,d)}finally{o()}},n}function fM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function mM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fM(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const KK=Date.now(),Ew=new Map,Qg=new Map;async function _M(e){const t=Ew.get(e),n=Array.isArray(t)&&t[t.length-1],i=Qg.get(e);if(!n)return void(i.isSyncing=!1);const s={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const o=n.sendTs-i.firstSendTs,c=o-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-o);let d=n.mediaDelay+c;d<=0?(t.pop(),EM(n.context,s),d=0):d=Math.min(d,20),setTimeout(()=>t.length&&_M(e),d)}function EM(e,t){e.safeEmit(at.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function zK(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return EM(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),s=Ew.get(i)||[],o=s.findIndex(f=>e.sendTs>=f.sendTs),c=mM(mM({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});o===-1?s.push(c):s.splice(o,0,c),Ew.set(i,s);let d=!1;var p;Qg.has(i)?d=!((p=Qg.get(i))===null||p===void 0||!p.isSyncing):Qg.set(i,{isSyncing:d,firstRecvTs:0,firstSendTs:0}),d||_M(i)}const YK=Et().name;function gM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function vM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gM(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const dh="websdk_ng_cache_parameter",qK=V("MAX_PRELOAD_ASYNC_LENGTH"),ed=new Map,td=[];let gw=null,vw=0,Sw=0;const Zg=new Map,$K=function(e,t){const n=[];let i=0;const s=async()=>{const o=n.shift();o&&await o(),n.length>0&&i<t?s():i--};return async function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return new Te(async(p,f)=>{n.push(async()=>{try{const m=await e(...c);p(m)}catch(m){f(m)}}),i<t&&(i++,s())})}}(SM,qK),Tw=Zi.CancelToken.source();async function SM(e,t,n,i,s,o){try{if(!V("ENABLE_PRELOAD"))return;if(!gt().supportWebCrypto)return void Lc(()=>{b.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new re(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ai(n,"token",1,2047),ai(e,"appid",1,2047),Og(t),i&&Ng(i);const c=Fl();b.debug("preload channel ".concat(t,", uid is ").concat(i));const d={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:c,proxyServer:s};let p,f;typeof i=="string"?(d.stringUid=i,[f,p]=await Te.all([PK(i,{sid:c,appId:e},Tw.token),Gk(vM(vM({},d),{},{token:n||e,uid:0}),Tw.token)]),d.uid=f.uid,p.gatewayInfo.uid=d.uid,p.gatewayInfo.res.uid=d.uid):(o&&(d.stringUid=o),p=await Gk(d,Tw.token));const m={sid:c,appId:e,cname:t,token:n||e,uid:d.stringUid||i,intUid:d.uid||p.gatewayInfo.uid,stringUid:d.stringUid,ts:Date.now(),sua:f,ap:p};await async function(g){let v;try{g.uid&&yM({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});const y=wM(g),D=await async function(I,k){try{const M=await window.crypto.subtle.importKey("raw",E1(k),"AES-GCM",!1,["encrypt"]),H=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},M,Vl(window.btoa(JSON.stringify(I))));return xc(new Uint8Array(H))}catch{return}}(g,g.token||g.appId);if(!D)return;v=RM(dh);const A=v?JSON.parse(v):[];A.push({[y]:D}),A.length>V("AP_CACHE_NUM")&&A.shift(),ev(dh,JSON.stringify(A))}catch(y){b.warn("Error caching server parameters:",y.message),ev(dh,"")}}(m),vw++}catch(c){throw Sw++,function(d){gw||(gw=window.setTimeout(()=>{let f="";Zg.forEach((m,g)=>{f+="".concat(g,": ").concat(m," ;")}),xe.reportApiInvoke(null,{name:Mn.PRELOAD,options:{success:vw,failed:Sw,err:f}}).onError(d),vw=0,Sw=0,Zg.clear(),gw=null},1e4));const p=Zg.get(d.code)||0;Zg.set(d.code,p+1)}(c),c}}async function TM(e){try{if(V("AP_REQUEST_DETAIL")||V("ENABLE_ROLE_SELECT_EDGE"))return;const t=yM(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,s){try{const o=await window.crypto.subtle.importKey("raw",E1(s),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,Vl(i));return JSON.parse(window.atob(xc(new Uint8Array(c))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,s){return i.cname===s.cname&&i.appId===s.appId&&i.token===s.token?s.stringUid?i.stringUid===s.stringUid:typeof s.uid=="number"?i.uid===s.uid:i.uid==s.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<V("AP_CACHE_LIFETIME"))return n}catch(t){b.warn("Error get preloadInfo",t.message)}}function yM(e){let t;try{if(t=RM(dh),!t)return;const n=JSON.parse(t),i=wM(e),s=function(c,d){for(let p=c.length-1;p>=0;p--)if(d(c[p]))return p;return-1}(n,c=>i in c);if(s===-1)return;const o=n.splice(s,1)[0];return ev(dh,JSON.stringify(n)),o[i]}catch(n){b.warn("Error delete preload info: ".concat(t),n.message),ev(dh,"")}}function yw(e){if(e){let t=ed.get(e);t&&(window.clearTimeout(t),t=null,ed.delete(e)),ve(td).call(td,e)||e.cloudProxyServer!=="disabled"||td.push(e)}if(ed.size<V("AP_CACHE_NUM")&&td.length>0){const t=td.shift();ed.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:s,stringUid:o,uid:c,proxyServer:d}=t;try{await $K(n,i,s,c,d,o),ed.has(t)&&yw(t)}catch(p){b.warn("update preload failed",p.message),bM(t)}},V("AP_UPDATE_INTERVAL")))}}function bM(e){const t=td.indexOf(e);t!==-1&&td.splice(t,1);let n=ed.get(e);n&&(window.clearTimeout(n),n=null,ed.delete(e),yw())}function CM(e,t){const n=e.sua,i=e.ap;t&&n&&xe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),xe.reportResourceTiming(e.ap.url,e.sid),xe.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[Dn.CHOOSE_SERVER,Dn.CLOUD_PROXY_FALLBACK].toString()}),xe.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Dn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function RM(e){return window.atob(window.localStorage.getItem(e)||"")}function ev(e,t){window.localStorage.setItem(e,window.btoa(t))}function wM(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),C1(t)}function JK(e){let t=function(){const n=ZK.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let s=n.appId;s!==void 0&&(xn(i,10),Hc(i,s));let o=n.cid;o!==void 0&&(xn(i,16),xn(i,o));let c=n.cname;c!==void 0&&(xn(i,26),Hc(i,c));let d=n.deviceId;d!==void 0&&(xn(i,34),Hc(i,d));let p=n.elapse;p!==void 0&&(xn(i,40),Wc(i,p));let f=n.fileSize;f!==void 0&&(xn(i,48),Wc(i,uh(f)));let m=n.height;m!==void 0&&(xn(i,56),Wc(i,uh(m)));let g=n.jpg;g!==void 0&&(xn(i,66),xn(i,g.length),IM(i,g));let v=n.networkType;v!==void 0&&(xn(i,72),Wc(i,uh(v)));let y=n.osType;y!==void 0&&(xn(i,80),Wc(i,uh(y)));let D=n.requestId;D!==void 0&&(xn(i,90),Hc(i,D));let A=n.sdkVersion;A!==void 0&&(xn(i,98),Hc(i,A));let I=n.sequence;I!==void 0&&(xn(i,104),Wc(i,uh(I)));let k=n.sid;k!==void 0&&(xn(i,114),Hc(i,k));let M=n.timestamp;M!==void 0&&(xn(i,120),Wc(i,M));let H=n.uid;H!==void 0&&(xn(i,128),xn(i,H));let J=n.vid;J!==void 0&&(xn(i,136),xn(i,J));let $=n.width;$!==void 0&&(xn(i,144),Wc(i,uh($)));let z=n.service;z!==void 0&&(xn(i,152),xn(i,z));let oe=n.callbackData;oe!==void 0&&(xn(i,162),xn(i,oe.length),IM(i,oe));let de=n.ticket;de!==void 0&&(xn(i,170),Hc(i,de));let be=n.vendorConfigs;be!==void 0&&(xn(i,178),Hc(i,be))}(e,t),function(n){let i=n.bytes,s=n.limit;return i.length===s?i:i.subarray(0,s)}(t)}function XK(e){return function(n){let i={};e:for(;!ez(n);){let s=wf(n);switch(s>>>3){case 0:break e;case 1:i.code=wf(n);break;case 2:i.msg=OM(n,wf(n));break;case 3:i.requestId=OM(n,wf(n));break;case 4:i.timestamp=tz(n,!1);break;default:QK(n,7&s)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function QK(e,t){switch(t){case 0:for(;128&Vr(e););break;case 2:bw(e,wf(e));break;case 5:bw(e,4);break;case 1:bw(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function uh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ZK=[];function bw(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function ez(e){return e.offset>=e.limit}function tv(e,t){let n=e.bytes,i=e.offset,s=e.limit,o=i+t;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),e.bytes=c}return e.offset=o,o>s&&(e.limit=o),i}function AM(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function IM(e,t){let n=tv(e,t.length);e.bytes.set(t,n)}function OM(e,t){let n=AM(e,t),i=String.fromCharCode,s=e.bytes,o="�",c="";for(let d=0;d<t;d++){let p,f,m,g,v=s[d+n];128&v?(224&v)==192?d+1>=t?c+=o:(p=s[d+n+1],(192&p)!=128?c+=o:(g=(31&v)<<6|63&p,g<128?c+=o:(c+=i(g),d++))):(240&v)==224?d+2>=t?c+=o:(p=s[d+n+1],f=s[d+n+2],(49344&(p|f<<8))!=32896?c+=o:(g=(15&v)<<12|(63&p)<<6|63&f,g<2048||g>=55296&&g<=57343?c+=o:(c+=i(g),d+=2))):(248&v)==240?d+3>=t?c+=o:(p=s[d+n+1],f=s[d+n+2],m=s[d+n+3],(12632256&(p|f<<8|m<<16))!=8421504?c+=o:(g=(7&v)<<18|(63&p)<<12|(63&f)<<6|63&m,g<65536||g>1114111?c+=o:(g-=65536,c+=i(55296+(g>>10),56320+(1023&g)),d+=3))):c+=o:c+=i(v)}return c}function Hc(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),i+=d<128?1:d<2048?2:d<65536?3:4}xn(e,i);let s=tv(e,i),o=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?o[s++]=d:(d<2048?o[s++]=d>>6&31|192:(d<65536?o[s++]=d>>12&15|224:(o[s++]=d>>18&7|240,o[s++]=d>>12&63|128),o[s++]=d>>6&63|128),o[s++]=63&d|128)}}function Vr(e){return e.bytes[AM(e,1)]}function NM(e,t){let n=tv(e,1);e.bytes[n]=t}function wf(e){let t,n=0,i=0;do t=Vr(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function xn(e,t){for(t>>>=0;t>=128;)NM(e,127&t|128),t>>>=7;NM(e,t)}function tz(e,t){let n,i=0,s=0,o=0;return n=Vr(e),i=127&n,128&n&&(n=Vr(e),i|=(127&n)<<7,128&n&&(n=Vr(e),i|=(127&n)<<14,128&n&&(n=Vr(e),i|=(127&n)<<21,128&n&&(n=Vr(e),s=127&n,128&n&&(n=Vr(e),s|=(127&n)<<7,128&n&&(n=Vr(e),s|=(127&n)<<14,128&n&&(n=Vr(e),s|=(127&n)<<21,128&n&&(n=Vr(e),o=127&n,128&n&&(n=Vr(e),o|=(127&n)<<7))))))))),{low:i|s<<28,high:s>>>4|o<<24,unsigned:t}}function Wc(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,o=s===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=tv(e,o),d=e.bytes;switch(o){case 10:d[c+9]=s>>>7&1;case 9:d[c+8]=o!==9?128|s:127&s;case 8:d[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:d[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:d[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:d[c+4]=o!==5?128|i:127&i;case 4:d[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:d[c]=o!==1?128|n:127&n}}const DM={},PM={},LM=4294967296,nz=18446744073709552e3,xM=nz/2;MM(0,!0);const kM=MM(0),iz=Af(0,-2147483648,!1),sz=Af(-1,2147483647,!1);function MM(e,t){let n,i,s;return t?(s=0<=(e>>>=0)&&e<256)&&(i=PM[e],i)?i:(n=Af(e,0,!0),s&&(PM[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(i=DM[e],i)?i:(n=Af(e,e<0?-1:0,!1),s&&(DM[e]=n),n)}function Af(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function jM(e,t){if(isNaN(e))return kM;{if(e<=-xM)return iz;if(e+1>=xM)return sz}return e<0?kM:Af(e%LM|0,e/LM|0,t)}function UM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}class Cw extends dn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(_o.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",lr.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Zi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==lr.CONNECTED)throw new Q(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===lr.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Yt(5,"image-moderation-"),this._workerMessageLengthLimit=V("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=V("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=V("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ef("worker-"+this._moderationId,jn),this.on(_o.STATE_CHANGE,(i,s)=>{b.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Zu[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(_o.STATE_CHANGE,Zu.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Te((s,o)=>{this.on(_o.CONNECTION_STATE_CHANGE,(c,d)=>{c===lr.CONNECTED&&s()}),this.requestAP(t,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{o(c)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),b.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===lr.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const s=V("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),o=await function(p,f,m,g){let{appId:v,areaCode:y,cname:D,sid:A,token:I,uid:k}=f;oh++;const M="moderation_plugin",H={service_name:M,json_body:JSON.stringify({appId:v,areaCode:y,cname:D,command:"allocateEdge",requestId:oh,seq:oh,sid:A,appToken:I,ts:Date.now(),uid:k+""})};let J,$,z=p[0];return ho(async()=>{J=Date.now();const oe=await Eo(z,{data:H,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-J,oe.code!==0){const Re=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+oe.code,{retry:!0,responseTime:$});throw b.error(Re.toString()),Re}const de=JSON.parse(oe.json_body);if(de.code!==200){const Re=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:$});throw b.error(Re.toString()),Re}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){const Re=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:de.code,responseTime:$});throw b.error(Re.toString()),Re}if(!de.servers.some(Re=>!!Re.wss)){const Re=new Q(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:de.code,responseTime:$});throw b.error(Re.toString()),Re}const be=V("IMAGE_MODERATION_WORKER_HOST");return{addressList:de.servers.map(Re=>{let{address:dt,wss:ut}=Re;if(dt&&ut)return"wss://".concat(dt.replace(/\./g,"-"),".").concat(be,":").concat(ut,"/moderation")}).filter(Re=>!!Re),workerToken:de.workerToken,vid:de.vid,ticket:de.appTicket,responseTime:$}},(oe,de)=>(xe.apworkerEvent(A,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(oe.addressList),firstSuccess:de===0,responseTime:$,serverIp:p[de%p.length]}),!1),(oe,de)=>(xe.apworkerEvent(A,{success:!1,sc:oe.data&&oe.data.code||200,serviceName:M,responseTime:$,serverIp:p[de%p.length]}),!!(oe.code!==L.OPERATION_ABORTED&&oe.code!==L.UNEXPECTED_RESPONSE||oe.data&&oe.data.retry)&&(z=p[(de+1)%p.length],!0)),g)}(s,t,n,i);this.emit(_o.STATE_CHANGE,Zu.AP_CONNECTED);const{addressList:c,ticket:d}=o;return this._ticket=d,c}async connectWorker(t){this.emit(_o.STATE_CHANGE,Zu.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(et.CONNECTED,async()=>{this.emit(_o.STATE_CHANGE,Zu.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=lr.CONNECTED}),this._workerConnection.on(et.CLOSED,()=>{this.connectionState=lr.CLOSED}),this._workerConnection.on(et.FAILED,()=>{this.connectionState=lr.CLOSED}),this._workerConnection.on(et.RECONNECTING,()=>{this.connectionState=this.connectionState===lr.CONNECTED?lr.RECONNECTING:lr.CONNECTING}),this._workerConnection.on(et.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=XK(new Uint8Array(t.data));V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,b.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{xe.reportApiInvoke(this._connectInfo.sid||null,{name:Mn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:fn.TRACER}).onError(new Q(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},V("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else b.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(et.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(et.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Vs(this,_o.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&b.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:s,cid:o,vid:c,sid:d,uid:p}=n;const f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await uL(m,i,s),v=this._sequence+"-"+o+"-"+p+"-"+f+"-"+Yt(12,""),y={appId:i,cid:o,cname:s,deviceId:"",elapse:Cw.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this._sequence,sid:d,timestamp:jM(f),uid:p,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const D=JK(y);if(D.byteLength<this._workerMessageLengthLimit){if(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(I){for(var k=1;k<arguments.length;k++){var M=arguments[k]!=null?arguments[k]:{};k%2?UM(Object(M),!0).forEach(function(H){N(I,H,M[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(M)):UM(Object(M)).forEach(function(H){Object.defineProperty(I,H,Object.getOwnPropertyDescriptor(M,H))})}return I}({},y);delete A.jpg,b.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return D}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:i,cname:s,cid:o,vid:c,sid:d,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=lr.CLOSED,this.emit(_o.STATE_CHANGE,Zu.CLOSED)}}function VM(e){if(Ut(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Q(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Q(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const rz={name:"ImageModeration",create:function(e){let{config:t}=e;return VM(t),new Cw(t)}};var FM,BM,GM,HM,WM,KM,zM,YM,qM,$M,JM,XM,QM,ZM,ej,tj,nj,ij,sj,rj,oj,aj,cj,lj,dj,uj,hj,pj,fj,mj,_j,Ej,gj,vj,Sj,Tj,yj,bj,Cj,Rj,wj,Ce;function Aj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Fr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Aj(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}vi.setLogger(b);let oz=(FM=He(),BM=He({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Wu))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),GM=He({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Hu.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),HM=He({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),WM=He({argsMap:(e,t,n)=>[t,n]}),KM=He({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:s}=n;return[i==null?void 0:i.uid,s]})}),zM=He({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),YM=He({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:s}=n;return{uid:i==null?void 0:i.uid,mediaType:s}})}),qM=He(),$M=He(),JM=He(),XM=He(),QM=He(),ZM=He(),ej=He(),tj=He(),nj=He(),ij=He(),sj=He(),rj=He(),oj=He(),aj=He(),cj=He(),lj=He({argsMap:(e,t)=>[t]}),dj=He(),uj=He(),hj=He(),pj=He(),fj=He(),mj=He(),_j=He(),Ej=He(),gj=He({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),vj=He(),Sj=He(),Tj=He(),yj=He(),bj=He(),Cj=He(),Rj=He({reportResult:!0}),wj=He(),Ce=class extends dn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",void 0),N(this,"_publishMutex",void 0),N(this,"_renewTokenMutex",void 0),N(this,"_subscribeMutex",void 0),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",Zi.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_peerConnectionState",void 0),N(this,"_handleLocalTrackEnable",(s,o,c)=>{this.publish(s,!1).then(o).catch(c)}),N(this,"_handleLocalTrackDisable",(s,o,c)=>{this.unpublish(s).then(o).catch(c)}),N(this,"_handleUserOnline",s=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(s.uid,this.channelName))return void b.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&b.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find(c=>c.uid===s.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(at.USER_JOINED,o));else{const c=new Bc(s.uid,s.uint_id||s.uid);this._users.push(c),b.debug("[".concat(this._clientId,"] user online"),s.uid),this.safeEmit(at.USER_JOINED,c)}}),N(this,"_handleUserOffline",s=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(s.uid,this.channelName))return;const o=this._users.find(c=>c.uid===s.uid);o&&(this._handleRemoveStream(s),this._handleRemoveDataChannels(s),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:sg(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),b.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit(at.USER_LEAVED,o,s.reason))}),N(this,"_handleAddAudioOrVideoStream",(s,o,c,d,p,f,m)=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(o,this.channelName))return;const g=this._users.find(y=>y.uid===o);if(!g)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(s)),this.store.subscribe(g.uid,s,void 0,void 0,void 0,Date.now());const v=s==="audio"?g.hasAudio:g.hasVideo;g._uintid||(g._uintid=p||o),s==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,s==="audio"?(g._audio_added_=!0,c!==void 0&&(g._audioSSRC=c),d!==void 0&&(g._cname=d),f&&(g._audioOrtc=f)):(g._video_added_=!0,c!==void 0&&(g._videoSSRC=c),d!==void 0&&(g._cname=d),m!==void 0&&(g._rtxSsrcId=m),f&&(g._videoOrtc=f)),(s==="audio"?g.hasAudio:g.hasVideo)&&!v&&(b.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(s)),this.safeEmit(at.USER_PUBLISHED,g,s)),s==="video"?xe.onGatewayStream(this._sessionId,zn.ON_ADD_VIDEO_STREAM,sn.ON_ADD_VIDEO_STREAM,{peer:p||o,ssrc:g._videoSSRC}):xe.onGatewayStream(this._sessionId,zn.ON_ADD_AUDIO_STREAM,sn.ON_ADD_AUDIO_STREAM,{peer:p||o,ssrc:g._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(g,s,c).then(y=>{if(y&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(g.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Rf))return this._p2pChannel.unsubscribe(g,s,!0).then(()=>this._subscribe(g,s,!0).catch(D=>{b.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(g,s)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,s,!0).catch(y=>{b.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),N(this,"_handleRemoveStream",s=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(s.uid,this.channelName))return;const o=this._users.find(d=>d.uid===s.uid);if(!o)return void b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));b.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let c=()=>{};o.hasAudio&&o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(at.USER_UNPUBLISHED,o,"audio"),b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(at.USER_UNPUBLISHED,o,"video")}:o.hasVideo?c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(at.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(c=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(at.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof Rf&&this._p2pChannel.unsubscribe(o).then(d=>{if(d)return this._gateway.unsubscribe(d,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),xe.onGatewayStream(this._sessionId,zn.ON_REMOVE_STREAM,sn.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),c()}),N(this,"_handleSetStreamLocalEnable",(s,o,c)=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(o,this.channelName))return;const d=this._users.find(m=>m.uid===o);if(!d)return void b.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));b.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(c?"enabled":"disabled"," with uid ").concat(o));const p=s==="audio"?d.hasAudio:d.hasVideo;if(s==="audio"){d._trust_audio_enabled_state_=!0;const m=d._audio_enabled_;if(d._audio_enabled_=c,d._audio_enabled_===m)return;{const g=d._audio_enabled_?"enable-local-audio":"disable-local-audio";b.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit(at.USER_INFO_UPDATED,o,g)}}else{d._trust_video_enabled_state_=!0;const m=d._video_enabled_;if(d._video_enabled_=c,d._video_enabled_===m)return;{const g=d._video_enabled_?"enable-local-video":"disable-local-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit(at.USER_INFO_UPDATED,o,g)}}const f=s==="audio"?d.hasAudio:d.hasVideo;return p!==f?!p&&f?(b.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(s)),void this.safeEmit(at.USER_PUBLISHED,d,s)):(s==="video"&&d._videoTrack&&d._videoTrack._destroy(),s==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,s),b.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(s)),void this.safeEmit(at.USER_UNPUBLISHED,d,s)):void 0}),N(this,"_handleMuteStream",(s,o,c)=>{if(V("BLOCK_LOCAL_CLIENT")&&ql(s,this.channelName))return;b.debug("[".concat(this._clientId,"] receive mute message"),s,o,c);const d=this._users.find(m=>m.uid===s);if(!d)return void b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const p=o==="audio"?d.hasAudio:d.hasVideo;if(o==="audio"){d._trust_audio_mute_state_=!0;const m=d._audio_muted_;if(d._audio_muted_=c,d._audio_muted_===m)return;{const g=d._audio_muted_?"mute-audio":"unmute-audio";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit(at.USER_INFO_UPDATED,s,g)}}else{d._trust_video_mute_state_=!0;const m=d._video_muted_;if(d._video_muted_=c,d._video_muted_===m)return;{const g=d._video_muted_?"mute-video":"unmute-video";b.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit(at.USER_INFO_UPDATED,s,g)}}const f=o==="audio"?d.hasAudio:d.hasVideo;if(p!==f){if(!p&&f)return(o==="audio"?d._audioSSRC:d._videoSSRC)?(b.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(o)),void this.safeEmit(at.USER_PUBLISHED,d,o)):void b.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&d._videoTrack&&!d._video_pre_subscribed&&d._videoTrack._destroy(),o==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,o),b.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(o)),this.safeEmit(at.USER_UNPUBLISHED,d,o)}}),N(this,"_handleP2PLost",async s=>{b.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():b.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)}),N(this,"_handleTokenWillExpire",()=>{b.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(at.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),b.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(at.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(at.NETWORK_QUALITY,s)}),N(this,"_handleP2PAddAudioOrVideoStream",(s,o,c,d)=>{const p=this._users.find(m=>m.uid===o);if(!p)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));b.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(s)),this.store.subscribe(p.uid,s,void 0,void 0,void 0,Date.now());const f=s==="audio"?p.hasAudio:p.hasVideo;s==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,s==="audio"?(p._audio_added_=!0,c!==void 0&&(p._audioSSRC=c),d!==void 0&&(p._audioMid=d)):(p._video_added_=!0,c!==void 0&&(p._videoSSRC=c),d!==void 0&&(p._videoMid=d)),(s==="audio"?p.hasAudio:p.hasVideo)&&!f&&(b.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(s)),this.safeEmit(at.USER_PUBLISHED,p,s)),this._p2pChannel.hasPendingRemoteMedia(p,s)&&(b.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,s,!0).catch(m=>{b.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||Yt(5,"client-"),this.store=new e7(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new vi("client-leave",this._clientId),this._publishMutex=new vi("client-publish",this._clientId),this._renewTokenMutex=new vi("client-renewtoken",this._clientId),this._subscribeMutex=new vi("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),b.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(or," build: ").concat(ER,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{sR(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(s){b.warning("[".concat(this._clientId,"] ").concat(s.toString()))}var i;this._statsCollector=new bf(this.store),this._statsCollector.onStatsException=(s,o,c)=>{b.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(o,", uid: ").concat(c)),this.safeEmit(at.EXCEPTION,{code:s,msg:o,uid:c})},this._statsCollector.onUploadPublishDuration=(s,o,c,d)=>{const p=this._users.find(f=>f.uid===s);p&&xe.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:o,videoPublishDuration:c,peer:p._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new AK(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||jn,httpRetryConfig:e.httpRetryConfig||jn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new MK(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Fc("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Rf(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,s){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];xt("JOIN_GATEWAY_USE_443PORT_ONLY",o),xt("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const d=this._gateway.signal.websocket;return d instanceof $R&&(d.use443PortOnly=o,d.tryDoubleDomain=c),async function(p,f,m){ZE.get(p)||ZE.set(p,[]),eg.get(p)||eg.set(p,f),Bo.get(p)||Bo.set(p,0);const g=ZE.get(p),v=eg.get(p);if(!g||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Bo.get(p)===v){const k=tf();g.push(k),await k.promise}Bo.set(p,Bo.get(p)+1);for(var y=arguments.length,D=new Array(y>3?y-3:0),A=3;A<y;A++)D[A-3]=arguments[A];const I=await m(...D);return Bo.set(p,Bo.get(p)-1),Bo.get(p)===v-1&&g.length>0&&(g[0].resolve(),g.shift()),Bo.get(p)===0&&(ZE.set(p,[]),eg.set(p,0),Bo.set(p,0)),I}("client.join",V("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,s)}async join(e,t,n,i,s){const o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(ag||ag||(ag=(window.location.protocol.split(":")[0]||"").toUpperCase(),ag))==="HTTPS",d=A1()?window.isSecureContext:"Browser Not Support";(!A1()&&!c||!window.isSecureContext)&&b.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),b.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),xe.setAppId(e);try{if(!n&&n!==null)throw new Q(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ai(n,"token",1,2047),ai(e,"appid",1,2047),Og(t),i&&Ng(i),s&&ai(s,"optionalInfo",1,2047)}catch(A){throw xe.reportApiInvoke(Fl(),{name:Mn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:fn.TRACER}).onError(A),A}if(this._leaveMutex.isLocked&&(b.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),b.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const A=new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw xe.reportApiInvoke(Fl(),{name:Mn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:fn.TRACER}).onError(A),A}this._gateway.state="CONNECTING";const p=await TM({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const f=(p==null?void 0:p.sid)||Fl();b.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId);const m=xe.reportApiInvoke(f,{id:this._clientId,name:Mn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:fn.TRACER}),g=Fr(Fr(Fr({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:V("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(g.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(g.stringUid=i,this._uintUid?(g.uid=this._uintUid,this._uintUid=void 0):g.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(g.aesmode=this._encryptionMode,g.aespassword=await(async A=>{const I=function(){const J=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),$=new Uint8Array(new ArrayBuffer(J.length));for(let z=0;z<J.length;z+=1)$[z]=J.charCodeAt(z);return $}(),k=await window.crypto.subtle.importKey("spki",I,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),M=nR(A),H=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},k,M);return function(J){let $="";for(let z=0;z<J.length;z+=1)$+=String.fromCharCode(J[z]);return window.btoa($)}(new Uint8Array(H))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(g.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const A=new TextEncoder,I=V("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(g.appId+this._encryptionSecret+this._encryptionSecret):A.encode(g.appId+g.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(k,M,H){const J=await window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),$=k==="aes-128-gcm2"?128:256,z=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:H},J,$+96);return new Uint8Array(z).subarray($/8)}(this._encryptionMode,I,Vl(this._encryptionSalt)),this._encryptDataStreamKey=await async function(k,M,H){const J=await window.crypto.subtle.importKey("raw",M,"PBKDF2",!1,["deriveBits","deriveKey"]),$=k==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:H},J,{name:"AES-GCM",length:$},!0,["encrypt","decrypt"])}(this._encryptionMode,I,Vl(this._encryptionSalt))}else d?b.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):b.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,b.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:g.stringUid});const v=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&xe.joinChannelTimeout(this._sessionId,5)},5e3);try{var y;let A;const I=g.cloudProxyServer;if(ve(y=["proxy3","proxy4","proxy5"]).call(y,I)){const $=V("PROXY_SERVER_TYPE3");Array.isArray($)?g.proxyServer=$[0]:g.proxyServer=$}if(xe.setProxyServer(g.proxyServer),b.setProxyServer(g.proxyServer),this.store.requestAPStart(),p){if(b.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(g.stringUid?", ".concat(g.stringUid," => ").concat(p.intUid):""," ")),g.stringUid&&!g.uid&&(g.uid=p.intUid),A={gatewayInfo:p.ap.gatewayInfo},V("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&g.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)b.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const $=(await pk(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(z=>({turnServerURL:z.address,tcpport:z.tcpport||mi.tcpport,udpport:z.udpport||mi.udpport,username:z.username||mi.username,password:z.password||mi.password,forceturn:!1,security:!0}));g.turnServer={mode:"manual",servers:$}}CM(p,g.stringUid)}else{if(g.stringUid&&!g.uid){let $;[$,A]=await Te.all([Bk(g.stringUid,g,this._axiosCancelSource.token,this._config.httpRetryConfig||jn,this.store),Fk(g,this._axiosCancelSource.token,this._config.httpRetryConfig||jn,!0,this.store)]),b.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(g.stringUid," => ").concat($)),g.uid=$,A.gatewayInfo.uid=$,A.gatewayInfo.res.uid=$}else A=await Fk(g,this._axiosCancelSource.token,this._config.httpRetryConfig||jn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(g,this._axiosCancelSource.token),this._configDistribute.on(mf.UPDATE_BITRATE_LIMIT,$=>{this._p2pChannel.updateBitrateLimit($)}),this._configDistribute.on(mf.UPDATE_CLIENT_ROLE_OPTIONS,$=>{this._setClientRoleOptions($)})},0),this._key=n||e;const k=A.gatewayInfo,M=g.uid?g.uid:k.uid;this._joinInfo=Fr(Fr({},g),{},{cid:k.cid,uid:M,vid:k.vid,apResponse:k.res,apGatewayAddress:k.apGatewayAddress,uni_lbs_ip:k.uni_lbs_ip,gatewayAddrs:k.gatewayAddrs}),this.store.intUid=M,this.store.cid=k.cid;const H=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(H),this._appId=e,this._channelName=g.cname,this._uid=H,this.store.uid=H,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const J=g.stringUid?"string uid: ".concat(g.stringUid,",uid: ").concat(g.uid):"uid: ".concat(this._uid);return b.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(J)),setTimeout(()=>{b.startUpload()},5e3),this.store.joinEnd(),D=this,ve(Yl).call(Yl,D)||Yl.push(D),this._cloudProxyServerMode==="disabled"&&gt().supportWebCrypto&&V("ENABLE_PRELOAD")&&yw(this._joinInfo),H}catch(A){const I=Array.isArray(A)?A[0]:A;throw I&&I.code===L.OPERATION_ABORTED?b.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),I):b.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),I),I.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(I),I}var D}_joinGateway(){if(!this._joinInfo||!this._key)throw new Q(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){b.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Yl.indexOf(t);n!==-1&&Yl.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return b.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",wt.LEAVE),b.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Wu))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Q(L.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new Q(L.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof Wu))throw new Q(L.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new Q(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}b.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(s=>{const o=this._configDistribute.getBitrateLimit();s instanceof tn&&o&&s.setBitrateLimit(o.uplink)});try{await this._publishHighStream(n),b.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw b.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{i()}}async _publishDataChannel(e){Ut(e.id,"id",0,65535,!0),xa(e.ordered,"ordered"),ai(e.metadata,"metadata",0,512),b.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===e.id)!==-1)throw new Q(L.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new Q(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(s){return Dk(s,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Q(L.CREATE_DATACHANNEL_ERROR);try{await Te.all(i.map(s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0))),await n._waitTillOpen()}catch(s){if(s.code!==L.DISCONNECT_P2P)throw s}}return b.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw b.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Wu))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);b.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(Rn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),b.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(s=>"".concat(s.getTrackId()))))}}catch(i){throw b.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),b.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),b.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw b.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Bc)){const i=this.remoteUsers.find(s=>s.uid===e);if(!i)throw new Q(L.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Wn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Q(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Oe.AUDIO,i=t===Oe.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:c,rtxSsrcId:d,cname:p,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new Q(L.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(v=>v.uid===e);m||(m=new Bc(e,f||e),m._is_pre_created=!0,this._users.push(m)),p&&(m._cname=p),m._uintid||(m._uintid=f||e),n&&(m._audioSSRC=o,m._audio_pre_subscribed=!0,c&&(m._audioOrtc=c)),i&&(m._videoSSRC=o,m._video_pre_subscribed=!0,c&&(m._videoOrtc=c),d!=null&&(m._rtxSsrcId=d)),b.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(m,t,o,d,c);const g=n?m._audioTrack:m._videoTrack;if(!g)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),g}catch(o){throw b.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{s()}}async _subscribeDataChannel(e,t){var n;if(Ut(t,"channelId",0,65535,!0),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e))throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Q(L.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Q(L.INVALID_REMOTE_USER,"user is not published");const s=(n=e._dataChannels)===null||n===void 0?void 0:n.find(d=>d.id===t);if(!s)throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const d=await this._p2pChannel.subscribeDataChannel(e,[s]);if(d&&ve(d).call(d,s.id))try{var c;if(typeof s._originDataChannelId!="number")throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Q(L.CREATE_DATACHANNEL_ERROR);const p={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(c=s.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await s._waitTillOpen()}catch(p){if((p==null?void 0:p.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),p;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{o()}}async _p2pSubscribe(e,t,n){if(Wn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===e)){const o=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),o}if(!e.hasAudio&&!e.hasVideo){const o=new Q(L.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),o}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const o=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),o}const s=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const c=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,c,d)}catch(c){throw c}b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(c=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const o=t==="audio"?e._audioTrack:e._videoTrack;if(!o)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),o),o}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Wn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new Q(L.INVALID_REMOTE_USER,"user is not published");throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let s=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?Oe.AUDIO:Oe.VIDEO,ssrcId:s};const p=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==s&&(s=m,o=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?Oe.AUDIO:Oe.VIDEO,ssrcId:s}),Ti.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,c,o);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,d,!0)}catch(g){if((g==null?void 0:g.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),g;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}b.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{b.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new Q(L.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw b.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{p()}}async massSubscribe(e){if(ka(e,"subscribeList"),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();b.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(d=>{let{user:p,mediaType:f}=d;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(f)}).join("; ")));const s=(e=[...e]).map(d=>{let{user:p,mediaType:f}=d;return{user:p,mediaType:f}}),o=await this._p2pChannel.globalLock();try{var c;for(let p=e.length-1;p>=0;p--){const f=e[p],{user:m,mediaType:g}=f;if(Wn(g,"mediaType",["audio","video"]),!m){const A=new Q(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===m)){const A=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");b.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),s[p].error=A,e.splice(p,1);continue}if(g==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||g==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const A=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);b.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(g,", remote user is not published")),s[p].error=A,e.splice(p,1);continue}const y=Yn.Video|Yn.LwoVideo,D=n.get(m);if(D){if(g==="video"?D&y:D&Yn.Audio){e.splice(p,1),b.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(g," twice"));continue}n.set(m,D|(g==="video"?y:Yn.Audio))}else n.set(m,g==="video"?y:Yn.Audio)}for(let p=e.length-1;p>=0;p--){const f=e[p],{user:m,mediaType:g}=f,v=Yn.Video|Yn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,g)){await this._p2pChannel.unmuteRemoteNoLock(m,g);const y=n.get(m);n.set(m,g==="video"?y^v:y^Yn.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),t);let d=ks(c=Array.from(n.entries())).call(c,(p,f)=>{let[m,g]=f;if(g===0)return p;const v={stream_id:m.uid,stream_type:g};return g&Yn.Audio&&(v.audio_ssrc=m._audioSSRC),g&Yn.Video&&(v.video_ssrc=m._videoSSRC),p.push(v),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:m,mediaType:g}=f;return{user:m,mediaType:g,ssrcId:g===Oe.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:g===Oe.VIDEO?m._rtxSsrcId:void 0}}));const p=new Map;if(d=d.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),d.length>0){const f=await this._gateway.subscribeAll(d,!0);((f==null?void 0:f.users)||[]).forEach(m=>{let{stream_id:g,video_error_code:v,audio_error_code:y,error_code:D}=m;(v||y||D)&&p.set(g,{video_error_code:v,audio_error_code:y,error_code:D})})}if(Array.from(p.entries()).length>0){const f=[];Array.from(p.entries()).forEach(m=>{let[g,v]=m;const y=this.remoteUsers.find(D=>D.uid===g);if(y){let D;v.error_code||v.video_error_code&&v.audio_error_code?D=void 0:v.video_error_code?D=Oe.VIDEO:v.audio_error_code&&(D=Oe.AUDIO),f.push({user:y,mediaType:D})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of s){const m=p.get(f.user.uid);if(m){const g=m.error_code||f.mediaType==="audio"&&m.audio_error_code||f.mediaType==="video"&&m.video_error_code;if(g){const v=_f(g);b.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(v.desc)),f.error=new Q(L.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(v.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(s.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),s.forEach(f=>{var m;xe.subscribe(this.store.sessionId,{succ:!!f.error,ec:((m=f.error)===null||m===void 0?void 0:m.code)||null,video:f.mediaType===Oe.VIDEO,audio:f.mediaType===Oe.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Oe.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),b.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:m,mediaType:g}=f;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; "))),s}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{o(),i()}}async unsubscribe(e,t,n){if(!(e instanceof Bc)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Q(L.INVALID_REMOTE_USER,"user is not in the channel");e=o}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Wn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const o=await this._p2pChannel.unsubscribe(e,t);o&&await this._gateway.unsubscribe(o,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&sg(this._users,e),b.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(o){if(o.code===L.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&Ut(t,"id",0,65535,!0),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new Q(L.INVALID_REMOTE_USER,"user is not in the channel");throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let i;if(typeof t=="number"){const s=e._dataChannels.find(o=>o.id===t);s&&(i=[s])}else i=e._dataChannels;if(i===void 0){const s=new Q(L.REMOTE_USER_IS_NOT_PUBLISHED);throw b.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}b.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(e,i);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),b.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===L.DISCONNECT_P2P)return void b.warning("disconnecting p2p, abort unsubscribe request.");throw b.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(ka(e,"unsubscribeList"),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");b.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:s}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:s}=e[n];if(!i){const d=new Q(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw b.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(Wn(s,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===i)){b.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const c=Yn.Video|Yn.LwoVideo;if(t.has(i)){const d=t.get(i);let p;switch(s){case"video":p=d&c;break;case"audio":p=d&Yn.Audio;break;default:p=d&(Yn.Audio|c)}if(p){b.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?s==="audio"?t.set(i,d|Yn.Audio):s==="video"&&t.set(i,d|c):t.set(i,d|Yn.Audio|c)}else s?s==="audio"?t.set(i,Yn.Audio):s==="video"&&t.set(i,c):t.set(i,Yn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),b.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:s,mediaType:o}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(o,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void b.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw b.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new re(L.INVALID_PARAMS);pn(n.width)||eR(n.width,"streamParameter.width"),pn(n.height)||eR(n.height,"streamParameter.height"),pn(n.framerate)||eR(n.framerate,"streamParameter.framerate"),pn(n.bitrate)||Ut(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&b.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),b.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,le.LocalVideoLowTrack)}async enableDualStream(){if(!gt().supportDualStream)throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Q(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Q(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),b.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(le.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),b.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Wn(i,"role",["audience","host"])}(e),t&&sR(t),this.mode==="rtc"||this.mode==="p2p")throw b.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Q(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Q(L.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Q(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&V("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",pi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),b.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&sR(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{b.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(ai(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,xe.setProxyServer(this._proxyServer),b.setProxyServer(this._proxyServer),b.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy")}if(of(e))return this._turnServer={servers:e,mode:"original-manual"},void b.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>m1(n)),this._turnServer={servers:e,mode:"manual"},b.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"you should set license before join channel");if(ai(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Q(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,b.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Q(L.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Q(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Q(L.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Q(L.INVALID_OPERATION,"Stop proxy server after leave channel");xe.setProxyServer(),b.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",b.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Q(L.INVALID_PARAMS,"accessPoints is required.");ka(e.accessPoints.serverList,"accessPoints.serverList"),ai(e.accessPoints.domain,"accessPoints.domain");const t=(v,y)=>{Ut(v,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(xt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),xt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,o=e.accessPoints.serverList.map(v=>i.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(s):v),c=o.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,xt("WEBCS_DOMAIN",c),xt("WEBCS_DOMAIN_BACKUP_LIST",c),xt("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ka(e.report.hostname,"report.hostname"),xt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(xt("EVENT_REPORT_DOMAIN",o[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let d=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),d=e.report.port),xt("STATS_COLLECTOR_PORT",d),e.report?xt("ENABLE_EVENT_REPORT",!0):xt("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ka(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=o[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),xt("LOG_UPLOAD_SERVER","".concat(p,":").concat(f));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ka(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=o;let g=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),g=e.cds.port),xt("CDS_AP",m.map(v=>"".concat(v,":").concat(g))),e.cds?xt("ENABLE_CONFIG_DISTRIBUTE",!0):xt("ENABLE_CONFIG_DISTRIBUTE",!1),b.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ka(e,"serverList"),ai(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,xt("WEBCS_DOMAIN",e),xt("WEBCS_DOMAIN_BACKUP_LIST",e),xt("GATEWAY_DOMAINS",[t]),xt("EVENT_REPORT_DOMAIN",e[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),xt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),b.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Wn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw b.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else b.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Wn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw b.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Wn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw b.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}b.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(o){Wn(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ai(t,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(ve(s).call(s,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Q(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Q(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(xa(i,"encryptDataStream"),!ve(s).call(s,e))throw new Q(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||b.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=xc(n))}async renewToken(e){if(ai(e,"token",1,2047),!this._key||!this._joinInfo)throw new Q(L.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){b.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await kK(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jn);b.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else b.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});b.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,b.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?b.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(at.VOLUME_INDICATOR,e)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Q(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Q(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Q(L.LIVE_STREAMING_TASK_CONFLICT);const n=t?ja.TRANSCODE:ja.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(ja.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new Q(L.INVALID_PARAMS,"can not find live streaming url to stop");await Te.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){qk(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){qk(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Rf&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const s=new TextEncoder;e.payload=s.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(s,o,c){var d;const p=ks(d=Array.from(c)).call(d,(A,I)=>A+I,0),f={serverTs:0,seq:t7++,length:c.length,checkSum:p},m=new Uint8Array(b1(p,2)),g=new ArrayBuffer(10),v=new DataView(g);v.setUint32(0,f.serverTs),v.setUint16(4,f.seq),v.setUint16(6,f.length),v.setUint16(8,f.checkSum);const y=16-c.length%16;c=g1(c,new Uint8Array(y));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:128,additionalData:m},o,c);return g1(new Uint8Array(g),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Q(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ze.DATA_STREAM,{payload:xc(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-KK},!n)}sendMetadata(e){if(!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Q(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ze.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:xc(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(d7),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not send custom report, not joined");await xe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Wn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Wn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw b.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(xa(t,"apRTM"),Ut(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,b.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(b.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Xu.indexOf(e);t!==-1&&Xu.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Zi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&bM(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&xe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new vi("client-publish",this._clientId),this._subscribeMutex=new vi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||Fl();e?b.debug("[".concat(this._clientId,"] new Session ").concat(i)):b.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const s=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,xe.addSid(i);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};xe.sessionInit(this._sessionId,Fr({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new Q(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");b.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Rn.PUBLISH,i,!0)}catch(s){throw n.throw(s),s}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==L.DISCONNECT_P2P)throw n.throw(o),o}await n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of e)s instanceof tn&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig).catch(o=>{b.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Q(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));b.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==L.DISCONNECT_P2P)throw n.throw(o),o}n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Q(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Fc("LiveStreaming").create(i));var i;return n.onLiveStreamError=(s,o)=>{xe.reportApiInvoke(this._sessionId,{name:Mn.ON_LIVE_STREAM_ERROR,options:[s,o],tag:fn.TRACER}).onSuccess(),this.safeEmit(at.LIVE_STREAMING_ERROR,s,o)},n.onLiveStreamWarning=(s,o)=>{xe.reportApiInvoke(this._sessionId,{name:Mn.ON_LIVE_STREAM_WARNING,options:[s,o],tag:fn.TRACER}).onSuccess(),this.safeEmit(at.LIVE_STREAMING_WARNING,s,o)},n.on(YR.REQUEST_WORKER_MANAGER_LIST,(s,o,c)=>{if(!this._joinInfo)return c(new Q(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(d,p,f,m){const g=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(v=>p.proxyServer?"https://".concat(p.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await OK(g,d,p,f,m)})(s,this._joinInfo,this._axiosCancelSource.token,jn).then(o).catch(c)}),n};return e===ja.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Q(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Fc("ChannelMediaRelay").create(e));i.on("state",s=>{s===ds.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(at.CHANNEL_MEDIA_RELAY_STATE,s)}),i.on("event",s=>{this.safeEmit(at.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(s,o)=>{var c;s==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,s=[];if(t){const o=[];this._users.forEach(c=>{c._dataChannels.forEach(d=>{n.every(p=>p.uid!==c._uintid||p.stream_id!==d.id)&&o.push({uid:c._uintid,stream_id:d.id,ordered:d.ordered,max_retrans_times:d.maxRetransmits,metadata:d.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:c,stream_id:d,ordered:p,max_retrans_times:f,metadata:m}=o,g=this._users.find(v=>v._uintid===c);if(!g)return void b.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(b.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),ve(s).call(s,g)||s.push(g),g._uintid||(g._uintid=c),g._dataChannels.findIndex(v=>v.id===o.stream_id)===-1){const v={id:d,ordered:!!p,maxRetransmits:f,metadata:m},y=function(D){return Dk(D,!0)}(v);g._dataChannels.push(y),b.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),t||this.safeEmit(at.USER_PUBLISHED,g,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(g,o.stream_id)&&(b.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,o.stream_id).catch(v=>{b.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),t&&(this.safeEmit(at.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(o=>{const{uid:c,stream_id:d}=o,p=this._users.find(m=>m._uintid===c);if(!p)return void b.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=p._dataChannels.find(m=>m.id===o.stream_id);f&&(b.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(p,[f]).then(m=>{if(p._dataChannels=p._dataChannels.filter(g=>g!==f),m)return this._gateway.unsubscribeDataChannel(m,p.uid)}),b.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(at.USER_UNPUBLISHED,p,"datachannel",f._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){b.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{b.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(at.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else b.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ei.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void b.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:s,type:o,expires:c}=t[i];c&&c<=n||o||FR()||!Object.prototype.hasOwnProperty.call(dg,i)||(po[i]=s,un[i]=s,b.debug("Update gateway parameters from config distribute",i,s))})}catch(t){b.error("Error update config from local cache",t.message)}})()}),this._gateway.on(ei.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ei.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===wt.FALLBACK)return;const s=()=>{this.safeEmit(at.CONNECTION_STATE_CHANGE,e,t,n)};if(xe.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Mn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:fn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),b.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((c,d)=>{this._gateway.setStreamFallbackOption(d,c).catch(p=>{b.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((c,d)=>{this._gateway.setRemoteVideoStreamType(d,c).catch(p=>{b.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{b.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{b.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{b.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Oe.AUDIO,!1)),c._trust_video_mute_state_||(b.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Oe.VIDEO,!1)),c._trust_audio_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(b.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(b.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(b.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}s()}),this._gateway.on(ei.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Q(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await TM(Fr(Fr({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,CM(i),this._joinInfo.preload=!0):(n=await lw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const s=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:c}=o;const[d,p]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:d,port:p}):s.push({host:d,port:p})}),e(s)}catch(n){t(n)}}),this._gateway.on(ei.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(at.NETWORK_QUALITY,e)}),this._gateway.on(ei.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(at.STREAM_TYPE_CHANGED,e,t),xe.reportApiInvoke(this._sessionId,{name:Mn.STREAM_TYPE_CHANGE,options:[e,t],tag:fn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(ei.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ei.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();V("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(ei.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:b.debug("no attributes in joinResponse");const i=vk(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(ei.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:s,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=V("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(lt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(lt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(lt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(lt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(lt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(lt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(lt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(lt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(lt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Oe.AUDIO,!0)),this._gateway.signal.on(lt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Oe.AUDIO,!1)),this._gateway.signal.on(lt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Oe.VIDEO,!0)),this._gateway.signal.on(lt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Oe.VIDEO,!1)),this._gateway.signal.on(lt.RECEIVE_METADATA,e=>{const t=Vl(e.metadata);this.safeEmit(at.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(lt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Vl(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ve(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<10)throw new Q(L.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(10));n=await async function(o,c,d){const p=d.subarray(0,10),f=p.slice(8,10),m=(f[0]<<8)+f[1],g=(p[6]<<8)+p[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:128,additionalData:new Uint8Array(b1(m,2))},c,d.subarray(10));return new Uint8Array(v).subarray(0,g)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const s=this._p2pChannel.getStats(),o=this.remoteUsers.find(d=>d.uid===e.uid),c=s==null?void 0:s.audioRecv.find(d=>d.ssrc===(o==null?void 0:o._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),zK(Fr(Fr({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(lt.ON_CRYPT_ERROR,()=>{Lc(()=>{b.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(at.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(lt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{b.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,wt.TOKEN_EXPIRE),this.safeEmit(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(lt.ON_STREAM_FALLBACK_UPDATE,e=>{b.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(at.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(lt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),b.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(lt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(lt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on($e.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ze.PUBLISH:{if(!t)return;const s=t.ortc;if(s){var n,i;const o=s.some(p=>{let{stream_type:f}=p;return f===Nt.Audio}),c=s.some(p=>{let{stream_type:f}=p;return f!==Nt.Audio}),d=s.some(p=>{let{stream_type:f}=p;return f===Nt.Screen||f===Nt.ScreenLow});t.state==="offer"&&xe.publish(this._joinInfo.sid,{eventElapse:Ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:o,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:d,audioName:o?(n=s.find(p=>{let{stream_type:f}=p;return f===Nt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=s.find(p=>{let{stream_type:f}=p;return f!==Nt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case ze.SUBSCRIBE:t&&xe.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:t.stream_type===Oe.AUDIO,video:t.stream_type===Oe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ti.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(lt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(lt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;V("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!ql(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let s=this._users.find(m=>m._uintid===i.stream_id);s?s._trust_in_room_=!0:(s=new Bc(i.string_id||i.stream_id,i.stream_id),this._users.push(s),this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(b.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(at.USER_JOINED,s)));const o=Yn.Audio&i.stream_type,c=(Yn.Video|Yn.LwoVideo)&i.stream_type,d=!!(65280&i.stream_type),p=o&&s.hasAudio,f=c&&s.hasVideo;c&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=i.video_ssrc,s._rtxSsrcId=i.video_rtx),o&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=i.audio_ssrc),o&&!p&&this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(at.USER_PUBLISHED,s,"audio")),c&&!f&&this.getListeners(at.PUBLISHED_USER_LIST).length===0&&(b.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(at.USER_PUBLISHED,s,"video")),(o&&!p||c&&!f||d)&&t.push(s),c&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(b.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{b.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(at.PUBLISHED_USER_LIST).length>0?V("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(b.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(at.PUBLISHED_USER_LIST,t)):b.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(lt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Rf&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return ve(i=Object.keys(ug)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(lt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Rn.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(s=>{const{kind:o,ssrcs:c,mid:d,isMuted:p}=s;this._handleP2PAddAudioOrVideoStream(o,i,c[0].ssrcId,d);const f=this._users.find(m=>m.uid===i);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,o,c[0].ssrcId,d).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,o,!!p)})}),this._gateway.signal.on(Rn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(s){n(s)}}),this._gateway.signal.on($e.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Rn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:s}=e,o=this._users.find(c=>c.uid===s);if(!o)return b.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{i.forEach(async c=>{let{stream_type:d}=c;const p=d===Nt.Audio?Oe.AUDIO:Oe.VIDEO;await this._p2pChannel.unsubscribe(o,p),this._handleMuteStream(s,p,!0)}),t()}catch(c){n(c)}}}),this._gateway.signal.on(Rn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case jc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Oe.VIDEO,!0);break;case jc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Oe.AUDIO,!0);break;case jc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Oe.VIDEO,!1);break;case jc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Oe.AUDIO,!1)}}),this._gateway.signal.on(Rn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:s}=e;i!==zi.SEND_ONLY||s?t(await this._p2pChannel.restartICE(i,s)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(Rn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Ve.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(Rn.RESTART_ICE,e,i===zi.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Ve.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Rn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ve.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Rn.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Ve.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.StateChange,(e,t)=>{t===At.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ve.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(at.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Ve.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===L.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ve.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ve.RequestRePublishDataChannel,(e,t,n)=>{Te.all(e.map(async i=>{const s=await this._p2pChannel.publishDataChannel([i]);try{s.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==L.DISCONNECT_P2P)throw o}})).then(t).catch(n)}),this._p2pChannel.on(Ve.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:s}of e)s===Oe.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Ve.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Ve.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ve.MediaReconnectStart,e=>{this.safeEmit(at.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ve.MediaReconnectEnd,e=>{this.safeEmit(at.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ve.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ve.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:i})}catch(c){return void t.throw(c)}const{iceParameters:o}=function(c){const d=c.iceParameters;return{iceParameters:{iceUfrag:d.iceUfrag,icePwd:d.icePwd}}}(s);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(Ve.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ve.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),c=vk(s,o);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ve.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ve.P2PLost,()=>{this.safeEmit(at.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ve.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ve.ConnectionTypeChange,e=>{this.safeEmit(at.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ve.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ve.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ve.AudioMetadata,e=>{this.safeEmit(at.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Fc("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:s,sid:o,token:c,uid:d,cid:p,vid:f}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:d,cid:p,vid:f?Number(f):0},jn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(ti.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(at.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Mr.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(at.CONTENT_INSPECT_ERROR,new Q(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ti.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return b.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(at.CONTENT_INSPECT_RESULT,t,n)}),e.on(ti.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(xa(e,"enabled"),e){if(!t)throw new Q(L.INVALID_PARAMS,"config is required");if(VM(t),!this._joinInfo)throw new Q(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Fc("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:s,cname:o,sid:c,token:d,uid:p,cid:f,vid:m}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:o,sid:c,token:d,uid:p,cid:f,vid:m?Number(m):0},jn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new Q(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(_o.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(at.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===lr.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Q(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(_o.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Wn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Q(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,b.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return b.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){xa(e,"enabled"),xt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},De(Ce.prototype,"leave",[FM],Object.getOwnPropertyDescriptor(Ce.prototype,"leave"),Ce.prototype),De(Ce.prototype,"publish",[BM],Object.getOwnPropertyDescriptor(Ce.prototype,"publish"),Ce.prototype),De(Ce.prototype,"unpublish",[GM],Object.getOwnPropertyDescriptor(Ce.prototype,"unpublish"),Ce.prototype),De(Ce.prototype,"subscribe",[HM],Object.getOwnPropertyDescriptor(Ce.prototype,"subscribe"),Ce.prototype),De(Ce.prototype,"presubscribe",[WM],Object.getOwnPropertyDescriptor(Ce.prototype,"presubscribe"),Ce.prototype),De(Ce.prototype,"massSubscribe",[KM],Object.getOwnPropertyDescriptor(Ce.prototype,"massSubscribe"),Ce.prototype),De(Ce.prototype,"unsubscribe",[zM],Object.getOwnPropertyDescriptor(Ce.prototype,"unsubscribe"),Ce.prototype),De(Ce.prototype,"massUnsubscribe",[YM],Object.getOwnPropertyDescriptor(Ce.prototype,"massUnsubscribe"),Ce.prototype),De(Ce.prototype,"setLowStreamParameter",[qM],Object.getOwnPropertyDescriptor(Ce.prototype,"setLowStreamParameter"),Ce.prototype),De(Ce.prototype,"enableDualStream",[$M],Object.getOwnPropertyDescriptor(Ce.prototype,"enableDualStream"),Ce.prototype),De(Ce.prototype,"disableDualStream",[JM],Object.getOwnPropertyDescriptor(Ce.prototype,"disableDualStream"),Ce.prototype),De(Ce.prototype,"setClientRole",[XM],Object.getOwnPropertyDescriptor(Ce.prototype,"setClientRole"),Ce.prototype),De(Ce.prototype,"_setClientRoleOptions",[QM],Object.getOwnPropertyDescriptor(Ce.prototype,"_setClientRoleOptions"),Ce.prototype),De(Ce.prototype,"setProxyServer",[ZM],Object.getOwnPropertyDescriptor(Ce.prototype,"setProxyServer"),Ce.prototype),De(Ce.prototype,"setTurnServer",[ej],Object.getOwnPropertyDescriptor(Ce.prototype,"setTurnServer"),Ce.prototype),De(Ce.prototype,"setLicense",[tj],Object.getOwnPropertyDescriptor(Ce.prototype,"setLicense"),Ce.prototype),De(Ce.prototype,"startProxyServer",[nj],Object.getOwnPropertyDescriptor(Ce.prototype,"startProxyServer"),Ce.prototype),De(Ce.prototype,"stopProxyServer",[ij],Object.getOwnPropertyDescriptor(Ce.prototype,"stopProxyServer"),Ce.prototype),De(Ce.prototype,"setLocalAccessPointsV2",[sj],Object.getOwnPropertyDescriptor(Ce.prototype,"setLocalAccessPointsV2"),Ce.prototype),De(Ce.prototype,"setLocalAccessPoints",[rj],Object.getOwnPropertyDescriptor(Ce.prototype,"setLocalAccessPoints"),Ce.prototype),De(Ce.prototype,"setRemoteDefaultVideoStreamType",[oj],Object.getOwnPropertyDescriptor(Ce.prototype,"setRemoteDefaultVideoStreamType"),Ce.prototype),De(Ce.prototype,"setRemoteVideoStreamType",[aj],Object.getOwnPropertyDescriptor(Ce.prototype,"setRemoteVideoStreamType"),Ce.prototype),De(Ce.prototype,"setStreamFallbackOption",[cj],Object.getOwnPropertyDescriptor(Ce.prototype,"setStreamFallbackOption"),Ce.prototype),De(Ce.prototype,"setEncryptionConfig",[lj],Object.getOwnPropertyDescriptor(Ce.prototype,"setEncryptionConfig"),Ce.prototype),De(Ce.prototype,"renewToken",[dj],Object.getOwnPropertyDescriptor(Ce.prototype,"renewToken"),Ce.prototype),De(Ce.prototype,"enableAudioVolumeIndicator",[uj],Object.getOwnPropertyDescriptor(Ce.prototype,"enableAudioVolumeIndicator"),Ce.prototype),De(Ce.prototype,"startLiveStreaming",[hj],Object.getOwnPropertyDescriptor(Ce.prototype,"startLiveStreaming"),Ce.prototype),De(Ce.prototype,"setLiveTranscoding",[pj],Object.getOwnPropertyDescriptor(Ce.prototype,"setLiveTranscoding"),Ce.prototype),De(Ce.prototype,"stopLiveStreaming",[fj],Object.getOwnPropertyDescriptor(Ce.prototype,"stopLiveStreaming"),Ce.prototype),De(Ce.prototype,"startChannelMediaRelay",[mj],Object.getOwnPropertyDescriptor(Ce.prototype,"startChannelMediaRelay"),Ce.prototype),De(Ce.prototype,"updateChannelMediaRelay",[_j],Object.getOwnPropertyDescriptor(Ce.prototype,"updateChannelMediaRelay"),Ce.prototype),De(Ce.prototype,"stopChannelMediaRelay",[Ej],Object.getOwnPropertyDescriptor(Ce.prototype,"stopChannelMediaRelay"),Ce.prototype),De(Ce.prototype,"sendCustomReportMessage",[gj],Object.getOwnPropertyDescriptor(Ce.prototype,"sendCustomReportMessage"),Ce.prototype),De(Ce.prototype,"pickSVCLayer",[vj],Object.getOwnPropertyDescriptor(Ce.prototype,"pickSVCLayer"),Ce.prototype),De(Ce.prototype,"setRTMConfig",[Sj],Object.getOwnPropertyDescriptor(Ce.prototype,"setRTMConfig"),Ce.prototype),De(Ce.prototype,"enableContentInspect",[Tj],Object.getOwnPropertyDescriptor(Ce.prototype,"enableContentInspect"),Ce.prototype),De(Ce.prototype,"disableContentInspect",[yj],Object.getOwnPropertyDescriptor(Ce.prototype,"disableContentInspect"),Ce.prototype),De(Ce.prototype,"setImageModeration",[bj],Object.getOwnPropertyDescriptor(Ce.prototype,"setImageModeration"),Ce.prototype),De(Ce.prototype,"setP2PTransport",[Cj],Object.getOwnPropertyDescriptor(Ce.prototype,"setP2PTransport"),Ce.prototype),De(Ce.prototype,"getJoinChannelServiceRecords",[Rj],Object.getOwnPropertyDescriptor(Ce.prototype,"getJoinChannelServiceRecords"),Ce.prototype),De(Ce.prototype,"setPublishAudioFilterEnabled",[wj],Object.getOwnPropertyDescriptor(Ce.prototype,"setPublishAudioFilterEnabled"),Ce.prototype),Ce);class If{constructor(t,n){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),If.count+=1,this.id=If.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const o=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(o),i.iceGatheringState==="complete"?i.localDescription:new Te(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(i){throw new Q(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(s){throw new Q(L.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new Q(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){b.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Ij,nv;N(If,"count",0);const az=window.AudioContext||window.webkitAudioContext,cz=new(Ij=He({report:xe}),De((nv=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return b.debug("the system does not need to process local aec"),-1;this.context||(this.context=new az);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new If(e,this.context),this.units.push(t)),t.startEchoCancellation(),b.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Et().name!==bt.SAFARI}}).prototype,"processExternalMediaAEC",[Ij],Object.getOwnPropertyDescriptor(nv.prototype,"processExternalMediaAEC"),nv.prototype),nv);function Oj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Nj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oj(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oj(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Rw=window||document;function Dj(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Rw)return;const n=Un._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=s=>{if(!(s&&s.blockedURI&&(Un.onSecurityPolicyViolation||Un.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0)))return;const o=s.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(c=>ve(o).call(o,c))&&(Un.onSecurityPolicyViolation&&typeof Un.onSecurityPolicyViolation=="function"&&Un.onSecurityPolicyViolation(s),Un.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0&&Un.safeEmit(Yo.SECURITY_POLICY_VIOLATION,s))};n&&Rw.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Un.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0)&&Rw.addEventListener("securitypolicyviolation",i),Un._cspEventHandlerPointer=i}var lz=q,dz=EP,Pj=RegExp.prototype,uz=function(e){return e===Pj||lz(Pj,e)?dz(e):e.flags},ji=E(uz);function hh(e){let t=e.length;for(;--t>=0;)e[t]=0}const ww=256,Lj=286,Of=30,Nf=15,Aw=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),iv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hz=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xj=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ha=new Array(576);hh(Ha);const Df=new Array(60);hh(Df);const Pf=new Array(512);hh(Pf);const Lf=new Array(256);hh(Lf);const Iw=new Array(29);hh(Iw);const sv=new Array(Of);function Ow(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let kj,Mj,jj;function Nw(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}hh(sv);const Uj=e=>e<256?Pf[e]:Pf[256+(e>>>7)],xf=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},$s=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,xf(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Xo=(e,t,n)=>{$s(e,n[2*t],n[2*t+1])},Vj=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},Fj=(e,t,n)=>{const i=new Array(16);let s,o,c=0;for(s=1;s<=Nf;s++)c=c+n[s-1]<<1,i[s]=c;for(o=0;o<=t;o++){let d=e[2*o+1];d!==0&&(e[2*o]=Vj(i[d]++,d))}},Bj=e=>{let t;for(t=0;t<Lj;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Of;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Gj=e=>{e.bi_valid>8?xf(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Hj=(e,t,n,i)=>{const s=2*t,o=2*n;return e[s]<e[o]||e[s]===e[o]&&i[t]<=i[n]},Dw=(e,t,n)=>{const i=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Hj(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!Hj(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i},Wj=(e,t,n)=>{let i,s,o,c,d=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+d++],i+=(255&e.pending_buf[e.sym_buf+d++])<<8,s=e.pending_buf[e.sym_buf+d++],i===0?Xo(e,s,t):(o=Lf[s],Xo(e,o+ww+1,t),c=Aw[o],c!==0&&(s-=Iw[o],$s(e,s,c)),i--,o=Uj(i),Xo(e,o,n),c=iv[o],c!==0&&(i-=sv[o],$s(e,i,c)));while(d<e.sym_next);Xo(e,256,t)},Pw=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let c,d,p,f=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<o;c++)n[2*c]!==0?(e.heap[++e.heap_len]=f=c,e.depth[c]=0):n[2*c+1]=0;for(;e.heap_len<2;)p=e.heap[++e.heap_len]=f<2?++f:0,n[2*p]=1,e.depth[p]=0,e.opt_len--,s&&(e.static_len-=i[2*p+1]);for(t.max_code=f,c=e.heap_len>>1;c>=1;c--)Dw(e,n,c);p=o;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Dw(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=d,n[2*p]=n[2*c]+n[2*d],e.depth[p]=(e.depth[c]>=e.depth[d]?e.depth[c]:e.depth[d])+1,n[2*c+1]=n[2*d+1]=p,e.heap[1]=p++,Dw(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,g)=>{const v=g.dyn_tree,y=g.max_code,D=g.stat_desc.static_tree,A=g.stat_desc.has_stree,I=g.stat_desc.extra_bits,k=g.stat_desc.extra_base,M=g.stat_desc.max_length;let H,J,$,z,oe,de,be=0;for(z=0;z<=Nf;z++)m.bl_count[z]=0;for(v[2*m.heap[m.heap_max]+1]=0,H=m.heap_max+1;H<573;H++)J=m.heap[H],z=v[2*v[2*J+1]+1]+1,z>M&&(z=M,be++),v[2*J+1]=z,J>y||(m.bl_count[z]++,oe=0,J>=k&&(oe=I[J-k]),de=v[2*J],m.opt_len+=de*(z+oe),A&&(m.static_len+=de*(D[2*J+1]+oe)));if(be!==0){do{for(z=M-1;m.bl_count[z]===0;)z--;m.bl_count[z]--,m.bl_count[z+1]+=2,m.bl_count[M]--,be-=2}while(be>0);for(z=M;z!==0;z--)for(J=m.bl_count[z];J!==0;)$=m.heap[--H],$>y||(v[2*$+1]!==z&&(m.opt_len+=(z-v[2*$+1])*v[2*$],v[2*$+1]=z),J--)}})(e,t),Fj(n,f,e.bl_count)},Kj=(e,t,n)=>{let i,s,o=-1,c=t[1],d=0,p=7,f=4;for(c===0&&(p=138,f=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=c,c=t[2*(i+1)+1],++d<p&&s===c||(d<f?e.bl_tree[2*s]+=d:s!==0?(s!==o&&e.bl_tree[2*s]++,e.bl_tree[32]++):d<=10?e.bl_tree[34]++:e.bl_tree[36]++,d=0,o=s,c===0?(p=138,f=3):s===c?(p=6,f=3):(p=7,f=4))},zj=(e,t,n)=>{let i,s,o=-1,c=t[1],d=0,p=7,f=4;for(c===0&&(p=138,f=3),i=0;i<=n;i++)if(s=c,c=t[2*(i+1)+1],!(++d<p&&s===c)){if(d<f)do Xo(e,s,e.bl_tree);while(--d!=0);else s!==0?(s!==o&&(Xo(e,s,e.bl_tree),d--),Xo(e,16,e.bl_tree),$s(e,d-3,2)):d<=10?(Xo(e,17,e.bl_tree),$s(e,d-3,3)):(Xo(e,18,e.bl_tree),$s(e,d-11,7));d=0,o=s,c===0?(p=138,f=3):s===c?(p=6,f=3):(p=7,f=4)}};let Yj=!1;const qj=(e,t,n,i)=>{$s(e,0+(i?1:0),3),Gj(e),xf(e,n),xf(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var pz=e=>{Yj||((()=>{let t,n,i,s,o;const c=new Array(16);for(i=0,s=0;s<28;s++)for(Iw[s]=i,t=0;t<1<<Aw[s];t++)Lf[i++]=s;for(Lf[i-1]=s,o=0,s=0;s<16;s++)for(sv[s]=o,t=0;t<1<<iv[s];t++)Pf[o++]=s;for(o>>=7;s<Of;s++)for(sv[s]=o<<7,t=0;t<1<<iv[s]-7;t++)Pf[256+o++]=s;for(n=0;n<=Nf;n++)c[n]=0;for(t=0;t<=143;)Ha[2*t+1]=8,t++,c[8]++;for(;t<=255;)Ha[2*t+1]=9,t++,c[9]++;for(;t<=279;)Ha[2*t+1]=7,t++,c[7]++;for(;t<=287;)Ha[2*t+1]=8,t++,c[8]++;for(Fj(Ha,287,c),t=0;t<Of;t++)Df[2*t+1]=5,Df[2*t]=Vj(t,5);kj=new Ow(Ha,Aw,257,Lj,Nf),Mj=new Ow(Df,iv,0,Of,Nf),jj=new Ow(new Array(0),hz,0,19,7)})(),Yj=!0),e.l_desc=new Nw(e.dyn_ltree,kj),e.d_desc=new Nw(e.dyn_dtree,Mj),e.bl_desc=new Nw(e.bl_tree,jj),e.bi_buf=0,e.bi_valid=0,Bj(e)},fz=(e,t,n,i)=>{let s,o,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(d=>{let p,f=4093624447;for(p=0;p<=31;p++,f>>>=1)if(1&f&&d.dyn_ltree[2*p]!==0)return 0;if(d.dyn_ltree[18]!==0||d.dyn_ltree[20]!==0||d.dyn_ltree[26]!==0)return 1;for(p=32;p<ww;p++)if(d.dyn_ltree[2*p]!==0)return 1;return 0})(e)),Pw(e,e.l_desc),Pw(e,e.d_desc),c=(d=>{let p;for(Kj(d,d.dyn_ltree,d.l_desc.max_code),Kj(d,d.dyn_dtree,d.d_desc.max_code),Pw(d,d.bl_desc),p=18;p>=3&&d.bl_tree[2*xj[p]+1]===0;p--);return d.opt_len+=3*(p+1)+5+5+4,p})(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=n+5,n+4<=s&&t!==-1?qj(e,t,n,i):e.strategy===4||o===s?($s(e,2+(i?1:0),3),Wj(e,Ha,Df)):($s(e,4+(i?1:0),3),((d,p,f,m)=>{let g;for($s(d,p-257,5),$s(d,f-1,5),$s(d,m-4,4),g=0;g<m;g++)$s(d,d.bl_tree[2*xj[g]+1],3);zj(d,d.dyn_ltree,p-1),zj(d,d.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),Wj(e,e.dyn_ltree,e.dyn_dtree)),Bj(e),i&&Gj(e)},mz=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Lf[n]+ww+1)]++,e.dyn_dtree[2*Uj(t)]++),e.sym_next===e.sym_end),_z=e=>{$s(e,2,3),Xo(e,256,Ha),(t=>{t.bi_valid===16?(xf(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Ez={_tr_init:pz,_tr_stored_block:qj,_tr_flush_block:fz,_tr_tally:mz,_tr_align:_z},kf=(e,t,n,i)=>{let s=65535&e,o=e>>>16&65535,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do s=s+t[i++]|0,o=o+s|0;while(--c);s%=65521,o%=65521}return s|o<<16};const gz=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var qi=(e,t,n,i)=>{const s=gz,o=i+n;e^=-1;for(let c=i;c<o;c++)e=e>>>8^s[255&(e^t[c])];return~e},nd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ph={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vz,_tr_stored_block:Lw,_tr_flush_block:Sz,_tr_tally:Kc,_tr_align:Tz}=Ez,{Z_NO_FLUSH:zc,Z_PARTIAL_FLUSH:yz,Z_FULL_FLUSH:bz,Z_FINISH:Br,Z_BLOCK:$j,Z_OK:is,Z_STREAM_END:Jj,Z_STREAM_ERROR:Qo,Z_DATA_ERROR:Cz,Z_BUF_ERROR:xw,Z_DEFAULT_COMPRESSION:Rz,Z_FILTERED:wz,Z_HUFFMAN_ONLY:rv,Z_RLE:Az,Z_FIXED:Iz,Z_DEFAULT_STRATEGY:Oz,Z_UNKNOWN:Nz,Z_DEFLATED:ov}=ph,id=258,Zo=262,fh=42,sd=113,Mf=666,rd=(e,t)=>(e.msg=nd[t],t),Xj=e=>2*e-(e>4?9:0),Yc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Dz=e=>{let t,n,i,s=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=s?n-s:0;while(--t);t=s,i=t;do n=e.prev[--i],e.prev[i]=n>=s?n-s:0;while(--t)};let qc=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ur=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},hr=(e,t)=>{Sz(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ur(e.strm)},Tn=(e,t)=>{e.pending_buf[e.pending++]=t},jf=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},kw=(e,t,n,i)=>{let s=e.avail_in;return s>i&&(s=i),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=kf(e.adler,t,s,n):e.state.wrap===2&&(e.adler=qi(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},Qj=(e,t)=>{let n,i,s=e.max_chain_length,o=e.strstart,c=e.prev_length,d=e.nice_match;const p=e.strstart>e.w_size-Zo?e.strstart-(e.w_size-Zo):0,f=e.window,m=e.w_mask,g=e.prev,v=e.strstart+id;let y=f[o+c-1],D=f[o+c];e.prev_length>=e.good_match&&(s>>=2),d>e.lookahead&&(d=e.lookahead);do if(n=t,f[n+c]===D&&f[n+c-1]===y&&f[n]===f[o]&&f[++n]===f[o+1]){o+=2,n++;do;while(f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&f[++o]===f[++n]&&o<v);if(i=id-(v-o),o=v-id,i>c){if(e.match_start=t,c=i,i>=d)break;y=f[o+c-1],D=f[o+c]}}while((t=g[t&m])>p&&--s!=0);return c<=e.lookahead?c:e.lookahead},mh=e=>{const t=e.w_size;let n,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Zo)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Dz(e),i+=t),e.strm.avail_in===0)break;if(n=kw(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=qc(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=qc(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Zo&&e.strm.avail_in!==0)},Zj=(e,t)=>{let n,i,s,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,d=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>s&&(n=s),n<o&&(n===0&&t!==Br||t===zc||n!==i+e.strm.avail_in)))break;c=t===Br&&n===i+e.strm.avail_in?1:0,Lw(e,0,0,c),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ur(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(kw(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(c===0);return d-=e.strm.avail_in,d&&(d>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=d&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-d,e.strm.next_in),e.strstart),e.strstart+=d,e.insert+=d>e.w_size-e.insert?e.w_size-e.insert:d),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==zc&&t!==Br&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(kw(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,o=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=o||(i||t===Br)&&t!==zc&&e.strm.avail_in===0&&i<=s)&&(n=i>s?s:i,c=t===Br&&e.strm.avail_in===0&&n===i?1:0,Lw(e,e.block_start,n,c),e.block_start+=n,ur(e.strm)),c?3:1)},Mw=(e,t)=>{let n,i;for(;;){if(e.lookahead<Zo){if(mh(e),e.lookahead<Zo&&t===zc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Zo&&(e.match_length=Qj(e,n)),e.match_length>=3)if(i=Kc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=qc(e,e.ins_h,e.window[e.strstart+1]);else i=Kc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(hr(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Br?(hr(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(hr(e,!1),e.strm.avail_out===0)?1:2},_h=(e,t)=>{let n,i,s;for(;;){if(e.lookahead<Zo){if(mh(e),e.lookahead<Zo&&t===zc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Zo&&(e.match_length=Qj(e,n),e.match_length<=5&&(e.strategy===wz||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=Kc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=qc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(hr(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=Kc(e,0,e.window[e.strstart-1]),i&&hr(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Kc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Br?(hr(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(hr(e,!1),e.strm.avail_out===0)?1:2};function ea(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}const Uf=[new ea(0,0,0,0,Zj),new ea(4,4,8,4,Mw),new ea(4,5,16,8,Mw),new ea(4,6,32,32,Mw),new ea(4,4,16,16,_h),new ea(8,16,32,32,_h),new ea(8,16,128,128,_h),new ea(8,32,128,256,_h),new ea(32,128,258,1024,_h),new ea(32,258,258,4096,_h)];function Pz(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ov,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Yc(this.dyn_ltree),Yc(this.dyn_dtree),Yc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Yc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Yc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Vf=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==fh&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==sd&&t.status!==Mf?1:0},eU=e=>{if(Vf(e))return rd(e,Qo);e.total_in=e.total_out=0,e.data_type=Nz;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?fh:sd,e.adler=t.wrap===2?0:1,t.last_flush=-2,vz(t),is},tU=e=>{const t=eU(e);return t===is&&(n=>{n.window_size=2*n.w_size,Yc(n.head),n.max_lazy_match=Uf[n.level].max_lazy,n.good_match=Uf[n.level].good_length,n.nice_match=Uf[n.level].nice_length,n.max_chain_length=Uf[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},nU=(e,t,n,i,s,o)=>{if(!e)return Qo;let c=1;if(t===Rz&&(t=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),s<1||s>9||n!==ov||i<8||i>15||t<0||t>9||o<0||o>Iz||i===8&&c!==1)return rd(e,Qo);i===8&&(i=9);const d=new Pz;return e.state=d,d.strm=e,d.status=fh,d.wrap=c,d.gzhead=null,d.w_bits=i,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=s+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<s+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=3*(d.lit_bufsize-1),d.level=t,d.strategy=o,d.method=n,tU(e)};var Lz=(e,t)=>{if(Vf(e)||t>$j||t<0)return e?rd(e,Qo):Qo;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Mf&&t!==Br)return rd(e,e.avail_out===0?xw:Qo);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ur(e),e.avail_out===0)return n.last_flush=-1,is}else if(e.avail_in===0&&Xj(t)<=Xj(i)&&t!==Br)return rd(e,xw);if(n.status===Mf&&e.avail_in!==0)return rd(e,xw);if(n.status===fh&&n.wrap===0&&(n.status=sd),n.status===fh){let s=ov+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=rv||n.level<2?0:n.level<6?1:n.level===6?2:3,s|=o<<6,n.strstart!==0&&(s|=32),s+=31-s%31,jf(n,s),n.strstart!==0&&(jf(n,e.adler>>>16),jf(n,65535&e.adler)),e.adler=1,n.status=sd,ur(e),n.pending!==0)return n.last_flush=-1,is}if(n.status===57){if(e.adler=0,Tn(n,31),Tn(n,139),Tn(n,8),n.gzhead)Tn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Tn(n,255&n.gzhead.time),Tn(n,n.gzhead.time>>8&255),Tn(n,n.gzhead.time>>16&255),Tn(n,n.gzhead.time>>24&255),Tn(n,n.level===9?2:n.strategy>=rv||n.level<2?4:0),Tn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Tn(n,255&n.gzhead.extra.length),Tn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=qi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Tn(n,0),Tn(n,0),Tn(n,0),Tn(n,0),Tn(n,0),Tn(n,n.level===9?2:n.strategy>=rv||n.level<2?4:0),Tn(n,3),n.status=sd,ur(e),n.pending!==0)return n.last_flush=-1,is}if(n.status===69){if(n.gzhead.extra){let s=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let d=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=qi(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=d,ur(e),n.pending!==0)return n.last_flush=-1,is;s=0,o-=d}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>s&&(e.adler=qi(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let s,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=qi(e.adler,n.pending_buf,n.pending-o,o)),ur(e),n.pending!==0)return n.last_flush=-1,is;o=0}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Tn(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>o&&(e.adler=qi(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let s,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=qi(e.adler,n.pending_buf,n.pending-o,o)),ur(e),n.pending!==0)return n.last_flush=-1,is;o=0}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Tn(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>o&&(e.adler=qi(e.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ur(e),n.pending!==0))return n.last_flush=-1,is;Tn(n,255&e.adler),Tn(n,e.adler>>8&255),e.adler=0}if(n.status=sd,ur(e),n.pending!==0)return n.last_flush=-1,is}if(e.avail_in!==0||n.lookahead!==0||t!==zc&&n.status!==Mf){let s=n.level===0?Zj(n,t):n.strategy===rv?((o,c)=>{let d;for(;;){if(o.lookahead===0&&(mh(o),o.lookahead===0)){if(c===zc)return 1;break}if(o.match_length=0,d=Kc(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,d&&(hr(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===Br?(hr(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(hr(o,!1),o.strm.avail_out===0)?1:2})(n,t):n.strategy===Az?((o,c)=>{let d,p,f,m;const g=o.window;for(;;){if(o.lookahead<=id){if(mh(o),o.lookahead<=id&&c===zc)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(f=o.strstart-1,p=g[f],p===g[++f]&&p===g[++f]&&p===g[++f])){m=o.strstart+id;do;while(p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&f<m);o.match_length=id-(m-f),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(d=Kc(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(d=Kc(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),d&&(hr(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===Br?(hr(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(hr(o,!1),o.strm.avail_out===0)?1:2})(n,t):Uf[n.level].func(n,t);if(s!==3&&s!==4||(n.status=Mf),s===1||s===3)return e.avail_out===0&&(n.last_flush=-1),is;if(s===2&&(t===yz?Tz(n):t!==$j&&(Lw(n,0,0,!1),t===bz&&(Yc(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ur(e),e.avail_out===0))return n.last_flush=-1,is}return t!==Br?is:n.wrap<=0?Jj:(n.wrap===2?(Tn(n,255&e.adler),Tn(n,e.adler>>8&255),Tn(n,e.adler>>16&255),Tn(n,e.adler>>24&255),Tn(n,255&e.total_in),Tn(n,e.total_in>>8&255),Tn(n,e.total_in>>16&255),Tn(n,e.total_in>>24&255)):(jf(n,e.adler>>>16),jf(n,65535&e.adler)),ur(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?is:Jj)},xz=(e,t)=>{let n=t.length;if(Vf(e))return Qo;const i=e.state,s=i.wrap;if(s===2||s===1&&i.status!==fh||i.lookahead)return Qo;if(s===1&&(e.adler=kf(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){s===0&&(Yc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let p=new Uint8Array(i.w_size);p.set(t.subarray(n-i.w_size,n),0),t=p,n=i.w_size}const o=e.avail_in,c=e.next_in,d=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,mh(i);i.lookahead>=3;){let p=i.strstart,f=i.lookahead-2;do i.ins_h=qc(i,i.ins_h,i.window[p+3-1]),i.prev[p&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=p,p++;while(--f);i.strstart=p,i.lookahead=2,mh(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=c,e.input=d,e.avail_in=o,i.wrap=s,is},Ff={deflateInit:(e,t)=>nU(e,t,ov,15,8,Oz),deflateInit2:nU,deflateReset:tU,deflateResetKeep:eU,deflateSetHeader:(e,t)=>Vf(e)||e.state.wrap!==2?Qo:(e.state.gzhead=t,is),deflate:Lz,deflateEnd:e=>{if(Vf(e))return Qo;const t=e.state.status;return e.state=null,t===sd?rd(e,Cz):is},deflateSetDictionary:xz,deflateInfo:"pako deflate (from Nodeca project)"};const kz=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var iU=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)kz(n,i)&&(e[i]=n[i])}}return e},sU=e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,s=0,o=e.length;i<o;i++){let c=e[i];n.set(c,s),s+=c.length}return n};let rU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{rU=!1}const Bf=new Uint8Array(256);for(let e=0;e<256;e++)Bf[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Bf[254]=Bf[254]=1;var jw=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,s,o,c=e.length,d=0;for(s=0;s<c;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<c&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),d+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(d),o=0,s=0;o<d;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<c&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},Mz=(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,s;const o=new Array(2*n);for(s=0,i=0;i<n;){let c=e[i++];if(c<128){o[s++]=c;continue}let d=Bf[c];if(d>4)o[s++]=65533,i+=d-1;else{for(c&=d===2?31:d===3?15:7;d>1&&i<n;)c=c<<6|63&e[i++],d--;d>1?o[s++]=65533:c<65536?o[s++]=c:(c-=65536,o[s++]=55296|c>>10&1023,o[s++]=56320|1023&c)}}return((c,d)=>{if(d<65534&&c.subarray&&rU)return String.fromCharCode.apply(null,c.length===d?c:c.subarray(0,d));let p="";for(let f=0;f<d;f++)p+=String.fromCharCode(c[f]);return p})(o,s)},jz=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+Bf[e[n]]>t?n:t},oU=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const aU=Object.prototype.toString,{Z_NO_FLUSH:Uz,Z_SYNC_FLUSH:Vz,Z_FULL_FLUSH:Fz,Z_FINISH:Bz,Z_OK:av,Z_STREAM_END:Gz,Z_DEFAULT_COMPRESSION:Hz,Z_DEFAULT_STRATEGY:Wz,Z_DEFLATED:Kz}=ph;function Gf(e){this.options=iU({level:Hz,method:Kz,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wz},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oU,this.strm.avail_out=0;let n=Ff.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==av)throw new Error(nd[n]);if(t.header&&Ff.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?jw(t.dictionary):aU.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Ff.deflateSetDictionary(this.strm,i),n!==av)throw new Error(nd[n]);this._dict_set=!0}}function Uw(e,t){const n=new Gf(t);if(n.push(e,!0),n.err)throw n.msg||nd[n.err];return n.result}Gf.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let s,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?Bz:Uz,typeof e=="string"?n.input=jw(e):aU.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(o===Vz||o===Fz)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=Ff.deflate(n,o),s===Gz)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=Ff.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===av;if(n.avail_out!==0){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Gf.prototype.onData=function(e){this.chunks.push(e)},Gf.prototype.onEnd=function(e){e===av&&(this.result=sU(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var zz={Deflate:Gf,deflate:Uw,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Uw(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Uw(e,t)},constants:ph};const cv=16209;var Yz=function(e,t){let n,i,s,o,c,d,p,f,m,g,v,y,D,A,I,k,M,H,J,$,z,oe,de,be;const Re=e.state;n=e.next_in,de=e.input,i=n+(e.avail_in-5),s=e.next_out,be=e.output,o=s-(t-e.avail_out),c=s+(e.avail_out-257),d=Re.dmax,p=Re.wsize,f=Re.whave,m=Re.wnext,g=Re.window,v=Re.hold,y=Re.bits,D=Re.lencode,A=Re.distcode,I=(1<<Re.lenbits)-1,k=(1<<Re.distbits)-1;e:do{y<15&&(v+=de[n++]<<y,y+=8,v+=de[n++]<<y,y+=8),M=D[v&I];t:for(;;){if(H=M>>>24,v>>>=H,y-=H,H=M>>>16&255,H===0)be[s++]=65535&M;else{if(!(16&H)){if(64&H){if(32&H){Re.mode=16191;break e}e.msg="invalid literal/length code",Re.mode=cv;break e}M=D[(65535&M)+(v&(1<<H)-1)];continue t}for(J=65535&M,H&=15,H&&(y<H&&(v+=de[n++]<<y,y+=8),J+=v&(1<<H)-1,v>>>=H,y-=H),y<15&&(v+=de[n++]<<y,y+=8,v+=de[n++]<<y,y+=8),M=A[v&k];;){if(H=M>>>24,v>>>=H,y-=H,H=M>>>16&255,16&H){if($=65535&M,H&=15,y<H&&(v+=de[n++]<<y,y+=8,y<H&&(v+=de[n++]<<y,y+=8)),$+=v&(1<<H)-1,$>d){e.msg="invalid distance too far back",Re.mode=cv;break e}if(v>>>=H,y-=H,H=s-o,$>H){if(H=$-H,H>f&&Re.sane){e.msg="invalid distance too far back",Re.mode=cv;break e}if(z=0,oe=g,m===0){if(z+=p-H,H<J){J-=H;do be[s++]=g[z++];while(--H);z=s-$,oe=be}}else if(m<H){if(z+=p+m-H,H-=m,H<J){J-=H;do be[s++]=g[z++];while(--H);if(z=0,m<J){H=m,J-=H;do be[s++]=g[z++];while(--H);z=s-$,oe=be}}}else if(z+=m-H,H<J){J-=H;do be[s++]=g[z++];while(--H);z=s-$,oe=be}for(;J>2;)be[s++]=oe[z++],be[s++]=oe[z++],be[s++]=oe[z++],J-=3;J&&(be[s++]=oe[z++],J>1&&(be[s++]=oe[z++]))}else{z=s-$;do be[s++]=be[z++],be[s++]=be[z++],be[s++]=be[z++],J-=3;while(J>2);J&&(be[s++]=be[z++],J>1&&(be[s++]=be[z++]))}break}if(64&H){e.msg="invalid distance code",Re.mode=cv;break e}M=A[(65535&M)+(v&(1<<H)-1)]}}break}}while(n<i&&s<c);J=y>>3,n-=J,y-=J<<3,v&=(1<<y)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<c?c-s+257:257-(s-c),Re.hold=v,Re.bits=y};const lv=15,qz=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Jz=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xz=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Hf=(e,t,n,i,s,o,c,d)=>{const p=d.bits;let f,m,g,v,y,D,A=0,I=0,k=0,M=0,H=0,J=0,$=0,z=0,oe=0,de=0,be=null;const Re=new Uint16Array(16),dt=new Uint16Array(16);let ut,$t,wn,vn=null;for(A=0;A<=lv;A++)Re[A]=0;for(I=0;I<i;I++)Re[t[n+I]]++;for(H=p,M=lv;M>=1&&Re[M]===0;M--);if(H>M&&(H=M),M===0)return s[o++]=20971520,s[o++]=20971520,d.bits=1,0;for(k=1;k<M&&Re[k]===0;k++);for(H<k&&(H=k),z=1,A=1;A<=lv;A++)if(z<<=1,z-=Re[A],z<0)return-1;if(z>0&&(e===0||M!==1))return-1;for(dt[1]=0,A=1;A<lv;A++)dt[A+1]=dt[A]+Re[A];for(I=0;I<i;I++)t[n+I]!==0&&(c[dt[t[n+I]]++]=I);if(e===0?(be=vn=c,D=20):e===1?(be=qz,vn=$z,D=257):(be=Jz,vn=Xz,D=0),de=0,I=0,A=k,y=o,J=H,$=0,g=-1,oe=1<<H,v=oe-1,e===1&&oe>852||e===2&&oe>592)return 1;for(;;){ut=A-$,c[I]+1<D?($t=0,wn=c[I]):c[I]>=D?($t=vn[c[I]-D],wn=be[c[I]-D]):($t=96,wn=0),f=1<<A-$,m=1<<J,k=m;do m-=f,s[y+(de>>$)+m]=ut<<24|$t<<16|wn;while(m!==0);for(f=1<<A-1;de&f;)f>>=1;if(f!==0?(de&=f-1,de+=f):de=0,I++,--Re[A]==0){if(A===M)break;A=t[n+c[I]]}if(A>H&&(de&v)!==g){for($===0&&($=H),y+=k,J=A-$,z=1<<J;J+$<M&&(z-=Re[J+$],!(z<=0));)J++,z<<=1;if(oe+=1<<J,e===1&&oe>852||e===2&&oe>592)return 1;g=de&v,s[g]=H<<24|J<<16|y-o}}return de!==0&&(s[y+de]=A-$<<24|64<<16),d.bits=H,0};const{Z_FINISH:cU,Z_BLOCK:Qz,Z_TREES:dv,Z_OK:od,Z_STREAM_END:Zz,Z_NEED_DICT:eY,Z_STREAM_ERROR:Gr,Z_DATA_ERROR:lU,Z_MEM_ERROR:dU,Z_BUF_ERROR:tY,Z_DEFLATED:uU}=ph,uv=16180,hv=16190,Wa=16191,Vw=16192,Fw=16194,pv=16199,fv=16200,Bw=16206,ni=16209,hU=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function nY(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ad=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<uv||t.mode>16211?1:0},pU=e=>{if(ad(e))return Gr;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=uv,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,od},fU=e=>{if(ad(e))return Gr;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,pU(e)},mU=(e,t)=>{let n;if(ad(e))return Gr;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Gr:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,fU(e))},_U=(e,t)=>{if(!e)return Gr;const n=new nY;e.state=n,n.strm=e,n.window=null,n.mode=uv;const i=mU(e,t);return i!==od&&(e.state=null),i};let Gw,Hw,EU=!0;const iY=e=>{if(EU){Gw=new Int32Array(512),Hw=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Hf(1,e.lens,0,288,Gw,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Hf(2,e.lens,0,32,Hw,0,e.work,{bits:5}),EU=!1}e.lencode=Gw,e.lenbits=9,e.distcode=Hw,e.distbits=5},gU=(e,t,n,i)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),o.window.set(t.subarray(n-i,n-i+s),o.wnext),(i-=s)?(o.window.set(t.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0};var sY=(e,t)=>{let n,i,s,o,c,d,p,f,m,g,v,y,D,A,I,k,M,H,J,$,z,oe,de=0;const be=new Uint8Array(4);let Re,dt;const ut=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ad(e)||!e.output||!e.input&&e.avail_in!==0)return Gr;n=e.state,n.mode===Wa&&(n.mode=Vw),c=e.next_out,s=e.output,p=e.avail_out,o=e.next_in,i=e.input,d=e.avail_in,f=n.hold,m=n.bits,g=d,v=p,oe=od;e:for(;;)switch(n.mode){case uv:if(n.wrap===0){n.mode=Vw;break}for(;m<16;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(2&n.wrap&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,be[0]=255&f,be[1]=f>>>8&255,n.check=qi(n.check,be,2,0),f=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=ni;break}if((15&f)!==uU){e.msg="unknown compression method",n.mode=ni;break}if(f>>>=4,m-=4,z=8+(15&f),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=ni;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&f?16189:Wa,f=0,m=0;break;case 16181:for(;m<16;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(n.flags=f,(255&ji(n))!==uU){e.msg="unknown compression method",n.mode=ni;break}if(57344&ji(n)){e.msg="unknown header flags set",n.mode=ni;break}n.head&&(n.head.text=f>>8&1),512&ji(n)&&4&n.wrap&&(be[0]=255&f,be[1]=f>>>8&255,n.check=qi(n.check,be,2,0)),f=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.head&&(n.head.time=f),512&ji(n)&&4&n.wrap&&(be[0]=255&f,be[1]=f>>>8&255,be[2]=f>>>16&255,be[3]=f>>>24&255,n.check=qi(n.check,be,4,0)),f=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&ji(n)&&4&n.wrap&&(be[0]=255&f,be[1]=f>>>8&255,n.check=qi(n.check,be,2,0)),f=0,m=0,n.mode=16184;case 16184:if(1024&ji(n)){for(;m<16;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.length=f,n.head&&(n.head.extra_len=f),512&ji(n)&&4&n.wrap&&(be[0]=255&f,be[1]=f>>>8&255,n.check=qi(n.check,be,2,0)),f=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ji(n)&&(y=n.length,y>d&&(y=d),y&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+y),z)),512&ji(n)&&4&n.wrap&&(n.check=qi(n.check,i,y,o)),d-=y,o+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ji(n)){if(d===0)break e;y=0;do z=i[o+y++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&y<d);if(512&ji(n)&&4&n.wrap&&(n.check=qi(n.check,i,y,o)),d-=y,o+=y,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ji(n)){if(d===0)break e;y=0;do z=i[o+y++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&y<d);if(512&ji(n)&&4&n.wrap&&(n.check=qi(n.check,i,y,o)),d-=y,o+=y,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ji(n)){for(;m<16;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(4&n.wrap&&f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ni;break}f=0,m=0}n.head&&(n.head.hcrc=ji(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Wa;break;case 16189:for(;m<32;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}e.adler=n.check=hU(f),f=0,m=0,n.mode=hv;case hv:if(n.havedict===0)return e.next_out=c,e.avail_out=p,e.next_in=o,e.avail_in=d,n.hold=f,n.bits=m,eY;e.adler=n.check=1,n.mode=Wa;case Wa:if(t===Qz||t===dv)break e;case Vw:if(n.last){f>>>=7&m,m-=7&m,n.mode=Bw;break}for(;m<3;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}switch(n.last=1&f,f>>>=1,m-=1,3&f){case 0:n.mode=16193;break;case 1:if(iY(n),n.mode=pv,t===dv){f>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=ni}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ni;break}if(n.length=65535&f,f=0,m=0,n.mode=Fw,t===dv)break e;case Fw:n.mode=16195;case 16195:if(y=n.length,y){if(y>d&&(y=d),y>p&&(y=p),y===0)break e;s.set(i.subarray(o,o+y),c),d-=y,o+=y,p-=y,c+=y,n.length-=y;break}n.mode=Wa;break;case 16196:for(;m<14;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(n.nlen=257+(31&f),f>>>=5,m-=5,n.ndist=1+(31&f),f>>>=5,m-=5,n.ncode=4+(15&f),f>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ni;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.lens[ut[n.have++]]=7&f,f>>>=3,m-=3}for(;n.have<19;)n.lens[ut[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Re={bits:n.lenbits},oe=Hf(0,n.lens,0,19,n.lencode,0,n.work,Re),n.lenbits=Re.bits,oe){e.msg="invalid code lengths set",n.mode=ni;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;de=n.lencode[f&(1<<n.lenbits)-1],I=de>>>24,k=de>>>16&255,M=65535&de,!(I<=m);){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(M<16)f>>>=I,m-=I,n.lens[n.have++]=M;else{if(M===16){for(dt=I+2;m<dt;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(f>>>=I,m-=I,n.have===0){e.msg="invalid bit length repeat",n.mode=ni;break}z=n.lens[n.have-1],y=3+(3&f),f>>>=2,m-=2}else if(M===17){for(dt=I+3;m<dt;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}f>>>=I,m-=I,z=0,y=3+(7&f),f>>>=3,m-=3}else{for(dt=I+7;m<dt;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}f>>>=I,m-=I,z=0,y=11+(127&f),f>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ni;break}for(;y--;)n.lens[n.have++]=z}}if(n.mode===ni)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=ni;break}if(n.lenbits=9,Re={bits:n.lenbits},oe=Hf(1,n.lens,0,n.nlen,n.lencode,0,n.work,Re),n.lenbits=Re.bits,oe){e.msg="invalid literal/lengths set",n.mode=ni;break}if(n.distbits=6,n.distcode=n.distdyn,Re={bits:n.distbits},oe=Hf(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Re),n.distbits=Re.bits,oe){e.msg="invalid distances set",n.mode=ni;break}if(n.mode=pv,t===dv)break e;case pv:n.mode=fv;case fv:if(d>=6&&p>=258){e.next_out=c,e.avail_out=p,e.next_in=o,e.avail_in=d,n.hold=f,n.bits=m,Yz(e,v),c=e.next_out,s=e.output,p=e.avail_out,o=e.next_in,i=e.input,d=e.avail_in,f=n.hold,m=n.bits,n.mode===Wa&&(n.back=-1);break}for(n.back=0;de=n.lencode[f&(1<<n.lenbits)-1],I=de>>>24,k=de>>>16&255,M=65535&de,!(I<=m);){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(k&&!(240&k)){for(H=I,J=k,$=M;de=n.lencode[$+((f&(1<<H+J)-1)>>H)],I=de>>>24,k=de>>>16&255,M=65535&de,!(H+I<=m);){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}f>>>=H,m-=H,n.back+=H}if(f>>>=I,m-=I,n.back+=I,n.length=M,k===0){n.mode=16205;break}if(32&k){n.back=-1,n.mode=Wa;break}if(64&k){e.msg="invalid literal/length code",n.mode=ni;break}n.extra=15&k,n.mode=16201;case 16201:if(n.extra){for(dt=n.extra;m<dt;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;de=n.distcode[f&(1<<n.distbits)-1],I=de>>>24,k=de>>>16&255,M=65535&de,!(I<=m);){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(!(240&k)){for(H=I,J=k,$=M;de=n.distcode[$+((f&(1<<H+J)-1)>>H)],I=de>>>24,k=de>>>16&255,M=65535&de,!(H+I<=m);){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}f>>>=H,m-=H,n.back+=H}if(f>>>=I,m-=I,n.back+=I,64&k){e.msg="invalid distance code",n.mode=ni;break}n.offset=M,n.extra=15&k,n.mode=16203;case 16203:if(n.extra){for(dt=n.extra;m<dt;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ni;break}n.mode=16204;case 16204:if(p===0)break e;if(y=v-p,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ni;break}y>n.wnext?(y-=n.wnext,D=n.wsize-y):D=n.wnext-y,y>n.length&&(y=n.length),A=n.window}else A=s,D=c-n.offset,y=n.length;y>p&&(y=p),p-=y,n.length-=y;do s[c++]=A[D++];while(--y);n.length===0&&(n.mode=fv);break;case 16205:if(p===0)break e;s[c++]=n.length,p--,n.mode=fv;break;case Bw:if(n.wrap){for(;m<32;){if(d===0)break e;d--,f|=i[o++]<<m,m+=8}if(v-=p,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=ji(n)?qi(n.check,s,v,c-v):kf(n.check,s,v,c-v)),v=p,4&n.wrap&&(ji(n)?f:hU(f))!==n.check){e.msg="incorrect data check",n.mode=ni;break}f=0,m=0}n.mode=16207;case 16207:if(n.wrap&&ji(n)){for(;m<32;){if(d===0)break e;d--,f+=i[o++]<<m,m+=8}if(4&n.wrap&&f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ni;break}f=0,m=0}n.mode=16208;case 16208:oe=Zz;break e;case ni:oe=lU;break e;case 16210:return dU;default:return Gr}return e.next_out=c,e.avail_out=p,e.next_in=o,e.avail_in=d,n.hold=f,n.bits=m,(n.wsize||v!==e.avail_out&&n.mode<ni&&(n.mode<Bw||t!==cU))&&gU(e,e.output,e.next_out,v-e.avail_out),g-=e.avail_in,v-=e.avail_out,e.total_in+=g,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=ji(n)?qi(n.check,s,v,e.next_out-v):kf(n.check,s,v,e.next_out-v)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Wa?128:0)+(n.mode===pv||n.mode===Fw?256:0),(g===0&&v===0||t===cU)&&oe===od&&(oe=tY),oe},Ka={inflateReset:fU,inflateReset2:mU,inflateResetKeep:pU,inflateInit:e=>_U(e,15),inflateInit2:_U,inflate:sY,inflateEnd:e=>{if(ad(e))return Gr;let t=e.state;return t.window&&(t.window=null),e.state=null,od},inflateGetHeader:(e,t)=>{if(ad(e))return Gr;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,od):Gr},inflateSetDictionary:(e,t)=>{const n=t.length;let i,s,o;return ad(e)?Gr:(i=e.state,i.wrap!==0&&i.mode!==hv?Gr:i.mode===hv&&(s=1,s=kf(s,t,n,0),s!==i.check)?lU:(o=gU(e,t,n,n),o?(i.mode=16210,dU):(i.havedict=1,od)))},inflateInfo:"pako inflate (from Nodeca project)"},rY=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const vU=Object.prototype.toString,{Z_NO_FLUSH:oY,Z_FINISH:aY,Z_OK:Wf,Z_STREAM_END:Ww,Z_NEED_DICT:Kw,Z_STREAM_ERROR:cY,Z_DATA_ERROR:SU,Z_MEM_ERROR:lY}=ph;function Kf(e){this.options=iU({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oU,this.strm.avail_out=0;let n=Ka.inflateInit2(this.strm,t.windowBits);if(n!==Wf)throw new Error(nd[n]);if(this.header=new rY,Ka.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=jw(t.dictionary):vU.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ka.inflateSetDictionary(this.strm,t.dictionary),n!==Wf)))throw new Error(nd[n])}function zw(e,t){const n=new Kf(t);if(n.push(e),n.err)throw n.msg||nd[n.err];return n.result}Kf.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let o,c,d;if(this.ended)return!1;for(c=t===~~t?t:t===!0?aY:oY,vU.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),o=Ka.inflate(n,c),o===Kw&&s&&(o=Ka.inflateSetDictionary(n,s),o===Wf?o=Ka.inflate(n,c):o===SU&&(o=Kw));n.avail_in>0&&o===Ww&&n.state.wrap>0&&e[n.next_in]!==0;)Ka.inflateReset(n),o=Ka.inflate(n,c);switch(o){case cY:case SU:case Kw:case lY:return this.onEnd(o),this.ended=!0,!1}if(d=n.avail_out,n.next_out&&(n.avail_out===0||o===Ww))if(this.options.to==="string"){let p=jz(n.output,n.next_out),f=n.next_out-p,m=Mz(n.output,p);n.next_out=f,n.avail_out=i-f,f&&n.output.set(n.output.subarray(p,p+f),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==Wf||d!==0){if(o===Ww)return o=Ka.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Kf.prototype.onData=function(e){this.chunks.push(e)},Kf.prototype.onEnd=function(e){e===Wf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=sU(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var dY={Inflate:Kf,inflate:zw,inflateRaw:function(e,t){return(t=t||{}).raw=!0,zw(e,t)},ungzip:zw,constants:ph};const{Deflate:dne,deflate:uY,deflateRaw:une,gzip:hne}=zz,{Inflate:pne,inflate:hY,inflateRaw:fne,ungzip:mne}=dY;var pY=uY,fY=hY,TU=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(TU||{});class mY{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const d=new Uint8Array(4);d.set([1,0,0,0]);const p={id:0,length:4,data:d.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[p]};n.commonPacketHeader.extension=1,n.extension=f,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;V("SHOW_DATASTREAM2_LOG")&&b.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),s=new Uint8Array(i),o=new DataView(i);let c=0;if(o.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,o.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,o.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const d=this.serializeExtension(n.extension);s.set(new Uint8Array(d),c),c+=d.byteLength}if(s.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const s=n.getUint16(i,!0);i+=2;const o={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,d;if(i+=4,V("SHOW_DATASTREAM2_LOG")&&b.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(i,!0),i+=2,o.extension){d=this.deserializeExtension(t.slice(i)),i+=2+d.length,c=t.slice(i);let p=!1;if(d.datas.length>0){const f=d.datas.find(m=>m.id===0);f&&(p=!(1&~new DataView(f.data).getUint32(0,!0)))}c=p?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){const{profile:n,length:i,datas:s}=t,o=new ArrayBuffer(i+2),c=new Uint8Array(o),d=new DataView(o);let p=0;if(d.setUint8(p++,n),d.setUint8(p++,i),s.forEach(f=>{n?(d.setUint8(p++,f.id),d.setUint8(p++,f.length),c.set(new Uint8Array(f.data),p),p+=f.data.byteLength):(d.setUint8(p++,f.id|f.length<<4),c.set(new Uint8Array(f.data),p),p+=f.data.byteLength)}),p!==i+2)throw Error("serialize extension error, is ".concat(p,"!==").concat(i+2));return o}deserializeExtension(t){const n=new DataView(t);let i=0;const s=n.getUint8(i);i++;const o=n.getUint8(i);i++;const c=s===TU.TWO_BYTE,d=[],p=new DataView(t,2);let f=0;for(;f<o;){let m=0,g=0,v=new ArrayBuffer(0);c?(m=p.getUint8(f),f++,g=p.getUint8(f),f++):(m=15&p.getUint8(f),g=p.getUint8(f)>>4,f++),g>0&&(v=p.buffer.slice(f+2,f+2+g),f+=v.byteLength),d.push({id:m,length:g,data:v})}if(f!==o)throw Error("parse error");return{profile:s,length:o,datas:d}}decompress(t){return fY(new Uint8Array(t))}compress(t){return pY(new Uint8Array(t))}}const _Y={name:"DataStream",create:(e,t)=>{const n=t?new A7(e):new I7(e);return n.useDataStream(new mY),n}};class EY extends dn{constructor(t,n,i){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",s=>{this.emit("close"),this.dispose()}),N(this,"onMessage",s=>{const o=JSON.parse(s.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=t,this.clientId=n,this.ws=new Ef("cross-channel-".concat(this.clientId),i),this.ws.on(et.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(et.CONNECTED,this.onOpen),this.ws.on(et.ON_MESSAGE,this.onMessage),this.ws.on(et.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Te((n,i)=>{const s=window.setTimeout(()=>{i(new Q(L.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,o=>{window.clearTimeout(s),o.state&&o.state!==0?i(new Q(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new Q(L.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Q(L.WS_DISCONNECT);const n=()=>new Te((c,d)=>{this.ws.once(et.CLOSED,()=>d(new Q(L.WS_ABORT))),this.ws.once(et.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),s=new Te((c,d)=>{const p=()=>{d(new Q(L.WS_ABORT))};this.ws.once(et.RECONNECTING,p),this.ws.once(et.CLOSED,p),this.once("req_".concat(i),c),ci(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(et.RECONNECTING,p),this.ws.off(et.CLOSED,p),d(new Q(L.TIMEOUT,"cross channel ws request timeout"))})}),o=await s;if(!o||o.code!==200)throw new Q(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(t){this.ws.removeAllListeners(et.REQUEST_NEW_URLS),this.ws.on(et.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class gY extends dn{set state(t){t!==this._state&&(t!==ds.RELAY_STATE_FAILURE&&(this.errorCode=Qu.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,s,o){super(),N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",Zi.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",ds.RELAY_STATE_IDLE),N(this,"errorCode",Qu.RELAY_OK),N(this,"onStatus",c=>{b.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Ua.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Ua.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Qu.SRC_TOKEN_EXPIRED,this.state=ds.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Qu.DEST_TOKEN_EXPIRED,this.state=ds.RELAY_STATE_FAILURE))}),N(this,"onReconnect",async()=>{b.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ua.NETWORK_DISCONNECTED),this.state=ds.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==ds.RELAY_STATE_IDLE&&(b.error("auto restart channel media relay failed",c.toString()),this.errorCode=Qu.SERVER_CONNECTION_LOST,this.state=ds.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Fl(),this.signal=new EY(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=o}async startChannelMediaRelay(t){if(this.state!==ds.RELAY_STATE_IDLE)throw new Q(L.INVALID_OPERATION);this.state=ds.RELAY_STATE_CONNECTING,await this.connect(),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Q(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Q(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Q(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ds.RELAY_STATE_RUNNING)throw new Q(L.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ds.RELAY_STATE_RUNNING)throw new Q(L.INVALID_OPERATION);const n=this.genMessage(Yi.SetVideoProfile);await this.signal.request(n),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),b.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ds.RELAY_STATE_IDLE,this.dispose()}dispose(){b.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Zi.CancelToken.source(),this.state=ds.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await xK(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Ua.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Yi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Yi.SetSdkProfile,t);await this.signal.request(i),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Yi.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ua.PACKET_JOINED_SRC_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(Yi.SetSourceUserId,t);await this.signal.request(o),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Yi.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ua.PACKET_JOINED_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(Yi.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",Ua.PACKET_SENT_TO_DEST_CHANNEL),this.state=ds.RELAY_STATE_RUNNING,b.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Yi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Ua.PACKET_UPDATE_DEST_CHANNEL),b.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Yi.StopPacketTransfer);await this.signal.request(t),b.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],s=[],o=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:or,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.1"&&(c.sdkVersion="0.0.1");let d=null,p=null;switch(t){case Yi.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Yi.SetSourceChannel:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new Q(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},c;case Yi.SetSourceUserId:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new Q(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:p.uid+""},c;case Yi.SetDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new Q(L.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(f=>{i.push(f.channelName),s.push(f.uid+""),o.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:o},c;case Yi.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Yi.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Yi.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Yi.UpdateDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new Q(L.UNEXPECTED_ERROR,"can not find dest config");return d.forEach(f=>{i.push(f.channelName),s.push(f.uid+""),o.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:o},c;case Yi.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const vY={name:"ChannelMediaRelay",create:function(e){return new gY(e.joinInfo,e.clientId,e.websocketRetryConfig||jn,e.httpRetryConfig||jn,e.resolution)}};function yU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function zf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yU(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class SY extends dn{constructor(t,n,i,s){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",o=>{if(!o.data)return;const c=JSON.parse(o.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(xe.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===ja.TRANSCODE?1:2}),this.emit(Mc.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=s,this.websocket=new Ef("live-streaming",i),this.websocket.on(et.CONNECTED,this.handleWebSocketOpen),this.websocket.on(et.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(et.REQUEST_NEW_URLS,(o,c)=>{fi(this,Mc.REQUEST_NEW_ADDRESS).then(o).catch(c)}),this.websocket.on(et.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const o=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new Q(L.UNEXPECTED_ERROR);const d=zf({command:t,sdkVersion:or==="4.23.1"?"0.0.1":or,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new Q(L.WS_DISCONNECT);const p=()=>new Te((v,y)=>{this.websocket.once(et.CLOSED,()=>y(new Q(L.WS_ABORT))),this.websocket.once(et.CONNECTED,v)});this.websocket.state!=="connected"&&await p(),d.clientRequest&&(d.clientRequest.workerToken=this.token);const f=new Te((v,y)=>{const D=()=>{y(new Q(L.WS_ABORT))};this.websocket.once(et.RECONNECTING,D),this.websocket.once(et.CLOSED,D),this.once("@".concat(c,"-").concat(this.spec.sid),A=>{v(A)})});s&&xe.workerEvent(this.spec.sid,zf(zf({},s),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(d);let g=null;try{g=await f}catch(v){if(this.websocket.state==="closed")throw v;return await p(),await this.request(t,n,i)}return s&&xe.workerEvent(this.spec.sid,zf(zf({},s),{},{requestId:o,actionType:"response",payload:JSON.stringify(g.serverResponse),serverCode:g.code,success:g.code===200,responseTime:Date.now()-m})),g.code!==200&&this.handleResponseError(g),g}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=or==="4.23.1"?"0.0.1":or;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Gn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void b.warning("live stream response already exists stream");case Gn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Gn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Gn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Q(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Gn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Q(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Q(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Mc.WARNING,n,t.serverResponse.url)}case Gn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Q(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Mc.WARNING,n,t.serverResponse.url)}case Gn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Q(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Gn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Q(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Mc.WARNING,n,t.serverResponse.url)}case Gn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Gn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Q(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(og)},6e3)}}function bU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function hs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bU(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class TY extends dn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jn;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new vi("live-streaming")),N(this,"cancelToken",Zi.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=hs(hs({},fK),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(b.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>hs(hs(hs({},pK),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){pn(c.width)||Ut(c.width,"config.width",0,1e4),pn(c.height)||Ut(c.height,"config.height",0,1e4),pn(c.videoBitrate)||Ut(c.videoBitrate,"config.videoBitrate",1,1e6),pn(c.videoFrameRate)||Ut(c.videoFrameRate,"config.videoFrameRate"),pn(c.lowLatency)||xa(c.lowLatency,"config.lowLatency"),pn(c.audioSampleRate)||Wn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),pn(c.audioBitrate)||Ut(c.audioBitrate,"config.audioBitrate",1,128),pn(c.audioChannels)||Wn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),pn(c.videoGop)||Ut(c.videoGop,"config.videoGop"),pn(c.videoCodecProfile)||Wn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),pn(c.userCount)||Ut(c.userCount,"config.userCount",0,17),pn(c.backgroundColor)||Ut(c.backgroundColor,"config.backgroundColor",0,16777215),pn(c.userConfigExtraInfo)||ai(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!pn(c.transcodingUsers)&&(ka(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((d,p)=>{Ng(d.uid),pn(d.x)||Ut(d.x,"transcodingUser[".concat(p,"].x"),0,1e4),pn(d.y)||Ut(d.y,"transcodingUser[".concat(p,"].y"),0,1e4),pn(d.width)||Ut(d.width,"transcodingUser[".concat(p,"].width"),0,1e4),pn(d.height)||Ut(d.height,"transcodingUser[".concat(p,"].height"),0,1e4),pn(d.zOrder)||Ut(d.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),pn(d.alpha)||Ut(d.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),pn(c.watermark)||zR(c.watermark,"watermark"),pn(c.backgroundImage)||zR(c.backgroundImage,"backgroundImage"),c.images&&!pn(c.images)&&(ka(c.images,"config.images"),c.images.forEach((d,p)=>{zR(d,"images[".concat(p,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>hs(hs(hs({},KR),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(hs(hs(hs({},KR),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(hs(hs(hs({},KR),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>hs({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?Te.resolve(c.uid):Bk(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Te.all(s)).forEach((c,d)=>{n.userConfigs&&n.userConfigs[d]&&(n.userConfigs[d].uid=c)}),this.transcodingConfig=n,this.connection)try{var o;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(js(o=this.streamingTasks).call(o)).map(d=>d.taskId).join("#")});b.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(d=>{b.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,c).then(()=>{b.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(d.url," success"))}).catch(p=>{b.error("[".concat(this.spec.clientId,"] live streaming republish failed"),d.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,p)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===ja.TRANSCODE)throw new Q(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};b.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const o=await this.taskMutex.lock();if(!this.connection&&i)return void o();if(this.streamingTasks.get(t)&&!i)return o(),new Q(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(d){throw o(),d}switch(n){case ja.TRANSCODE:s.transcodingConfig=hs({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const d=new Te((f,m)=>{ci(this.retryTimeout).then(()=>{if(i)return m(i);const g=this.statusError.get(t);return g?(this.statusError.delete(t),m(g)):void 0})}),p=await Te.race([this.connection.request("request",{clientRequest:s},!0,{url:t,command:"PublishStream",workerType:n===ja.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),d]);this.isStartingStreamingTask=!1,b.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(t,{clientRequest:s,mode:n,url:t,taskId:c}),o()}catch(d){if(o(),this.isStartingStreamingTask=!1,!d.data||!d.data.retry||i)throw d;return d.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,d)):await this.startLiveStreamingTask(t,n,d)}}stopLiveStreamingTask(t){return new Te((n,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new Q(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=s.mode;s.abortTask=()=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:o===ja.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{b.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(js(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Zi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Q(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await fi(this,YR.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new SY(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Mc.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(Mc.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Mc.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new Q(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));fi(this,YR.REQUEST_WORKER_MANAGER_LIST,t).then(o=>{this.uapResponse=o,i(o.addressList)}).catch(s)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),s=t.reason;switch(t.code){case Gn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new Q(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return b.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Gn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new Q(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Gn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(js(o=this.streamingTasks).call(o));for(const d of c)d.abortTask?d.abortTask():(b.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,new Q(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{b.debug("[".concat(this.spec.clientId,"] republish live stream success"),d.url)}).catch(p=>{b.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,p)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const yY={name:"LiveStreaming",create:function(e){return new TY(e.joinInfo,e.websocketRetryConfig||jn,e.httpRetryConfig||jn)}};function bY(e){let t=wU();return function(n,i){let s=n.appId;s!==void 0&&(Pt(i,10),ta(i,s));let o=n.cid;o!==void 0&&(Pt(i,16),Pt(i,o));let c=n.cname;c!==void 0&&(Pt(i,26),ta(i,c));let d=n.deviceId;d!==void 0&&(Pt(i,34),ta(i,d));let p=n.elapse;p!==void 0&&(Pt(i,40),$c(i,p));let f=n.fileSize;f!==void 0&&(Pt(i,48),$c(i,Eh(f)));let m=n.height;m!==void 0&&(Pt(i,56),$c(i,Eh(m)));let g=n.jpg;g!==void 0&&(Pt(i,66),Pt(i,g.length),function(ss,ae){let Ee=gh(ss,ae.length);ss.bytes.set(ae,Ee)}(i,g));let v=n.networkType;v!==void 0&&(Pt(i,72),$c(i,Eh(v)));let y=n.osType;y!==void 0&&(Pt(i,80),$c(i,Eh(y)));let D=n.requestId;D!==void 0&&(Pt(i,90),ta(i,D));let A=n.sdkVersion;A!==void 0&&(Pt(i,98),ta(i,A));let I=n.sequence;I!==void 0&&(Pt(i,104),$c(i,Eh(I)));let k=n.sid;k!==void 0&&(Pt(i,114),ta(i,k));let M=n.timestamp;M!==void 0&&(Pt(i,120),$c(i,M));let H=n.uid;H!==void 0&&(Pt(i,128),Pt(i,H));let J=n.vid;J!==void 0&&(Pt(i,136),Pt(i,J));let $=n.width;$!==void 0&&(Pt(i,144),$c(i,Eh($)));let z=n.service;z!==void 0&&(Pt(i,152),Pt(i,z));let oe=n.callbackData;oe!==void 0&&(Pt(i,162),ta(i,oe));let de=n.jpgEncryption;de!==void 0&&(Pt(i,168),Pt(i,de));let be=n.requestType;be!==void 0&&(Pt(i,176),Pt(i,be));let Re=n.scorePorn;Re!==void 0&&(Pt(i,185),Xw(i,Re));let dt=n.scoreSexy;dt!==void 0&&(Pt(i,193),Xw(i,dt));let ut=n.scoreNeutral;ut!==void 0&&(Pt(i,201),Xw(i,ut));let $t=n.scene;$t!==void 0&&(Pt(i,208),Pt(i,$t));let wn=n.ossFilePrefix;wn!==void 0&&(Pt(i,218),ta(i,wn));let vn=n.serviceVendor;if(vn!==void 0)for(let ss of vn){Pt(i,226);let ae=wU();wY(ss,ae),Pt(i,ae.limit),NY(i,ae),OY(ae)}}(e,t),function(n){let i=n.bytes,s=n.limit;return i.length===s?i:i.subarray(0,s)}(t)}function CY(e){return function(n){let i={};e:for(;!AU(n);){let s=na(n);switch(s>>>3){case 0:break e;case 1:i.code=na(n);break;case 2:i.msg=IU(n,na(n));break;case 3:{let o=AY(n);i.data=RY(n),n.limit=o;break}default:CU(n,7&s)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function RY(e){let t={};e:for(;!AU(e);){let n=na(e);switch(n>>>3){case 0:break e;case 1:t.requestId=IU(e,na(e));break;case 2:t.requestType=na(e)>>>0;break;case 3:t.scorePorn=Jw(e);break;case 4:t.scoreSexy=Jw(e);break;case 5:t.scoreNeutral=Jw(e);break;case 6:t.requestScene=na(e)>>>0;break;case 7:t.scene=na(e)>>>0;break;default:CU(e,7&n)}}return t}function wY(e,t){let n=e.service;n!==void 0&&(Pt(t,8),Pt(t,n));let i=e.vendor;i!==void 0&&(Pt(t,16),Pt(t,i));let s=e.token;s!==void 0&&(Pt(t,26),ta(t,s));let o=e.callbackUrl;o!==void 0&&(Pt(t,34),ta(t,o))}function AY(e){let t=na(e),n=e.limit;return e.limit=e.offset+t,n}function CU(e,t){switch(t){case 0:for(;128&OU(e););break;case 2:qw(e,na(e));break;case 5:qw(e,4);break;case 1:qw(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let IY=new Float32Array(1);new Uint8Array(IY.buffer);let Yw=new Float64Array(1),ps=new Uint8Array(Yw.buffer);function Eh(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let RU=[];function wU(){const e=RU.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function OY(e){RU.push(e)}function qw(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function AU(e){return e.offset>=e.limit}function gh(e,t){let n=e.bytes,i=e.offset,s=e.limit,o=i+t;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),e.bytes=c}return e.offset=o,o>s&&(e.limit=o),i}function $w(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function IU(e,t){let n=$w(e,t),i=String.fromCharCode,s=e.bytes,o="�",c="";for(let d=0;d<t;d++){let p,f,m,g,v=s[d+n];128&v?(224&v)==192?d+1>=t?c+=o:(p=s[d+n+1],(192&p)!=128?c+=o:(g=(31&v)<<6|63&p,g<128?c+=o:(c+=i(g),d++))):(240&v)==224?d+2>=t?c+=o:(p=s[d+n+1],f=s[d+n+2],(49344&(p|f<<8))!=32896?c+=o:(g=(15&v)<<12|(63&p)<<6|63&f,g<2048||g>=55296&&g<=57343?c+=o:(c+=i(g),d+=2))):(248&v)==240?d+3>=t?c+=o:(p=s[d+n+1],f=s[d+n+2],m=s[d+n+3],(12632256&(p|f<<8|m<<16))!=8421504?c+=o:(g=(7&v)<<18|(63&p)<<12|(63&f)<<6|63&m,g<65536||g>1114111?c+=o:(g-=65536,c+=i(55296+(g>>10),56320+(1023&g)),d+=3))):c+=o:c+=i(v)}return c}function ta(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),i+=d<128?1:d<2048?2:d<65536?3:4}Pt(e,i);let s=gh(e,i),o=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?o[s++]=d:(d<2048?o[s++]=d>>6&31|192:(d<65536?o[s++]=d>>12&15|224:(o[s++]=d>>18&7|240,o[s++]=d>>12&63|128),o[s++]=d>>6&63|128),o[s++]=63&d|128)}}function NY(e,t){let n=gh(e,t.limit),i=e.bytes,s=t.bytes;for(let o=0,c=t.limit;o<c;o++)i[o+n]=s[o]}function OU(e){return e.bytes[$w(e,1)]}function NU(e,t){let n=gh(e,1);e.bytes[n]=t}function Jw(e){let t=$w(e,8),n=e.bytes;return ps[0]=n[t++],ps[1]=n[t++],ps[2]=n[t++],ps[3]=n[t++],ps[4]=n[t++],ps[5]=n[t++],ps[6]=n[t++],ps[7]=n[t++],Yw[0]}function Xw(e,t){let n=gh(e,8),i=e.bytes;Yw[0]=t,i[n++]=ps[0],i[n++]=ps[1],i[n++]=ps[2],i[n++]=ps[3],i[n++]=ps[4],i[n++]=ps[5],i[n++]=ps[6],i[n++]=ps[7]}function na(e){let t,n=0,i=0;do t=OU(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Pt(e,t){for(t>>>=0;t>=128;)NU(e,127&t|128),t>>>=7;NU(e,t)}function $c(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,o=s===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=gh(e,o),d=e.bytes;switch(o){case 10:d[c+9]=s>>>7&1;case 9:d[c+8]=o!==9?128|s:127&s;case 8:d[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:d[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:d[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:d[c+4]=o!==5?128|i:127&i;case 4:d[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:d[c]=o!==1?128|n:127&n}}function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}const DY=new Map([["moderation",1],["supervise",2]]);class PY extends dn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(ti.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=ks(n=t.map(i=>DY.get(i)||0)).call(n,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",Mr.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Zi.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==Mr.CONNECTED)throw new Q(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Mr.CONNECTED?this.requestToInspectImage():b.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Yt(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ef("worker-manager-"+this._inspectId,jn),this.on(ti.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,b.debug("[".concat(this._inspectId,"] Inspect operation :").concat(jr[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ef("worker-"+this._inspectId,jn),this.handleWorkerEvents()}async init(t,n){this.emit(ti.STATE_CHANGE,jr.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Te((s,o)=>{this.on(ti.CONNECTION_STATE_CHANGE,(c,d)=>{d===Mr.CONNECTED&&s()}),this.requestAP(t,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{o(c)})})}async requestAP(t,n,i){const s=V("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),o=await function(d,p,f,m){let{appId:g,areaCode:v,cname:y,sid:D,token:A,uid:I}=p;oh++;const k="image_moderation_api",M={service_name:k,json_body:JSON.stringify({appId:g,areaCode:v,cname:y,command:"allocateEdge",requestId:oh,seq:oh,sid:D,token:A,ts:Date.now(),uid:I+""})};let H,J,$=d[0];return ho(async()=>{H=Date.now();const z=await Eo($,{data:M,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(J=Date.now()-H,z.code!==0){const Re=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:J});throw b.error(Re.toString()),Re}const oe=JSON.parse(z.json_body);if(oe.code!==200){const Re=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(oe.code,", reason: ").concat(oe.reason),{code:oe.code,responseTime:J});throw b.error(Re.toString()),Re}if(!oe.servers||!Array.isArray(oe.servers)||oe.servers.length===0){const Re=new Q(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:oe.code,responseTime:J});throw b.error(Re.toString()),Re}const de=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),be=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:oe.servers.map(Re=>{let{address:dt,wss:ut}=Re;if(dt&&ut)return"wss://".concat(dt.replace(/\./g,"-"),".").concat(de,":").concat(be||ut)}).filter(Re=>!!Re),workerToken:oe.workerToken,vid:oe.vid,responseTime:J}},(z,oe)=>(xe.apworkerEvent(D,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(z.addressList),firstSuccess:oe===0,responseTime:J,serverIp:d[oe%d.length]}),!1),(z,oe)=>(xe.apworkerEvent(D,{success:!1,sc:z.data&&z.data.code||200,serviceName:k,responseTime:J,serverIp:d[oe%d.length]}),!!(z.code!==L.OPERATION_ABORTED&&z.code!==L.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&($=d[(oe+1)%d.length],!0)),m)}(s,t,n,i);this.emit(ti.STATE_CHANGE,jr.AP_CONNECTED);const{addressList:c}=o;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(ti.STATE_CHANGE,jr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(et.CONNECTED,async()=>{this.emit(ti.STATE_CHANGE,jr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(et.CLOSED,()=>{this._innerConnectionState<jr.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(et.FAILED,()=>{this._innerConnectionState<jr.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(et.RECONNECTING,()=>{this._innerConnectionState<jr.GET_WORKER_MANAGER_RESPONSE&&b.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(et.ON_MESSAGE,async t=>{this.emit(ti.STATE_CHANGE,jr.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw b.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Q(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw b.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Q(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=V("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=n.replace(/:\d+\/?$/,":".concat(s));this.emit(ti.STATE_CHANGE,jr.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(ti.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(et.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(et.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(et.CONNECTED,async()=>{this.emit(ti.STATE_CHANGE,jr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Mr.CONNECTED}),this.workerConnection.on(et.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=CY(new Uint8Array(t.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&b.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ti.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},o=ks(n=Object.keys(s)).call(n,(d,p)=>s[d]>s[p]?d:p,"porn"),c=Object.keys(s).find(d=>d===o);this.emit(ti.INSPECT_RESULT,c)}else this.emit(ti.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(ti.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else b.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ti.INSPECT_RESULT,void 0,new Q(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(et.CLOSED,()=>{this.connectionState=Mr.CLOSED}),this.workerConnection.on(et.FAILED,()=>{this.connectionState=Mr.CLOSED}),this.workerConnection.on(et.RECONNECTING,()=>{this.connectionState=this.connectionState===Mr.CONNECTED?Mr.RECONNECTING:Mr.CONNECTING}),this.workerConnection.on(et.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(et.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(ti.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Vs(this,ti.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(ti.INSPECT_RESULT,void 0,new Q(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(ti.INSPECT_RESULT,void 0,new Q(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:s,cid:o,vid:c,sid:d,uid:p}=n;const f=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await uL(m,i,s),v=this.sequence+"-"+o+"-"+p+"-"+f+"-"+Yt(12,""),y={appId:i,cid:o,cname:s,deviceId:"",elapse:(D=Number(f-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:g.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:v,sdkVersion:"4.23.1",sequence:this.sequence,sid:d,timestamp:jM(f),uid:p,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const A=bY(y);if(A.byteLength<this.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const I=function(k){for(var M=1;M<arguments.length;M++){var H=arguments[M]!=null?arguments[M]:{};M%2?DU(Object(H),!0).forEach(function(J){N(k,J,H[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(H)):DU(Object(H)).forEach(function(J){Object.defineProperty(k,J,Object.getOwnPropertyDescriptor(H,J))})}return k}({},y);delete I.jpg,b.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return A}{const I=this.quality*this.qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:s,cid:o,vid:c,sid:d,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Zi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Mr.CLOSED,this.emit(ti.STATE_CHANGE,jr.CLOSED)}}const LY={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new Q(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new Q(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(s=>{var o;if(!ve(o=["supervise","moderation"]).call(o,s))throw new Q(L.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new Q(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new PY(t)}};var PU=E(os.Object.getOwnPropertySymbols),xY=yt,kY=Nd.indexOf,MY=ml,Qw=Fe([].indexOf),LU=!!Qw&&1/Qw([1],1,-0)<0;xY({target:"Array",proto:!0,forced:LU||!MY("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return LU?Qw(this,e,t)||0:kY(this,e,t)}});var jY=xs("Array","indexOf"),UY=q,VY=jY,Zw=Array.prototype,FY=function(e){var t=e.indexOf;return e===Zw||UY(Zw,e)&&t===Zw.indexOf?VY:t},xU=E(FY);function BY(e,t){if(e==null)return{};var n,i,s=function(c,d){if(c==null)return{};var p,f,m={},g=Jx(c);for(f=0;f<g.length;f++)p=g[f],xU(d).call(d,p)>=0||(m[p]=c[p]);return m}(e,t);if(PU){var o=PU(e);for(i=0;i<o.length;i++)n=o[i],xU(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}let kU=class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(e){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),e=En(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s,localCapabilities:o,direction:c,setup:d,videoCodec:p,audioCodec:f}=e;let m;this.setup=d,m=c===zi.RECEIVE_ONLY?ls(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ls(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const g=c===zi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=c===zi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=c===zi.RECEIVE_ONLY?s.send.videoCodecs:Sf(Oe.VIDEO,g,v,p),D=c===zi.RECEIVE_ONLY?s.send.audioCodecs:Sf(Oe.AUDIO,g,v,f);for(const A of m.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=i,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=y.map(I=>I.payloadType.toString(10)),A.attributes.payloads=y,A.attributes.extmaps=g.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=D.map(I=>I.payloadType.toString(10)),A.attributes.payloads=D,A.attributes.extmaps=g.audioExtensions,rh(A));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return kc(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,s){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:c}=$l(t,this.cname,V("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(o);if(d){if(_n()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),s&&(s.twcc||s.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(d,s),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(e,o,i);let f;return p===-1?(f=this.createOrRecycleSendMedia(e,o,c,"sendonly",i,s),this.updateBundleMids()):(f=En(this.sessionDesc.mediaDescriptions[p]),f.attributes.direction="sendonly",f.attributes.ssrcs=o,f.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(f,s)),_n()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(s=>{const o=s._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(o);let d,p=!1;c===-1?(p=!0,d=this.createOrRecycleRecvMedia(s,[],"recvonly",t,n),this.updateBundleMids()):(d=En(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="recvonly"),i.push({mid:d.attributes.mid,needCreateTransceiver:p})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:s,type:o,relatedAddress:c,relatedPort:d,priority:p}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:n??"",priority:p?p+"":"",connectionAddress:i??"",port:s?s+"":"",type:o?o+"":"",relAddr:c??"",relPort:d?d+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,s){const o=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,d=Sf(o,c,this.localCapabilities.send,o===Oe.AUDIO?s:i),p=o===Oe.VIDEO?c.videoExtensions:c.audioExtensions,f="".concat(++this.currentMidIndex);let m={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e);const g=this.findFirstClosedMedia(o);if(g){const v=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ve(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(_n()){if(s){const o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!o||o!==i.attributes.mid)}return!1}return s&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=En(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,s,o){const c=this.rtpCapabilities.send,d=e===Oe.VIDEO?c.videoCodecs:c.audioCodecs,p=e===Oe.VIDEO?c.videoExtensions:c.audioExtensions;_n()&&(s="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:s}};f=this.mungSendMediaDesc(f,o);const m=this.findFirstClosedMedia(e);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,n){const i=En(e);return QR(i),sh(i,t),ZR(i,t),Tk(i),jg(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=En(e);return jg(n,t,this.localCapabilities.recv),rh(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>_n()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const GY=["sdp"];var en;function MU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MU(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let jU=(en=class Sh extends nk{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",void 0),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Sh.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??zi.SEND_ONLY,this.name=this.direction===zi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=pR(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await bk();if(this.localCapabilities=Ug(n),t){const{sdp:i}=t,s=BY(t,GY),o=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},g=vf(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ur(g,m,"videoExtensions",v,y,D),Ur(g,m,"videoCodecs",v,y,D),Ur(g,m,"audioExtensions",v,y,D),Ur(g,m,"audioCodecs",v,y,D),V("RAISE_H264_BASELINE_PRIORITY")){const A=D.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){const I=D.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<A){b.debug("raising H264 baseline profile priority");const k=D.videoCodecs[A];D.videoCodecs.splice(A,1),D.videoCodecs.splice(I,0,k)}I!==-1&&V("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(k=>!(k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:D}}({},{},i);this.remoteSDP=new kU({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const d=Vc(c.sdp);await this.peerConnection.setLocalDescription(c);const p=await Ck({},{},c.sdp);this.localCapabilities=Ug(p);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Jc(Jc({},d),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Vc(i.sdp);return this.initialOffer=i,Jc(Jc({},s),{},{sdp:i.sdp})}}catch(n){throw new re(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:s}=t,o=await Ck({},{},n);this.remoteSDP=new kU({remoteIceParameters:i,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new re(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var s=this;return rr(function*(){const o=yield ft(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],d=s.remoteSDP.receive(t,n,i);t.forEach((I,k)=>{if(d[k].needCreateTransceiver){const M=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});c.push(M),I._updateRtpTransceiver(M)}else{const M=s.peerConnection.getTransceivers().find(H=>H.mid===d[k].mid);if(!M)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(d[k].mid));c.push(M),I._updateRtpTransceiver(M)}}),_n()&&V("SIMULCAST")===!0&&(yield ft(s.applySimulcastForFirefox(c,t)));const p=d.map(I=>I.mid),f=yield ft(s.peerConnection.createOffer()),m=s.mungSendOfferSDP(f.sdp,t,p),g=ls(m),v=p.map(I=>{const k=g.mediaDescriptions.find(M=>M.attributes.mid===I);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return gk(k,V("USE_PUB_RTX"))}),y=c.map((I,k)=>{const M=p[k];return{localSSRC:v[k],id:M}});yield ft(s.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(I){const k=s.remoteSDP.toString();throw yield ft(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ft(s.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield ft(s.stopSending(p,!0)),I}yield ft(s.applySimulcastEncodings(c,t)),yield ft(s.applySendEncodings(c,t));const D=s.remoteSDP.toString(),A=s.logSDPExchange(m,"offer","local","send");return A==null||A(D),yield ft(s.setRemoteDescription({type:"answer",sdp:D})),c.map((I,k)=>{const M=p[k];return{localSSRC:v[k],id:M}})}catch(c){throw c instanceof re?c:new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(p=>{var f;p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);if(c){const p=this.remoteSDP.toString(),f=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(m.sdp,o,t);f==null||f(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find(p=>p.mid===o);if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,transceiver:d}}catch(o){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);if(c){const d=this.remoteSDP.toString(),p=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,o,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else b.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Bl.Auto&&(this.store.p2pTransport=Bl.SdRtn,gt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sh.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,gt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sh.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Vc(n.sdp);return this.store.descriptionStart(),this.direction===zi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===zi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Vc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new re(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(n)?_n()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(s=>s.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:s}=n.getSelectedCandidatePair();return{local:Jc(Jc({},Ho),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Jc(Jc({},Ho),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ve(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var o;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(of(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Sh.turnServerConfigToIceServers(t.turnServer.servers,n,i)),V("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Sh.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),ve(o=[Bl.Relay,Bl.SdRtn]).call(o,n)&&(s.iceTransportPolicy="relay"),V("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&gt().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),b.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],o=t.filter(d=>d.tcpport);b.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));const c=o.length>i?o[i]:o[0];switch(n){case Bl.SdRtn:const d=t.filter(f=>{var m;return ve(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),p=d.length>i?d[i]:d[0];p&&(s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(nh(p.turnServerURL),":").concat(p.tcpport,"?transport=udp")}),s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(nh(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;case Bl.Relay:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(nh(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(nh(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return s}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:s}=n.getSelectedCandidatePair();b.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return b.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!gt().supportSetRtpSenderParameters)return b.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var c;const{bitrateMax:m,frameRate:g,scaleResolutionDownBy:v}=t._encoderConfig;m&&(o.maxBitrate=1e3*m),ve(c=t._hints).call(c,qt.LOW_STREAM)&&(g&&(o.maxFramerate=Os(g)),v&&v>=1&&(o.scaleResolutionDownBy=v))}if(V("DSCP_TYPE")&&La()){var d;const m=V("DSCP_TYPE");ve(d=["very-low","low","medium","high"]).call(d,m)&&(o.networkPriority=m)}const p=n.getParameters(),f=(i=p.encodings)===null||i===void 0?void 0:i[0];_n()&&!f&&(s.encodings=[o]),f&&Object.assign(f,o),Object.assign(p,s),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p)}async applySendEncodings(t,n){try{if(!gt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];o instanceof tn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,s.sender)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const s=ls(t);return n.forEach((o,c)=>{const d=i[c],p=s.mediaDescriptions.find(f=>f.attributes.mid===d);p&&(sh(p,o),yk(p,o,this.store.codec))}),kc(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let p=0;p<t.length;p++){var i,s,o,c,d;const f=t[p],m=n[p];if(m instanceof tn&&!ve(i=m._hints).call(i,qt.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=m._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=f.sender.getParameters();await f.sender.setParameters(Object.assign(y,g))}}}async applySimulcastEncodings(t,n){if(!_n()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof tn&&this.isVP8Simulcast(s)){const o=t[i],c={},d={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const p=o.sender.getParameters();await o.sender.setParameters(Object.assign(p,c))}}}isVP8Simulcast(t){var n,i,s,o,c;return!!(t instanceof tn&&V("SIMULCAST")&&this.store.codec==="vp8"&&!ve(n=t._hints).call(n,qt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(V("SDP_LOGGING"))return b.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",s)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const o=this.remoteSDP.toString();s==null||s(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const o=this.remoteSDP.toString();s==null||s(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i,s;if(n=(i=n)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var o;const c=(o=ls(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),ve(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const s=ls(t),o=s.mediaDescriptions.find(c=>c.attributes.mid===n);return o&&i===Oe.AUDIO&&o.media.mediaType==="audio"&&rh(o),kc(s)}},De(en.prototype,"establish",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"establish"),en.prototype),De(en.prototype,"connect",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"connect"),en.prototype),De(en.prototype,"receive",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"receive"),en.prototype),De(en.prototype,"mockReceive",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"mockReceive"),en.prototype),De(en.prototype,"stopReceiving",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"stopReceiving"),en.prototype),De(en.prototype,"restartICE",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"restartICE"),en.prototype),De(en.prototype,"close",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"close"),en.prototype),De(en.prototype,"updateEncoderConfig",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"updateEncoderConfig"),en.prototype),De(en.prototype,"updateSendParameters",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"updateSendParameters"),en.prototype),De(en.prototype,"replaceTrack",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"replaceTrack"),en.prototype),De(en.prototype,"muteLocal",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"muteLocal"),en.prototype),De(en.prototype,"unmuteLocal",[Hr],Object.getOwnPropertyDescriptor(en.prototype,"unmuteLocal"),en.prototype),en);function Hr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),p=0;p<c;p++)d[p]=arguments[p];return await i.apply(this,d)}finally{o()}},n}let vo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var UU,VU,FU,BU,GU,HU,WU,KU,zU,YU,qU,on;function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function mv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let HY=(UU=So(vo.SEND_ONLY),VU=So(vo.SEND_ONLY),FU=So(),BU=So(vo.RECEIVE_ONLY),GU=So(vo.RECEIVE_ONLY),HU=So(vo.RECEIVE_ONLY),WU=So(vo.RECEIVE_ONLY),KU=So(vo.RECEIVE_ONLY),zU=So(vo.RECEIVE_ONLY),YU=So(),qU=So(vo.RECEIVE_ONLY),on=class extends dn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ve.StateChange,t,this._state)}constructor(e,t){super(),N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",void 0),N(this,"recvMutex",void 0),N(this,"_state",At.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==At.Connected)return void s(new re(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(n);if(p.length===0)return void i();const f=p.find(y=>y[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(y=>{let[,{id:D}]=y;return D}));let m=!1;var c,d;n.trackMediaType==="video"?m=!((c=this.localTrackMap.get(le.LocalAudioTrack))===null||c===void 0||!c.track._muted):m=((d=this.localTrackMap.get(le.LocalVideoTrack))===null||d===void 0?void 0:d.id)===void 0;const g=this.createMuteMessage(p);await zt(this,Ve.RequestMuteLocal,g);const v=n.trackMediaType==="video"?jc.MUTE_LOCAL_VIDEO:jc.MUTE_LOCAL_AUDIO;await zt(this,Ve.RequestP2PMuteLocal,{action:v,message:g,isMuteAll:m}),i()}catch(p){s(p)}finally{o()}}),N(this,"handleUnmuteLocalTrack",async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==At.Connected)return void s(new re(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(f=>{let[,{id:m}]=f;return m}));const d=this.createUnmuteMessage(c),p=n.trackMediaType==="video"?jc.UNMUTE_LOCAL_VIDEO:jc.UNMUTE_LOCAL_AUDIO;await zt(this,Ve.RequestP2PMuteLocal,{action:p,message:d}),i()}catch(c){s(c)}finally{o()}}),N(this,"handleUpdateVideoEncoder",async(n,i,s,o)=>{let c;typeof o=="boolean"&&o||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const p=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==n||this.state!==At.Connected)return void i();const{id:f,track:m}=p;f&&(await this.sendConnection.updateSendParameters(f,m),await this.sendConnection.updateEncoderConfig(f,m),this.emit(Ve.UpdateVideoEncoder,m)),i()}catch(p){s(p)}finally{var d;(d=c)===null||d===void 0||d()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==At.Connected)return void i();const{id:d,track:p}=c;d&&await this.sendConnection.updateSendParameters(d,p),i()}catch(c){s(c)}finally{o()}}),N(this,"handleReplaceTrack",async(n,i,s,o)=>{let c;b.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var d;const f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:g}]=m;return n===g});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==At.Connected)return void i();if(await((d=this.sendConnection)===null||d===void 0?void 0:d.replaceTrack(n,f[1].id)),f[0]===le.LocalVideoTrack&&gt().supportDualStreamEncoding){const m=this.localTrackMap.get(le.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new Te((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}i()}catch(f){s(f)}finally{var p;(p=c)===null||p===void 0||p()}}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lM(e),this.bindStatsUploaderEvents(),this.sendMutex=new vi("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new vi("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},V("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new re(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new re(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new jU(e,this.store,zi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=At.New,this.sendConnection&&(b.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new jU(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new re(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=At.Connected}async addRemoteCandidate(e,t){if(t===zi.RECEIVE_ONLY){if(!this.sendConnection)throw new re(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new re(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return rr(function*(){const s=yield ft(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==At.Connected){i.throwIfTrackTypeNotMatch(e);const f=e.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(f))}i.store.pubId=i.store.pubId+1,Ti.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(e,t,n);if(o.length===0)return void(yield ft(i.tryToUnmuteAudio(e)));o.forEach(f=>{let{track:m,type:g}=f;const v=Date.now();i.store.publish(m.getTrackId(),g===le.LocalAudioTrack?"audio":"video",v)}),i.bindLocalTrackEvents(o);const c=yield ft(i.sendConnection.send(o.map(f=>{let{track:m}=f;return m}),i.store.codec,i.store.audioCodec)),d=(yield ft(c.next())).value,p=i.createGatewayPublishMessage(o,d);try{yield p}catch(f){throw c.throw(f),(f==null?void 0:f.code)===L.WS_ABORT&&o.forEach(m=>{let{track:g}=m;i.pendingLocalTracks.indexOf(g)===-1&&i.pendingLocalTracks.push(g)}),i.unbindLocalTrackEvents(o),f}yield ft(c.next()),o.forEach(f=>{let{type:m}=f;i.statsCollector.addLocalStats(m)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,d),o.forEach(f=>{let{track:m,type:g}=f;const v=Date.now();i.store.publish(m.getTrackId(),g===le.LocalAudioTrack?"audio":"video",void 0,v)}),i.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==At.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!ve(e).call(e,s)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(s=>s[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(s=>{let[,{id:o}]=s;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[o,{track:c}]=s;return{type:o,track:c}})),t.forEach(s=>{let[o]=s;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===At.Connected)return n&&n[1].track.close(),i;e.forEach(s=>{const o=this.pendingLocalTracks.indexOf(s);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[s,{track:o,ssrcs:c}]=i;const d={stream_type:BK(o,s),ssrcs:c};o._muted||!o._enabled?t.push(d):n.push(d)}),t.length>0&&t.forEach(i=>{zt(this,Ve.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{zt(this,Ve.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return rr(function*(){throw new re(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(b.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Ve.RequestRePublish,this.pendingLocalTracks),this.emit(Ve.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new re(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var s;if(!this.recvConnection)throw new re(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;const{track:o,mid:c,transceiver:d}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===Oe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new qu(o,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new Yu(o,e.uid,e._uintid,this.store),b.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack));const p=this.remoteUserMap.get(e);p?p.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:g,kind:v}=m;return g.uid===e.uid&&t===v});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Ve.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new re(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:d}=o;return t!==void 0?c.uid===e.uid&&t===d:c.uid===e.uid});if(i.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(o=>{let{kind:c}=o;var d;if(c===Oe.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(c===Oe.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(e,t);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(o=>{let[,{id:c}]=o;return c})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(o=>{let[c,{kind:d}]=o;var p,f;if(d===Oe.VIDEO&&c._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===Oe.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((f=c._videoTrack)===null||f===void 0||f._destroy(),c._videoTrack=void 0);else if(d===Oe.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0)}}),s.forEach(o=>{let[,{kind:c}]=o;zt(this,Ve.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Oe.VIDEO,Oe.AUDIO].forEach(i=>{n.has(i)?zt(this,Ve.RequestP2PUnmuteRemote,i):zt(this,Ve.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new re(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new re(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new re(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new re(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Oe.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||b.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return s!==le.LocalAudioTrack}).filter(i=>{let[s]=i;return!(e&&s===le.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===le.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,s){if(e){const c=this.localTrackMap.get(le.LocalAudioTrack),d=i?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);xe.publish(this.store.sessionId,{eventElapse:Ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:d==null?void 0:d.track.getTrackLabel(),screenshare:(d==null?void 0:d.track._hints.indexOf(qt.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var o;n||(n=[]);const c=n.find(p=>p instanceof gn),d=i?(o=this.localTrackMap.get(le.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(p=>p instanceof tn);xe.publish(this.store.sessionId,{eventElapse:Ti.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:d==null?void 0:d.getTrackLabel(),screenshare:(d==null?void 0:d._hints.indexOf(qt.SCREEN_TRACK))!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===Oe.VIDEO?n._videoSSRC:n._audioSSRC;s&&xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Oe.VIDEO,audio:i===Oe.AUDIO,peerid:n.uid,subscribeRequestid:i===Oe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ti.measureFromSubscribeStart(this.store.clientId,s)})}reset(){b.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new vi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new vi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Bn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=At.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof tn||t&&t.track instanceof gn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Bs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Wp(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(b.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=At.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case le.LocalVideoTrack:ve(t=i._hints).call(t,qt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case le.LocalAudioTrack:i instanceof Bn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case le.LocalVideoLowTrack:}}),this.emit(Ve.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Bs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ve.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),b.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof Bc?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===zi.SEND_ONLY){if(!this.sendConnection)throw new re(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new re(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const s=await i.restartICE(t);return i.isInRestartIce=!1,s}{const s=await i.restartICE();if(s){const o=await fi(this,Ve.RequestP2PRestartICE,{direction:zi.RECEIVE_ONLY,iceParameter:s});await i.restartICE(o),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalAudioTrack),i=e.videoSend.find(y=>{var D;return y.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),s=e.audioSend.find(y=>{var D;return y.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!i||!s)return 1;const o=Vs(this,Ve.NeedSignalRTT),c=i?i.rttMs:void 0,d=s?s.rttMs:void 0,p=c&&d?(c+d)/2:c||d,f=(p&&o?(p+o)/2:p||o)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t==null?void 0:t.track;if(v&&v._encoderConfig&&v._hints.indexOf(qt.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return Yx[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const s=i._audioSSRC,o=i._videoSSRC,c=e.audioRecv.find(D=>D.ssrc===s),d=e.videoRecv.find(D=>D.ssrc===o);if(!c&&!d)return void(t+=1);const p=Vs(this,Ve.NeedSignalRTT),f=e.rtt,m=(f&&p?(f+p)/2:f||p)||0,g=c?c.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;g&&(y=.6*v*100/50+.2*m/1500+.2*g/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Te((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],s=gt(),o=this.getAllTracks();e=ku(e=e.filter(p=>o.indexOf(p)===-1));let c=!1,d=!1;for(const p of e){if(p instanceof tn&&(this.localTrackMap.has(le.LocalVideoTrack)||c?new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:p,type:le.LocalVideoTrack}),c=!0),t)){const f=this.getLowVideoTrack(p,n);i.push({track:f,type:le.LocalVideoLowTrack})}if(p instanceof gn){const f=this.localTrackMap.get(le.LocalAudioTrack);if(f){if(!(f.track instanceof Bn))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(d){const m=i.find(g=>{let{type:v}=g;return v===le.LocalAudioTrack});if(!(m.track instanceof Bn))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p)}else{if(!s.webAudioMediaStreamDest||p instanceof Bn||p._bypassWebAudio)i.push({track:p,type:le.LocalAudioTrack});else{const m=new Bn;m.addAudioTrack(p),i.push({track:m,type:le.LocalAudioTrack})}d=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=ku(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof gn){const s=this.localTrackMap.get(le.LocalAudioTrack);if(!s)continue;s.track instanceof Bn?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([le.LocalAudioTrack,s]),s.track.close())):t.push([le.LocalAudioTrack,s])}if(i instanceof tn){const s=this.localTrackMap.get(le.LocalVideoTrack);if(!s)continue;t.push([le.LocalVideoTrack,s]);const o=this.localTrackMap.get(le.LocalVideoLowTrack);o&&t.push([le.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case le.LocalVideoTrack:n.addListener(Ne.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Bn?e.trackList.forEach(n=>{n.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ne.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case le.LocalVideoTrack:n.off(Ne.GET_STATS,this.handleGetLocalVideoStats),n.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ne.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ne.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Bn?e.trackList.forEach(t=>{t.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ne.GET_STATS,this.handleGetLocalAudioStats),t.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ne.GET_STATS,this.handleGetLocalAudioStats),e.off(Ne.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ne.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ne.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ne.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Yu&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof qu&&t.addListener(Ne.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ne.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Oe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Oe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var s;let o,{track:c,type:d}=n;switch(d){case le.LocalAudioTrack:o=Nt.Audio;break;case le.LocalVideoTrack:o=ve(s=c._hints).call(s,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:o=Nt.Low}return{kind:d===le.LocalAudioTrack?Oe.AUDIO:Oe.VIDEO,stream_type:o,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:s,type:o}=n;this.localTrackMap.set(o,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Ve.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ve(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await ci(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:fn.TRACER}).onSuccess(),this.emit(Ve.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(Gu.FIRST_FRAME_DECODED),xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);i&&xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Bs(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);i&&xe.firstRemoteFrame(this.store.sessionId,zn.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&i===s||this.emit(Ve.ConnectionTypeChange,i),b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Uc(n))," -> ").concat(JSON.stringify(Uc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{b.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Uc(n))," -> ").concat(JSON.stringify(Uc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Ve.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===zi.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,b.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===zi.SEND_ONLY?this.restartICE(e):fi(this,Ve.RequestP2PRestartICE,{direction:zi.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof gn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive||t.push([le.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(i&&(t.push(i),i[0]===le.LocalVideoTrack)){const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(le.LocalAudioTrack);if(e instanceof gn&&(n==null?void 0:n.track)instanceof Bn)return n.track.isActive&&t.push([le.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(i)if(i[0]===le.LocalVideoTrack){t.push(i);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&t.push([le.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case le.LocalAudioTrack:i=Nt.Audio;break;case le.LocalVideoTrack:i=ve(n=o._hints).call(n,qt.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case le.LocalVideoLowTrack:i=Nt.Low}return{stream_type:i,ssrcs:c,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(s=>{let[o,c]=s;n.push([e,{kind:o,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:s,id:o}]=n;switch(s){case Oe.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Oe.VIDEO,ssrcId:i._videoSSRC}));case Oe.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Oe.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Te((i,s)=>{this.handleUpdateVideoEncoder(t.track,i,s,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Te((i,s)=>{this.handleUpdateVideoEncoder(n.track,i,s,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof gn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await zt(this,Ve.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ve.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Ve.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ci(aR(this.dtlsFailedCount,jn)),this.emit(Ve.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof tn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof tn).length>1)throw new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof gn).length>1&&(e.some(t=>t instanceof gn&&t._bypassWebAudio)||!gt().webAudioMediaStreamDest))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof tn&&this.pendingLocalTracks.some(n=>n instanceof tn))throw new re(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof gn&&this.pendingLocalTracks.some(n=>n instanceof gn)&&(!gt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof gn&&n._bypassWebAudio)))throw new re(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&gt().supportDualStreamEncoding,i=mv(mv({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():mw(e,i);const o=Yt(8,"track-low-"),c=new tn(s,mv(mv({},n&&{scaleResolutionDownBy:XR(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(Gl.TRANSCEIVER_UPDATED,d=>{e._updateRtpTransceiver(d,Fu.LOW_STREAM)}),c._hints.push(qt.LOW_STREAM),e.addListener(Ne.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var s;const o=Array.from(Bs(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find(p=>p.userId===o.uid&&p.type==="video");xe.firstRemoteVideoDecode(this.store.sessionId,zn.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:Ti.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(d==null?void 0:d.subscribeEnd)||0,subscriberStart:(d==null?void 0:d.subscribeStart)||0,videoAddNotify:(d==null?void 0:d.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const o=await this.recvConnection.getRemoteSSRC(s);return o!==void 0&&o!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new re(L.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new re(L.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new re(L.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new re(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new re(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new re(L.NOT_SUPPORTED)}async preConnect(e){throw new re(L.NOT_SUPPORTED)}getEstablishParams(){throw new re(L.NOT_SUPPORTED)}async reSubscribe(e){throw new re(L.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new re(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Fu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},De(on.prototype,"p2pConnect",[UU],Object.getOwnPropertyDescriptor(on.prototype,"p2pConnect"),on.prototype),De(on.prototype,"unpublish",[VU],Object.getOwnPropertyDescriptor(on.prototype,"unpublish"),on.prototype),De(on.prototype,"unpublishLowStream",[FU],Object.getOwnPropertyDescriptor(on.prototype,"unpublishLowStream"),on.prototype),De(on.prototype,"subscribe",[BU],Object.getOwnPropertyDescriptor(on.prototype,"subscribe"),on.prototype),De(on.prototype,"mockSubscribe",[GU],Object.getOwnPropertyDescriptor(on.prototype,"mockSubscribe"),on.prototype),De(on.prototype,"unsubscribe",[HU],Object.getOwnPropertyDescriptor(on.prototype,"unsubscribe"),on.prototype),De(on.prototype,"muteRemote",[WU],Object.getOwnPropertyDescriptor(on.prototype,"muteRemote"),on.prototype),De(on.prototype,"unmuteRemote",[KU],Object.getOwnPropertyDescriptor(on.prototype,"unmuteRemote"),on.prototype),De(on.prototype,"hasRemoteMediaWithLock",[zU],Object.getOwnPropertyDescriptor(on.prototype,"hasRemoteMediaWithLock"),on.prototype),De(on.prototype,"disconnectForReconnect",[YU],Object.getOwnPropertyDescriptor(on.prototype,"disconnectForReconnect"),on.prototype),De(on.prototype,"remoteMediaSsrcChanged",[qU],Object.getOwnPropertyDescriptor(on.prototype,"remoteMediaSsrcChanged"),on.prototype),on);function So(e){return function(t,n,i){const s=t[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];switch(e){case vo.SEND_ONLY:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{p()}}case vo.RECEIVE_ONLY:{const p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{p()}}default:{const p=await this.sendMutex.lock("From P2PChannel2.".concat(n)),f=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{p(),f()}}}},i}}class cd extends dn{constructor(t,n){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Xt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*V("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,s,o){var c,d,p;if(this.userMap.size===0)return;const f=Array.from(js(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),s=(d=s)!==null&&d!==void 0?d:Yt(6,""),o=(p=o)!==null&&p!==void 0?p:this._sequence++;const m={_id:s,_type:t,_seq:o,_message:n,token:"".concat(this.token,"_").concat(f)};V("SHOW_P2P_LOG")&&b.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(v=>{this.signal.request(ze.DATA_STREAM,{payload:xc(this.encoder.encode(v))})});const g=new Te((v,y)=>{const D=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),A),this.off("res-@".concat(s),k),this.off(eh.ABORT,I),b.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(s)),this.userMap.size===0?y(new re(L.INVALID_REMOTE_USER)):y(new re(L.TIMEOUT))},V("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{D&&window.clearTimeout(D),this.off(eh.ABORT,I),i&&v()},I=()=>{D&&window.clearTimeout(D),this.off("res-@".concat(s,"_ack"),A),this.off("res-@".concat(s),k),y(new re(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(s)))};this.once(eh.ABORT,I),this.once("res-@".concat(s,"_ack"),A);const k=(H,J)=>{M=!0,D&&window.clearTimeout(D),this.off("res-@".concat(s,"_ack"),A),this.off(eh.ABORT,I),H==="success"?v(J):y(new re(L.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(s)))};let M=!1;i||(this.once("res-@".concat(s),k),ci(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{M||b.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(s,", ").concat(m))}))});try{return await g}catch(v){if(v.code===L.TIMEOUT)return await this.send(t,n,i,s,o);throw v}}onMessage(t){var n;const{_uid:i}=t;let s,o=this.userMap.get(i);if(o)s=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Rn.CHECK)return;const{token:f}=t;s=new Map,o={uid:i,isStart:!0,token:f,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(lt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;const{id:f,total:m}=t,g=(c=s.get(f))!==null&&c!==void 0?c:[];if(g.push(t),s.has(f)||s.set(f,g),g.length!==m)return;{const v=Wp(g).call(g,(y,D)=>y.index-D.index).map(y=>y.payload).join("");s.delete(f),(t=JSON.parse(v))._uid=i}}const{_type:d,token:p}=t;if(ve(n=[Rn.ACK,Rn.CHECK]).call(n,d))return d===Rn.CHECK&&this.handleCheckToken(o,p),void this.receiveMessage(t);p==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):b.debug('Receive unexpected message", '.concat(p,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){const t={_id:Yt(6,""),token:this.token,_type:Rn.CHECK};V("SHOW_P2P_LOG")&&b.debug("send message",t),this.signal.request(ze.DATA_STREAM,{payload:xc(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Rn.ACK,token:this.token};V("SHOW_P2P_LOG")&&b.debug("send message",n),this.signal.request(ze.DATA_STREAM,{payload:xc(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(Rn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:g}=f;for(;m.has(g);){const v=m.get(g);m.delete(g),this.receiveMessage(v),f.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:s}=t,o=this.userMap.get(i),{receivedMessagesMap:c,isStart:d,nextExpectedSequenceNumber:p}=o;if(s<p)return this.ack(t._id),void b.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(t._message));c.set(s,t),d&&s===p&&(this.receiveMessage(t),c.delete(p),o.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:s,_uid:o}=t;if(V("SHOW_P2P_LOG")&&b.debug("receive message",t),n){let c;switch(t._type!==Rn.ACK&&(s&&(c=JSON.parse(s)),this.ack(t._id)),t._type){case Rn.CANDIDATE:case Rn.CONTROL:this.signal.emit(i,c,o);break;case Rn.PUBLISH:case Rn.UNPUBLISH:case Rn.RESTART_ICE:case Rn.CALL:c.uid=o,fi(this.signal,i,c).then(d=>{this.response(t._id,d)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Rn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Rn.RESPONSE:{const{success:d,message:p}=c;this.emit("res-@".concat(n),d?"success":"failed",p);break}}}}splitMessage(t){if(t.length<cd.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),s=Yt(6,"");let o=0,c=800;const d=Math.ceil(t.length/c);for(;t.length>0;){o++;const p={id:s,index:o,total:d,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(p).length>cd.MAX_MESSAGE_SIZE?c-=50:(n.push(p),t=t.slice(c))}return n.map(p=>JSON.stringify(p))}handleCheckToken(t,n){return t.token!==n?(b.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{b.debug("token timeout, ".concat(n)),this.reset(t.uid)},V("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await fi(this.signal,Rn.CALL,void 0),n=await this.send(Rn.CALL,t);this.signal.emit($e.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(eh.ABORT),this.signal.emit(lt.ON_USER_OFFLINE,{uid:i.uid,reason:mK.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(b.debug("change local token from ".concat(n," to ").concat(n)),this.token=Yt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(eh.ABORT)}}N(cd,"MAX_SIZE",1),N(cd,"MAX_MESSAGE_SIZE",1024);class WY extends dn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Xt.CONNECTED?this.emit($e.WS_CONNECTED):t===Xt.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):t===Xt.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",Xt.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new w1(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const o="res-@".concat(s._id);this.emit(o,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case lt.ON_DATA_STREAM:return void this.handleDataStream(s._message);case lt.MUTE_AUDIO:case lt.MUTE_VIDEO:case lt.ON_P2P_LOST:case lt.ON_USER_ONLINE:return;case lt.ON_USER_OFFLINE:const{uid:o}=s._message;return b.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(s._type,s._message),s._type===lt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===lt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(wt.UID_BANNED);break;case 15:this.close(wt.IP_BANNED);break;case 16:this.close(wt.CHANNEL_BANNED)}if(s._type===lt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Ge.ERR_LICENSE_MISSING:this.close(wt.LICENSE_MISSING);break;case Ge.ERR_LICENSE_EXPIRED:this.close(wt.LICENSE_EXPIRED);break;case Ge.ERR_LICENSE_MINUTES_EXCEEDED:this.close(wt.LICENSE_MINUTES_EXCEEDED);break;case Ge.ERR_LICENSE_PERIOD_INVALID:this.close(wt.LICENSE_PERIOD_INVALID);break;case Ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(wt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ge.ERR_LICENSE_ILLEGAL:this.close(wt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new $R("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xt.CONNECTED&&this.reconnect("retry",pi.OFFLINE)}),this.p2pToken=Yt(6,""),this._external_signal=new cd(this,this.p2pToken)}async request(t,n,i,s){const o=Yt(6,""),c={_id:o,_type:t,_message:n},d=this.websocket.connectionID,p=()=>new Te((D,A)=>{if(this.connectionState===Xt.CONNECTED)return D();const I=()=>{this.off($e.WS_CLOSED,k),D()},k=()=>{this.off($e.WS_CONNECTED,I),A(new re(L.WS_ABORT))};this.once($e.WS_CONNECTED,I),this.once($e.WS_CLOSED,k)});if(this.connectionState!==Xt.CONNECTING&&this.connectionState!==Xt.RECONNECTING||t===ze.JOIN||t===ze.REJOIN||await p(),this.websocket.sendMessage(c,!0),s)return;const f=new Te((D,A)=>{let I=!1;const k=(H,J)=>{I=!0,D({isSuccess:H==="success",message:J||{}}),this.off($e.WS_CLOSED,M),this.off($e.WS_RECONNECTING,M),this.emit($e.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(o),k);const M=()=>{A(new re(L.WS_ABORT,"type: ".concat(t))),this.off($e.WS_CLOSED,M),this.off($e.WS_RECONNECTING,M),this.off("res-@".concat(o),k)};this.once($e.WS_CLOSED,M),this.once($e.WS_RECONNECTING,M),ci(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==d||I||(b.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit($e.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await f}catch(D){if(this.connectionState===Xt.CLOSED||t===ze.LEAVE)throw new re(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===ze.JOIN||t===ze.REJOIN?null:(await p(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),v=_f(g),y=new re(L.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:v.desc});return v.action==="success"?m.message:(b.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(v.desc,", action: ").concat(v.action)),g===Ge.ERR_TOO_MANY_BROADCASTERS?((t===ze.JOIN||t===ze.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(g===Ge.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,b.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pi.MULTI_IP)):this.reconnect(v.action,pi.SERVER_ERROR),t===ze.JOIN||t===ze.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Te(i=>{const s=o=>{(!n||n(o))&&(this.off(t,s),i(o))};this.on(t,s)})}uploadWRTCStats(t){if(!this.store.sessionId)return void b.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(ff.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xt.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Te((n,i)=>{this.once($e.WS_CONNECTED,()=>n(this.joinResponse)),this.once($e.WS_CLOSED,()=>i(this.initError||new re(L.WS_ABORT))),this.connectionState=Xt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||wt.LEAVE,this.connectionState=Xt.CLOSED,b.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Yt(6,""),this._external_signal.clear(),this._external_signal=new cd(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit($e.ABORT_P2P_EXECUTION);const t=await fi(this,$e.REQUEST_JOIN_INFO),n=await this.request(ze.JOIN,t);if(!n)return this.emit($e.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit($e.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const i=Vl(t.payload),s=new TextDecoder().decode(i),o=JSON.parse(s);"total"in o&&"id"in o||ve(n=Object.values(Rn)).call(n,o._type)?(o._uid=t.uid,this._external_signal.onMessage(o)):this.emit(lt.ON_DATA_STREAM,t)}catch{this.emit(lt.ON_DATA_STREAM,t)}}handleNotification(t){b.debug("[".concat(this.clientId,"] receive notification: "),t);const n=_f(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(wt.UID_BANNED),void this.close()):void this.reconnect(n.action,pi.SERVER_ERROR);b.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=V("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(b.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",pi.TIMEOUT):this.request(ze.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(ze.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(et.RECONNECT_CREATE_CONNECTION,t=>{this.emit($e.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(et.CLOSED,()=>{this.connectionState=Xt.CLOSED}),this.websocket.on(et.FAILED,()=>{this._disconnectedReason=wt.NETWORK_ERROR,this.connectionState=Xt.CLOSED}),this.websocket.on(et.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Xt.CONNECTED?this.connectionState=Xt.RECONNECTING:this.connectionState=Xt.CONNECTING}),this.websocket.on(et.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(b.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):b.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit($e.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof re&&t.code===L.UNEXPECTED_RESPONSE&&t.data.code===Ge.ERR_NO_AUTHORIZED)return b.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",pi.SERVER_ERROR);b.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(et.REQUEST_NEW_URLS,(t,n)=>{fi(this,$e.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(lt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const KY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new HY(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new WY(n,t)}};function JU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function XU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JU(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class zY{constructor(t){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"_originCandidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),t=En(t);const{iceParameters:n,dtlsParameters:i,candidates:s,rtpCapabilities:o,setup:c,localCapabilities:d,sdkCodec:p,cname:f}=t,m=ls(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=s,this._originCandidates=En(s),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=d,this.cname=f;for(let g=0;g<m.mediaDescriptions.length;g++){const v=m.mediaDescriptions[g];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=i.fingerprints,v.attributes.candidates=s,v.attributes.setup=c,v.media.mediaType==="video"){v.media.fmts=o.videoCodecs.map(D=>D.payloadType.toString(10));let y=o.videoCodecs.filter(D=>{var A,I;return(A=D.rtpMap)===null||A===void 0?void 0:ve(I=A.encodingName.toLowerCase()).call(I,p)});y.length===0&&(y=o.videoCodecs),v.attributes.payloads=y,v.attributes.extmaps=o.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=o.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=o.audioCodecs,v.attributes.extmaps=o.audioExtensions),m.mediaDescriptions[g]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return kc(this.sessionDesc)}send(t,n,i){const{ssrcs:s,ssrcGroups:o}=$l(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(f=>t===Oe.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),d=s[0].attributes.label,p=s[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(s),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(o),{id:d,mslabel:p}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:s}=n;return this.send(i,s,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],s=[],o=[];n.attributes.ssrcs.forEach(c=>{ve(t).call(t,c.attributes.label||"")?o.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var d;ve(d=o.map(p=>p.ssrcId)).call(d,c.ssrcIds[0])||s.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=s})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((s,o)=>{const c=s._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===c.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],s);this.sessionDesc.mediaDescriptions[d]=p})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(s=>s.transport==="udp"),i=[];if(n.forEach(s=>{i.push(XU(XU({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),n.length!==0){switch(t){case Ii.TCP_RELAY:this.candidates=i;break;case Ii.UDP_TCP_RELAY:case Ii.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=En(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=En(t);return sh(i,n),ZR(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const s=this.sessionDesc.mediaDescriptions.find(c=>t===Oe.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(s){const c=s.attributes.ssrcs.find(d=>d.attributes.label===n);var o;c&&(c.attributes.label=i,(o=c.attributes.msid)===null||o===void 0||o.replace(n,i))}}mungMediaDesc(t){const n=En(t);return QR(n),function(i){const s=i.attributes.extmaps.find(o=>Mg(o.extensionName));s&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(s),1),i.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var Ht;function QU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function _v(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QU(Object(n),!0).forEach(function(i){N(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let YY=(Ht=class im extends ik{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ve(n=Object.keys(ug)).call(n,t)}))]}constructor(t,n){super(t,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",void 0),this.store=n,this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(im.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pR(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Vc(t.sdp),i=vf(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,_v(_v({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new re(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new zY(_v(_v({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new re(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return rr(function*(){const s=yield ft(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=t.map(v=>i.peerConnection.addTrack(v._mediaStreamTrack)),c=yield ft(i.peerConnection.createOffer()),d=ls(c.sdp),p=t.map(v=>{const y=v._mediaStreamTrack,D=d.mediaDescriptions.find(A=>A.attributes.mid===y.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,I,k){const M=A.attributes.ssrcs.filter(J=>J.attributes.label===I),H=A.attributes.ssrcGroups;if(M.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(H&&M.length>1){const J=H.find($=>$.ssrcIds.indexOf(M[0].ssrcId)!==-1);return J?[{ssrcId:J.ssrcIds[0],rtx:k?J.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]}(D,y.id,i.useRTX)});let f;try{f=yield p}catch(v){throw o.forEach(y=>{hi()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),v}const m=i.mungSendOfferSDP(c.sdp,t);i.remoteSDP.receive(t,n,f);const g=i.remoteSDP.toString();return yield ft(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ft(i.applySendEncodings(o,t)),yield ft(i.peerConnection.setRemoteDescription({type:"answer",sdp:g})),t.map((v,y)=>{const D=v._mediaStreamTrack.id;return{localSSRC:p[y],id:D}})}catch(o){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(o=>{hi()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:o,mslabel:c}=this.remoteSDP.send(t,n,s),d=new Te((m,g)=>{const v=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(o)))},1e4),y=D=>{const A=Et();if((A.name==="Safari"&&Number(A.version)===11||Hi())&&D.track.id!==o&&D.streams[0].id===c){var I;const k=D.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(t,o,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(k)}if(D.track.id===o)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(D.track)};this.peerConnection.addEventListener("track",y)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await d,id:o}}catch(o){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(hi()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(o=>o.active=!1),i.setParameters(s)}})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async o=>{if(hi()&&o.track)o.track.enabled=!0;else{const c=o.getParameters();c.encodings.forEach(d=>d.active=!0),await o.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return rr(function*(){const i=yield ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=gt().supportPCSetConfiguration;if(t===Ii.RELAY&&!s)return;if(s){const f=n.peerConnection.getConfiguration(),m=t===Ii.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(b.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,n.peerConnection.setConfiguration(f))}t!==Ii.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield ft(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Vc(o.sdp),{remoteIceParameters:d}=yield c.iceParameters;n.remoteSDP.restartICE(d);const p=n.remoteSDP.toString();yield ft(n.peerConnection.setLocalDescription(o)),yield ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(s){b.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new re(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(s=>{var o;return((o=s.track)===null||o===void 0?void 0:o.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(s=>{var o;return((o=s.track)===null||o===void 0?void 0:o.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new re(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new re(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,b.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(of(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...im.turnServerConfigToIceServers(t.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...im.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return b.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!gt().supportSetRtpSenderParameters)return b.warn("Browser not support set rtp-sender parameters");const s={},o={};if(t instanceof tn)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(V("DSCP_TYPE")&&La()){var c;const f=V("DSCP_TYPE");ve(c=["very-low","low","medium","high"]).call(c,f)&&(o.networkPriority=f)}const d=n.getParameters(),p=(i=d.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,o),Object.assign(d,s),b.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!gt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];s&&o&&await this.updateRtpSenderEncodings(o,s)}}catch{b.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=ls(t);return n.forEach((s,o)=>{const c=s._mediaStreamTrack,d=i.mediaDescriptions.find(p=>p.attributes.mid===c.kind);d&&sh(d,s)}),kc(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((o,c)=>{let{id:d,mslabel:p}=o;const{kind:f}=t[c];return new Te((m,g)=>{const v=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(d)))},1e4),y=D=>{const A=Et();if(A.name==="Safari"&&Number(A.version)===11&&D.track.id!==d&&D.streams[0].id===p){var I;const k=D.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(f,d,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:k,id:d})}if(D.track.id===d)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:D.track,id:d})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await Te.all(n)}catch(n){throw new re(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(gt().supportPCSetConfiguration){const n=im.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},De(Ht.prototype,"connect",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"connect"),Ht.prototype),De(Ht.prototype,"stopSending",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"stopSending"),Ht.prototype),De(Ht.prototype,"receive",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"receive"),Ht.prototype),De(Ht.prototype,"stopReceiving",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"stopReceiving"),Ht.prototype),De(Ht.prototype,"muteRemote",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),De(Ht.prototype,"unmuteRemote",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),De(Ht.prototype,"muteLocal",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"muteLocal"),Ht.prototype),De(Ht.prototype,"unmuteLocal",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteLocal"),Ht.prototype),De(Ht.prototype,"close",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"close"),Ht.prototype),De(Ht.prototype,"updateEncoderConfig",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"updateEncoderConfig"),Ht.prototype),De(Ht.prototype,"updateSendParameters",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"updateSendParameters"),Ht.prototype),De(Ht.prototype,"replaceTrack",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"replaceTrack"),Ht.prototype),De(Ht.prototype,"getRemoteSSRC",[pr],Object.getOwnPropertyDescriptor(Ht.prototype,"getRemoteSSRC"),Ht.prototype),Ht);function pr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),p=0;p<c;p++)d[p]=arguments[p];return await i.apply(this,d)}finally{o()}},n}const qY={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new YY(n,t)}};fR(),xt("PROCESS_ID","process-".concat(Yt(8,""),"-").concat(Yt(4,""),"-").concat(Yt(4,""),"-").concat(Yt(4,""),"-").concat(Yt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void b.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();b.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(un,i)){const{value:s,expires:o}=t[i];if(o&&o<=n)return;po[i]=s,un[i]=s}})}catch(t){b.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(po.AREAS)&&po.AREAS.length>0&&sw(po.AREAS,!0);const ZU=(e,t,n)=>{b.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),xt(e,t,n)};Jl(vY,!1),Jl(yY,!1),Jl(rz,!1),Jl(LY,!1),Jl(_Y,!1),Jl(KY,!1),Jl(qY,!1);const Un=function(e){const t=new dn,n=e,i={getListeners:t.getListeners.bind(t),on:(s,o)=>(function(c,d){c===Yo.SECURITY_POLICY_VIOLATION&&Dj(d,!0)}(s,o),t.on.bind(t)(s,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return Nj(Nj({},n),i)}({__TRACK_LIST__:Vu,VERSION:or,BUILD:ER,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:ZU,getParameter:V,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let s;return gt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),s=(await i.createOffer()).sdp):s=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(t);if(!n)return e;t.close(),t=null,e=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(n)}catch(t){throw new Q(L.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=xe.reportApiInvoke(null,{name:Mn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:fn.TRACER});let t=!1;try{const o=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,d=window.WebSocket;t=!!(o&&c&&d),t&&ZC()&&t1(75)&&new o().close()}catch(o){return b.error("check system requirement failed: ",o),!1}let n=!1;const i=Et();i.name===bt.CHROME&&Number(i.version)>=58&&(uo.engine.name!=="WebKit"||function(){const o=Et();if(ng()){if(o.os===Kn.MAC_OS)return!0;if(o.os===Kn.IOS){const c=uo.os.version&&uo.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===bt.FIREFOX&&Number(i.version)>=56||i.name===bt.OPERA&&Number(i.version)>=45||i.name===bt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Hi()||Pr())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||a1()||Et().name===bt.QQ)&&(n=!0),b.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return zs.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return zs.getRecordingDevices(e)},getCameras:function(e){return zs.getCamerasDevices(e)},getElectronScreenSources:Z1,getPlaybackDevices:function(e){return zs.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Yt(5,"client-"),i=xe.reportApiInvoke(null,{id:n,name:Mn.CREATE_CLIENT,options:[t],tag:fn.TRACER});try{(function(s){Wn(s.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Wn(s.mode,"config.mode",["rtc","live","p2p"]),s.audioCodec!==void 0&&Wn(s.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),s.proxyServer!==void 0&&ai(s.proxyServer,"config.proxyServer",1,1e4),s.turnServer!==void 0&&m1(s.turnServer),s.httpRetryConfig!==void 0&&f1(s.httpRetryConfig),s.websocketRetryConfig!==void 0&&f1(s.websocketRetryConfig)})(t)}catch(s){throw i.onError(s),s}return(i1(16,0)||s1(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",b.debug("browser not support vp9, force use vp8")),xt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new oz(Fr(Fr({forceWaitGatewayResponse:!0},t),{},{role:ve(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=V("CAMERA_CAPTURE_CONFIG"),n=Yt(8,"track-cam-"),i=xe.reportApiInvoke(null,{id:n,tag:fn.TRACER,name:Mn.CREATE_CAM_VIDEO_TRACK,options:[rn({},e),t]});t&&(e.encoderConfig=t);const s=Eg(e);let o=null;b.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await Ks({video:s},n)).getVideoTracks()[0]||null}catch(d){throw i.onError(d),d}if(!o){const d=new re(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(d),d.throw(b)}e.optimizationMode&&xR(n,o,e,Wo(e.encoderConfig));const c=new LR(o,e,s,e.scalabiltyMode?pg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(c.getTrackId()),b.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(e){const t=Yt(8,"track-cus-"),n=xe.reportApiInvoke(null,{id:t,tag:fn.TRACER,name:Mn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new tn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?pg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[qt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),b.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(v){return lL(v)}(t):void 0;n&&(t="auto");const i=Yt(8,"track-scr-v-"),s=xe.reportApiInvoke(null,{id:i,tag:fn.TRACER,name:Mn.CREATE_SCREEN_VIDEO_TRACK,options:[rn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const o=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&Pa()&&(y.extensionId=v.extensionId);const{displaySurface:D,selfBrowserSurface:A,surfaceSwitching:I,systemAudio:k,preferCurrentTab:M}=v;(Pu(107)||JC(107)||XC(93))&&(D&&(Wn(D,"displaySurface",["browser","window","monitor"]),y.displaySurface=D),A?(Wn(A,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=A):y.selfBrowserSurface="include",I&&(Wn(I,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=I)),(Pu(105)||JC(105)||XC(91))&&k&&(Wn(k,"systemAudio",["exclude","include"]),y.systemAudio=k),(Pu(94)||JC(94)||XC(80))&&M&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const H=v.encoderConfig?yR(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:H?H.width:void 0,maxHeight:H?H.height:void 0},H&&(H.frameRate&&(typeof H.frameRate=="number"?(y.mandatory.maxFrameRate=H.frameRate,y.mandatory.minFrameRate=H.frameRate):(y.mandatory.maxFrameRate=H.frameRate.max||H.frameRate.ideal||H.frameRate.exact||void 0,y.mandatory.minFrameRate=H.frameRate.min||H.frameRate.ideal||H.frameRate.exact||void 0),y.frameRate=H.frameRate),H.width&&(y.width=H.width),H.height&&(y.height=H.height)),y}(e);let c=null,d=null;const p=gt();if(!p.supportShareAudio&&t==="enable"){const v=new re(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(v),v.throw(b)}b.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const f=p.supportShareAudio&&t!=="disable";try{const v=await Ks({screen:o,screenAudio:f?n||!0:void 0},i);c=v.getVideoTracks()[0]||null,d=v.getAudioTracks()[0]||null}catch(v){throw s.onError(v),v}if(!c){const v=new re(L.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(v),v.throw(b)}if(!d&&t==="enable"){c&&c.stop();const v=new re(L.SHARE_AUDIO_NOT_ALLOWED);return s.onError(v),v.throw(b)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(xR(i,c,e,e.encoderConfig&&yR(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new tn(c,e.encoderConfig?yR(e.encoderConfig):{},e.scalabiltyMode?pg(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[qt.SCREEN_TRACK]);if(!d)return s.onSuccess(m.getTrackId()),b.info("create screen video track success","video:",m.getTrackId()),m;const g=new gn(d,void 0,Yt(8,"track-scr-a-"),!1);return s.onSuccess([m.getTrackId(),g.getTrackId()]),b.info("create screen video track success","video:",m.getTrackId(),"audio:",g.getTrackId()),[m,g]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=V("CAMERA_CAPTURE_CONFIG"),i=Yt(8,"track-mic-"),s=Yt(8,"track-cam-"),o=xe.reportApiInvoke(null,{id:"".concat(i,"-").concat(s),tag:fn.TRACER,name:Mn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const c=Eg(t),d=dL(e);let p=null,f=null;b.info("start create camera video track(".concat(s,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const v=await Ks({audio:d,video:c},"".concat(i,"-").concat(s));p=v.getAudioTracks()[0],f=v.getVideoTracks()[0]}catch(v){throw o.onError(v),v}if(!p||!f){const v=new re(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(v),v.throw(b)}t.optimizationMode&&xR(s,f,t,Wo(t.encoderConfig));const m=new gg(p,e,d,i),g=new LR(f,t,c,t.scalabiltyMode?pg(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess([m.getTrackId(),g.getTrackId()]),b.info("create camera video track(".concat(s,") and microphone audio track(").concat(i,") success")),[m,g]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Yt(8,"track-mic-"),n=xe.reportApiInvoke(null,{id:t,tag:fn.TRACER,name:Mn.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=dL(e);let s=null;b.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{s=(await Ks({audio:i},t)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!s){const c=new re(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(b)}const o=new gg(s,e,i,t);return n.onSuccess(o.getTrackId()),b.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){const t=Yt(8,"track-cus-"),n=xe.reportApiInvoke(null,{id:t,tag:fn.TRACER,name:Mn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new gn(e.mediaStreamTrack,e.encoderConfig?fg(e.encoderConfig):{},t,!1);return b.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:s}=e;const o={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:n,encoderConfig:i},c=Yt(8,"track-buf-"),d=xe.reportApiInvoke(null,{id:c,tag:fn.TRACER,name:Mn.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(V("DISABLE_WEBAUDIO"))throw new re(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");b.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",c);const p=s;if(!(s instanceof AudioBuffer))try{s=await async function(g,v){let y=null;if(typeof g=="string"){const A=JL.get(g);if(A)return b.debug("use cached audio resource: ",g),A;try{y=(await ho(()=>Zi.get(g,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(I){throw new re(L.FETCH_AUDIO_FILE_FAILED,I.toString())}}else y=await new Te((I,k)=>{const M=new FileReader;M.onload=H=>{H.target?I(H.target.result):k(new re(L.READ_LOCAL_AUDIO_FILE_ERROR))},M.onerror=()=>{k(new re(L.READ_LOCAL_AUDIO_FILE_ERROR))},M.readAsArrayBuffer(g)});const D=await function(A){const I=Ku();return new Te((k,M)=>{I.decodeAudioData(A,H=>{k(H)},H=>{M(new re(L.DECODE_AUDIO_FILE_FAILED,H.toString()))})})}(y);return typeof g=="string"&&v&&JL.set(g,D),D}(s,n)}catch(g){return d.onError(g),g.throw(b)}const f=new w7(s),m=new R7(p,f,i?fg(i):{},c);return b.info("create buffer source audio track success, trackId:",c),d.onSuccess(m.getTrackId()),m},setAppType:function(e){if(b.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw b.debug("Invalid appType"),new Q(L.INVALID_PARAMS,"invalid app type",e);xt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){b.setLogLevel(e)},enableLogUpload:function(){V("USE_NEW_LOG")?xt("UPLOAD_LOG",!0):b.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?xt("UPLOAD_LOG",!1):b.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Yk},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=xe.reportApiInvoke(null,{tag:fn.TRACER,name:Mn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof gn||e instanceof qu)){const p=new Q(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof gn?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let o=s,c=s;const d=Date.now();return new Te(p=>{const f=setInterval(()=>{const m=e.getVolumeLevel();o=m>o?m:o,c=m<c?m:c;const g=o-c>1e-4,v=Date.now()-d;if(g||v>t){clearInterval(f);const y=g,D={duration:v,deviceLabel:i,maxVolumeLevel:o,result:y};b.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),p(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=xe.reportApiInvoke(null,{tag:fn.TRACER,name:Mn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof tn||e instanceof Yu)){const g=new Q(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof tn?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(hi()||ng())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([s]),o.play();const c=document.createElement("canvas");c.width=160,c.height=120;let d=0,p=0;try{const g=Date.now();d=await function(v,y,D,A){let I,k=0,M=null;return new Te((H,J)=>{function $(){k>A&&I&&(I(),H(k));const z=D.getContext("2d");if(!z){const be=new Q(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return b.error(be.toString()),void J(be)}z.drawImage(v,0,0,160,120);const oe=z.getImageData(0,0,D.width,D.height),de=Math.floor(oe.data.length/3);if(M){for(let be=0;be<de;be+=3)if(oe.data[be]!==M[be])return k+=1,void(M=oe.data);M=oe.data}else M=oe.data}setTimeout(()=>{I&&(I(),H(k))},y),I=AR(()=>{$()},30)})}(o,t,c,4),p=Date.now()-g}catch(g){throw n.onError(g),g}YK===bt.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const f=d>4,m={duration:p,changedPicNum:d,deviceLabel:i,result:f};return b.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),f},setArea:sw,audioElementPlayCenter:es,resumeAudioContext:function(){es.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){cz.processExternalMediaAEC(e)},registerExtensions:function(e){const t=V("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ve(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=b.extLog,i.reporter.hookApiInvoke=xe.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=V(s)})}),ZU("PLUGIN_INFO",t)},ChannelMediaRelayError:Qu,ChannelMediaRelayEvent:Ua,ChannelMediaRelayState:ds,RemoteStreamFallbackType:g7,RemoteStreamType:E7,ConnectionDisconnectedReason:wt,AudienceLatencyLevelType:q9,AREAS:St,preload:async function(e,t,n,i){return SM(e,t,n,i)}});return Object.defineProperties(Un,{onAudioAutoplayFailed:{get:()=>Ys.onAudioAutoplayFailed,set:e=>{Ys.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ys.onAutoplayFailed,set:e=>{Ys.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Un._onSecurityPolicyViolation,set(e){Un._onSecurityPolicyViolation=e,Dj(e)}},__CLIENT_LIST__:{get:()=>V("SHOW_GLOBAL_CLIENT_LIST")?Yl:[]}}),zs.on(Hl.CAMERA_DEVICE_CHANGED,e=>{b.info("camera device changed",JSON.stringify(e)),Un.onCameraChanged&&Un.onCameraChanged(e),Un.safeEmit(Yo.CAMERA_CHANGED,e)}),zs.on(Hl.RECORDING_DEVICE_CHANGED,e=>{b.info("microphone device changed",JSON.stringify(e)),Un.onMicrophoneChanged&&Un.onMicrophoneChanged(e),Un.safeEmit(Yo.MICROPHONE_CHANGED,e)}),zs.on(Hl.PLAYOUT_DEVICE_CHANGED,e=>{b.debug("playout device changed",JSON.stringify(e)),Un.onPlaybackDeviceChanged&&Un.onPlaybackDeviceChanged(e),Un.safeEmit(Yo.PLAYBACK_DEVICE_CHANGED,e)}),es.onAutoplayFailed=()=>{b.info("detect audio element autoplay failed"),Ys.onAudioAutoplayFailed&&Ys.onAudioAutoplayFailed()},kt.on("autoplay-failed",()=>{b.info("detect webaudio autoplay failed"),Ys.onAudioAutoplayFailed&&Ys.onAudioAutoplayFailed(),Un.safeEmit(Yo.AUTOPLAY_FAILED)}),kt.on(di.STATE_CHANGE,(e,t)=>{b.info("audio context state changed: ".concat(t," => ").concat(e)),Un.onAudioContextStateChanged&&Un.onAudioContextStateChanged(e,t),Un.safeEmit(Yo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Nn.on(xu.NETWORK_STATE_CHANGE,(e,t)=>{b.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Un),Un})})(MB);var mee=MB.exports;const Zf=$A(mee),la=Object.create(null);la.open="0";la.close="1";la.ping="2";la.pong="3";la.message="4";la.upgrade="5";la.noop="6";const Ov=Object.create(null);Object.keys(la).forEach(a=>{Ov[la[a]]=a});const GA={type:"error",data:"parser error"},VB=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",FB=typeof ArrayBuffer=="function",BB=a=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(a):a&&a.buffer instanceof ArrayBuffer,lI=({type:a,data:r},l,u)=>VB&&r instanceof Blob?l?u(r):eF(r,u):FB&&(r instanceof ArrayBuffer||BB(r))?l?u(r):eF(new Blob([r]),u):u(la[a]+(r||"")),eF=(a,r)=>{const l=new FileReader;return l.onload=function(){const u=l.result.split(",")[1];r("b"+(u||""))},l.readAsDataURL(a)};function tF(a){return a instanceof Uint8Array?a:a instanceof ArrayBuffer?new Uint8Array(a):new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}let mA;function _ee(a,r){if(VB&&a.data instanceof Blob)return a.data.arrayBuffer().then(tF).then(r);if(FB&&(a.data instanceof ArrayBuffer||BB(a.data)))return r(tF(a.data));lI(a,!1,l=>{mA||(mA=new TextEncoder),r(mA.encode(l))})}const nF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",sm=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let a=0;a<nF.length;a++)sm[nF.charCodeAt(a)]=a;const Eee=a=>{let r=a.length*.75,l=a.length,u,_=0,E,T,R,w;a[a.length-1]==="="&&(r--,a[a.length-2]==="="&&r--);const j=new ArrayBuffer(r),P=new Uint8Array(j);for(u=0;u<l;u+=4)E=sm[a.charCodeAt(u)],T=sm[a.charCodeAt(u+1)],R=sm[a.charCodeAt(u+2)],w=sm[a.charCodeAt(u+3)],P[_++]=E<<2|T>>4,P[_++]=(T&15)<<4|R>>2,P[_++]=(R&3)<<6|w&63;return j},gee=typeof ArrayBuffer=="function",dI=(a,r)=>{if(typeof a!="string")return{type:"message",data:GB(a,r)};const l=a.charAt(0);return l==="b"?{type:"message",data:vee(a.substring(1),r)}:Ov[l]?a.length>1?{type:Ov[l],data:a.substring(1)}:{type:Ov[l]}:GA},vee=(a,r)=>{if(gee){const l=Eee(a);return GB(l,r)}else return{base64:!0,data:a}},GB=(a,r)=>{switch(r){case"blob":return a instanceof Blob?a:new Blob([a]);case"arraybuffer":default:return a instanceof ArrayBuffer?a:a.buffer}},HB="",See=(a,r)=>{const l=a.length,u=new Array(l);let _=0;a.forEach((E,T)=>{lI(E,!1,R=>{u[T]=R,++_===l&&r(u.join(HB))})})},Tee=(a,r)=>{const l=a.split(HB),u=[];for(let _=0;_<l.length;_++){const E=dI(l[_],r);if(u.push(E),E.type==="error")break}return u};function yee(){return new TransformStream({transform(a,r){_ee(a,l=>{const u=l.length;let _;if(u<126)_=new Uint8Array(1),new DataView(_.buffer).setUint8(0,u);else if(u<65536){_=new Uint8Array(3);const E=new DataView(_.buffer);E.setUint8(0,126),E.setUint16(1,u)}else{_=new Uint8Array(9);const E=new DataView(_.buffer);E.setUint8(0,127),E.setBigUint64(1,BigInt(u))}a.data&&typeof a.data!="string"&&(_[0]|=128),r.enqueue(_),r.enqueue(l)})}})}let _A;function bv(a){return a.reduce((r,l)=>r+l.length,0)}function Cv(a,r){if(a[0].length===r)return a.shift();const l=new Uint8Array(r);let u=0;for(let _=0;_<r;_++)l[_]=a[0][u++],u===a[0].length&&(a.shift(),u=0);return a.length&&u<a[0].length&&(a[0]=a[0].slice(u)),l}function bee(a,r){_A||(_A=new TextDecoder);const l=[];let u=0,_=-1,E=!1;return new TransformStream({transform(T,R){for(l.push(T);;){if(u===0){if(bv(l)<1)break;const w=Cv(l,1);E=(w[0]&128)===128,_=w[0]&127,_<126?u=3:_===126?u=1:u=2}else if(u===1){if(bv(l)<2)break;const w=Cv(l,2);_=new DataView(w.buffer,w.byteOffset,w.length).getUint16(0),u=3}else if(u===2){if(bv(l)<8)break;const w=Cv(l,8),j=new DataView(w.buffer,w.byteOffset,w.length),P=j.getUint32(0);if(P>Math.pow(2,21)-1){R.enqueue(GA);break}_=P*Math.pow(2,32)+j.getUint32(4),u=3}else{if(bv(l)<_)break;const w=Cv(l,_);R.enqueue(dI(E?w:_A.decode(w),r)),u=0}if(_===0||_>a){R.enqueue(GA);break}}}})}const WB=4;function Oi(a){if(a)return Cee(a)}function Cee(a){for(var r in Oi.prototype)a[r]=Oi.prototype[r];return a}Oi.prototype.on=Oi.prototype.addEventListener=function(a,r){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(r),this};Oi.prototype.once=function(a,r){function l(){this.off(a,l),r.apply(this,arguments)}return l.fn=r,this.on(a,l),this};Oi.prototype.off=Oi.prototype.removeListener=Oi.prototype.removeAllListeners=Oi.prototype.removeEventListener=function(a,r){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var l=this._callbacks["$"+a];if(!l)return this;if(arguments.length==1)return delete this._callbacks["$"+a],this;for(var u,_=0;_<l.length;_++)if(u=l[_],u===r||u.fn===r){l.splice(_,1);break}return l.length===0&&delete this._callbacks["$"+a],this};Oi.prototype.emit=function(a){this._callbacks=this._callbacks||{};for(var r=new Array(arguments.length-1),l=this._callbacks["$"+a],u=1;u<arguments.length;u++)r[u-1]=arguments[u];if(l){l=l.slice(0);for(var u=0,_=l.length;u<_;++u)l[u].apply(this,r)}return this};Oi.prototype.emitReserved=Oi.prototype.emit;Oi.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};Oi.prototype.hasListeners=function(a){return!!this.listeners(a).length};const rS=typeof Promise=="function"&&typeof Promise.resolve=="function"?r=>Promise.resolve().then(r):(r,l)=>l(r,0),Wr=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Ree="arraybuffer";function KB(a,...r){return r.reduce((l,u)=>(a.hasOwnProperty(u)&&(l[u]=a[u]),l),{})}const wee=Wr.setTimeout,Aee=Wr.clearTimeout;function oS(a,r){r.useNativeTimers?(a.setTimeoutFn=wee.bind(Wr),a.clearTimeoutFn=Aee.bind(Wr)):(a.setTimeoutFn=Wr.setTimeout.bind(Wr),a.clearTimeoutFn=Wr.clearTimeout.bind(Wr))}const Iee=1.33;function Oee(a){return typeof a=="string"?Nee(a):Math.ceil((a.byteLength||a.size)*Iee)}function Nee(a){let r=0,l=0;for(let u=0,_=a.length;u<_;u++)r=a.charCodeAt(u),r<128?l+=1:r<2048?l+=2:r<55296||r>=57344?l+=3:(u++,l+=4);return l}function zB(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Dee(a){let r="";for(let l in a)a.hasOwnProperty(l)&&(r.length&&(r+="&"),r+=encodeURIComponent(l)+"="+encodeURIComponent(a[l]));return r}function Pee(a){let r={},l=a.split("&");for(let u=0,_=l.length;u<_;u++){let E=l[u].split("=");r[decodeURIComponent(E[0])]=decodeURIComponent(E[1])}return r}class Lee extends Error{constructor(r,l,u){super(r),this.description=l,this.context=u,this.type="TransportError"}}class uI extends Oi{constructor(r){super(),this.writable=!1,oS(this,r),this.opts=r,this.query=r.query,this.socket=r.socket,this.supportsBinary=!r.forceBase64}onError(r,l,u){return super.emitReserved("error",new Lee(r,l,u)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(r){this.readyState==="open"&&this.write(r)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(r){const l=dI(r,this.socket.binaryType);this.onPacket(l)}onPacket(r){super.emitReserved("packet",r)}onClose(r){this.readyState="closed",super.emitReserved("close",r)}pause(r){}createUri(r,l={}){return r+"://"+this._hostname()+this._port()+this.opts.path+this._query(l)}_hostname(){const r=this.opts.hostname;return r.indexOf(":")===-1?r:"["+r+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(r){const l=Dee(r);return l.length?"?"+l:""}}class xee extends uI{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(r){this.readyState="pausing";const l=()=>{this.readyState="paused",r()};if(this._polling||!this.writable){let u=0;this._polling&&(u++,this.once("pollComplete",function(){--u||l()})),this.writable||(u++,this.once("drain",function(){--u||l()}))}else l()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(r){const l=u=>{if(this.readyState==="opening"&&u.type==="open"&&this.onOpen(),u.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(u)};Tee(r,this.socket.binaryType).forEach(l),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const r=()=>{this.write([{type:"close"}])};this.readyState==="open"?r():this.once("open",r)}write(r){this.writable=!1,See(r,l=>{this.doWrite(l,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const r=this.opts.secure?"https":"http",l=this.query||{};return this.opts.timestampRequests!==!1&&(l[this.opts.timestampParam]=zB()),!this.supportsBinary&&!l.sid&&(l.b64=1),this.createUri(r,l)}}let YB=!1;try{YB=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const kee=YB;function Mee(){}class jee extends xee{constructor(r){if(super(r),typeof location<"u"){const l=location.protocol==="https:";let u=location.port;u||(u=l?"443":"80"),this.xd=typeof location<"u"&&r.hostname!==location.hostname||u!==r.port}}doWrite(r,l){const u=this.request({method:"POST",data:r});u.on("success",l),u.on("error",(_,E)=>{this.onError("xhr post error",_,E)})}doPoll(){const r=this.request();r.on("data",this.onData.bind(this)),r.on("error",(l,u)=>{this.onError("xhr poll error",l,u)}),this.pollXhr=r}}let bh=class Nv extends Oi{constructor(r,l,u){super(),this.createRequest=r,oS(this,u),this._opts=u,this._method=u.method||"GET",this._uri=l,this._data=u.data!==void 0?u.data:null,this._create()}_create(){var r;const l=KB(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");l.xdomain=!!this._opts.xd;const u=this._xhr=this.createRequest(l);try{u.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){u.setDisableHeaderCheck&&u.setDisableHeaderCheck(!0);for(let _ in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(_)&&u.setRequestHeader(_,this._opts.extraHeaders[_])}}catch{}if(this._method==="POST")try{u.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{u.setRequestHeader("Accept","*/*")}catch{}(r=this._opts.cookieJar)===null||r===void 0||r.addCookies(u),"withCredentials"in u&&(u.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(u.timeout=this._opts.requestTimeout),u.onreadystatechange=()=>{var _;u.readyState===3&&((_=this._opts.cookieJar)===null||_===void 0||_.parseCookies(u.getResponseHeader("set-cookie"))),u.readyState===4&&(u.status===200||u.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof u.status=="number"?u.status:0)},0))},u.send(this._data)}catch(_){this.setTimeoutFn(()=>{this._onError(_)},0);return}typeof document<"u"&&(this._index=Nv.requestsCount++,Nv.requests[this._index]=this)}_onError(r){this.emitReserved("error",r,this._xhr),this._cleanup(!0)}_cleanup(r){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Mee,r)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Nv.requests[this._index],this._xhr=null}}_onLoad(){const r=this._xhr.responseText;r!==null&&(this.emitReserved("data",r),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};bh.requestsCount=0;bh.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",iF);else if(typeof addEventListener=="function"){const a="onpagehide"in Wr?"pagehide":"unload";addEventListener(a,iF,!1)}}function iF(){for(let a in bh.requests)bh.requests.hasOwnProperty(a)&&bh.requests[a].abort()}const Uee=function(){const a=qB({xdomain:!1});return a&&a.responseType!==null}();class Vee extends jee{constructor(r){super(r);const l=r&&r.forceBase64;this.supportsBinary=Uee&&!l}request(r={}){return Object.assign(r,{xd:this.xd},this.opts),new bh(qB,this.uri(),r)}}function qB(a){const r=a.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!r||kee))return new XMLHttpRequest}catch{}if(!r)try{return new Wr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const $B=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Fee extends uI{get name(){return"websocket"}doOpen(){const r=this.uri(),l=this.opts.protocols,u=$B?{}:KB(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(u.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(r,l,u)}catch(_){return this.emitReserved("error",_)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=r=>this.onClose({description:"websocket connection closed",context:r}),this.ws.onmessage=r=>this.onData(r.data),this.ws.onerror=r=>this.onError("websocket error",r)}write(r){this.writable=!1;for(let l=0;l<r.length;l++){const u=r[l],_=l===r.length-1;lI(u,this.supportsBinary,E=>{try{this.doWrite(u,E)}catch{}_&&rS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const r=this.opts.secure?"wss":"ws",l=this.query||{};return this.opts.timestampRequests&&(l[this.opts.timestampParam]=zB()),this.supportsBinary||(l.b64=1),this.createUri(r,l)}}const EA=Wr.WebSocket||Wr.MozWebSocket;class Bee extends Fee{createSocket(r,l,u){return $B?new EA(r,l,u):l?new EA(r,l):new EA(r)}doWrite(r,l){this.ws.send(l)}}class Gee extends uI{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(r){return this.emitReserved("error",r)}this._transport.closed.then(()=>{this.onClose()}).catch(r=>{this.onError("webtransport error",r)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(r=>{const l=bee(Number.MAX_SAFE_INTEGER,this.socket.binaryType),u=r.readable.pipeThrough(l).getReader(),_=yee();_.readable.pipeTo(r.writable),this._writer=_.writable.getWriter();const E=()=>{u.read().then(({done:R,value:w})=>{R||(this.onPacket(w),E())}).catch(R=>{})};E();const T={type:"open"};this.query.sid&&(T.data=`{"sid":"${this.query.sid}"}`),this._writer.write(T).then(()=>this.onOpen())})})}write(r){this.writable=!1;for(let l=0;l<r.length;l++){const u=r[l],_=l===r.length-1;this._writer.write(u).then(()=>{_&&rS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var r;(r=this._transport)===null||r===void 0||r.close()}}const Hee={websocket:Bee,webtransport:Gee,polling:Vee},Wee=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Kee=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function HA(a){if(a.length>8e3)throw"URI too long";const r=a,l=a.indexOf("["),u=a.indexOf("]");l!=-1&&u!=-1&&(a=a.substring(0,l)+a.substring(l,u).replace(/:/g,";")+a.substring(u,a.length));let _=Wee.exec(a||""),E={},T=14;for(;T--;)E[Kee[T]]=_[T]||"";return l!=-1&&u!=-1&&(E.source=r,E.host=E.host.substring(1,E.host.length-1).replace(/;/g,":"),E.authority=E.authority.replace("[","").replace("]","").replace(/;/g,":"),E.ipv6uri=!0),E.pathNames=zee(E,E.path),E.queryKey=Yee(E,E.query),E}function zee(a,r){const l=/\/{2,9}/g,u=r.replace(l,"/").split("/");return(r.slice(0,1)=="/"||r.length===0)&&u.splice(0,1),r.slice(-1)=="/"&&u.splice(u.length-1,1),u}function Yee(a,r){const l={};return r.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(u,_,E){_&&(l[_]=E)}),l}const WA=typeof addEventListener=="function"&&typeof removeEventListener=="function",Dv=[];WA&&addEventListener("offline",()=>{Dv.forEach(a=>a())},!1);class sl extends Oi{constructor(r,l){if(super(),this.binaryType=Ree,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,r&&typeof r=="object"&&(l=r,r=null),r){const u=HA(r);l.hostname=u.host,l.secure=u.protocol==="https"||u.protocol==="wss",l.port=u.port,u.query&&(l.query=u.query)}else l.host&&(l.hostname=HA(l.host).host);oS(this,l),this.secure=l.secure!=null?l.secure:typeof location<"u"&&location.protocol==="https:",l.hostname&&!l.port&&(l.port=this.secure?"443":"80"),this.hostname=l.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=l.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},l.transports.forEach(u=>{const _=u.prototype.name;this.transports.push(_),this._transportsByName[_]=u}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},l),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Pee(this.opts.query)),WA&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Dv.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(r){const l=Object.assign({},this.opts.query);l.EIO=WB,l.transport=r,this.id&&(l.sid=this.id);const u=Object.assign({},this.opts,{query:l,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[r]);return new this._transportsByName[r](u)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const r=this.opts.rememberUpgrade&&sl.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const l=this.createTransport(r);l.open(),this.setTransport(l)}setTransport(r){this.transport&&this.transport.removeAllListeners(),this.transport=r,r.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",l=>this._onClose("transport close",l))}onOpen(){this.readyState="open",sl.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",r),this.emitReserved("heartbeat"),r.type){case"open":this.onHandshake(JSON.parse(r.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const l=new Error("server error");l.code=r.data,this._onError(l);break;case"message":this.emitReserved("data",r.data),this.emitReserved("message",r.data);break}}onHandshake(r){this.emitReserved("handshake",r),this.id=r.sid,this.transport.query.sid=r.sid,this._pingInterval=r.pingInterval,this._pingTimeout=r.pingTimeout,this._maxPayload=r.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const r=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+r,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},r),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const r=this._getWritablePackets();this.transport.send(r),this._prevBufferLen=r.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let l=1;for(let u=0;u<this.writeBuffer.length;u++){const _=this.writeBuffer[u].data;if(_&&(l+=Oee(_)),u>0&&l>this._maxPayload)return this.writeBuffer.slice(0,u);l+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const r=Date.now()>this._pingTimeoutTime;return r&&(this._pingTimeoutTime=0,rS(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),r}write(r,l,u){return this._sendPacket("message",r,l,u),this}send(r,l,u){return this._sendPacket("message",r,l,u),this}_sendPacket(r,l,u,_){if(typeof l=="function"&&(_=l,l=void 0),typeof u=="function"&&(_=u,u=null),this.readyState==="closing"||this.readyState==="closed")return;u=u||{},u.compress=u.compress!==!1;const E={type:r,data:l,options:u};this.emitReserved("packetCreate",E),this.writeBuffer.push(E),_&&this.once("flush",_),this.flush()}close(){const r=()=>{this._onClose("forced close"),this.transport.close()},l=()=>{this.off("upgrade",l),this.off("upgradeError",l),r()},u=()=>{this.once("upgrade",l),this.once("upgradeError",l)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?u():r()}):this.upgrading?u():r()),this}_onError(r){if(sl.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",r),this._onClose("transport error",r)}_onClose(r,l){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),WA&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const u=Dv.indexOf(this._offlineEventListener);u!==-1&&Dv.splice(u,1)}this.readyState="closed",this.id=null,this.emitReserved("close",r,l),this.writeBuffer=[],this._prevBufferLen=0}}}sl.protocol=WB;class qee extends sl{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let r=0;r<this._upgrades.length;r++)this._probe(this._upgrades[r])}_probe(r){let l=this.createTransport(r),u=!1;sl.priorWebsocketSuccess=!1;const _=()=>{u||(l.send([{type:"ping",data:"probe"}]),l.once("packet",U=>{if(!u)if(U.type==="pong"&&U.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",l),!l)return;sl.priorWebsocketSuccess=l.name==="websocket",this.transport.pause(()=>{u||this.readyState!=="closed"&&(P(),this.setTransport(l),l.send([{type:"upgrade"}]),this.emitReserved("upgrade",l),l=null,this.upgrading=!1,this.flush())})}else{const G=new Error("probe error");G.transport=l.name,this.emitReserved("upgradeError",G)}}))};function E(){u||(u=!0,P(),l.close(),l=null)}const T=U=>{const G=new Error("probe error: "+U);G.transport=l.name,E(),this.emitReserved("upgradeError",G)};function R(){T("transport closed")}function w(){T("socket closed")}function j(U){l&&U.name!==l.name&&E()}const P=()=>{l.removeListener("open",_),l.removeListener("error",T),l.removeListener("close",R),this.off("close",w),this.off("upgrading",j)};l.once("open",_),l.once("error",T),l.once("close",R),this.once("close",w),this.once("upgrading",j),this._upgrades.indexOf("webtransport")!==-1&&r!=="webtransport"?this.setTimeoutFn(()=>{u||l.open()},200):l.open()}onHandshake(r){this._upgrades=this._filterUpgrades(r.upgrades),super.onHandshake(r)}_filterUpgrades(r){const l=[];for(let u=0;u<r.length;u++)~this.transports.indexOf(r[u])&&l.push(r[u]);return l}}let $ee=class extends qee{constructor(r,l={}){const u=typeof r=="object"?r:l;(!u.transports||u.transports&&typeof u.transports[0]=="string")&&(u.transports=(u.transports||["polling","websocket","webtransport"]).map(_=>Hee[_]).filter(_=>!!_)),super(r,u)}};function Jee(a,r="",l){let u=a;l=l||typeof location<"u"&&location,a==null&&(a=l.protocol+"//"+l.host),typeof a=="string"&&(a.charAt(0)==="/"&&(a.charAt(1)==="/"?a=l.protocol+a:a=l.host+a),/^(https?|wss?):\/\//.test(a)||(typeof l<"u"?a=l.protocol+"//"+a:a="https://"+a),u=HA(a)),u.port||(/^(http|ws)$/.test(u.protocol)?u.port="80":/^(http|ws)s$/.test(u.protocol)&&(u.port="443")),u.path=u.path||"/";const E=u.host.indexOf(":")!==-1?"["+u.host+"]":u.host;return u.id=u.protocol+"://"+E+":"+u.port+r,u.href=u.protocol+"://"+E+(l&&l.port===u.port?"":":"+u.port),u}const Xee=typeof ArrayBuffer=="function",Qee=a=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(a):a.buffer instanceof ArrayBuffer,JB=Object.prototype.toString,Zee=typeof Blob=="function"||typeof Blob<"u"&&JB.call(Blob)==="[object BlobConstructor]",ete=typeof File=="function"||typeof File<"u"&&JB.call(File)==="[object FileConstructor]";function hI(a){return Xee&&(a instanceof ArrayBuffer||Qee(a))||Zee&&a instanceof Blob||ete&&a instanceof File}function Pv(a,r){if(!a||typeof a!="object")return!1;if(Array.isArray(a)){for(let l=0,u=a.length;l<u;l++)if(Pv(a[l]))return!0;return!1}if(hI(a))return!0;if(a.toJSON&&typeof a.toJSON=="function"&&arguments.length===1)return Pv(a.toJSON(),!0);for(const l in a)if(Object.prototype.hasOwnProperty.call(a,l)&&Pv(a[l]))return!0;return!1}function tte(a){const r=[],l=a.data,u=a;return u.data=KA(l,r),u.attachments=r.length,{packet:u,buffers:r}}function KA(a,r){if(!a)return a;if(hI(a)){const l={_placeholder:!0,num:r.length};return r.push(a),l}else if(Array.isArray(a)){const l=new Array(a.length);for(let u=0;u<a.length;u++)l[u]=KA(a[u],r);return l}else if(typeof a=="object"&&!(a instanceof Date)){const l={};for(const u in a)Object.prototype.hasOwnProperty.call(a,u)&&(l[u]=KA(a[u],r));return l}return a}function nte(a,r){return a.data=zA(a.data,r),delete a.attachments,a}function zA(a,r){if(!a)return a;if(a&&a._placeholder===!0){if(typeof a.num=="number"&&a.num>=0&&a.num<r.length)return r[a.num];throw new Error("illegal attachments")}else if(Array.isArray(a))for(let l=0;l<a.length;l++)a[l]=zA(a[l],r);else if(typeof a=="object")for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(a[l]=zA(a[l],r));return a}const ite=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ste=5;var an;(function(a){a[a.CONNECT=0]="CONNECT",a[a.DISCONNECT=1]="DISCONNECT",a[a.EVENT=2]="EVENT",a[a.ACK=3]="ACK",a[a.CONNECT_ERROR=4]="CONNECT_ERROR",a[a.BINARY_EVENT=5]="BINARY_EVENT",a[a.BINARY_ACK=6]="BINARY_ACK"})(an||(an={}));class rte{constructor(r){this.replacer=r}encode(r){return(r.type===an.EVENT||r.type===an.ACK)&&Pv(r)?this.encodeAsBinary({type:r.type===an.EVENT?an.BINARY_EVENT:an.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let l=""+r.type;return(r.type===an.BINARY_EVENT||r.type===an.BINARY_ACK)&&(l+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(l+=r.nsp+","),r.id!=null&&(l+=r.id),r.data!=null&&(l+=JSON.stringify(r.data,this.replacer)),l}encodeAsBinary(r){const l=tte(r),u=this.encodeAsString(l.packet),_=l.buffers;return _.unshift(u),_}}function sF(a){return Object.prototype.toString.call(a)==="[object Object]"}class pI extends Oi{constructor(r){super(),this.reviver=r}add(r){let l;if(typeof r=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");l=this.decodeString(r);const u=l.type===an.BINARY_EVENT;u||l.type===an.BINARY_ACK?(l.type=u?an.EVENT:an.ACK,this.reconstructor=new ote(l),l.attachments===0&&super.emitReserved("decoded",l)):super.emitReserved("decoded",l)}else if(hI(r)||r.base64)if(this.reconstructor)l=this.reconstructor.takeBinaryData(r),l&&(this.reconstructor=null,super.emitReserved("decoded",l));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+r)}decodeString(r){let l=0;const u={type:Number(r.charAt(0))};if(an[u.type]===void 0)throw new Error("unknown packet type "+u.type);if(u.type===an.BINARY_EVENT||u.type===an.BINARY_ACK){const E=l+1;for(;r.charAt(++l)!=="-"&&l!=r.length;);const T=r.substring(E,l);if(T!=Number(T)||r.charAt(l)!=="-")throw new Error("Illegal attachments");u.attachments=Number(T)}if(r.charAt(l+1)==="/"){const E=l+1;for(;++l&&!(r.charAt(l)===","||l===r.length););u.nsp=r.substring(E,l)}else u.nsp="/";const _=r.charAt(l+1);if(_!==""&&Number(_)==_){const E=l+1;for(;++l;){const T=r.charAt(l);if(T==null||Number(T)!=T){--l;break}if(l===r.length)break}u.id=Number(r.substring(E,l+1))}if(r.charAt(++l)){const E=this.tryParse(r.substr(l));if(pI.isPayloadValid(u.type,E))u.data=E;else throw new Error("invalid payload")}return u}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,l){switch(r){case an.CONNECT:return sF(l);case an.DISCONNECT:return l===void 0;case an.CONNECT_ERROR:return typeof l=="string"||sF(l);case an.EVENT:case an.BINARY_EVENT:return Array.isArray(l)&&(typeof l[0]=="number"||typeof l[0]=="string"&&ite.indexOf(l[0])===-1);case an.ACK:case an.BINARY_ACK:return Array.isArray(l)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ote{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const l=nte(this.reconPack,this.buffers);return this.finishedReconstruction(),l}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ate=Object.freeze(Object.defineProperty({__proto__:null,Decoder:pI,Encoder:rte,get PacketType(){return an},protocol:ste},Symbol.toStringTag,{value:"Module"}));function yo(a,r,l){return a.on(r,l),function(){a.off(r,l)}}const cte=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class XB extends Oi{constructor(r,l,u){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=r,this.nsp=l,u&&u.auth&&(this.auth=u.auth),this._opts=Object.assign({},u),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const r=this.io;this.subs=[yo(r,"open",this.onopen.bind(this)),yo(r,"packet",this.onpacket.bind(this)),yo(r,"error",this.onerror.bind(this)),yo(r,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...r){return r.unshift("message"),this.emit.apply(this,r),this}emit(r,...l){var u,_,E;if(cte.hasOwnProperty(r))throw new Error('"'+r.toString()+'" is a reserved event name');if(l.unshift(r),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(l),this;const T={type:an.EVENT,data:l};if(T.options={},T.options.compress=this.flags.compress!==!1,typeof l[l.length-1]=="function"){const P=this.ids++,U=l.pop();this._registerAckCallback(P,U),T.id=P}const R=(_=(u=this.io.engine)===null||u===void 0?void 0:u.transport)===null||_===void 0?void 0:_.writable,w=this.connected&&!(!((E=this.io.engine)===null||E===void 0)&&E._hasPingExpired());return this.flags.volatile&&!R||(w?(this.notifyOutgoingListeners(T),this.packet(T)):this.sendBuffer.push(T)),this.flags={},this}_registerAckCallback(r,l){var u;const _=(u=this.flags.timeout)!==null&&u!==void 0?u:this._opts.ackTimeout;if(_===void 0){this.acks[r]=l;return}const E=this.io.setTimeoutFn(()=>{delete this.acks[r];for(let R=0;R<this.sendBuffer.length;R++)this.sendBuffer[R].id===r&&this.sendBuffer.splice(R,1);l.call(this,new Error("operation has timed out"))},_),T=(...R)=>{this.io.clearTimeoutFn(E),l.apply(this,R)};T.withError=!0,this.acks[r]=T}emitWithAck(r,...l){return new Promise((u,_)=>{const E=(T,R)=>T?_(T):u(R);E.withError=!0,l.push(E),this.emit(r,...l)})}_addToQueue(r){let l;typeof r[r.length-1]=="function"&&(l=r.pop());const u={id:this._queueSeq++,tryCount:0,pending:!1,args:r,flags:Object.assign({fromQueue:!0},this.flags)};r.push((_,...E)=>u!==this._queue[0]?void 0:(_!==null?u.tryCount>this._opts.retries&&(this._queue.shift(),l&&l(_)):(this._queue.shift(),l&&l(null,...E)),u.pending=!1,this._drainQueue())),this._queue.push(u),this._drainQueue()}_drainQueue(r=!1){if(!this.connected||this._queue.length===0)return;const l=this._queue[0];l.pending&&!r||(l.pending=!0,l.tryCount++,this.flags=l.flags,this.emit.apply(this,l.args))}packet(r){r.nsp=this.nsp,this.io._packet(r)}onopen(){typeof this.auth=="function"?this.auth(r=>{this._sendConnectPacket(r)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(r){this.packet({type:an.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},r):r})}onerror(r){this.connected||this.emitReserved("connect_error",r)}onclose(r,l){this.connected=!1,delete this.id,this.emitReserved("disconnect",r,l),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(r=>{if(!this.sendBuffer.some(u=>String(u.id)===r)){const u=this.acks[r];delete this.acks[r],u.withError&&u.call(this,new Error("socket has been disconnected"))}})}onpacket(r){if(r.nsp===this.nsp)switch(r.type){case an.CONNECT:r.data&&r.data.sid?this.onconnect(r.data.sid,r.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case an.EVENT:case an.BINARY_EVENT:this.onevent(r);break;case an.ACK:case an.BINARY_ACK:this.onack(r);break;case an.DISCONNECT:this.ondisconnect();break;case an.CONNECT_ERROR:this.destroy();const u=new Error(r.data.message);u.data=r.data.data,this.emitReserved("connect_error",u);break}}onevent(r){const l=r.data||[];r.id!=null&&l.push(this.ack(r.id)),this.connected?this.emitEvent(l):this.receiveBuffer.push(Object.freeze(l))}emitEvent(r){if(this._anyListeners&&this._anyListeners.length){const l=this._anyListeners.slice();for(const u of l)u.apply(this,r)}super.emit.apply(this,r),this._pid&&r.length&&typeof r[r.length-1]=="string"&&(this._lastOffset=r[r.length-1])}ack(r){const l=this;let u=!1;return function(..._){u||(u=!0,l.packet({type:an.ACK,id:r,data:_}))}}onack(r){const l=this.acks[r.id];typeof l=="function"&&(delete this.acks[r.id],l.withError&&r.data.unshift(null),l.apply(this,r.data))}onconnect(r,l){this.id=r,this.recovered=l&&this._pid===l,this._pid=l,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(r=>this.emitEvent(r)),this.receiveBuffer=[],this.sendBuffer.forEach(r=>{this.notifyOutgoingListeners(r),this.packet(r)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(r=>r()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:an.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(r){return this.flags.compress=r,this}get volatile(){return this.flags.volatile=!0,this}timeout(r){return this.flags.timeout=r,this}onAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(r),this}prependAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(r),this}offAny(r){if(!this._anyListeners)return this;if(r){const l=this._anyListeners;for(let u=0;u<l.length;u++)if(r===l[u])return l.splice(u,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(r),this}prependAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(r),this}offAnyOutgoing(r){if(!this._anyOutgoingListeners)return this;if(r){const l=this._anyOutgoingListeners;for(let u=0;u<l.length;u++)if(r===l[u])return l.splice(u,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(r){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const l=this._anyOutgoingListeners.slice();for(const u of l)u.apply(this,r.data)}}}function Dh(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}Dh.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var r=Math.random(),l=Math.floor(r*this.jitter*a);a=Math.floor(r*10)&1?a+l:a-l}return Math.min(a,this.max)|0};Dh.prototype.reset=function(){this.attempts=0};Dh.prototype.setMin=function(a){this.ms=a};Dh.prototype.setMax=function(a){this.max=a};Dh.prototype.setJitter=function(a){this.jitter=a};class YA extends Oi{constructor(r,l){var u;super(),this.nsps={},this.subs=[],r&&typeof r=="object"&&(l=r,r=void 0),l=l||{},l.path=l.path||"/socket.io",this.opts=l,oS(this,l),this.reconnection(l.reconnection!==!1),this.reconnectionAttempts(l.reconnectionAttempts||1/0),this.reconnectionDelay(l.reconnectionDelay||1e3),this.reconnectionDelayMax(l.reconnectionDelayMax||5e3),this.randomizationFactor((u=l.randomizationFactor)!==null&&u!==void 0?u:.5),this.backoff=new Dh({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(l.timeout==null?2e4:l.timeout),this._readyState="closed",this.uri=r;const _=l.parser||ate;this.encoder=new _.Encoder,this.decoder=new _.Decoder,this._autoConnect=l.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(r){return arguments.length?(this._reconnection=!!r,r||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(r){return r===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=r,this)}reconnectionDelay(r){var l;return r===void 0?this._reconnectionDelay:(this._reconnectionDelay=r,(l=this.backoff)===null||l===void 0||l.setMin(r),this)}randomizationFactor(r){var l;return r===void 0?this._randomizationFactor:(this._randomizationFactor=r,(l=this.backoff)===null||l===void 0||l.setJitter(r),this)}reconnectionDelayMax(r){var l;return r===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=r,(l=this.backoff)===null||l===void 0||l.setMax(r),this)}timeout(r){return arguments.length?(this._timeout=r,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(r){if(~this._readyState.indexOf("open"))return this;this.engine=new $ee(this.uri,this.opts);const l=this.engine,u=this;this._readyState="opening",this.skipReconnect=!1;const _=yo(l,"open",function(){u.onopen(),r&&r()}),E=R=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",R),r?r(R):this.maybeReconnectOnOpen()},T=yo(l,"error",E);if(this._timeout!==!1){const R=this._timeout,w=this.setTimeoutFn(()=>{_(),E(new Error("timeout")),l.close()},R);this.opts.autoUnref&&w.unref(),this.subs.push(()=>{this.clearTimeoutFn(w)})}return this.subs.push(_),this.subs.push(T),this}connect(r){return this.open(r)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const r=this.engine;this.subs.push(yo(r,"ping",this.onping.bind(this)),yo(r,"data",this.ondata.bind(this)),yo(r,"error",this.onerror.bind(this)),yo(r,"close",this.onclose.bind(this)),yo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(r){try{this.decoder.add(r)}catch(l){this.onclose("parse error",l)}}ondecoded(r){rS(()=>{this.emitReserved("packet",r)},this.setTimeoutFn)}onerror(r){this.emitReserved("error",r)}socket(r,l){let u=this.nsps[r];return u?this._autoConnect&&!u.active&&u.connect():(u=new XB(this,r,l),this.nsps[r]=u),u}_destroy(r){const l=Object.keys(this.nsps);for(const u of l)if(this.nsps[u].active)return;this._close()}_packet(r){const l=this.encoder.encode(r);for(let u=0;u<l.length;u++)this.engine.write(l[u],r.options)}cleanup(){this.subs.forEach(r=>r()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(r,l){var u;this.cleanup(),(u=this.engine)===null||u===void 0||u.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",r,l),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const r=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const l=this.backoff.duration();this._reconnecting=!0;const u=this.setTimeoutFn(()=>{r.skipReconnect||(this.emitReserved("reconnect_attempt",r.backoff.attempts),!r.skipReconnect&&r.open(_=>{_?(r._reconnecting=!1,r.reconnect(),this.emitReserved("reconnect_error",_)):r.onreconnect()}))},l);this.opts.autoUnref&&u.unref(),this.subs.push(()=>{this.clearTimeoutFn(u)})}}onreconnect(){const r=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",r)}}const em={};function Lv(a,r){typeof a=="object"&&(r=a,a=void 0),r=r||{};const l=Jee(a,r.path||"/socket.io"),u=l.source,_=l.id,E=l.path,T=em[_]&&E in em[_].nsps,R=r.forceNew||r["force new connection"]||r.multiplex===!1||T;let w;return R?w=new YA(u,r):(em[_]||(em[_]=new YA(u,r)),w=em[_]),l.query&&!r.query&&(r.query=l.queryKey),w.socket(l.path,r)}Object.assign(Lv,{Manager:YA,Socket:XB,io:Lv,connect:Lv});var QB={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(a){(function(){var r={}.hasOwnProperty;function l(){for(var E="",T=0;T<arguments.length;T++){var R=arguments[T];R&&(E=_(E,u(R)))}return E}function u(E){if(typeof E=="string"||typeof E=="number")return E;if(typeof E!="object")return"";if(Array.isArray(E))return l.apply(null,E);if(E.toString!==Object.prototype.toString&&!E.toString.toString().includes("[native code]"))return E.toString();var T="";for(var R in E)r.call(E,R)&&E[R]&&(T=_(T,R));return T}function _(E,T){return T?E?E+" "+T:E+T:E}a.exports?(l.default=l,a.exports=l):window.classNames=l})()})(QB);var lte=QB.exports;const Fn=$A(lte),dte=["xxl","xl","lg","md","sm","xs"],ute="xs",fI=ee.createContext({prefixes:{},breakpoints:dte,minBreakpoint:ute});function Jn(a,r){const{prefixes:l}=ee.useContext(fI);return a||l[r]||r}function ZB(){const{breakpoints:a}=ee.useContext(fI);return a}function e4(){const{minBreakpoint:a}=ee.useContext(fI);return a}var t4={exports:{}},hte="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",pte=hte,fte=pte;function n4(){}function i4(){}i4.resetWarningCache=n4;var mte=function(){function a(u,_,E,T,R,w){if(w!==fte){var j=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw j.name="Invariant Violation",j}}a.isRequired=a;function r(){return a}var l={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:r,element:a,elementType:a,instanceOf:r,node:a,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:i4,resetWarningCache:n4};return l.PropTypes=l,l};t4.exports=mte();var _te=t4.exports;const Ch=$A(_te),s4=a=>ee.forwardRef((r,l)=>h.jsx("div",{...r,ref:l,className:Fn(r.className,a)})),Ete=["as","disabled"];function gte(a,r){if(a==null)return{};var l={};for(var u in a)if({}.hasOwnProperty.call(a,u)){if(r.indexOf(u)>=0)continue;l[u]=a[u]}return l}function vte(a){return!a||a.trim()==="#"}function r4({tagName:a,disabled:r,href:l,target:u,rel:_,role:E,onClick:T,tabIndex:R=0,type:w}){a||(l!=null||u!=null||_!=null?a="a":a="button");const j={tagName:a};if(a==="button")return[{type:w||"button",disabled:r},j];const P=G=>{if((r||a==="a"&&vte(l))&&G.preventDefault(),r){G.stopPropagation();return}T==null||T(G)},U=G=>{G.key===" "&&(G.preventDefault(),P(G))};return a==="a"&&(l||(l="#"),r&&(l=void 0)),[{role:E??"button",disabled:void 0,tabIndex:r?void 0:R,href:l,target:a==="a"?u:void 0,"aria-disabled":r||void 0,rel:a==="a"?_:void 0,onClick:P,onKeyDown:U},j]}const Ste=ee.forwardRef((a,r)=>{let{as:l,disabled:u}=a,_=gte(a,Ete);const[E,{tagName:T}]=r4(Object.assign({tagName:l,disabled:u},_));return h.jsx(T,Object.assign({},_,E,{ref:r}))});Ste.displayName="Button";const qA=ee.forwardRef(({as:a,bsPrefix:r,variant:l="primary",size:u,active:_=!1,disabled:E=!1,className:T,...R},w)=>{const j=Jn(r,"btn"),[P,{tagName:U}]=r4({tagName:a,disabled:E,...R}),G=U;return h.jsx(G,{...P,...R,ref:w,disabled:E,className:Fn(T,j,_&&"active",l&&`${j}-${l}`,u&&`${j}-${u}`,R.href&&E&&"disabled")})});qA.displayName="Button";const mI=ee.forwardRef(({className:a,bsPrefix:r,as:l="div",...u},_)=>(r=Jn(r,"card-body"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));mI.displayName="CardBody";const o4=ee.forwardRef(({className:a,bsPrefix:r,as:l="div",...u},_)=>(r=Jn(r,"card-footer"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));o4.displayName="CardFooter";const a4=ee.createContext(null);a4.displayName="CardHeaderContext";const c4=ee.forwardRef(({bsPrefix:a,className:r,as:l="div",...u},_)=>{const E=Jn(a,"card-header"),T=ee.useMemo(()=>({cardHeaderBsPrefix:E}),[E]);return h.jsx(a4.Provider,{value:T,children:h.jsx(l,{ref:_,...u,className:Fn(r,E)})})});c4.displayName="CardHeader";const l4=ee.forwardRef(({bsPrefix:a,className:r,variant:l,as:u="img",..._},E)=>{const T=Jn(a,"card-img");return h.jsx(u,{ref:E,className:Fn(l?`${T}-${l}`:T,r),..._})});l4.displayName="CardImg";const d4=ee.forwardRef(({className:a,bsPrefix:r,as:l="div",...u},_)=>(r=Jn(r,"card-img-overlay"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));d4.displayName="CardImgOverlay";const u4=ee.forwardRef(({className:a,bsPrefix:r,as:l="a",...u},_)=>(r=Jn(r,"card-link"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));u4.displayName="CardLink";const Tte=s4("h6"),h4=ee.forwardRef(({className:a,bsPrefix:r,as:l=Tte,...u},_)=>(r=Jn(r,"card-subtitle"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));h4.displayName="CardSubtitle";const p4=ee.forwardRef(({className:a,bsPrefix:r,as:l="p",...u},_)=>(r=Jn(r,"card-text"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));p4.displayName="CardText";const yte=s4("h5"),f4=ee.forwardRef(({className:a,bsPrefix:r,as:l=yte,...u},_)=>(r=Jn(r,"card-title"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));f4.displayName="CardTitle";const m4=ee.forwardRef(({bsPrefix:a,className:r,bg:l,text:u,border:_,body:E=!1,children:T,as:R="div",...w},j)=>{const P=Jn(a,"card");return h.jsx(R,{ref:j,...w,className:Fn(r,P,l&&`bg-${l}`,u&&`text-${u}`,_&&`border-${_}`),children:E?h.jsx(mI,{children:T}):T})});m4.displayName="Card";const rF=Object.assign(m4,{Img:l4,Title:f4,Subtitle:h4,Body:mI,Link:u4,Text:p4,Header:c4,Footer:o4,ImgOverlay:d4});function bte(a,r){return ee.Children.toArray(a).some(l=>ee.isValidElement(l)&&l.type===r)}function Cte({as:a,bsPrefix:r,className:l,...u}){r=Jn(r,"col");const _=ZB(),E=e4(),T=[],R=[];return _.forEach(w=>{const j=u[w];delete u[w];let P,U,G;typeof j=="object"&&j!=null?{span:P,offset:U,order:G}=j:P=j;const q=w!==E?`-${w}`:"";P&&T.push(P===!0?`${r}${q}`:`${r}${q}-${P}`),G!=null&&R.push(`order${q}-${G}`),U!=null&&R.push(`offset${q}-${U}`)}),[{...u,className:Fn(l,...T,...R)},{as:a,bsPrefix:r,spans:T}]}const _I=ee.forwardRef((a,r)=>{const[{className:l,...u},{as:_="div",bsPrefix:E,spans:T}]=Cte(a);return h.jsx(_,{...u,ref:r,className:Fn(l,!T.length&&E)})});_I.displayName="Col";const _4=ee.forwardRef(({bsPrefix:a,fluid:r=!1,as:l="div",className:u,..._},E)=>{const T=Jn(a,"container"),R=typeof r=="string"?`-${r}`:"-fluid";return h.jsx(l,{ref:E,..._,className:Fn(u,r?`${T}${R}`:T)})});_4.displayName="Container";const Rte={type:Ch.string,tooltip:Ch.bool,as:Ch.elementType},aS=ee.forwardRef(({as:a="div",className:r,type:l="valid",tooltip:u=!1,..._},E)=>h.jsx(a,{..._,ref:E,className:Fn(r,`${l}-${u?"tooltip":"feedback"}`)}));aS.displayName="Feedback";aS.propTypes=Rte;const Xa=ee.createContext({}),EI=ee.forwardRef(({id:a,bsPrefix:r,className:l,type:u="checkbox",isValid:_=!1,isInvalid:E=!1,as:T="input",...R},w)=>{const{controlId:j}=ee.useContext(Xa);return r=Jn(r,"form-check-input"),h.jsx(T,{...R,ref:w,type:u,id:a||j,className:Fn(l,r,_&&"is-valid",E&&"is-invalid")})});EI.displayName="FormCheckInput";const Yv=ee.forwardRef(({bsPrefix:a,className:r,htmlFor:l,...u},_)=>{const{controlId:E}=ee.useContext(Xa);return a=Jn(a,"form-check-label"),h.jsx("label",{...u,ref:_,htmlFor:l||E,className:Fn(r,a)})});Yv.displayName="FormCheckLabel";const E4=ee.forwardRef(({id:a,bsPrefix:r,bsSwitchPrefix:l,inline:u=!1,reverse:_=!1,disabled:E=!1,isValid:T=!1,isInvalid:R=!1,feedbackTooltip:w=!1,feedback:j,feedbackType:P,className:U,style:G,title:q="",type:K="checkbox",label:Y,children:ie,as:te="input",...Z},se)=>{r=Jn(r,"form-check"),l=Jn(l,"form-switch");const{controlId:pe}=ee.useContext(Xa),ge=ee.useMemo(()=>({controlId:a||pe}),[pe,a]),je=!ie&&Y!=null&&Y!==!1||bte(ie,Yv),Ye=h.jsx(EI,{...Z,type:K==="switch"?"checkbox":K,ref:se,isValid:T,isInvalid:R,disabled:E,as:te});return h.jsx(Xa.Provider,{value:ge,children:h.jsx("div",{style:G,className:Fn(U,je&&r,u&&`${r}-inline`,_&&`${r}-reverse`,K==="switch"&&l),children:ie||h.jsxs(h.Fragment,{children:[Ye,je&&h.jsx(Yv,{title:q,children:Y}),j&&h.jsx(aS,{type:P,tooltip:w,children:j})]})})})});E4.displayName="FormCheck";const qv=Object.assign(E4,{Input:EI,Label:Yv}),g4=ee.forwardRef(({bsPrefix:a,type:r,size:l,htmlSize:u,id:_,className:E,isValid:T=!1,isInvalid:R=!1,plaintext:w,readOnly:j,as:P="input",...U},G)=>{const{controlId:q}=ee.useContext(Xa);return a=Jn(a,"form-control"),h.jsx(P,{...U,type:r,size:u,ref:G,readOnly:j,id:_||q,className:Fn(E,w?`${a}-plaintext`:a,l&&`${a}-${l}`,r==="color"&&`${a}-color`,T&&"is-valid",R&&"is-invalid")})});g4.displayName="FormControl";const wte=Object.assign(g4,{Feedback:aS}),v4=ee.forwardRef(({className:a,bsPrefix:r,as:l="div",...u},_)=>(r=Jn(r,"form-floating"),h.jsx(l,{ref:_,className:Fn(a,r),...u})));v4.displayName="FormFloating";const gI=ee.forwardRef(({controlId:a,as:r="div",...l},u)=>{const _=ee.useMemo(()=>({controlId:a}),[a]);return h.jsx(Xa.Provider,{value:_,children:h.jsx(r,{...l,ref:u})})});gI.displayName="FormGroup";const S4=ee.forwardRef(({as:a="label",bsPrefix:r,column:l=!1,visuallyHidden:u=!1,className:_,htmlFor:E,...T},R)=>{const{controlId:w}=ee.useContext(Xa);r=Jn(r,"form-label");let j="col-form-label";typeof l=="string"&&(j=`${j} ${j}-${l}`);const P=Fn(_,r,u&&"visually-hidden",l&&j);return E=E||w,l?h.jsx(_I,{ref:R,as:"label",className:P,htmlFor:E,...T}):h.jsx(a,{ref:R,className:P,htmlFor:E,...T})});S4.displayName="FormLabel";const T4=ee.forwardRef(({bsPrefix:a,className:r,id:l,...u},_)=>{const{controlId:E}=ee.useContext(Xa);return a=Jn(a,"form-range"),h.jsx("input",{...u,type:"range",ref:_,className:Fn(r,a),id:l||E})});T4.displayName="FormRange";const y4=ee.forwardRef(({bsPrefix:a,size:r,htmlSize:l,className:u,isValid:_=!1,isInvalid:E=!1,id:T,...R},w)=>{const{controlId:j}=ee.useContext(Xa);return a=Jn(a,"form-select"),h.jsx("select",{...R,size:l,ref:w,className:Fn(u,a,r&&`${a}-${r}`,_&&"is-valid",E&&"is-invalid"),id:T||j})});y4.displayName="FormSelect";const b4=ee.forwardRef(({bsPrefix:a,className:r,as:l="small",muted:u,..._},E)=>(a=Jn(a,"form-text"),h.jsx(l,{..._,ref:E,className:Fn(r,a,u&&"text-muted")})));b4.displayName="FormText";const C4=ee.forwardRef((a,r)=>h.jsx(qv,{...a,ref:r,type:"switch"}));C4.displayName="Switch";const Ate=Object.assign(C4,{Input:qv.Input,Label:qv.Label}),R4=ee.forwardRef(({bsPrefix:a,className:r,children:l,controlId:u,label:_,...E},T)=>(a=Jn(a,"form-floating"),h.jsxs(gI,{ref:T,className:Fn(r,a),controlId:u,...E,children:[l,h.jsx("label",{htmlFor:u,children:_})]})));R4.displayName="FloatingLabel";const Ite={_ref:Ch.any,validated:Ch.bool,as:Ch.elementType},vI=ee.forwardRef(({className:a,validated:r,as:l="form",...u},_)=>h.jsx(l,{...u,ref:_,className:Fn(a,r&&"was-validated")}));vI.displayName="Form";vI.propTypes=Ite;const gA=Object.assign(vI,{Group:gI,Control:wte,Floating:v4,Check:qv,Switch:Ate,Label:S4,Text:b4,Range:T4,Select:y4,FloatingLabel:R4}),w4=ee.forwardRef(({bsPrefix:a,className:r,as:l="div",...u},_)=>{const E=Jn(a,"row"),T=ZB(),R=e4(),w=`${E}-cols`,j=[];return T.forEach(P=>{const U=u[P];delete u[P];let G;U!=null&&typeof U=="object"?{cols:G}=U:G=U;const q=P!==R?`-${P}`:"";G!=null&&j.push(`${w}${q}-${G}`)}),h.jsx(l,{ref:_,...u,className:Fn(r,E,...j)})});w4.displayName="Row";const pd=Lv("https://api.japaneseacademy.jp"),Ote=({userRole:a,firstName:r})=>{const[l,u]=ee.useState(""),[_,E]=ee.useState([]),T=localStorage.getItem("showVideoCall");ee.useEffect(()=>(pd.emit("joinRoom",T),pd.on("chatHistory",j=>{E(j)}),pd.on("receiveMessage",j=>{E(P=>[...P,j])}),()=>{pd.off("chatHistory"),pd.off("receiveMessage")}),[T]);const R=()=>{if(l.trim()){const j={sender:r,role:a,text:l,timestamp:new Date().toLocaleTimeString()};pd.emit("sendMessage",{room:T,message:j}),u("")}},w=localStorage.getItem("firstName");return h.jsx(_4,{children:h.jsx(w4,{className:"justify-content-center mt-4",children:h.jsx(_I,{md:11,children:h.jsx(rF,{className:"w-100",children:h.jsxs(rF.Body,{children:[h.jsx("div",{className:"chat-box",style:{height:"300px",overflowY:"scroll",border:"1px solid #ddd",padding:"10px"},children:_.map((j,P)=>h.jsxs("div",{className:`message ${j.role==="teacher"?"text-primary":"text-success"}`,children:[h.jsxs("strong",{children:[j.sender," (",localStorage.getItem("userRole")?` ${w}`:`${w}`,"):"]})," ",j.text,h.jsx("div",{style:{fontSize:"0.8rem",color:"#888"},children:j.timestamp})]},P))}),h.jsxs(gA,{className:"mt-3",children:[h.jsx(gA.Group,{controlId:"messageInput",children:h.jsx(gA.Control,{type:"text",placeholder:"اكتب رسالتك هنا...",value:l,onChange:j=>u(j.target.value),onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),R())}})}),h.jsx(qA,{className:"webRtcSend mt-2",variant:"primary",onClick:R,children:"إرسال"}),localStorage.getItem("userRole")==="teacher"&&h.jsx(qA,{className:"webRtcSend mt-2",variant:"danger",onClick:()=>pd.emit("clearChat",T),children:"حذف الدردشة"})]})]})})})})})},A4=()=>{const a=da(),r=()=>{const l=localStorage.getItem("showVideoCall");l?a(`/MeetingNow?level=${encodeURIComponent(l)}`):alert("لم يتم تعيين مستوى بعد!")};return h.jsx("div",{className:"d-flex justify-content-center",children:h.jsx("button",{id:"join-btn",onClick:r,children:"الانضمام إلى الدرس"})})};function oF(a){return Ct({tag:"svg",attr:{viewBox:"0 0 1024 1024",fill:"currentColor",fillRule:"evenodd"},child:[{tag:"path",attr:{d:"M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.118.118 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.118.118 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.118.118 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926 224.297 857.629c-.04.041-.06.052-.083.059a.118.118 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.118.118 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512 166.371 224.297c-.041-.04-.052-.06-.059-.083a.118.118 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.118.118 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.118.118 0 0 1 .07 0Z"},child:[]}]})(a)}function Nte(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M8.25 4.5a3.75 3.75 0 1 1 7.5 0v8.25a3.75 3.75 0 1 1-7.5 0V4.5Z"},child:[]},{tag:"path",attr:{d:"M6 10.5a.75.75 0 0 1 .75.75v1.5a5.25 5.25 0 1 0 10.5 0v-1.5a.75.75 0 0 1 1.5 0v1.5a6.751 6.751 0 0 1-6 6.709v2.291h3a.75.75 0 0 1 0 1.5h-7.5a.75.75 0 0 1 0-1.5h3v-2.291a6.751 6.751 0 0 1-6-6.709v-1.5A.75.75 0 0 1 6 10.5Z"},child:[]}]})(a)}function Dte(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 3H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3"},child:[]},{tag:"path",attr:{d:"M8 21h8"},child:[]},{tag:"path",attr:{d:"M12 17v4"},child:[]},{tag:"path",attr:{d:"m17 8 5-5"},child:[]},{tag:"path",attr:{d:"M17 3h5v5"},child:[]}]})(a)}function Pte(a){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"5",r:"1"},child:[]},{tag:"circle",attr:{cx:"12",cy:"19",r:"1"},child:[]}]})(a)}const Lte=()=>{const[a,r]=ee.useState([]),[l,u]=ee.useState(null);ee.useEffect(()=>{const T=localStorage.getItem("showVideoCall");fetch(`https://api.japaneseacademy.jp/files?level=${T}`).then(R=>R.json()).then(R=>r(R)).catch(R=>console.error("Error fetching files:",R))},[]);const _=T=>{u(T.target.files[0])},E=async()=>{if(!l){alert("Please select a file to upload.");return}const T=localStorage.getItem("showVideoCall"),R=new FormData;R.append("file",l),R.append("uploader_id","user-id"),R.append("level",T);try{const w=await fetch("https://api.japaneseacademy.jp/upload",{method:"POST",body:R});if(!w.ok){const P=await w.text();throw console.error("Error response:",P),new Error(`Failed to upload file: ${w.statusText}`)}const j=await w.json();r(P=>[...P,j.file]),u(null),alert("File uploaded successfully.")}catch(w){console.error("Error uploading file:",w),alert("Failed to upload file. Please try again later.")}};return h.jsxs("div",{className:"FilesWeb",children:[h.jsx("h3",{children:"مشاركة الملفات"}),h.jsx("input",{type:"file",onChange:_}),h.jsx("button",{className:"UploadFile",onClick:E,children:"رفع الملف"})," ",h.jsx("ul",{className:"containerFile",children:a.map(T=>h.jsxs("li",{className:"p-2",children:[T.name," ",h.jsx("a",{className:"DownloadFile me-3",href:T.url,target:"_blank",download:!0,children:"تحميل"})]},T.id))})]})},xte="46c493c48baf40cead62de60ae7efda5",kte=()=>{const a=localStorage.getItem("showVideoCall"),[r]=ee.useState(Zf.createClient({mode:"rtc",codec:"vp8"})),[l,u]=ee.useState([]),[_,E]=ee.useState([]),[T,R]=ee.useState(!1),[w,j]=ee.useState(!1),[P,U]=ee.useState(!1),[G,q]=ee.useState(null),[K,Y]=ee.useState(!1),[ie,te]=ee.useState(!1),[Z,se]=ee.useState(""),[pe,ge]=ee.useState(!1),[je,Ye]=ee.useState(!1),[fe,we]=ee.useState(!1),[Le,Fe]=ee.useState(!1),[tt,Me]=ee.useState(""),[Ze,rt]=ee.useState(""),[Qt,rs]=ee.useState("grid"),[We,Kt]=ee.useState(null),[Jt,vs]=ee.useState(Date.now()),[Ss,Ts]=ee.useState(window.innerWidth<=750),Ri=ee.useRef({}),Ni=da(),cl=async()=>{Fe(!0);try{const me=localStorage.getItem("showVideoCall"),It=localStorage.getItem("uid"),Mt=localStorage.getItem("userRole");if(console.log("Fetching token with:",{level:me,uid:It,userRole:Mt}),!me||!It||!Mt)throw new Error("يجب إرسال معلمات level و uid و userRole في الطلب.");let cn=await fetch(`https://api.japaneseacademy.jp/get-token?level=${me}&uid=${It}&userRole=${Mt}`);if(!cn.ok&&cn.status===400){const vr=await cn.json();if(console.log("Error from server:",vr),vr.error.includes("لديك جلسة نشطة بالفعل")){if(cn=await fetch(`https://api.japaneseacademy.jp/regenerate-token?level=${me}&uid=${It}`),!cn.ok)throw new Error("Failed to regenerate token")}else throw new Error(vr.error)}else if(!cn.ok)throw new Error("Failed to fetch token");const ys=await cn.json();console.log("Token fetched successfully:",ys),q(ys.token)}catch(me){console.error("Error fetching token:",me.message)}},Co=async()=>{var me;try{const It=localStorage.getItem("userId");if(!It)return;const Mt=await fetch("https://api.japaneseacademy.jp/allusers");if(!Mt.ok)throw new Error("فشل في جلب بيانات المستخدم");const ys=(await Mt.json()).find(vr=>vr.id===parseInt(It));if(ys){const vr=((me=ys.firstName)==null?void 0:me.trim())||"مستخدم";Me(vr.charAt(0).toUpperCase()),rt(ys.role)}else Me("U")}catch(It){console.error("❌ خطأ أثناء جلب بيانات المستخدم:",It),Me("U")}};ee.useEffect(()=>{a&&(se(`main${a}`),cl(),Co())},[a]),ee.useEffect(()=>{console.log("🔄 Streams updated:",_),setTimeout(()=>{_.forEach(me=>{const It=Ri.current[me.id];if(!It){console.warn(`⚠️ Video element STILL NOT found for stream ID: ${me.id}, retrying...`),setTimeout(()=>{const Mt=Ri.current[me.id];Mt?(console.log(`✅ Retrying success: Video element found for stream ID: ${me.id}`),me.videoTrack.play(Mt).catch(cn=>{console.error(`❌ Error playing video for stream ${me.id}:`,cn)})):console.error(`❌ FINAL ERROR: Video element not found for stream ID: ${me.id}`)},500);return}console.log(`▶️ Playing video for stream ID: ${me.id}`),me.videoTrack.play(It).catch(Mt=>{console.error(`❌ Error playing video for stream ${me.id}:`,Mt)})})},500),_.forEach(me=>{me.videoTrack&&setTimeout(()=>{const It=Ri.current[me.id];It&&(console.log(`✅ تشغيل فيديو بعد التحديث للمستخدم ${me.id}`),me.videoTrack.play(It).catch(Mt=>console.error(`❌ خطأ أثناء تشغيل الفيديو بعد التحديث للمستخدم ${me.id}:`,Mt)))},500)})},[_,l]);const ke=async()=>{if(!G||r.connectionState==="CONNECTED"||r.connectionState==="CONNECTING"){console.warn("Client is already connected or connecting. Skipping join.");return}console.log("Joining channel:",Z,"with token:",G),r.on("user-published",(me,It)=>{console.log("📡 User published:",me.uid,"Media Type:",It),ua(me,It)}),r.on("user-unpublished",me=>{console.log("📴 User unpublished:",me.uid),Kr(me)});try{const me=await r.join(xte,Z,G,null);console.log(`✅ Joined successfully with UID: ${me}`);const It=await Zf.createMicrophoneAudioTrack(),Mt=await Zf.createCameraVideoTrack();u([It,Mt]),E(cn=>[...cn,{id:me,videoTrack:Mt,initial:localStorage.getItem("firstName"),role:localStorage.getItem("userRole")}]),await r.publish([It,Mt]),console.log("📡 Published local tracks successfully.")}catch(me){console.error("❌ Error joining and publishing stream:",me)}finally{Fe(!1)}setTimeout(()=>{l[1]&&(l[1].setEnabled(!0),console.log("✅ تم تفعيل الكاميرا عند الانضمام"))},500)},ua=async(me,It)=>{await r.subscribe(me,It),console.log(`📡 المستخدم ${me.uid} انضم - نوع الوسائط: ${It}`),It==="video"&&me.videoTrack&&(console.log(`🎥 تشغيل فيديو المستخدم ${me.uid}`),E(Mt=>Mt.some(cn=>cn.id===me.uid)?Mt:[...Mt,{id:me.uid,videoTrack:me.videoTrack,initial:"U",role:"student"}]),setTimeout(()=>{E(Mt=>[...Mt]),console.log("🔄 تحديث حالة `streams` بعد انضمام المستخدم الجديد")},500),setTimeout(async()=>{const Mt=Ri.current[me.uid];me.videoTrack&&Mt&&(await me.videoTrack.play(Mt),await me.videoTrack.setEnabled(!1),setTimeout(async()=>{await me.videoTrack.setEnabled(!0),console.log(`🔄 إعادة تشغيل فيديو المستخدم ${me.uid}`)},1e3))},500)),It==="audio"&&me.audioTrack&&(console.log(`🎤 تشغيل الصوت للمستخدم ${me.uid}`),me.audioTrack.play())},Kr=me=>{console.log(`👤 User left: ${me.uid}`),E(It=>It.filter(Mt=>Mt.id!==me.uid))};ee.useEffect(()=>{G&&(console.log("🚀 Calling joinAndDisplayLocalStream..."),ke())},[G]);const Ds=async()=>{if(!l[0]){console.warn("⚠️ الميكروفون غير موجود.");return}try{const me=!T;await l[0].setEnabled(!me),R(me),await r.unpublish(l[1]),await r.publish(l[1]),l[1]&&!w&&(await l[1].setEnabled(!0),console.log("✅ التأكد من أن الكاميرا لا تزال مفعّلة بعد تبديل المايك."))}catch(me){console.error("❌ خطأ أثناء تبديل المايكروفون:",me)}},nt=async()=>{if(!l[1]){console.warn("⚠️ لم يتم العثور على `videoTrack`.");return}try{const me=!w;await l[1].setEnabled(!me),j(me),me||(await r.publish(l[1]),console.log("📡 إعادة نشر الكاميرا لضمان استمرار الفيديو."))}catch(me){console.error("❌ خطأ أثناء تبديل الكاميرا:",me)}},Zt=ee.useCallback(async me=>{Le||(l[1]&&!w&&(await l[1].setEnabled(!0),j(!1)),rs(me),Ze==="student"&&l[1]&&!w&&console.log("🔄 تحديث التخطيط بدون إعادة تشغيل الكاميرا"),setTimeout(async()=>{l[1]&&w&&(await l[1].setEnabled(!0),j(!1))},500))},[Le,w,l]),wi=async()=>{try{if(P){console.log("⏹️ إيقاف مشاركة الشاشة..."),await r.unpublish(l[1]);const me=await Zf.createCameraVideoTrack();u([l[0],me]),await r.publish(me),U(!1),j(!1),console.log("✅ تمت إعادة تشغيل الكاميرا بعد إيقاف مشاركة الشاشة.")}else{console.log("📺 بدء مشاركة الشاشة...");const me=await Zf.createScreenVideoTrack();await r.unpublish(l[1]),u([l[0],me]),await r.publish(me),U(!0)}}catch(me){console.error("❌ خطأ أثناء تبديل مشاركة الشاشة:",me)}},Di=()=>{const me=document.documentElement;me.requestFullscreen?me.requestFullscreen():me.mozRequestFullScreen?me.mozRequestFullScreen():me.webkitRequestFullscreen?me.webkitRequestfullscreen():me.msRequestFullscreen&&me.msRequestFullscreen(),ge(!0)},Ro=()=>{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),ge(!1)};ee.useEffect(()=>{const me=()=>{!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement&&ge(!1)};return document.addEventListener("fullscreenchange",me),document.addEventListener("webkitfullscreenchange",me),document.addEventListener("mozfullscreenchange",me),document.addEventListener("MSFullscreenChange",me),()=>{document.removeEventListener("fullscreenchange",me),document.removeEventListener("webkitfullscreenchange",me),document.removeEventListener("mozfullscreenchange",me),document.removeEventListener("MSFullscreenChange",me)}},[]),ee.useEffect(()=>()=>{pe&&Ro()},[pe]),ee.useEffect(()=>(localStorage.setItem("hideSocial","true"),()=>{localStorage.removeItem("hideSocial")}),[]),ee.useEffect(()=>(localStorage.getItem("activeSession")?(alert("لديك جلسة نشطة بالفعل. لا يمكنك فتح الجلسة في أكثر من علامة تبويب."),Ni("/")):localStorage.setItem("activeSession","true"),()=>{localStorage.removeItem("activeSession")}),[]);const qe=_.find(me=>me.role==="teacher"),zr=_.filter(me=>me.role==="student"),Ei=qe?zr.length+1:zr.length,os=me=>{Kt(me)};console.log("📡 Current Streams:",_),ee.useEffect(()=>{console.log("📊 عدد المشاركين: ",Ei)},[_]),ee.useEffect(()=>{const me=()=>{Ts(window.innerWidth<=750)};return window.addEventListener("resize",me),()=>window.removeEventListener("resize",me)},[]);const Qa=async()=>{try{const me=l.map(async Mt=>{Mt.stop&&Mt.stop(),Mt.close&&Mt.close()});if(await Promise.all(me),await r.leave(),u([]),E([]),R(!1),j(!1),U(!1),q(null),Y(!1),te(!1),ge(!1),Ye(!1),we(!1),Kt(null),!(await fetch("https://api.japaneseacademy.jp/end-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:localStorage.getItem("uid")})})).ok)throw new Error("Failed to end session")}catch(me){console.error("Error during cleanup:",me)}finally{Ni("/")}};return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"webRtc",children:[Le&&h.jsxs("div",{className:"loading-overlay",children:[h.jsx("div",{className:"loading-spinner"}),h.jsx("p",{children:"جاري التحميل، الرجاء الانتظار..."})]}),h.jsxs("div",{id:"video-streams",className:`video-grid ${Qt}`,"data-participants":Ei,children:[(Qt==="stack"||Qt==="focus")&&h.jsx("div",{className:"top-scroll",children:zr.map(me=>h.jsx("div",{className:"video-container student",onClick:()=>os(me),children:me.videoTrack?h.jsx("video",{autoPlay:!0,playsInline:!0,muted:me.id!==r.uid,ref:It=>{It&&(console.log(`✅ تم تعيين عنصر الفيديو للمستخدم ${me.id}`),Ri.current[me.id]=It,setTimeout(()=>{try{me.videoTrack&&typeof me.videoTrack.play=="function"?(console.log(`▶️ تشغيل الفيديو بعد تأكيد تعيين العنصر للمستخدم ${me.id}`),me.videoTrack.play(It)):console.warn(`⚠️ لم يتم العثور على play() للمستخدم ${me.id}`)}catch(Mt){console.error(`❌ خطأ أثناء تشغيل الفيديو للمستخدم ${me.id}:`,Mt)}},500))}},Jt):h.jsx("div",{className:"initial",children:me.initial||"U"})},me.id))}),h.jsxs("div",{className:`main-area ${Qt}`,children:[qe&&h.jsx("div",{className:`video-container teacher ${Qt}`,children:qe.videoTrack?h.jsx("video",{autoPlay:!0,playsInline:!0,muted:qe.id!==r.uid,ref:me=>{me&&(console.log(`✅ تم تعيين عنصر الفيديو للمستخدم ${qe.id}`),Ri.current[qe.id]=me,setTimeout(()=>{try{qe.videoTrack&&typeof qe.videoTrack.play=="function"?(console.log(`▶️ تشغيل الفيديو بعد تأكيد تعيين العنصر للمستخدم ${qe.id}`),qe.videoTrack.play(me)):console.warn(`⚠️ لم يتم العثور على play() للمستخدم ${qe.id}`)}catch(It){console.error(`❌ خطأ أثناء تشغيل الفيديو للمستخدم ${qe.id}:`,It)}},500))}},Jt):h.jsx("div",{className:"initial",children:qe.initial||"T"})},qe.id),We&&Qt==="stack"&&h.jsx("div",{className:`video-container student ${Qt}`,children:We.videoTrack?h.jsx("video",{autoPlay:!0,playsInline:!0,muted:We.id!==r.uid,ref:me=>{me&&(console.log(`✅ تم تعيين عنصر الفيديو للمستخدم ${We.id}`),Ri.current[We.id]=me,setTimeout(()=>{try{We.videoTrack&&typeof We.videoTrack.play=="function"?(console.log(`▶️ تشغيل الفيديو بعد تأكيد تعيين العنصر للمستخدم ${We.id}`),We.videoTrack.play(me)):console.warn(`⚠️ لم يتم العثور على play() للمستخدم ${We.id}`)}catch(It){console.error(`❌ خطأ أثناء تشغيل الفيديو للمستخدم ${We.id}:`,It)}},500))}},Jt):h.jsx("div",{className:"initial",children:We.initial||"U"})},We.id),Qt==="grid"&&zr.map(me=>h.jsx("div",{className:`video-container student ${Qt}`,children:me.videoTrack?h.jsx("video",{autoPlay:!0,playsInline:!0,muted:me.id!==r.uid,ref:It=>{It&&(console.log(`✅ تم تعيين عنصر الفيديو للمستخدم ${me.id}`),Ri.current[me.id]=It,setTimeout(()=>{try{me.videoTrack&&typeof me.videoTrack.play=="function"?(console.log(`▶️ تشغيل الفيديو بعد تأكيد تعيين العنصر للمستخدم ${me.id}`),me.videoTrack.play(It)):console.warn(`⚠️ لم يتم العثور على play() للمستخدم ${me.id}`)}catch(Mt){console.error(`❌ خطأ أثناء تشغيل الفيديو للمستخدم ${me.id}:`,Mt)}},500))}},Jt):h.jsx("div",{className:"initial",children:me.initial||"U"})},me.id))]})]}),h.jsx("div",{className:"AllButtonVideo",children:h.jsxs("div",{className:"webRtcButtons",children:[!Ss&&h.jsx("button",{className:"FileButton",onClick:()=>te(!ie),children:h.jsx(fV,{})}),Ze==="teacher"&&h.jsxs("div",{style:{position:"relative"},children:[h.jsx("button",{onClick:()=>we(!fe),children:h.jsx(b2,{})}),fe&&h.jsxs("div",{className:"layout-menu",children:[h.jsx("button",{onClick:()=>Zt("grid"),children:"شبكة"}),h.jsx("button",{onClick:()=>Zt("stack"),children:"ثنائي"}),h.jsx("button",{onClick:()=>Zt("focus"),children:"تركيز"})]})]}),h.jsx("button",{className:"webRtcCamera",onClick:Ds,style:{backgroundColor:T?"#EE4B2B":"cadetblue"},children:T?h.jsx(T2,{}):h.jsx(Nte,{})}),h.jsx("button",{className:"webRtcMic",onClick:nt,style:{backgroundColor:w?"#EE4B2B":"cadetblue"},children:w?h.jsx(A2,{}):h.jsx(w2,{})}),h.jsx("button",{className:"webRtcScreenShare",onClick:wi,style:{backgroundColor:P?"#EE4B2B":"cadetblue"},children:h.jsx(Dte,{})}),h.jsxs("div",{style:{position:"relative"},children:[h.jsx("button",{onClick:()=>Ye(!je),children:h.jsx(Pte,{})}),je&&h.jsxs("div",{className:"listIconVideo",children:[Ss&&h.jsxs(h.Fragment,{children:[h.jsxs("button",{onClick:()=>te(!ie),children:[h.jsx(fV,{}),h.jsx("span",{children:"مشاركة الملفات"})]}),h.jsxs("button",{onClick:()=>Y(!K),children:[h.jsx(mV,{}),h.jsx("span",{children:"مشاركة الرسائل"})]})]}),h.jsx("button",{onClick:pe?Ro:Di,children:pe?h.jsxs(h.Fragment,{children:[h.jsx(C2,{}),h.jsx("span",{children:"إغلاق ملء الشاشة"})]}):h.jsxs(h.Fragment,{children:[h.jsx(R2,{}),h.jsx("span",{children:"ملء الشاشة"})]})})]})]}),h.jsx("button",{className:"endCall",onClick:Qa,children:h.jsx(y2,{})}),!Ss&&h.jsx("button",{className:"chatButton",onClick:()=>Y(!K),children:h.jsx(mV,{})})]})}),K&&h.jsxs("div",{className:"chatContainer",children:[h.jsx("button",{className:"closeChat",onClick:()=>Y(!1),style:{position:"absolute",top:0,right:0},children:h.jsx(oF,{})}),h.jsx(Ote,{})]}),ie&&h.jsxs("div",{className:"FileContainer",children:[h.jsx("button",{className:"closeFiles",onClick:()=>te(!1),style:{position:"absolute",top:0,right:0},children:h.jsx(oF,{})}),h.jsx(Lte,{})]})]})})};function Mte(){return ee.useEffect(()=>{document.title="academy"},[]),h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(pQ,{}),h.jsx(Vi,{})]})}function jte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(D2,{}),h.jsx(L2,{}),h.jsx(P2,{}),h.jsx(x2,{}),h.jsx(k2,{}),h.jsx(M2,{}),h.jsx(j2,{}),h.jsx(TB,{}),h.jsx(U2,{}),h.jsx(Vi,{})]})}function Ute(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(V2,{}),h.jsx(Vi,{})]})}function Vte(){return h.jsx(h.Fragment,{children:h.jsx(qX,{})})}function Fte(){return h.jsx(h.Fragment,{children:h.jsx($X,{})})}function Bte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(QX,{}),h.jsx(Vi,{})]})}function Gte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(eQ,{}),h.jsx(aQ,{}),h.jsx(Vi,{})]})}function Hte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(yB,{}),h.jsx(Vi,{})]})}function Wte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(vQ,{}),h.jsx(Vi,{})]})}function Kte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(bQ,{}),h.jsx(Vi,{})]})}function zte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(RQ,{}),h.jsx(Vi,{})]})}function Yte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(AQ,{}),h.jsx(Vi,{})]})}function qte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(OQ,{}),h.jsx(Vi,{})]})}function $te(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(DQ,{}),h.jsx(Vi,{})]})}function Jte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(aee,{}),h.jsx(Vi,{})]})}function Xte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(oee,{}),h.jsx(Vi,{})]})}function Qte(){const[a,r]=ee.useState(!1),[l,u]=ee.useState(null);return ee.useEffect(()=>{const _=localStorage.getItem("showVideoCall"),E=localStorage.getItem("showVideoCall");u(E),["level_one","level_two","level_three","level_four","level_five","level_six","level_seven","level_eight","level_nine","level_ten","level_eleven","level_twelve","level_thirteen","level_fourteen","level_fifteen","level_sixteen"].includes(_)&&r(!0)},[]),h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),a&&h.jsxs("div",{children:[h.jsxs("h3",{className:"level_now academy m-4 text-center",children:["المستوى الحالي: ",l]}),h.jsx(A4,{})]}),h.jsx(cee,{}),h.jsx(Vi,{})]})}function Zte(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(uee,{}),h.jsx(Vi,{})]})}function ene(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(TB,{}),h.jsx(Vi,{})]})}const tne="/assets/_4406e21c-6fff-4238-900e-8718d8d061de.B7loVfxR.jpg",nne="/assets/_6c036b6a-95ec-4a89-94cb-7b3657d6a1b6.DLw9CdB6.jpg";function ine(){return h.jsx(h.Fragment,{children:h.jsx("div",{className:"container Privacy mt-4",children:h.jsxs("div",{className:"details_privacy",children:[h.jsxs("div",{className:"row academy mb-5",children:[h.jsxs("div",{className:"col-lg-8 col-md-6 col-12 text_privacy ",children:[h.jsx("h2",{className:"mb-3",children:"شروط الاستخدام"}),h.jsx("p",{children:"مرحبًا بكم في موقع أكاديمية اللغة اليابانية، المتخصص في تقديم دورات تعليم اللغة اليابانية عبر الإنترنت. باستخدامك لهذا الموقع، فإنك توافق على الالتزام بالشروط التالية أدناه. يُرجى قراءة هذه الشروط بعناية قبل البدء في استخدام الموقع أو التسجيل في أي من الدورات التعليمية."})]}),h.jsx("div",{className:"col-lg-4 col-md-6 col-12 img_privacy",children:h.jsx("img",{className:"m-auto",src:tne,alt:""})})]}),h.jsxs("div",{className:"ul_privacy",children:[h.jsxs("ul",{className:"academy row mb-5",children:[h.jsxs("div",{className:"col-lg-8",children:[h.jsx("h2",{children:"قبول الشروط"}),h.jsx("p",{children:"يُعد استخدام هذا الموقع أو التسجيل للحصول على خدمات الأكاديمية موافقة صريحة على الالتزام بشروط الاستخدام وسياسة الخصوصية. في حال عدم الموافقة على هذه الشروط، يُرجى الامتناع عن استخدام الموقع."})]}),h.jsx("div",{className:"col-lg-4 img_privacy",children:h.jsx("img",{className:"m-auto",src:nne,alt:""})}),h.jsx("p",{className:"mt-3",children:"يتم جمع هذه المعلومات بشكل رئيسي عند قيام الطالب بإنشاء حساب جديد أو التسجيل في إحدى الدورات التعليمية التي نقدمها."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"إنشاء الحساب"}),h.jsx("p",{children:"للاستفادة من خدمات الأكاديمية، يُطلب من جميع الطلاب إنشاء حساب شخصي يتضمن معلومات مثل الاسم، وتاريخ الميلاد، والبريد الإلكتروني، ورقم الهاتف. ويتحمل المستخدم مسؤولية دقة المعلومات المقدمة، ويلتزم بتحديثها في حال حدوث أي تغيير."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"الاستخدام المسموح به"}),h.jsxs("p",{children:["يوافق المستخدم على استخدام الموقع لأغراض تعليمية فقط، ويتعهد بما يلي:"," "]}),h.jsx("li",{children:"عدم استخدام الموقع أو أي من محتوياته لأغراض غير قانونية أو تنتهك حقوق الملكية الفكرية."}),h.jsx("li",{children:"الامتناع عن تحميل أو نشر أي محتوى ضار، أو فيروسات، أو برامج تهدف إلى التأثير سلبًا على تشغيل الموقع."}),h.jsxs("li",{children:["عدم محاولة الوصول غير المصرح به إلى أنظمة الأكاديمية، أو الحسابات الأخرى."," "]})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"حماية الحساب"}),h.jsx("p",{children:"يجب على المستخدم الحفاظ على سرية معلومات الدخول الخاصة به (اسم المستخدم وكلمة المرور). والأكاديمية غير مسؤولة عن أي استخدام غير مصرح به للحساب الشخصي الناتج عن عدم الحفاظ على سرية معلومات الدخول."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"الحقوق الفكرية"}),h.jsx("p",{children:"جميع المحتويات الموجودة على الموقع، بما في ذلك النصوص، والصور، والفيديوهات، والمحتوى التعليمي، هي ملك لأكاديمية اللغة اليابانية. ويُمنع منعًا باتًّا نسخ أو إعادة إنتاج أو توزيع أي محتوى دون الحصول على إذن خطي مسبق من الأكاديمية."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"سياسة الدفع والاسترداد"}),h.jsx("p",{children:"يُرجى مراجعة سياسة الرسوم والاسترداد الخاصة بالدورات التعليمية قبل التسجيل. يتم عرض الأسعار وشروط الدفع بشكل واضح، ولا يمكن استرداد الرسوم إلا وفقًا للسياسة التي تحددها الأكاديمية."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"التغييرات في الدورات أو الخدمات"}),h.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بالحق في تعديل أو إلغاء أي من الدورات أو الخدمات المقدمة عبر الموقع في أي وقت، دون الحاجة إلى إشعار مسبق. وستبذل الأكاديمية جهودًا لإعلام المستخدمين في حال وجود تغييرات كبيرة قد تؤثر على تجربتهم التعليمية في الأكاديمية."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"إخلاء المسؤولية"}),h.jsx("p",{children:"تبذل الأكاديمية جهدها لتقديم محتوى تعليمي عالي الجودة، لكنها لا تضمن خلو الموقع أو الدورات من الأخطاء أو الأعطال التقنية. كما أن الأكاديمية غير مسؤولة عن أي أضرار مباشرة أو غير مباشرة قد تحدث نتيجة استخدام الموقع."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"الروابط الخارجية"}),h.jsx("p",{children:"قد يحتوي الموقع على روابط لمواقع أخرى. والأكاديمية ليست مسؤولة عن المحتوى أو سياسة الخصوصية الخاصة بهذه المواقع الخارجية، ويجب على المستخدم مراجعة شروط الاستخدام وسياسة الخصوصية الخاصة بتلك المواقع قبل استخدامها."})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"التعديلات على الشروط"}),h.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بحقها في تعديل شروط الاستخدام هذه في أي وقت. وسيتم نشر التعديلات على هذه الصفحة مع تاريخ التحديث. يُنصح المستخدمون بمراجعة الشروط بشكل دوري لضمان فهمهم لأي تحديثات قد تطرأ.              "})]}),h.jsxs("ul",{className:"academy mb-5",children:[h.jsx("h2",{children:"التواصل"}),h.jsxs("p",{children:["في حال وجود أي استفسارات أو مشاكل تتعلق بشروط الاستخدام، يُرجى التواصل معنا عبر البريد الإلكتروني:",h.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:"info@japaneseacademy.jp"}),h.jsx("p",{children:"باستخدامك لموقع أكاديمية اللغة اليابانية، فإنك توافق على الالتزام بجميع الشروط الواردة أعلاه."})]})]})]})]})})})}function sne(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(ine,{}),h.jsx(Vi,{})]})}function rne(){return h.jsxs(h.Fragment,{children:[h.jsx(Ui,{}),h.jsx(A4,{}),h.jsx(hee,{}),h.jsx(pee,{}),h.jsx(Vi,{})]})}const one=({isAuthenticated:a,children:r})=>a?r:h.jsx(Kq,{to:"/Login",replace:!0});function ane(){const[a,r]=ee.useState(!1),[l,u]=ee.useState(!1),[_,E]=ee.useState({necessary:!0,analytics:!0,preferences:!0});ee.useEffect(()=>{const P=localStorage.getItem("cookiesSettings");P&&(E(JSON.parse(P)),r(!0))},[]);const T=()=>{r(!0),document.cookie="acceptCookies=true; path=/; max-age="+60*60*24*30,localStorage.setItem("cookiesSettings",JSON.stringify(_))},R=()=>{r(!0),document.cookie="acceptCookies=false; path=/; max-age="+60*60*24*30},w=(P,U)=>{E(G=>({...G,[P]:U}))},j=()=>{localStorage.setItem("cookiesSettings",JSON.stringify(_)),document.cookie=`cookiesSettings=${JSON.stringify(_)}; path=/`,alert("تم حفظ إعدادات ملفات تعريف الارتباط بنجاح!"),r(!0),u(!1)};return h.jsx(h.Fragment,{children:h.jsxs("div",{className:"Cookies",children:[!a&&h.jsxs("div",{className:"cookie-banner",children:[h.jsxs("p",{className:"mb-4",children:["مرحبًا بكم في موقع أكاديمية اللغة اليابانية! ",h.jsx("br",{}),'نحن نستخدم ملفات تعريف الارتباط لتحسين تجربتكم. بالضغط على "قبول جميع ملفات تعريف الارتباط"، فإنكم توافقون على استخدامها.',h.jsx("br",{}),"لمزيد من التفاصيل، يُرجى الاطلاع على"," ",h.jsx("a",{href:"/Privacy",children:"سياسة الخصوصية"}),"."]}),h.jsxs("div",{className:"buttonsCookies",children:[h.jsx("button",{className:"mb-4",onClick:T,children:"قبول جميع ملفات تعريف الارتباط"}),h.jsx("button",{className:"mb-4",onClick:()=>u(!0),children:"إعدادات تعريف ملفات الارتباط"}),h.jsx("button",{onClick:R,children:"رفض"})]})]}),l&&h.jsx("div",{className:"modal-overlay",children:h.jsxs("div",{className:"modal",children:[h.jsx("h2",{children:"إعدادات ملفات تعريف الارتباط"}),h.jsx("p",{children:"قبل البدء بتصفح الموقع، يمكنك تعديل إعدادات ملفات تعريف الارتباط حسب تفضيلاتك."}),h.jsxs("div",{className:"cookie-option",children:[h.jsx("h3",{children:"1. ملفات الارتباط الضرورية"}),h.jsx("p",{children:"هذه الملفات ضرورية لتشغيل الموقع بشكل صحيح ولا يمكن تعطيلها."})]}),h.jsxs("div",{className:"cookie-option",children:[h.jsx("h3",{children:"2. ملفات الارتباط التحليلية"}),h.jsx("p",{children:"تساعدنا في تحسين الأداء وتحليل سلوك المستخدم."}),h.jsx("button",{className:_.analytics?"active_disable":"",onClick:()=>w("analytics",!0),children:"تفعيل"}),h.jsx("button",{className:_.analytics?"":"active_enable",onClick:()=>w("analytics",!1),children:"تعطيل"})]}),h.jsxs("div",{className:"cookie-option",children:[h.jsx("h3",{children:"3. ملفات الارتباط الخاصة بالتفضيلات"}),h.jsx("p",{children:"تسمح بحفظ تفضيلاتك لتوفير تجربة مخصصة عند العودة للموقع."}),h.jsx("button",{className:_.preferences?"active_disable":"",onClick:()=>w("preferences",!0),children:"تفعيل"}),h.jsx("button",{className:_.preferences?"":"active_enable",onClick:()=>w("preferences",!1),children:"تعطيل"})]}),h.jsx("div",{className:"actions",children:h.jsx("button",{onClick:j,children:"حفظ الإعدادات"})})]})})]})})}const cne=()=>{const{pathname:a}=Ah();return ee.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[a]),null};function lne(){const[a,r]=ee.useState(!1);ee.useEffect(()=>{const U=setTimeout(()=>{r(!0)},1300);return()=>clearTimeout(U)},[]);const[l,u]=ee.useState(!1);ee.useEffect(()=>{u(!0),setTimeout(()=>{u(!1)},100)},[]);const[_,E]=ee.useState(!1),T=()=>{E(!_)},[R,w]=ee.useState(!1);ee.useEffect(()=>{const U=localStorage.getItem("auth");w(U==="true")},[]),ee.useEffect(()=>{const U=document.querySelectorAll(".up"),G=()=>{window.scrollY>=120?U.forEach(K=>K.classList.add("look")):U.forEach(K=>K.classList.remove("look"))},q=()=>{window.scrollTo({top:0,behavior:"smooth"})};return window.addEventListener("scroll",G),U.forEach(K=>K.addEventListener("click",q)),()=>{window.removeEventListener("scroll",G),U.forEach(K=>K.removeEventListener("click",q))}},[]);const[j,P]=ee.useState(!1);return ee.useEffect(()=>(localStorage.getItem("hideSocial")==="true"&&P(!0),()=>{P(!1)}),[]),h.jsx(h.Fragment,{children:h.jsxs(h.Fragment,{children:[h.jsx(ane,{}),h.jsx("button",{className:"up",children:h.jsx(E2,{})}),h.jsx("div",{className:`social ${j?"noneSocial":""}`,children:h.jsxs("ul",{onClick:T,style:{cursor:"pointer"},children:[h.jsx("li",{className:"click",children:h.jsx(ree,{})}),_&&h.jsxs(h.Fragment,{children:[h.jsx("li",{className:"line top",children:h.jsx("a",{href:"https://line.me/ti/p/IuAqVt59QV",children:h.jsx(p2,{})})}),h.jsx("li",{className:"email top",children:h.jsx("a",{href:"mailto:contact@sawagroup.jp",children:h.jsx(DF,{})})}),h.jsx("li",{className:"whatsapp top",children:h.jsx("a",{href:"https://wa.link/mr0gya",children:h.jsx(Uv,{})})})]})]})}),l?h.jsx("img",{className:"Loading",src:eI,alt:""}):h.jsxs(e2,{children:[h.jsx(cne,{}),h.jsxs(Yq,{children:[h.jsx(ui,{path:"/",element:h.jsx(Mte,{})}),h.jsx(ui,{path:"/About",element:h.jsx(jte,{})}),h.jsx(ui,{path:"/Date",element:h.jsx(Ute,{})}),h.jsx(ui,{path:"/Login",element:h.jsx(Fte,{})}),h.jsx(ui,{path:"/Articles",element:h.jsx(Gte,{})}),h.jsx(ui,{path:"/Level_division",element:h.jsx(Wte,{})}),h.jsx(ui,{path:"/Register",element:h.jsx(Hte,{})}),h.jsx(ui,{path:"/Teachers",element:h.jsx(Kte,{})}),h.jsx(ui,{path:"/Study_materials",element:h.jsx(zte,{})}),h.jsx(ui,{path:"/More_services",element:h.jsx(Yte,{})}),h.jsx(ui,{path:"/Support",element:h.jsx(qte,{})}),h.jsx(ui,{path:"/Fees",element:h.jsx($te,{})}),h.jsx(ui,{path:"/Register_account",element:h.jsx(Xte,{})}),h.jsx(ui,{path:"/Login_users",element:h.jsx(Jte,{})}),h.jsx(ui,{path:"/Dash_users/:userId",element:h.jsx(Qte,{})}),h.jsx(ui,{path:"/Comments",element:h.jsx(ene,{})}),h.jsx(ui,{path:"/Questions",element:h.jsx(Bte,{})}),h.jsx(ui,{path:"/Privacy",element:h.jsx(Zte,{})}),h.jsx(ui,{path:"/Terms",element:h.jsx(sne,{})}),h.jsx(ui,{path:"/Dash_Teachers",element:h.jsx(rne,{})}),h.jsx(ui,{path:"/MeetingNow",element:h.jsx(kte,{})}),h.jsx(ui,{path:"/Dash",element:h.jsx(one,{isAuthenticated:!!localStorage.getItem("auth"),children:h.jsx(Vte,{})})})]})]})]})})}vA.createRoot(document.getElementById("root")).render(h.jsx(Hn.StrictMode,{children:h.jsx(lne,{})}));
