import{r as ie,a as vK,R as yK,c as oj,b as Mn,g as Pw}from"./vendor.CqcSyPVE.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))h(E);new MutationObserver(E=>{for(const T of E)if(T.type==="childList")for(const R of T.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&h(R)}).observe(document,{childList:!0,subtree:!0});function d(E){const T={};return E.integrity&&(T.integrity=E.integrity),E.referrerPolicy&&(T.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?T.credentials="include":E.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function h(E){if(E.ep)return;E.ep=!0;const T=d(E);fetch(E.href,T)}})();var aj={exports:{}},eS={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RK=ie,bK=Symbol.for("react.element"),CK=Symbol.for("react.fragment"),wK=Object.prototype.hasOwnProperty,AK=RK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,IK={key:!0,ref:!0,__self:!0,__source:!0};function cj(l,a,d){var h,E={},T=null,R=null;d!==void 0&&(T=""+d),a.key!==void 0&&(T=""+a.key),a.ref!==void 0&&(R=a.ref);for(h in a)wK.call(a,h)&&!IK.hasOwnProperty(h)&&(E[h]=a[h]);if(l&&l.defaultProps)for(h in a=l.defaultProps,a)E[h]===void 0&&(E[h]=a[h]);return{$$typeof:bK,type:l,key:T,ref:R,props:E,_owner:AK.current}}eS.Fragment=CK;eS.jsx=cj;eS.jsxs=cj;aj.exports=eS;var f=aj.exports,uw={},EU=vK;uw.createRoot=EU.createRoot,uw.hydrateRoot=EU.hydrateRoot;/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sf(){return Sf=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var d=arguments[a];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])}return l},Sf.apply(this,arguments)}var Dc;(function(l){l.Pop="POP",l.Push="PUSH",l.Replace="REPLACE"})(Dc||(Dc={}));const gU="popstate";function OK(l){l===void 0&&(l={});function a(h,E){let{pathname:T,search:R,hash:N}=h.location;return hw("",{pathname:T,search:R,hash:N},E.state&&E.state.usr||null,E.state&&E.state.key||"default")}function d(h,E){return typeof E=="string"?E:Fg(E)}return DK(a,d,null,l)}function fi(l,a){if(l===!1||l===null||typeof l>"u")throw new Error(a)}function lj(l,a){if(!l){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function NK(){return Math.random().toString(36).substr(2,8)}function SU(l,a){return{usr:l.state,key:l.key,idx:a}}function hw(l,a,d,h){return d===void 0&&(d=null),Sf({pathname:typeof l=="string"?l:l.pathname,search:"",hash:""},typeof a=="string"?xu(a):a,{state:d,key:a&&a.key||h||NK()})}function Fg(l){let{pathname:a="/",search:d="",hash:h=""}=l;return d&&d!=="?"&&(a+=d.charAt(0)==="?"?d:"?"+d),h&&h!=="#"&&(a+=h.charAt(0)==="#"?h:"#"+h),a}function xu(l){let a={};if(l){let d=l.indexOf("#");d>=0&&(a.hash=l.substr(d),l=l.substr(0,d));let h=l.indexOf("?");h>=0&&(a.search=l.substr(h),l=l.substr(0,h)),l&&(a.pathname=l)}return a}function DK(l,a,d,h){h===void 0&&(h={});let{window:E=document.defaultView,v5Compat:T=!1}=h,R=E.history,N=Dc.Pop,I=null,j=M();j==null&&(j=0,R.replaceState(Sf({},R.state,{idx:j}),""));function M(){return(R.state||{idx:null}).idx}function F(){N=Dc.Pop;let re=M(),se=re==null?null:re-j;j=re,I&&I({action:N,location:q.location,delta:se})}function Y(re,se){N=Dc.Push;let $=hw(q.location,re,se);j=M()+1;let Q=SU($,j),me=q.createHref($);try{R.pushState(Q,"",me)}catch(Ee){if(Ee instanceof DOMException&&Ee.name==="DataCloneError")throw Ee;E.location.assign(me)}T&&I&&I({action:N,location:q.location,delta:1})}function Z(re,se){N=Dc.Replace;let $=hw(q.location,re,se);j=M();let Q=SU($,j),me=q.createHref($);R.replaceState(Q,"",me),T&&I&&I({action:N,location:q.location,delta:0})}function X(re){let se=E.location.origin!=="null"?E.location.origin:E.location.href,$=typeof re=="string"?re:Fg(re);return $=$.replace(/ $/,"%20"),fi(se,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,se)}let q={get action(){return N},get location(){return l(E,R)},listen(re){if(I)throw new Error("A history only accepts one active listener");return E.addEventListener(gU,F),I=re,()=>{E.removeEventListener(gU,F),I=null}},createHref(re){return a(E,re)},createURL:X,encodeLocation(re){let se=X(re);return{pathname:se.pathname,search:se.search,hash:se.hash}},push:Y,replace:Z,go(re){return R.go(re)}};return q}var TU;(function(l){l.data="data",l.deferred="deferred",l.redirect="redirect",l.error="error"})(TU||(TU={}));function PK(l,a,d){return d===void 0&&(d="/"),LK(l,a,d,!1)}function LK(l,a,d,h){let E=typeof a=="string"?xu(a):a,T=Lw(E.pathname||"/",d);if(T==null)return null;let R=dj(l);kK(R);let N=null;for(let I=0;N==null&&I<R.length;++I){let j=KK(T);N=HK(R[I],j,h)}return N}function dj(l,a,d,h){a===void 0&&(a=[]),d===void 0&&(d=[]),h===void 0&&(h="");let E=(T,R,N)=>{let I={relativePath:N===void 0?T.path||"":N,caseSensitive:T.caseSensitive===!0,childrenIndex:R,route:T};I.relativePath.startsWith("/")&&(fi(I.relativePath.startsWith(h),'Absolute route path "'+I.relativePath+'" nested under path '+('"'+h+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),I.relativePath=I.relativePath.slice(h.length));let j=Lc([h,I.relativePath]),M=d.concat(I);T.children&&T.children.length>0&&(fi(T.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+j+'".')),dj(T.children,a,M,j)),!(T.path==null&&!T.index)&&a.push({path:j,score:BK(j,T.index),routesMeta:M})};return l.forEach((T,R)=>{var N;if(T.path===""||!((N=T.path)!=null&&N.includes("?")))E(T,R);else for(let I of uj(T.path))E(T,R,I)}),a}function uj(l){let a=l.split("/");if(a.length===0)return[];let[d,...h]=a,E=d.endsWith("?"),T=d.replace(/\?$/,"");if(h.length===0)return E?[T,""]:[T];let R=uj(h.join("/")),N=[];return N.push(...R.map(I=>I===""?T:[T,I].join("/"))),E&&N.push(...R),N.map(I=>l.startsWith("/")&&I===""?"/":I)}function kK(l){l.sort((a,d)=>a.score!==d.score?d.score-a.score:GK(a.routesMeta.map(h=>h.childrenIndex),d.routesMeta.map(h=>h.childrenIndex)))}const xK=/^:[\w-]+$/,MK=3,UK=2,jK=1,VK=10,FK=-2,vU=l=>l==="*";function BK(l,a){let d=l.split("/"),h=d.length;return d.some(vU)&&(h+=FK),a&&(h+=UK),d.filter(E=>!vU(E)).reduce((E,T)=>E+(xK.test(T)?MK:T===""?jK:VK),h)}function GK(l,a){return l.length===a.length&&l.slice(0,-1).every((h,E)=>h===a[E])?l[l.length-1]-a[a.length-1]:0}function HK(l,a,d){let{routesMeta:h}=l,E={},T="/",R=[];for(let N=0;N<h.length;++N){let I=h[N],j=N===h.length-1,M=T==="/"?a:a.slice(T.length)||"/",F=yU({path:I.relativePath,caseSensitive:I.caseSensitive,end:j},M),Y=I.route;if(!F&&j&&d&&!h[h.length-1].route.index&&(F=yU({path:I.relativePath,caseSensitive:I.caseSensitive,end:!1},M)),!F)return null;Object.assign(E,F.params),R.push({params:E,pathname:Lc([T,F.pathname]),pathnameBase:$K(Lc([T,F.pathnameBase])),route:Y}),F.pathnameBase!=="/"&&(T=Lc([T,F.pathnameBase]))}return R}function yU(l,a){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[d,h]=WK(l.path,l.caseSensitive,l.end),E=a.match(d);if(!E)return null;let T=E[0],R=T.replace(/(.)\/+$/,"$1"),N=E.slice(1);return{params:h.reduce((j,M,F)=>{let{paramName:Y,isOptional:Z}=M;if(Y==="*"){let q=N[F]||"";R=T.slice(0,T.length-q.length).replace(/(.)\/+$/,"$1")}const X=N[F];return Z&&!X?j[Y]=void 0:j[Y]=(X||"").replace(/%2F/g,"/"),j},{}),pathname:T,pathnameBase:R,pattern:l}}function WK(l,a,d){a===void 0&&(a=!1),d===void 0&&(d=!0),lj(l==="*"||!l.endsWith("*")||l.endsWith("/*"),'Route path "'+l+'" will be treated as if it were '+('"'+l.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+l.replace(/\*$/,"/*")+'".'));let h=[],E="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,N,I)=>(h.push({paramName:N,isOptional:I!=null}),I?"/?([^\\/]+)?":"/([^\\/]+)"));return l.endsWith("*")?(h.push({paramName:"*"}),E+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?E+="\\/*$":l!==""&&l!=="/"&&(E+="(?:(?=\\/|$))"),[new RegExp(E,a?void 0:"i"),h]}function KK(l){try{return l.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return lj(!1,'The URL path "'+l+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+a+").")),l}}function Lw(l,a){if(a==="/")return l;if(!l.toLowerCase().startsWith(a.toLowerCase()))return null;let d=a.endsWith("/")?a.length-1:a.length,h=l.charAt(d);return h&&h!=="/"?null:l.slice(d)||"/"}function YK(l,a){a===void 0&&(a="/");let{pathname:d,search:h="",hash:E=""}=typeof l=="string"?xu(l):l;return{pathname:d?d.startsWith("/")?d:zK(d,a):a,search:JK(h),hash:XK(E)}}function zK(l,a){let d=a.replace(/\/+$/,"").split("/");return l.split("/").forEach(E=>{E===".."?d.length>1&&d.pop():E!=="."&&d.push(E)}),d.length>1?d.join("/"):"/"}function $C(l,a,d,h){return"Cannot include a '"+l+"' character in a manually specified "+("`to."+a+"` field ["+JSON.stringify(h)+"].  Please separate it out to the ")+("`to."+d+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function qK(l){return l.filter((a,d)=>d===0||a.route.path&&a.route.path.length>0)}function kw(l,a){let d=qK(l);return a?d.map((h,E)=>E===d.length-1?h.pathname:h.pathnameBase):d.map(h=>h.pathnameBase)}function xw(l,a,d,h){h===void 0&&(h=!1);let E;typeof l=="string"?E=xu(l):(E=Sf({},l),fi(!E.pathname||!E.pathname.includes("?"),$C("?","pathname","search",E)),fi(!E.pathname||!E.pathname.includes("#"),$C("#","pathname","hash",E)),fi(!E.search||!E.search.includes("#"),$C("#","search","hash",E)));let T=l===""||E.pathname==="",R=T?"/":E.pathname,N;if(R==null)N=d;else{let F=a.length-1;if(!h&&R.startsWith("..")){let Y=R.split("/");for(;Y[0]==="..";)Y.shift(),F-=1;E.pathname=Y.join("/")}N=F>=0?a[F]:"/"}let I=YK(E,N),j=R&&R!=="/"&&R.endsWith("/"),M=(T||R===".")&&d.endsWith("/");return!I.pathname.endsWith("/")&&(j||M)&&(I.pathname+="/"),I}const Lc=l=>l.join("/").replace(/\/\/+/g,"/"),$K=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),JK=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,XK=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function QK(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}const hj=["post","put","patch","delete"];new Set(hj);const ZK=["get",...hj];new Set(ZK);/**
 * React Router v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tf(){return Tf=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var d=arguments[a];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])}return l},Tf.apply(this,arguments)}const Mw=ie.createContext(null),eY=ie.createContext(null),xc=ie.createContext(null),tS=ie.createContext(null),Mc=ie.createContext({outlet:null,matches:[],isDataRoute:!1}),pj=ie.createContext(null);function tY(l,a){let{relative:d}=a===void 0?{}:a;Mu()||fi(!1);let{basename:h,navigator:E}=ie.useContext(xc),{hash:T,pathname:R,search:N}=mj(l,{relative:d}),I=R;return h!=="/"&&(I=R==="/"?h:Lc([h,R])),E.createHref({pathname:I,search:N,hash:T})}function Mu(){return ie.useContext(tS)!=null}function yf(){return Mu()||fi(!1),ie.useContext(tS).location}function fj(l){ie.useContext(xc).static||ie.useLayoutEffect(l)}function io(){let{isDataRoute:l}=ie.useContext(Mc);return l?fY():nY()}function nY(){Mu()||fi(!1);let l=ie.useContext(Mw),{basename:a,future:d,navigator:h}=ie.useContext(xc),{matches:E}=ie.useContext(Mc),{pathname:T}=yf(),R=JSON.stringify(kw(E,d.v7_relativeSplatPath)),N=ie.useRef(!1);return fj(()=>{N.current=!0}),ie.useCallback(function(j,M){if(M===void 0&&(M={}),!N.current)return;if(typeof j=="number"){h.go(j);return}let F=xw(j,JSON.parse(R),T,M.relative==="path");l==null&&a!=="/"&&(F.pathname=F.pathname==="/"?a:Lc([a,F.pathname])),(M.replace?h.replace:h.push)(F,M.state,M)},[a,h,R,T,l])}function mj(l,a){let{relative:d}=a===void 0?{}:a,{future:h}=ie.useContext(xc),{matches:E}=ie.useContext(Mc),{pathname:T}=yf(),R=JSON.stringify(kw(E,h.v7_relativeSplatPath));return ie.useMemo(()=>xw(l,JSON.parse(R),T,d==="path"),[l,R,T,d])}function iY(l,a){return rY(l,a)}function rY(l,a,d,h){Mu()||fi(!1);let{navigator:E}=ie.useContext(xc),{matches:T}=ie.useContext(Mc),R=T[T.length-1],N=R?R.params:{};R&&R.pathname;let I=R?R.pathnameBase:"/";R&&R.route;let j=yf(),M;if(a){var F;let re=typeof a=="string"?xu(a):a;I==="/"||(F=re.pathname)!=null&&F.startsWith(I)||fi(!1),M=re}else M=j;let Y=M.pathname||"/",Z=Y;if(I!=="/"){let re=I.replace(/^\//,"").split("/");Z="/"+Y.replace(/^\//,"").split("/").slice(re.length).join("/")}let X=PK(l,{pathname:Z}),q=lY(X&&X.map(re=>Object.assign({},re,{params:Object.assign({},N,re.params),pathname:Lc([I,E.encodeLocation?E.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?I:Lc([I,E.encodeLocation?E.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),T,d,h);return a&&q?ie.createElement(tS.Provider,{value:{location:Tf({pathname:"/",search:"",hash:"",state:null,key:"default"},M),navigationType:Dc.Pop}},q):q}function sY(){let l=pY(),a=QK(l)?l.status+" "+l.statusText:l instanceof Error?l.message:JSON.stringify(l),d=l instanceof Error?l.stack:null,E={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ie.createElement(ie.Fragment,null,ie.createElement("h2",null,"Unexpected Application Error!"),ie.createElement("h3",{style:{fontStyle:"italic"}},a),d?ie.createElement("pre",{style:E},d):null,null)}const oY=ie.createElement(sY,null);class aY extends ie.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,d){return d.location!==a.location||d.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:d.error,location:d.location,revalidation:a.revalidation||d.revalidation}}componentDidCatch(a,d){console.error("React Router caught the following error during render",a,d)}render(){return this.state.error!==void 0?ie.createElement(Mc.Provider,{value:this.props.routeContext},ie.createElement(pj.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function cY(l){let{routeContext:a,match:d,children:h}=l,E=ie.useContext(Mw);return E&&E.static&&E.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(E.staticContext._deepestRenderedBoundaryId=d.route.id),ie.createElement(Mc.Provider,{value:a},h)}function lY(l,a,d,h){var E;if(a===void 0&&(a=[]),d===void 0&&(d=null),h===void 0&&(h=null),l==null){var T;if(!d)return null;if(d.errors)l=d.matches;else if((T=h)!=null&&T.v7_partialHydration&&a.length===0&&!d.initialized&&d.matches.length>0)l=d.matches;else return null}let R=l,N=(E=d)==null?void 0:E.errors;if(N!=null){let M=R.findIndex(F=>F.route.id&&(N==null?void 0:N[F.route.id])!==void 0);M>=0||fi(!1),R=R.slice(0,Math.min(R.length,M+1))}let I=!1,j=-1;if(d&&h&&h.v7_partialHydration)for(let M=0;M<R.length;M++){let F=R[M];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(j=M),F.route.id){let{loaderData:Y,errors:Z}=d,X=F.route.loader&&Y[F.route.id]===void 0&&(!Z||Z[F.route.id]===void 0);if(F.route.lazy||X){I=!0,j>=0?R=R.slice(0,j+1):R=[R[0]];break}}}return R.reduceRight((M,F,Y)=>{let Z,X=!1,q=null,re=null;d&&(Z=N&&F.route.id?N[F.route.id]:void 0,q=F.route.errorElement||oY,I&&(j<0&&Y===0?(X=!0,re=null):j===Y&&(X=!0,re=F.route.hydrateFallbackElement||null)));let se=a.concat(R.slice(0,Y+1)),$=()=>{let Q;return Z?Q=q:X?Q=re:F.route.Component?Q=ie.createElement(F.route.Component,null):F.route.element?Q=F.route.element:Q=M,ie.createElement(cY,{match:F,routeContext:{outlet:M,matches:se,isDataRoute:d!=null},children:Q})};return d&&(F.route.ErrorBoundary||F.route.errorElement||Y===0)?ie.createElement(aY,{location:d.location,revalidation:d.revalidation,component:q,error:Z,children:$(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):$()},null)}var _j=function(l){return l.UseBlocker="useBlocker",l.UseRevalidator="useRevalidator",l.UseNavigateStable="useNavigate",l}(_j||{}),Bg=function(l){return l.UseBlocker="useBlocker",l.UseLoaderData="useLoaderData",l.UseActionData="useActionData",l.UseRouteError="useRouteError",l.UseNavigation="useNavigation",l.UseRouteLoaderData="useRouteLoaderData",l.UseMatches="useMatches",l.UseRevalidator="useRevalidator",l.UseNavigateStable="useNavigate",l.UseRouteId="useRouteId",l}(Bg||{});function dY(l){let a=ie.useContext(Mw);return a||fi(!1),a}function uY(l){let a=ie.useContext(eY);return a||fi(!1),a}function hY(l){let a=ie.useContext(Mc);return a||fi(!1),a}function Ej(l){let a=hY(),d=a.matches[a.matches.length-1];return d.route.id||fi(!1),d.route.id}function pY(){var l;let a=ie.useContext(pj),d=uY(Bg.UseRouteError),h=Ej(Bg.UseRouteError);return a!==void 0?a:(l=d.errors)==null?void 0:l[h]}function fY(){let{router:l}=dY(_j.UseNavigateStable),a=Ej(Bg.UseNavigateStable),d=ie.useRef(!1);return fj(()=>{d.current=!0}),ie.useCallback(function(E,T){T===void 0&&(T={}),d.current&&(typeof E=="number"?l.navigate(E):l.navigate(E,Tf({fromRouteId:a},T)))},[l,a])}const RU={};function mY(l,a){RU[a]||(RU[a]=!0,console.warn(a))}const bU=(l,a,d)=>mY(l,"⚠️ React Router Future Flag Warning: "+a+". "+("You can use the `"+l+"` future flag to opt-in early. ")+("For more information, see "+d+"."));function _Y(l,a){l!=null&&l.v7_startTransition||bU("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),!(l!=null&&l.v7_relativeSplatPath)&&!a&&bU("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath")}function EY(l){let{to:a,replace:d,state:h,relative:E}=l;Mu()||fi(!1);let{future:T,static:R}=ie.useContext(xc),{matches:N}=ie.useContext(Mc),{pathname:I}=yf(),j=io(),M=xw(a,kw(N,T.v7_relativeSplatPath),I,E==="path"),F=JSON.stringify(M);return ie.useEffect(()=>j(JSON.parse(F),{replace:d,state:h,relative:E}),[j,F,E,d,h]),null}function ei(l){fi(!1)}function gY(l){let{basename:a="/",children:d=null,location:h,navigationType:E=Dc.Pop,navigator:T,static:R=!1,future:N}=l;Mu()&&fi(!1);let I=a.replace(/^\/*/,"/"),j=ie.useMemo(()=>({basename:I,navigator:T,static:R,future:Tf({v7_relativeSplatPath:!1},N)}),[I,N,T,R]);typeof h=="string"&&(h=xu(h));let{pathname:M="/",search:F="",hash:Y="",state:Z=null,key:X="default"}=h,q=ie.useMemo(()=>{let re=Lw(M,I);return re==null?null:{location:{pathname:re,search:F,hash:Y,state:Z,key:X},navigationType:E}},[I,M,F,Y,Z,X,E]);return q==null?null:ie.createElement(xc.Provider,{value:j},ie.createElement(tS.Provider,{children:d,value:q}))}function SY(l){let{children:a,location:d}=l;return iY(pw(a),d)}new Promise(()=>{});function pw(l,a){a===void 0&&(a=[]);let d=[];return ie.Children.forEach(l,(h,E)=>{if(!ie.isValidElement(h))return;let T=[...a,E];if(h.type===ie.Fragment){d.push.apply(d,pw(h.props.children,T));return}h.type!==ei&&fi(!1),!h.props.index||!h.props.children||fi(!1);let R={id:h.props.id||T.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,loader:h.props.loader,action:h.props.action,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(R.children=pw(h.props.children,T)),d.push(R)}),d}/**
 * React Router DOM v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fw(){return fw=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var d=arguments[a];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])}return l},fw.apply(this,arguments)}function TY(l,a){if(l==null)return{};var d={},h=Object.keys(l),E,T;for(T=0;T<h.length;T++)E=h[T],!(a.indexOf(E)>=0)&&(d[E]=l[E]);return d}function vY(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function yY(l,a){return l.button===0&&(!a||a==="_self")&&!vY(l)}const RY=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],bY="6";try{window.__reactRouterVersion=bY}catch{}const CY="startTransition",CU=yK[CY];function wY(l){let{basename:a,children:d,future:h,window:E}=l,T=ie.useRef();T.current==null&&(T.current=OK({window:E,v5Compat:!0}));let R=T.current,[N,I]=ie.useState({action:R.action,location:R.location}),{v7_startTransition:j}=h||{},M=ie.useCallback(F=>{j&&CU?CU(()=>I(F)):I(F)},[I,j]);return ie.useLayoutEffect(()=>R.listen(M),[R,M]),ie.useEffect(()=>_Y(h),[h]),ie.createElement(gY,{basename:a,children:d,location:N.location,navigationType:N.action,navigator:R,future:h})}const AY=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",IY=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,un=ie.forwardRef(function(a,d){let{onClick:h,relative:E,reloadDocument:T,replace:R,state:N,target:I,to:j,preventScrollReset:M,viewTransition:F}=a,Y=TY(a,RY),{basename:Z}=ie.useContext(xc),X,q=!1;if(typeof j=="string"&&IY.test(j)&&(X=j,AY))try{let Q=new URL(window.location.href),me=j.startsWith("//")?new URL(Q.protocol+j):new URL(j),Ee=Lw(me.pathname,Z);me.origin===Q.origin&&Ee!=null?j=Ee+me.search+me.hash:q=!0}catch{}let re=tY(j,{relative:E}),se=OY(j,{replace:R,state:N,target:I,preventScrollReset:M,relative:E,viewTransition:F});function $(Q){h&&h(Q),Q.defaultPrevented||se(Q)}return ie.createElement("a",fw({},Y,{href:X||re,onClick:q||T?h:$,ref:d,target:I}))});var wU;(function(l){l.UseScrollRestoration="useScrollRestoration",l.UseSubmit="useSubmit",l.UseSubmitFetcher="useSubmitFetcher",l.UseFetcher="useFetcher",l.useViewTransitionState="useViewTransitionState"})(wU||(wU={}));var AU;(function(l){l.UseFetcher="useFetcher",l.UseFetchers="useFetchers",l.UseScrollRestoration="useScrollRestoration"})(AU||(AU={}));function OY(l,a){let{target:d,replace:h,state:E,preventScrollReset:T,relative:R,viewTransition:N}=a===void 0?{}:a,I=io(),j=yf(),M=mj(l,{relative:R});return ie.useCallback(F=>{if(yY(F,d)){F.preventDefault();let Y=h!==void 0?h:Fg(j)===Fg(M);I(l,{replace:Y,state:E,preventScrollReset:T,relative:R,viewTransition:N})}},[j,I,M,h,E,d,l,T,R,N])}var NY={exports:{}};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(l,a){(function(d,h){l.exports=h()})(oj,function(){const d=new Map,h={set(x,S,A){d.has(x)||d.set(x,new Map);const B=d.get(x);if(!B.has(S)&&B.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(B.keys())[0]}.`);return}B.set(S,A)},get(x,S){return d.has(x)&&d.get(x).get(S)||null},remove(x,S){if(!d.has(x))return;const A=d.get(x);A.delete(S),A.size===0&&d.delete(x)}},E=1e6,T=1e3,R="transitionend",N=x=>(x&&window.CSS&&window.CSS.escape&&(x=x.replace(/#([^\s"#']+)/g,(S,A)=>`#${CSS.escape(A)}`)),x),I=x=>x==null?`${x}`:Object.prototype.toString.call(x).match(/\s([a-z]+)/i)[1].toLowerCase(),j=x=>{do x+=Math.floor(Math.random()*E);while(document.getElementById(x));return x},M=x=>{if(!x)return 0;let{transitionDuration:S,transitionDelay:A}=window.getComputedStyle(x);const B=Number.parseFloat(S),J=Number.parseFloat(A);return!B&&!J?0:(S=S.split(",")[0],A=A.split(",")[0],(Number.parseFloat(S)+Number.parseFloat(A))*T)},F=x=>{x.dispatchEvent(new Event(R))},Y=x=>!x||typeof x!="object"?!1:(typeof x.jquery<"u"&&(x=x[0]),typeof x.nodeType<"u"),Z=x=>Y(x)?x.jquery?x[0]:x:typeof x=="string"&&x.length>0?document.querySelector(N(x)):null,X=x=>{if(!Y(x)||x.getClientRects().length===0)return!1;const S=getComputedStyle(x).getPropertyValue("visibility")==="visible",A=x.closest("details:not([open])");if(!A)return S;if(A!==x){const B=x.closest("summary");if(B&&B.parentNode!==A||B===null)return!1}return S},q=x=>!x||x.nodeType!==Node.ELEMENT_NODE||x.classList.contains("disabled")?!0:typeof x.disabled<"u"?x.disabled:x.hasAttribute("disabled")&&x.getAttribute("disabled")!=="false",re=x=>{if(!document.documentElement.attachShadow)return null;if(typeof x.getRootNode=="function"){const S=x.getRootNode();return S instanceof ShadowRoot?S:null}return x instanceof ShadowRoot?x:x.parentNode?re(x.parentNode):null},se=()=>{},$=x=>{x.offsetHeight},Q=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,me=[],Ee=x=>{document.readyState==="loading"?(me.length||document.addEventListener("DOMContentLoaded",()=>{for(const S of me)S()}),me.push(x)):x()},Ue=()=>document.documentElement.dir==="rtl",Oe=x=>{Ee(()=>{const S=Q();if(S){const A=x.NAME,B=S.fn[A];S.fn[A]=x.jQueryInterface,S.fn[A].Constructor=x,S.fn[A].noConflict=()=>(S.fn[A]=B,x.jQueryInterface)}})},xe=(x,S=[],A=x)=>typeof x=="function"?x(...S):A,ye=(x,S,A=!0)=>{if(!A){xe(x);return}const J=M(S)+5;let le=!1;const he=({target:be})=>{be===S&&(le=!0,S.removeEventListener(R,he),xe(x))};S.addEventListener(R,he),setTimeout(()=>{le||F(S)},J)},Le=(x,S,A,B)=>{const J=x.length;let le=x.indexOf(S);return le===-1?!A&&B?x[J-1]:x[0]:(le+=A?1:-1,B&&(le=(le+J)%J),x[Math.max(0,Math.min(le,J-1))])},Ge=/[^.]*(?=\..*)\.|.*/,Qe=/\..*/,We=/::\d+$/,ht={};let Ze=1;const wn={mouseenter:"mouseover",mouseleave:"mouseout"},li=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Ht(x,S){return S&&`${S}::${Ze++}`||x.uidEvent||Ze++}function qt(x){const S=Ht(x);return x.uidEvent=S,ht[S]=ht[S]||{},ht[S]}function ft(x,S){return function A(B){return Bu(B,{delegateTarget:x}),A.oneOff&&ke.off(x,B.type,S),S.apply(x,[B])}}function gr(x,S,A){return function B(J){const le=x.querySelectorAll(S);for(let{target:he}=J;he&&he!==this;he=he.parentNode)for(const be of le)if(be===he)return Bu(J,{delegateTarget:he}),B.oneOff&&ke.off(x,J.type,S,A),A.apply(he,[J])}}function so(x,S,A=null){return Object.values(x).find(B=>B.callable===S&&B.delegationSelector===A)}function Fu(x,S,A){const B=typeof S=="string",J=B?A:S||A;let le=Ns(x);return li.has(le)||(le=x),[B,J,le]}function Cf(x,S,A,B,J){if(typeof S!="string"||!x)return;let[le,he,be]=Fu(S,A,B);S in wn&&(he=(An=>function(Mt){if(!Mt.relatedTarget||Mt.relatedTarget!==Mt.delegateTarget&&!Mt.delegateTarget.contains(Mt.relatedTarget))return An.call(this,Mt)})(he));const Me=qt(x),Je=Me[be]||(Me[be]={}),je=so(Je,he,le?A:null);if(je){je.oneOff=je.oneOff&&J;return}const It=Ht(he,S.replace(Ge,"")),xt=le?gr(x,A,he):ft(x,he);xt.delegationSelector=le?A:null,xt.callable=he,xt.oneOff=J,xt.uidEvent=It,Je[It]=xt,x.addEventListener(be,xt,le)}function ns(x,S,A,B,J){const le=so(S[A],B,J);le&&(x.removeEventListener(A,le,!!J),delete S[A][le.uidEvent])}function Ml(x,S,A,B){const J=S[A]||{};for(const[le,he]of Object.entries(J))le.includes(B)&&ns(x,S,A,he.callable,he.delegationSelector)}function Ns(x){return x=x.replace(Qe,""),wn[x]||x}const ke={on(x,S,A,B){Cf(x,S,A,B,!1)},one(x,S,A,B){Cf(x,S,A,B,!0)},off(x,S,A,B){if(typeof S!="string"||!x)return;const[J,le,he]=Fu(S,A,B),be=he!==S,Me=qt(x),Je=Me[he]||{},je=S.startsWith(".");if(typeof le<"u"){if(!Object.keys(Je).length)return;ns(x,Me,he,le,J?A:null);return}if(je)for(const It of Object.keys(Me))Ml(x,Me,It,S.slice(1));for(const[It,xt]of Object.entries(Je)){const mt=It.replace(We,"");(!be||S.includes(mt))&&ns(x,Me,he,xt.callable,xt.delegationSelector)}},trigger(x,S,A){if(typeof S!="string"||!x)return null;const B=Q(),J=Ns(S),le=S!==J;let he=null,be=!0,Me=!0,Je=!1;le&&B&&(he=B.Event(S,A),B(x).trigger(he),be=!he.isPropagationStopped(),Me=!he.isImmediatePropagationStopped(),Je=he.isDefaultPrevented());const je=Bu(new Event(S,{bubbles:be,cancelable:!0}),A);return Je&&je.preventDefault(),Me&&x.dispatchEvent(je),je.defaultPrevented&&he&&he.preventDefault(),je}};function Bu(x,S={}){for(const[A,B]of Object.entries(S))try{x[A]=B}catch{Object.defineProperty(x,A,{configurable:!0,get(){return B}})}return x}function Ul(x){if(x==="true")return!0;if(x==="false")return!1;if(x===Number(x).toString())return Number(x);if(x===""||x==="null")return null;if(typeof x!="string")return x;try{return JSON.parse(decodeURIComponent(x))}catch{return x}}function Gu(x){return x.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)}const Sr={setDataAttribute(x,S,A){x.setAttribute(`data-bs-${Gu(S)}`,A)},removeDataAttribute(x,S){x.removeAttribute(`data-bs-${Gu(S)}`)},getDataAttributes(x){if(!x)return{};const S={},A=Object.keys(x.dataset).filter(B=>B.startsWith("bs")&&!B.startsWith("bsConfig"));for(const B of A){let J=B.replace(/^bs/,"");J=J.charAt(0).toLowerCase()+J.slice(1,J.length),S[J]=Ul(x.dataset[B])}return S},getDataAttribute(x,S){return Ul(x.getAttribute(`data-bs-${Gu(S)}`))}};class is{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(S){return S=this._mergeConfigObj(S),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}_configAfterMerge(S){return S}_mergeConfigObj(S,A){const B=Y(A)?Sr.getDataAttribute(A,"config"):{};return{...this.constructor.Default,...typeof B=="object"?B:{},...Y(A)?Sr.getDataAttributes(A):{},...typeof S=="object"?S:{}}}_typeCheckConfig(S,A=this.constructor.DefaultType){for(const[B,J]of Object.entries(A)){const le=S[B],he=Y(le)?"element":I(le);if(!new RegExp(J).test(he))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${B}" provided type "${he}" but expected type "${J}".`)}}}const dS="5.3.3";class jr extends is{constructor(S,A){super(),S=Z(S),S&&(this._element=S,this._config=this._getConfig(A),h.set(this._element,this.constructor.DATA_KEY,this))}dispose(){h.remove(this._element,this.constructor.DATA_KEY),ke.off(this._element,this.constructor.EVENT_KEY);for(const S of Object.getOwnPropertyNames(this))this[S]=null}_queueCallback(S,A,B=!0){ye(S,A,B)}_getConfig(S){return S=this._mergeConfigObj(S,this._element),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}static getInstance(S){return h.get(Z(S),this.DATA_KEY)}static getOrCreateInstance(S,A={}){return this.getInstance(S)||new this(S,typeof A=="object"?A:null)}static get VERSION(){return dS}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(S){return`${S}${this.EVENT_KEY}`}}const oo=x=>{let S=x.getAttribute("data-bs-target");if(!S||S==="#"){let A=x.getAttribute("href");if(!A||!A.includes("#")&&!A.startsWith("."))return null;A.includes("#")&&!A.startsWith("#")&&(A=`#${A.split("#")[1]}`),S=A&&A!=="#"?A.trim():null}return S?S.split(",").map(A=>N(A)).join(","):null},rt={find(x,S=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(S,x))},findOne(x,S=document.documentElement){return Element.prototype.querySelector.call(S,x)},children(x,S){return[].concat(...x.children).filter(A=>A.matches(S))},parents(x,S){const A=[];let B=x.parentNode.closest(S);for(;B;)A.push(B),B=B.parentNode.closest(S);return A},prev(x,S){let A=x.previousElementSibling;for(;A;){if(A.matches(S))return[A];A=A.previousElementSibling}return[]},next(x,S){let A=x.nextElementSibling;for(;A;){if(A.matches(S))return[A];A=A.nextElementSibling}return[]},focusableChildren(x){const S=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(A=>`${A}:not([tabindex^="-"])`).join(",");return this.find(S,x).filter(A=>!q(A)&&X(A))},getSelectorFromElement(x){const S=oo(x);return S&&rt.findOne(S)?S:null},getElementFromSelector(x){const S=oo(x);return S?rt.findOne(S):null},getMultipleElementsFromSelector(x){const S=oo(x);return S?rt.find(S):[]}},jl=(x,S="hide")=>{const A=`click.dismiss${x.EVENT_KEY}`,B=x.NAME;ke.on(document,A,`[data-bs-dismiss="${B}"]`,function(J){if(["A","AREA"].includes(this.tagName)&&J.preventDefault(),q(this))return;const le=rt.getElementFromSelector(this)||this.closest(`.${B}`);x.getOrCreateInstance(le)[S]()})},ao="alert",wf=".bs.alert",Ki=`close${wf}`,ir=`closed${wf}`,Hu="fade",Wu="show";class Uc extends jr{static get NAME(){return ao}close(){if(ke.trigger(this._element,Ki).defaultPrevented)return;this._element.classList.remove(Wu);const A=this._element.classList.contains(Hu);this._queueCallback(()=>this._destroyElement(),this._element,A)}_destroyElement(){this._element.remove(),ke.trigger(this._element,ir),this.dispose()}static jQueryInterface(S){return this.each(function(){const A=Uc.getOrCreateInstance(this);if(typeof S=="string"){if(A[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);A[S](this)}})}}jl(Uc,"close"),Oe(Uc);const Af="button",co=".bs.button",If=".data-api",Ku="active",Yu='[data-bs-toggle="button"]',Of=`click${co}${If}`;class Ia extends jr{static get NAME(){return Af}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(Ku))}static jQueryInterface(S){return this.each(function(){const A=Ia.getOrCreateInstance(this);S==="toggle"&&A[S]()})}}ke.on(document,Of,Yu,x=>{x.preventDefault();const S=x.target.closest(Yu);Ia.getOrCreateInstance(S).toggle()}),Oe(Ia);const Nf="swipe",Tr=".bs.swipe",Df=`touchstart${Tr}`,hS=`touchmove${Tr}`,pS=`touchend${Tr}`,Oa=`pointerdown${Tr}`,Pf=`pointerup${Tr}`,fS="touch",mS="pen",_S="pointer-event",ES=40,jc={endCallback:null,leftCallback:null,rightCallback:null},gS={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Ds extends is{constructor(S,A){super(),this._element=S,!(!S||!Ds.isSupported())&&(this._config=this._getConfig(A),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return jc}static get DefaultType(){return gS}static get NAME(){return Nf}dispose(){ke.off(this._element,Tr)}_start(S){if(!this._supportPointerEvents){this._deltaX=S.touches[0].clientX;return}this._eventIsPointerPenTouch(S)&&(this._deltaX=S.clientX)}_end(S){this._eventIsPointerPenTouch(S)&&(this._deltaX=S.clientX-this._deltaX),this._handleSwipe(),xe(this._config.endCallback)}_move(S){this._deltaX=S.touches&&S.touches.length>1?0:S.touches[0].clientX-this._deltaX}_handleSwipe(){const S=Math.abs(this._deltaX);if(S<=ES)return;const A=S/this._deltaX;this._deltaX=0,A&&xe(A>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(ke.on(this._element,Oa,S=>this._start(S)),ke.on(this._element,Pf,S=>this._end(S)),this._element.classList.add(_S)):(ke.on(this._element,Df,S=>this._start(S)),ke.on(this._element,hS,S=>this._move(S)),ke.on(this._element,pS,S=>this._end(S)))}_eventIsPointerPenTouch(S){return this._supportPointerEvents&&(S.pointerType===mS||S.pointerType===fS)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const SS="carousel",lo=".bs.carousel",zi=".data-api",TS="ArrowLeft",vS="ArrowRight",Vl=500,Na="next",Ho="prev",Wo="left",Fl="right",Lf=`slide${lo}`,Bl=`slid${lo}`,yS=`keydown${lo}`,RS=`mouseenter${lo}`,kf=`mouseleave${lo}`,zu=`dragstart${lo}`,xf=`load${lo}${zi}`,Da=`click${lo}${zi}`,Mf="carousel",Gl="active",rs="slide",bS="carousel-item-end",CS="carousel-item-start",Kn="carousel-item-next",wS="carousel-item-prev",Uf=".active",jf=".carousel-item",AS=Uf+jf,qu=".carousel-item img",IS=".carousel-indicators",Vf="[data-bs-slide], [data-bs-slide-to]",OS='[data-bs-ride="carousel"]',NS={[TS]:Fl,[vS]:Wo},DS={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Pa={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class uo extends jr{constructor(S,A){super(S,A),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=rt.findOne(IS,this._element),this._addEventListeners(),this._config.ride===Mf&&this.cycle()}static get Default(){return DS}static get DefaultType(){return Pa}static get NAME(){return SS}next(){this._slide(Na)}nextWhenVisible(){!document.hidden&&X(this._element)&&this.next()}prev(){this._slide(Ho)}pause(){this._isSliding&&F(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){ke.one(this._element,Bl,()=>this.cycle());return}this.cycle()}}to(S){const A=this._getItems();if(S>A.length-1||S<0)return;if(this._isSliding){ke.one(this._element,Bl,()=>this.to(S));return}const B=this._getItemIndex(this._getActive());if(B===S)return;const J=S>B?Na:Ho;this._slide(J,A[S])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(S){return S.defaultInterval=S.interval,S}_addEventListeners(){this._config.keyboard&&ke.on(this._element,yS,S=>this._keydown(S)),this._config.pause==="hover"&&(ke.on(this._element,RS,()=>this.pause()),ke.on(this._element,kf,()=>this._maybeEnableCycle())),this._config.touch&&Ds.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const B of rt.find(qu,this._element))ke.on(B,zu,J=>J.preventDefault());const A={leftCallback:()=>this._slide(this._directionToOrder(Wo)),rightCallback:()=>this._slide(this._directionToOrder(Fl)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),Vl+this._config.interval))}};this._swipeHelper=new Ds(this._element,A)}_keydown(S){if(/input|textarea/i.test(S.target.tagName))return;const A=NS[S.key];A&&(S.preventDefault(),this._slide(this._directionToOrder(A)))}_getItemIndex(S){return this._getItems().indexOf(S)}_setActiveIndicatorElement(S){if(!this._indicatorsElement)return;const A=rt.findOne(Uf,this._indicatorsElement);A.classList.remove(Gl),A.removeAttribute("aria-current");const B=rt.findOne(`[data-bs-slide-to="${S}"]`,this._indicatorsElement);B&&(B.classList.add(Gl),B.setAttribute("aria-current","true"))}_updateInterval(){const S=this._activeElement||this._getActive();if(!S)return;const A=Number.parseInt(S.getAttribute("data-bs-interval"),10);this._config.interval=A||this._config.defaultInterval}_slide(S,A=null){if(this._isSliding)return;const B=this._getActive(),J=S===Na,le=A||Le(this._getItems(),B,J,this._config.wrap);if(le===B)return;const he=this._getItemIndex(le),be=mt=>ke.trigger(this._element,mt,{relatedTarget:le,direction:this._orderToDirection(S),from:this._getItemIndex(B),to:he});if(be(Lf).defaultPrevented||!B||!le)return;const Je=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(he),this._activeElement=le;const je=J?CS:bS,It=J?Kn:wS;le.classList.add(It),$(le),B.classList.add(je),le.classList.add(je);const xt=()=>{le.classList.remove(je,It),le.classList.add(Gl),B.classList.remove(Gl,It,je),this._isSliding=!1,be(Bl)};this._queueCallback(xt,B,this._isAnimated()),Je&&this.cycle()}_isAnimated(){return this._element.classList.contains(rs)}_getActive(){return rt.findOne(AS,this._element)}_getItems(){return rt.find(jf,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(S){return Ue()?S===Wo?Ho:Na:S===Wo?Na:Ho}_orderToDirection(S){return Ue()?S===Ho?Wo:Fl:S===Ho?Fl:Wo}static jQueryInterface(S){return this.each(function(){const A=uo.getOrCreateInstance(this,S);if(typeof S=="number"){A.to(S);return}if(typeof S=="string"){if(A[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);A[S]()}})}}ke.on(document,Da,Vf,function(x){const S=rt.getElementFromSelector(this);if(!S||!S.classList.contains(Mf))return;x.preventDefault();const A=uo.getOrCreateInstance(S),B=this.getAttribute("data-bs-slide-to");if(B){A.to(B),A._maybeEnableCycle();return}if(Sr.getDataAttribute(this,"slide")==="next"){A.next(),A._maybeEnableCycle();return}A.prev(),A._maybeEnableCycle()}),ke.on(window,xf,()=>{const x=rt.find(OS);for(const S of x)uo.getOrCreateInstance(S)}),Oe(uo);const PS="collapse",Vc=".bs.collapse",Ff=".data-api",Bf=`show${Vc}`,LS=`shown${Vc}`,kS=`hide${Vc}`,xS=`hidden${Vc}`,MS=`click${Vc}${Ff}`,$u="show",La="collapse",Ko="collapsing",Gf="collapsed",Ju=`:scope .${La} .${La}`,US="collapse-horizontal",Xu="width",jS="height",Hf=".collapse.show, .collapse.collapsing",Qu='[data-bs-toggle="collapse"]',VS={parent:null,toggle:!0},FS={parent:"(null|element)",toggle:"boolean"};class ka extends jr{constructor(S,A){super(S,A),this._isTransitioning=!1,this._triggerArray=[];const B=rt.find(Qu);for(const J of B){const le=rt.getSelectorFromElement(J),he=rt.find(le).filter(be=>be===this._element);le!==null&&he.length&&this._triggerArray.push(J)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return VS}static get DefaultType(){return FS}static get NAME(){return PS}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let S=[];if(this._config.parent&&(S=this._getFirstLevelChildren(Hf).filter(be=>be!==this._element).map(be=>ka.getOrCreateInstance(be,{toggle:!1}))),S.length&&S[0]._isTransitioning||ke.trigger(this._element,Bf).defaultPrevented)return;for(const be of S)be.hide();const B=this._getDimension();this._element.classList.remove(La),this._element.classList.add(Ko),this._element.style[B]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const J=()=>{this._isTransitioning=!1,this._element.classList.remove(Ko),this._element.classList.add(La,$u),this._element.style[B]="",ke.trigger(this._element,LS)},he=`scroll${B[0].toUpperCase()+B.slice(1)}`;this._queueCallback(J,this._element,!0),this._element.style[B]=`${this._element[he]}px`}hide(){if(this._isTransitioning||!this._isShown()||ke.trigger(this._element,kS).defaultPrevented)return;const A=this._getDimension();this._element.style[A]=`${this._element.getBoundingClientRect()[A]}px`,$(this._element),this._element.classList.add(Ko),this._element.classList.remove(La,$u);for(const J of this._triggerArray){const le=rt.getElementFromSelector(J);le&&!this._isShown(le)&&this._addAriaAndCollapsedClass([J],!1)}this._isTransitioning=!0;const B=()=>{this._isTransitioning=!1,this._element.classList.remove(Ko),this._element.classList.add(La),ke.trigger(this._element,xS)};this._element.style[A]="",this._queueCallback(B,this._element,!0)}_isShown(S=this._element){return S.classList.contains($u)}_configAfterMerge(S){return S.toggle=!!S.toggle,S.parent=Z(S.parent),S}_getDimension(){return this._element.classList.contains(US)?Xu:jS}_initializeChildren(){if(!this._config.parent)return;const S=this._getFirstLevelChildren(Qu);for(const A of S){const B=rt.getElementFromSelector(A);B&&this._addAriaAndCollapsedClass([A],this._isShown(B))}}_getFirstLevelChildren(S){const A=rt.find(Ju,this._config.parent);return rt.find(S,this._config.parent).filter(B=>!A.includes(B))}_addAriaAndCollapsedClass(S,A){if(S.length)for(const B of S)B.classList.toggle(Gf,!A),B.setAttribute("aria-expanded",A)}static jQueryInterface(S){const A={};return typeof S=="string"&&/show|hide/.test(S)&&(A.toggle=!1),this.each(function(){const B=ka.getOrCreateInstance(this,A);if(typeof S=="string"){if(typeof B[S]>"u")throw new TypeError(`No method named "${S}"`);B[S]()}})}}ke.on(document,MS,Qu,function(x){(x.target.tagName==="A"||x.delegateTarget&&x.delegateTarget.tagName==="A")&&x.preventDefault();for(const S of rt.getMultipleElementsFromSelector(this))ka.getOrCreateInstance(S,{toggle:!1}).toggle()}),Oe(ka);var Mi="top",rr="bottom",sr="right",Ui="left",Fc="auto",xa=[Mi,rr,sr,Ui],Yo="start",Ma="end",Ua="clippingParents",Zu="viewport",ja="popper",Wf="reference",eh=xa.reduce(function(x,S){return x.concat([S+"-"+Yo,S+"-"+Ma])},[]),Hl=[].concat(xa,[Fc]).reduce(function(x,S){return x.concat([S,S+"-"+Yo,S+"-"+Ma])},[]),Kf="beforeRead",Yf="read",zf="afterRead",Ps="beforeMain",or="main",th="afterMain",qf="beforeWrite",$f="write",Jf="afterWrite",Si=[Kf,Yf,zf,Ps,or,th,qf,$f,Jf];function ss(x){return x?(x.nodeName||"").toLowerCase():null}function ar(x){if(x==null)return window;if(x.toString()!=="[object Window]"){var S=x.ownerDocument;return S&&S.defaultView||window}return x}function zo(x){var S=ar(x).Element;return x instanceof S||x instanceof Element}function ji(x){var S=ar(x).HTMLElement;return x instanceof S||x instanceof HTMLElement}function Wl(x){if(typeof ShadowRoot>"u")return!1;var S=ar(x).ShadowRoot;return x instanceof S||x instanceof ShadowRoot}function BS(x){var S=x.state;Object.keys(S.elements).forEach(function(A){var B=S.styles[A]||{},J=S.attributes[A]||{},le=S.elements[A];!ji(le)||!ss(le)||(Object.assign(le.style,B),Object.keys(J).forEach(function(he){var be=J[he];be===!1?le.removeAttribute(he):le.setAttribute(he,be===!0?"":be)}))})}function nh(x){var S=x.state,A={popper:{position:S.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(S.elements.popper.style,A.popper),S.styles=A,S.elements.arrow&&Object.assign(S.elements.arrow.style,A.arrow),function(){Object.keys(S.elements).forEach(function(B){var J=S.elements[B],le=S.attributes[B]||{},he=Object.keys(S.styles.hasOwnProperty(B)?S.styles[B]:A[B]),be=he.reduce(function(Me,Je){return Me[Je]="",Me},{});!ji(J)||!ss(J)||(Object.assign(J.style,be),Object.keys(le).forEach(function(Me){J.removeAttribute(Me)}))})}}const ih={name:"applyStyles",enabled:!0,phase:"write",fn:BS,effect:nh,requires:["computeStyles"]};function vr(x){return x.split("-")[0]}var Ls=Math.max,Va=Math.min,Fa=Math.round;function rh(){var x=navigator.userAgentData;return x!=null&&x.brands&&Array.isArray(x.brands)?x.brands.map(function(S){return S.brand+"/"+S.version}).join(" "):navigator.userAgent}function ks(){return!/^((?!chrome|android).)*safari/i.test(rh())}function xs(x,S,A){S===void 0&&(S=!1),A===void 0&&(A=!1);var B=x.getBoundingClientRect(),J=1,le=1;S&&ji(x)&&(J=x.offsetWidth>0&&Fa(B.width)/x.offsetWidth||1,le=x.offsetHeight>0&&Fa(B.height)/x.offsetHeight||1);var he=zo(x)?ar(x):window,be=he.visualViewport,Me=!ks()&&A,Je=(B.left+(Me&&be?be.offsetLeft:0))/J,je=(B.top+(Me&&be?be.offsetTop:0))/le,It=B.width/J,xt=B.height/le;return{width:It,height:xt,top:je,right:Je+It,bottom:je+xt,left:Je,x:Je,y:je}}function sh(x){var S=xs(x),A=x.offsetWidth,B=x.offsetHeight;return Math.abs(S.width-A)<=1&&(A=S.width),Math.abs(S.height-B)<=1&&(B=S.height),{x:x.offsetLeft,y:x.offsetTop,width:A,height:B}}function Xf(x,S){var A=S.getRootNode&&S.getRootNode();if(x.contains(S))return!0;if(A&&Wl(A)){var B=S;do{if(B&&x.isSameNode(B))return!0;B=B.parentNode||B.host}while(B)}return!1}function Ms(x){return ar(x).getComputedStyle(x)}function GS(x){return["table","td","th"].indexOf(ss(x))>=0}function ho(x){return((zo(x)?x.ownerDocument:x.document)||window.document).documentElement}function Us(x){return ss(x)==="html"?x:x.assignedSlot||x.parentNode||(Wl(x)?x.host:null)||ho(x)}function Qf(x){return!ji(x)||Ms(x).position==="fixed"?null:x.offsetParent}function Ba(x){var S=/firefox/i.test(rh()),A=/Trident/i.test(rh());if(A&&ji(x)){var B=Ms(x);if(B.position==="fixed")return null}var J=Us(x);for(Wl(J)&&(J=J.host);ji(J)&&["html","body"].indexOf(ss(J))<0;){var le=Ms(J);if(le.transform!=="none"||le.perspective!=="none"||le.contain==="paint"||["transform","perspective"].indexOf(le.willChange)!==-1||S&&le.willChange==="filter"||S&&le.filter&&le.filter!=="none")return J;J=J.parentNode}return null}function Ga(x){for(var S=ar(x),A=Qf(x);A&&GS(A)&&Ms(A).position==="static";)A=Qf(A);return A&&(ss(A)==="html"||ss(A)==="body"&&Ms(A).position==="static")?S:A||Ba(x)||S}function oh(x){return["top","bottom"].indexOf(x)>=0?"x":"y"}function _t(x,S,A){return Ls(x,Va(S,A))}function HS(x,S,A){var B=_t(x,S,A);return B>A?A:B}function Zf(){return{top:0,right:0,bottom:0,left:0}}function em(x){return Object.assign({},Zf(),x)}function tm(x,S){return S.reduce(function(A,B){return A[B]=x,A},{})}var ah=function(S,A){return S=typeof S=="function"?S(Object.assign({},A.rects,{placement:A.placement})):S,em(typeof S!="number"?S:tm(S,xa))};function WS(x){var S,A=x.state,B=x.name,J=x.options,le=A.elements.arrow,he=A.modifiersData.popperOffsets,be=vr(A.placement),Me=oh(be),Je=[Ui,sr].indexOf(be)>=0,je=Je?"height":"width";if(!(!le||!he)){var It=ah(J.padding,A),xt=sh(le),mt=Me==="y"?Mi:Ui,An=Me==="y"?rr:sr,Mt=A.rects.reference[je]+A.rects.reference[Me]-he[Me]-A.rects.popper[je],Qt=he[Me]-A.rects.reference[Me],In=Ga(le),Yn=In?Me==="y"?In.clientHeight||0:In.clientWidth||0:0,zn=Mt/2-Qt/2,Ut=It[mt],pn=Yn-xt[je]-It[An],sn=Yn/2-xt[je]/2+zn,Gn=_t(Ut,sn,pn),mi=Me;A.modifiersData[B]=(S={},S[mi]=Gn,S.centerOffset=Gn-sn,S)}}function KS(x){var S=x.state,A=x.options,B=A.element,J=B===void 0?"[data-popper-arrow]":B;J!=null&&(typeof J=="string"&&(J=S.elements.popper.querySelector(J),!J)||Xf(S.elements.popper,J)&&(S.elements.arrow=J))}const nm={name:"arrow",enabled:!0,phase:"main",fn:WS,effect:KS,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function po(x){return x.split("-")[1]}var YS={top:"auto",right:"auto",bottom:"auto",left:"auto"};function zS(x,S){var A=x.x,B=x.y,J=S.devicePixelRatio||1;return{x:Fa(A*J)/J||0,y:Fa(B*J)/J||0}}function ch(x){var S,A=x.popper,B=x.popperRect,J=x.placement,le=x.variation,he=x.offsets,be=x.position,Me=x.gpuAcceleration,Je=x.adaptive,je=x.roundOffsets,It=x.isFixed,xt=he.x,mt=xt===void 0?0:xt,An=he.y,Mt=An===void 0?0:An,Qt=typeof je=="function"?je({x:mt,y:Mt}):{x:mt,y:Mt};mt=Qt.x,Mt=Qt.y;var In=he.hasOwnProperty("x"),Yn=he.hasOwnProperty("y"),zn=Ui,Ut=Mi,pn=window;if(Je){var sn=Ga(A),Gn="clientHeight",mi="clientWidth";if(sn===ar(A)&&(sn=ho(A),Ms(sn).position!=="static"&&be==="absolute"&&(Gn="scrollHeight",mi="scrollWidth")),sn=sn,J===Mi||(J===Ui||J===sr)&&le===Ma){Ut=rr;var _i=It&&sn===pn&&pn.visualViewport?pn.visualViewport.height:sn[Gn];Mt-=_i-B.height,Mt*=Me?1:-1}if(J===Ui||(J===Mi||J===rr)&&le===Ma){zn=sr;var di=It&&sn===pn&&pn.visualViewport?pn.visualViewport.width:sn[mi];mt-=di-B.width,mt*=Me?1:-1}}var Ti=Object.assign({position:be},Je&&YS),Br=je===!0?zS({x:mt,y:Mt},ar(A)):{x:mt,y:Mt};if(mt=Br.x,Mt=Br.y,Me){var Fi;return Object.assign({},Ti,(Fi={},Fi[Ut]=Yn?"0":"",Fi[zn]=In?"0":"",Fi.transform=(pn.devicePixelRatio||1)<=1?"translate("+mt+"px, "+Mt+"px)":"translate3d("+mt+"px, "+Mt+"px, 0)",Fi))}return Object.assign({},Ti,(S={},S[Ut]=Yn?Mt+"px":"",S[zn]=In?mt+"px":"",S.transform="",S))}function qS(x){var S=x.state,A=x.options,B=A.gpuAcceleration,J=B===void 0?!0:B,le=A.adaptive,he=le===void 0?!0:le,be=A.roundOffsets,Me=be===void 0?!0:be,Je={placement:vr(S.placement),variation:po(S.placement),popper:S.elements.popper,popperRect:S.rects.popper,gpuAcceleration:J,isFixed:S.options.strategy==="fixed"};S.modifiersData.popperOffsets!=null&&(S.styles.popper=Object.assign({},S.styles.popper,ch(Object.assign({},Je,{offsets:S.modifiersData.popperOffsets,position:S.options.strategy,adaptive:he,roundOffsets:Me})))),S.modifiersData.arrow!=null&&(S.styles.arrow=Object.assign({},S.styles.arrow,ch(Object.assign({},Je,{offsets:S.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Me})))),S.attributes.popper=Object.assign({},S.attributes.popper,{"data-popper-placement":S.placement})}const Vr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:qS,data:{}};var Kl={passive:!0};function $S(x){var S=x.state,A=x.instance,B=x.options,J=B.scroll,le=J===void 0?!0:J,he=B.resize,be=he===void 0?!0:he,Me=ar(S.elements.popper),Je=[].concat(S.scrollParents.reference,S.scrollParents.popper);return le&&Je.forEach(function(je){je.addEventListener("scroll",A.update,Kl)}),be&&Me.addEventListener("resize",A.update,Kl),function(){le&&Je.forEach(function(je){je.removeEventListener("scroll",A.update,Kl)}),be&&Me.removeEventListener("resize",A.update,Kl)}}const lh={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:$S,data:{}};var im={left:"right",right:"left",bottom:"top",top:"bottom"};function Ha(x){return x.replace(/left|right|bottom|top/g,function(S){return im[S]})}var JS={start:"end",end:"start"};function rm(x){return x.replace(/start|end/g,function(S){return JS[S]})}function qi(x){var S=ar(x),A=S.pageXOffset,B=S.pageYOffset;return{scrollLeft:A,scrollTop:B}}function dh(x){return xs(ho(x)).left+qi(x).scrollLeft}function XS(x,S){var A=ar(x),B=ho(x),J=A.visualViewport,le=B.clientWidth,he=B.clientHeight,be=0,Me=0;if(J){le=J.width,he=J.height;var Je=ks();(Je||!Je&&S==="fixed")&&(be=J.offsetLeft,Me=J.offsetTop)}return{width:le,height:he,x:be+dh(x),y:Me}}function QS(x){var S,A=ho(x),B=qi(x),J=(S=x.ownerDocument)==null?void 0:S.body,le=Ls(A.scrollWidth,A.clientWidth,J?J.scrollWidth:0,J?J.clientWidth:0),he=Ls(A.scrollHeight,A.clientHeight,J?J.scrollHeight:0,J?J.clientHeight:0),be=-B.scrollLeft+dh(x),Me=-B.scrollTop;return Ms(J||A).direction==="rtl"&&(be+=Ls(A.clientWidth,J?J.clientWidth:0)-le),{width:le,height:he,x:be,y:Me}}function uh(x){var S=Ms(x),A=S.overflow,B=S.overflowX,J=S.overflowY;return/auto|scroll|overlay|hidden/.test(A+J+B)}function hh(x){return["html","body","#document"].indexOf(ss(x))>=0?x.ownerDocument.body:ji(x)&&uh(x)?x:hh(Us(x))}function Bc(x,S){var A;S===void 0&&(S=[]);var B=hh(x),J=B===((A=x.ownerDocument)==null?void 0:A.body),le=ar(B),he=J?[le].concat(le.visualViewport||[],uh(B)?B:[]):B,be=S.concat(he);return J?be:be.concat(Bc(Us(he)))}function ph(x){return Object.assign({},x,{left:x.x,top:x.y,right:x.x+x.width,bottom:x.y+x.height})}function sm(x,S){var A=xs(x,!1,S==="fixed");return A.top=A.top+x.clientTop,A.left=A.left+x.clientLeft,A.bottom=A.top+x.clientHeight,A.right=A.left+x.clientWidth,A.width=x.clientWidth,A.height=x.clientHeight,A.x=A.left,A.y=A.top,A}function Yl(x,S,A){return S===Zu?ph(XS(x,A)):zo(S)?sm(S,A):ph(QS(ho(x)))}function ZS(x){var S=Bc(Us(x)),A=["absolute","fixed"].indexOf(Ms(x).position)>=0,B=A&&ji(x)?Ga(x):x;return zo(B)?S.filter(function(J){return zo(J)&&Xf(J,B)&&ss(J)!=="body"}):[]}function eT(x,S,A,B){var J=S==="clippingParents"?ZS(x):[].concat(S),le=[].concat(J,[A]),he=le[0],be=le.reduce(function(Me,Je){var je=Yl(x,Je,B);return Me.top=Ls(je.top,Me.top),Me.right=Va(je.right,Me.right),Me.bottom=Va(je.bottom,Me.bottom),Me.left=Ls(je.left,Me.left),Me},Yl(x,he,B));return be.width=be.right-be.left,be.height=be.bottom-be.top,be.x=be.left,be.y=be.top,be}function Gc(x){var S=x.reference,A=x.element,B=x.placement,J=B?vr(B):null,le=B?po(B):null,he=S.x+S.width/2-A.width/2,be=S.y+S.height/2-A.height/2,Me;switch(J){case Mi:Me={x:he,y:S.y-A.height};break;case rr:Me={x:he,y:S.y+S.height};break;case sr:Me={x:S.x+S.width,y:be};break;case Ui:Me={x:S.x-A.width,y:be};break;default:Me={x:S.x,y:S.y}}var Je=J?oh(J):null;if(Je!=null){var je=Je==="y"?"height":"width";switch(le){case Yo:Me[Je]=Me[Je]-(S[je]/2-A[je]/2);break;case Ma:Me[Je]=Me[Je]+(S[je]/2-A[je]/2);break}}return Me}function Wa(x,S){S===void 0&&(S={});var A=S,B=A.placement,J=B===void 0?x.placement:B,le=A.strategy,he=le===void 0?x.strategy:le,be=A.boundary,Me=be===void 0?Ua:be,Je=A.rootBoundary,je=Je===void 0?Zu:Je,It=A.elementContext,xt=It===void 0?ja:It,mt=A.altBoundary,An=mt===void 0?!1:mt,Mt=A.padding,Qt=Mt===void 0?0:Mt,In=em(typeof Qt!="number"?Qt:tm(Qt,xa)),Yn=xt===ja?Wf:ja,zn=x.rects.popper,Ut=x.elements[An?Yn:xt],pn=eT(zo(Ut)?Ut:Ut.contextElement||ho(x.elements.popper),Me,je,he),sn=xs(x.elements.reference),Gn=Gc({reference:sn,element:zn,strategy:"absolute",placement:J}),mi=ph(Object.assign({},zn,Gn)),_i=xt===ja?mi:sn,di={top:pn.top-_i.top+In.top,bottom:_i.bottom-pn.bottom+In.bottom,left:pn.left-_i.left+In.left,right:_i.right-pn.right+In.right},Ti=x.modifiersData.offset;if(xt===ja&&Ti){var Br=Ti[J];Object.keys(di).forEach(function(Fi){var go=[sr,rr].indexOf(Fi)>=0?1:-1,ia=[Mi,rr].indexOf(Fi)>=0?"y":"x";di[Fi]+=Br[ia]*go})}return di}function tT(x,S){S===void 0&&(S={});var A=S,B=A.placement,J=A.boundary,le=A.rootBoundary,he=A.padding,be=A.flipVariations,Me=A.allowedAutoPlacements,Je=Me===void 0?Hl:Me,je=po(B),It=je?be?eh:eh.filter(function(An){return po(An)===je}):xa,xt=It.filter(function(An){return Je.indexOf(An)>=0});xt.length===0&&(xt=It);var mt=xt.reduce(function(An,Mt){return An[Mt]=Wa(x,{placement:Mt,boundary:J,rootBoundary:le,padding:he})[vr(Mt)],An},{});return Object.keys(mt).sort(function(An,Mt){return mt[An]-mt[Mt]})}function nT(x){if(vr(x)===Fc)return[];var S=Ha(x);return[rm(x),S,rm(S)]}function os(x){var S=x.state,A=x.options,B=x.name;if(!S.modifiersData[B]._skip){for(var J=A.mainAxis,le=J===void 0?!0:J,he=A.altAxis,be=he===void 0?!0:he,Me=A.fallbackPlacements,Je=A.padding,je=A.boundary,It=A.rootBoundary,xt=A.altBoundary,mt=A.flipVariations,An=mt===void 0?!0:mt,Mt=A.allowedAutoPlacements,Qt=S.options.placement,In=vr(Qt),Yn=In===Qt,zn=Me||(Yn||!An?[Ha(Qt)]:nT(Qt)),Ut=[Qt].concat(zn).reduce(function(sa,ls){return sa.concat(vr(ls)===Fc?tT(S,{placement:ls,boundary:je,rootBoundary:It,padding:Je,flipVariations:An,allowedAutoPlacements:Mt}):ls)},[]),pn=S.rects.reference,sn=S.rects.popper,Gn=new Map,mi=!0,_i=Ut[0],di=0;di<Ut.length;di++){var Ti=Ut[di],Br=vr(Ti),Fi=po(Ti)===Yo,go=[Mi,rr].indexOf(Br)>=0,ia=go?"width":"height",Ji=Wa(S,{placement:Ti,boundary:je,rootBoundary:It,altBoundary:xt,padding:Je}),cr=go?Fi?sr:Ui:Fi?rr:Mi;pn[ia]>sn[ia]&&(cr=Ha(cr));var Ed=Ha(cr),ra=[];if(le&&ra.push(Ji[Br]<=0),be&&ra.push(Ji[cr]<=0,Ji[Ed]<=0),ra.every(function(sa){return sa})){_i=Ti,mi=!1;break}Gn.set(Ti,ra)}if(mi)for(var So=An?3:1,gd=function(ls){var To=Ut.find(function(Sd){var oa=Gn.get(Sd);if(oa)return oa.slice(0,ls).every(function(Gh){return Gh})});if(To)return _i=To,"break"},Fs=So;Fs>0;Fs--){var Bs=gd(Fs);if(Bs==="break")break}S.placement!==_i&&(S.modifiersData[B]._skip=!0,S.placement=_i,S.reset=!0)}}const om={name:"flip",enabled:!0,phase:"main",fn:os,requiresIfExists:["offset"],data:{_skip:!1}};function am(x,S,A){return A===void 0&&(A={x:0,y:0}),{top:x.top-S.height-A.y,right:x.right-S.width+A.x,bottom:x.bottom-S.height+A.y,left:x.left-S.width-A.x}}function $i(x){return[Mi,sr,rr,Ui].some(function(S){return x[S]>=0})}function iT(x){var S=x.state,A=x.name,B=S.rects.reference,J=S.rects.popper,le=S.modifiersData.preventOverflow,he=Wa(S,{elementContext:"reference"}),be=Wa(S,{altBoundary:!0}),Me=am(he,B),Je=am(be,J,le),je=$i(Me),It=$i(Je);S.modifiersData[A]={referenceClippingOffsets:Me,popperEscapeOffsets:Je,isReferenceHidden:je,hasPopperEscaped:It},S.attributes.popper=Object.assign({},S.attributes.popper,{"data-popper-reference-hidden":je,"data-popper-escaped":It})}const cm={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:iT};function rT(x,S,A){var B=vr(x),J=[Ui,Mi].indexOf(B)>=0?-1:1,le=typeof A=="function"?A(Object.assign({},S,{placement:x})):A,he=le[0],be=le[1];return he=he||0,be=(be||0)*J,[Ui,sr].indexOf(B)>=0?{x:be,y:he}:{x:he,y:be}}function sT(x){var S=x.state,A=x.options,B=x.name,J=A.offset,le=J===void 0?[0,0]:J,he=Hl.reduce(function(je,It){return je[It]=rT(It,S.rects,le),je},{}),be=he[S.placement],Me=be.x,Je=be.y;S.modifiersData.popperOffsets!=null&&(S.modifiersData.popperOffsets.x+=Me,S.modifiersData.popperOffsets.y+=Je),S.modifiersData[B]=he}const fh={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:sT};function oT(x){var S=x.state,A=x.name;S.modifiersData[A]=Gc({reference:S.rects.reference,element:S.rects.popper,strategy:"absolute",placement:S.placement})}const mh={name:"popperOffsets",enabled:!0,phase:"read",fn:oT,data:{}};function aT(x){return x==="x"?"y":"x"}function lm(x){var S=x.state,A=x.options,B=x.name,J=A.mainAxis,le=J===void 0?!0:J,he=A.altAxis,be=he===void 0?!1:he,Me=A.boundary,Je=A.rootBoundary,je=A.altBoundary,It=A.padding,xt=A.tether,mt=xt===void 0?!0:xt,An=A.tetherOffset,Mt=An===void 0?0:An,Qt=Wa(S,{boundary:Me,rootBoundary:Je,padding:It,altBoundary:je}),In=vr(S.placement),Yn=po(S.placement),zn=!Yn,Ut=oh(In),pn=aT(Ut),sn=S.modifiersData.popperOffsets,Gn=S.rects.reference,mi=S.rects.popper,_i=typeof Mt=="function"?Mt(Object.assign({},S.rects,{placement:S.placement})):Mt,di=typeof _i=="number"?{mainAxis:_i,altAxis:_i}:Object.assign({mainAxis:0,altAxis:0},_i),Ti=S.modifiersData.offset?S.modifiersData.offset[S.placement]:null,Br={x:0,y:0};if(sn){if(le){var Fi,go=Ut==="y"?Mi:Ui,ia=Ut==="y"?rr:sr,Ji=Ut==="y"?"height":"width",cr=sn[Ut],Ed=cr+Qt[go],ra=cr-Qt[ia],So=mt?-mi[Ji]/2:0,gd=Yn===Yo?Gn[Ji]:mi[Ji],Fs=Yn===Yo?-mi[Ji]:-Gn[Ji],Bs=S.elements.arrow,sa=mt&&Bs?sh(Bs):{width:0,height:0},ls=S.modifiersData["arrow#persistent"]?S.modifiersData["arrow#persistent"].padding:Zf(),To=ls[go],Sd=ls[ia],oa=_t(0,Gn[Ji],sa[Ji]),Gh=zn?Gn[Ji]/2-So-oa-To-di.mainAxis:gd-oa-To-di.mainAxis,p_=zn?-Gn[Ji]/2+So+oa+Sd+di.mainAxis:Fs+oa+Sd+di.mainAxis,Hh=S.elements.arrow&&Ga(S.elements.arrow),Yv=Hh?Ut==="y"?Hh.clientTop||0:Hh.clientLeft||0:0,f_=(Fi=Ti==null?void 0:Ti[Ut])!=null?Fi:0,Wh=cr+Gh-f_-Yv,Td=cr+p_-f_,m_=_t(mt?Va(Ed,Wh):Ed,cr,mt?Ls(ra,Td):ra);sn[Ut]=m_,Br[Ut]=m_-cr}if(be){var aa,__=Ut==="x"?Mi:Ui,lr=Ut==="x"?rr:sr,ca=sn[pn],vd=pn==="y"?"height":"width",Kh=ca+Qt[__],E_=ca-Qt[lr],yd=[Mi,Ui].indexOf(In)!==-1,Yh=(aa=Ti==null?void 0:Ti[pn])!=null?aa:0,g_=yd?Kh:ca-Gn[vd]-mi[vd]-Yh+di.altAxis,zh=yd?ca+Gn[vd]+mi[vd]-Yh-di.altAxis:E_,S_=mt&&yd?HS(g_,ca,zh):_t(mt?g_:Kh,ca,mt?zh:E_);sn[pn]=S_,Br[pn]=S_-ca}S.modifiersData[B]=Br}}const dm={name:"preventOverflow",enabled:!0,phase:"main",fn:lm,requiresIfExists:["offset"]};function cT(x){return{scrollLeft:x.scrollLeft,scrollTop:x.scrollTop}}function _h(x){return x===ar(x)||!ji(x)?qi(x):cT(x)}function Eh(x){var S=x.getBoundingClientRect(),A=Fa(S.width)/x.offsetWidth||1,B=Fa(S.height)/x.offsetHeight||1;return A!==1||B!==1}function lT(x,S,A){A===void 0&&(A=!1);var B=ji(S),J=ji(S)&&Eh(S),le=ho(S),he=xs(x,J,A),be={scrollLeft:0,scrollTop:0},Me={x:0,y:0};return(B||!B&&!A)&&((ss(S)!=="body"||uh(le))&&(be=_h(S)),ji(S)?(Me=xs(S,!0),Me.x+=S.clientLeft,Me.y+=S.clientTop):le&&(Me.x=dh(le))),{x:he.left+be.scrollLeft-Me.x,y:he.top+be.scrollTop-Me.y,width:he.width,height:he.height}}function ge(x){var S=new Map,A=new Set,B=[];x.forEach(function(le){S.set(le.name,le)});function J(le){A.add(le.name);var he=[].concat(le.requires||[],le.requiresIfExists||[]);he.forEach(function(be){if(!A.has(be)){var Me=S.get(be);Me&&J(Me)}}),B.push(le)}return x.forEach(function(le){A.has(le.name)||J(le)}),B}function dT(x){var S=ge(x);return Si.reduce(function(A,B){return A.concat(S.filter(function(J){return J.phase===B}))},[])}function uT(x){var S;return function(){return S||(S=new Promise(function(A){Promise.resolve().then(function(){S=void 0,A(x())})})),S}}function hT(x){var S=x.reduce(function(A,B){var J=A[B.name];return A[B.name]=J?Object.assign({},J,B,{options:Object.assign({},J.options,B.options),data:Object.assign({},J.data,B.data)}):B,A},{});return Object.keys(S).map(function(A){return S[A]})}var um={placement:"bottom",modifiers:[],strategy:"absolute"};function hm(){for(var x=arguments.length,S=new Array(x),A=0;A<x;A++)S[A]=arguments[A];return!S.some(function(B){return!(B&&typeof B.getBoundingClientRect=="function")})}function Hc(x){x===void 0&&(x={});var S=x,A=S.defaultModifiers,B=A===void 0?[]:A,J=S.defaultOptions,le=J===void 0?um:J;return function(be,Me,Je){Je===void 0&&(Je=le);var je={placement:"bottom",orderedModifiers:[],options:Object.assign({},um,le),modifiersData:{},elements:{reference:be,popper:Me},attributes:{},styles:{}},It=[],xt=!1,mt={state:je,setOptions:function(In){var Yn=typeof In=="function"?In(je.options):In;Mt(),je.options=Object.assign({},le,je.options,Yn),je.scrollParents={reference:zo(be)?Bc(be):be.contextElement?Bc(be.contextElement):[],popper:Bc(Me)};var zn=dT(hT([].concat(B,je.options.modifiers)));return je.orderedModifiers=zn.filter(function(Ut){return Ut.enabled}),An(),mt.update()},forceUpdate:function(){if(!xt){var In=je.elements,Yn=In.reference,zn=In.popper;if(hm(Yn,zn)){je.rects={reference:lT(Yn,Ga(zn),je.options.strategy==="fixed"),popper:sh(zn)},je.reset=!1,je.placement=je.options.placement,je.orderedModifiers.forEach(function(di){return je.modifiersData[di.name]=Object.assign({},di.data)});for(var Ut=0;Ut<je.orderedModifiers.length;Ut++){if(je.reset===!0){je.reset=!1,Ut=-1;continue}var pn=je.orderedModifiers[Ut],sn=pn.fn,Gn=pn.options,mi=Gn===void 0?{}:Gn,_i=pn.name;typeof sn=="function"&&(je=sn({state:je,options:mi,name:_i,instance:mt})||je)}}}},update:uT(function(){return new Promise(function(Qt){mt.forceUpdate(),Qt(je)})}),destroy:function(){Mt(),xt=!0}};if(!hm(be,Me))return mt;mt.setOptions(Je).then(function(Qt){!xt&&Je.onFirstUpdate&&Je.onFirstUpdate(Qt)});function An(){je.orderedModifiers.forEach(function(Qt){var In=Qt.name,Yn=Qt.options,zn=Yn===void 0?{}:Yn,Ut=Qt.effect;if(typeof Ut=="function"){var pn=Ut({state:je,name:In,instance:mt,options:zn}),sn=function(){};It.push(pn||sn)}})}function Mt(){It.forEach(function(Qt){return Qt()}),It=[]}return mt}}var pT=Hc(),fT=[lh,mh,Vr,ih],zl=Hc({defaultModifiers:fT}),Ka=[lh,mh,Vr,ih,fh,om,dm,nm,cm],gh=Hc({defaultModifiers:Ka});const pm=Object.freeze(Object.defineProperty({__proto__:null,afterMain:th,afterRead:zf,afterWrite:Jf,applyStyles:ih,arrow:nm,auto:Fc,basePlacements:xa,beforeMain:Ps,beforeRead:Kf,beforeWrite:qf,bottom:rr,clippingParents:Ua,computeStyles:Vr,createPopper:gh,createPopperBase:pT,createPopperLite:zl,detectOverflow:Wa,end:Ma,eventListeners:lh,flip:om,hide:cm,left:Ui,main:or,modifierPhases:Si,offset:fh,placements:Hl,popper:ja,popperGenerator:Hc,popperOffsets:mh,preventOverflow:dm,read:Yf,reference:Wf,right:sr,start:Yo,top:Mi,variationPlacements:eh,viewport:Zu,write:$f},Symbol.toStringTag,{value:"Module"})),fm="dropdown",js=".bs.dropdown",Sh=".data-api",mm="Escape",yr="Tab",_m="ArrowUp",Th="ArrowDown",ql=2,qo=`hide${js}`,mT=`hidden${js}`,_T=`show${js}`,Em=`shown${js}`,$l=`click${js}${Sh}`,vh=`keydown${js}${Sh}`,gm=`keyup${js}${Sh}`,fo="show",Sm="dropup",ET="dropend",Tm="dropstart",Jl="dropup-center",gT="dropdown-center",$o='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',ST=`${$o}.${fo}`,Xl=".dropdown-menu",TT=".navbar",vm=".navbar-nav",yh=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",vT=Ue()?"top-end":"top-start",Rh=Ue()?"top-start":"top-end",yT=Ue()?"bottom-end":"bottom-start",RT=Ue()?"bottom-start":"bottom-end",bT=Ue()?"left-start":"right-start",CT=Ue()?"right-start":"left-start",wT="top",AT="bottom",IT={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},OT={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Fr extends jr{constructor(S,A){super(S,A),this._popper=null,this._parent=this._element.parentNode,this._menu=rt.next(this._element,Xl)[0]||rt.prev(this._element,Xl)[0]||rt.findOne(Xl,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return IT}static get DefaultType(){return OT}static get NAME(){return fm}toggle(){return this._isShown()?this.hide():this.show()}show(){if(q(this._element)||this._isShown())return;const S={relatedTarget:this._element};if(!ke.trigger(this._element,_T,S).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(vm))for(const B of[].concat(...document.body.children))ke.on(B,"mouseover",se);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(fo),this._element.classList.add(fo),ke.trigger(this._element,Em,S)}}hide(){if(q(this._element)||!this._isShown())return;const S={relatedTarget:this._element};this._completeHide(S)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(S){if(!ke.trigger(this._element,qo,S).defaultPrevented){if("ontouchstart"in document.documentElement)for(const B of[].concat(...document.body.children))ke.off(B,"mouseover",se);this._popper&&this._popper.destroy(),this._menu.classList.remove(fo),this._element.classList.remove(fo),this._element.setAttribute("aria-expanded","false"),Sr.removeDataAttribute(this._menu,"popper"),ke.trigger(this._element,mT,S)}}_getConfig(S){if(S=super._getConfig(S),typeof S.reference=="object"&&!Y(S.reference)&&typeof S.reference.getBoundingClientRect!="function")throw new TypeError(`${fm.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return S}_createPopper(){if(typeof pm>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let S=this._element;this._config.reference==="parent"?S=this._parent:Y(this._config.reference)?S=Z(this._config.reference):typeof this._config.reference=="object"&&(S=this._config.reference);const A=this._getPopperConfig();this._popper=gh(S,this._menu,A)}_isShown(){return this._menu.classList.contains(fo)}_getPlacement(){const S=this._parent;if(S.classList.contains(ET))return bT;if(S.classList.contains(Tm))return CT;if(S.classList.contains(Jl))return wT;if(S.classList.contains(gT))return AT;const A=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return S.classList.contains(Sm)?A?Rh:vT:A?RT:yT}_detectNavbar(){return this._element.closest(TT)!==null}_getOffset(){const{offset:S}=this._config;return typeof S=="string"?S.split(",").map(A=>Number.parseInt(A,10)):typeof S=="function"?A=>S(A,this._element):S}_getPopperConfig(){const S={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Sr.setDataAttribute(this._menu,"popper","static"),S.modifiers=[{name:"applyStyles",enabled:!1}]),{...S,...xe(this._config.popperConfig,[S])}}_selectMenuItem({key:S,target:A}){const B=rt.find(yh,this._menu).filter(J=>X(J));B.length&&Le(B,A,S===Th,!B.includes(A)).focus()}static jQueryInterface(S){return this.each(function(){const A=Fr.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof A[S]>"u")throw new TypeError(`No method named "${S}"`);A[S]()}})}static clearMenus(S){if(S.button===ql||S.type==="keyup"&&S.key!==yr)return;const A=rt.find(ST);for(const B of A){const J=Fr.getInstance(B);if(!J||J._config.autoClose===!1)continue;const le=S.composedPath(),he=le.includes(J._menu);if(le.includes(J._element)||J._config.autoClose==="inside"&&!he||J._config.autoClose==="outside"&&he||J._menu.contains(S.target)&&(S.type==="keyup"&&S.key===yr||/input|select|option|textarea|form/i.test(S.target.tagName)))continue;const be={relatedTarget:J._element};S.type==="click"&&(be.clickEvent=S),J._completeHide(be)}}static dataApiKeydownHandler(S){const A=/input|textarea/i.test(S.target.tagName),B=S.key===mm,J=[_m,Th].includes(S.key);if(!J&&!B||A&&!B)return;S.preventDefault();const le=this.matches($o)?this:rt.prev(this,$o)[0]||rt.next(this,$o)[0]||rt.findOne($o,S.delegateTarget.parentNode),he=Fr.getOrCreateInstance(le);if(J){S.stopPropagation(),he.show(),he._selectMenuItem(S);return}he._isShown()&&(S.stopPropagation(),he.hide(),le.focus())}}ke.on(document,vh,$o,Fr.dataApiKeydownHandler),ke.on(document,vh,Xl,Fr.dataApiKeydownHandler),ke.on(document,$l,Fr.clearMenus),ke.on(document,gm,Fr.clearMenus),ke.on(document,$l,$o,function(x){x.preventDefault(),Fr.getOrCreateInstance(this).toggle()}),Oe(Fr);const Wc="backdrop",Ql="fade",Zl="show",ym=`mousedown.bs.${Wc}`,NT={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},DT={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class bh extends is{constructor(S){super(),this._config=this._getConfig(S),this._isAppended=!1,this._element=null}static get Default(){return NT}static get DefaultType(){return DT}static get NAME(){return Wc}show(S){if(!this._config.isVisible){xe(S);return}this._append();const A=this._getElement();this._config.isAnimated&&$(A),A.classList.add(Zl),this._emulateAnimation(()=>{xe(S)})}hide(S){if(!this._config.isVisible){xe(S);return}this._getElement().classList.remove(Zl),this._emulateAnimation(()=>{this.dispose(),xe(S)})}dispose(){this._isAppended&&(ke.off(this._element,ym),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const S=document.createElement("div");S.className=this._config.className,this._config.isAnimated&&S.classList.add(Ql),this._element=S}return this._element}_configAfterMerge(S){return S.rootElement=Z(S.rootElement),S}_append(){if(this._isAppended)return;const S=this._getElement();this._config.rootElement.append(S),ke.on(S,ym,()=>{xe(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(S){ye(S,this._getElement(),this._config.isAnimated)}}const Rm="focustrap",ed=".bs.focustrap",PT=`focusin${ed}`,Kc=`keydown.tab${ed}`,LT="Tab",kT="forward",Cm="backward",xT={autofocus:!0,trapElement:null},MT={autofocus:"boolean",trapElement:"element"};class wm extends is{constructor(S){super(),this._config=this._getConfig(S),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return xT}static get DefaultType(){return MT}static get NAME(){return Rm}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),ke.off(document,ed),ke.on(document,PT,S=>this._handleFocusin(S)),ke.on(document,Kc,S=>this._handleKeydown(S)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ke.off(document,ed))}_handleFocusin(S){const{trapElement:A}=this._config;if(S.target===document||S.target===A||A.contains(S.target))return;const B=rt.focusableChildren(A);B.length===0?A.focus():this._lastTabNavDirection===Cm?B[B.length-1].focus():B[0].focus()}_handleKeydown(S){S.key===LT&&(this._lastTabNavDirection=S.shiftKey?Cm:kT)}}const Ch=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Am=".sticky-top",td="padding-right",Im="margin-right";class Yc{constructor(){this._element=document.body}getWidth(){const S=document.documentElement.clientWidth;return Math.abs(window.innerWidth-S)}hide(){const S=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,td,A=>A+S),this._setElementAttributes(Ch,td,A=>A+S),this._setElementAttributes(Am,Im,A=>A-S)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,td),this._resetElementAttributes(Ch,td),this._resetElementAttributes(Am,Im)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(S,A,B){const J=this.getWidth(),le=he=>{if(he!==this._element&&window.innerWidth>he.clientWidth+J)return;this._saveInitialAttribute(he,A);const be=window.getComputedStyle(he).getPropertyValue(A);he.style.setProperty(A,`${B(Number.parseFloat(be))}px`)};this._applyManipulationCallback(S,le)}_saveInitialAttribute(S,A){const B=S.style.getPropertyValue(A);B&&Sr.setDataAttribute(S,A,B)}_resetElementAttributes(S,A){const B=J=>{const le=Sr.getDataAttribute(J,A);if(le===null){J.style.removeProperty(A);return}Sr.removeDataAttribute(J,A),J.style.setProperty(A,le)};this._applyManipulationCallback(S,B)}_applyManipulationCallback(S,A){if(Y(S)){A(S);return}for(const B of rt.find(S,this._element))A(B)}}const UT="modal",Vi=".bs.modal",jT=".data-api",VT="Escape",FT=`hide${Vi}`,BT=`hidePrevented${Vi}`,Om=`hidden${Vi}`,Nm=`show${Vi}`,nd=`shown${Vi}`,Dm=`resize${Vi}`,GT=`click.dismiss${Vi}`,HT=`mousedown.dismiss${Vi}`,Pm=`keydown.dismiss${Vi}`,WT=`click${Vi}${jT}`,Lm="modal-open",KT="fade",id="show",zc="modal-static",km=".modal.show",wh=".modal-dialog",xm=".modal-body",Mm='[data-bs-toggle="modal"]',rd={backdrop:!0,focus:!0,keyboard:!0},qc={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Jo extends jr{constructor(S,A){super(S,A),this._dialog=rt.findOne(wh,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Yc,this._addEventListeners()}static get Default(){return rd}static get DefaultType(){return qc}static get NAME(){return UT}toggle(S){return this._isShown?this.hide():this.show(S)}show(S){this._isShown||this._isTransitioning||ke.trigger(this._element,Nm,{relatedTarget:S}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Lm),this._adjustDialog(),this._backdrop.show(()=>this._showElement(S)))}hide(){!this._isShown||this._isTransitioning||ke.trigger(this._element,FT).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(id),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){ke.off(window,Vi),ke.off(this._dialog,Vi),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bh({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new wm({trapElement:this._element})}_showElement(S){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const A=rt.findOne(xm,this._dialog);A&&(A.scrollTop=0),$(this._element),this._element.classList.add(id);const B=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,ke.trigger(this._element,nd,{relatedTarget:S})};this._queueCallback(B,this._dialog,this._isAnimated())}_addEventListeners(){ke.on(this._element,Pm,S=>{if(S.key===VT){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),ke.on(window,Dm,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),ke.on(this._element,HT,S=>{ke.one(this._element,GT,A=>{if(!(this._element!==S.target||this._element!==A.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Lm),this._resetAdjustments(),this._scrollBar.reset(),ke.trigger(this._element,Om)})}_isAnimated(){return this._element.classList.contains(KT)}_triggerBackdropTransition(){if(ke.trigger(this._element,BT).defaultPrevented)return;const A=this._element.scrollHeight>document.documentElement.clientHeight,B=this._element.style.overflowY;B==="hidden"||this._element.classList.contains(zc)||(A||(this._element.style.overflowY="hidden"),this._element.classList.add(zc),this._queueCallback(()=>{this._element.classList.remove(zc),this._queueCallback(()=>{this._element.style.overflowY=B},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const S=this._element.scrollHeight>document.documentElement.clientHeight,A=this._scrollBar.getWidth(),B=A>0;if(B&&!S){const J=Ue()?"paddingLeft":"paddingRight";this._element.style[J]=`${A}px`}if(!B&&S){const J=Ue()?"paddingRight":"paddingLeft";this._element.style[J]=`${A}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(S,A){return this.each(function(){const B=Jo.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof B[S]>"u")throw new TypeError(`No method named "${S}"`);B[S](A)}})}}ke.on(document,WT,Mm,function(x){const S=rt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&x.preventDefault(),ke.one(S,Nm,J=>{J.defaultPrevented||ke.one(S,Om,()=>{X(this)&&this.focus()})});const A=rt.findOne(km);A&&Jo.getInstance(A).hide(),Jo.getOrCreateInstance(S).toggle(this)}),jl(Jo),Oe(Jo);const YT="offcanvas",Vs=".bs.offcanvas",Um=".data-api",jm=`load${Vs}${Um}`,qT="Escape",Vm="show",Fm="showing",Bm="hiding",$T="offcanvas-backdrop",Gm=".offcanvas.show",Hm=`show${Vs}`,Xo=`shown${Vs}`,JT=`hide${Vs}`,Wm=`hidePrevented${Vs}`,Km=`hidden${Vs}`,Ym=`resize${Vs}`,XT=`click${Vs}${Um}`,zm=`keydown.dismiss${Vs}`,QT='[data-bs-toggle="offcanvas"]',ZT={backdrop:!0,keyboard:!0,scroll:!1},ev={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Rr extends jr{constructor(S,A){super(S,A),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ZT}static get DefaultType(){return ev}static get NAME(){return YT}toggle(S){return this._isShown?this.hide():this.show(S)}show(S){if(this._isShown||ke.trigger(this._element,Hm,{relatedTarget:S}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Yc().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Fm);const B=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(Vm),this._element.classList.remove(Fm),ke.trigger(this._element,Xo,{relatedTarget:S})};this._queueCallback(B,this._element,!0)}hide(){if(!this._isShown||ke.trigger(this._element,JT).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Bm),this._backdrop.hide();const A=()=>{this._element.classList.remove(Vm,Bm),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Yc().reset(),ke.trigger(this._element,Km)};this._queueCallback(A,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const S=()=>{if(this._config.backdrop==="static"){ke.trigger(this._element,Wm);return}this.hide()},A=!!this._config.backdrop;return new bh({className:$T,isVisible:A,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:A?S:null})}_initializeFocusTrap(){return new wm({trapElement:this._element})}_addEventListeners(){ke.on(this._element,zm,S=>{if(S.key===qT){if(this._config.keyboard){this.hide();return}ke.trigger(this._element,Wm)}})}static jQueryInterface(S){return this.each(function(){const A=Rr.getOrCreateInstance(this,S);if(typeof S=="string"){if(A[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);A[S](this)}})}}ke.on(document,XT,QT,function(x){const S=rt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&x.preventDefault(),q(this))return;ke.one(S,Km,()=>{X(this)&&this.focus()});const A=rt.findOne(Gm);A&&A!==S&&Rr.getInstance(A).hide(),Rr.getOrCreateInstance(S).toggle(this)}),ke.on(window,jm,()=>{for(const x of rt.find(Gm))Rr.getOrCreateInstance(x).show()}),ke.on(window,Ym,()=>{for(const x of rt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(x).position!=="fixed"&&Rr.getOrCreateInstance(x).hide()}),jl(Rr),Oe(Rr);const qm={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},tv=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),nv=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,iv=(x,S)=>{const A=x.nodeName.toLowerCase();return S.includes(A)?tv.has(A)?!!nv.test(x.nodeValue):!0:S.filter(B=>B instanceof RegExp).some(B=>B.test(A))};function rv(x,S,A){if(!x.length)return x;if(A&&typeof A=="function")return A(x);const J=new window.DOMParser().parseFromString(x,"text/html"),le=[].concat(...J.body.querySelectorAll("*"));for(const he of le){const be=he.nodeName.toLowerCase();if(!Object.keys(S).includes(be)){he.remove();continue}const Me=[].concat(...he.attributes),Je=[].concat(S["*"]||[],S[be]||[]);for(const je of Me)iv(je,Je)||he.removeAttribute(je.nodeName)}return J.body.innerHTML}const Ah="TemplateFactory",sv={allowList:qm,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},$m={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},ov={entry:"(string|element|function|null)",selector:"(string|element)"};class Jm extends is{constructor(S){super(),this._config=this._getConfig(S)}static get Default(){return sv}static get DefaultType(){return $m}static get NAME(){return Ah}getContent(){return Object.values(this._config.content).map(S=>this._resolvePossibleFunction(S)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(S){return this._checkContent(S),this._config.content={...this._config.content,...S},this}toHtml(){const S=document.createElement("div");S.innerHTML=this._maybeSanitize(this._config.template);for(const[J,le]of Object.entries(this._config.content))this._setContent(S,le,J);const A=S.children[0],B=this._resolvePossibleFunction(this._config.extraClass);return B&&A.classList.add(...B.split(" ")),A}_typeCheckConfig(S){super._typeCheckConfig(S),this._checkContent(S.content)}_checkContent(S){for(const[A,B]of Object.entries(S))super._typeCheckConfig({selector:A,entry:B},ov)}_setContent(S,A,B){const J=rt.findOne(B,S);if(J){if(A=this._resolvePossibleFunction(A),!A){J.remove();return}if(Y(A)){this._putElementInTemplate(Z(A),J);return}if(this._config.html){J.innerHTML=this._maybeSanitize(A);return}J.textContent=A}}_maybeSanitize(S){return this._config.sanitize?rv(S,this._config.allowList,this._config.sanitizeFn):S}_resolvePossibleFunction(S){return xe(S,[this])}_putElementInTemplate(S,A){if(this._config.html){A.innerHTML="",A.append(S);return}A.textContent=S.textContent}}const av="tooltip",cv=new Set(["sanitize","allowList","sanitizeFn"]),Ih="fade",lv="modal",sd="show",dv=".tooltip-inner",Oh=`.${lv}`,Xm="hide.bs.modal",$c="hover",od="focus",uv="click",ad="manual",Qm="hide",Jc="hidden",hv="show",pv="shown",fv="inserted",mv="click",cd="focusin",_v="focusout",Zm="mouseenter",Nh="mouseleave",Dh={AUTO:"auto",TOP:"top",RIGHT:Ue()?"left":"right",BOTTOM:"bottom",LEFT:Ue()?"right":"left"},Ev={allowList:qm,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},gv={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Qo extends jr{constructor(S,A){if(typeof pm>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(S,A),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Ev}static get DefaultType(){return gv}static get NAME(){return av}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),ke.off(this._element.closest(Oh),Xm,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const S=ke.trigger(this._element,this.constructor.eventName(hv)),B=(re(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(S.defaultPrevented||!B)return;this._disposePopper();const J=this._getTipElement();this._element.setAttribute("aria-describedby",J.getAttribute("id"));const{container:le}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(le.append(J),ke.trigger(this._element,this.constructor.eventName(fv))),this._popper=this._createPopper(J),J.classList.add(sd),"ontouchstart"in document.documentElement)for(const be of[].concat(...document.body.children))ke.on(be,"mouseover",se);const he=()=>{ke.trigger(this._element,this.constructor.eventName(pv)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(he,this.tip,this._isAnimated())}hide(){if(!this._isShown()||ke.trigger(this._element,this.constructor.eventName(Qm)).defaultPrevented)return;if(this._getTipElement().classList.remove(sd),"ontouchstart"in document.documentElement)for(const J of[].concat(...document.body.children))ke.off(J,"mouseover",se);this._activeTrigger[uv]=!1,this._activeTrigger[od]=!1,this._activeTrigger[$c]=!1,this._isHovered=null;const B=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ke.trigger(this._element,this.constructor.eventName(Jc)))};this._queueCallback(B,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(S){const A=this._getTemplateFactory(S).toHtml();if(!A)return null;A.classList.remove(Ih,sd),A.classList.add(`bs-${this.constructor.NAME}-auto`);const B=j(this.constructor.NAME).toString();return A.setAttribute("id",B),this._isAnimated()&&A.classList.add(Ih),A}setContent(S){this._newContent=S,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(S){return this._templateFactory?this._templateFactory.changeContent(S):this._templateFactory=new Jm({...this._config,content:S,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[dv]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(S){return this.constructor.getOrCreateInstance(S.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Ih)}_isShown(){return this.tip&&this.tip.classList.contains(sd)}_createPopper(S){const A=xe(this._config.placement,[this,S,this._element]),B=Dh[A.toUpperCase()];return gh(this._element,S,this._getPopperConfig(B))}_getOffset(){const{offset:S}=this._config;return typeof S=="string"?S.split(",").map(A=>Number.parseInt(A,10)):typeof S=="function"?A=>S(A,this._element):S}_resolvePossibleFunction(S){return xe(S,[this._element])}_getPopperConfig(S){const A={placement:S,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:B=>{this._getTipElement().setAttribute("data-popper-placement",B.state.placement)}}]};return{...A,...xe(this._config.popperConfig,[A])}}_setListeners(){const S=this._config.trigger.split(" ");for(const A of S)if(A==="click")ke.on(this._element,this.constructor.eventName(mv),this._config.selector,B=>{this._initializeOnDelegatedTarget(B).toggle()});else if(A!==ad){const B=A===$c?this.constructor.eventName(Zm):this.constructor.eventName(cd),J=A===$c?this.constructor.eventName(Nh):this.constructor.eventName(_v);ke.on(this._element,B,this._config.selector,le=>{const he=this._initializeOnDelegatedTarget(le);he._activeTrigger[le.type==="focusin"?od:$c]=!0,he._enter()}),ke.on(this._element,J,this._config.selector,le=>{const he=this._initializeOnDelegatedTarget(le);he._activeTrigger[le.type==="focusout"?od:$c]=he._element.contains(le.relatedTarget),he._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},ke.on(this._element.closest(Oh),Xm,this._hideModalHandler)}_fixTitle(){const S=this._element.getAttribute("title");S&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",S),this._element.setAttribute("data-bs-original-title",S),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(S,A){clearTimeout(this._timeout),this._timeout=setTimeout(S,A)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(S){const A=Sr.getDataAttributes(this._element);for(const B of Object.keys(A))cv.has(B)&&delete A[B];return S={...A,...typeof S=="object"&&S?S:{}},S=this._mergeConfigObj(S),S=this._configAfterMerge(S),this._typeCheckConfig(S),S}_configAfterMerge(S){return S.container=S.container===!1?document.body:Z(S.container),typeof S.delay=="number"&&(S.delay={show:S.delay,hide:S.delay}),typeof S.title=="number"&&(S.title=S.title.toString()),typeof S.content=="number"&&(S.content=S.content.toString()),S}_getDelegateConfig(){const S={};for(const[A,B]of Object.entries(this._config))this.constructor.Default[A]!==B&&(S[A]=B);return S.selector=!1,S.trigger="manual",S}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(S){return this.each(function(){const A=Qo.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof A[S]>"u")throw new TypeError(`No method named "${S}"`);A[S]()}})}}Oe(Qo);const Sv="popover",Tv=".popover-header",ld=".popover-body",vv={...Qo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Ya={...Qo.DefaultType,content:"(null|string|element|function)"};class za extends Qo{static get Default(){return vv}static get DefaultType(){return Ya}static get NAME(){return Sv}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Tv]:this._getTitle(),[ld]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(S){return this.each(function(){const A=za.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof A[S]>"u")throw new TypeError(`No method named "${S}"`);A[S]()}})}}Oe(za);const dd="scrollspy",qa=".bs.scrollspy",yv=".data-api",e_=`activate${qa}`,t_=`click${qa}`,n_=`load${qa}${yv}`,Rv="dropdown-item",$a="active",Ph='[data-bs-spy="scroll"]',Xc="[href]",bv=".nav, .list-group",i_=".nav-link",wv=`${i_}, .nav-item > ${i_}, .list-group-item`,as=".dropdown",Ja=".dropdown-toggle",Zo={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},s_={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Xa extends jr{constructor(S,A){super(S,A),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Zo}static get DefaultType(){return s_}static get NAME(){return dd}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const S of this._observableSections.values())this._observer.observe(S)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(S){return S.target=Z(S.target)||document.body,S.rootMargin=S.offset?`${S.offset}px 0px -30%`:S.rootMargin,typeof S.threshold=="string"&&(S.threshold=S.threshold.split(",").map(A=>Number.parseFloat(A))),S}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(ke.off(this._config.target,t_),ke.on(this._config.target,t_,Xc,S=>{const A=this._observableSections.get(S.target.hash);if(A){S.preventDefault();const B=this._rootElement||window,J=A.offsetTop-this._element.offsetTop;if(B.scrollTo){B.scrollTo({top:J,behavior:"smooth"});return}B.scrollTop=J}}))}_getNewObserver(){const S={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(A=>this._observerCallback(A),S)}_observerCallback(S){const A=he=>this._targetLinks.get(`#${he.target.id}`),B=he=>{this._previousScrollData.visibleEntryTop=he.target.offsetTop,this._process(A(he))},J=(this._rootElement||document.documentElement).scrollTop,le=J>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=J;for(const he of S){if(!he.isIntersecting){this._activeTarget=null,this._clearActiveClass(A(he));continue}const be=he.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(le&&be){if(B(he),!J)return;continue}!le&&!be&&B(he)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const S=rt.find(Xc,this._config.target);for(const A of S){if(!A.hash||q(A))continue;const B=rt.findOne(decodeURI(A.hash),this._element);X(B)&&(this._targetLinks.set(decodeURI(A.hash),A),this._observableSections.set(A.hash,B))}}_process(S){this._activeTarget!==S&&(this._clearActiveClass(this._config.target),this._activeTarget=S,S.classList.add($a),this._activateParents(S),ke.trigger(this._element,e_,{relatedTarget:S}))}_activateParents(S){if(S.classList.contains(Rv)){rt.findOne(Ja,S.closest(as)).classList.add($a);return}for(const A of rt.parents(S,bv))for(const B of rt.prev(A,wv))B.classList.add($a)}_clearActiveClass(S){S.classList.remove($a);const A=rt.find(`${Xc}.${$a}`,S);for(const B of A)B.classList.remove($a)}static jQueryInterface(S){return this.each(function(){const A=Xa.getOrCreateInstance(this,S);if(typeof S=="string"){if(A[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);A[S]()}})}}ke.on(window,n_,()=>{for(const x of rt.find(Ph))Xa.getOrCreateInstance(x)}),Oe(Xa);const ea="tab",ta=".bs.tab",a_=`hide${ta}`,Av=`hidden${ta}`,Lh=`show${ta}`,c_=`shown${ta}`,Iv=`click${ta}`,mo=`keydown${ta}`,Ov=`load${ta}`,Nv="ArrowLeft",l_="ArrowRight",Dv="ArrowUp",kh="ArrowDown",xh="Home",hd="End",_o="active",d_="fade",pd="show",Pv="dropdown",u_=".dropdown-toggle",Lv=".dropdown-menu",Mh=`:not(${u_})`,kv='.list-group, .nav, [role="tablist"]',xv=".nav-item, .list-group-item",Mv=`.nav-link${Mh}, .list-group-item${Mh}, [role="tab"]${Mh}`,Uh='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',cs=`${Mv}, ${Uh}`,Uv=`.${_o}[data-bs-toggle="tab"], .${_o}[data-bs-toggle="pill"], .${_o}[data-bs-toggle="list"]`;class na extends jr{constructor(S){super(S),this._parent=this._element.closest(kv),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),ke.on(this._element,mo,A=>this._keydown(A)))}static get NAME(){return ea}show(){const S=this._element;if(this._elemIsActive(S))return;const A=this._getActiveElem(),B=A?ke.trigger(A,a_,{relatedTarget:S}):null;ke.trigger(S,Lh,{relatedTarget:A}).defaultPrevented||B&&B.defaultPrevented||(this._deactivate(A,S),this._activate(S,A))}_activate(S,A){if(!S)return;S.classList.add(_o),this._activate(rt.getElementFromSelector(S));const B=()=>{if(S.getAttribute("role")!=="tab"){S.classList.add(pd);return}S.removeAttribute("tabindex"),S.setAttribute("aria-selected",!0),this._toggleDropDown(S,!0),ke.trigger(S,c_,{relatedTarget:A})};this._queueCallback(B,S,S.classList.contains(d_))}_deactivate(S,A){if(!S)return;S.classList.remove(_o),S.blur(),this._deactivate(rt.getElementFromSelector(S));const B=()=>{if(S.getAttribute("role")!=="tab"){S.classList.remove(pd);return}S.setAttribute("aria-selected",!1),S.setAttribute("tabindex","-1"),this._toggleDropDown(S,!1),ke.trigger(S,Av,{relatedTarget:A})};this._queueCallback(B,S,S.classList.contains(d_))}_keydown(S){if(![Nv,l_,Dv,kh,xh,hd].includes(S.key))return;S.stopPropagation(),S.preventDefault();const A=this._getChildren().filter(J=>!q(J));let B;if([xh,hd].includes(S.key))B=A[S.key===xh?0:A.length-1];else{const J=[l_,kh].includes(S.key);B=Le(A,S.target,J,!0)}B&&(B.focus({preventScroll:!0}),na.getOrCreateInstance(B).show())}_getChildren(){return rt.find(cs,this._parent)}_getActiveElem(){return this._getChildren().find(S=>this._elemIsActive(S))||null}_setInitialAttributes(S,A){this._setAttributeIfNotExists(S,"role","tablist");for(const B of A)this._setInitialAttributesOnChild(B)}_setInitialAttributesOnChild(S){S=this._getInnerElement(S);const A=this._elemIsActive(S),B=this._getOuterElement(S);S.setAttribute("aria-selected",A),B!==S&&this._setAttributeIfNotExists(B,"role","presentation"),A||S.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(S,"role","tab"),this._setInitialAttributesOnTargetPanel(S)}_setInitialAttributesOnTargetPanel(S){const A=rt.getElementFromSelector(S);A&&(this._setAttributeIfNotExists(A,"role","tabpanel"),S.id&&this._setAttributeIfNotExists(A,"aria-labelledby",`${S.id}`))}_toggleDropDown(S,A){const B=this._getOuterElement(S);if(!B.classList.contains(Pv))return;const J=(le,he)=>{const be=rt.findOne(le,B);be&&be.classList.toggle(he,A)};J(u_,_o),J(Lv,pd),B.setAttribute("aria-expanded",A)}_setAttributeIfNotExists(S,A,B){S.hasAttribute(A)||S.setAttribute(A,B)}_elemIsActive(S){return S.classList.contains(_o)}_getInnerElement(S){return S.matches(cs)?S:rt.findOne(cs,S)}_getOuterElement(S){return S.closest(xv)||S}static jQueryInterface(S){return this.each(function(){const A=na.getOrCreateInstance(this);if(typeof S=="string"){if(A[S]===void 0||S.startsWith("_")||S==="constructor")throw new TypeError(`No method named "${S}"`);A[S]()}})}}ke.on(document,Iv,Uh,function(x){["A","AREA"].includes(this.tagName)&&x.preventDefault(),!q(this)&&na.getOrCreateInstance(this).show()}),ke.on(window,Ov,()=>{for(const x of rt.find(Uv))na.getOrCreateInstance(x)}),Oe(na);const jv="toast",Eo=".bs.toast",Vv=`mouseover${Eo}`,jh=`mouseout${Eo}`,Fv=`focusin${Eo}`,Bv=`focusout${Eo}`,Gv=`hide${Eo}`,Hv=`hidden${Eo}`,Wv=`show${Eo}`,Kv=`shown${Eo}`,h_="fade",Vh="hide",fd="show",md="showing",_d={animation:"boolean",autohide:"boolean",delay:"number"},Fh={animation:!0,autohide:!0,delay:5e3};class Qa extends jr{constructor(S,A){super(S,A),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Fh}static get DefaultType(){return _d}static get NAME(){return jv}show(){if(ke.trigger(this._element,Wv).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(h_);const A=()=>{this._element.classList.remove(md),ke.trigger(this._element,Kv),this._maybeScheduleHide()};this._element.classList.remove(Vh),$(this._element),this._element.classList.add(fd,md),this._queueCallback(A,this._element,this._config.animation)}hide(){if(!this.isShown()||ke.trigger(this._element,Gv).defaultPrevented)return;const A=()=>{this._element.classList.add(Vh),this._element.classList.remove(md,fd),ke.trigger(this._element,Hv)};this._element.classList.add(md),this._queueCallback(A,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(fd),super.dispose()}isShown(){return this._element.classList.contains(fd)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(S,A){switch(S.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=A;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=A;break}}if(A){this._clearTimeout();return}const B=S.relatedTarget;this._element===B||this._element.contains(B)||this._maybeScheduleHide()}_setListeners(){ke.on(this._element,Vv,S=>this._onInteraction(S,!0)),ke.on(this._element,jh,S=>this._onInteraction(S,!1)),ke.on(this._element,Fv,S=>this._onInteraction(S,!0)),ke.on(this._element,Bv,S=>this._onInteraction(S,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(S){return this.each(function(){const A=Qa.getOrCreateInstance(this,S);if(typeof S=="string"){if(typeof A[S]>"u")throw new TypeError(`No method named "${S}"`);A[S](this)}})}}return jl(Qa),Oe(Qa),{Alert:Uc,Button:Ia,Carousel:uo,Collapse:ka,Dropdown:Fr,Modal:Jo,Offcanvas:Rr,Popover:za,ScrollSpy:Xa,Tab:na,Toast:Qa,Tooltip:Qo}})})(NY);var gj={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},IU=Mn.createContext&&Mn.createContext(gj),DY=["attr","size","title"];function PY(l,a){if(l==null)return{};var d=LY(l,a),h,E;if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(l);for(E=0;E<T.length;E++)h=T[E],!(a.indexOf(h)>=0)&&Object.prototype.propertyIsEnumerable.call(l,h)&&(d[h]=l[h])}return d}function LY(l,a){if(l==null)return{};var d={};for(var h in l)if(Object.prototype.hasOwnProperty.call(l,h)){if(a.indexOf(h)>=0)continue;d[h]=l[h]}return d}function Gg(){return Gg=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var d=arguments[a];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])}return l},Gg.apply(this,arguments)}function OU(l,a){var d=Object.keys(l);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(l);a&&(h=h.filter(function(E){return Object.getOwnPropertyDescriptor(l,E).enumerable})),d.push.apply(d,h)}return d}function Hg(l){for(var a=1;a<arguments.length;a++){var d=arguments[a]!=null?arguments[a]:{};a%2?OU(Object(d),!0).forEach(function(h){kY(l,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(d)):OU(Object(d)).forEach(function(h){Object.defineProperty(l,h,Object.getOwnPropertyDescriptor(d,h))})}return l}function kY(l,a,d){return a=xY(a),a in l?Object.defineProperty(l,a,{value:d,enumerable:!0,configurable:!0,writable:!0}):l[a]=d,l}function xY(l){var a=MY(l,"string");return typeof a=="symbol"?a:a+""}function MY(l,a){if(typeof l!="object"||!l)return l;var d=l[Symbol.toPrimitive];if(d!==void 0){var h=d.call(l,a||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(l)}function Sj(l){return l&&l.map((a,d)=>Mn.createElement(a.tag,Hg({key:d},a.attr),Sj(a.child)))}function Ft(l){return a=>Mn.createElement(UY,Gg({attr:Hg({},l.attr)},a),Sj(l.child))}function UY(l){var a=d=>{var{attr:h,size:E,title:T}=l,R=PY(l,DY),N=E||d.size||"1em",I;return d.className&&(I=d.className),l.className&&(I=(I?I+" ":"")+l.className),Mn.createElement("svg",Gg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},d.attr,h,R,{className:I,style:Hg(Hg({color:l.color||d.color},d.style),l.style),height:N,width:N,xmlns:"http://www.w3.org/2000/svg"}),T&&Mn.createElement("title",null,T),l.children)};return IU!==void 0?Mn.createElement(IU.Consumer,null,d=>a(d)):a(gj)}function Tj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"},child:[]}]})(l)}function vj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M64 0C46.3 0 32 14.3 32 32V96c0 17.7 14.3 32 32 32h80v32H87c-31.6 0-58.5 23.1-63.3 54.4L1.1 364.1C.4 368.8 0 373.6 0 378.4V448c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V378.4c0-4.8-.4-9.6-1.1-14.4L488.2 214.4C483.5 183.1 456.6 160 425 160H208V128h80c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H64zM96 48H256c8.8 0 16 7.2 16 16s-7.2 16-16 16H96c-8.8 0-16-7.2-16-16s7.2-16 16-16zM64 432c0-8.8 7.2-16 16-16H432c8.8 0 16 7.2 16 16s-7.2 16-16 16H80c-8.8 0-16-7.2-16-16zm48-168a24 24 0 1 1 0-48 24 24 0 1 1 0 48zm120-24a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM160 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM328 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM256 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM424 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM352 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48z"},child:[]}]})(l)}function jY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M64 480H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H288c-10.1 0-19.6-4.7-25.6-12.8L243.2 57.6C231.1 41.5 212.1 32 192 32H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64z"},child:[]}]})(l)}function yj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M96 96V256c0 53 43 96 96 96s96-43 96-96H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80V192H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80V128H208c-8.8 0-16-7.2-16-16s7.2-16 16-16h80c0-53-43-96-96-96S96 43 96 96zM320 240v16c0 70.7-57.3 128-128 128s-128-57.3-128-128V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v24z"},child:[]}]})(l)}function Rj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2h61.4C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"},child:[]}]})(l)}function bj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(l)}function Cj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(l)}function VY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M272.1 204.2v71.1c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.1 0-2.1-.6-2.6-1.3l-32.6-44v42.2c0 1.8-1.4 3.2-3.2 3.2h-11.4c-1.8 0-3.2-1.4-3.2-3.2v-71.1c0-1.8 1.4-3.2 3.2-3.2H219c1 0 2.1.5 2.6 1.4l32.6 44v-42.2c0-1.8 1.4-3.2 3.2-3.2h11.4c1.8-.1 3.3 1.4 3.3 3.1zm-82-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 1.8 1.4 3.2 3.2 3.2h11.4c1.8 0 3.2-1.4 3.2-3.2v-71.1c0-1.7-1.4-3.2-3.2-3.2zm-27.5 59.6h-31.1v-56.4c0-1.8-1.4-3.2-3.2-3.2h-11.4c-1.8 0-3.2 1.4-3.2 3.2v71.1c0 .9.3 1.6.9 2.2.6.5 1.3.9 2.2.9h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.7-1.4-3.2-3.1-3.2zM332.1 201h-45.7c-1.7 0-3.2 1.4-3.2 3.2v71.1c0 1.7 1.4 3.2 3.2 3.2h45.7c1.8 0 3.2-1.4 3.2-3.2v-11.4c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2V234c0-1.8-1.4-3.2-3.2-3.2H301v-12h31.1c1.8 0 3.2-1.4 3.2-3.2v-11.4c-.1-1.7-1.5-3.2-3.2-3.2zM448 113.7V399c-.1 44.8-36.8 81.1-81.7 81H81c-44.8-.1-81.1-36.9-81-81.7V113c.1-44.8 36.9-81.1 81.7-81H367c44.8.1 81.1 36.8 81 81.7zm-61.6 122.6c0-73-73.2-132.4-163.1-132.4-89.9 0-163.1 59.4-163.1 132.4 0 65.4 58 120.2 136.4 130.6 19.1 4.1 16.9 11.1 12.6 36.8-.7 4.1-3.3 16.1 14.1 8.8 17.4-7.3 93.9-55.3 128.2-94.7 23.6-26 34.9-52.3 34.9-81.5z"},child:[]}]})(l)}function FY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm169.5 338.9c-3.5 8.1-18.1 14-44.8 18.2-1.4 1.9-2.5 9.8-4.3 15.9-1.1 3.7-3.7 5.9-8.1 5.9h-.2c-6.2 0-12.8-2.9-25.8-2.9-17.6 0-23.7 4-37.4 13.7-14.5 10.3-28.4 19.1-49.2 18.2-21 1.6-38.6-11.2-48.5-18.2-13.8-9.7-19.8-13.7-37.4-13.7-12.5 0-20.4 3.1-25.8 3.1-5.4 0-7.5-3.3-8.3-6-1.8-6.1-2.9-14.1-4.3-16-13.8-2.1-44.8-7.5-45.5-21.4-.2-3.6 2.3-6.8 5.9-7.4 46.3-7.6 67.1-55.1 68-57.1 0-.1.1-.2.2-.3 2.5-5 3-9.2 1.6-12.5-3.4-7.9-17.9-10.7-24-13.2-15.8-6.2-18-13.4-17-18.3 1.6-8.5 14.4-13.8 21.9-10.3 5.9 2.8 11.2 4.2 15.7 4.2 3.3 0 5.5-.8 6.6-1.4-1.4-23.9-4.7-58 3.8-77.1C183.1 100 230.7 96 244.7 96c.6 0 6.1-.1 6.7-.1 34.7 0 68 17.8 84.3 54.3 8.5 19.1 5.2 53.1 3.8 77.1 1.1.6 2.9 1.3 5.7 1.4 4.3-.2 9.2-1.6 14.7-4.2 4-1.9 9.6-1.6 13.6 0 6.3 2.3 10.3 6.8 10.4 11.9.1 6.5-5.7 12.1-17.2 16.6-1.4.6-3.1 1.1-4.9 1.7-6.5 2.1-16.4 5.2-19 11.5-1.4 3.3-.8 7.5 1.6 12.5.1.1.1.2.2.3.9 2 21.7 49.5 68 57.1 4 1 7.1 5.5 4.9 10.8z"},child:[]}]})(l)}function BY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"},child:[]}]})(l)}function wj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(l)}function Wg(l){return Ft({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(l)}function GY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"},child:[]}]})(l)}function HY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"},child:[]}]})(l)}function Aj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 9.8 11.2 15.5 19.1 9.7L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64z"},child:[]}]})(l)}function WY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M434.7 64h-85.9c-8 0-15.7 3-21.6 8.4l-98.3 90c-.1.1-.2.3-.3.4-16.6 15.6-16.3 40.5-2.1 56 12.7 13.9 39.4 17.6 56.1 2.7.1-.1.3-.1.4-.2l79.9-73.2c6.5-5.9 16.7-5.5 22.6 1 6 6.5 5.5 16.6-1 22.6l-26.1 23.9L504 313.8c2.9 2.4 5.5 5 7.9 7.7V128l-54.6-54.6c-5.9-6-14.1-9.4-22.6-9.4zM544 128.2v223.9c0 17.7 14.3 32 32 32h64V128.2h-96zm48 223.9c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zM0 384h64c17.7 0 32-14.3 32-32V128.2H0V384zm48-63.9c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16c0-8.9 7.2-16 16-16zm435.9 18.6L334.6 217.5l-30 27.5c-29.7 27.1-75.2 24.5-101.7-4.4-26.9-29.4-24.8-74.9 4.4-101.7L289.1 64h-83.8c-8.5 0-16.6 3.4-22.6 9.4L128 128v223.9h18.3l90.5 81.9c27.4 22.3 67.7 18.1 90-9.3l.2-.2 17.9 15.5c15.9 13 39.4 10.5 52.3-5.4l31.4-38.6 5.4 4.4c13.7 11.1 33.9 9.1 45-4.7l9.5-11.7c11.2-13.8 9.1-33.9-4.6-45.1z"},child:[]}]})(l)}function Ij(l){return Ft({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(l)}function KY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z"},child:[]}]})(l)}function Oj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"},child:[]}]})(l)}const Uw="/assets/%D8%A7%D9%84%D8%B4%D8%B9%D8%A7%D8%B1-2-png.HSDaABN7.png";function YY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-1 6h2v2h-2V7zm0 4h2v6h-2v-6z"},child:[]}]})(l)}function Nj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"},child:[]}]})(l)}function zY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1-.29-.7c0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.67-1.85.996.996 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"},child:[]}]})(l)}function Dj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"},child:[]}]})(l)}function qY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M4 4h16v12H5.17L4 17.17V4m0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4zm2 10h8v2H6v-2zm0-3h12v2H6V9zm0-3h12v2H6V6z"},child:[]}]})(l)}function $Y(l){return Ft({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2z"},child:[]}]})(l)}function JY(l){return Ft({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.961 12.365a2 2 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272zm-10.114-9A2 2 0 0 0 0 5v6a2 2 0 0 0 2 2h5.728zm9.746 11.925-10-14 .814-.58 10 14z"},child:[]}]})(l)}function Nl(l){return Ft({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z"},child:[]},{tag:"path",attr:{d:"M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5zM10 8a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1"},child:[]}]})(l)}function Pj(l){return Ft({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"},child:[]},{tag:"path",attr:{d:"M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"},child:[]},{tag:"path",attr:{d:"M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"},child:[]},{tag:"path",attr:{d:"M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"},child:[]}]})(l)}function Lj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M14,14 L10,14 L10,10 L14,10 L14,14 Z M14,7 L10,7 L10,3 L14,3 L14,7 Z M14,21 L10,21 L10,17 L14,17 L14,21 Z"},child:[]}]})(l)}function wi(){const[l,a]=ie.useState(null),[d,h]=ie.useState(null),[E,T]=ie.useState(null),R=localStorage.getItem("userEmail"),N=async()=>{try{const I=localStorage.getItem("token");if(!I){T("لا يوجد توكن. يرجى تسجيل الدخول.");return}const j=await fetch("https://api.japaneseacademy.online/allusers",{headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json"}});if(!j.ok)throw new"توكن غير صالح";const M=j.headers.get("content-type");if(!M||!M.includes("application/json"))throw new"الرد من الخادم ليس بصيغة JSON";const Y=(await j.json()).find(Z=>Z.email===R);Y?h(Y):T("اسم المستخدم أو كلمة المرور خطأ")}catch(I){console.error("Error:",I.message),T(I.message)}};return ie.useEffect(()=>{const I=localStorage.getItem("userRole");I&&a(I)},[]),ie.useEffect(()=>{N()},[]),f.jsx(f.Fragment,{children:f.jsxs("nav",{className:"navbar navbar-expand-xl navbar-light  container",children:[f.jsx("a",{className:"navbar-brand",href:"#",children:f.jsx("img",{src:Uw,alt:""})}),f.jsx("div",{className:"buttons_mobile",children:d?f.jsx("div",{className:"user-info",children:f.jsxs("div",{className:"user-info-buttons",children:[f.jsx("span",{className:"user-icon"}),f.jsx(un,{to:`/Dash_users/${d.id}`,children:f.jsx("button",{className:"register_nav",children:"لوحة التحكم "})}),f.jsx("button",{className:"logout_nav register_nav",onClick:()=>{localStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),localStorage.removeItem("firstName"),sessionStorage.removeItem("auth"),window.location.reload()},children:"تسجيل الخروج"}),f.jsx("p",{className:"user-name",children:d.firstName})]})}):f.jsxs("div",{className:"buttons",children:[f.jsx(un,{to:"/Login_users",children:f.jsx("button",{className:"login_nav",children:"تسجيل الدخول"})}),f.jsx(un,{to:"/Register_account",children:f.jsx("button",{className:"register_nav",children:"سجل الآن"})})]})}),f.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNavDropdown","aria-controls":"navbarNavDropdown","aria-expanded":"false","aria-label":"Toggle navigation",children:f.jsx("span",{className:"navbar-toggler-icon"})}),f.jsxs("div",{className:"collapse navbar-collapse",id:"navbarNavDropdown",children:[f.jsx("div",{className:"buttons_pc",children:d?f.jsxs("div",{className:"user-info",children:[f.jsx("span",{className:"user-icon"}),f.jsx("h4",{className:"user-name",children:d.firstName}),f.jsx(un,{to:`/Dash_users/${d.id}`,children:f.jsx("button",{className:"register_nav",children:"لوحة التحكم "})}),f.jsx("button",{className:"logout_nav register_nav",onClick:()=>{localStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),localStorage.removeItem("userRole"),localStorage.removeItem("firstName"),sessionStorage.removeItem("auth"),window.location.reload()},children:"تسجيل الخروج"})]}):f.jsxs("div",{className:"buttons",children:[f.jsx(un,{to:"/Login_users",children:f.jsx("button",{className:"login_nav",children:"تسجيل الدخول"})}),f.jsx(un,{to:"/Register_account",children:f.jsx("button",{className:"register_nav",children:"سجل الآن"})})]})}),f.jsx("ul",{className:"navbar-nav",children:f.jsxs("div",{className:"group",children:[f.jsxs("div",{className:"group_1",children:[f.jsx("li",{className:"nav-item active item1 hidden",children:f.jsxs(un,{className:"nav-a",to:"/",children:[f.jsx(Ij,{}),"الصفحة الرئيسية",f.jsx("span",{className:"sr-only"})]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Teachers",children:[f.jsx(Rj,{}),"الهيئة التدريسية"]})}),f.jsx("li",{className:"nav-item item2 hidden",children:f.jsxs(un,{className:"nav-a",to:"/Level_division",children:[f.jsx(Nj,{}),"المستويات الدراسية"]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Study_materials",children:[f.jsx(Tj,{}),"المواد الدراسية"]})})]}),f.jsxs("div",{className:"group_2",children:[f.jsx("li",{className:"nav-item item3 hidden",children:f.jsxs(un,{className:"nav-a",to:"/Fees",children:[f.jsx(Pj,{}),"الرسوم الدراسية"]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Questions",children:[f.jsx(Oj,{}),"الأسئلة الشائعة"]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Comments",children:[f.jsx(Aj,{}),"آراء الطلاب"]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/More_services",children:[f.jsx(Lj,{}),"خدمات إضافية"]})}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Support",children:[f.jsx(yj,{}),"الدعم الفني"]})})]}),f.jsx("div",{className:"group_3",children:l==="teacher"&&f.jsx("li",{className:"nav-item item4",children:f.jsx(un,{className:"nav-a dropdown-item",to:"/Dash_Teachers",children:"لوحة تحكم الأساتذة"})})})]})})]})]})})}function XY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.6727 1.61162 20.7999 9H17.8267L12 3.70302 6 9.15757V19.0001H11V21.0001H5C4.44772 21.0001 4 20.5524 4 20.0001V11.0001L1 11.0001 11.3273 1.61162C11.7087 1.26488 12.2913 1.26488 12.6727 1.61162ZM14 11H23V18H14V11ZM16 13V16H21V13H16ZM24 21H13V19H24V21Z"},child:[]}]})(l)}function QY(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M11 17H4C2.34315 17 1 15.6569 1 14V6C1 4.34315 2.34315 3 4 3H20C21.6569 3 23 4.34315 23 6V14C23 15.6569 21.6569 17 20 17H13V19H16C16.5523 19 17 19.4477 17 20C17 20.5523 16.5523 21 16 21H8C7.44772 21 7 20.5523 7 20C7 19.4477 7.44772 19 8 19H11V17ZM4 5H20C20.5523 5 21 5.44772 21 6V14C21 14.5523 20.5523 15 20 15H4C3.44772 15 3 14.5523 3 14V6C3 5.44772 3.44772 5 4 5Z",fill:"currentColor"},child:[]}]})(l)}function ZY(){const[l,a]=ie.useState(!1),d=()=>{if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad|android)/)){const E=document.querySelector("meta[name=viewport]");E&&(l?E.setAttribute("content","width=device-width, initial-scale=1"):E.setAttribute("content","width=1250"))}a(!l)};return f.jsx(f.Fragment,{children:f.jsx("div",{children:f.jsxs("button",{className:"DesktopView m-1",onClick:d,children:[f.jsxs("h5",{children:["PC ",f.jsx("br",{}),"VIEW"]})," ",f.jsx(QY,{})]})})})}function Ai(){return f.jsx(f.Fragment,{children:f.jsx("footer",{className:"footer",children:f.jsxs("div",{className:"text-white text-center text-lg-left",children:[f.jsx("div",{className:"p-3 position-relative",children:f.jsx("div",{className:"rowFooter",children:f.jsxs("div",{className:"Footer_all_list",children:[f.jsxs("div",{className:"list_footer",children:[f.jsxs("div",{className:"Footer_ul",children:[f.jsxs("ul",{className:"list-unstyled",children:[f.jsx("a",{href:"tel:+81050-6866-1791",children:f.jsxs("li",{children:[f.jsx(XY,{})," رقم الهاتف: 1791-6866-050"]})}),f.jsx("a",{href:"tel:+81090-1840-9625",children:f.jsxs("li",{children:[f.jsx(KY,{}),"رقم المحمول: 819018409625+"]})}),f.jsx("a",{href:"https://wa.link/3zzbvj",children:f.jsxs("li",{children:[f.jsx(Wg,{})," واتساب: 819018409625+"]})}),f.jsx("a",{href:"https://line.me/ti/p/IuAqVt59QV",children:f.jsxs("li",{children:[f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-line",viewBox:"0 0 16 16",children:f.jsx("path",{d:"M8 0c4.411 0 8 2.912 8 6.492 0 1.433-.555 2.723-1.715 3.994-1.678 1.932-5.431 4.285-6.285 4.645-.83.35-.734-.197-.696-.413l.003-.018.114-.685c.027-.204.055-.521-.026-.723-.09-.223-.444-.339-.704-.395C2.846 12.39 0 9.701 0 6.492 0 2.912 3.59 0 8 0M5.022 7.686H3.497V4.918a.156.156 0 0 0-.155-.156H2.78a.156.156 0 0 0-.156.156v3.486c0 .041.017.08.044.107v.001l.002.002.002.002a.15.15 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157m.791-2.924a.156.156 0 0 0-.156.156v3.486c0 .086.07.155.156.155h.562c.086 0 .155-.07.155-.155V4.918a.156.156 0 0 0-.155-.156zm3.863 0a.156.156 0 0 0-.156.156v2.07L7.923 4.832l-.013-.015v-.001l-.01-.01-.003-.003-.011-.009h-.001L7.88 4.79l-.003-.002-.005-.003-.008-.005h-.002l-.003-.002-.01-.004-.004-.002-.01-.003h-.002l-.003-.001-.009-.002h-.006l-.003-.001h-.004l-.002-.001h-.574a.156.156 0 0 0-.156.155v3.486c0 .086.07.155.156.155h.56c.087 0 .157-.07.157-.155v-2.07l1.6 2.16a.2.2 0 0 0 .039.038l.001.001.01.006.004.002.008.004.007.003.005.002.01.003h.003a.2.2 0 0 0 .04.006h.56c.087 0 .157-.07.157-.155V4.918a.156.156 0 0 0-.156-.156zm3.815.717v-.56a.156.156 0 0 0-.155-.157h-2.242a.16.16 0 0 0-.108.044h-.001l-.001.002-.002.003a.16.16 0 0 0-.044.107v3.486c0 .041.017.08.044.107l.002.003.002.002a.16.16 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156Z"})})," ","لاين: 819018409625+"]})}),f.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:f.jsxs("li",{children:[f.jsx(Dj,{}),"info@japaneseacademy.jp"]})})]}),f.jsxs("div",{className:"social_icons",children:[f.jsx("a",{href:"",children:f.jsx(bj,{})}),f.jsx("a",{href:"",children:f.jsx(Wg,{})}),f.jsx("a",{href:"",children:f.jsx(wj,{})}),f.jsx("a",{href:"",children:f.jsx(Cj,{})})]})]}),f.jsxs("div",{className:"group_footer",children:[f.jsxs("div",{className:"group_1_footer",children:[f.jsx("li",{className:" active item1 hidden",children:f.jsxs(un,{className:"nav-a",to:"/",children:[f.jsx(Ij,{}),"الصفحة الرئيسية",f.jsx("span",{className:"sr-only"})]})}),f.jsx("li",{className:" item2 hidden",children:f.jsxs(un,{className:"nav-a",to:"/Level_division",children:[f.jsx(Nj,{}),"تقسيم المستويات"]})}),f.jsx("li",{className:" item3 hidden",children:f.jsxs(un,{className:"nav-a",to:"/Fees",children:[f.jsx(Pj,{}),"الرسوم"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Teachers",children:[f.jsx(Rj,{}),"الهيئة التدريسية"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Register",children:[f.jsx(vj,{}),"طريقة التسجيل"]})})]}),f.jsxs("div",{className:"group_2_footer",children:[f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Study_materials",children:[f.jsx(Tj,{}),"المواد الدراسية"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Questions",children:[f.jsx(Oj,{}),"الأسئلة الشائعة"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Comments",children:[f.jsx(Aj,{}),"آراء الطلاب"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/More_services",children:[f.jsx(Lj,{}),"خدمات إضافية"]})}),f.jsx("li",{className:" item4 hidden",children:f.jsxs(un,{to:"/Support",children:[f.jsx(yj,{}),"الدعم الفني"]})})]}),f.jsxs("div",{className:"group_3_footer",children:[f.jsx("li",{className:"item4 hidden",children:f.jsxs(un,{to:"/Privacy",children:[f.jsx(YY,{}),"سياسة الخصوصية"]})}),f.jsx("li",{className:"item4 hidden",children:f.jsxs(un,{to:"/Terms",children:[f.jsx(WY,{}),"شروط الاستخدام"]})})]})]})]}),f.jsx("div",{className:"footer-img",children:f.jsx("img",{className:"Logo_Footer",src:Uw,alt:""})})]})})}),f.jsxs("div",{className:"text-center p-3",style:{backgroundColor:"darkslategrey"},children:[" ",f.jsxs("ul",{className:"Ulfooter",children:[f.jsx("li",{children:f.jsx("a",{className:"text-white fs-5",children:"Copyright © 2022 Japanese Academy. All Rights Reserved"})}),f.jsx("li",{className:"App",children:f.jsx(ZY,{})})]})]})]})})})}function ez(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"Container",children:f.jsx("div",{className:"content p-0 w-100",children:f.jsx("div",{className:"img",children:f.jsxs("div",{className:"detailsHeader col-lg-10  m-auto",children:[f.jsx("h1",{children:"تعرف إلينا"}),f.jsx("p",{className:"mt-3",children:"  Home / تعرف علينا "})]})})})})})}function tz(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"contentVision",children:[f.jsx("p",{children:"رؤيتنا: أن نكون المرجع الأول في تدريس اللغة العربية افتراضياً في العالم، وتطوير طرق تدريسها ومناهجها."}),f.jsx("p",{children:"رسالتنا: نشر لغة القرآن وتقريبها وتحبيبها إلى الأجيال."}),f.jsx("p",{children:"مدير الأكاديمية:"}),f.jsx("p",{children:"أ. أحمد الصالح خبير في تعليم اللغة العربية"})]})})}function nz(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container",children:f.jsxs("div",{className:"row pt-5 pb-5",children:[f.jsxs("div",{className:"col-xl-6 col-lg-6",children:[f.jsxs("div",{className:"icons",children:[f.jsx("p",{children:f.jsx(FY,{})}),f.jsx("p",{children:f.jsx(Cj,{})}),f.jsx("p",{children:f.jsx(BY,{})}),f.jsx("p",{children:f.jsx(Wg,{})}),f.jsx("p",{children:f.jsx(GY,{})}),f.jsx("p",{children:f.jsx(wj,{})}),f.jsx("p",{children:f.jsx(bj,{})})]}),f.jsx("p",{className:"textIcon text-center m-auto",children:"مع أكاديمية اللغة العربية ستكون اللغة العربية هي المادة الأفضل عند أبنائك"})]}),f.jsx("div",{className:"col-xl-6 col-lg-6",children:f.jsxs("div",{className:"category",children:[f.jsx("h1",{children:"اكاديمية اللغة العربية"}),f.jsx("h3",{children:"الإتقان في تعليم لغة القران"}),f.jsx("p",{children:"امنح أبناءك فرصة الاستمتاع بتجربة فريدة ومميزة في تعليم اللغة العربية والحفاظ على هويتهم الأصيلة"})]})})]})})})}function Oc(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm43.4 289.1c7.5 7.5 7.5 19.8 0 27.3-3.8 3.8-8.7 5.6-13.6 5.6s-9.9-1.9-13.7-5.7l-94-94.3c-6.9-7.6-6.7-19.3.6-26.6l95.4-95.7c7.5-7.5 19.7-7.6 27.3 0 7.5 7.5 7.6 19.7 0 27.3l-81.9 81 79.9 81.1z"},child:[]}]})(l)}function iz(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container",children:[f.jsxs("div",{className:"TitleAbout text-center mt-5",children:[f.jsx("h2",{className:"mb-5 fw-bold",children:"من نحن"}),f.jsx("p",{children:"أكاديميّة افتراضيّة عالمية، متخصّصة في تعليم اللّغة العربيّة، بأحدث الطرق والأساليب الإبداعية، مع كادر تعليميّ تربويّ مؤهّل مدرّب، تحت إشراف أكاديميّ فعّال."})]}),f.jsx("div",{className:"options mb-5 pb-5",children:f.jsxs("ul",{children:[f.jsx("li",{children:" مسارات الدراسة "}),f.jsx("li",{children:" كيف أسجل ابني "}),f.jsx("li",{children:" للتسجيل في مسار الدروس المسجلة  "}),f.jsx("li",{children:" ضمان الجودة "}),f.jsx("li",{children:" المناهج التعليمية "}),f.jsx("li",{children:" من آراء الطلاب "}),f.jsx("li",{children:" النظام الدراسي "}),f.jsx("li",{children:" البرامج والمستويات "}),f.jsx("li",{children:" سياسية دفع الرسوم واستردادها "}),f.jsx("li",{children:" من آراء الأهالي "})]})}),f.jsxs("div",{className:"row",children:[f.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"mb-4 fw-bold",children:"كيف أسجل ابني في أكاديمية اللغة العربية؟"}),f.jsx("p",{children:"للتسجيل في مسار الدروس المباشرة (الفردي أو الجماعي) من خلال موقع الأكاديمية أو من خلال التواصل على وتساب الأكاديمية تستطيع:"}),f.jsxs("ul",{children:[f.jsxs("li",{children:[f.jsx(Oc,{}),"حجز موعد اختبار تحديد المستوى لأبنائك، في الوقت الذي يناسبك."]}),f.jsxs("li",{children:[f.jsx(Oc,{}),"ستزودك الأكاديمية بنتائج تحديد المستوى في أقل من 24 ساعة، وتختار المستوى المناسب له."]}),f.jsxs("li",{children:[f.jsx(Oc,{}),"يمكنك اختيار المسار المناسب لكم (الخاص أو الجماعي)، وبعدها تزودك الإدارة برابط الزوم ومواعيد الدروس وبيانات دخول المنصة"]}),f.jsxs("li",{children:[f.jsx(Oc,{}),"يمكن الطالب حضور الحصص التجريبية في المسار الذي اختاره لمدة أسبوع في كل مسار."]}),f.jsxs("li",{children:[f.jsx(Oc,{}),"في حال لم تناسبه الدروس تكون الحصص هديةً له من أكاديمية اللغة العربية، دون أن يترتب عليه أي رسوم."]})]})]}),f.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"fw-bold mb-4",children:"للتسجيل في مسار الدروس المسجلة"}),f.jsxs("ul",{children:[f.jsxs("li",{children:[f.jsx(Oc,{})," من خلال الموقع يستطيع الطالب أن يختار الدروة المناسبة له "]}),f.jsxs("li",{children:[f.jsx(Oc,{})," بعد أن يحضر الدرس المجاني يمكنه شراء الدورة وحضورها "]}),f.jsxs("li",{children:[f.jsx(Oc,{})," ستظل الدورة مفتوحة له مدة سنة كاملة. "]})]})]})]})]})})}function Ou(l){return Ft({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"},child:[]}]})(l)}function rz(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"Allcontent pb-5 pt-5",children:f.jsx("div",{className:"container Aboutiso text-center",children:f.jsxs("div",{className:"row",children:[f.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"mb-4 fw-bold",children:"ضمان الجودة"}),f.jsx("p",{children:"تضمن أكاديمية اللغة العربية لطلابها المواظبين على حضور الدروس وتنفيذ متطلبات النجاح (ملف الإنجاز):"}),f.jsxs("ul",{children:[f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"الحصول على المخرجات التعليمية الموضحة في كل مستوى. (في صفحة الدورات)"]}),f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"في حال لم يحصل على المخرجات التعليمية الموعود بها فإن أكاديمية اللغة العربية ملزمة بإعادة رسوم الدورة أو منحه مقعداً مجاناً في الدورة."]})]})]}),f.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"fw-bold mb-4",children:"المناهج التعليمية"}),f.jsx("p",{children:"اختارت أكاديمية اللغة العربية لطلابها أفضل المناهج المعتمدة عالمياً"}),f.jsxs("ul",{children:[f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"مبنية على أسس تربوية وعلمية"]}),f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"مختارة من قبل متخصصين"]}),f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"ثرية بالأنشطة التفاعلية وأوراق العمل وعروض بوربوينت والوسائل السمعية والبصرية."]}),f.jsxs("li",{children:[" ",f.jsx(Ou,{}),"كما نعتمد سلاسل خاصة في تعليم غير الناطقين بالعربية."]})]})]})]})})})})}function Dl(l){return Ft({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M1.25 7.5C1.25 7.22386 1.47386 7 1.75 7H13.25C13.5261 7 13.75 7.22386 13.75 7.5C13.75 7.77614 13.5261 8 13.25 8H1.75C1.47386 8 1.25 7.77614 1.25 7.5Z",fill:"currentColor"},child:[]}]})(l)}function sz(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"Allcontent pb-5 pt-5",children:f.jsx("div",{className:"container Aboutiso text-center",children:f.jsxs("div",{className:"row",children:[f.jsxs("div",{className:"Howregister col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"mb-4 fw-bold",children:"سياسية دفع الرسوم واستردادها"}),f.jsx("p",{children:"لأكاديمية اللغة العربية حسابات في عدة دول حول العالم فضلا عن إمكانية الدفع في باي بال و وايز وكويت ترك في تركيا"}),f.jsxs("ul",{children:[f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"بعد مقابلة تحديد المستوى وحضور الحصص التجريبية يثبت الطالب التسجيل بدفع الرسوم لشهر مقدماً أو أكثر"]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"الدفع في بداية كل شهر ميلادي."]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"يتحمل الطالب رسوم التحويل إن وجدت."]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"يمكن للطالب إيقاف التسجيل لمدة أسبوع أو أكثر في الدروس الفردية."]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"لا يمكن إيقاف التسجيل في الدروس الجماعية لاستمرار بقية الطلاب في الدراسة."]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"لا تحسم أجور أيام العطل الرسمية مثل عيد الفطر وعيد الأضحى."]}),f.jsxs("li",{children:[" ",f.jsx(Dl,{}),"يتحمل الطالب مسؤولية غيابه عن الدروس، ولكن يمكنه الاستفادة من مزية إيقاف التسجيل في الدروس الفردية فقط."]})]})]}),f.jsxs("div",{className:"Registertrack col-xl-6 col-lg-6",children:[f.jsx("h4",{className:"fw-bold mb-4",children:"النظام الدراسي في أكاديمية اللغة العربية"}),f.jsx("p",{children:"تعتمد أكاديمية اللغة العربية نظاما تعليمياً مميزاً لتقدم اللغة العربية بأبسط أسلوب لأبنائها بعيداً عن التعقيد والتقعر."}),f.jsxs("ul",{children:[f.jsxs("li",{children:[" ","وقد وُضع هذا البرنامج بناء على دراسات الخبراء والمتخصصين في تعليم اللغة العربية. حيث يهدف إلى تمكين المهارات الأساسية لمتحدث اللغة العربية الأصلي، سواء أكان يقيم في بلاد عربية أم يقيم في بلاد أجنبية."]}),f.jsx("li",{children:"ويهدف هذا البرنامج إلى تقديم اللغة العربية بطريقة تكاملية بحيث تتكامل مهارات: الاستماع، والتحدث باللغة العربية الفصحى، والقراءة السليمة، فضلاً عن الكتابة السليمة."}),f.jsx("li",{children:"إضافة إلى تعليم غير العرب، ودورات القرآن الكريم، كما تأخذ على عاتقها تطوير المعلمين والآباء والأمهات في تعليم اللغة العربية لأبنائهم في تعليم اللغة العربية من خلال دورات مميزة ومتخصصة."})]})]})]})})})})}function oz(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:" AboutLevel pb-5 pt-3",children:[f.jsx("h1",{className:"fw-bold",children:"البرامج والمستويات"}),f.jsxs("div",{className:"container cards text-center",children:[f.jsxs("div",{className:"card1",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج تعليم اللغة العربية للعرب"}),f.jsx("p",{children:"(12 مستوى)"})]}),f.jsxs("div",{className:"card2",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج تعليم اللغة العربية للناطقين بغير العربية"}),f.jsx("p",{children:"مستوى 6"})]}),f.jsxs("div",{className:"card3",children:[f.jsx(Nl,{}),f.jsxs("h4",{children:["برنامج متابعة مناهج اللغة العربية الدراسية في المدارس العالمية والعربية"," "]})]}),f.jsxs("div",{className:"card4",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج تعليم القرآن الكريم والعلوم الشرعية "}),f.jsx("p",{children:" (حفظ، تدبر، حديث، سيرة)"})]}),f.jsxs("div",{className:"card5",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج تعليم اللغة العربية للمتخصصين "}),f.jsx("p",{children:" (نحو، صرف، بلاغة)"})]}),f.jsxs("div",{className:"card6",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج رعاية المواهب العربية"}),f.jsx("p",{children:"-"})]}),f.jsxs("div",{className:"card7",children:[f.jsx(Nl,{}),f.jsx("h4",{children:"برنامج تدريب المعلمين والآباء والأمهات "})]})]}),f.jsx("button",{children:"التفاصيل في قسم الدورات"})]})})}function az(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container About_login text-center pt-5 pb-5",children:[f.jsx("h1",{className:"fs-5 fw-bold",children:"أكاديمية اللغة العربية"}),f.jsx("p",{className:"fs-2 pt-4",children:"الإتقان في تعليم لغة القران"}),f.jsx("p",{children:"سجل الآن، وامنح ابنك فرصة تعلم لغته العربية على أيدي المتخصصين."}),f.jsx("p",{children:"0999999999999"})]})})}function cz(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container",children:f.jsxs("div",{className:"main_content",children:[f.jsxs("div",{className:"level_one",children:[f.jsxs("div",{className:"title_level_one",children:[f.jsx("hr",{}),f.jsx("h1",{children:"مستويات اللغة اليابانية للمبتدئين 1"}),f.jsxs("p",{children:["＊على اعتبار تخصيص درسين في الأسبوع، بحيث تكون مدة كل درس 90 دقيقة، ولمدة شهرين ",f.jsx("br",{}),"أي 8 دروس لكل مستوى موزعة على 12 ساعة في شهرين ",f.jsx("br",{}),"＊كل درس من كتاب (مينا نو نيهونغو) يحتاج إلى حصتين درسيتين، حصة لدراسة القاعدة والحصة الثانية للتطبيق عليها. ",f.jsx("br",{}),"＊البدء بدراسة الكانجي اعتبارا من المستوى الرابع، أي بعد 3 مستويات عبر 6 أشهر من بدء دراسة اللغة وتركيز أحرف الكانا جيدا."," ",f.jsx("br",{}),"دراسة 20 حرف كانجي في كل مستوى (5 أحرف أسبوعيا) باعتماد كتاب:"," ",f.jsx("br",{}),"ＢＡＳＩＣ　ＫＡＮＪＩ　ＢＯＯＫ　基本漢字500　ＶＯＬ．１ ",f.jsx("br",{}),"＊7 مستويات ضرورية لإنهاء الجزء الأول من كتاب (مينا نو نيهونغو1)، يكون الطالب قد درس خلالها 80 جرف كانجي. ",f.jsx("br",{})]})]}),f.jsx("div",{className:"content_level_one",children:f.jsxs("ul",{children:[f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الأول"}),"دراسة حروف الهيراغانا ",f.jsx("br",{}),"التحيات ",f.jsx("br",{}),"التعريف عن النفس ",f.jsx("br",{}),"الأرقام ",f.jsx("br",{}),"الدرس 1 من كتاب (مينا نو نيهونغو): التعريف عن الاسم والمهنة والانتماء، النفي، صياغة السؤال."]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الثاني"}),"دراسة حروف الكاتاكانا",f.jsx("br",{}),"الدرس 2 من كتاب (مينا نو نيهونغو): أسماء الإشارة، الملكية."," ",f.jsx("br",{}),"الدرس 3: الإرشاد إلى مكان، أين، البلدان والجنسية. ",f.jsx("br",{}),"الدرس 4: الوقت، صيغة الحاضر والماضي والنفي من الفعل. ",f.jsx("br",{}),"الدرس 5: الأفعال يأتي ويذهب ويعود، السؤال باستخدام متى. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الثالث"}),"مراجعة لأحرف الكانا ",f.jsx("br",{}),"الدرس 6: المفعول به، السؤال باستخدام ما وماذا، صيغتي ألا تفعل ودعنا نفعل. ",f.jsx("br",{}),"الدرس 7: القيام بفعل باستخدام وسيلة معينة، الأفعال يعطي ويأخذ، صيغة قد فعلت كذا أو لم أفعل بعد. ",f.jsx("br",{}),"الدرس 8: الصفات والسؤال عن صفة شيء ما، الظرفين كثيرا وقليلا ما. ",f.jsx("br",{}),"الدرس 9: الأفعال التي نستخدم معها ظروف التكرار قليلا وكثيرا مثل يفهم ويكره ويحب وغيرها، صيغة من وإلى، السؤال باستخدام لماذا. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الرابع"}),"الدرس 10: صيغة يوجد ولا يوجد للعاقل وغير العاقل، حروف الجر."," ",f.jsx("br",{}),"الدرس 11: العدد والمعدود، صيغة فقط. ",f.jsx("br",{}),"الدرس 12: اثبات ونفي الأسماء والصفات، صيغة التفضيل. ",f.jsx("br",{}),"الدرس 13: صيغة أريد شيء وأريد أن أفعل كذا. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الخامس"}),"الدرس 14: صيغة افعل من فضلك، ما رأيك أن نفعل كذا، أنا الآن أقوم بكذا. ",f.jsx("br",{}),"الدرس 15: صيغة لا بأس أن...، لا يجب أن...، هل تعرف...؟ ",f.jsx("br",{}),"الدرس 16: ترتيب عدة أفعال أو عدة أسماء في جملة واحدة، صيغة فعلت كذا ثم فعلت كذا، صيفة كيف تفعل كذا...؟ ",f.jsx("br",{}),"الدرس 17: نفي الفعل حسب المجموعة التي ينتمي إليها، صيغة لا داعي أو لا ضرورة لكذا، صيغة يتوجب عليك كذا. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى السادس"}),"الدرس 18: صيغة الاستطاعة من الفعل، الهواية، صيغة أفعل كذا قبل فعل كذا. ",f.jsx("br",{}),"الدرس 19: صيغة سبق لي أن، ترتيب الأفعال دون التقيد بترتيب زمني، صيغة يصبح كذا للعاقل وغير العاقل. ",f.jsx("br",{}),"الدرس 20: الصيغة العامية ",f.jsx("br",{}),"الدرس 21: صيغة أعتقد وأظن، صيفة مقول القول، صيغة أليس كذلك، صيغة التنبيه. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى السابع"}),"الدرس 22: صلة الموصول. ",f.jsx("br",{}),"الدرس 23: استخدام عندما مع الأفعال والصفات والأسماء. ",f.jsx("br",{}),"الدرس 24: صيغة يفعل لأجل. ",f.jsx("br",{}),"الدرس 25: صيغة إذا كان، حتى لو كان. ",f.jsx("br",{})]})]})})]}),f.jsxs("div",{className:"level_two",children:[f.jsxs("div",{className:"title_level_two",children:[f.jsx("hr",{}),f.jsx("h1",{children:"مستويات اللغة اليابانية للمبتدئين 2"}),f.jsxs("p",{children:["＊6 مستويات ضرورية لإنهاء كتاب الجزء الثاني (مينا نو نيهونغو2)."," ",f.jsx("br",{}),"＊يتم زيادة عدد أحرف الكانجي المطلوب دراستها إلى 25 حرف في كل مستوى (تقريبا 6 أحرف أسبوعيا)، فيكون العدد الإجمالي للأحرف المدروسة خلال هذه المستويات 150 حرف كانجي. ",f.jsx("br",{}),"＊ربما من الأفضل أن نخصص 9 أو 10 حصص للمستوى الثالث عشر، لاحتوائه على 5 دروس قواعد وللقيام بمراجعة وتمارين قواعدية عامة على الكتاب. ",f.jsx("br",{})]})]}),f.jsx("div",{className:"content_level_two",children:f.jsxs("ul",{children:[f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الثامن"}),"الدرس 26: السببية العامية، الطلب، النصيحة. ",f.jsx("br",{}),"الدرس 27: صياغة الاستطاعة من ذات الفعل. ",f.jsx("br",{}),"الدرس 28: جمع فعلين باستخدام بينما، ترتيب عدة أسباب في نفس الجملة، استخدام الصيغتين بالإضافة إلى ولذلك. ",f.jsx("br",{}),"الدرس 29: التعبير عن حالة شيء عاقل أو غير عاقل، الحاضر التام، الأسف على فعل تم. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى التاسع"}),"الدرس 30: المبني للمجهول، الحاضر التام لأجل هدف معين، القيام بفعل كتحضير مسبق لهدف معين. ",f.jsx("br",{}),"الدرس 31: النفي بالعامية، صيفة أفكّر في فعل كذا، أنوي كذا، أنا على موعد مع كذا. ",f.jsx("br",{}),"الدرس 32: صيغة من الأفضل أن، صبغة ربّما... قد يكون، التوقع المستقبلي. ",f.jsx("br",{}),"الدرس 33: صيغة الاقتباس، طلب نقل رسالة شفوية إلى شخص. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى العاشر:"}),"الدرس 34: صيغة كما... تماما، ترتيب أفعال في نفس الجملة باستخدام بعد أن، صيغة النهي. ",f.jsx("br",{}),"الدرس 35: الصيغة الشرطية باستخدام إذا، سؤال طلب النصيحة، صيغة بقدر كذا فهو كذا. ",f.jsx("br",{}),"الدرس 36: صيغة لكي أكتسب القدرة على كذا أفعل كذا، سأعمل على أن... ",f.jsx("br",{}),"الدرس 37: المبني للمجهول من الأفعال، صيغة وفقا لِـ... ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الحادي عشر"}),"الدرس 38: صيغة من الممتع من الجميل من .... أن تفعل كذا، نسيت فعل كذا. ",f.jsx("br",{}),"الدرس 39: السبب والنتيجة باستخدام بعض الأدوات أو بإجراء تغيير على الفعل. ",f.jsx("br",{}),"الدرس 40، صيغة ما إذا كان قد... أو لا، صيغة يمكنك أن... ",f.jsx("br",{}),"الدرس 41: صيغة يفعل لأجل، افعل لو سمحت، ألا تفعل كذا لأجل."," ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الثاني عشر"}),"الدرس 42: استخدام لأجل مع الأسماء. ",f.jsx("br",{}),"الدرس 43: صيغة يبدو أنّ مع الأفعال والصفات والأسماء. ",f.jsx("br",{}),"الدرس 44: صيغة المبالغة، صيغة من السهل أن ومن الصعب أن. ",f.jsx("br",{}),"الدرس 45: صيغة في حال، رغم أنّ. ",f.jsx("br",{})]}),f.jsxs("li",{children:[f.jsx("h3",{children:"محتوى المستوى الثالث عشر"}),"الدرس 46: صيغة كنت على وشك، قد فعلت توّا، من المؤكد أنّ."," ",f.jsx("br",{}),"الدرس 47: صيغة وفقا لِـ... يبدو أنّ. ",f.jsx("br",{}),"الدرس 48: صيغة الإجبار، جعل شخص يقوم بشيء. ",f.jsx("br",{}),"الدرس 49: صيغة الاحترام. ",f.jsx("br",{}),"الدرس 50: صيغة التواضع. ",f.jsx("br",{})]})]})})]})]})})})}function kj(l,a){return function(){return l.apply(a,arguments)}}var lz={};const{toString:dz}=Object.prototype,{getPrototypeOf:jw}=Object,nS=(l=>a=>{const d=dz.call(a);return l[d]||(l[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),ro=l=>(l=l.toLowerCase(),a=>nS(a)===l),iS=l=>a=>typeof a===l,{isArray:Uu}=Array,vf=iS("undefined");function uz(l){return l!==null&&!vf(l)&&l.constructor!==null&&!vf(l.constructor)&&es(l.constructor.isBuffer)&&l.constructor.isBuffer(l)}const xj=ro("ArrayBuffer");function hz(l){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(l):a=l&&l.buffer&&xj(l.buffer),a}const pz=iS("string"),es=iS("function"),Mj=iS("number"),rS=l=>l!==null&&typeof l=="object",fz=l=>l===!0||l===!1,Pg=l=>{if(nS(l)!=="object")return!1;const a=jw(l);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},mz=ro("Date"),_z=ro("File"),Ez=ro("Blob"),gz=ro("FileList"),Sz=l=>rS(l)&&es(l.pipe),Tz=l=>{let a;return l&&(typeof FormData=="function"&&l instanceof FormData||es(l.append)&&((a=nS(l))==="formdata"||a==="object"&&es(l.toString)&&l.toString()==="[object FormData]"))},vz=ro("URLSearchParams"),[yz,Rz,bz,Cz]=["ReadableStream","Request","Response","Headers"].map(ro),wz=l=>l.trim?l.trim():l.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rf(l,a,{allOwnKeys:d=!1}={}){if(l===null||typeof l>"u")return;let h,E;if(typeof l!="object"&&(l=[l]),Uu(l))for(h=0,E=l.length;h<E;h++)a.call(null,l[h],h,l);else{const T=d?Object.getOwnPropertyNames(l):Object.keys(l),R=T.length;let N;for(h=0;h<R;h++)N=T[h],a.call(null,l[N],N,l)}}function Uj(l,a){a=a.toLowerCase();const d=Object.keys(l);let h=d.length,E;for(;h-- >0;)if(E=d[h],a===E.toLowerCase())return E;return null}const Pl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:lz,jj=l=>!vf(l)&&l!==Pl;function mw(){const{caseless:l}=jj(this)&&this||{},a={},d=(h,E)=>{const T=l&&Uj(a,E)||E;Pg(a[T])&&Pg(h)?a[T]=mw(a[T],h):Pg(h)?a[T]=mw({},h):Uu(h)?a[T]=h.slice():a[T]=h};for(let h=0,E=arguments.length;h<E;h++)arguments[h]&&Rf(arguments[h],d);return a}const Az=(l,a,d,{allOwnKeys:h}={})=>(Rf(a,(E,T)=>{d&&es(E)?l[T]=kj(E,d):l[T]=E},{allOwnKeys:h}),l),Iz=l=>(l.charCodeAt(0)===65279&&(l=l.slice(1)),l),Oz=(l,a,d,h)=>{l.prototype=Object.create(a.prototype,h),l.prototype.constructor=l,Object.defineProperty(l,"super",{value:a.prototype}),d&&Object.assign(l.prototype,d)},Nz=(l,a,d,h)=>{let E,T,R;const N={};if(a=a||{},l==null)return a;do{for(E=Object.getOwnPropertyNames(l),T=E.length;T-- >0;)R=E[T],(!h||h(R,l,a))&&!N[R]&&(a[R]=l[R],N[R]=!0);l=d!==!1&&jw(l)}while(l&&(!d||d(l,a))&&l!==Object.prototype);return a},Dz=(l,a,d)=>{l=String(l),(d===void 0||d>l.length)&&(d=l.length),d-=a.length;const h=l.indexOf(a,d);return h!==-1&&h===d},Pz=l=>{if(!l)return null;if(Uu(l))return l;let a=l.length;if(!Mj(a))return null;const d=new Array(a);for(;a-- >0;)d[a]=l[a];return d},Lz=(l=>a=>l&&a instanceof l)(typeof Uint8Array<"u"&&jw(Uint8Array)),kz=(l,a)=>{const h=(l&&l[Symbol.iterator]).call(l);let E;for(;(E=h.next())&&!E.done;){const T=E.value;a.call(l,T[0],T[1])}},xz=(l,a)=>{let d;const h=[];for(;(d=l.exec(a))!==null;)h.push(d);return h},Mz=ro("HTMLFormElement"),Uz=l=>l.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,h,E){return h.toUpperCase()+E}),NU=(({hasOwnProperty:l})=>(a,d)=>l.call(a,d))(Object.prototype),jz=ro("RegExp"),Vj=(l,a)=>{const d=Object.getOwnPropertyDescriptors(l),h={};Rf(d,(E,T)=>{let R;(R=a(E,T,l))!==!1&&(h[T]=R||E)}),Object.defineProperties(l,h)},Vz=l=>{Vj(l,(a,d)=>{if(es(l)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const h=l[d];if(es(h)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},Fz=(l,a)=>{const d={},h=E=>{E.forEach(T=>{d[T]=!0})};return Uu(l)?h(l):h(String(l).split(a)),d},Bz=()=>{},Gz=(l,a)=>l!=null&&Number.isFinite(l=+l)?l:a,JC="abcdefghijklmnopqrstuvwxyz",DU="0123456789",Fj={DIGIT:DU,ALPHA:JC,ALPHA_DIGIT:JC+JC.toUpperCase()+DU},Hz=(l=16,a=Fj.ALPHA_DIGIT)=>{let d="";const{length:h}=a;for(;l--;)d+=a[Math.random()*h|0];return d};function Wz(l){return!!(l&&es(l.append)&&l[Symbol.toStringTag]==="FormData"&&l[Symbol.iterator])}const Kz=l=>{const a=new Array(10),d=(h,E)=>{if(rS(h)){if(a.indexOf(h)>=0)return;if(!("toJSON"in h)){a[E]=h;const T=Uu(h)?[]:{};return Rf(h,(R,N)=>{const I=d(R,E+1);!vf(I)&&(T[N]=I)}),a[E]=void 0,T}}return h};return d(l,0)},Yz=ro("AsyncFunction"),zz=l=>l&&(rS(l)||es(l))&&es(l.then)&&es(l.catch),Bj=((l,a)=>l?setImmediate:a?((d,h)=>(Pl.addEventListener("message",({source:E,data:T})=>{E===Pl&&T===d&&h.length&&h.shift()()},!1),E=>{h.push(E),Pl.postMessage(d,"*")}))(`axios@${Math.random()}`,[]):d=>setTimeout(d))(typeof setImmediate=="function",es(Pl.postMessage)),qz=typeof queueMicrotask<"u"?queueMicrotask.bind(Pl):typeof process<"u"&&process.nextTick||Bj,Te={isArray:Uu,isArrayBuffer:xj,isBuffer:uz,isFormData:Tz,isArrayBufferView:hz,isString:pz,isNumber:Mj,isBoolean:fz,isObject:rS,isPlainObject:Pg,isReadableStream:yz,isRequest:Rz,isResponse:bz,isHeaders:Cz,isUndefined:vf,isDate:mz,isFile:_z,isBlob:Ez,isRegExp:jz,isFunction:es,isStream:Sz,isURLSearchParams:vz,isTypedArray:Lz,isFileList:gz,forEach:Rf,merge:mw,extend:Az,trim:wz,stripBOM:Iz,inherits:Oz,toFlatObject:Nz,kindOf:nS,kindOfTest:ro,endsWith:Dz,toArray:Pz,forEachEntry:kz,matchAll:xz,isHTMLForm:Mz,hasOwnProperty:NU,hasOwnProp:NU,reduceDescriptors:Vj,freezeMethods:Vz,toObjectSet:Fz,toCamelCase:Uz,noop:Bz,toFiniteNumber:Gz,findKey:Uj,global:Pl,isContextDefined:jj,ALPHABET:Fj,generateString:Hz,isSpecCompliantForm:Wz,toJSONObject:Kz,isAsyncFn:Yz,isThenable:zz,setImmediate:Bj,asap:qz};function Pt(l,a,d,h,E){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=l,this.name="AxiosError",a&&(this.code=a),d&&(this.config=d),h&&(this.request=h),E&&(this.response=E,this.status=E.status?E.status:null)}Te.inherits(Pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Te.toJSONObject(this.config),code:this.code,status:this.status}}});const Gj=Pt.prototype,Hj={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(l=>{Hj[l]={value:l}});Object.defineProperties(Pt,Hj);Object.defineProperty(Gj,"isAxiosError",{value:!0});Pt.from=(l,a,d,h,E,T)=>{const R=Object.create(Gj);return Te.toFlatObject(l,R,function(I){return I!==Error.prototype},N=>N!=="isAxiosError"),Pt.call(R,l.message,a,d,h,E),R.cause=l,R.name=l.name,T&&Object.assign(R,T),R};const $z=null;function _w(l){return Te.isPlainObject(l)||Te.isArray(l)}function Wj(l){return Te.endsWith(l,"[]")?l.slice(0,-2):l}function PU(l,a,d){return l?l.concat(a).map(function(E,T){return E=Wj(E),!d&&T?"["+E+"]":E}).join(d?".":""):a}function Jz(l){return Te.isArray(l)&&!l.some(_w)}const Xz=Te.toFlatObject(Te,{},null,function(a){return/^is[A-Z]/.test(a)});function sS(l,a,d){if(!Te.isObject(l))throw new TypeError("target must be an object");a=a||new FormData,d=Te.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(q,re){return!Te.isUndefined(re[q])});const h=d.metaTokens,E=d.visitor||M,T=d.dots,R=d.indexes,I=(d.Blob||typeof Blob<"u"&&Blob)&&Te.isSpecCompliantForm(a);if(!Te.isFunction(E))throw new TypeError("visitor must be a function");function j(X){if(X===null)return"";if(Te.isDate(X))return X.toISOString();if(!I&&Te.isBlob(X))throw new Pt("Blob is not supported. Use a Buffer instead.");return Te.isArrayBuffer(X)||Te.isTypedArray(X)?I&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function M(X,q,re){let se=X;if(X&&!re&&typeof X=="object"){if(Te.endsWith(q,"{}"))q=h?q:q.slice(0,-2),X=JSON.stringify(X);else if(Te.isArray(X)&&Jz(X)||(Te.isFileList(X)||Te.endsWith(q,"[]"))&&(se=Te.toArray(X)))return q=Wj(q),se.forEach(function(Q,me){!(Te.isUndefined(Q)||Q===null)&&a.append(R===!0?PU([q],me,T):R===null?q:q+"[]",j(Q))}),!1}return _w(X)?!0:(a.append(PU(re,q,T),j(X)),!1)}const F=[],Y=Object.assign(Xz,{defaultVisitor:M,convertValue:j,isVisitable:_w});function Z(X,q){if(!Te.isUndefined(X)){if(F.indexOf(X)!==-1)throw Error("Circular reference detected in "+q.join("."));F.push(X),Te.forEach(X,function(se,$){(!(Te.isUndefined(se)||se===null)&&E.call(a,se,Te.isString($)?$.trim():$,q,Y))===!0&&Z(se,q?q.concat($):[$])}),F.pop()}}if(!Te.isObject(l))throw new TypeError("data must be an object");return Z(l),a}function LU(l){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(l).replace(/[!'()~]|%20|%00/g,function(h){return a[h]})}function Vw(l,a){this._pairs=[],l&&sS(l,this,a)}const Kj=Vw.prototype;Kj.append=function(a,d){this._pairs.push([a,d])};Kj.toString=function(a){const d=a?function(h){return a.call(this,h,LU)}:LU;return this._pairs.map(function(E){return d(E[0])+"="+d(E[1])},"").join("&")};function Qz(l){return encodeURIComponent(l).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Yj(l,a,d){if(!a)return l;const h=d&&d.encode||Qz,E=d&&d.serialize;let T;if(E?T=E(a,d):T=Te.isURLSearchParams(a)?a.toString():new Vw(a,d).toString(h),T){const R=l.indexOf("#");R!==-1&&(l=l.slice(0,R)),l+=(l.indexOf("?")===-1?"?":"&")+T}return l}class kU{constructor(){this.handlers=[]}use(a,d,h){return this.handlers.push({fulfilled:a,rejected:d,synchronous:h?h.synchronous:!1,runWhen:h?h.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){Te.forEach(this.handlers,function(h){h!==null&&a(h)})}}const zj={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Zz=typeof URLSearchParams<"u"?URLSearchParams:Vw,eq=typeof FormData<"u"?FormData:null,tq=typeof Blob<"u"?Blob:null,nq={isBrowser:!0,classes:{URLSearchParams:Zz,FormData:eq,Blob:tq},protocols:["http","https","file","blob","url","data"]},Fw=typeof window<"u"&&typeof document<"u",Ew=typeof navigator=="object"&&navigator||void 0,iq=Fw&&(!Ew||["ReactNative","NativeScript","NS"].indexOf(Ew.product)<0),rq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",sq=Fw&&window.location.href||"http://localhost",oq=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Fw,hasStandardBrowserEnv:iq,hasStandardBrowserWebWorkerEnv:rq,navigator:Ew,origin:sq},Symbol.toStringTag,{value:"Module"})),Mr={...oq,...nq};function aq(l,a){return sS(l,new Mr.classes.URLSearchParams,Object.assign({visitor:function(d,h,E,T){return Mr.isNode&&Te.isBuffer(d)?(this.append(h,d.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},a))}function cq(l){return Te.matchAll(/\w+|\[(\w*)]/g,l).map(a=>a[0]==="[]"?"":a[1]||a[0])}function lq(l){const a={},d=Object.keys(l);let h;const E=d.length;let T;for(h=0;h<E;h++)T=d[h],a[T]=l[T];return a}function qj(l){function a(d,h,E,T){let R=d[T++];if(R==="__proto__")return!0;const N=Number.isFinite(+R),I=T>=d.length;return R=!R&&Te.isArray(E)?E.length:R,I?(Te.hasOwnProp(E,R)?E[R]=[E[R],h]:E[R]=h,!N):((!E[R]||!Te.isObject(E[R]))&&(E[R]=[]),a(d,h,E[R],T)&&Te.isArray(E[R])&&(E[R]=lq(E[R])),!N)}if(Te.isFormData(l)&&Te.isFunction(l.entries)){const d={};return Te.forEachEntry(l,(h,E)=>{a(cq(h),E,d,0)}),d}return null}function dq(l,a,d){if(Te.isString(l))try{return(a||JSON.parse)(l),Te.trim(l)}catch(h){if(h.name!=="SyntaxError")throw h}return(0,JSON.stringify)(l)}const bf={transitional:zj,adapter:["xhr","http","fetch"],transformRequest:[function(a,d){const h=d.getContentType()||"",E=h.indexOf("application/json")>-1,T=Te.isObject(a);if(T&&Te.isHTMLForm(a)&&(a=new FormData(a)),Te.isFormData(a))return E?JSON.stringify(qj(a)):a;if(Te.isArrayBuffer(a)||Te.isBuffer(a)||Te.isStream(a)||Te.isFile(a)||Te.isBlob(a)||Te.isReadableStream(a))return a;if(Te.isArrayBufferView(a))return a.buffer;if(Te.isURLSearchParams(a))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let N;if(T){if(h.indexOf("application/x-www-form-urlencoded")>-1)return aq(a,this.formSerializer).toString();if((N=Te.isFileList(a))||h.indexOf("multipart/form-data")>-1){const I=this.env&&this.env.FormData;return sS(N?{"files[]":a}:a,I&&new I,this.formSerializer)}}return T||E?(d.setContentType("application/json",!1),dq(a)):a}],transformResponse:[function(a){const d=this.transitional||bf.transitional,h=d&&d.forcedJSONParsing,E=this.responseType==="json";if(Te.isResponse(a)||Te.isReadableStream(a))return a;if(a&&Te.isString(a)&&(h&&!this.responseType||E)){const R=!(d&&d.silentJSONParsing)&&E;try{return JSON.parse(a)}catch(N){if(R)throw N.name==="SyntaxError"?Pt.from(N,Pt.ERR_BAD_RESPONSE,this,null,this.response):N}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Mr.classes.FormData,Blob:Mr.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Te.forEach(["delete","get","head","post","put","patch"],l=>{bf.headers[l]={}});const uq=Te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hq=l=>{const a={};let d,h,E;return l&&l.split(`
`).forEach(function(R){E=R.indexOf(":"),d=R.substring(0,E).trim().toLowerCase(),h=R.substring(E+1).trim(),!(!d||a[d]&&uq[d])&&(d==="set-cookie"?a[d]?a[d].push(h):a[d]=[h]:a[d]=a[d]?a[d]+", "+h:h)}),a},xU=Symbol("internals");function uf(l){return l&&String(l).trim().toLowerCase()}function Lg(l){return l===!1||l==null?l:Te.isArray(l)?l.map(Lg):String(l)}function pq(l){const a=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let h;for(;h=d.exec(l);)a[h[1]]=h[2];return a}const fq=l=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(l.trim());function XC(l,a,d,h,E){if(Te.isFunction(h))return h.call(this,a,d);if(E&&(a=d),!!Te.isString(a)){if(Te.isString(h))return a.indexOf(h)!==-1;if(Te.isRegExp(h))return h.test(a)}}function mq(l){return l.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,d,h)=>d.toUpperCase()+h)}function _q(l,a){const d=Te.toCamelCase(" "+a);["get","set","has"].forEach(h=>{Object.defineProperty(l,h+d,{value:function(E,T,R){return this[h].call(this,a,E,T,R)},configurable:!0})})}class Ur{constructor(a){a&&this.set(a)}set(a,d,h){const E=this;function T(N,I,j){const M=uf(I);if(!M)throw new Error("header name must be a non-empty string");const F=Te.findKey(E,M);(!F||E[F]===void 0||j===!0||j===void 0&&E[F]!==!1)&&(E[F||I]=Lg(N))}const R=(N,I)=>Te.forEach(N,(j,M)=>T(j,M,I));if(Te.isPlainObject(a)||a instanceof this.constructor)R(a,d);else if(Te.isString(a)&&(a=a.trim())&&!fq(a))R(hq(a),d);else if(Te.isHeaders(a))for(const[N,I]of a.entries())T(I,N,h);else a!=null&&T(d,a,h);return this}get(a,d){if(a=uf(a),a){const h=Te.findKey(this,a);if(h){const E=this[h];if(!d)return E;if(d===!0)return pq(E);if(Te.isFunction(d))return d.call(this,E,h);if(Te.isRegExp(d))return d.exec(E);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,d){if(a=uf(a),a){const h=Te.findKey(this,a);return!!(h&&this[h]!==void 0&&(!d||XC(this,this[h],h,d)))}return!1}delete(a,d){const h=this;let E=!1;function T(R){if(R=uf(R),R){const N=Te.findKey(h,R);N&&(!d||XC(h,h[N],N,d))&&(delete h[N],E=!0)}}return Te.isArray(a)?a.forEach(T):T(a),E}clear(a){const d=Object.keys(this);let h=d.length,E=!1;for(;h--;){const T=d[h];(!a||XC(this,this[T],T,a,!0))&&(delete this[T],E=!0)}return E}normalize(a){const d=this,h={};return Te.forEach(this,(E,T)=>{const R=Te.findKey(h,T);if(R){d[R]=Lg(E),delete d[T];return}const N=a?mq(T):String(T).trim();N!==T&&delete d[T],d[N]=Lg(E),h[N]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const d=Object.create(null);return Te.forEach(this,(h,E)=>{h!=null&&h!==!1&&(d[E]=a&&Te.isArray(h)?h.join(", "):h)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,d])=>a+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...d){const h=new this(a);return d.forEach(E=>h.set(E)),h}static accessor(a){const h=(this[xU]=this[xU]={accessors:{}}).accessors,E=this.prototype;function T(R){const N=uf(R);h[N]||(_q(E,R),h[N]=!0)}return Te.isArray(a)?a.forEach(T):T(a),this}}Ur.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Te.reduceDescriptors(Ur.prototype,({value:l},a)=>{let d=a[0].toUpperCase()+a.slice(1);return{get:()=>l,set(h){this[d]=h}}});Te.freezeMethods(Ur);function QC(l,a){const d=this||bf,h=a||d,E=Ur.from(h.headers);let T=h.data;return Te.forEach(l,function(N){T=N.call(d,T,E.normalize(),a?a.status:void 0)}),E.normalize(),T}function $j(l){return!!(l&&l.__CANCEL__)}function ju(l,a,d){Pt.call(this,l??"canceled",Pt.ERR_CANCELED,a,d),this.name="CanceledError"}Te.inherits(ju,Pt,{__CANCEL__:!0});function Jj(l,a,d){const h=d.config.validateStatus;!d.status||!h||h(d.status)?l(d):a(new Pt("Request failed with status code "+d.status,[Pt.ERR_BAD_REQUEST,Pt.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function Eq(l){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(l);return a&&a[1]||""}function gq(l,a){l=l||10;const d=new Array(l),h=new Array(l);let E=0,T=0,R;return a=a!==void 0?a:1e3,function(I){const j=Date.now(),M=h[T];R||(R=j),d[E]=I,h[E]=j;let F=T,Y=0;for(;F!==E;)Y+=d[F++],F=F%l;if(E=(E+1)%l,E===T&&(T=(T+1)%l),j-R<a)return;const Z=M&&j-M;return Z?Math.round(Y*1e3/Z):void 0}}function Sq(l,a){let d=0,h=1e3/a,E,T;const R=(j,M=Date.now())=>{d=M,E=null,T&&(clearTimeout(T),T=null),l.apply(null,j)};return[(...j)=>{const M=Date.now(),F=M-d;F>=h?R(j,M):(E=j,T||(T=setTimeout(()=>{T=null,R(E)},h-F)))},()=>E&&R(E)]}const Kg=(l,a,d=3)=>{let h=0;const E=gq(50,250);return Sq(T=>{const R=T.loaded,N=T.lengthComputable?T.total:void 0,I=R-h,j=E(I),M=R<=N;h=R;const F={loaded:R,total:N,progress:N?R/N:void 0,bytes:I,rate:j||void 0,estimated:j&&N&&M?(N-R)/j:void 0,event:T,lengthComputable:N!=null,[a?"download":"upload"]:!0};l(F)},d)},MU=(l,a)=>{const d=l!=null;return[h=>a[0]({lengthComputable:d,total:l,loaded:h}),a[1]]},UU=l=>(...a)=>Te.asap(()=>l(...a)),Tq=Mr.hasStandardBrowserEnv?function(){const a=Mr.navigator&&/(msie|trident)/i.test(Mr.navigator.userAgent),d=document.createElement("a");let h;function E(T){let R=T;return a&&(d.setAttribute("href",R),R=d.href),d.setAttribute("href",R),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return h=E(window.location.href),function(R){const N=Te.isString(R)?E(R):R;return N.protocol===h.protocol&&N.host===h.host}}():function(){return function(){return!0}}(),vq=Mr.hasStandardBrowserEnv?{write(l,a,d,h,E,T){const R=[l+"="+encodeURIComponent(a)];Te.isNumber(d)&&R.push("expires="+new Date(d).toGMTString()),Te.isString(h)&&R.push("path="+h),Te.isString(E)&&R.push("domain="+E),T===!0&&R.push("secure"),document.cookie=R.join("; ")},read(l){const a=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove(l){this.write(l,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function yq(l){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(l)}function Rq(l,a){return a?l.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):l}function Xj(l,a){return l&&!yq(a)?Rq(l,a):a}const jU=l=>l instanceof Ur?{...l}:l;function kl(l,a){a=a||{};const d={};function h(j,M,F){return Te.isPlainObject(j)&&Te.isPlainObject(M)?Te.merge.call({caseless:F},j,M):Te.isPlainObject(M)?Te.merge({},M):Te.isArray(M)?M.slice():M}function E(j,M,F){if(Te.isUndefined(M)){if(!Te.isUndefined(j))return h(void 0,j,F)}else return h(j,M,F)}function T(j,M){if(!Te.isUndefined(M))return h(void 0,M)}function R(j,M){if(Te.isUndefined(M)){if(!Te.isUndefined(j))return h(void 0,j)}else return h(void 0,M)}function N(j,M,F){if(F in a)return h(j,M);if(F in l)return h(void 0,j)}const I={url:T,method:T,data:T,baseURL:R,transformRequest:R,transformResponse:R,paramsSerializer:R,timeout:R,timeoutMessage:R,withCredentials:R,withXSRFToken:R,adapter:R,responseType:R,xsrfCookieName:R,xsrfHeaderName:R,onUploadProgress:R,onDownloadProgress:R,decompress:R,maxContentLength:R,maxBodyLength:R,beforeRedirect:R,transport:R,httpAgent:R,httpsAgent:R,cancelToken:R,socketPath:R,responseEncoding:R,validateStatus:N,headers:(j,M)=>E(jU(j),jU(M),!0)};return Te.forEach(Object.keys(Object.assign({},l,a)),function(M){const F=I[M]||E,Y=F(l[M],a[M],M);Te.isUndefined(Y)&&F!==N||(d[M]=Y)}),d}const Qj=l=>{const a=kl({},l);let{data:d,withXSRFToken:h,xsrfHeaderName:E,xsrfCookieName:T,headers:R,auth:N}=a;a.headers=R=Ur.from(R),a.url=Yj(Xj(a.baseURL,a.url),l.params,l.paramsSerializer),N&&R.set("Authorization","Basic "+btoa((N.username||"")+":"+(N.password?unescape(encodeURIComponent(N.password)):"")));let I;if(Te.isFormData(d)){if(Mr.hasStandardBrowserEnv||Mr.hasStandardBrowserWebWorkerEnv)R.setContentType(void 0);else if((I=R.getContentType())!==!1){const[j,...M]=I?I.split(";").map(F=>F.trim()).filter(Boolean):[];R.setContentType([j||"multipart/form-data",...M].join("; "))}}if(Mr.hasStandardBrowserEnv&&(h&&Te.isFunction(h)&&(h=h(a)),h||h!==!1&&Tq(a.url))){const j=E&&T&&vq.read(T);j&&R.set(E,j)}return a},bq=typeof XMLHttpRequest<"u",Cq=bq&&function(l){return new Promise(function(d,h){const E=Qj(l);let T=E.data;const R=Ur.from(E.headers).normalize();let{responseType:N,onUploadProgress:I,onDownloadProgress:j}=E,M,F,Y,Z,X;function q(){Z&&Z(),X&&X(),E.cancelToken&&E.cancelToken.unsubscribe(M),E.signal&&E.signal.removeEventListener("abort",M)}let re=new XMLHttpRequest;re.open(E.method.toUpperCase(),E.url,!0),re.timeout=E.timeout;function se(){if(!re)return;const Q=Ur.from("getAllResponseHeaders"in re&&re.getAllResponseHeaders()),Ee={data:!N||N==="text"||N==="json"?re.responseText:re.response,status:re.status,statusText:re.statusText,headers:Q,config:l,request:re};Jj(function(Oe){d(Oe),q()},function(Oe){h(Oe),q()},Ee),re=null}"onloadend"in re?re.onloadend=se:re.onreadystatechange=function(){!re||re.readyState!==4||re.status===0&&!(re.responseURL&&re.responseURL.indexOf("file:")===0)||setTimeout(se)},re.onabort=function(){re&&(h(new Pt("Request aborted",Pt.ECONNABORTED,l,re)),re=null)},re.onerror=function(){h(new Pt("Network Error",Pt.ERR_NETWORK,l,re)),re=null},re.ontimeout=function(){let me=E.timeout?"timeout of "+E.timeout+"ms exceeded":"timeout exceeded";const Ee=E.transitional||zj;E.timeoutErrorMessage&&(me=E.timeoutErrorMessage),h(new Pt(me,Ee.clarifyTimeoutError?Pt.ETIMEDOUT:Pt.ECONNABORTED,l,re)),re=null},T===void 0&&R.setContentType(null),"setRequestHeader"in re&&Te.forEach(R.toJSON(),function(me,Ee){re.setRequestHeader(Ee,me)}),Te.isUndefined(E.withCredentials)||(re.withCredentials=!!E.withCredentials),N&&N!=="json"&&(re.responseType=E.responseType),j&&([Y,X]=Kg(j,!0),re.addEventListener("progress",Y)),I&&re.upload&&([F,Z]=Kg(I),re.upload.addEventListener("progress",F),re.upload.addEventListener("loadend",Z)),(E.cancelToken||E.signal)&&(M=Q=>{re&&(h(!Q||Q.type?new ju(null,l,re):Q),re.abort(),re=null)},E.cancelToken&&E.cancelToken.subscribe(M),E.signal&&(E.signal.aborted?M():E.signal.addEventListener("abort",M)));const $=Eq(E.url);if($&&Mr.protocols.indexOf($)===-1){h(new Pt("Unsupported protocol "+$+":",Pt.ERR_BAD_REQUEST,l));return}re.send(T||null)})},wq=(l,a)=>{const{length:d}=l=l?l.filter(Boolean):[];if(a||d){let h=new AbortController,E;const T=function(j){if(!E){E=!0,N();const M=j instanceof Error?j:this.reason;h.abort(M instanceof Pt?M:new ju(M instanceof Error?M.message:M))}};let R=a&&setTimeout(()=>{R=null,T(new Pt(`timeout ${a} of ms exceeded`,Pt.ETIMEDOUT))},a);const N=()=>{l&&(R&&clearTimeout(R),R=null,l.forEach(j=>{j.unsubscribe?j.unsubscribe(T):j.removeEventListener("abort",T)}),l=null)};l.forEach(j=>j.addEventListener("abort",T));const{signal:I}=h;return I.unsubscribe=()=>Te.asap(N),I}},Aq=function*(l,a){let d=l.byteLength;if(d<a){yield l;return}let h=0,E;for(;h<d;)E=h+a,yield l.slice(h,E),h=E},Iq=async function*(l,a){for await(const d of Oq(l))yield*Aq(d,a)},Oq=async function*(l){if(l[Symbol.asyncIterator]){yield*l;return}const a=l.getReader();try{for(;;){const{done:d,value:h}=await a.read();if(d)break;yield h}}finally{await a.cancel()}},VU=(l,a,d,h)=>{const E=Iq(l,a);let T=0,R,N=I=>{R||(R=!0,h&&h(I))};return new ReadableStream({async pull(I){try{const{done:j,value:M}=await E.next();if(j){N(),I.close();return}let F=M.byteLength;if(d){let Y=T+=F;d(Y)}I.enqueue(new Uint8Array(M))}catch(j){throw N(j),j}},cancel(I){return N(I),E.return()}},{highWaterMark:2})},oS=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Zj=oS&&typeof ReadableStream=="function",Nq=oS&&(typeof TextEncoder=="function"?(l=>a=>l.encode(a))(new TextEncoder):async l=>new Uint8Array(await new Response(l).arrayBuffer())),eV=(l,...a)=>{try{return!!l(...a)}catch{return!1}},Dq=Zj&&eV(()=>{let l=!1;const a=new Request(Mr.origin,{body:new ReadableStream,method:"POST",get duplex(){return l=!0,"half"}}).headers.has("Content-Type");return l&&!a}),FU=64*1024,gw=Zj&&eV(()=>Te.isReadableStream(new Response("").body)),Yg={stream:gw&&(l=>l.body)};oS&&(l=>{["text","arrayBuffer","blob","formData","stream"].forEach(a=>{!Yg[a]&&(Yg[a]=Te.isFunction(l[a])?d=>d[a]():(d,h)=>{throw new Pt(`Response type '${a}' is not supported`,Pt.ERR_NOT_SUPPORT,h)})})})(new Response);const Pq=async l=>{if(l==null)return 0;if(Te.isBlob(l))return l.size;if(Te.isSpecCompliantForm(l))return(await new Request(Mr.origin,{method:"POST",body:l}).arrayBuffer()).byteLength;if(Te.isArrayBufferView(l)||Te.isArrayBuffer(l))return l.byteLength;if(Te.isURLSearchParams(l)&&(l=l+""),Te.isString(l))return(await Nq(l)).byteLength},Lq=async(l,a)=>{const d=Te.toFiniteNumber(l.getContentLength());return d??Pq(a)},kq=oS&&(async l=>{let{url:a,method:d,data:h,signal:E,cancelToken:T,timeout:R,onDownloadProgress:N,onUploadProgress:I,responseType:j,headers:M,withCredentials:F="same-origin",fetchOptions:Y}=Qj(l);j=j?(j+"").toLowerCase():"text";let Z=wq([E,T&&T.toAbortSignal()],R),X;const q=Z&&Z.unsubscribe&&(()=>{Z.unsubscribe()});let re;try{if(I&&Dq&&d!=="get"&&d!=="head"&&(re=await Lq(M,h))!==0){let Ee=new Request(a,{method:"POST",body:h,duplex:"half"}),Ue;if(Te.isFormData(h)&&(Ue=Ee.headers.get("content-type"))&&M.setContentType(Ue),Ee.body){const[Oe,xe]=MU(re,Kg(UU(I)));h=VU(Ee.body,FU,Oe,xe)}}Te.isString(F)||(F=F?"include":"omit");const se="credentials"in Request.prototype;X=new Request(a,{...Y,signal:Z,method:d.toUpperCase(),headers:M.normalize().toJSON(),body:h,duplex:"half",credentials:se?F:void 0});let $=await fetch(X);const Q=gw&&(j==="stream"||j==="response");if(gw&&(N||Q&&q)){const Ee={};["status","statusText","headers"].forEach(ye=>{Ee[ye]=$[ye]});const Ue=Te.toFiniteNumber($.headers.get("content-length")),[Oe,xe]=N&&MU(Ue,Kg(UU(N),!0))||[];$=new Response(VU($.body,FU,Oe,()=>{xe&&xe(),q&&q()}),Ee)}j=j||"text";let me=await Yg[Te.findKey(Yg,j)||"text"]($,l);return!Q&&q&&q(),await new Promise((Ee,Ue)=>{Jj(Ee,Ue,{data:me,headers:Ur.from($.headers),status:$.status,statusText:$.statusText,config:l,request:X})})}catch(se){throw q&&q(),se&&se.name==="TypeError"&&/fetch/i.test(se.message)?Object.assign(new Pt("Network Error",Pt.ERR_NETWORK,l,X),{cause:se.cause||se}):Pt.from(se,se&&se.code,l,X)}}),Sw={http:$z,xhr:Cq,fetch:kq};Te.forEach(Sw,(l,a)=>{if(l){try{Object.defineProperty(l,"name",{value:a})}catch{}Object.defineProperty(l,"adapterName",{value:a})}});const BU=l=>`- ${l}`,xq=l=>Te.isFunction(l)||l===null||l===!1,tV={getAdapter:l=>{l=Te.isArray(l)?l:[l];const{length:a}=l;let d,h;const E={};for(let T=0;T<a;T++){d=l[T];let R;if(h=d,!xq(d)&&(h=Sw[(R=String(d)).toLowerCase()],h===void 0))throw new Pt(`Unknown adapter '${R}'`);if(h)break;E[R||"#"+T]=h}if(!h){const T=Object.entries(E).map(([N,I])=>`adapter ${N} `+(I===!1?"is not supported by the environment":"is not available in the build"));let R=a?T.length>1?`since :
`+T.map(BU).join(`
`):" "+BU(T[0]):"as no adapter specified";throw new Pt("There is no suitable adapter to dispatch the request "+R,"ERR_NOT_SUPPORT")}return h},adapters:Sw};function ZC(l){if(l.cancelToken&&l.cancelToken.throwIfRequested(),l.signal&&l.signal.aborted)throw new ju(null,l)}function GU(l){return ZC(l),l.headers=Ur.from(l.headers),l.data=QC.call(l,l.transformRequest),["post","put","patch"].indexOf(l.method)!==-1&&l.headers.setContentType("application/x-www-form-urlencoded",!1),tV.getAdapter(l.adapter||bf.adapter)(l).then(function(h){return ZC(l),h.data=QC.call(l,l.transformResponse,h),h.headers=Ur.from(h.headers),h},function(h){return $j(h)||(ZC(l),h&&h.response&&(h.response.data=QC.call(l,l.transformResponse,h.response),h.response.headers=Ur.from(h.response.headers))),Promise.reject(h)})}const nV="1.7.7",Bw={};["object","boolean","number","function","string","symbol"].forEach((l,a)=>{Bw[l]=function(h){return typeof h===l||"a"+(a<1?"n ":" ")+l}});const HU={};Bw.transitional=function(a,d,h){function E(T,R){return"[Axios v"+nV+"] Transitional option '"+T+"'"+R+(h?". "+h:"")}return(T,R,N)=>{if(a===!1)throw new Pt(E(R," has been removed"+(d?" in "+d:"")),Pt.ERR_DEPRECATED);return d&&!HU[R]&&(HU[R]=!0,console.warn(E(R," has been deprecated since v"+d+" and will be removed in the near future"))),a?a(T,R,N):!0}};function Mq(l,a,d){if(typeof l!="object")throw new Pt("options must be an object",Pt.ERR_BAD_OPTION_VALUE);const h=Object.keys(l);let E=h.length;for(;E-- >0;){const T=h[E],R=a[T];if(R){const N=l[T],I=N===void 0||R(N,T,l);if(I!==!0)throw new Pt("option "+T+" must be "+I,Pt.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new Pt("Unknown option "+T,Pt.ERR_BAD_OPTION)}}const Tw={assertOptions:Mq,validators:Bw},Nc=Tw.validators;class Ll{constructor(a){this.defaults=a,this.interceptors={request:new kU,response:new kU}}async request(a,d){try{return await this._request(a,d)}catch(h){if(h instanceof Error){let E;Error.captureStackTrace?Error.captureStackTrace(E={}):E=new Error;const T=E.stack?E.stack.replace(/^.+\n/,""):"";try{h.stack?T&&!String(h.stack).endsWith(T.replace(/^.+\n.+\n/,""))&&(h.stack+=`
`+T):h.stack=T}catch{}}throw h}}_request(a,d){typeof a=="string"?(d=d||{},d.url=a):d=a||{},d=kl(this.defaults,d);const{transitional:h,paramsSerializer:E,headers:T}=d;h!==void 0&&Tw.assertOptions(h,{silentJSONParsing:Nc.transitional(Nc.boolean),forcedJSONParsing:Nc.transitional(Nc.boolean),clarifyTimeoutError:Nc.transitional(Nc.boolean)},!1),E!=null&&(Te.isFunction(E)?d.paramsSerializer={serialize:E}:Tw.assertOptions(E,{encode:Nc.function,serialize:Nc.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let R=T&&Te.merge(T.common,T[d.method]);T&&Te.forEach(["delete","get","head","post","put","patch","common"],X=>{delete T[X]}),d.headers=Ur.concat(R,T);const N=[];let I=!0;this.interceptors.request.forEach(function(q){typeof q.runWhen=="function"&&q.runWhen(d)===!1||(I=I&&q.synchronous,N.unshift(q.fulfilled,q.rejected))});const j=[];this.interceptors.response.forEach(function(q){j.push(q.fulfilled,q.rejected)});let M,F=0,Y;if(!I){const X=[GU.bind(this),void 0];for(X.unshift.apply(X,N),X.push.apply(X,j),Y=X.length,M=Promise.resolve(d);F<Y;)M=M.then(X[F++],X[F++]);return M}Y=N.length;let Z=d;for(F=0;F<Y;){const X=N[F++],q=N[F++];try{Z=X(Z)}catch(re){q.call(this,re);break}}try{M=GU.call(this,Z)}catch(X){return Promise.reject(X)}for(F=0,Y=j.length;F<Y;)M=M.then(j[F++],j[F++]);return M}getUri(a){a=kl(this.defaults,a);const d=Xj(a.baseURL,a.url);return Yj(d,a.params,a.paramsSerializer)}}Te.forEach(["delete","get","head","options"],function(a){Ll.prototype[a]=function(d,h){return this.request(kl(h||{},{method:a,url:d,data:(h||{}).data}))}});Te.forEach(["post","put","patch"],function(a){function d(h){return function(T,R,N){return this.request(kl(N||{},{method:a,headers:h?{"Content-Type":"multipart/form-data"}:{},url:T,data:R}))}}Ll.prototype[a]=d(),Ll.prototype[a+"Form"]=d(!0)});class Gw{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(T){d=T});const h=this;this.promise.then(E=>{if(!h._listeners)return;let T=h._listeners.length;for(;T-- >0;)h._listeners[T](E);h._listeners=null}),this.promise.then=E=>{let T;const R=new Promise(N=>{h.subscribe(N),T=N}).then(E);return R.cancel=function(){h.unsubscribe(T)},R},a(function(T,R,N){h.reason||(h.reason=new ju(T,R,N),d(h.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const d=this._listeners.indexOf(a);d!==-1&&this._listeners.splice(d,1)}toAbortSignal(){const a=new AbortController,d=h=>{a.abort(h)};return this.subscribe(d),a.signal.unsubscribe=()=>this.unsubscribe(d),a.signal}static source(){let a;return{token:new Gw(function(E){a=E}),cancel:a}}}function Uq(l){return function(d){return l.apply(null,d)}}function jq(l){return Te.isObject(l)&&l.isAxiosError===!0}const vw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vw).forEach(([l,a])=>{vw[a]=l});function iV(l){const a=new Ll(l),d=kj(Ll.prototype.request,a);return Te.extend(d,Ll.prototype,a,{allOwnKeys:!0}),Te.extend(d,a,null,{allOwnKeys:!0}),d.create=function(E){return iV(kl(l,E))},d}const ci=iV(bf);ci.Axios=Ll;ci.CanceledError=ju;ci.CancelToken=Gw;ci.isCancel=$j;ci.VERSION=nV;ci.toFormData=sS;ci.AxiosError=Pt;ci.Cancel=ci.CanceledError;ci.all=function(a){return Promise.all(a)};ci.spread=Uq;ci.isAxiosError=jq;ci.mergeConfig=kl;ci.AxiosHeaders=Ur;ci.formToJSON=l=>qj(Te.isHTMLForm(l)?new FormData(l):l);ci.getAdapter=tV.getAdapter;ci.HttpStatusCode=vw;ci.default=ci;const Vq="/assets/_c41fd9c8-37b4-4ced-a109-30ba1dde9350.BZm4w6qW.jpg";function WU(l){return l!==null&&typeof l=="object"&&"constructor"in l&&l.constructor===Object}function Hw(l,a){l===void 0&&(l={}),a===void 0&&(a={}),Object.keys(a).forEach(d=>{typeof l[d]>"u"?l[d]=a[d]:WU(a[d])&&WU(l[d])&&Object.keys(a[d]).length>0&&Hw(l[d],a[d])})}const rV={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function wa(){const l=typeof document<"u"?document:{};return Hw(l,rV),l}const Fq={document:rV,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(l){return typeof setTimeout>"u"?(l(),null):setTimeout(l,0)},cancelAnimationFrame(l){typeof setTimeout>"u"||clearTimeout(l)}};function ts(){const l=typeof window<"u"?window:{};return Hw(l,Fq),l}function Bq(l){return l===void 0&&(l=""),l.trim().split(" ").filter(a=>!!a.trim())}function Gq(l){const a=l;Object.keys(a).forEach(d=>{try{a[d]=null}catch{}try{delete a[d]}catch{}})}function yw(l,a){return a===void 0&&(a=0),setTimeout(l,a)}function zg(){return Date.now()}function Hq(l){const a=ts();let d;return a.getComputedStyle&&(d=a.getComputedStyle(l,null)),!d&&l.currentStyle&&(d=l.currentStyle),d||(d=l.style),d}function Wq(l,a){a===void 0&&(a="x");const d=ts();let h,E,T;const R=Hq(l);return d.WebKitCSSMatrix?(E=R.transform||R.webkitTransform,E.split(",").length>6&&(E=E.split(", ").map(N=>N.replace(",",".")).join(", ")),T=new d.WebKitCSSMatrix(E==="none"?"":E)):(T=R.MozTransform||R.OTransform||R.MsTransform||R.msTransform||R.transform||R.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),h=T.toString().split(",")),a==="x"&&(d.WebKitCSSMatrix?E=T.m41:h.length===16?E=parseFloat(h[12]):E=parseFloat(h[4])),a==="y"&&(d.WebKitCSSMatrix?E=T.m42:h.length===16?E=parseFloat(h[13]):E=parseFloat(h[5])),E||0}function Ig(l){return typeof l=="object"&&l!==null&&l.constructor&&Object.prototype.toString.call(l).slice(8,-1)==="Object"}function Kq(l){return typeof window<"u"&&typeof window.HTMLElement<"u"?l instanceof HTMLElement:l&&(l.nodeType===1||l.nodeType===11)}function Zr(){const l=Object(arguments.length<=0?void 0:arguments[0]),a=["__proto__","constructor","prototype"];for(let d=1;d<arguments.length;d+=1){const h=d<0||arguments.length<=d?void 0:arguments[d];if(h!=null&&!Kq(h)){const E=Object.keys(Object(h)).filter(T=>a.indexOf(T)<0);for(let T=0,R=E.length;T<R;T+=1){const N=E[T],I=Object.getOwnPropertyDescriptor(h,N);I!==void 0&&I.enumerable&&(Ig(l[N])&&Ig(h[N])?h[N].__swiper__?l[N]=h[N]:Zr(l[N],h[N]):!Ig(l[N])&&Ig(h[N])?(l[N]={},h[N].__swiper__?l[N]=h[N]:Zr(l[N],h[N])):l[N]=h[N])}}}return l}function Og(l,a,d){l.style.setProperty(a,d)}function sV(l){let{swiper:a,targetPosition:d,side:h}=l;const E=ts(),T=-a.translate;let R=null,N;const I=a.params.speed;a.wrapperEl.style.scrollSnapType="none",E.cancelAnimationFrame(a.cssModeFrameID);const j=d>T?"next":"prev",M=(Y,Z)=>j==="next"&&Y>=Z||j==="prev"&&Y<=Z,F=()=>{N=new Date().getTime(),R===null&&(R=N);const Y=Math.max(Math.min((N-R)/I,1),0),Z=.5-Math.cos(Y*Math.PI)/2;let X=T+Z*(d-T);if(M(X,d)&&(X=d),a.wrapperEl.scrollTo({[h]:X}),M(X,d)){a.wrapperEl.style.overflow="hidden",a.wrapperEl.style.scrollSnapType="",setTimeout(()=>{a.wrapperEl.style.overflow="",a.wrapperEl.scrollTo({[h]:X})}),E.cancelAnimationFrame(a.cssModeFrameID);return}a.cssModeFrameID=E.requestAnimationFrame(F)};F()}function Bo(l,a){a===void 0&&(a="");const d=[...l.children];return l instanceof HTMLSlotElement&&d.push(...l.assignedElements()),a?d.filter(h=>h.matches(a)):d}function Yq(l,a){const d=a.contains(l);return!d&&a instanceof HTMLSlotElement?[...a.assignedElements()].includes(l):d}function qg(l){try{console.warn(l);return}catch{}}function $g(l,a){a===void 0&&(a=[]);const d=document.createElement(l);return d.classList.add(...Array.isArray(a)?a:Bq(a)),d}function zq(l,a){const d=[];for(;l.previousElementSibling;){const h=l.previousElementSibling;a?h.matches(a)&&d.push(h):d.push(h),l=h}return d}function qq(l,a){const d=[];for(;l.nextElementSibling;){const h=l.nextElementSibling;a?h.matches(a)&&d.push(h):d.push(h),l=h}return d}function Pc(l,a){return ts().getComputedStyle(l,null).getPropertyValue(a)}function Jg(l){let a=l,d;if(a){for(d=0;(a=a.previousSibling)!==null;)a.nodeType===1&&(d+=1);return d}}function oV(l,a){const d=[];let h=l.parentElement;for(;h;)a?h.matches(a)&&d.push(h):d.push(h),h=h.parentElement;return d}function Rw(l,a,d){const h=ts();return l[a==="width"?"offsetWidth":"offsetHeight"]+parseFloat(h.getComputedStyle(l,null).getPropertyValue(a==="width"?"margin-right":"margin-top"))+parseFloat(h.getComputedStyle(l,null).getPropertyValue(a==="width"?"margin-left":"margin-bottom"))}function xi(l){return(Array.isArray(l)?l:[l]).filter(a=>!!a)}let ew;function $q(){const l=ts(),a=wa();return{smoothScroll:a.documentElement&&a.documentElement.style&&"scrollBehavior"in a.documentElement.style,touch:!!("ontouchstart"in l||l.DocumentTouch&&a instanceof l.DocumentTouch)}}function aV(){return ew||(ew=$q()),ew}let tw;function Jq(l){let{userAgent:a}=l===void 0?{}:l;const d=aV(),h=ts(),E=h.navigator.platform,T=a||h.navigator.userAgent,R={ios:!1,android:!1},N=h.screen.width,I=h.screen.height,j=T.match(/(Android);?[\s\/]+([\d.]+)?/);let M=T.match(/(iPad).*OS\s([\d_]+)/);const F=T.match(/(iPod)(.*OS\s([\d_]+))?/),Y=!M&&T.match(/(iPhone\sOS|iOS)\s([\d_]+)/),Z=E==="Win32";let X=E==="MacIntel";const q=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!M&&X&&d.touch&&q.indexOf(`${N}x${I}`)>=0&&(M=T.match(/(Version)\/([\d.]+)/),M||(M=[0,1,"13_0_0"]),X=!1),j&&!Z&&(R.os="android",R.android=!0),(M||Y||F)&&(R.os="ios",R.ios=!0),R}function cV(l){return l===void 0&&(l={}),tw||(tw=Jq(l)),tw}let nw;function Xq(){const l=ts(),a=cV();let d=!1;function h(){const N=l.navigator.userAgent.toLowerCase();return N.indexOf("safari")>=0&&N.indexOf("chrome")<0&&N.indexOf("android")<0}if(h()){const N=String(l.navigator.userAgent);if(N.includes("Version/")){const[I,j]=N.split("Version/")[1].split(" ")[0].split(".").map(M=>Number(M));d=I<16||I===16&&j<2}}const E=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(l.navigator.userAgent),T=h(),R=T||E&&a.ios;return{isSafari:d||T,needPerspectiveFix:d,need3dFix:R,isWebView:E}}function Qq(){return nw||(nw=Xq()),nw}function Zq(l){let{swiper:a,on:d,emit:h}=l;const E=ts();let T=null,R=null;const N=()=>{!a||a.destroyed||!a.initialized||(h("beforeResize"),h("resize"))},I=()=>{!a||a.destroyed||!a.initialized||(T=new ResizeObserver(F=>{R=E.requestAnimationFrame(()=>{const{width:Y,height:Z}=a;let X=Y,q=Z;F.forEach(re=>{let{contentBoxSize:se,contentRect:$,target:Q}=re;Q&&Q!==a.el||(X=$?$.width:(se[0]||se).inlineSize,q=$?$.height:(se[0]||se).blockSize)}),(X!==Y||q!==Z)&&N()})}),T.observe(a.el))},j=()=>{R&&E.cancelAnimationFrame(R),T&&T.unobserve&&a.el&&(T.unobserve(a.el),T=null)},M=()=>{!a||a.destroyed||!a.initialized||h("orientationchange")};d("init",()=>{if(a.params.resizeObserver&&typeof E.ResizeObserver<"u"){I();return}E.addEventListener("resize",N),E.addEventListener("orientationchange",M)}),d("destroy",()=>{j(),E.removeEventListener("resize",N),E.removeEventListener("orientationchange",M)})}function e2(l){let{swiper:a,extendParams:d,on:h,emit:E}=l;const T=[],R=ts(),N=function(M,F){F===void 0&&(F={});const Y=R.MutationObserver||R.WebkitMutationObserver,Z=new Y(X=>{if(a.__preventObserver__)return;if(X.length===1){E("observerUpdate",X[0]);return}const q=function(){E("observerUpdate",X[0])};R.requestAnimationFrame?R.requestAnimationFrame(q):R.setTimeout(q,0)});Z.observe(M,{attributes:typeof F.attributes>"u"?!0:F.attributes,childList:a.isElement||(typeof F.childList>"u"?!0:F).childList,characterData:typeof F.characterData>"u"?!0:F.characterData}),T.push(Z)},I=()=>{if(a.params.observer){if(a.params.observeParents){const M=oV(a.hostEl);for(let F=0;F<M.length;F+=1)N(M[F])}N(a.hostEl,{childList:a.params.observeSlideChildren}),N(a.wrapperEl,{attributes:!1})}},j=()=>{T.forEach(M=>{M.disconnect()}),T.splice(0,T.length)};d({observer:!1,observeParents:!1,observeSlideChildren:!1}),h("init",I),h("destroy",j)}var t2={on(l,a,d){const h=this;if(!h.eventsListeners||h.destroyed||typeof a!="function")return h;const E=d?"unshift":"push";return l.split(" ").forEach(T=>{h.eventsListeners[T]||(h.eventsListeners[T]=[]),h.eventsListeners[T][E](a)}),h},once(l,a,d){const h=this;if(!h.eventsListeners||h.destroyed||typeof a!="function")return h;function E(){h.off(l,E),E.__emitterProxy&&delete E.__emitterProxy;for(var T=arguments.length,R=new Array(T),N=0;N<T;N++)R[N]=arguments[N];a.apply(h,R)}return E.__emitterProxy=a,h.on(l,E,d)},onAny(l,a){const d=this;if(!d.eventsListeners||d.destroyed||typeof l!="function")return d;const h=a?"unshift":"push";return d.eventsAnyListeners.indexOf(l)<0&&d.eventsAnyListeners[h](l),d},offAny(l){const a=this;if(!a.eventsListeners||a.destroyed||!a.eventsAnyListeners)return a;const d=a.eventsAnyListeners.indexOf(l);return d>=0&&a.eventsAnyListeners.splice(d,1),a},off(l,a){const d=this;return!d.eventsListeners||d.destroyed||!d.eventsListeners||l.split(" ").forEach(h=>{typeof a>"u"?d.eventsListeners[h]=[]:d.eventsListeners[h]&&d.eventsListeners[h].forEach((E,T)=>{(E===a||E.__emitterProxy&&E.__emitterProxy===a)&&d.eventsListeners[h].splice(T,1)})}),d},emit(){const l=this;if(!l.eventsListeners||l.destroyed||!l.eventsListeners)return l;let a,d,h;for(var E=arguments.length,T=new Array(E),R=0;R<E;R++)T[R]=arguments[R];return typeof T[0]=="string"||Array.isArray(T[0])?(a=T[0],d=T.slice(1,T.length),h=l):(a=T[0].events,d=T[0].data,h=T[0].context||l),d.unshift(h),(Array.isArray(a)?a:a.split(" ")).forEach(I=>{l.eventsAnyListeners&&l.eventsAnyListeners.length&&l.eventsAnyListeners.forEach(j=>{j.apply(h,[I,...d])}),l.eventsListeners&&l.eventsListeners[I]&&l.eventsListeners[I].forEach(j=>{j.apply(h,d)})}),l}};function n2(){const l=this;let a,d;const h=l.el;typeof l.params.width<"u"&&l.params.width!==null?a=l.params.width:a=h.clientWidth,typeof l.params.height<"u"&&l.params.height!==null?d=l.params.height:d=h.clientHeight,!(a===0&&l.isHorizontal()||d===0&&l.isVertical())&&(a=a-parseInt(Pc(h,"padding-left")||0,10)-parseInt(Pc(h,"padding-right")||0,10),d=d-parseInt(Pc(h,"padding-top")||0,10)-parseInt(Pc(h,"padding-bottom")||0,10),Number.isNaN(a)&&(a=0),Number.isNaN(d)&&(d=0),Object.assign(l,{width:a,height:d,size:l.isHorizontal()?a:d}))}function i2(){const l=this;function a(Le,Ge){return parseFloat(Le.getPropertyValue(l.getDirectionLabel(Ge))||0)}const d=l.params,{wrapperEl:h,slidesEl:E,size:T,rtlTranslate:R,wrongRTL:N}=l,I=l.virtual&&d.virtual.enabled,j=I?l.virtual.slides.length:l.slides.length,M=Bo(E,`.${l.params.slideClass}, swiper-slide`),F=I?l.virtual.slides.length:M.length;let Y=[];const Z=[],X=[];let q=d.slidesOffsetBefore;typeof q=="function"&&(q=d.slidesOffsetBefore.call(l));let re=d.slidesOffsetAfter;typeof re=="function"&&(re=d.slidesOffsetAfter.call(l));const se=l.snapGrid.length,$=l.slidesGrid.length;let Q=d.spaceBetween,me=-q,Ee=0,Ue=0;if(typeof T>"u")return;typeof Q=="string"&&Q.indexOf("%")>=0?Q=parseFloat(Q.replace("%",""))/100*T:typeof Q=="string"&&(Q=parseFloat(Q)),l.virtualSize=-Q,M.forEach(Le=>{R?Le.style.marginLeft="":Le.style.marginRight="",Le.style.marginBottom="",Le.style.marginTop=""}),d.centeredSlides&&d.cssMode&&(Og(h,"--swiper-centered-offset-before",""),Og(h,"--swiper-centered-offset-after",""));const Oe=d.grid&&d.grid.rows>1&&l.grid;Oe?l.grid.initSlides(M):l.grid&&l.grid.unsetSlides();let xe;const ye=d.slidesPerView==="auto"&&d.breakpoints&&Object.keys(d.breakpoints).filter(Le=>typeof d.breakpoints[Le].slidesPerView<"u").length>0;for(let Le=0;Le<F;Le+=1){xe=0;let Ge;if(M[Le]&&(Ge=M[Le]),Oe&&l.grid.updateSlide(Le,Ge,M),!(M[Le]&&Pc(Ge,"display")==="none")){if(d.slidesPerView==="auto"){ye&&(M[Le].style[l.getDirectionLabel("width")]="");const Qe=getComputedStyle(Ge),We=Ge.style.transform,ht=Ge.style.webkitTransform;if(We&&(Ge.style.transform="none"),ht&&(Ge.style.webkitTransform="none"),d.roundLengths)xe=l.isHorizontal()?Rw(Ge,"width"):Rw(Ge,"height");else{const Ze=a(Qe,"width"),wn=a(Qe,"padding-left"),li=a(Qe,"padding-right"),Ht=a(Qe,"margin-left"),qt=a(Qe,"margin-right"),ft=Qe.getPropertyValue("box-sizing");if(ft&&ft==="border-box")xe=Ze+Ht+qt;else{const{clientWidth:gr,offsetWidth:so}=Ge;xe=Ze+wn+li+Ht+qt+(so-gr)}}We&&(Ge.style.transform=We),ht&&(Ge.style.webkitTransform=ht),d.roundLengths&&(xe=Math.floor(xe))}else xe=(T-(d.slidesPerView-1)*Q)/d.slidesPerView,d.roundLengths&&(xe=Math.floor(xe)),M[Le]&&(M[Le].style[l.getDirectionLabel("width")]=`${xe}px`);M[Le]&&(M[Le].swiperSlideSize=xe),X.push(xe),d.centeredSlides?(me=me+xe/2+Ee/2+Q,Ee===0&&Le!==0&&(me=me-T/2-Q),Le===0&&(me=me-T/2-Q),Math.abs(me)<1/1e3&&(me=0),d.roundLengths&&(me=Math.floor(me)),Ue%d.slidesPerGroup===0&&Y.push(me),Z.push(me)):(d.roundLengths&&(me=Math.floor(me)),(Ue-Math.min(l.params.slidesPerGroupSkip,Ue))%l.params.slidesPerGroup===0&&Y.push(me),Z.push(me),me=me+xe+Q),l.virtualSize+=xe+Q,Ee=xe,Ue+=1}}if(l.virtualSize=Math.max(l.virtualSize,T)+re,R&&N&&(d.effect==="slide"||d.effect==="coverflow")&&(h.style.width=`${l.virtualSize+Q}px`),d.setWrapperSize&&(h.style[l.getDirectionLabel("width")]=`${l.virtualSize+Q}px`),Oe&&l.grid.updateWrapperSize(xe,Y),!d.centeredSlides){const Le=[];for(let Ge=0;Ge<Y.length;Ge+=1){let Qe=Y[Ge];d.roundLengths&&(Qe=Math.floor(Qe)),Y[Ge]<=l.virtualSize-T&&Le.push(Qe)}Y=Le,Math.floor(l.virtualSize-T)-Math.floor(Y[Y.length-1])>1&&Y.push(l.virtualSize-T)}if(I&&d.loop){const Le=X[0]+Q;if(d.slidesPerGroup>1){const Ge=Math.ceil((l.virtual.slidesBefore+l.virtual.slidesAfter)/d.slidesPerGroup),Qe=Le*d.slidesPerGroup;for(let We=0;We<Ge;We+=1)Y.push(Y[Y.length-1]+Qe)}for(let Ge=0;Ge<l.virtual.slidesBefore+l.virtual.slidesAfter;Ge+=1)d.slidesPerGroup===1&&Y.push(Y[Y.length-1]+Le),Z.push(Z[Z.length-1]+Le),l.virtualSize+=Le}if(Y.length===0&&(Y=[0]),Q!==0){const Le=l.isHorizontal()&&R?"marginLeft":l.getDirectionLabel("marginRight");M.filter((Ge,Qe)=>!d.cssMode||d.loop?!0:Qe!==M.length-1).forEach(Ge=>{Ge.style[Le]=`${Q}px`})}if(d.centeredSlides&&d.centeredSlidesBounds){let Le=0;X.forEach(Qe=>{Le+=Qe+(Q||0)}),Le-=Q;const Ge=Le>T?Le-T:0;Y=Y.map(Qe=>Qe<=0?-q:Qe>Ge?Ge+re:Qe)}if(d.centerInsufficientSlides){let Le=0;X.forEach(Qe=>{Le+=Qe+(Q||0)}),Le-=Q;const Ge=(d.slidesOffsetBefore||0)+(d.slidesOffsetAfter||0);if(Le+Ge<T){const Qe=(T-Le-Ge)/2;Y.forEach((We,ht)=>{Y[ht]=We-Qe}),Z.forEach((We,ht)=>{Z[ht]=We+Qe})}}if(Object.assign(l,{slides:M,snapGrid:Y,slidesGrid:Z,slidesSizesGrid:X}),d.centeredSlides&&d.cssMode&&!d.centeredSlidesBounds){Og(h,"--swiper-centered-offset-before",`${-Y[0]}px`),Og(h,"--swiper-centered-offset-after",`${l.size/2-X[X.length-1]/2}px`);const Le=-l.snapGrid[0],Ge=-l.slidesGrid[0];l.snapGrid=l.snapGrid.map(Qe=>Qe+Le),l.slidesGrid=l.slidesGrid.map(Qe=>Qe+Ge)}if(F!==j&&l.emit("slidesLengthChange"),Y.length!==se&&(l.params.watchOverflow&&l.checkOverflow(),l.emit("snapGridLengthChange")),Z.length!==$&&l.emit("slidesGridLengthChange"),d.watchSlidesProgress&&l.updateSlidesOffset(),l.emit("slidesUpdated"),!I&&!d.cssMode&&(d.effect==="slide"||d.effect==="fade")){const Le=`${d.containerModifierClass}backface-hidden`,Ge=l.el.classList.contains(Le);F<=d.maxBackfaceHiddenSlides?Ge||l.el.classList.add(Le):Ge&&l.el.classList.remove(Le)}}function r2(l){const a=this,d=[],h=a.virtual&&a.params.virtual.enabled;let E=0,T;typeof l=="number"?a.setTransition(l):l===!0&&a.setTransition(a.params.speed);const R=N=>h?a.slides[a.getSlideIndexByData(N)]:a.slides[N];if(a.params.slidesPerView!=="auto"&&a.params.slidesPerView>1)if(a.params.centeredSlides)(a.visibleSlides||[]).forEach(N=>{d.push(N)});else for(T=0;T<Math.ceil(a.params.slidesPerView);T+=1){const N=a.activeIndex+T;if(N>a.slides.length&&!h)break;d.push(R(N))}else d.push(R(a.activeIndex));for(T=0;T<d.length;T+=1)if(typeof d[T]<"u"){const N=d[T].offsetHeight;E=N>E?N:E}(E||E===0)&&(a.wrapperEl.style.height=`${E}px`)}function s2(){const l=this,a=l.slides,d=l.isElement?l.isHorizontal()?l.wrapperEl.offsetLeft:l.wrapperEl.offsetTop:0;for(let h=0;h<a.length;h+=1)a[h].swiperSlideOffset=(l.isHorizontal()?a[h].offsetLeft:a[h].offsetTop)-d-l.cssOverflowAdjustment()}const KU=(l,a,d)=>{a&&!l.classList.contains(d)?l.classList.add(d):!a&&l.classList.contains(d)&&l.classList.remove(d)};function o2(l){l===void 0&&(l=this&&this.translate||0);const a=this,d=a.params,{slides:h,rtlTranslate:E,snapGrid:T}=a;if(h.length===0)return;typeof h[0].swiperSlideOffset>"u"&&a.updateSlidesOffset();let R=-l;E&&(R=l),a.visibleSlidesIndexes=[],a.visibleSlides=[];let N=d.spaceBetween;typeof N=="string"&&N.indexOf("%")>=0?N=parseFloat(N.replace("%",""))/100*a.size:typeof N=="string"&&(N=parseFloat(N));for(let I=0;I<h.length;I+=1){const j=h[I];let M=j.swiperSlideOffset;d.cssMode&&d.centeredSlides&&(M-=h[0].swiperSlideOffset);const F=(R+(d.centeredSlides?a.minTranslate():0)-M)/(j.swiperSlideSize+N),Y=(R-T[0]+(d.centeredSlides?a.minTranslate():0)-M)/(j.swiperSlideSize+N),Z=-(R-M),X=Z+a.slidesSizesGrid[I],q=Z>=0&&Z<=a.size-a.slidesSizesGrid[I],re=Z>=0&&Z<a.size-1||X>1&&X<=a.size||Z<=0&&X>=a.size;re&&(a.visibleSlides.push(j),a.visibleSlidesIndexes.push(I)),KU(j,re,d.slideVisibleClass),KU(j,q,d.slideFullyVisibleClass),j.progress=E?-F:F,j.originalProgress=E?-Y:Y}}function a2(l){const a=this;if(typeof l>"u"){const M=a.rtlTranslate?-1:1;l=a&&a.translate&&a.translate*M||0}const d=a.params,h=a.maxTranslate()-a.minTranslate();let{progress:E,isBeginning:T,isEnd:R,progressLoop:N}=a;const I=T,j=R;if(h===0)E=0,T=!0,R=!0;else{E=(l-a.minTranslate())/h;const M=Math.abs(l-a.minTranslate())<1,F=Math.abs(l-a.maxTranslate())<1;T=M||E<=0,R=F||E>=1,M&&(E=0),F&&(E=1)}if(d.loop){const M=a.getSlideIndexByData(0),F=a.getSlideIndexByData(a.slides.length-1),Y=a.slidesGrid[M],Z=a.slidesGrid[F],X=a.slidesGrid[a.slidesGrid.length-1],q=Math.abs(l);q>=Y?N=(q-Y)/X:N=(q+X-Z)/X,N>1&&(N-=1)}Object.assign(a,{progress:E,progressLoop:N,isBeginning:T,isEnd:R}),(d.watchSlidesProgress||d.centeredSlides&&d.autoHeight)&&a.updateSlidesProgress(l),T&&!I&&a.emit("reachBeginning toEdge"),R&&!j&&a.emit("reachEnd toEdge"),(I&&!T||j&&!R)&&a.emit("fromEdge"),a.emit("progress",E)}const iw=(l,a,d)=>{a&&!l.classList.contains(d)?l.classList.add(d):!a&&l.classList.contains(d)&&l.classList.remove(d)};function c2(){const l=this,{slides:a,params:d,slidesEl:h,activeIndex:E}=l,T=l.virtual&&d.virtual.enabled,R=l.grid&&d.grid&&d.grid.rows>1,N=F=>Bo(h,`.${d.slideClass}${F}, swiper-slide${F}`)[0];let I,j,M;if(T)if(d.loop){let F=E-l.virtual.slidesBefore;F<0&&(F=l.virtual.slides.length+F),F>=l.virtual.slides.length&&(F-=l.virtual.slides.length),I=N(`[data-swiper-slide-index="${F}"]`)}else I=N(`[data-swiper-slide-index="${E}"]`);else R?(I=a.filter(F=>F.column===E)[0],M=a.filter(F=>F.column===E+1)[0],j=a.filter(F=>F.column===E-1)[0]):I=a[E];I&&(R||(M=qq(I,`.${d.slideClass}, swiper-slide`)[0],d.loop&&!M&&(M=a[0]),j=zq(I,`.${d.slideClass}, swiper-slide`)[0],d.loop&&!j===0&&(j=a[a.length-1]))),a.forEach(F=>{iw(F,F===I,d.slideActiveClass),iw(F,F===M,d.slideNextClass),iw(F,F===j,d.slidePrevClass)}),l.emitSlidesClasses()}const kg=(l,a)=>{if(!l||l.destroyed||!l.params)return;const d=()=>l.isElement?"swiper-slide":`.${l.params.slideClass}`,h=a.closest(d());if(h){let E=h.querySelector(`.${l.params.lazyPreloaderClass}`);!E&&l.isElement&&(h.shadowRoot?E=h.shadowRoot.querySelector(`.${l.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{h.shadowRoot&&(E=h.shadowRoot.querySelector(`.${l.params.lazyPreloaderClass}`),E&&E.remove())})),E&&E.remove()}},rw=(l,a)=>{if(!l.slides[a])return;const d=l.slides[a].querySelector('[loading="lazy"]');d&&d.removeAttribute("loading")},bw=l=>{if(!l||l.destroyed||!l.params)return;let a=l.params.lazyPreloadPrevNext;const d=l.slides.length;if(!d||!a||a<0)return;a=Math.min(a,d);const h=l.params.slidesPerView==="auto"?l.slidesPerViewDynamic():Math.ceil(l.params.slidesPerView),E=l.activeIndex;if(l.params.grid&&l.params.grid.rows>1){const R=E,N=[R-a];N.push(...Array.from({length:a}).map((I,j)=>R+h+j)),l.slides.forEach((I,j)=>{N.includes(I.column)&&rw(l,j)});return}const T=E+h-1;if(l.params.rewind||l.params.loop)for(let R=E-a;R<=T+a;R+=1){const N=(R%d+d)%d;(N<E||N>T)&&rw(l,N)}else for(let R=Math.max(E-a,0);R<=Math.min(T+a,d-1);R+=1)R!==E&&(R>T||R<E)&&rw(l,R)};function l2(l){const{slidesGrid:a,params:d}=l,h=l.rtlTranslate?l.translate:-l.translate;let E;for(let T=0;T<a.length;T+=1)typeof a[T+1]<"u"?h>=a[T]&&h<a[T+1]-(a[T+1]-a[T])/2?E=T:h>=a[T]&&h<a[T+1]&&(E=T+1):h>=a[T]&&(E=T);return d.normalizeSlideIndex&&(E<0||typeof E>"u")&&(E=0),E}function d2(l){const a=this,d=a.rtlTranslate?a.translate:-a.translate,{snapGrid:h,params:E,activeIndex:T,realIndex:R,snapIndex:N}=a;let I=l,j;const M=Z=>{let X=Z-a.virtual.slidesBefore;return X<0&&(X=a.virtual.slides.length+X),X>=a.virtual.slides.length&&(X-=a.virtual.slides.length),X};if(typeof I>"u"&&(I=l2(a)),h.indexOf(d)>=0)j=h.indexOf(d);else{const Z=Math.min(E.slidesPerGroupSkip,I);j=Z+Math.floor((I-Z)/E.slidesPerGroup)}if(j>=h.length&&(j=h.length-1),I===T&&!a.params.loop){j!==N&&(a.snapIndex=j,a.emit("snapIndexChange"));return}if(I===T&&a.params.loop&&a.virtual&&a.params.virtual.enabled){a.realIndex=M(I);return}const F=a.grid&&E.grid&&E.grid.rows>1;let Y;if(a.virtual&&E.virtual.enabled&&E.loop)Y=M(I);else if(F){const Z=a.slides.filter(q=>q.column===I)[0];let X=parseInt(Z.getAttribute("data-swiper-slide-index"),10);Number.isNaN(X)&&(X=Math.max(a.slides.indexOf(Z),0)),Y=Math.floor(X/E.grid.rows)}else if(a.slides[I]){const Z=a.slides[I].getAttribute("data-swiper-slide-index");Z?Y=parseInt(Z,10):Y=I}else Y=I;Object.assign(a,{previousSnapIndex:N,snapIndex:j,previousRealIndex:R,realIndex:Y,previousIndex:T,activeIndex:I}),a.initialized&&bw(a),a.emit("activeIndexChange"),a.emit("snapIndexChange"),(a.initialized||a.params.runCallbacksOnInit)&&(R!==Y&&a.emit("realIndexChange"),a.emit("slideChange"))}function u2(l,a){const d=this,h=d.params;let E=l.closest(`.${h.slideClass}, swiper-slide`);!E&&d.isElement&&a&&a.length>1&&a.includes(l)&&[...a.slice(a.indexOf(l)+1,a.length)].forEach(N=>{!E&&N.matches&&N.matches(`.${h.slideClass}, swiper-slide`)&&(E=N)});let T=!1,R;if(E){for(let N=0;N<d.slides.length;N+=1)if(d.slides[N]===E){T=!0,R=N;break}}if(E&&T)d.clickedSlide=E,d.virtual&&d.params.virtual.enabled?d.clickedIndex=parseInt(E.getAttribute("data-swiper-slide-index"),10):d.clickedIndex=R;else{d.clickedSlide=void 0,d.clickedIndex=void 0;return}h.slideToClickedSlide&&d.clickedIndex!==void 0&&d.clickedIndex!==d.activeIndex&&d.slideToClickedSlide()}var h2={updateSize:n2,updateSlides:i2,updateAutoHeight:r2,updateSlidesOffset:s2,updateSlidesProgress:o2,updateProgress:a2,updateSlidesClasses:c2,updateActiveIndex:d2,updateClickedSlide:u2};function p2(l){l===void 0&&(l=this.isHorizontal()?"x":"y");const a=this,{params:d,rtlTranslate:h,translate:E,wrapperEl:T}=a;if(d.virtualTranslate)return h?-E:E;if(d.cssMode)return E;let R=Wq(T,l);return R+=a.cssOverflowAdjustment(),h&&(R=-R),R||0}function f2(l,a){const d=this,{rtlTranslate:h,params:E,wrapperEl:T,progress:R}=d;let N=0,I=0;const j=0;d.isHorizontal()?N=h?-l:l:I=l,E.roundLengths&&(N=Math.floor(N),I=Math.floor(I)),d.previousTranslate=d.translate,d.translate=d.isHorizontal()?N:I,E.cssMode?T[d.isHorizontal()?"scrollLeft":"scrollTop"]=d.isHorizontal()?-N:-I:E.virtualTranslate||(d.isHorizontal()?N-=d.cssOverflowAdjustment():I-=d.cssOverflowAdjustment(),T.style.transform=`translate3d(${N}px, ${I}px, ${j}px)`);let M;const F=d.maxTranslate()-d.minTranslate();F===0?M=0:M=(l-d.minTranslate())/F,M!==R&&d.updateProgress(l),d.emit("setTranslate",d.translate,a)}function m2(){return-this.snapGrid[0]}function _2(){return-this.snapGrid[this.snapGrid.length-1]}function E2(l,a,d,h,E){l===void 0&&(l=0),a===void 0&&(a=this.params.speed),d===void 0&&(d=!0),h===void 0&&(h=!0);const T=this,{params:R,wrapperEl:N}=T;if(T.animating&&R.preventInteractionOnTransition)return!1;const I=T.minTranslate(),j=T.maxTranslate();let M;if(h&&l>I?M=I:h&&l<j?M=j:M=l,T.updateProgress(M),R.cssMode){const F=T.isHorizontal();if(a===0)N[F?"scrollLeft":"scrollTop"]=-M;else{if(!T.support.smoothScroll)return sV({swiper:T,targetPosition:-M,side:F?"left":"top"}),!0;N.scrollTo({[F?"left":"top"]:-M,behavior:"smooth"})}return!0}return a===0?(T.setTransition(0),T.setTranslate(M),d&&(T.emit("beforeTransitionStart",a,E),T.emit("transitionEnd"))):(T.setTransition(a),T.setTranslate(M),d&&(T.emit("beforeTransitionStart",a,E),T.emit("transitionStart")),T.animating||(T.animating=!0,T.onTranslateToWrapperTransitionEnd||(T.onTranslateToWrapperTransitionEnd=function(Y){!T||T.destroyed||Y.target===this&&(T.wrapperEl.removeEventListener("transitionend",T.onTranslateToWrapperTransitionEnd),T.onTranslateToWrapperTransitionEnd=null,delete T.onTranslateToWrapperTransitionEnd,T.animating=!1,d&&T.emit("transitionEnd"))}),T.wrapperEl.addEventListener("transitionend",T.onTranslateToWrapperTransitionEnd))),!0}var g2={getTranslate:p2,setTranslate:f2,minTranslate:m2,maxTranslate:_2,translateTo:E2};function S2(l,a){const d=this;d.params.cssMode||(d.wrapperEl.style.transitionDuration=`${l}ms`,d.wrapperEl.style.transitionDelay=l===0?"0ms":""),d.emit("setTransition",l,a)}function lV(l){let{swiper:a,runCallbacks:d,direction:h,step:E}=l;const{activeIndex:T,previousIndex:R}=a;let N=h;if(N||(T>R?N="next":T<R?N="prev":N="reset"),a.emit(`transition${E}`),d&&T!==R){if(N==="reset"){a.emit(`slideResetTransition${E}`);return}a.emit(`slideChangeTransition${E}`),N==="next"?a.emit(`slideNextTransition${E}`):a.emit(`slidePrevTransition${E}`)}}function T2(l,a){l===void 0&&(l=!0);const d=this,{params:h}=d;h.cssMode||(h.autoHeight&&d.updateAutoHeight(),lV({swiper:d,runCallbacks:l,direction:a,step:"Start"}))}function v2(l,a){l===void 0&&(l=!0);const d=this,{params:h}=d;d.animating=!1,!h.cssMode&&(d.setTransition(0),lV({swiper:d,runCallbacks:l,direction:a,step:"End"}))}var y2={setTransition:S2,transitionStart:T2,transitionEnd:v2};function R2(l,a,d,h,E){l===void 0&&(l=0),d===void 0&&(d=!0),typeof l=="string"&&(l=parseInt(l,10));const T=this;let R=l;R<0&&(R=0);const{params:N,snapGrid:I,slidesGrid:j,previousIndex:M,activeIndex:F,rtlTranslate:Y,wrapperEl:Z,enabled:X}=T;if(!X&&!h&&!E||T.destroyed||T.animating&&N.preventInteractionOnTransition)return!1;typeof a>"u"&&(a=T.params.speed);const q=Math.min(T.params.slidesPerGroupSkip,R);let re=q+Math.floor((R-q)/T.params.slidesPerGroup);re>=I.length&&(re=I.length-1);const se=-I[re];if(N.normalizeSlideIndex)for(let Ee=0;Ee<j.length;Ee+=1){const Ue=-Math.floor(se*100),Oe=Math.floor(j[Ee]*100),xe=Math.floor(j[Ee+1]*100);typeof j[Ee+1]<"u"?Ue>=Oe&&Ue<xe-(xe-Oe)/2?R=Ee:Ue>=Oe&&Ue<xe&&(R=Ee+1):Ue>=Oe&&(R=Ee)}if(T.initialized&&R!==F&&(!T.allowSlideNext&&(Y?se>T.translate&&se>T.minTranslate():se<T.translate&&se<T.minTranslate())||!T.allowSlidePrev&&se>T.translate&&se>T.maxTranslate()&&(F||0)!==R))return!1;R!==(M||0)&&d&&T.emit("beforeSlideChangeStart"),T.updateProgress(se);let $;R>F?$="next":R<F?$="prev":$="reset";const Q=T.virtual&&T.params.virtual.enabled;if(!(Q&&E)&&(Y&&-se===T.translate||!Y&&se===T.translate))return T.updateActiveIndex(R),N.autoHeight&&T.updateAutoHeight(),T.updateSlidesClasses(),N.effect!=="slide"&&T.setTranslate(se),$!=="reset"&&(T.transitionStart(d,$),T.transitionEnd(d,$)),!1;if(N.cssMode){const Ee=T.isHorizontal(),Ue=Y?se:-se;if(a===0)Q&&(T.wrapperEl.style.scrollSnapType="none",T._immediateVirtual=!0),Q&&!T._cssModeVirtualInitialSet&&T.params.initialSlide>0?(T._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{Z[Ee?"scrollLeft":"scrollTop"]=Ue})):Z[Ee?"scrollLeft":"scrollTop"]=Ue,Q&&requestAnimationFrame(()=>{T.wrapperEl.style.scrollSnapType="",T._immediateVirtual=!1});else{if(!T.support.smoothScroll)return sV({swiper:T,targetPosition:Ue,side:Ee?"left":"top"}),!0;Z.scrollTo({[Ee?"left":"top"]:Ue,behavior:"smooth"})}return!0}return T.setTransition(a),T.setTranslate(se),T.updateActiveIndex(R),T.updateSlidesClasses(),T.emit("beforeTransitionStart",a,h),T.transitionStart(d,$),a===0?T.transitionEnd(d,$):T.animating||(T.animating=!0,T.onSlideToWrapperTransitionEnd||(T.onSlideToWrapperTransitionEnd=function(Ue){!T||T.destroyed||Ue.target===this&&(T.wrapperEl.removeEventListener("transitionend",T.onSlideToWrapperTransitionEnd),T.onSlideToWrapperTransitionEnd=null,delete T.onSlideToWrapperTransitionEnd,T.transitionEnd(d,$))}),T.wrapperEl.addEventListener("transitionend",T.onSlideToWrapperTransitionEnd)),!0}function b2(l,a,d,h){l===void 0&&(l=0),d===void 0&&(d=!0),typeof l=="string"&&(l=parseInt(l,10));const E=this;if(E.destroyed)return;typeof a>"u"&&(a=E.params.speed);const T=E.grid&&E.params.grid&&E.params.grid.rows>1;let R=l;if(E.params.loop)if(E.virtual&&E.params.virtual.enabled)R=R+E.virtual.slidesBefore;else{let N;if(T){const Y=R*E.params.grid.rows;N=E.slides.filter(Z=>Z.getAttribute("data-swiper-slide-index")*1===Y)[0].column}else N=E.getSlideIndexByData(R);const I=T?Math.ceil(E.slides.length/E.params.grid.rows):E.slides.length,{centeredSlides:j}=E.params;let M=E.params.slidesPerView;M==="auto"?M=E.slidesPerViewDynamic():(M=Math.ceil(parseFloat(E.params.slidesPerView,10)),j&&M%2===0&&(M=M+1));let F=I-N<M;if(j&&(F=F||N<Math.ceil(M/2)),h&&j&&E.params.slidesPerView!=="auto"&&!T&&(F=!1),F){const Y=j?N<E.activeIndex?"prev":"next":N-E.activeIndex-1<E.params.slidesPerView?"next":"prev";E.loopFix({direction:Y,slideTo:!0,activeSlideIndex:Y==="next"?N+1:N-I+1,slideRealIndex:Y==="next"?E.realIndex:void 0})}if(T){const Y=R*E.params.grid.rows;R=E.slides.filter(Z=>Z.getAttribute("data-swiper-slide-index")*1===Y)[0].column}else R=E.getSlideIndexByData(R)}return requestAnimationFrame(()=>{E.slideTo(R,a,d,h)}),E}function C2(l,a,d){a===void 0&&(a=!0);const h=this,{enabled:E,params:T,animating:R}=h;if(!E||h.destroyed)return h;typeof l>"u"&&(l=h.params.speed);let N=T.slidesPerGroup;T.slidesPerView==="auto"&&T.slidesPerGroup===1&&T.slidesPerGroupAuto&&(N=Math.max(h.slidesPerViewDynamic("current",!0),1));const I=h.activeIndex<T.slidesPerGroupSkip?1:N,j=h.virtual&&T.virtual.enabled;if(T.loop){if(R&&!j&&T.loopPreventsSliding)return!1;if(h.loopFix({direction:"next"}),h._clientLeft=h.wrapperEl.clientLeft,h.activeIndex===h.slides.length-1&&T.cssMode)return requestAnimationFrame(()=>{h.slideTo(h.activeIndex+I,l,a,d)}),!0}return T.rewind&&h.isEnd?h.slideTo(0,l,a,d):h.slideTo(h.activeIndex+I,l,a,d)}function w2(l,a,d){a===void 0&&(a=!0);const h=this,{params:E,snapGrid:T,slidesGrid:R,rtlTranslate:N,enabled:I,animating:j}=h;if(!I||h.destroyed)return h;typeof l>"u"&&(l=h.params.speed);const M=h.virtual&&E.virtual.enabled;if(E.loop){if(j&&!M&&E.loopPreventsSliding)return!1;h.loopFix({direction:"prev"}),h._clientLeft=h.wrapperEl.clientLeft}const F=N?h.translate:-h.translate;function Y(se){return se<0?-Math.floor(Math.abs(se)):Math.floor(se)}const Z=Y(F),X=T.map(se=>Y(se));let q=T[X.indexOf(Z)-1];if(typeof q>"u"&&E.cssMode){let se;T.forEach(($,Q)=>{Z>=$&&(se=Q)}),typeof se<"u"&&(q=T[se>0?se-1:se])}let re=0;if(typeof q<"u"&&(re=R.indexOf(q),re<0&&(re=h.activeIndex-1),E.slidesPerView==="auto"&&E.slidesPerGroup===1&&E.slidesPerGroupAuto&&(re=re-h.slidesPerViewDynamic("previous",!0)+1,re=Math.max(re,0))),E.rewind&&h.isBeginning){const se=h.params.virtual&&h.params.virtual.enabled&&h.virtual?h.virtual.slides.length-1:h.slides.length-1;return h.slideTo(se,l,a,d)}else if(E.loop&&h.activeIndex===0&&E.cssMode)return requestAnimationFrame(()=>{h.slideTo(re,l,a,d)}),!0;return h.slideTo(re,l,a,d)}function A2(l,a,d){a===void 0&&(a=!0);const h=this;if(!h.destroyed)return typeof l>"u"&&(l=h.params.speed),h.slideTo(h.activeIndex,l,a,d)}function I2(l,a,d,h){a===void 0&&(a=!0),h===void 0&&(h=.5);const E=this;if(E.destroyed)return;typeof l>"u"&&(l=E.params.speed);let T=E.activeIndex;const R=Math.min(E.params.slidesPerGroupSkip,T),N=R+Math.floor((T-R)/E.params.slidesPerGroup),I=E.rtlTranslate?E.translate:-E.translate;if(I>=E.snapGrid[N]){const j=E.snapGrid[N],M=E.snapGrid[N+1];I-j>(M-j)*h&&(T+=E.params.slidesPerGroup)}else{const j=E.snapGrid[N-1],M=E.snapGrid[N];I-j<=(M-j)*h&&(T-=E.params.slidesPerGroup)}return T=Math.max(T,0),T=Math.min(T,E.slidesGrid.length-1),E.slideTo(T,l,a,d)}function O2(){const l=this;if(l.destroyed)return;const{params:a,slidesEl:d}=l,h=a.slidesPerView==="auto"?l.slidesPerViewDynamic():a.slidesPerView;let E=l.clickedIndex,T;const R=l.isElement?"swiper-slide":`.${a.slideClass}`;if(a.loop){if(l.animating)return;T=parseInt(l.clickedSlide.getAttribute("data-swiper-slide-index"),10),a.centeredSlides?E<l.loopedSlides-h/2||E>l.slides.length-l.loopedSlides+h/2?(l.loopFix(),E=l.getSlideIndex(Bo(d,`${R}[data-swiper-slide-index="${T}"]`)[0]),yw(()=>{l.slideTo(E)})):l.slideTo(E):E>l.slides.length-h?(l.loopFix(),E=l.getSlideIndex(Bo(d,`${R}[data-swiper-slide-index="${T}"]`)[0]),yw(()=>{l.slideTo(E)})):l.slideTo(E)}else l.slideTo(E)}var N2={slideTo:R2,slideToLoop:b2,slideNext:C2,slidePrev:w2,slideReset:A2,slideToClosest:I2,slideToClickedSlide:O2};function D2(l){const a=this,{params:d,slidesEl:h}=a;if(!d.loop||a.virtual&&a.params.virtual.enabled)return;const E=()=>{Bo(h,`.${d.slideClass}, swiper-slide`).forEach((F,Y)=>{F.setAttribute("data-swiper-slide-index",Y)})},T=a.grid&&d.grid&&d.grid.rows>1,R=d.slidesPerGroup*(T?d.grid.rows:1),N=a.slides.length%R!==0,I=T&&a.slides.length%d.grid.rows!==0,j=M=>{for(let F=0;F<M;F+=1){const Y=a.isElement?$g("swiper-slide",[d.slideBlankClass]):$g("div",[d.slideClass,d.slideBlankClass]);a.slidesEl.append(Y)}};if(N){if(d.loopAddBlankSlides){const M=R-a.slides.length%R;j(M),a.recalcSlides(),a.updateSlides()}else qg("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");E()}else if(I){if(d.loopAddBlankSlides){const M=d.grid.rows-a.slides.length%d.grid.rows;j(M),a.recalcSlides(),a.updateSlides()}else qg("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");E()}else E();a.loopFix({slideRealIndex:l,direction:d.centeredSlides?void 0:"next"})}function P2(l){let{slideRealIndex:a,slideTo:d=!0,direction:h,setTranslate:E,activeSlideIndex:T,byController:R,byMousewheel:N}=l===void 0?{}:l;const I=this;if(!I.params.loop)return;I.emit("beforeLoopFix");const{slides:j,allowSlidePrev:M,allowSlideNext:F,slidesEl:Y,params:Z}=I,{centeredSlides:X}=Z;if(I.allowSlidePrev=!0,I.allowSlideNext=!0,I.virtual&&Z.virtual.enabled){d&&(!Z.centeredSlides&&I.snapIndex===0?I.slideTo(I.virtual.slides.length,0,!1,!0):Z.centeredSlides&&I.snapIndex<Z.slidesPerView?I.slideTo(I.virtual.slides.length+I.snapIndex,0,!1,!0):I.snapIndex===I.snapGrid.length-1&&I.slideTo(I.virtual.slidesBefore,0,!1,!0)),I.allowSlidePrev=M,I.allowSlideNext=F,I.emit("loopFix");return}let q=Z.slidesPerView;q==="auto"?q=I.slidesPerViewDynamic():(q=Math.ceil(parseFloat(Z.slidesPerView,10)),X&&q%2===0&&(q=q+1));const re=Z.slidesPerGroupAuto?q:Z.slidesPerGroup;let se=re;se%re!==0&&(se+=re-se%re),se+=Z.loopAdditionalSlides,I.loopedSlides=se;const $=I.grid&&Z.grid&&Z.grid.rows>1;j.length<q+se?qg("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):$&&Z.grid.fill==="row"&&qg("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const Q=[],me=[];let Ee=I.activeIndex;typeof T>"u"?T=I.getSlideIndex(j.filter(We=>We.classList.contains(Z.slideActiveClass))[0]):Ee=T;const Ue=h==="next"||!h,Oe=h==="prev"||!h;let xe=0,ye=0;const Le=$?Math.ceil(j.length/Z.grid.rows):j.length,Qe=($?j[T].column:T)+(X&&typeof E>"u"?-q/2+.5:0);if(Qe<se){xe=Math.max(se-Qe,re);for(let We=0;We<se-Qe;We+=1){const ht=We-Math.floor(We/Le)*Le;if($){const Ze=Le-ht-1;for(let wn=j.length-1;wn>=0;wn-=1)j[wn].column===Ze&&Q.push(wn)}else Q.push(Le-ht-1)}}else if(Qe+q>Le-se){ye=Math.max(Qe-(Le-se*2),re);for(let We=0;We<ye;We+=1){const ht=We-Math.floor(We/Le)*Le;$?j.forEach((Ze,wn)=>{Ze.column===ht&&me.push(wn)}):me.push(ht)}}if(I.__preventObserver__=!0,requestAnimationFrame(()=>{I.__preventObserver__=!1}),Oe&&Q.forEach(We=>{j[We].swiperLoopMoveDOM=!0,Y.prepend(j[We]),j[We].swiperLoopMoveDOM=!1}),Ue&&me.forEach(We=>{j[We].swiperLoopMoveDOM=!0,Y.append(j[We]),j[We].swiperLoopMoveDOM=!1}),I.recalcSlides(),Z.slidesPerView==="auto"?I.updateSlides():$&&(Q.length>0&&Oe||me.length>0&&Ue)&&I.slides.forEach((We,ht)=>{I.grid.updateSlide(ht,We,I.slides)}),Z.watchSlidesProgress&&I.updateSlidesOffset(),d){if(Q.length>0&&Oe){if(typeof a>"u"){const We=I.slidesGrid[Ee],Ze=I.slidesGrid[Ee+xe]-We;N?I.setTranslate(I.translate-Ze):(I.slideTo(Ee+Math.ceil(xe),0,!1,!0),E&&(I.touchEventsData.startTranslate=I.touchEventsData.startTranslate-Ze,I.touchEventsData.currentTranslate=I.touchEventsData.currentTranslate-Ze))}else if(E){const We=$?Q.length/Z.grid.rows:Q.length;I.slideTo(I.activeIndex+We,0,!1,!0),I.touchEventsData.currentTranslate=I.translate}}else if(me.length>0&&Ue)if(typeof a>"u"){const We=I.slidesGrid[Ee],Ze=I.slidesGrid[Ee-ye]-We;N?I.setTranslate(I.translate-Ze):(I.slideTo(Ee-ye,0,!1,!0),E&&(I.touchEventsData.startTranslate=I.touchEventsData.startTranslate-Ze,I.touchEventsData.currentTranslate=I.touchEventsData.currentTranslate-Ze))}else{const We=$?me.length/Z.grid.rows:me.length;I.slideTo(I.activeIndex-We,0,!1,!0)}}if(I.allowSlidePrev=M,I.allowSlideNext=F,I.controller&&I.controller.control&&!R){const We={slideRealIndex:a,direction:h,setTranslate:E,activeSlideIndex:T,byController:!0};Array.isArray(I.controller.control)?I.controller.control.forEach(ht=>{!ht.destroyed&&ht.params.loop&&ht.loopFix({...We,slideTo:ht.params.slidesPerView===Z.slidesPerView?d:!1})}):I.controller.control instanceof I.constructor&&I.controller.control.params.loop&&I.controller.control.loopFix({...We,slideTo:I.controller.control.params.slidesPerView===Z.slidesPerView?d:!1})}I.emit("loopFix")}function L2(){const l=this,{params:a,slidesEl:d}=l;if(!a.loop||l.virtual&&l.params.virtual.enabled)return;l.recalcSlides();const h=[];l.slides.forEach(E=>{const T=typeof E.swiperSlideIndex>"u"?E.getAttribute("data-swiper-slide-index")*1:E.swiperSlideIndex;h[T]=E}),l.slides.forEach(E=>{E.removeAttribute("data-swiper-slide-index")}),h.forEach(E=>{d.append(E)}),l.recalcSlides(),l.slideTo(l.realIndex,0)}var k2={loopCreate:D2,loopFix:P2,loopDestroy:L2};function x2(l){const a=this;if(!a.params.simulateTouch||a.params.watchOverflow&&a.isLocked||a.params.cssMode)return;const d=a.params.touchEventsTarget==="container"?a.el:a.wrapperEl;a.isElement&&(a.__preventObserver__=!0),d.style.cursor="move",d.style.cursor=l?"grabbing":"grab",a.isElement&&requestAnimationFrame(()=>{a.__preventObserver__=!1})}function M2(){const l=this;l.params.watchOverflow&&l.isLocked||l.params.cssMode||(l.isElement&&(l.__preventObserver__=!0),l[l.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",l.isElement&&requestAnimationFrame(()=>{l.__preventObserver__=!1}))}var U2={setGrabCursor:x2,unsetGrabCursor:M2};function j2(l,a){a===void 0&&(a=this);function d(h){if(!h||h===wa()||h===ts())return null;h.assignedSlot&&(h=h.assignedSlot);const E=h.closest(l);return!E&&!h.getRootNode?null:E||d(h.getRootNode().host)}return d(a)}function YU(l,a,d){const h=ts(),{params:E}=l,T=E.edgeSwipeDetection,R=E.edgeSwipeThreshold;return T&&(d<=R||d>=h.innerWidth-R)?T==="prevent"?(a.preventDefault(),!0):!1:!0}function V2(l){const a=this,d=wa();let h=l;h.originalEvent&&(h=h.originalEvent);const E=a.touchEventsData;if(h.type==="pointerdown"){if(E.pointerId!==null&&E.pointerId!==h.pointerId)return;E.pointerId=h.pointerId}else h.type==="touchstart"&&h.targetTouches.length===1&&(E.touchId=h.targetTouches[0].identifier);if(h.type==="touchstart"){YU(a,h,h.targetTouches[0].pageX);return}const{params:T,touches:R,enabled:N}=a;if(!N||!T.simulateTouch&&h.pointerType==="mouse"||a.animating&&T.preventInteractionOnTransition)return;!a.animating&&T.cssMode&&T.loop&&a.loopFix();let I=h.target;if(T.touchEventsTarget==="wrapper"&&!Yq(I,a.wrapperEl)||"which"in h&&h.which===3||"button"in h&&h.button>0||E.isTouched&&E.isMoved)return;const j=!!T.noSwipingClass&&T.noSwipingClass!=="",M=h.composedPath?h.composedPath():h.path;j&&h.target&&h.target.shadowRoot&&M&&(I=M[0]);const F=T.noSwipingSelector?T.noSwipingSelector:`.${T.noSwipingClass}`,Y=!!(h.target&&h.target.shadowRoot);if(T.noSwiping&&(Y?j2(F,I):I.closest(F))){a.allowClick=!0;return}if(T.swipeHandler&&!I.closest(T.swipeHandler))return;R.currentX=h.pageX,R.currentY=h.pageY;const Z=R.currentX,X=R.currentY;if(!YU(a,h,Z))return;Object.assign(E,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),R.startX=Z,R.startY=X,E.touchStartTime=zg(),a.allowClick=!0,a.updateSize(),a.swipeDirection=void 0,T.threshold>0&&(E.allowThresholdMove=!1);let q=!0;I.matches(E.focusableElements)&&(q=!1,I.nodeName==="SELECT"&&(E.isTouched=!1)),d.activeElement&&d.activeElement.matches(E.focusableElements)&&d.activeElement!==I&&(h.pointerType==="mouse"||h.pointerType!=="mouse"&&!I.matches(E.focusableElements))&&d.activeElement.blur();const re=q&&a.allowTouchMove&&T.touchStartPreventDefault;(T.touchStartForcePreventDefault||re)&&!I.isContentEditable&&h.preventDefault(),T.freeMode&&T.freeMode.enabled&&a.freeMode&&a.animating&&!T.cssMode&&a.freeMode.onTouchStart(),a.emit("touchStart",h)}function F2(l){const a=wa(),d=this,h=d.touchEventsData,{params:E,touches:T,rtlTranslate:R,enabled:N}=d;if(!N||!E.simulateTouch&&l.pointerType==="mouse")return;let I=l;if(I.originalEvent&&(I=I.originalEvent),I.type==="pointermove"&&(h.touchId!==null||I.pointerId!==h.pointerId))return;let j;if(I.type==="touchmove"){if(j=[...I.changedTouches].filter(Ue=>Ue.identifier===h.touchId)[0],!j||j.identifier!==h.touchId)return}else j=I;if(!h.isTouched){h.startMoving&&h.isScrolling&&d.emit("touchMoveOpposite",I);return}const M=j.pageX,F=j.pageY;if(I.preventedByNestedSwiper){T.startX=M,T.startY=F;return}if(!d.allowTouchMove){I.target.matches(h.focusableElements)||(d.allowClick=!1),h.isTouched&&(Object.assign(T,{startX:M,startY:F,currentX:M,currentY:F}),h.touchStartTime=zg());return}if(E.touchReleaseOnEdges&&!E.loop){if(d.isVertical()){if(F<T.startY&&d.translate<=d.maxTranslate()||F>T.startY&&d.translate>=d.minTranslate()){h.isTouched=!1,h.isMoved=!1;return}}else if(M<T.startX&&d.translate<=d.maxTranslate()||M>T.startX&&d.translate>=d.minTranslate())return}if(a.activeElement&&a.activeElement.matches(h.focusableElements)&&a.activeElement!==I.target&&I.pointerType!=="mouse"&&a.activeElement.blur(),a.activeElement&&I.target===a.activeElement&&I.target.matches(h.focusableElements)){h.isMoved=!0,d.allowClick=!1;return}h.allowTouchCallbacks&&d.emit("touchMove",I),T.previousX=T.currentX,T.previousY=T.currentY,T.currentX=M,T.currentY=F;const Y=T.currentX-T.startX,Z=T.currentY-T.startY;if(d.params.threshold&&Math.sqrt(Y**2+Z**2)<d.params.threshold)return;if(typeof h.isScrolling>"u"){let Ue;d.isHorizontal()&&T.currentY===T.startY||d.isVertical()&&T.currentX===T.startX?h.isScrolling=!1:Y*Y+Z*Z>=25&&(Ue=Math.atan2(Math.abs(Z),Math.abs(Y))*180/Math.PI,h.isScrolling=d.isHorizontal()?Ue>E.touchAngle:90-Ue>E.touchAngle)}if(h.isScrolling&&d.emit("touchMoveOpposite",I),typeof h.startMoving>"u"&&(T.currentX!==T.startX||T.currentY!==T.startY)&&(h.startMoving=!0),h.isScrolling||I.type==="touchmove"&&h.preventTouchMoveFromPointerMove){h.isTouched=!1;return}if(!h.startMoving)return;d.allowClick=!1,!E.cssMode&&I.cancelable&&I.preventDefault(),E.touchMoveStopPropagation&&!E.nested&&I.stopPropagation();let X=d.isHorizontal()?Y:Z,q=d.isHorizontal()?T.currentX-T.previousX:T.currentY-T.previousY;E.oneWayMovement&&(X=Math.abs(X)*(R?1:-1),q=Math.abs(q)*(R?1:-1)),T.diff=X,X*=E.touchRatio,R&&(X=-X,q=-q);const re=d.touchesDirection;d.swipeDirection=X>0?"prev":"next",d.touchesDirection=q>0?"prev":"next";const se=d.params.loop&&!E.cssMode,$=d.touchesDirection==="next"&&d.allowSlideNext||d.touchesDirection==="prev"&&d.allowSlidePrev;if(!h.isMoved){if(se&&$&&d.loopFix({direction:d.swipeDirection}),h.startTranslate=d.getTranslate(),d.setTransition(0),d.animating){const Ue=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});d.wrapperEl.dispatchEvent(Ue)}h.allowMomentumBounce=!1,E.grabCursor&&(d.allowSlideNext===!0||d.allowSlidePrev===!0)&&d.setGrabCursor(!0),d.emit("sliderFirstMove",I)}let Q;if(new Date().getTime(),h.isMoved&&h.allowThresholdMove&&re!==d.touchesDirection&&se&&$&&Math.abs(X)>=1){Object.assign(T,{startX:M,startY:F,currentX:M,currentY:F,startTranslate:h.currentTranslate}),h.loopSwapReset=!0,h.startTranslate=h.currentTranslate;return}d.emit("sliderMove",I),h.isMoved=!0,h.currentTranslate=X+h.startTranslate;let me=!0,Ee=E.resistanceRatio;if(E.touchReleaseOnEdges&&(Ee=0),X>0?(se&&$&&!Q&&h.allowThresholdMove&&h.currentTranslate>(E.centeredSlides?d.minTranslate()-d.slidesSizesGrid[d.activeIndex+1]-(E.slidesPerView!=="auto"&&d.slides.length-E.slidesPerView>=2?d.slidesSizesGrid[d.activeIndex+1]+d.params.spaceBetween:0)-d.params.spaceBetween:d.minTranslate())&&d.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),h.currentTranslate>d.minTranslate()&&(me=!1,E.resistance&&(h.currentTranslate=d.minTranslate()-1+(-d.minTranslate()+h.startTranslate+X)**Ee))):X<0&&(se&&$&&!Q&&h.allowThresholdMove&&h.currentTranslate<(E.centeredSlides?d.maxTranslate()+d.slidesSizesGrid[d.slidesSizesGrid.length-1]+d.params.spaceBetween+(E.slidesPerView!=="auto"&&d.slides.length-E.slidesPerView>=2?d.slidesSizesGrid[d.slidesSizesGrid.length-1]+d.params.spaceBetween:0):d.maxTranslate())&&d.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:d.slides.length-(E.slidesPerView==="auto"?d.slidesPerViewDynamic():Math.ceil(parseFloat(E.slidesPerView,10)))}),h.currentTranslate<d.maxTranslate()&&(me=!1,E.resistance&&(h.currentTranslate=d.maxTranslate()+1-(d.maxTranslate()-h.startTranslate-X)**Ee))),me&&(I.preventedByNestedSwiper=!0),!d.allowSlideNext&&d.swipeDirection==="next"&&h.currentTranslate<h.startTranslate&&(h.currentTranslate=h.startTranslate),!d.allowSlidePrev&&d.swipeDirection==="prev"&&h.currentTranslate>h.startTranslate&&(h.currentTranslate=h.startTranslate),!d.allowSlidePrev&&!d.allowSlideNext&&(h.currentTranslate=h.startTranslate),E.threshold>0)if(Math.abs(X)>E.threshold||h.allowThresholdMove){if(!h.allowThresholdMove){h.allowThresholdMove=!0,T.startX=T.currentX,T.startY=T.currentY,h.currentTranslate=h.startTranslate,T.diff=d.isHorizontal()?T.currentX-T.startX:T.currentY-T.startY;return}}else{h.currentTranslate=h.startTranslate;return}!E.followFinger||E.cssMode||((E.freeMode&&E.freeMode.enabled&&d.freeMode||E.watchSlidesProgress)&&(d.updateActiveIndex(),d.updateSlidesClasses()),E.freeMode&&E.freeMode.enabled&&d.freeMode&&d.freeMode.onTouchMove(),d.updateProgress(h.currentTranslate),d.setTranslate(h.currentTranslate))}function B2(l){const a=this,d=a.touchEventsData;let h=l;h.originalEvent&&(h=h.originalEvent);let E;if(h.type==="touchend"||h.type==="touchcancel"){if(E=[...h.changedTouches].filter(Ee=>Ee.identifier===d.touchId)[0],!E||E.identifier!==d.touchId)return}else{if(d.touchId!==null||h.pointerId!==d.pointerId)return;E=h}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(h.type)&&!(["pointercancel","contextmenu"].includes(h.type)&&(a.browser.isSafari||a.browser.isWebView)))return;d.pointerId=null,d.touchId=null;const{params:R,touches:N,rtlTranslate:I,slidesGrid:j,enabled:M}=a;if(!M||!R.simulateTouch&&h.pointerType==="mouse")return;if(d.allowTouchCallbacks&&a.emit("touchEnd",h),d.allowTouchCallbacks=!1,!d.isTouched){d.isMoved&&R.grabCursor&&a.setGrabCursor(!1),d.isMoved=!1,d.startMoving=!1;return}R.grabCursor&&d.isMoved&&d.isTouched&&(a.allowSlideNext===!0||a.allowSlidePrev===!0)&&a.setGrabCursor(!1);const F=zg(),Y=F-d.touchStartTime;if(a.allowClick){const Ee=h.path||h.composedPath&&h.composedPath();a.updateClickedSlide(Ee&&Ee[0]||h.target,Ee),a.emit("tap click",h),Y<300&&F-d.lastClickTime<300&&a.emit("doubleTap doubleClick",h)}if(d.lastClickTime=zg(),yw(()=>{a.destroyed||(a.allowClick=!0)}),!d.isTouched||!d.isMoved||!a.swipeDirection||N.diff===0&&!d.loopSwapReset||d.currentTranslate===d.startTranslate&&!d.loopSwapReset){d.isTouched=!1,d.isMoved=!1,d.startMoving=!1;return}d.isTouched=!1,d.isMoved=!1,d.startMoving=!1;let Z;if(R.followFinger?Z=I?a.translate:-a.translate:Z=-d.currentTranslate,R.cssMode)return;if(R.freeMode&&R.freeMode.enabled){a.freeMode.onTouchEnd({currentPos:Z});return}const X=Z>=-a.maxTranslate()&&!a.params.loop;let q=0,re=a.slidesSizesGrid[0];for(let Ee=0;Ee<j.length;Ee+=Ee<R.slidesPerGroupSkip?1:R.slidesPerGroup){const Ue=Ee<R.slidesPerGroupSkip-1?1:R.slidesPerGroup;typeof j[Ee+Ue]<"u"?(X||Z>=j[Ee]&&Z<j[Ee+Ue])&&(q=Ee,re=j[Ee+Ue]-j[Ee]):(X||Z>=j[Ee])&&(q=Ee,re=j[j.length-1]-j[j.length-2])}let se=null,$=null;R.rewind&&(a.isBeginning?$=R.virtual&&R.virtual.enabled&&a.virtual?a.virtual.slides.length-1:a.slides.length-1:a.isEnd&&(se=0));const Q=(Z-j[q])/re,me=q<R.slidesPerGroupSkip-1?1:R.slidesPerGroup;if(Y>R.longSwipesMs){if(!R.longSwipes){a.slideTo(a.activeIndex);return}a.swipeDirection==="next"&&(Q>=R.longSwipesRatio?a.slideTo(R.rewind&&a.isEnd?se:q+me):a.slideTo(q)),a.swipeDirection==="prev"&&(Q>1-R.longSwipesRatio?a.slideTo(q+me):$!==null&&Q<0&&Math.abs(Q)>R.longSwipesRatio?a.slideTo($):a.slideTo(q))}else{if(!R.shortSwipes){a.slideTo(a.activeIndex);return}a.navigation&&(h.target===a.navigation.nextEl||h.target===a.navigation.prevEl)?h.target===a.navigation.nextEl?a.slideTo(q+me):a.slideTo(q):(a.swipeDirection==="next"&&a.slideTo(se!==null?se:q+me),a.swipeDirection==="prev"&&a.slideTo($!==null?$:q))}}function zU(){const l=this,{params:a,el:d}=l;if(d&&d.offsetWidth===0)return;a.breakpoints&&l.setBreakpoint();const{allowSlideNext:h,allowSlidePrev:E,snapGrid:T}=l,R=l.virtual&&l.params.virtual.enabled;l.allowSlideNext=!0,l.allowSlidePrev=!0,l.updateSize(),l.updateSlides(),l.updateSlidesClasses();const N=R&&a.loop;(a.slidesPerView==="auto"||a.slidesPerView>1)&&l.isEnd&&!l.isBeginning&&!l.params.centeredSlides&&!N?l.slideTo(l.slides.length-1,0,!1,!0):l.params.loop&&!R?l.slideToLoop(l.realIndex,0,!1,!0):l.slideTo(l.activeIndex,0,!1,!0),l.autoplay&&l.autoplay.running&&l.autoplay.paused&&(clearTimeout(l.autoplay.resizeTimeout),l.autoplay.resizeTimeout=setTimeout(()=>{l.autoplay&&l.autoplay.running&&l.autoplay.paused&&l.autoplay.resume()},500)),l.allowSlidePrev=E,l.allowSlideNext=h,l.params.watchOverflow&&T!==l.snapGrid&&l.checkOverflow()}function G2(l){const a=this;a.enabled&&(a.allowClick||(a.params.preventClicks&&l.preventDefault(),a.params.preventClicksPropagation&&a.animating&&(l.stopPropagation(),l.stopImmediatePropagation())))}function H2(){const l=this,{wrapperEl:a,rtlTranslate:d,enabled:h}=l;if(!h)return;l.previousTranslate=l.translate,l.isHorizontal()?l.translate=-a.scrollLeft:l.translate=-a.scrollTop,l.translate===0&&(l.translate=0),l.updateActiveIndex(),l.updateSlidesClasses();let E;const T=l.maxTranslate()-l.minTranslate();T===0?E=0:E=(l.translate-l.minTranslate())/T,E!==l.progress&&l.updateProgress(d?-l.translate:l.translate),l.emit("setTranslate",l.translate,!1)}function W2(l){const a=this;kg(a,l.target),!(a.params.cssMode||a.params.slidesPerView!=="auto"&&!a.params.autoHeight)&&a.update()}function K2(){const l=this;l.documentTouchHandlerProceeded||(l.documentTouchHandlerProceeded=!0,l.params.touchReleaseOnEdges&&(l.el.style.touchAction="auto"))}const dV=(l,a)=>{const d=wa(),{params:h,el:E,wrapperEl:T,device:R}=l,N=!!h.nested,I=a==="on"?"addEventListener":"removeEventListener",j=a;!E||typeof E=="string"||(d[I]("touchstart",l.onDocumentTouchStart,{passive:!1,capture:N}),E[I]("touchstart",l.onTouchStart,{passive:!1}),E[I]("pointerdown",l.onTouchStart,{passive:!1}),d[I]("touchmove",l.onTouchMove,{passive:!1,capture:N}),d[I]("pointermove",l.onTouchMove,{passive:!1,capture:N}),d[I]("touchend",l.onTouchEnd,{passive:!0}),d[I]("pointerup",l.onTouchEnd,{passive:!0}),d[I]("pointercancel",l.onTouchEnd,{passive:!0}),d[I]("touchcancel",l.onTouchEnd,{passive:!0}),d[I]("pointerout",l.onTouchEnd,{passive:!0}),d[I]("pointerleave",l.onTouchEnd,{passive:!0}),d[I]("contextmenu",l.onTouchEnd,{passive:!0}),(h.preventClicks||h.preventClicksPropagation)&&E[I]("click",l.onClick,!0),h.cssMode&&T[I]("scroll",l.onScroll),h.updateOnWindowResize?l[j](R.ios||R.android?"resize orientationchange observerUpdate":"resize observerUpdate",zU,!0):l[j]("observerUpdate",zU,!0),E[I]("load",l.onLoad,{capture:!0}))};function Y2(){const l=this,{params:a}=l;l.onTouchStart=V2.bind(l),l.onTouchMove=F2.bind(l),l.onTouchEnd=B2.bind(l),l.onDocumentTouchStart=K2.bind(l),a.cssMode&&(l.onScroll=H2.bind(l)),l.onClick=G2.bind(l),l.onLoad=W2.bind(l),dV(l,"on")}function z2(){dV(this,"off")}var q2={attachEvents:Y2,detachEvents:z2};const qU=(l,a)=>l.grid&&a.grid&&a.grid.rows>1;function $2(){const l=this,{realIndex:a,initialized:d,params:h,el:E}=l,T=h.breakpoints;if(!T||T&&Object.keys(T).length===0)return;const R=l.getBreakpoint(T,l.params.breakpointsBase,l.el);if(!R||l.currentBreakpoint===R)return;const I=(R in T?T[R]:void 0)||l.originalParams,j=qU(l,h),M=qU(l,I),F=l.params.grabCursor,Y=I.grabCursor,Z=h.enabled;j&&!M?(E.classList.remove(`${h.containerModifierClass}grid`,`${h.containerModifierClass}grid-column`),l.emitContainerClasses()):!j&&M&&(E.classList.add(`${h.containerModifierClass}grid`),(I.grid.fill&&I.grid.fill==="column"||!I.grid.fill&&h.grid.fill==="column")&&E.classList.add(`${h.containerModifierClass}grid-column`),l.emitContainerClasses()),F&&!Y?l.unsetGrabCursor():!F&&Y&&l.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(Q=>{if(typeof I[Q]>"u")return;const me=h[Q]&&h[Q].enabled,Ee=I[Q]&&I[Q].enabled;me&&!Ee&&l[Q].disable(),!me&&Ee&&l[Q].enable()});const X=I.direction&&I.direction!==h.direction,q=h.loop&&(I.slidesPerView!==h.slidesPerView||X),re=h.loop;X&&d&&l.changeDirection(),Zr(l.params,I);const se=l.params.enabled,$=l.params.loop;Object.assign(l,{allowTouchMove:l.params.allowTouchMove,allowSlideNext:l.params.allowSlideNext,allowSlidePrev:l.params.allowSlidePrev}),Z&&!se?l.disable():!Z&&se&&l.enable(),l.currentBreakpoint=R,l.emit("_beforeBreakpoint",I),d&&(q?(l.loopDestroy(),l.loopCreate(a),l.updateSlides()):!re&&$?(l.loopCreate(a),l.updateSlides()):re&&!$&&l.loopDestroy()),l.emit("breakpoint",I)}function J2(l,a,d){if(a===void 0&&(a="window"),!l||a==="container"&&!d)return;let h=!1;const E=ts(),T=a==="window"?E.innerHeight:d.clientHeight,R=Object.keys(l).map(N=>{if(typeof N=="string"&&N.indexOf("@")===0){const I=parseFloat(N.substr(1));return{value:T*I,point:N}}return{value:N,point:N}});R.sort((N,I)=>parseInt(N.value,10)-parseInt(I.value,10));for(let N=0;N<R.length;N+=1){const{point:I,value:j}=R[N];a==="window"?E.matchMedia(`(min-width: ${j}px)`).matches&&(h=I):j<=d.clientWidth&&(h=I)}return h||"max"}var X2={setBreakpoint:$2,getBreakpoint:J2};function Q2(l,a){const d=[];return l.forEach(h=>{typeof h=="object"?Object.keys(h).forEach(E=>{h[E]&&d.push(a+E)}):typeof h=="string"&&d.push(a+h)}),d}function Z2(){const l=this,{classNames:a,params:d,rtl:h,el:E,device:T}=l,R=Q2(["initialized",d.direction,{"free-mode":l.params.freeMode&&d.freeMode.enabled},{autoheight:d.autoHeight},{rtl:h},{grid:d.grid&&d.grid.rows>1},{"grid-column":d.grid&&d.grid.rows>1&&d.grid.fill==="column"},{android:T.android},{ios:T.ios},{"css-mode":d.cssMode},{centered:d.cssMode&&d.centeredSlides},{"watch-progress":d.watchSlidesProgress}],d.containerModifierClass);a.push(...R),E.classList.add(...a),l.emitContainerClasses()}function e$(){const l=this,{el:a,classNames:d}=l;!a||typeof a=="string"||(a.classList.remove(...d),l.emitContainerClasses())}var t$={addClasses:Z2,removeClasses:e$};function n$(){const l=this,{isLocked:a,params:d}=l,{slidesOffsetBefore:h}=d;if(h){const E=l.slides.length-1,T=l.slidesGrid[E]+l.slidesSizesGrid[E]+h*2;l.isLocked=l.size>T}else l.isLocked=l.snapGrid.length===1;d.allowSlideNext===!0&&(l.allowSlideNext=!l.isLocked),d.allowSlidePrev===!0&&(l.allowSlidePrev=!l.isLocked),a&&a!==l.isLocked&&(l.isEnd=!1),a!==l.isLocked&&l.emit(l.isLocked?"lock":"unlock")}var i$={checkOverflow:n$},Cw={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function r$(l,a){return function(h){h===void 0&&(h={});const E=Object.keys(h)[0],T=h[E];if(typeof T!="object"||T===null){Zr(a,h);return}if(l[E]===!0&&(l[E]={enabled:!0}),E==="navigation"&&l[E]&&l[E].enabled&&!l[E].prevEl&&!l[E].nextEl&&(l[E].auto=!0),["pagination","scrollbar"].indexOf(E)>=0&&l[E]&&l[E].enabled&&!l[E].el&&(l[E].auto=!0),!(E in l&&"enabled"in T)){Zr(a,h);return}typeof l[E]=="object"&&!("enabled"in l[E])&&(l[E].enabled=!0),l[E]||(l[E]={enabled:!1}),Zr(a,h)}}const sw={eventsEmitter:t2,update:h2,translate:g2,transition:y2,slide:N2,loop:k2,grabCursor:U2,events:q2,breakpoints:X2,checkOverflow:i$,classes:t$},ow={};let Ww=class Ca{constructor(){let a,d;for(var h=arguments.length,E=new Array(h),T=0;T<h;T++)E[T]=arguments[T];E.length===1&&E[0].constructor&&Object.prototype.toString.call(E[0]).slice(8,-1)==="Object"?d=E[0]:[a,d]=E,d||(d={}),d=Zr({},d),a&&!d.el&&(d.el=a);const R=wa();if(d.el&&typeof d.el=="string"&&R.querySelectorAll(d.el).length>1){const M=[];return R.querySelectorAll(d.el).forEach(F=>{const Y=Zr({},d,{el:F});M.push(new Ca(Y))}),M}const N=this;N.__swiper__=!0,N.support=aV(),N.device=cV({userAgent:d.userAgent}),N.browser=Qq(),N.eventsListeners={},N.eventsAnyListeners=[],N.modules=[...N.__modules__],d.modules&&Array.isArray(d.modules)&&N.modules.push(...d.modules);const I={};N.modules.forEach(M=>{M({params:d,swiper:N,extendParams:r$(d,I),on:N.on.bind(N),once:N.once.bind(N),off:N.off.bind(N),emit:N.emit.bind(N)})});const j=Zr({},Cw,I);return N.params=Zr({},j,ow,d),N.originalParams=Zr({},N.params),N.passedParams=Zr({},d),N.params&&N.params.on&&Object.keys(N.params.on).forEach(M=>{N.on(M,N.params.on[M])}),N.params&&N.params.onAny&&N.onAny(N.params.onAny),Object.assign(N,{enabled:N.params.enabled,el:a,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return N.params.direction==="horizontal"},isVertical(){return N.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:N.params.allowSlideNext,allowSlidePrev:N.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:N.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:N.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),N.emit("_swiper"),N.params.init&&N.init(),N}getDirectionLabel(a){return this.isHorizontal()?a:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[a]}getSlideIndex(a){const{slidesEl:d,params:h}=this,E=Bo(d,`.${h.slideClass}, swiper-slide`),T=Jg(E[0]);return Jg(a)-T}getSlideIndexByData(a){return this.getSlideIndex(this.slides.filter(d=>d.getAttribute("data-swiper-slide-index")*1===a)[0])}recalcSlides(){const a=this,{slidesEl:d,params:h}=a;a.slides=Bo(d,`.${h.slideClass}, swiper-slide`)}enable(){const a=this;a.enabled||(a.enabled=!0,a.params.grabCursor&&a.setGrabCursor(),a.emit("enable"))}disable(){const a=this;a.enabled&&(a.enabled=!1,a.params.grabCursor&&a.unsetGrabCursor(),a.emit("disable"))}setProgress(a,d){const h=this;a=Math.min(Math.max(a,0),1);const E=h.minTranslate(),R=(h.maxTranslate()-E)*a+E;h.translateTo(R,typeof d>"u"?0:d),h.updateActiveIndex(),h.updateSlidesClasses()}emitContainerClasses(){const a=this;if(!a.params._emitClasses||!a.el)return;const d=a.el.className.split(" ").filter(h=>h.indexOf("swiper")===0||h.indexOf(a.params.containerModifierClass)===0);a.emit("_containerClasses",d.join(" "))}getSlideClasses(a){const d=this;return d.destroyed?"":a.className.split(" ").filter(h=>h.indexOf("swiper-slide")===0||h.indexOf(d.params.slideClass)===0).join(" ")}emitSlidesClasses(){const a=this;if(!a.params._emitClasses||!a.el)return;const d=[];a.slides.forEach(h=>{const E=a.getSlideClasses(h);d.push({slideEl:h,classNames:E}),a.emit("_slideClass",h,E)}),a.emit("_slideClasses",d)}slidesPerViewDynamic(a,d){a===void 0&&(a="current"),d===void 0&&(d=!1);const h=this,{params:E,slides:T,slidesGrid:R,slidesSizesGrid:N,size:I,activeIndex:j}=h;let M=1;if(typeof E.slidesPerView=="number")return E.slidesPerView;if(E.centeredSlides){let F=T[j]?Math.ceil(T[j].swiperSlideSize):0,Y;for(let Z=j+1;Z<T.length;Z+=1)T[Z]&&!Y&&(F+=Math.ceil(T[Z].swiperSlideSize),M+=1,F>I&&(Y=!0));for(let Z=j-1;Z>=0;Z-=1)T[Z]&&!Y&&(F+=T[Z].swiperSlideSize,M+=1,F>I&&(Y=!0))}else if(a==="current")for(let F=j+1;F<T.length;F+=1)(d?R[F]+N[F]-R[j]<I:R[F]-R[j]<I)&&(M+=1);else for(let F=j-1;F>=0;F-=1)R[j]-R[F]<I&&(M+=1);return M}update(){const a=this;if(!a||a.destroyed)return;const{snapGrid:d,params:h}=a;h.breakpoints&&a.setBreakpoint(),[...a.el.querySelectorAll('[loading="lazy"]')].forEach(R=>{R.complete&&kg(a,R)}),a.updateSize(),a.updateSlides(),a.updateProgress(),a.updateSlidesClasses();function E(){const R=a.rtlTranslate?a.translate*-1:a.translate,N=Math.min(Math.max(R,a.maxTranslate()),a.minTranslate());a.setTranslate(N),a.updateActiveIndex(),a.updateSlidesClasses()}let T;if(h.freeMode&&h.freeMode.enabled&&!h.cssMode)E(),h.autoHeight&&a.updateAutoHeight();else{if((h.slidesPerView==="auto"||h.slidesPerView>1)&&a.isEnd&&!h.centeredSlides){const R=a.virtual&&h.virtual.enabled?a.virtual.slides:a.slides;T=a.slideTo(R.length-1,0,!1,!0)}else T=a.slideTo(a.activeIndex,0,!1,!0);T||E()}h.watchOverflow&&d!==a.snapGrid&&a.checkOverflow(),a.emit("update")}changeDirection(a,d){d===void 0&&(d=!0);const h=this,E=h.params.direction;return a||(a=E==="horizontal"?"vertical":"horizontal"),a===E||a!=="horizontal"&&a!=="vertical"||(h.el.classList.remove(`${h.params.containerModifierClass}${E}`),h.el.classList.add(`${h.params.containerModifierClass}${a}`),h.emitContainerClasses(),h.params.direction=a,h.slides.forEach(T=>{a==="vertical"?T.style.width="":T.style.height=""}),h.emit("changeDirection"),d&&h.update()),h}changeLanguageDirection(a){const d=this;d.rtl&&a==="rtl"||!d.rtl&&a==="ltr"||(d.rtl=a==="rtl",d.rtlTranslate=d.params.direction==="horizontal"&&d.rtl,d.rtl?(d.el.classList.add(`${d.params.containerModifierClass}rtl`),d.el.dir="rtl"):(d.el.classList.remove(`${d.params.containerModifierClass}rtl`),d.el.dir="ltr"),d.update())}mount(a){const d=this;if(d.mounted)return!0;let h=a||d.params.el;if(typeof h=="string"&&(h=document.querySelector(h)),!h)return!1;h.swiper=d,h.parentNode&&h.parentNode.host&&h.parentNode.host.nodeName===d.params.swiperElementNodeName.toUpperCase()&&(d.isElement=!0);const E=()=>`.${(d.params.wrapperClass||"").trim().split(" ").join(".")}`;let R=h&&h.shadowRoot&&h.shadowRoot.querySelector?h.shadowRoot.querySelector(E()):Bo(h,E())[0];return!R&&d.params.createElements&&(R=$g("div",d.params.wrapperClass),h.append(R),Bo(h,`.${d.params.slideClass}`).forEach(N=>{R.append(N)})),Object.assign(d,{el:h,wrapperEl:R,slidesEl:d.isElement&&!h.parentNode.host.slideSlots?h.parentNode.host:R,hostEl:d.isElement?h.parentNode.host:h,mounted:!0,rtl:h.dir.toLowerCase()==="rtl"||Pc(h,"direction")==="rtl",rtlTranslate:d.params.direction==="horizontal"&&(h.dir.toLowerCase()==="rtl"||Pc(h,"direction")==="rtl"),wrongRTL:Pc(R,"display")==="-webkit-box"}),!0}init(a){const d=this;if(d.initialized||d.mount(a)===!1)return d;d.emit("beforeInit"),d.params.breakpoints&&d.setBreakpoint(),d.addClasses(),d.updateSize(),d.updateSlides(),d.params.watchOverflow&&d.checkOverflow(),d.params.grabCursor&&d.enabled&&d.setGrabCursor(),d.params.loop&&d.virtual&&d.params.virtual.enabled?d.slideTo(d.params.initialSlide+d.virtual.slidesBefore,0,d.params.runCallbacksOnInit,!1,!0):d.slideTo(d.params.initialSlide,0,d.params.runCallbacksOnInit,!1,!0),d.params.loop&&d.loopCreate(),d.attachEvents();const E=[...d.el.querySelectorAll('[loading="lazy"]')];return d.isElement&&E.push(...d.hostEl.querySelectorAll('[loading="lazy"]')),E.forEach(T=>{T.complete?kg(d,T):T.addEventListener("load",R=>{kg(d,R.target)})}),bw(d),d.initialized=!0,bw(d),d.emit("init"),d.emit("afterInit"),d}destroy(a,d){a===void 0&&(a=!0),d===void 0&&(d=!0);const h=this,{params:E,el:T,wrapperEl:R,slides:N}=h;return typeof h.params>"u"||h.destroyed||(h.emit("beforeDestroy"),h.initialized=!1,h.detachEvents(),E.loop&&h.loopDestroy(),d&&(h.removeClasses(),T&&typeof T!="string"&&T.removeAttribute("style"),R&&R.removeAttribute("style"),N&&N.length&&N.forEach(I=>{I.classList.remove(E.slideVisibleClass,E.slideFullyVisibleClass,E.slideActiveClass,E.slideNextClass,E.slidePrevClass),I.removeAttribute("style"),I.removeAttribute("data-swiper-slide-index")})),h.emit("destroy"),Object.keys(h.eventsListeners).forEach(I=>{h.off(I)}),a!==!1&&(h.el&&typeof h.el!="string"&&(h.el.swiper=null),Gq(h)),h.destroyed=!0),null}static extendDefaults(a){Zr(ow,a)}static get extendedDefaults(){return ow}static get defaults(){return Cw}static installModule(a){Ca.prototype.__modules__||(Ca.prototype.__modules__=[]);const d=Ca.prototype.__modules__;typeof a=="function"&&d.indexOf(a)<0&&d.push(a)}static use(a){return Array.isArray(a)?(a.forEach(d=>Ca.installModule(d)),Ca):(Ca.installModule(a),Ca)}};Object.keys(sw).forEach(l=>{Object.keys(sw[l]).forEach(a=>{Ww.prototype[a]=sw[l][a]})});Ww.use([Zq,e2]);const uV=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function xl(l){return typeof l=="object"&&l!==null&&l.constructor&&Object.prototype.toString.call(l).slice(8,-1)==="Object"&&!l.__swiper__}function Pu(l,a){const d=["__proto__","constructor","prototype"];Object.keys(a).filter(h=>d.indexOf(h)<0).forEach(h=>{typeof l[h]>"u"?l[h]=a[h]:xl(a[h])&&xl(l[h])&&Object.keys(a[h]).length>0?a[h].__swiper__?l[h]=a[h]:Pu(l[h],a[h]):l[h]=a[h]})}function hV(l){return l===void 0&&(l={}),l.navigation&&typeof l.navigation.nextEl>"u"&&typeof l.navigation.prevEl>"u"}function pV(l){return l===void 0&&(l={}),l.pagination&&typeof l.pagination.el>"u"}function fV(l){return l===void 0&&(l={}),l.scrollbar&&typeof l.scrollbar.el>"u"}function mV(l){l===void 0&&(l="");const a=l.split(" ").map(h=>h.trim()).filter(h=>!!h),d=[];return a.forEach(h=>{d.indexOf(h)<0&&d.push(h)}),d.join(" ")}function s$(l){return l===void 0&&(l=""),l?l.includes("swiper-wrapper")?l:`swiper-wrapper ${l}`:"swiper-wrapper"}function o$(l){let{swiper:a,slides:d,passedParams:h,changedParams:E,nextEl:T,prevEl:R,scrollbarEl:N,paginationEl:I}=l;const j=E.filter(ye=>ye!=="children"&&ye!=="direction"&&ye!=="wrapperClass"),{params:M,pagination:F,navigation:Y,scrollbar:Z,virtual:X,thumbs:q}=a;let re,se,$,Q,me,Ee,Ue,Oe;E.includes("thumbs")&&h.thumbs&&h.thumbs.swiper&&!h.thumbs.swiper.destroyed&&M.thumbs&&(!M.thumbs.swiper||M.thumbs.swiper.destroyed)&&(re=!0),E.includes("controller")&&h.controller&&h.controller.control&&M.controller&&!M.controller.control&&(se=!0),E.includes("pagination")&&h.pagination&&(h.pagination.el||I)&&(M.pagination||M.pagination===!1)&&F&&!F.el&&($=!0),E.includes("scrollbar")&&h.scrollbar&&(h.scrollbar.el||N)&&(M.scrollbar||M.scrollbar===!1)&&Z&&!Z.el&&(Q=!0),E.includes("navigation")&&h.navigation&&(h.navigation.prevEl||R)&&(h.navigation.nextEl||T)&&(M.navigation||M.navigation===!1)&&Y&&!Y.prevEl&&!Y.nextEl&&(me=!0);const xe=ye=>{a[ye]&&(a[ye].destroy(),ye==="navigation"?(a.isElement&&(a[ye].prevEl.remove(),a[ye].nextEl.remove()),M[ye].prevEl=void 0,M[ye].nextEl=void 0,a[ye].prevEl=void 0,a[ye].nextEl=void 0):(a.isElement&&a[ye].el.remove(),M[ye].el=void 0,a[ye].el=void 0))};E.includes("loop")&&a.isElement&&(M.loop&&!h.loop?Ee=!0:!M.loop&&h.loop?Ue=!0:Oe=!0),j.forEach(ye=>{if(xl(M[ye])&&xl(h[ye]))Object.assign(M[ye],h[ye]),(ye==="navigation"||ye==="pagination"||ye==="scrollbar")&&"enabled"in h[ye]&&!h[ye].enabled&&xe(ye);else{const Le=h[ye];(Le===!0||Le===!1)&&(ye==="navigation"||ye==="pagination"||ye==="scrollbar")?Le===!1&&xe(ye):M[ye]=h[ye]}}),j.includes("controller")&&!se&&a.controller&&a.controller.control&&M.controller&&M.controller.control&&(a.controller.control=M.controller.control),E.includes("children")&&d&&X&&M.virtual.enabled?(X.slides=d,X.update(!0)):E.includes("virtual")&&X&&M.virtual.enabled&&(d&&(X.slides=d),X.update(!0)),E.includes("children")&&d&&M.loop&&(Oe=!0),re&&q.init()&&q.update(!0),se&&(a.controller.control=M.controller.control),$&&(a.isElement&&(!I||typeof I=="string")&&(I=document.createElement("div"),I.classList.add("swiper-pagination"),I.part.add("pagination"),a.el.appendChild(I)),I&&(M.pagination.el=I),F.init(),F.render(),F.update()),Q&&(a.isElement&&(!N||typeof N=="string")&&(N=document.createElement("div"),N.classList.add("swiper-scrollbar"),N.part.add("scrollbar"),a.el.appendChild(N)),N&&(M.scrollbar.el=N),Z.init(),Z.updateSize(),Z.setTranslate()),me&&(a.isElement&&((!T||typeof T=="string")&&(T=document.createElement("div"),T.classList.add("swiper-button-next"),T.innerHTML=a.hostEl.constructor.nextButtonSvg,T.part.add("button-next"),a.el.appendChild(T)),(!R||typeof R=="string")&&(R=document.createElement("div"),R.classList.add("swiper-button-prev"),R.innerHTML=a.hostEl.constructor.prevButtonSvg,R.part.add("button-prev"),a.el.appendChild(R))),T&&(M.navigation.nextEl=T),R&&(M.navigation.prevEl=R),Y.init(),Y.update()),E.includes("allowSlideNext")&&(a.allowSlideNext=h.allowSlideNext),E.includes("allowSlidePrev")&&(a.allowSlidePrev=h.allowSlidePrev),E.includes("direction")&&a.changeDirection(h.direction,!1),(Ee||Oe)&&a.loopDestroy(),(Ue||Oe)&&a.loopCreate(),a.update()}function a$(l,a){l===void 0&&(l={}),a===void 0&&(a=!0);const d={on:{}},h={},E={};Pu(d,Cw),d._emitClasses=!0,d.init=!1;const T={},R=uV.map(I=>I.replace(/_/,"")),N=Object.assign({},l);return Object.keys(N).forEach(I=>{typeof l[I]>"u"||(R.indexOf(I)>=0?xl(l[I])?(d[I]={},E[I]={},Pu(d[I],l[I]),Pu(E[I],l[I])):(d[I]=l[I],E[I]=l[I]):I.search(/on[A-Z]/)===0&&typeof l[I]=="function"?a?h[`${I[2].toLowerCase()}${I.substr(3)}`]=l[I]:d.on[`${I[2].toLowerCase()}${I.substr(3)}`]=l[I]:T[I]=l[I])}),["navigation","pagination","scrollbar"].forEach(I=>{d[I]===!0&&(d[I]={}),d[I]===!1&&delete d[I]}),{params:d,passedParams:E,rest:T,events:h}}function c$(l,a){let{el:d,nextEl:h,prevEl:E,paginationEl:T,scrollbarEl:R,swiper:N}=l;hV(a)&&h&&E&&(N.params.navigation.nextEl=h,N.originalParams.navigation.nextEl=h,N.params.navigation.prevEl=E,N.originalParams.navigation.prevEl=E),pV(a)&&T&&(N.params.pagination.el=T,N.originalParams.pagination.el=T),fV(a)&&R&&(N.params.scrollbar.el=R,N.originalParams.scrollbar.el=R),N.init(d)}function l$(l,a,d,h,E){const T=[];if(!a)return T;const R=I=>{T.indexOf(I)<0&&T.push(I)};if(d&&h){const I=h.map(E),j=d.map(E);I.join("")!==j.join("")&&R("children"),h.length!==d.length&&R("children")}return uV.filter(I=>I[0]==="_").map(I=>I.replace(/_/,"")).forEach(I=>{if(I in l&&I in a)if(xl(l[I])&&xl(a[I])){const j=Object.keys(l[I]),M=Object.keys(a[I]);j.length!==M.length?R(I):(j.forEach(F=>{l[I][F]!==a[I][F]&&R(I)}),M.forEach(F=>{l[I][F]!==a[I][F]&&R(I)}))}else l[I]!==a[I]&&R(I)}),T}const d$=l=>{!l||l.destroyed||!l.params.virtual||l.params.virtual&&!l.params.virtual.enabled||(l.updateSlides(),l.updateProgress(),l.updateSlidesClasses(),l.parallax&&l.params.parallax&&l.params.parallax.enabled&&l.parallax.setTranslate())};function Xg(){return Xg=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var d=arguments[a];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h])}return l},Xg.apply(this,arguments)}function _V(l){return l.type&&l.type.displayName&&l.type.displayName.includes("SwiperSlide")}function EV(l){const a=[];return Mn.Children.toArray(l).forEach(d=>{_V(d)?a.push(d):d.props&&d.props.children&&EV(d.props.children).forEach(h=>a.push(h))}),a}function u$(l){const a=[],d={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return Mn.Children.toArray(l).forEach(h=>{if(_V(h))a.push(h);else if(h.props&&h.props.slot&&d[h.props.slot])d[h.props.slot].push(h);else if(h.props&&h.props.children){const E=EV(h.props.children);E.length>0?E.forEach(T=>a.push(T)):d["container-end"].push(h)}else d["container-end"].push(h)}),{slides:a,slots:d}}function h$(l,a,d){if(!d)return null;const h=M=>{let F=M;return M<0?F=a.length+M:F>=a.length&&(F=F-a.length),F},E=l.isHorizontal()?{[l.rtlTranslate?"right":"left"]:`${d.offset}px`}:{top:`${d.offset}px`},{from:T,to:R}=d,N=l.params.loop?-a.length:0,I=l.params.loop?a.length*2:a.length,j=[];for(let M=N;M<I;M+=1)M>=T&&M<=R&&j.push(a[h(M)]);return j.map((M,F)=>Mn.cloneElement(M,{swiper:l,style:E,key:M.props.virtualIndex||M.key||`slide-${F}`}))}function gf(l,a){return typeof window>"u"?ie.useEffect(l,a):ie.useLayoutEffect(l,a)}const $U=ie.createContext(null),p$=ie.createContext(null),gV=ie.forwardRef(function(l,a){let{className:d,tag:h="div",wrapperTag:E="div",children:T,onSwiper:R,...N}=l===void 0?{}:l,I=!1;const[j,M]=ie.useState("swiper"),[F,Y]=ie.useState(null),[Z,X]=ie.useState(!1),q=ie.useRef(!1),re=ie.useRef(null),se=ie.useRef(null),$=ie.useRef(null),Q=ie.useRef(null),me=ie.useRef(null),Ee=ie.useRef(null),Ue=ie.useRef(null),Oe=ie.useRef(null),{params:xe,passedParams:ye,rest:Le,events:Ge}=a$(N),{slides:Qe,slots:We}=u$(T),ht=()=>{X(!Z)};Object.assign(xe.on,{_containerClasses(qt,ft){M(ft)}});const Ze=()=>{Object.assign(xe.on,Ge),I=!0;const qt={...xe};if(delete qt.wrapperClass,se.current=new Ww(qt),se.current.virtual&&se.current.params.virtual.enabled){se.current.virtual.slides=Qe;const ft={cache:!1,slides:Qe,renderExternal:Y,renderExternalUpdate:!1};Pu(se.current.params.virtual,ft),Pu(se.current.originalParams.virtual,ft)}};re.current||Ze(),se.current&&se.current.on("_beforeBreakpoint",ht);const wn=()=>{I||!Ge||!se.current||Object.keys(Ge).forEach(qt=>{se.current.on(qt,Ge[qt])})},li=()=>{!Ge||!se.current||Object.keys(Ge).forEach(qt=>{se.current.off(qt,Ge[qt])})};ie.useEffect(()=>()=>{se.current&&se.current.off("_beforeBreakpoint",ht)}),ie.useEffect(()=>{!q.current&&se.current&&(se.current.emitSlidesClasses(),q.current=!0)}),gf(()=>{if(a&&(a.current=re.current),!!re.current)return se.current.destroyed&&Ze(),c$({el:re.current,nextEl:me.current,prevEl:Ee.current,paginationEl:Ue.current,scrollbarEl:Oe.current,swiper:se.current},xe),R&&!se.current.destroyed&&R(se.current),()=>{se.current&&!se.current.destroyed&&se.current.destroy(!0,!1)}},[]),gf(()=>{wn();const qt=l$(ye,$.current,Qe,Q.current,ft=>ft.key);return $.current=ye,Q.current=Qe,qt.length&&se.current&&!se.current.destroyed&&o$({swiper:se.current,slides:Qe,passedParams:ye,changedParams:qt,nextEl:me.current,prevEl:Ee.current,scrollbarEl:Oe.current,paginationEl:Ue.current}),()=>{li()}}),gf(()=>{d$(se.current)},[F]);function Ht(){return xe.virtual?h$(se.current,Qe,F):Qe.map((qt,ft)=>Mn.cloneElement(qt,{swiper:se.current,swiperSlideIndex:ft}))}return Mn.createElement(h,Xg({ref:re,className:mV(`${j}${d?` ${d}`:""}`)},Le),Mn.createElement(p$.Provider,{value:se.current},We["container-start"],Mn.createElement(E,{className:s$(xe.wrapperClass)},We["wrapper-start"],Ht(),We["wrapper-end"]),hV(xe)&&Mn.createElement(Mn.Fragment,null,Mn.createElement("div",{ref:Ee,className:"swiper-button-prev"}),Mn.createElement("div",{ref:me,className:"swiper-button-next"})),fV(xe)&&Mn.createElement("div",{ref:Oe,className:"swiper-scrollbar"}),pV(xe)&&Mn.createElement("div",{ref:Ue,className:"swiper-pagination"}),We["container-end"]))});gV.displayName="Swiper";const SV=ie.forwardRef(function(l,a){let{tag:d="div",children:h,className:E="",swiper:T,zoom:R,lazy:N,virtualIndex:I,swiperSlideIndex:j,...M}=l===void 0?{}:l;const F=ie.useRef(null),[Y,Z]=ie.useState("swiper-slide"),[X,q]=ie.useState(!1);function re(me,Ee,Ue){Ee===F.current&&Z(Ue)}gf(()=>{if(typeof j<"u"&&(F.current.swiperSlideIndex=j),a&&(a.current=F.current),!(!F.current||!T)){if(T.destroyed){Y!=="swiper-slide"&&Z("swiper-slide");return}return T.on("_slideClass",re),()=>{T&&T.off("_slideClass",re)}}}),gf(()=>{T&&F.current&&!T.destroyed&&Z(T.getSlideClasses(F.current))},[T]);const se={isActive:Y.indexOf("swiper-slide-active")>=0,isVisible:Y.indexOf("swiper-slide-visible")>=0,isPrev:Y.indexOf("swiper-slide-prev")>=0,isNext:Y.indexOf("swiper-slide-next")>=0},$=()=>typeof h=="function"?h(se):h,Q=()=>{q(!0)};return Mn.createElement(d,Xg({ref:F,className:mV(`${Y}${E?` ${E}`:""}`),"data-swiper-slide-index":I,onLoad:Q},M),R&&Mn.createElement($U.Provider,{value:se},Mn.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof R=="number"?R:void 0},$(),N&&!X&&Mn.createElement("div",{className:"swiper-lazy-preloader"}))),!R&&Mn.createElement($U.Provider,{value:se},$(),N&&!X&&Mn.createElement("div",{className:"swiper-lazy-preloader"})))});SV.displayName="SwiperSlide";function TV(l,a,d,h){return l.params.createElements&&Object.keys(h).forEach(E=>{if(!d[E]&&d.auto===!0){let T=Bo(l.el,`.${h[E]}`)[0];T||(T=$g("div",h[E]),T.className=h[E],l.el.append(T)),d[E]=T,a[E]=T}}),d}function f$(l){let{swiper:a,extendParams:d,on:h,emit:E}=l;d({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),a.navigation={nextEl:null,prevEl:null};function T(X){let q;return X&&typeof X=="string"&&a.isElement&&(q=a.el.querySelector(X)||a.hostEl.querySelector(X),q)?q:(X&&(typeof X=="string"&&(q=[...document.querySelectorAll(X)]),a.params.uniqueNavElements&&typeof X=="string"&&q&&q.length>1&&a.el.querySelectorAll(X).length===1?q=a.el.querySelector(X):q&&q.length===1&&(q=q[0])),X&&!q?X:q)}function R(X,q){const re=a.params.navigation;X=xi(X),X.forEach(se=>{se&&(se.classList[q?"add":"remove"](...re.disabledClass.split(" ")),se.tagName==="BUTTON"&&(se.disabled=q),a.params.watchOverflow&&a.enabled&&se.classList[a.isLocked?"add":"remove"](re.lockClass))})}function N(){const{nextEl:X,prevEl:q}=a.navigation;if(a.params.loop){R(q,!1),R(X,!1);return}R(q,a.isBeginning&&!a.params.rewind),R(X,a.isEnd&&!a.params.rewind)}function I(X){X.preventDefault(),!(a.isBeginning&&!a.params.loop&&!a.params.rewind)&&(a.slidePrev(),E("navigationPrev"))}function j(X){X.preventDefault(),!(a.isEnd&&!a.params.loop&&!a.params.rewind)&&(a.slideNext(),E("navigationNext"))}function M(){const X=a.params.navigation;if(a.params.navigation=TV(a,a.originalParams.navigation,a.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(X.nextEl||X.prevEl))return;let q=T(X.nextEl),re=T(X.prevEl);Object.assign(a.navigation,{nextEl:q,prevEl:re}),q=xi(q),re=xi(re);const se=($,Q)=>{$&&$.addEventListener("click",Q==="next"?j:I),!a.enabled&&$&&$.classList.add(...X.lockClass.split(" "))};q.forEach($=>se($,"next")),re.forEach($=>se($,"prev"))}function F(){let{nextEl:X,prevEl:q}=a.navigation;X=xi(X),q=xi(q);const re=(se,$)=>{se.removeEventListener("click",$==="next"?j:I),se.classList.remove(...a.params.navigation.disabledClass.split(" "))};X.forEach(se=>re(se,"next")),q.forEach(se=>re(se,"prev"))}h("init",()=>{a.params.navigation.enabled===!1?Z():(M(),N())}),h("toEdge fromEdge lock unlock",()=>{N()}),h("destroy",()=>{F()}),h("enable disable",()=>{let{nextEl:X,prevEl:q}=a.navigation;if(X=xi(X),q=xi(q),a.enabled){N();return}[...X,...q].filter(re=>!!re).forEach(re=>re.classList.add(a.params.navigation.lockClass))}),h("click",(X,q)=>{let{nextEl:re,prevEl:se}=a.navigation;re=xi(re),se=xi(se);const $=q.target;let Q=se.includes($)||re.includes($);if(a.isElement&&!Q){const me=q.path||q.composedPath&&q.composedPath();me&&(Q=me.find(Ee=>re.includes(Ee)||se.includes(Ee)))}if(a.params.navigation.hideOnClick&&!Q){if(a.pagination&&a.params.pagination&&a.params.pagination.clickable&&(a.pagination.el===$||a.pagination.el.contains($)))return;let me;re.length?me=re[0].classList.contains(a.params.navigation.hiddenClass):se.length&&(me=se[0].classList.contains(a.params.navigation.hiddenClass)),E(me===!0?"navigationShow":"navigationHide"),[...re,...se].filter(Ee=>!!Ee).forEach(Ee=>Ee.classList.toggle(a.params.navigation.hiddenClass))}});const Y=()=>{a.el.classList.remove(...a.params.navigation.navigationDisabledClass.split(" ")),M(),N()},Z=()=>{a.el.classList.add(...a.params.navigation.navigationDisabledClass.split(" ")),F()};Object.assign(a.navigation,{enable:Y,disable:Z,update:N,init:M,destroy:F})}function hf(l){return l===void 0&&(l=""),`.${l.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function m$(l){let{swiper:a,extendParams:d,on:h,emit:E}=l;const T="swiper-pagination";d({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:$=>$,formatFractionTotal:$=>$,bulletClass:`${T}-bullet`,bulletActiveClass:`${T}-bullet-active`,modifierClass:`${T}-`,currentClass:`${T}-current`,totalClass:`${T}-total`,hiddenClass:`${T}-hidden`,progressbarFillClass:`${T}-progressbar-fill`,progressbarOppositeClass:`${T}-progressbar-opposite`,clickableClass:`${T}-clickable`,lockClass:`${T}-lock`,horizontalClass:`${T}-horizontal`,verticalClass:`${T}-vertical`,paginationDisabledClass:`${T}-disabled`}}),a.pagination={el:null,bullets:[]};let R,N=0;function I(){return!a.params.pagination.el||!a.pagination.el||Array.isArray(a.pagination.el)&&a.pagination.el.length===0}function j($,Q){const{bulletActiveClass:me}=a.params.pagination;$&&($=$[`${Q==="prev"?"previous":"next"}ElementSibling`],$&&($.classList.add(`${me}-${Q}`),$=$[`${Q==="prev"?"previous":"next"}ElementSibling`],$&&$.classList.add(`${me}-${Q}-${Q}`)))}function M($,Q,me){if($=$%me,Q=Q%me,Q===$+1)return"next";if(Q===$-1)return"previous"}function F($){const Q=$.target.closest(hf(a.params.pagination.bulletClass));if(!Q)return;$.preventDefault();const me=Jg(Q)*a.params.slidesPerGroup;if(a.params.loop){if(a.realIndex===me)return;const Ee=M(a.realIndex,me,a.slides.length);Ee==="next"?a.slideNext():Ee==="previous"?a.slidePrev():a.slideToLoop(me)}else a.slideTo(me)}function Y(){const $=a.rtl,Q=a.params.pagination;if(I())return;let me=a.pagination.el;me=xi(me);let Ee,Ue;const Oe=a.virtual&&a.params.virtual.enabled?a.virtual.slides.length:a.slides.length,xe=a.params.loop?Math.ceil(Oe/a.params.slidesPerGroup):a.snapGrid.length;if(a.params.loop?(Ue=a.previousRealIndex||0,Ee=a.params.slidesPerGroup>1?Math.floor(a.realIndex/a.params.slidesPerGroup):a.realIndex):typeof a.snapIndex<"u"?(Ee=a.snapIndex,Ue=a.previousSnapIndex):(Ue=a.previousIndex||0,Ee=a.activeIndex||0),Q.type==="bullets"&&a.pagination.bullets&&a.pagination.bullets.length>0){const ye=a.pagination.bullets;let Le,Ge,Qe;if(Q.dynamicBullets&&(R=Rw(ye[0],a.isHorizontal()?"width":"height"),me.forEach(We=>{We.style[a.isHorizontal()?"width":"height"]=`${R*(Q.dynamicMainBullets+4)}px`}),Q.dynamicMainBullets>1&&Ue!==void 0&&(N+=Ee-(Ue||0),N>Q.dynamicMainBullets-1?N=Q.dynamicMainBullets-1:N<0&&(N=0)),Le=Math.max(Ee-N,0),Ge=Le+(Math.min(ye.length,Q.dynamicMainBullets)-1),Qe=(Ge+Le)/2),ye.forEach(We=>{const ht=[...["","-next","-next-next","-prev","-prev-prev","-main"].map(Ze=>`${Q.bulletActiveClass}${Ze}`)].map(Ze=>typeof Ze=="string"&&Ze.includes(" ")?Ze.split(" "):Ze).flat();We.classList.remove(...ht)}),me.length>1)ye.forEach(We=>{const ht=Jg(We);ht===Ee?We.classList.add(...Q.bulletActiveClass.split(" ")):a.isElement&&We.setAttribute("part","bullet"),Q.dynamicBullets&&(ht>=Le&&ht<=Ge&&We.classList.add(...`${Q.bulletActiveClass}-main`.split(" ")),ht===Le&&j(We,"prev"),ht===Ge&&j(We,"next"))});else{const We=ye[Ee];if(We&&We.classList.add(...Q.bulletActiveClass.split(" ")),a.isElement&&ye.forEach((ht,Ze)=>{ht.setAttribute("part",Ze===Ee?"bullet-active":"bullet")}),Q.dynamicBullets){const ht=ye[Le],Ze=ye[Ge];for(let wn=Le;wn<=Ge;wn+=1)ye[wn]&&ye[wn].classList.add(...`${Q.bulletActiveClass}-main`.split(" "));j(ht,"prev"),j(Ze,"next")}}if(Q.dynamicBullets){const We=Math.min(ye.length,Q.dynamicMainBullets+4),ht=(R*We-R)/2-Qe*R,Ze=$?"right":"left";ye.forEach(wn=>{wn.style[a.isHorizontal()?Ze:"top"]=`${ht}px`})}}me.forEach((ye,Le)=>{if(Q.type==="fraction"&&(ye.querySelectorAll(hf(Q.currentClass)).forEach(Ge=>{Ge.textContent=Q.formatFractionCurrent(Ee+1)}),ye.querySelectorAll(hf(Q.totalClass)).forEach(Ge=>{Ge.textContent=Q.formatFractionTotal(xe)})),Q.type==="progressbar"){let Ge;Q.progressbarOpposite?Ge=a.isHorizontal()?"vertical":"horizontal":Ge=a.isHorizontal()?"horizontal":"vertical";const Qe=(Ee+1)/xe;let We=1,ht=1;Ge==="horizontal"?We=Qe:ht=Qe,ye.querySelectorAll(hf(Q.progressbarFillClass)).forEach(Ze=>{Ze.style.transform=`translate3d(0,0,0) scaleX(${We}) scaleY(${ht})`,Ze.style.transitionDuration=`${a.params.speed}ms`})}Q.type==="custom"&&Q.renderCustom?(ye.innerHTML=Q.renderCustom(a,Ee+1,xe),Le===0&&E("paginationRender",ye)):(Le===0&&E("paginationRender",ye),E("paginationUpdate",ye)),a.params.watchOverflow&&a.enabled&&ye.classList[a.isLocked?"add":"remove"](Q.lockClass)})}function Z(){const $=a.params.pagination;if(I())return;const Q=a.virtual&&a.params.virtual.enabled?a.virtual.slides.length:a.grid&&a.params.grid.rows>1?a.slides.length/Math.ceil(a.params.grid.rows):a.slides.length;let me=a.pagination.el;me=xi(me);let Ee="";if($.type==="bullets"){let Ue=a.params.loop?Math.ceil(Q/a.params.slidesPerGroup):a.snapGrid.length;a.params.freeMode&&a.params.freeMode.enabled&&Ue>Q&&(Ue=Q);for(let Oe=0;Oe<Ue;Oe+=1)$.renderBullet?Ee+=$.renderBullet.call(a,Oe,$.bulletClass):Ee+=`<${$.bulletElement} ${a.isElement?'part="bullet"':""} class="${$.bulletClass}"></${$.bulletElement}>`}$.type==="fraction"&&($.renderFraction?Ee=$.renderFraction.call(a,$.currentClass,$.totalClass):Ee=`<span class="${$.currentClass}"></span> / <span class="${$.totalClass}"></span>`),$.type==="progressbar"&&($.renderProgressbar?Ee=$.renderProgressbar.call(a,$.progressbarFillClass):Ee=`<span class="${$.progressbarFillClass}"></span>`),a.pagination.bullets=[],me.forEach(Ue=>{$.type!=="custom"&&(Ue.innerHTML=Ee||""),$.type==="bullets"&&a.pagination.bullets.push(...Ue.querySelectorAll(hf($.bulletClass)))}),$.type!=="custom"&&E("paginationRender",me[0])}function X(){a.params.pagination=TV(a,a.originalParams.pagination,a.params.pagination,{el:"swiper-pagination"});const $=a.params.pagination;if(!$.el)return;let Q;typeof $.el=="string"&&a.isElement&&(Q=a.el.querySelector($.el)),!Q&&typeof $.el=="string"&&(Q=[...document.querySelectorAll($.el)]),Q||(Q=$.el),!(!Q||Q.length===0)&&(a.params.uniqueNavElements&&typeof $.el=="string"&&Array.isArray(Q)&&Q.length>1&&(Q=[...a.el.querySelectorAll($.el)],Q.length>1&&(Q=Q.filter(me=>oV(me,".swiper")[0]===a.el)[0])),Array.isArray(Q)&&Q.length===1&&(Q=Q[0]),Object.assign(a.pagination,{el:Q}),Q=xi(Q),Q.forEach(me=>{$.type==="bullets"&&$.clickable&&me.classList.add(...($.clickableClass||"").split(" ")),me.classList.add($.modifierClass+$.type),me.classList.add(a.isHorizontal()?$.horizontalClass:$.verticalClass),$.type==="bullets"&&$.dynamicBullets&&(me.classList.add(`${$.modifierClass}${$.type}-dynamic`),N=0,$.dynamicMainBullets<1&&($.dynamicMainBullets=1)),$.type==="progressbar"&&$.progressbarOpposite&&me.classList.add($.progressbarOppositeClass),$.clickable&&me.addEventListener("click",F),a.enabled||me.classList.add($.lockClass)}))}function q(){const $=a.params.pagination;if(I())return;let Q=a.pagination.el;Q&&(Q=xi(Q),Q.forEach(me=>{me.classList.remove($.hiddenClass),me.classList.remove($.modifierClass+$.type),me.classList.remove(a.isHorizontal()?$.horizontalClass:$.verticalClass),$.clickable&&(me.classList.remove(...($.clickableClass||"").split(" ")),me.removeEventListener("click",F))})),a.pagination.bullets&&a.pagination.bullets.forEach(me=>me.classList.remove(...$.bulletActiveClass.split(" ")))}h("changeDirection",()=>{if(!a.pagination||!a.pagination.el)return;const $=a.params.pagination;let{el:Q}=a.pagination;Q=xi(Q),Q.forEach(me=>{me.classList.remove($.horizontalClass,$.verticalClass),me.classList.add(a.isHorizontal()?$.horizontalClass:$.verticalClass)})}),h("init",()=>{a.params.pagination.enabled===!1?se():(X(),Z(),Y())}),h("activeIndexChange",()=>{typeof a.snapIndex>"u"&&Y()}),h("snapIndexChange",()=>{Y()}),h("snapGridLengthChange",()=>{Z(),Y()}),h("destroy",()=>{q()}),h("enable disable",()=>{let{el:$}=a.pagination;$&&($=xi($),$.forEach(Q=>Q.classList[a.enabled?"remove":"add"](a.params.pagination.lockClass)))}),h("lock unlock",()=>{Y()}),h("click",($,Q)=>{const me=Q.target,Ee=xi(a.pagination.el);if(a.params.pagination.el&&a.params.pagination.hideOnClick&&Ee&&Ee.length>0&&!me.classList.contains(a.params.pagination.bulletClass)){if(a.navigation&&(a.navigation.nextEl&&me===a.navigation.nextEl||a.navigation.prevEl&&me===a.navigation.prevEl))return;const Ue=Ee[0].classList.contains(a.params.pagination.hiddenClass);E(Ue===!0?"paginationShow":"paginationHide"),Ee.forEach(Oe=>Oe.classList.toggle(a.params.pagination.hiddenClass))}});const re=()=>{a.el.classList.remove(a.params.pagination.paginationDisabledClass);let{el:$}=a.pagination;$&&($=xi($),$.forEach(Q=>Q.classList.remove(a.params.pagination.paginationDisabledClass))),X(),Z(),Y()},se=()=>{a.el.classList.add(a.params.pagination.paginationDisabledClass);let{el:$}=a.pagination;$&&($=xi($),$.forEach(Q=>Q.classList.add(a.params.pagination.paginationDisabledClass))),q()};Object.assign(a.pagination,{enable:re,disable:se,render:Z,update:Y,init:X,destroy:q})}function _$(l){let{swiper:a,extendParams:d,on:h,emit:E,params:T}=l;a.autoplay={running:!1,paused:!1,timeLeft:0},d({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let R,N,I=T&&T.autoplay?T.autoplay.delay:3e3,j=T&&T.autoplay?T.autoplay.delay:3e3,M,F=new Date().getTime(),Y,Z,X,q,re,se,$;function Q(Ht){!a||a.destroyed||!a.wrapperEl||Ht.target===a.wrapperEl&&(a.wrapperEl.removeEventListener("transitionend",Q),!($||Ht.detail&&Ht.detail.bySwiperTouchMove)&&Le())}const me=()=>{if(a.destroyed||!a.autoplay.running)return;a.autoplay.paused?Y=!0:Y&&(j=M,Y=!1);const Ht=a.autoplay.paused?M:F+j-new Date().getTime();a.autoplay.timeLeft=Ht,E("autoplayTimeLeft",Ht,Ht/I),N=requestAnimationFrame(()=>{me()})},Ee=()=>{let Ht;return a.virtual&&a.params.virtual.enabled?Ht=a.slides.filter(ft=>ft.classList.contains("swiper-slide-active"))[0]:Ht=a.slides[a.activeIndex],Ht?parseInt(Ht.getAttribute("data-swiper-autoplay"),10):void 0},Ue=Ht=>{if(a.destroyed||!a.autoplay.running)return;cancelAnimationFrame(N),me();let qt=typeof Ht>"u"?a.params.autoplay.delay:Ht;I=a.params.autoplay.delay,j=a.params.autoplay.delay;const ft=Ee();!Number.isNaN(ft)&&ft>0&&typeof Ht>"u"&&(qt=ft,I=ft,j=ft),M=qt;const gr=a.params.speed,so=()=>{!a||a.destroyed||(a.params.autoplay.reverseDirection?!a.isBeginning||a.params.loop||a.params.rewind?(a.slidePrev(gr,!0,!0),E("autoplay")):a.params.autoplay.stopOnLastSlide||(a.slideTo(a.slides.length-1,gr,!0,!0),E("autoplay")):!a.isEnd||a.params.loop||a.params.rewind?(a.slideNext(gr,!0,!0),E("autoplay")):a.params.autoplay.stopOnLastSlide||(a.slideTo(0,gr,!0,!0),E("autoplay")),a.params.cssMode&&(F=new Date().getTime(),requestAnimationFrame(()=>{Ue()})))};return qt>0?(clearTimeout(R),R=setTimeout(()=>{so()},qt)):requestAnimationFrame(()=>{so()}),qt},Oe=()=>{F=new Date().getTime(),a.autoplay.running=!0,Ue(),E("autoplayStart")},xe=()=>{a.autoplay.running=!1,clearTimeout(R),cancelAnimationFrame(N),E("autoplayStop")},ye=(Ht,qt)=>{if(a.destroyed||!a.autoplay.running)return;clearTimeout(R),Ht||(se=!0);const ft=()=>{E("autoplayPause"),a.params.autoplay.waitForTransition?a.wrapperEl.addEventListener("transitionend",Q):Le()};if(a.autoplay.paused=!0,qt){re&&(M=a.params.autoplay.delay),re=!1,ft();return}M=(M||a.params.autoplay.delay)-(new Date().getTime()-F),!(a.isEnd&&M<0&&!a.params.loop)&&(M<0&&(M=0),ft())},Le=()=>{a.isEnd&&M<0&&!a.params.loop||a.destroyed||!a.autoplay.running||(F=new Date().getTime(),se?(se=!1,Ue(M)):Ue(),a.autoplay.paused=!1,E("autoplayResume"))},Ge=()=>{if(a.destroyed||!a.autoplay.running)return;const Ht=wa();Ht.visibilityState==="hidden"&&(se=!0,ye(!0)),Ht.visibilityState==="visible"&&Le()},Qe=Ht=>{Ht.pointerType==="mouse"&&(se=!0,$=!0,!(a.animating||a.autoplay.paused)&&ye(!0))},We=Ht=>{Ht.pointerType==="mouse"&&($=!1,a.autoplay.paused&&Le())},ht=()=>{a.params.autoplay.pauseOnMouseEnter&&(a.el.addEventListener("pointerenter",Qe),a.el.addEventListener("pointerleave",We))},Ze=()=>{a.el&&typeof a.el!="string"&&(a.el.removeEventListener("pointerenter",Qe),a.el.removeEventListener("pointerleave",We))},wn=()=>{wa().addEventListener("visibilitychange",Ge)},li=()=>{wa().removeEventListener("visibilitychange",Ge)};h("init",()=>{a.params.autoplay.enabled&&(ht(),wn(),Oe())}),h("destroy",()=>{Ze(),li(),a.autoplay.running&&xe()}),h("_freeModeStaticRelease",()=>{(X||se)&&Le()}),h("_freeModeNoMomentumRelease",()=>{a.params.autoplay.disableOnInteraction?xe():ye(!0,!0)}),h("beforeTransitionStart",(Ht,qt,ft)=>{a.destroyed||!a.autoplay.running||(ft||!a.params.autoplay.disableOnInteraction?ye(!0,!0):xe())}),h("sliderFirstMove",()=>{if(!(a.destroyed||!a.autoplay.running)){if(a.params.autoplay.disableOnInteraction){xe();return}Z=!0,X=!1,se=!1,q=setTimeout(()=>{se=!0,X=!0,ye(!0)},200)}}),h("touchEnd",()=>{if(!(a.destroyed||!a.autoplay.running||!Z)){if(clearTimeout(q),clearTimeout(R),a.params.autoplay.disableOnInteraction){X=!1,Z=!1;return}X&&a.params.cssMode&&Le(),X=!1,Z=!1}}),h("slideChange",()=>{a.destroyed||!a.autoplay.running||(re=!0)}),Object.assign(a.autoplay,{start:Oe,stop:xe,pause:ye,resume:Le})}function vV(){const[l,a]=ie.useState([]);return ie.useEffect(()=>{ci.get("https://api.japaneseacademy.online/allcomments").then(d=>{a(d.data)}).catch(d=>{console.error("Error fetching the comments:",d)})},[]),f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container Comments",id:"Comments",children:[f.jsx("h2",{className:"text-center fw-bold mt-5 mb-5",children:"من آراء الطلاب الكرام في أكاديمية اللغة اليابانية"}),f.jsx("img",{className:"w-75 m-auto d-flex",src:Vq,alt:""}),f.jsx(gV,{spaceBetween:30,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0,modules:[_$,m$,f$],className:"mySwiper",breakpoints:{0:{slidesPerView:1},768:{slidesPerView:2},1024:{slidesPerView:3}},children:l.map(d=>f.jsx(SV,{className:"comments",children:f.jsxs("li",{children:[f.jsx("p",{className:"main_comment shadow",children:d.comment}),f.jsx("p",{className:"country",children:d.country}),f.jsx("p",{className:"name",children:d.name})]})},d.id))})]})})}function E$(){const[l,a]=ie.useState(""),[d,h]=ie.useState(""),[E,T]=ie.useState(""),[R,N]=ie.useState([]),[I,j]=ie.useState(""),[M,F]=ie.useState(""),[Y,Z]=ie.useState([]),X=io();ie.useEffect(()=>{re(),Q()},[]);const q=Oe=>{Oe.preventDefault(),fetch("https://api.japaneseacademy.online/addcomment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,country:d,comment:E})}).then(xe=>{xe.ok?(alert("تم إضافة التعليق بنجاح"),a(""),h(""),T(""),re()):alert("حدث خطأ أثناء محاولة إضافة التعليق")}).catch(xe=>console.error("Error adding comment:",xe))},re=()=>{fetch("https://api.japaneseacademy.online/allcomments").then(Oe=>Oe.json()).then(Oe=>N(Oe)).catch(Oe=>console.error("Error fetching comments:",Oe))},se=Oe=>{fetch("https://api.japaneseacademy.online/deletecomment",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:Oe})}).then(xe=>{xe.ok?(alert("تم حذف التعليق بنجاح"),re()):alert("حدث خطأ أثناء محاولة حذف التعليق")}).catch(xe=>console.error("Error deleting comment:",xe))},$=()=>{const xe=localStorage.getItem("token");I&&M?fetch("https://api.japaneseacademy.online/updatecredentials",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${xe}`},body:JSON.stringify({newUsername:I,newPassword:M,userId:1})}).then(ye=>{ye.ok?alert("تم تغيير اسم المستخدم وكلمة المرور بنجاح"):alert("حدث خطأ أثناء محاولة تغيير اسم المستخدم وكلمة المرور")}).catch(ye=>console.error("Error updating credentials:",ye)):alert("الرجاء إدخال اسم مستخدم وكلمة مرور جديدة")},Q=()=>{fetch("https://api.japaneseacademy.online/allusers").then(Oe=>Oe.json()).then(Oe=>{Z(Oe)}).catch(Oe=>console.error("Error fetching users:",Oe))},me=Oe=>{fetch("https://api.japaneseacademy.online/deleteusers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:Oe})}).then(xe=>{xe.ok?Z(Y.filter(ye=>ye.id!==Oe)):console.error("Failed to delete user")}).catch(xe=>console.error("Error deleting user:",xe))},Ee=(Oe,xe)=>{fetch("https://api.japaneseacademy.online/update-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:Oe,role:xe})}).then(ye=>{ye.ok?(alert("تم تغيير الدور !"),Z(Y.map(Le=>Le.id===Oe?{...Le,role:xe}:Le))):console.error("Failed to update role")}).catch(ye=>console.error("Error updating role:",ye))},Ue=()=>{localStorage.removeItem("auth"),X("/Login")};return f.jsxs("div",{className:"container",children:[f.jsxs("div",{className:"sidebar",children:[f.jsx("h2",{children:"لوحة التحكم"}),f.jsx("a",{href:"#change-credentials",children:"تغيير اسم المستخدم وكلمة المرور"}),f.jsx("a",{href:"#add-comment",children:"إضافة تعليق"}),f.jsx("a",{href:"#view-comments",children:"عرض التعليقات"}),f.jsx("a",{href:"#view-users",children:"عرض المستخدمين"}),f.jsx("a",{className:"logout",href:"#",onClick:Ue,children:"تسجيل الخروج"})]}),f.jsxs("div",{className:"content",children:[f.jsxs("div",{id:"change-credentials",className:"change-credentials",children:[f.jsx("h3",{children:"تغيير اسم المستخدم وكلمة المرور"}),f.jsx("input",{type:"text",placeholder:"اسم المستخدم الجديد",value:I,onChange:Oe=>j(Oe.target.value)}),f.jsx("input",{type:"password",placeholder:"كلمة المرور الجديدة",value:M,onChange:Oe=>F(Oe.target.value)}),f.jsx("button",{onClick:$,children:"حفظ التغييرات"})]}),f.jsxs("div",{id:"add-comment",className:"form-section",children:[f.jsx("h3",{children:"إضافة تعليق"}),f.jsxs("form",{onSubmit:q,children:[f.jsx("label",{htmlFor:"name",children:"الاسم"}),f.jsx("input",{type:"text",id:"name",name:"name",value:l,onChange:Oe=>a(Oe.target.value)}),f.jsx("br",{}),f.jsx("br",{}),f.jsx("label",{htmlFor:"country",children:"المدينة"}),f.jsx("input",{type:"text",id:"country",name:"country",value:d,onChange:Oe=>h(Oe.target.value)}),f.jsx("br",{}),f.jsx("br",{}),f.jsx("label",{htmlFor:"comment",children:"التعليق"}),f.jsx("textarea",{name:"comment",id:"comment",value:E,onChange:Oe=>T(Oe.target.value)}),f.jsx("br",{}),f.jsx("br",{}),f.jsx("button",{className:"button_add_comment",type:"submit",children:"أضف تعليق"})]})]}),f.jsxs("div",{id:"view-comments",className:"comments-section",children:[f.jsx("h3",{children:"جميع التعليقات"}),R.map(Oe=>f.jsxs("div",{className:"comment-box",children:[f.jsxs("p",{children:[f.jsx("strong",{children:"الاسم:"})," ",Oe.name]}),f.jsxs("p",{children:[f.jsx("strong",{children:"الدولة:"})," ",Oe.country]}),f.jsxs("p",{children:[f.jsx("strong",{children:"التعليق:"})," ",Oe.comment]}),f.jsx("button",{onClick:()=>se(Oe.id),children:"حذف"})]},Oe.id))]}),f.jsxs("div",{className:"table-container",id:"view-users",children:[f.jsx("h2",{children:"جدول المستخدمين"}),f.jsxs("table",{className:"responsive-table",children:[f.jsx("thead",{children:f.jsxs("tr",{children:[f.jsx("th",{children:"الاسم الأول"}),f.jsx("th",{children:"الاسم الأخير"}),f.jsx("th",{children:"البلد"}),f.jsx("th",{children:"العمر"}),f.jsx("th",{children:"الجنس"}),f.jsx("th",{children:"مستوى التعليم"}),f.jsx("th",{children:"مستوى اللغة اليابانية"}),f.jsx("th",{children:"الهاتف"}),f.jsx("th",{children:"الإيميل"}),f.jsx("th",{children:"الدور"}),f.jsx("th",{children:"الحذف"})]})}),f.jsx("tbody",{children:Y.map(Oe=>f.jsxs("tr",{children:[f.jsx("td",{children:Oe.firstName}),f.jsx("td",{children:Oe.lastName}),f.jsx("td",{children:Oe.country}),f.jsx("td",{children:Oe.age}),f.jsx("td",{children:Oe.gender}),f.jsx("td",{children:Oe.educationLevel}),f.jsx("td",{children:Oe.japaneseLevel}),f.jsx("td",{children:Oe.phone}),f.jsx("td",{children:Oe.email}),f.jsx("td",{children:f.jsxs("select",{value:Oe.role,onChange:xe=>Ee(Oe.id,xe.target.value),children:[f.jsx("option",{value:"student",children:"Student"}),f.jsx("option",{value:"teacher",children:"Teacher"})]})}),f.jsx("td",{children:f.jsx("button",{className:"delete-btn",onClick:()=>me(Oe.id),children:"🗑️"})})]},Oe.id))})]})]})]})]})}function g$(){const[l,a]=ie.useState(""),[d,h]=ie.useState(""),[E,T]=ie.useState(""),[R,N]=ie.useState(!1),I=io(),j=async()=>{T(""),N(!0);try{const F=await fetch("https://api.japaneseacademy.online/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password:d})});if(F.ok){const Y=await F.json();console.log("Login successful:",Y),localStorage.setItem("auth",Y.token),I("/Dash")}else T("اسم المستخدم أو كلمة المرور غير صحيح")}catch(F){T("حدث خطأ أثناء محاولة تسجيل الدخول. حاول مرة أخرى."),console.error("Login error:",F)}finally{N(!1)}},M=()=>l.trim()!==""&&d.trim()!=="";return f.jsxs("div",{className:"login-container",children:[f.jsx("h2",{children:"تسجيل الدخول"}),E&&f.jsx("p",{className:"error-message",children:E}),f.jsx("input",{type:"text",placeholder:"اسم المستخدم",value:l,onChange:F=>a(F.target.value)}),f.jsx("input",{type:"password",placeholder:"كلمة المرور",value:d,onChange:F=>h(F.target.value)}),f.jsx("button",{onClick:j,disabled:!M()||R,children:R?"جاري تسجيل الدخول...":"تسجيل الدخول"}),f.jsx(un,{to:"/",children:f.jsx("button",{className:"me-3",children:"الانتقال إلى الموقع"})})]})}function S$(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M5.22 8.22a.749.749 0 0 0 0 1.06l6.25 6.25a.749.749 0 0 0 1.06 0l6.25-6.25a.749.749 0 1 0-1.06-1.06L12 13.939 6.28 8.22a.749.749 0 0 0-1.06 0Z"},child:[]}]})(l)}const T$="/assets/_951e1fca-31d2-4544-acc4-7e540675ec7d.B8UGnWJz.jpg",v$=()=>{const[l,a]=ie.useState(null),d=h=>{a(l===h?null:h)};return f.jsx("div",{className:"container elementor-column elementor-col-100 elementor-top-column elementor-element",children:f.jsxs("div",{className:"elementor-widget-wrap elementor-element-populated",id:"Questions",children:[f.jsx("div",{className:"elementor-element elementor-widget elementor-widget-elementskit-heading",children:f.jsx("div",{className:"elementor-widget-container",children:f.jsx("div",{className:"ekit-wid-con",children:f.jsx("div",{className:"ekit-heading elementskit-section-title-wraper text_center",children:f.jsx("h2",{className:"ekit-heading--title elementskit-section-title fw-bold text-center",children:"لماذا سأسجل أبنائي في أكاديمية اللغة اليابانية ؟"})})})})}),f.jsx("img",{className:"w-75 d-flex m-auto",src:T$,alt:""}),f.jsx("div",{className:"elementor-element elementor-widget elementor-widget-elementskit-accordion mt-5 mb-5",children:f.jsx("div",{className:"elementor-widget-container",children:f.jsx("div",{className:"ekit-wid-con",children:f.jsx("div",{className:"elementskit-accordion accoedion-primary",children:y$.map((h,E)=>f.jsxs("div",{className:`elementskit-card ${l===E?"active":""}`,children:[f.jsx("div",{className:"elementskit-card-header",id:`primaryHeading-${E}`,children:f.jsxs("a",{href:`#collapse-${E}`,className:"ekit-accordion--toggler elementskit-btn-link",onClick:()=>d(E),"aria-expanded":l===E,"aria-controls":`Collapse-${E}`,children:[f.jsxs("span",{className:"ekit-accordion-title",children:[f.jsxs("span",{children:[" ",h.title," "]})," ",f.jsx("span",{children:f.jsx(S$,{})})," "]}),f.jsx("div",{className:"ekit_accordion_icon_group",children:f.jsx("div",{className:"ekit_accordion_normal_icon",children:f.jsx("i",{"aria-hidden":"true",className:`icon-right icon ${l===E?"icon-up-arrow":"icon-down-arrow1"}`})})})]})}),f.jsx("div",{id:`Collapse-${E}`,className:`elementskit-card-body ekit-accordion--content ${l===E?"":"collapse"}`,"aria-labelledby":`primaryHeading-${E}`,children:f.jsx("p",{children:h.content})})]},E))})})})}),f.jsx("div",{className:"elementor-element elementor-widget-elementskit-dual-button-center elementor-widget  mb-5",children:f.jsx("div",{className:"elementor-widget-container",children:f.jsx("div",{className:"ekit-wid-con",children:f.jsx("div",{className:"ekit-element-align-wrapper"})})})})]})})},y$=[{title:"1. ما هي أكاديمية اللغة اليابانية؟",content:"أكاديمية اللغة اليابانية هي منصة تعليمية متخصصة في تدريس اللغة اليابانية للناطقين بالعربية عبر الإنترنت. تقدم الأكاديمية مستويات دراسية تناسب جميع المستويات من المبتدئين إلى المتقدمين، وتتيح للطلاب فرصة تعلم اللغة من معلمين ناطقين باللغة اليابانية والعربية."},{title:"2. ما الذي يميز أكاديمية اللغة اليابانية عن غيرها؟",content:"تُعتبر أكاديمية اللغة اليابانية أول منصة متكاملة متخصصة بتعليم اللغة اليابانية للناطقين باللغة العربية في العالم، وتركز على تقديم تجربة تعلم شاملة تلائم الطلاب الناطقين باللغة العربية من خلال تقديم دروس مباشرة مع معلمين ناطقين باللغة اليابانية والعربية، وتقديم مناهج مخصصة لاحتياجات الناطقين بالعربية. كما تهتم الأكاديمية بجوانب الثقافة اليابانية، مما يجعل الطلاب يكتسبون فهمًا أعمق للغة في سياقها الثقافي."},{title:"3. ما هي مستويات الدراسة المتوفرة؟",content:"توفر الأكاديمية مستويات متعددة تناسب جميع الطلاب، بدءًا من المستوى التمهيدي للمبتدئين الذين ليس لديهم خلفية في اللغة اليابانية، وصولًا إلى المستويات المتقدمة التي تركز على تطوير المهارات اللغوية المعقدة كالمحادثة المتقدمة والكتابة الأكاديمية."},{title:"4. ما هو عدد الحصص الأسبوعية ومدتها؟",content:"تقدم الأكاديمية حصتين على الأكثر في الأسبوع لكل مستوى، بحيث تكون مدة كل حصة 90 دقيقة، مما يتيح للطلاب فرصة كافية للتعلم والممارسة مع توازن بين الاستيعاب والاستمرارية."},{title:"5. هل يمكنني تعلم اللغة اليابانية من الصفر؟",content:"نعم، الأكاديمية تقدم دورات تمهيدية للمبتدئين الذين ليس لديهم خلفية سابقة في اللغة اليابانية، بحيث يتم تعليمهم الحروف اليابانية (الكانا) والمفردات الأساسية، والقواعد اللغوية المبسطة، مما يؤهلهم للمستويات الأعلى لاحقاً."},{title:"6. من هم المدرسون؟",content:"يضم فريق التدريس في أكاديمية اللغة اليابانية نخبة من المعلمين اليابانيين والعرب ذوي الخبرة في تدريس اللغة اليابانية للناطقين بالعربية. والمعلمون اليابانيون هم ناطقون أصليون للغة ولديهم خبرة واسعة في العمل مع الطلاب الناطقين باللغة العربية، مما يتيح لهم توصيل المعلومات الثقافية واللغوية بطريقة ملائمة. أما المعلمون العرب فهم أيضًا متخصصون في اللغة اليابانية وآدابها، وقادرون على شرح المفاهيم بطرق تسهل على الطلاب الناطقين باللغة العربية استيعابها."},{title:"7. ما هي آلية التسجيل؟",content:"يمكن للطلاب التسجيل عبر الموقع من خلال تعبئة نموذج التسجيل، واختيار المستوى المناسب لهم. بعد ذلك، سيتواصل فريقنا مع الطالب لتأكيد التسجيل وتقديم الإرشادات اللازمة للبدء."},{title:"8. ما هي تكلفة الدورات؟",content:"تختلف تكلفة الدورات حسب المستوى وعدد الساعات المطلوبة. يمكن للطلاب الاطلاع على تفاصيل الأسعار من خلال قسم الرسوم في الموقع."},{title:"9. هل يتم تقديم شهادات للطلاب بعد إتمام المستويات؟",content:"نعم، يحصل الطلاب على شهادات إتمام بعد اجتياز كل مستوى بنجاح، وذلك كتأكيد على مهاراتهم ومعرفتهم باللغة اليابانية."},{title:"10. هل يمكنني الانضمام في أي وقت؟",content:"نعم، الأكاديمية تفتح باب التسجيل على مدار العام، وتتوفر مواعيد بدء مرنة حسب مستوى كل طالب واحتياجاته."},{title:"11. ما هي طريقة التدريس؟",content:"تعتمد الأكاديمية على المناهج اليابانية المخصصة للناطقين بلغات أجنبية، وتقدم دروسًا مباشرة عبر الإنترنت، تجمع بين الشرح والممارسة، مع التركيز على التواصل والتفاعل. يتم توفير المواد التعليمية والمراجع إلكترونيًا."},{title:"12. كيف يتم التقييم في الأكاديمية؟",content:"يتم تقييم الطلاب من خلال اختبارات قصيرة ومشاريع عملية خلال كل مستوى، بالإضافة إلى اختبار نهائي لتحديد مدى استيعابهم للمستوى."},{title:"13. هل هناك دعم للطلاب خارج أوقات الحصص؟",content:"نعم، توفر الأكاديمية دعمًا إضافيًا للطلاب خارج أوقات الحصص من خلال مجموعات التواصل أو البريد الإلكتروني، للإجابة على استفساراتهم وتقديم المساعدة في حال احتاجوا إليها."},{title:"14. ما هي المنصة المستخدمة في التدريس عبر الإنترنت؟",content:"تعتمد الأكاديمية على منصة تفاعلية تتيح للطلاب التفاعل مع المعلمين والزملاء، وتوفر أدوات تعليمية متقدمة مثل مشاركة الشاشة، اللوح الأبيض، والقدرة على تسجيل الدروس لمراجعتها لاحقًا."},{title:"15. هل هناك اختبارات لتحديد المستوى قبل بدء الدراسة؟",content:"نعم، يتم تقديم اختبار تحديد مستوى مجاني لجميع الطلاب الجدد لتحديد مستواهم الحالي في اللغة اليابانية، مما يساعد في توجيههم للمستوى الأنسب لهم في الأكاديمية."},{title:"16. كم هي مدة الدراسة لكل مستوى؟",content:"تختلف مدة الدراسة لكل مستوى حسب محتوى المستوى وتقدُّم الطالب. عادةً، تتراوح مدة المستوى الواحد بين 3 إلى 4 أشهر بواقع حصتين أسبوعيًا، مما يتيح للطلاب فرصة الاستيعاب والممارسة."},{title:"17. هل تركز الأكاديمية على اللهجات اليابانية المختلفة أم اللغة الرسمية فقط؟",content:"يتم تدريس اللغة اليابانية الرسمية (標準語) المستخدمة في جميع أنحاء اليابان، ولكن يتم أيضًا تقديم نبذة عن بعض اللهجات المحلية (方言) لاكتساب فهم أشمل للتنوع اللغوي."},{title:"18. هل تركز الدروس على جانب معين من اللغة (مثل المحادثة فقط) أم تشمل جميع المهارات؟",content:"تشمل الدروس جميع المهارات اللغوية الأساسية، مثل القراءة، الكتابة، الاستماع، والمحادثة. كما يتم التركيز على قواعد اللغة والمفردات بما يلائم كل مستوى لضمان تطوير شامل للمهارات."},{title:"19. هل تقدم الأكاديمية دروسًا حول الثقافة اليابانية؟",content:"نعم، تقدم الأكاديمية دروسًا خاصة حول الثقافة اليابانية تشمل جوانب مثل العادات والتقاليد، الفن، التاريخ، والعلاقات الاجتماعية. يساعد ذلك الطلاب في فهم السياق الثقافي للغة بشكل أفضل."},{title:"20. هل أحتاج إلى شراء كتب دراسية للدروس؟",content:"توفر الأكاديمية معظم المواد التعليمية إلكترونيًا، ولكن قد يُنصح الطلاب بشراء بعض الكتب المعتمدة مثل سلسلة ”Genki“ أو ”Minna no Nihongo“ حسب مستوى دراستهم لمساعدتهم في التعلم الذاتي."},{title:"21. هل هناك دروس خصوصية متاحة؟",content:"نعم، تقدم الأكاديمية دروسًا خاصة للراغبين في تعلم اللغة بشكل فردي مع معلم خاص. يتم تخصيص محتوى الدرس حسب أهداف الطالب، سواء كان ذلك لتحسين مهارة معينة أو التحضير لاختبار."},{title:"22. هل تقدم الأكاديمية دورات تحضيرية لاختبار JLPT؟",content:"نعم، تقدم الأكاديمية دورات خاصة للتحضير لاختبار الكفاءة في اللغة اليابانية (JLPT)، مع التركيز على الأقسام المختلفة للاختبار، مثل القراءة، القواعد، المفردات، والاستماع."},{title:"23. هل يمكنني تغيير المستوى إذا شعرت أنني بحاجة لذلك؟",content:"نعم، يمكن للطلاب طلب تغيير المستوى في حال وجدوا أن المستوى الحالي غير مناسب لهم. يتم مراجعة طلبهم وتقييمهم من قبل المعلمين لتحديد أنسب مستوى لهم."},{title:"24. ما هي سياسات الاسترداد في حال الانسحاب من الدورة؟",content:"توفر الأكاديمية سياسات استرداد مرنة حسب مدة الدراسة المنقضية وتوقيت الانسحاب. يُنصح الطلاب بالاطلاع على الشروط الخاصة بالاسترداد قبل التسجيل."},{title:"25. كيف يتم دعم الطلاب الذين يواجهون صعوبات في التعلم؟",content:"الأكاديمية تقدم دعمًا إضافيًا للطلاب الذين يحتاجون مساعدة خاصة، مثل جلسات تقوية، ودروس مساعدة، وتوفير مستشارين تعليميين لإرشادهم حسب احتياجاتهم."},{title:"26. هل الدروس مسجلة ويمكن مشاهدتها لاحقًا؟",content:"نعم، يتم تسجيل معظم الدروس بحيث يتمكن الطلاب من العودة إليها في أي وقت للمراجعة، مما يضمن لهم الاستفادة القصوى من كل درس."},{title:"27. هل يمكنني الدراسة من الهاتف أو الجهاز اللوحي؟",content:"نعم، توفر الأكاديمية إمكانية الوصول للدروس من خلال الحواسيب، الهواتف الذكية، والأجهزة اللوحية، مما يتيح للطلاب مرونة أكبر في الدراسة من أي مكان."},{title:"28. هل يجب أن أكون متفرغًا تمامًا للدروس؟",content:"لا، يمكن للطلاب اختيار أوقات الدروس التي تناسبهم، كما أن الأكاديمية توفر خيارات دراسة مرنة تلائم الأشخاص الذين لديهم جدول عمل أو التزامات أخرى."},{title:"29. هل تقدمون شهادات معترف بها؟",content:"الشهادات المقدمة هي شهادات إتمام من الأكاديمية، مما يعكس إنجاز الطالب في دراسة اللغة اليابانية. للاعتراف الدولي، يمكن للطلاب التحضير لاختبار JLPT عبر الأكاديمية."},{title:"30. ما هو عدد الطلاب في كل فصل؟",content:"تحرص الأكاديمية على إبقاء الفصول الدراسية صغيرة، بحيث لا يتجاوز عدد الطلاب في الفصل الواحد 10 طلاب، مما يتيح التفاعل الشخصي والمباشر مع المعلم."},{title:"31. ما هي طرق الدفع المتاحة؟",content:"يمكن للطلاب الدفع من خلال عدة وسائل مثل بطاقات الائتمان، التحويلات المصرفية، أو عبر خدمات الدفع الإلكتروني مثل PayPal وغيره. ويتم توفير التفاصيل الكاملة عند التسجيل."}];function R$(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"Container",children:f.jsx("div",{className:"content p-0 w-100",children:f.jsx("div",{className:"img_Articles",children:f.jsxs("div",{className:"detailsHeader col-lg-10  m-auto",children:[f.jsx("h1",{children:"المقالات"}),f.jsx("p",{className:"mt-3",children:"  Home /  المقالات "})]})})})})})}const JU="/assets/Leonardo_Diffusion_XL_In_this_enchanting_image_we_are_transpor_1.B2jPVufg.jpg",b$="/assets/nn.CYVYMjyY.jpg",C$="/assets/%D8%AE%D8%B1%D9%8A%D8%B7%D8%A9-%D8%A7%D9%84%D8%B9%D8%A7%D9%84%D9%85-%D8%B5%D9%85%D8%A7%D8%A11-768x488-1.BgnfJy3a.png",w$="/assets/Leonardo_Diffusion_XL_In_this_mesmerizing_image_we_enter_a_cap_1.BJ-L_ZQg.jpg",A$="/assets/leonardo_diffusion_xl_in_this_enchanting_image_we_are_drawn_in_0_8f7bd515-89b0-4176-a32d-0255f374a939.DKMXD72u.jpg",I$="/assets/DreamShaper_v7_An_image_imbued_with_the_charm_of_stories_and_l_2-1.B2yCMdK6.jpg",O$="/assets/Default_A_cartoon_illustration_depicts_a_child_with_a_furrowed_2.C_x8Rjhb.jpg";function N$(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container",children:f.jsxs("div",{className:"cards_Articles",children:[f.jsxs("div",{className:"card_Articles mt-5",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:JU,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:"  كيف أطور مهارة القراءة؟"}),f.jsx("p",{children:"  أهمية القراءة وكيفية تطوير مهارة القراءة عند الأطفال مقدمة تلعب القراءة دورًا حيويًا في تنمية مهارات الأطفال العقلية واللغوية. إنها"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:b$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" 🌟 تعلم العربية عن بعد: تحولات مهمة في عالم التعليم 📚"}),f.jsx("p",{children:"  🌟 أهمية التعليم عن بعد في تعليم اللغة العربية 📚 شهد العالم تطوراً كبيراً في مجال التعليم عن بعد 🌐، […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:C$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" 🌍📚 الكلمات العربية في لغات العالم: تعرف على أصولها! 🧐✨"}),f.jsx("p",{children:" هل تعرف أصول الكلمات العربية في لغات أخرى؟ مقدمة 🌍 اللغة العربية ليست فقط وسيلة تواصل بين العرب، بل هي […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:w$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" لماذا ارتبطت العربية بحرف الضاد؟"}),f.jsx("p",{children:" لماذا سميت اللغة العربية لغة الضاد؟ 🌍📜   مقدمة اللغة العربية، بجمالها وتعقيدها، هي واحدة من أكثر اللغات تأثيرًا في […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:A$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" 💡سحر اللغة العربية: من التراث إلى الابتكار الحديث📱"}),f.jsx("p",{children:"   أسرار جمال اللغة العربية: رحلة في عالم الضاد 🌍📜 اللغة العربية ليست مجرد وسيلة للتواصل؛ إنها وعاءٌ ثقافيٌ وتاريخيٌ […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:I$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" 🌍📚 الكلمات العربية في لغات العالم: تعرف على أصولها! 🧐✨"}),f.jsx("p",{children:" هل تعرف أصول الكلمات العربية في لغات أخرى؟ مقدمة 🌍 اللغة العربية ليست فقط وسيلة تواصل بين العرب، بل هي […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:O$,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" 📚 كيف ترفع اللغة العربية من ذكائك؟"}),f.jsx("p",{children:" 📚 كيف ترفع اللغة العربية من ذكائك؟   اكتشف التأثير المذهل لهذه اللغة العريقة على دماغك 📚 هل تعلم أن […]"})]}),f.jsxs("div",{className:"card_Articles",children:[f.jsx("div",{className:"image_articles",children:f.jsx("img",{className:" m-auto",src:JU,alt:""})}),f.jsx("h3",{className:"mt-4 mb-3",children:" ماذا تعرف عن عسر القراءة؟"}),f.jsx("p",{children:" 📚 عسر القراءة (الديسلكسيا) دليل شامل للتعرف والتعامل مع هذا الاضطراب الشائع 📚 🧐 هل تبحث عن فهم شامل لعسر […]"})]})]})})})}const D$="/assets/_c44c06cf-5421-4193-b9bb-cd39a86e679f.DTBo8aBr.jpg",P$="/assets/_dcdcbe88-4c28-4699-bb82-1d2754efe109.CDD-GR4X.jpg",L$="/assets/_993a5416-0b18-4ddb-869a-a5b99532ffe5.DLDW9ic2.jpg",k$="/assets/_fa1d11a6-f7f0-49d6-8ba9-5ea0abd69afe._G4bukGu.jpg",x$="/assets/_9e9b0610-8fca-4c60-8d4d-d734e8182c46.tmnqcAv2.jpg",yV=()=>{const l=io(),a=()=>{l("./MeetingNow")};return f.jsx("div",{children:f.jsx("button",{id:"join-btn",onClick:a,children:"الدخول الى البث"})})};function M$(){return f.jsxs(f.Fragment,{children:[f.jsx(yV,{}),f.jsxs("div",{className:"container Header",children:[f.jsx("div",{className:"academy pb-4 pt-4 mt-4 left",children:f.jsxs("div",{className:"row Header_revers",children:[f.jsxs("div",{className:"col-lg-6",children:[f.jsx("div",{className:"academy_logo mb-4 ",children:f.jsx("h2",{className:" left fw-bold",children:"أكاديمية اللغة اليابانية"})}),f.jsxs("div",{className:"details",children:["مرحبًا بكم في",f.jsxs("span",{className:"academySpan",children:["","  أكاديمية اللغة اليابانية، ",""]}),"المنصة التعليمية الرائدة لتعليم اللغة اليابانية للناطقين بغيرها. في أكاديمية اللغة اليابانية نقدم لكم تجربة تعليمية تفاعلية وفريدة، تمكنكم من تعلم اللغة اليابانية من خلال مجموعة متنوعة من الدروس والأنشطة، مدعومةً بأحدث التقنيات التعليمية وطرق التدريس المتقدمة. وما يميزنا في أكاديميتنا هو فريق التدريس المتعدد الثقافات، والذي يضم ناطقين أصليين باللغتين اليابانية والعربية، مما يوفر لكم تعلمًا ممتعًا وسلسًا يجمع بين الدقة اللغوية والتواصل الثقافي، ونوفر لكم بيئة تعليمية مخصصة تساعدكم على تحقيق أهدافكم اللغوية والثقافية."]})]}),f.jsx("div",{className:"col-lg-6",children:f.jsx("img",{className:"w-100",src:D$,alt:""})})]})}),f.jsxs("div",{className:"academy mt-5 mb-5 right row",children:[f.jsx("div",{className:"col-lg-6 ",children:f.jsx("img",{className:"w-100",src:k$,alt:""})}),f.jsxs("div",{className:"col-lg-6",children:[f.jsx("h2",{className:"title_academy mb-3",children:"رؤيتنا:"}),f.jsxs("div",{className:"details",children:["لقد تأسست                ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"لتكون جسرًا يربط بين العالم العربي واليابان من خلال اللغة والثقافة. فنحن نؤمن أن تعلم اللغة ليس مجرد تعلم القواعد والمفردات واستخدامها للتواصل اللغوي، بل هو نافذة لفهم الثقافات والحضارات المختلفة. ومن هنا، جاءت رؤيتنا في تقديم تعليم شامل يمزج بين التعليم اللغوي والتواصل الثقافي، بحيث يصبح الطلاب قادرين على استخدام اللغة اليابانية بشكل فعال في حياتهم اليومية والعملية. وبناء جسر ثقافي بين العالم العربي واليابان من خلال تعليم اللغة اليابانية بطريقة مبتكرة، ومتدرجة، وشاملة. ونسعى إلى تمكين الطلاب من التواصل بثقة واحترافية باستخدام اللغة اليابانية في مختلف مجالات الحياة، سواء كانت أكاديمية، أو مهنية، أو حتى ترفيهية. وفي أكاديمية اللغة اليابانية نؤمن بأن اللغة ليست مجرد أداة للتواصل، بل هي مفتاح لفهم ثقافات جديدة وتوسيع آفاق التبادل الثقافي والعلمي."]})]})]}),f.jsxs("div",{className:"academy mt-5 mb-5 right row",children:[f.jsxs("div",{className:"col-lg-6 ",children:[f.jsx("h2",{className:"title_academy mb-3",children:"رسالتنا:"}),f.jsxs("div",{className:"details",children:["تتمثل رسالة",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"في توفير تعليم لغوي عالي الجودة، يمكِّن جميع المتعلمين من اكتساب اللغة اليابانية بفعالية، مع فهم عميق للثقافة اليابانية. ونهدف في أكاديميتنا إلى أن نصبح وجهة أساسية لكل من يسعى لتعلم اللغة اليابانية في العالم من الناطقين باللغة العربية بشكل خاص. ونحرص على أن يكون التعليم ليس فقط تفاعليًا وممتعًا، بل أيضًا مبنيًا على أسس علمية ولغوية مدروسة، تضمن الفهم العميق والتطبيق السليم للغة. وفي أكاديمية اللغة اليابانية، نؤمن أن إتقان اللغة اليابانية سيفتح أمامكم أبوابًا واسعة من الفرص، سواءً في مجالات العمل، أو الدراسة، أو حتى التواصل الشخصي. وتعلم اللغة اليابانية ليس مجرد اكتساب مهارات جديدة، بل هو رحلة لاكتشاف عالم جديد مليء بالإثارة والتحديات."]})]}),f.jsx("div",{className:"col-lg-6",children:f.jsx("img",{className:"w-100",src:x$,alt:""})})]}),f.jsxs("div",{className:"what_we_do ",children:[f.jsx("h2",{className:"fw-bold text-center mb-4",children:"ماذا نقدم في أكاديمية اللغة اليابانية؟"}),f.jsx("img",{className:"w-75 m-auto d-flex mb-4",src:P$,alt:""}),f.jsxs("ul",{className:"ps-0",children:[f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"1. دورات تعليمية شاملة: "}),f.jsxs("p",{children:["تقوم ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"بتقديم دورات تعليمية متنوعة تناسب جميع المستويات، بدءًا من المبتدئين الذين لا يملكون أي معرفة مسبقة باللغة اليابانية، وصولًا إلى المتعلمين المتقدمين الذين يرغبون في تحسين مهاراتهم اللغوية. وتعتمد الدورات على منهجيات تدريس حديثة ومتطورة، تجمع بين التعلم الذاتي والتفاعل المباشر مع المدرسين."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"2. تدريس تفاعلي عبر الإنترنت: "}),f.jsxs("p",{children:["في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نستخدم أحدث الأدوات والمنصات التعليمية لتقديم دروس تفاعلية عبر الإنترنت. حيث يمكن للطلاب الانضمام إلى الحصص الافتراضية من أي مكان في العالم، والمشاركة في نقاشات وأنشطة مباشرة مع معلمين ناطقين أصليين باللغتين اليابانية والعربية، مما يعزز التفاعل والتطبيق الفعلي للغة."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"3. برنامج متكامل للتعلم الثقافي: "}),f.jsxs("p",{children:["إلى جانب تعليم اللغة اليابانية، نقوم في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," بتقديم مواد وأنشطة تساعد على فهم الثقافة والعادات والتقاليد اليابانية. وهذه البرامج الثقافية تعزز من قدرة الطلاب على التواصل بفعالية مع المجتمع الياباني وتفتح لهم آفاقًا أوسع لفهم المجتمع الياباني وثقافته."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"4. أساليب تدريس مبتكرة: "}),f.jsxs("p",{children:["في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نحرص على استخدام أساليب تدريس حديثة تعتمد على التكنولوجيا المتقدمة مثل التعلم التكيُّفي، والألعاب التعليمية، والتطبيقات التفاعلية. وهذه الأساليب تجعل عملية التعلم أكثر متعة وفعالية، وتساعد الطلاب على تحسين مهاراتهم في وقت قصير."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"5. دروس خصوصية وجماعية: "}),f.jsxs("p",{children:["نقوم في  ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"بتوفير خيارات متعددة من الدروس، سواءً كنت تفضل التعلم ضمن مجموعة أو تحتاج إلى دروس خصوصية مع مدرس متخصص. وتتناسب هذه الخيارات مع احتياجات كل طالب، سواءً كان الهدف هو اكتساب المهارات اللغوية الأساسية أو التحضير للامتحانات الرسمية مثل اختبار الكفاءة في اللغة اليابانية (JLPT) وغيره."]})]})]})]}),f.jsxs("div",{className:"why_we_choose",children:[f.jsx("h2",{className:"fw-bold text-center",children:"لماذا تختار أكاديمية اللغة اليابانية؟"}),f.jsx("img",{className:"w-75 m-auto d-flex mb-4",src:L$,alt:""}),f.jsxs("ul",{className:"ps-0",children:[f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"1. فريق تدريس متخصص:"}),f.jsxs("p",{children:["يضم فريق ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"مدرِّسين ناطقين أصليين باليابانية، بالإضافة إلى مدرِّسين ناطقين باللغة العربية ذوي خبرة في تعليم اللغة اليابانية. وهذا المزيج المثالي من المدرِّسين يتيح لنا تقديم تعليم متميز يجمع بين الدقة اللغوية والتواصل الفعال مع الطلاب."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"2. مرونة في التعلم: "}),f.jsxs("p",{children:["في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"نفهم أن الطلاب لديهم جداول زمنية مختلفة، لذا نقدم مرونة في اختيار مواعيد الدروس بما يتناسب مع ظروفهم. فسواءً كنت تفضل التعلم في الصباح أو المساء، يمكنك ضبط جدولك الدراسي بما يتناسب مع احتياجاتك."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"3. موارد تعليمية شاملة: "}),f.jsxs("p",{children:["بالإضافة إلى الدروس المباشرة، يحصل الطلاب في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "})," على مجموعة واسعة من المواد التعليمية مثل الكتب الإلكترونية، والملفات الصوتية، والفيديوهات التعليمية، والتطبيقات التفاعلية التي تساعدهم على ممارسة اللغة في أي وقت."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"4. بيئة تعليمية داعمة:"}),f.jsxs("p",{children:["نسعى في ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية "}),"إلى توفير بيئة تعليمية محفزة، تشجع الطلاب على المشاركة وطرح الأسئلة دون أي تردد. ونقوم بالاهتمام بكل طالب بشكل فردي، ونعمل على تقديم الدعم اللازم له لتحقيق النجاح."]})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"5. شبكة تواصل مع المتعلمين والخبراء: "}),f.jsxs("p",{children:["من خلال ",f.jsx("span",{className:"academySpan",children:" أكاديمية اللغة اليابانية، "})," يتاح للطلاب التواصل مع متعلمين آخرين من مختلف أنحاء العالم العربي، بالإضافة إلى الخبراء والمدرسين اليابانيين والعرب على حد السواء. وهذا يساهم في بناء مجتمع تعليمي داعم يمكن للطلاب فيه تبادل الخبرات والتجارب مع الآخرين."]})]})]})]})]})]})}function U$(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container Register",children:[f.jsx("h2",{className:"fw-bold",id:"Register",children:"طريقة التسجيل:"}),f.jsx("p",{children:"عملية التسجيل في أكاديميتنا بسيطة ومرنة، تشمل الخطوات التالية:"}),f.jsxs("ul",{className:"mt-5",children:[f.jsxs("li",{className:"step1 left item1 academy",children:[f.jsx("h2",{children:"إنشاء حساب مجاني:"}),f.jsx("p",{children:"قم بتعبئة نموذج التسجيل باستخدام بريدك الإلكتروني أو حسابات التواصل الاجتماعي. بعد ذلك، ستتلقى رسالة تأكيد بالبريد الإلكتروني."})]}),f.jsxs("li",{className:"step2 top item2 academy",children:[f.jsx("h2",{children:" اختبار تحديد المستوى:"}),f.jsx("p",{children:"خذ اختبار تحديد المستوى المجاني عبر الإنترنت لتحديد مستوى دراستك المناسب."})]}),f.jsxs("li",{className:"step3 right item3 academy",children:[f.jsx("h2",{children:" اختيار الدورة المناسبة:"}),f.jsx("p",{children:"بناءً على نتائج اختبار تحديد المستوى، يمكنك اختيار الدورة التعليمية الأنسب وبدء التسجيل."})]}),f.jsxs("li",{className:"step4 left item4 academy",children:[f.jsx("h2",{children:" إتمام عملية الدفع:"}),f.jsx("p",{children:"أتمم عملية الدفع من خلال وسائل الدفع الإلكترونية المتاحة (بطاقات ائتمان، PayPal، تحويل بنكي)."})]}),f.jsxs("li",{className:"step5 right item5 academy",children:[f.jsx("h2",{children:" الوصول إلى الدروس:"}),f.jsx("p",{children:"بعد الدفع، ستحصل على وصول فوري إلى منصة الدروس حيث يمكنك البدء في التعلم على الفور."})]})]})]})})}const j$="/assets/_9bf252b1-f72c-4ab3-b8d4-f9dbd6ba947f.CPtbePdx.jpg";function V$(){const l=io(),a=async d=>{const h=localStorage.getItem("token"),E=localStorage.getItem("userId");if(h&&E)try{const T=await ci.put("https://api.japaneseacademy.online/api/update-level",{id:E,Level:d},{headers:{Authorization:h}});console.log(T),T&&T.data?alert(`تم تسجيلك في ${d} بنجاح!`):alert("حدث خطأ في استلام البيانات.")}catch(T){console.error("خطأ:",T),T.response&&T.response.status===401?l("/Login_users"):alert("حدث خطأ أثناء التحديث")}else l("/Login_users")};return f.jsxs("div",{className:"container Date_lisson_Header mt-5",id:"Level_division",children:[f.jsxs("div",{className:"row academy",children:[f.jsxs("div",{className:"col-lg-7",children:[f.jsx("h2",{className:"title_Date_lisson_Header fw-bold",children:"المستويات الدراسية"}),f.jsx("div",{className:"details mt-3",children:"تقدم أكاديمية اللغة اليابانية برنامجًا دراسيًا متكاملًا لتعلم اللغة اليابانية، ومصمم خصيصًا للناطقين بالعربية. ينقسم البرنامج إلى عدة مستويات تعليمية تبدأ من الأساسيات وحتى الوصول إلى الطلاقة اللغوية، لتلبية احتياجات المتعلمين المختلفين. ويهدف هذا التقسيم إلى تمكين الطلاب من تطوير مهاراتهم اللغوية بشكل متدرج ومنظم، بحيث يتمكنون من فهم اللغة اليابانية واستخدامها بشكل عملي وفعّال. وتنقسم المستويات الدراسية في أكاديميتنا إلى المستويات التالية."})]}),f.jsx("div",{className:"col-lg-5",children:f.jsx("img",{className:"w-100",src:j$,alt:""})})]}),f.jsxs("div",{className:"All_level",children:[f.jsxs("ul",{children:[f.jsxs("li",{className:"academy mb-4 mt-4",children:[f.jsx("h2",{children:"1. المستويات الأساسية"}),f.jsx("p",{children:"المستويات الأساسية هي الخطوة الأولى للطلاب الذين ليس لديهم خلفية عن اللغة اليابانية. وفي هذه المستويات، يتعلم الطلاب الأبجدية اليابانية الأساسية (الهيراغانا والكاتاكانا)، وأساسيات النطق، وقواعد اللغة الأساسية، مما يضعهم على طريق فهم الجمل البسيطة والتعبيرات اليومية. ويتم التركيز على بناء قاعدة قوية تشمل كلمات وجمل بسيطة، إلى جانب تطوير مهارات الاستماع والنطق لتسهيل عملية الانتقال إلى المستويات التالية."})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"2. المستويات المتوسطة"}),f.jsx("p",{children:"بمجرد إتمام المستويات الأساسية، ينتقل الطلاب إلى المستويات المتوسطة حيث يصبحون قادرين على بناء جمل أكثر تعقيدًا واستخدام تراكيب لغوية متنوعة. وفي هذه المرحلة، يتعلم الطلاب مجموعة واسعة من المفردات والقواعد النحوية التي تساعدهم على التفاعل في مواقف الحياة اليومية والتواصل بثقة في بيئات غير مألوفة. كما يتم التركيز على تطوير مهارات القراءة وفهم النصوص اليابانية البسيطة وحتى المتوسطة."})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"3. المستويات المتقدمة"}),f.jsx("p",{children:"عند الوصول إلى المستويات المتقدمة، يكتسب الطلاب القدرة على فهم واستخدام اللغة اليابانية في سياقات أكثر تعقيدًا، سواء في المحادثات أو في قراءة النصوص المكتوبة. ويتم التركيز في هذه المستويات على صقل المهارات اللغوية من خلال التعرف على تراكيب لغوية معقدة وتوسيع المفردات بما يشمل مصطلحات تقنية وثقافية. وتهدف المستويات المتقدمة إلى تأهيل الطلاب للتفاعل بطلاقة في بيئات واقعية، سواء في مجال العمل أو الدراسة أو حتى السياحة."})]}),f.jsxs("li",{className:"academy mb-4",children:[f.jsx("h2",{children:"4. المستوى الاحترافي"}),f.jsx("p",{children:"هذا المستوى مخصص للطلاب الذين يرغبون في استخدام اللغة اليابانية على مستوى احترافي. وفي هذا المستوى، يتلقى الطلاب تدريبًا معمقًا في المجالات الأكاديمية والمهنية، مع التركيز على فهم النصوص المعقدة والكتابة بشكل احترافي. ويتميز هذا المستوى بتعلم مصطلحات متقدمة وتراكيب لغوية دقيقة تُستخدم في العمل الأكاديمي والمهني، مما يمكن الطلاب من التفوق في مجالات مثل الترجمة، والبحث العلمي، والتواصل في بيئات العمل اليابانية."})]}),f.jsx("hr",{}),f.jsx("p",{className:"single",children:"كل مستوى يتضمن دراسة شاملة تغطي مهارات القراءة، الكتابة، الاستماع، والمحادثة، مع التوجيه الدقيق من فريق من المدرسين المحترفين، مما يساعد الطلاب على التقدم وفقًا لقدراتهم واحتياجاتهم الخاصة."})]}),f.jsx("hr",{})]}),f.jsxs("div",{className:"levels mt-5",children:[f.jsxs("ul",{className:"right",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"المستوى المبتدئ (N5):"}),f.jsxs("p",{children:["في هذا المستوى، ستركز على أساسيات اللغة اليابانية، بما في ذلك تعلم حروف الهيراغانا والكاتاكانا، وبعض الكانجي الأساسية. سيتم تقديمك أيضًا لمفردات الحياة اليومية، مثل الأرقام، التحيات، والألوان، مما يساعدك على بناء أساس قوي.",f.jsx("br",{}),"المحتوى يشمل:"]}),f.jsx("li",{children:" 100 مفردة يابانية أساسية."}),f.jsx("li",{children:"تدريبات على النطق السليم."}),f.jsx("li",{children:"قواعد الجملة الأساسية (فعل، فاعل، مفعول)."}),f.jsx("li",{children:"جلسات حوار بسيطة (مع تطبيقات عملية)."}),f.jsx("button",{onClick:()=>a("المستوى المبتدئ (N5)"),children:"اشترك الآن"})]}),f.jsxs("ul",{className:"top",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"المستوى المتوسط (N4):"}),f.jsxs("p",{children:["هنا تتوسع في قواعد اللغة وتتعمق في تعلم حروف الكانجي الأكثر تعقيدًا. ستتعلم تكوين جمل أكثر تعقيدًا وستبدأ في استخدام اللغة في مواقف حقيقية مثل التحدث عن العائلة، العمل، والهوايات.",f.jsx("br",{}),"المحتوى يشمل:"]}),f.jsx("li",{children:" 300 مفردة يابانية إضافية."}),f.jsx("li",{children:" كتابة وقراءة نصوص قصيرة."}),f.jsx("li",{children:"تدريبات على فهم النصوص (استماع وقراءة)."}),f.jsx("li",{children:"تدريبات تفاعلية على الحوار اليومي."}),f.jsx("button",{onClick:()=>a("المستوى المتوسط (N4)"),children:"اشترك الآن"})]}),f.jsxs("ul",{className:"left",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"المستوى المتقدم (N3):"}),f.jsxs("p",{children:["في هذا المستوى، يتم التركيز على تطوير مهارات الاستماع والقراءة بشكل أكبر، مما يساعدك على التعامل مع نصوص ومحادثات أكثر تعقيدًا. ستتمكن من التواصل في مواضيع أكثر تنوعًا مثل السياسة، الأعمال، والثقافة اليابانية.",f.jsx("br",{}),"المحتوى يشمل:"]}),f.jsx("li",{children:"600 مفردة جديدة."}),f.jsx("li",{children:" كتابة مقالات قصيرة باللغة اليابانية."}),f.jsx("li",{children:"قراءة نصوص إخبارية وقصص يابانية."}),f.jsx("li",{children:"جلسات نقاش مفتوحة."}),f.jsx("button",{onClick:()=>a("المستوى المتقدم (N3)"),children:"اشترك الآن"})]}),f.jsxs("ul",{className:"hidden",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"المستوى المتقدم جدًا (N2):"}),f.jsxs("p",{children:["يُعد هذا المستوى نقلة نوعية حيث ستركز على المفردات المتخصصة وتطوير قدرتك على التفاعل في بيئات عمل يابانية. ستتعلم كيف تكتب رسائل البريد الإلكتروني، التقارير، وتقديم عروض تقديمية باللغة اليابانية.",f.jsx("br",{}),"المحتوى يشمل:"]}),f.jsx("li",{children:" 1000 مفردة متقدمة."}),f.jsx("li",{children:" تحليل نصوص ثقافية وأدبية يابانية."}),f.jsx("li",{children:" محادثات يومية ومهنية مع اليابانيين."}),f.jsx("button",{onClick:()=>a("المستوى المتقدم جدًا (N2)"),children:"اشترك الآن"})]}),f.jsxs("ul",{className:"hidden",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"المستوى الاحترافي (N1):"}),f.jsxs("p",{children:["هذا هو مستوى الإتقان، حيث ستتمكن من فهم اللغة اليابانية بشكل شامل واستخدامها بطلاقة في البيئات الأكاديمية والمهنية المعقدة. ستكون قادرًا على قراءة الكتب العلمية والأدبية، كتابة مقالات طويلة، والتحدث في المؤتمرات والندوات.",f.jsx("br",{}),"المحتوى يشمل:"]}),f.jsx("li",{children:" 2000 مفردة متقدمة جدًا."}),f.jsx("li",{children:" تدريبات على النقاشات الأكاديمية والمهنية."}),f.jsx("li",{children:" كتابة أبحاث وتقارير احترافية."}),f.jsx("li",{children:" تحليل نصوص أدبية يابانية قديمة وحديثة."}),f.jsx("button",{onClick:()=>a("المستوى الاحترافي (N1)"),children:"اشترك الآن"})]})]})]})}const XU="/assets/OIP.Dy8GVFGD.jpg",F$="/assets/photo_2024-10-30_14-24-02.BQ--cAxL.webp",B$="/assets/photo_2024-11-03_14-14-22.Dkw8S-D5.jpg",G$="/assets/_d0260767-0c90-4923-9381-3f0fb9b206d2.CEO1xR7g.jpg";function H$(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container   mb-5 Our_Teachers",id:"Teachers",children:[f.jsx("h2",{className:" fw-bold",children:"أعضاء الهيئة التدريسية"}),f.jsxs("p",{children:["مزيج من الخبرة والمعرفة العميقة باللغتين والثقافتين العربية واليابانية…"," "]}),f.jsx("p",{children:"نفتخر في أكاديمية اللغة اليابانية بفريق متميز من المدرسين الذين يجمعون بين الخبرة والمعرفة العميقة في اللغة والثقافة اليابانية والعربية على حد السواء. ويتكون فريق المدرسين من مجموعة متنوعة من الأساتذة، تشمل مدرّسين يابانيين يتحدثون اللغة العربية بطلاقة، مما يتيح لطلابنا تجربة تعليمية فريدة وشاملة."}),f.jsx("p",{children:"يتمتع المدرسون في أكاديمية اللغة اليابانية بخلفيات أكاديمية قوية وتجارب غنية في تدريس اللغة اليابانية للناطقين بالعربية. ويتميزون بفهم عميق للثقافتين اليابانية والعربية، مما يساعدهم في تعليم اللغة اليابانية ونقل الثقافة اليابانية لطلاب الأكاديمية بطريقة تفاعلية وممتعة. وبفضل معرفتهم المتعمقة بالاختلافات بين اللغتين العربية واليابانية، فإنهم يستطيعون تقديم شروحات تناسب احتياجات الطلاب وتساعدهم على تخطي التحديات والصعوبات اللغوية الناتجة عن الاختلافات الهيكلية بين اللغة الأم واللغة اليابانية. ويستخدم فريق التدريس أساليب تدريس مبتكرة تشمل الأنشطة التفاعلية ووسائل التعليم الحديثة، مما يسهم في خلق بيئة تعليمية محفزة. ويقومون بتقديم تعليم متميز يشجع على الاستكشاف والتفاعل، ويعزز من تجربة الطلاب في تعلم اللغة اليابانية."}),f.jsx("p",{children:"ونحن في أكاديمية اللغة اليابانية نؤمن بأن فهم اللغة لا يقتصر فقط على القواعد والمفردات، بل يتضمن أيضًا التعرف على العادات والتقاليد التي تشكل جوهر اللغة وتؤثر فيها بشكل مباشر. ونحرص على أن يكون كل درس مليئًا بالمعلومات القيمة والتجارب الثقافية، مما يمنح طلابنا أدوات للتواصل الفعّال وفهم أعمق للغة والثقافة. ونحن فخورون بفريقنا المتنوع الذي يساهم في تعزيز التفاهم بين الثقافات، ويعمل على بناء جسر ثقافي بين العالم العربي واليابان."}),f.jsxs("div",{className:"row",children:[f.jsx("div",{className:"col-lg-12",children:f.jsx("img",{className:"w-100",src:G$,alt:""})}),f.jsx("div",{className:"col-lg-12",children:f.jsxs("ul",{children:[f.jsxs("li",{className:"academy position-relative mt-5 mb-5",children:[f.jsxs("div",{className:"img_teacher",children:[f.jsx("h2",{children:"الأستاذة يوكو تاناكا:"}),f.jsx("img",{className:"face",src:XU,alt:""})]}),f.jsx("p",{children:"حاصلة على درجة الماجستير في التعليم من جامعة طوكيو، ومتخصصة في تعليم اللغة اليابانية للأجانب منذ أكثر من 10 سنوات. تُجيد العربية وتعمل مع الطلاب العرب على تطوير مهاراتهم في المحادثة والتواصل الفعّال."})]}),f.jsxs("li",{className:"academy position-relative mt-5",children:[f.jsxs("h2",{children:["الأستاذة ناهد المرعي",f.jsx("span",{children:"(أستاذة في أكاديمية اللغة اليابانية)"})]}),f.jsxs("div",{className:"img_teacher",children:[f.jsxs("p",{children:["من شغف باللغة اليابانية إلى تحقيق الحلم الأكاديمي… ",f.jsx("br",{}),"لقد بدأت مسيرتي في دراسة اللغة اليابانية في عام 2009، حيث حصلت على إجازة جامعية من كلية الآداب والعلوم الإنسانية، قسم اللغة اليابانية، في جامعة دمشق. وقد كانت تجربتي الأولى كمُعيدة في قسم اللغة اليابانية خطوةً أساسية لبدء مسيرة أكاديمية هدفها نقل جماليات هذه اللغة وآدابها إلى طلابي. وخلال تلك الفترة، عملت أيضًا كمدرسة للغة اليابانية في المعهد العالي للغات في",f.jsx("br",{})]}),f.jsx("img",{className:"face",src:F$,alt:""})]}),f.jsxs("p",{children:["جامعة دمشق, مما عزز خبرتي وأسهم في تعميق معرفتي بطرق تعليم اللغة اليابانية لغير الناطقين بها. لقد دفعني شغفي بالثقافة اليابانية للسفر إلى اليابان لمواصلة دراستي الأكاديمية، وهناك حصلت على درجة الماجستير في الأدب الياباني من جامعة تسوكوبا في عام 2015. واستكملت طريقي نحو الدكتوراه في الأدب الياباني في نفس الجامعة، حيث حصلت على درجة الدكتوراه في الأدب الياباني في عام 2020. وكانت سنوات الدراسة في اليابان غنيةً بالتحديات والفرص، حيث تعرفت على أعماق الأدب والثقافة اليابانية التي تجاوزت حدود اللغة نفسها، مما زاد من إصراري على العودة إلى الوطن والمساهمة في نقل هذه المعرفة. ",f.jsx("br",{}),"في الوقت الحالي، أعمل كعضو هيئة تدريسية في جامعة دمشق، وأسعى إلى تقديم تعليم مُثرٍ يلهم الطلاب لفهم وتقدير الثقافة اليابانية. ",f.jsx("br",{}),"ويشكل عملي في أكاديمية اللغة اليابانية جزءًا أساسيًا من أهدافي المستقبلية، حيث أطمح إلى تأسيس جيل جديد من متعلمي اللغة اليابانية بين الناطقين بالعربية، مع تمكينهم من بناء جسور ثقافية وأكاديمية تربط بين الثقافتين اليابانية والعربية."]})]}),f.jsxs("li",{className:"academy position-relative mt-5",children:[f.jsx("h2",{children:"الأستاذة ميئكو نشيئوتشي"}),f.jsxs("div",{className:"img_teacher",children:[f.jsxs("p",{children:["خبرة يابانية بطلاقة عربية لتجربة تعليمية متميزة… ",f.jsx("br",{}),"لقد بدأ شغفي باللغة والثقافة العربية منذ وقت مبكر، وأمضيت سنوات في الإقامة والعمل في المنطقة العربية، حيث انغمست في تفاصيل الحياة والثقافة العربية وتعلمت اللغة العربية حتى أتقنتها.",f.jsx("br",{})]}),f.jsx("img",{className:"face",src:B$,alt:""})]}),f.jsxs("p",{children:["وبفضل خلفيتي الغنية التي تجمع بين الثقافة اليابانية العريقة والفهم العميق للثقافة العربية الساحرة، أود بأن أكون جسرًا ثقافيًا حقيقيًا يمكّن الطلاب من اكتساب فهم حقيقي وعميق للغة اليابانية. ",f.jsx("br",{}),"وكمعلمة للغة اليابانية أسعى إلى جعل تعلم اللغة اليابانية تجربة تفاعلية وشيقة من خلال إستراتيجيات مبتكرة، تقدم محتوى يُعنى بتسهيل فهم أساسيات اللغة، وبناء المهارات اللازمة لاستخدامها في الحياة اليومية والأكاديمية. ",f.jsx("br",{}),"ولأنني أدرك جيدًا التحديات التي قد تواجه الطلاب العرب في تعلم اللغة اليابانية، فإنني أتبنى أساليب تدريسية متقدمة تربط بين الكلمات والمفاهيم اليابانية ونظيراتها في اللغة العربية، مما يسهم في تعزيز الفهم وبناء ثقة الطلاب في مهاراتهم. ",f.jsx("br",{}),"وإضافةً إلى شغفي بالتعليم، أمتلك خبرة واسعة في الترجمة بين اللغات اليابانية والعربية والإنجليزية، مما يتيح لي تقديم شرح دقيق وموثوق للمفردات والعبارات بما يتماشى مع السياقات المختلفة، ويمكّن الطلاب من فهم واستيعاب اللغة بطريقة متكاملة. ولأنني أدرك عمق التعابير اليابانية وتعدد معانيها، كما هو الحال في اللغة العربية، فإنني قادرة على تبسيط المفاهيم الصعبة وجعلها في متناول الجميع، مما يجعل من تعليمها تجربة ممتعة، تدمج بين الاحترافية والإلهام. ",f.jsx("br",{}),"ومن خلال تعليمي للغة اليابانية في أكاديمية اللغة اليابانية أسعى لأن أكون مصدر إلهام حقيقي لكل من يرغب بتعلم هذه اللغة الجميلة، وتعريفهم على ثقافة اليابان وقيمها وعاداتها التي تجعل منها بلدًا فريدًا وساحرًا. ",f.jsx("br",{})]})]}),f.jsxs("li",{className:"academy position-relative mt-5",children:[f.jsxs("h2",{children:["الأستاذ خالد سليمان",f.jsx("span",{children:"(مدير أكاديمية اللغة اليابانية)"})]}),f.jsxs("div",{className:"img_teacher",children:[f.jsxs("p",{children:["من رحلة بين لغتين إلى بناء جسر بين ثقافتين…",f.jsx("br",{}),"عندما بدأت رحلتي الأكاديمية في كلية الاقتصاد في جامعة دمشق، كانت اليابان بالنسبة لي مجرد بلد بعيد يقع في أقصى الشرق، وكان كل ما أعرفه عن اللغة اليابانية هي تلك الحروف والكلمات الغريبة التي كانت تظهر في شاشة التلفاز عند مشاهدة (الأنمي) الياباني القادم من ذلك البلد. ",f.jsx("br",{})]}),f.jsx("img",{className:"face",src:XU,alt:""})]}),f.jsxs("p",{children:["وفجأة ودون تخطيط مُسبق، التحقت بالمعهد العالي للغات في جامعة دمشق، ومن هناك بدأت خطواتي الأولى في عالم اللغة اليابانية، حيث انفتحت أمامي نافذة إلى عالم مليء بالغرابة والجمال، ووجدت نفسي منجذبًا إلى ذلك العالم البعيد بقوة. ",f.jsx("br",{}),"ومن هناك حصلت على منحة دراسية لدراسة اللغة اليابانية في جامعة طوكيو للدراسات الأجنبية، حيث أمضيت عامًا في اليابان بين جمال اللغة وأعماق الثقافة، وأدركت أن اللغة هي مفتاح لفهم عميق لمجتمع بأكمله. ",f.jsx("br",{}),"وبعدها عُدت إلى حيث بدأت، حاملًا معي شغفًا جديدًا، وبدأت عملي مترجمًا في مكتب الوكالة اليابانية للتعاون الدولي (جايكا) في دمشق، حيث عشت تجربة الربط بين لغتين وثقافتين بشكل عملي ومؤثر. وأدركت حينها بأن الترجمة هي فن الوصل، وجسر بين الثقافات والشعوب. فكل كلمة في أي لغة هي فرصة لنسج حوار بين عالمين."," ",f.jsx("br",{}),"ولم أكتفِ عند ذلك الحد، فقد حملت معي حنينًا إلى ذلك العالم الذي صار جزءًا مني، وقررت العودة إليه مرة أخرى لأكمل دراساتي العليا. وبعد أن تنقلت بين عدة جامعات، وأنهيت دراستي في مرحلتي الماجستير والدكتوراه، أصبحت اليابان لي وطنًا ثانيًا، ليس فقط بالمعنى المكاني، بل بارتباط روحي ومعرفي. ",f.jsx("br",{}),"واليوم، وأنا أعمل كأستاذ للغة والثقافة العربية في عدة جامعات ومعاهد يابانية، وأقوم بتدريس مهارات الترجمة بين اللغتين العربية واليابانية، أجد نفسي في كل درس أو محاضرة، أقدم أكثر من كلمات، أقدم جسرًا عابرًا للقارات، بين البلاد العربية واليابان."," ",f.jsx("br",{}),"وفي أكاديمية اللغة اليابانية، أسعى لأن أتابع هذه الرسالة، وأن أنقل رحلتي إلى أشخاص يملكون ذات الشغف، لأمهد لهم طريقًا يربط بين اللغة والثقافة اليابانية، ولأساعدهم في بناء جسورهم الخاصة إلى ثقافة ثرية وجميلة، لعلهم يحملون بدورهم رسائل تقرِّب بين الثقافات، ويكتبون قصصهم الخاصة على طريقهم إلى اليابان. ",f.jsx("br",{})]})]})]})})]})]})})}const W$="/assets/_6f2f27d9-4995-4117-aa80-149abadfed41.BnLOJiQs.jpg";function K$(){return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"container Our_Study_materials mt-5 mb-3",id:"Study_materials",children:[f.jsx("h2",{className:"fw-bold",children:"تشمل موادنا الدراسية:"}),f.jsx("div",{className:"academy",children:f.jsxs("div",{className:"row",children:[f.jsx("div",{className:"col-lg-6",children:f.jsx("img",{className:"w-100",src:W$,alt:""})}),f.jsx("div",{className:"col-lg-6",children:f.jsxs("ul",{children:[f.jsx("li",{children:"- كتب إلكترونية تفاعلية: تحتوي على تدريبات واختبارات لكل مستوى، مع محتوى قابل للتنزيل والقراءة في أي وقت."}),f.jsx("li",{children:"- فيديوهات تعليمية مسجلة: تُتيح لك متابعة الدروس وفق جدولك الخاص."}),f.jsx("li",{children:"- جلسات مباشرة عبر الإنترنت: مع أساتذة متخصصين لطرح الأسئلة والحصول على توضيحات."})]})})]})})]})})}const Y$="/assets/OIP.BoF6l54M.jpg";function z$(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container More_Services",id:"More_services",children:f.jsxs("div",{className:"row academy mt-5 mb-5",children:[f.jsx("div",{className:"col-lg-6 mt-5",children:f.jsxs("ul",{children:[f.jsx("h2",{children:"خدمات إضافية:"}),f.jsxs("li",{children:[f.jsx("h5",{children:"ورش عمل حول الثقافة اليابانية:"}),f.jsx("p",{children:"نقدم ورش عمل شهرية تغطي مواضيع متنوعة مثل الثقافة الشعبية، التقاليد اليابانية، وتاريخ اليابان."})]}),f.jsxs("li",{children:[f.jsx("h5",{children:"دورات اللغة اليابانية للأعمال:"}),f.jsx("p",{children:"موجهة لمن يرغبون في تحسين مهاراتهم اللغوية في بيئات العمل اليابانية."})]})]})}),f.jsx("div",{className:"col-lg-6 ",children:f.jsx("img",{className:"w-100",src:Y$,alt:""})})]})})})}const q$="/assets/_f43c3626-6c13-4a8d-82d5-697203e33105.DUPr2yI4.jpg";function $$(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container Supports",id:"Support",children:f.jsxs("div",{className:"row academy  mt-5 mb-5",children:[f.jsxs("div",{className:"col-lg-6",children:[f.jsx("h2",{children:"الدعم الفني:"}),f.jsx("p",{children:"يتوفر لدينا فريق دعم فني متواجد على مدار الساعة لمساعدتك في حال واجهت أي مشاكل فنية أثناء الدراسة أو التسجيل."}),f.jsx("p",{children:"تم تحسين التفاصيل لتشمل مزيدًا من المعلومات حول البرامج الدراسية والخدمات التي تقدمها الأكاديمية."})]}),f.jsx("div",{className:"col-lg-6",children:f.jsx("img",{className:"w-100 m-auto d-flex",src:q$,alt:""})})]})})})}const J$="/assets/_73a4c5e5-2e9c-40f3-8260-f94d1fb42248.FeAXB9mq.jpg";function X$(){const l=io(),a=()=>{const d=localStorage.getItem("token");l(d?"/Dash_users/:userId":"/Login_users")};return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container",children:f.jsxs("div",{className:"money_lisson mt-5",id:"Fees",children:[f.jsxs("div",{className:"row academy",children:[f.jsxs("div",{className:"col-lg-7",children:[f.jsx("h2",{className:"fw-bold mt-4",children:"الرسوم:"}),f.jsx("p",{children:"نعمل على توفير برامج تعليمية متنوعة تلبي احتياجات مختلف المستويات، مع مراعاة توفير حزم مرنة للطلاب. يمكنك اختيار الدفع لكل دورة أو الاشتراك في حزم شاملة بأسعار مخفضة."})]}),f.jsx("div",{className:"col-lg-5",children:f.jsx("img",{className:"w-100",src:J$,alt:""})}),f.jsxs("div",{className:"How_to_pay",children:[f.jsx("h2",{className:"fw-bold",children:"وسائل الدفع:"}),f.jsxs("div",{className:"means",children:[f.jsx("div",{className:"mean_1",onClick:a}),f.jsx("div",{className:"mean_2",onClick:a}),f.jsx("div",{className:"mean_3",onClick:a}),f.jsx("div",{className:"mean_4",onClick:a}),f.jsx("div",{className:"mean_5",onClick:a})]})]})]}),f.jsxs("ul",{className:"mt-5",children:[f.jsx("li",{className:"right academy item1",children:"رسوم المستوى المبتدئ (N5):"}),f.jsx("li",{className:"right academy item2",children:"الدورة الفردية: 150 دولارًا (8 أسابيع)."}),f.jsxs("li",{className:"right academy item3",children:[" ","الحزمة الشاملة لجميع مستويات المبتدئين: 400 دولار (3 دورات، N5 + N4)."]}),f.jsx("li",{className:"right academy item4",children:"رسوم المستوى المتوسط (N4):"}),f.jsx("li",{className:"right academy item5",children:"الدورة الفردية: 200 دولارًا (8 أسابيع)."}),f.jsx("li",{className:"right academy item6",children:"الحزمة الشاملة لمستويات المتوسط والمتقدم: 600 دولار (4 دورات، N4 + N3)."}),f.jsx("li",{className:"right academy item7",children:" رسوم المستويات المتقدمة (N3-N1):"}),f.jsx("li",{className:"right academy item8",children:"المستوى المتقدم (N3): 250 دولارًا لكل دورة (10 أسابيع)."}),f.jsx("li",{className:"right academy item9",children:"المستويات المتقدمة جدًا والاحترافية (N2-N1): 300 دولار لكل دورة (12 أسبوعًا)."})]}),f.jsxs("p",{children:[f.jsx("span",{children:"ملاحظة: "})," تتضمن جميع الرسوم الوصول إلى المواد الدراسية الرقمية، التمارين التفاعلية، والدعم المباشر مع الأساتذة."]})]})})})}const Q$="/assets/undraw_Team_page_re_cffb.B8F2DfaB.png";function Z$(){const[l,a]=ie.useState({firstName:"",lastName:"",country:"",age:"",gender:"",educationLevel:"",japaneseLevel:"",phone:"",email:"",password:"",confirmPassword:""}),[d,h]=ie.useState(""),[E,T]=ie.useState(!1),[R,N]=ie.useState(""),[I,j]=ie.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,specialChar:!1}),[M,F]=ie.useState(!1),[Y,Z]=ie.useState(!1),X=io(),q=$=>{if(a({...l,[$.target.name]:$.target.value}),$.target.name==="password"){const Q=$.target.value;j({length:Q.length>=8,uppercase:/[A-Z]/.test(Q),lowercase:/[a-z]/.test(Q),number:/\d/.test(Q),specialChar:/[@$!%*?&]/.test(Q)})}},re=$=>{if($.preventDefault(),l.password!==l.confirmPassword){alert("كلمات السر غير متطابقة");return}if(!I.length||!I.uppercase||!I.lowercase||!I.number||!I.specialChar){N("يجب أن تحتوي كلمة السر على ٨ أحرف على الأقل، حرف كبير واحد، حرف صغير واحد، رقم واحد، ورمز واحد.");return}else N("");F(!0),fetch("https://api.japaneseacademy.online/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(Q=>Q.json()).then(Q=>{Q.error?alert("حدث خطأ: "+Q.error):(alert("تم التسجيل بنجاح، تحقق من بريدك الإلكتروني لتفعيل الحساب"),T(!0))}).catch(Q=>{console.error("Error:",Q)}).finally(()=>{F(!1)})},se=$=>{$.preventDefault(),Z(!0),fetch("https://api.japaneseacademy.online/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.email,verificationCode:d})}).then(Q=>Q.json()).then(Q=>{Q.error?alert("رمز التحقق غير صحيح"):(alert("تم التحقق من البريد الإلكتروني بنجاح"),X("/Login_users/"))}).catch(Q=>{console.error("Error:",Q)}).finally(()=>{Z(!1)})};return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container",children:f.jsxs("div",{className:"row RegisteR",children:[f.jsxs("div",{className:"register_half  col-lg-6",children:[f.jsxs("div",{children:[f.jsx("img",{className:"m-auto d-flex",src:Q$,alt:""}),f.jsx("p",{className:" m-auto d-flex ",children:"قم بتعبئة نموذج التسجيل باستخدام بريدك الإلكتروني أو حسابات التواصل الاجتماعي. بعد ذلك، ستتلقى رسالة تأكيد بالبريد الإلكتروني."})]}),f.jsx("li",{className:"nav-item item4 hidden",children:f.jsxs(un,{className:"nav-a dropdown-item",to:"/Register",children:["اضغط هنا للتعرف على ",f.jsx("span",{children:" طريقة التسجيل "}),f.jsx(vj,{})]})})]}),f.jsxs("div",{className:"col-lg-6",children:[f.jsxs("form",{className:"form-container academy p-5 mt-5 mb-5 m-auto",onSubmit:re,children:[f.jsx("h1",{className:"fw-bold m-auto mb-4 mt-4",children:"إنشاء حساب"}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," الاسم الشخصي:"]}),f.jsx("input",{type:"text",name:"firstName",value:l.firstName,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," اسم العائلة:"]}),f.jsx("input",{type:"text",name:"lastName",value:l.lastName,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," دولة الإقامة:"]}),f.jsx("input",{type:"text",name:"country",value:l.country,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," العمر:"]}),f.jsx("input",{type:"number",name:"age",value:l.age,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," الجنس:"]}),f.jsxs("select",{name:"gender",value:l.gender,onChange:q,required:!0,children:[f.jsx("option",{value:""}),f.jsx("option",{value:"male",children:"ذكر"}),f.jsx("option",{value:"female",children:"أنثى"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," المستوى التعليمي:"]}),f.jsxs("select",{name:"educationLevel",value:l.educationLevel,onChange:q,required:!0,children:[f.jsx("option",{value:""}),f.jsx("option",{value:"المرحلة الابتدائية",children:"المرحلة الابتدائية"}),f.jsx("option",{value:"المرحلة الإعدادية",children:"المرحلة الإعدادية"}),f.jsx("option",{value:"المرحلة الثانوية",children:"المرحلة الثانوية"}),f.jsx("option",{value:"مرحلة المعاهد المتوسطة",children:"مرحلة المعاهد المتوسطة"}),f.jsx("option",{value:"مرحلة التعليم الجامعي",children:"مرحلة التعليم الجامعي"}),f.jsx("option",{value:"مرحلة الدراسات العليا (ماجستير)",children:"مرحلة الدراسات العليا (ماجستير)"}),f.jsx("option",{value:"مرحلة الدراسات العليا (دكتوراه)",children:"مرحلة الدراسات العليا (دكتوراه)"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," مستوى اللغة اليابانية:"]}),f.jsxs("select",{name:"japaneseLevel",value:l.japaneseLevel,onChange:q,children:[f.jsx("option",{value:""}),f.jsx("option",{value:"beginner",children:"المستوى المبتدئ (قبل البدء بتعلم اللغة اليابانية)"}),f.jsx("option",{value:"beginnerIntermediate",children:"المستوى المبتدئ المتوسط (إمكانية قراءة وكتابة الهيراغانا والكتاكانا وبعض حروف الكانجي البسيطة، وقراءة وفهم بعض الكلمات والجمل)"}),f.jsx("option",{value:"beginnerAdvanced",children:"المستوى المبتدئ المتقدم (N5) (إجادة قراءة وكتابة الهيراغانا والكاتاكانا وحوالي 100 حرف كانجي، والقدرة على التعريف بالنفس، وقراءة وكتابة جمل بسيطة)"}),f.jsx("option",{value:"intermediateBeginner",children:"المستوى المتوسط المبتدئ (N4) (إجادة قراءة وكتابة حوالي 200 حرف كانجي بالإضافة إلى الهيراغانا والكتاكانا، والتعريف بالنفس مع القدرة على فهم الأسئلة المتعلقة بالحياة اليومية والإجابة عنها)"}),f.jsx("option",{value:"intermediate",children:"المستوى المتوسط (N3)"}),f.jsx("option",{value:"intermediateAdvanced",children:"المستوى المتوسط المتقدم"}),f.jsx("option",{value:"advancedBeginner",children:"المستوى المتقدم المبتدئ (N2)"}),f.jsx("option",{value:"advancedIntermediate",children:"المستوى المتقدم المتوسط"}),f.jsx("option",{value:"advanced",children:"المستوى المتقدم (N1)"}),f.jsx("option",{value:"postAdvanced",children:"ما بعد المستوى المتقدم (طلاب الدراسات العليا المتخصصون باللغة اليابانية والأدب الياباني)"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," رقم الواتساب:"]}),f.jsx("input",{type:"tel",name:"phone",value:l.phone,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," البريد الإلكتروني:"]}),f.jsx("input",{type:"email",name:"email",value:l.email,onChange:q,required:!0})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," كلمة السر:"]}),f.jsx("input",{type:"password",name:"password",value:l.password,onChange:q,required:!0}),R&&f.jsx("p",{style:{color:"red"},children:R}),f.jsxs("ul",{className:"password",children:[f.jsx("li",{style:{color:I.length?"green":"red"},children:I.length?"-  تحتوي على 8 أحرف على الأقل":"- يجب أن تحتوي على 8 أحرف على الأقل"}),f.jsx("li",{style:{color:I.uppercase?"green":"red"},children:I.uppercase?"-  تحتوي على حرف كبير واحد على الأقل":"- يجب أن تحتوي على حرف كبير واحد على الأقل"}),f.jsx("li",{style:{color:I.lowercase?"green":"red"},children:I.lowercase?"-  تحتوي على حرف صغير واحد على الأقل":"- يجب أن تحتوي على حرف صغير واحد على الأقل"}),f.jsx("li",{style:{color:I.number?"green":"red"},children:I.number?"-  تحتوي على رقم واحد على الأقل":"- يجب أن تحتوي على رقم واحد على الأقل"}),f.jsx("li",{style:{color:I.specialChar?"green":"red"},children:I.specialChar?"-  تحتوي على رمز واحد على الأقل":"- يجب أن تحتوي على رمز واحد على الأقل"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{children:[f.jsx("span",{style:{color:"red"},children:"*"})," تأكيد كلمة السر:"]}),f.jsx("input",{type:"password",name:"confirmPassword",value:l.confirmPassword,onChange:q,required:!0})]}),f.jsx("button",{className:"mt-4",type:"submit",disabled:M,children:M?"جاري التسجيل...":"سجل الآن"})]}),E&&f.jsxs("form",{className:"form-container academy",onSubmit:se,children:[f.jsx("label",{className:"fs-5",children:"أدخل كود التحقق:"}),f.jsx("input",{type:"text",placeholder:"أدخل كود التحقق",value:d,onChange:$=>h($.target.value)}),f.jsx("button",{className:"mt-4 mb-5",type:"submit",disabled:Y,children:Y?"جاري التحقق...":"تحقق"})]})]})]})})})}function eJ(){const[l,a]=ie.useState(""),[d,h]=ie.useState(""),E=io(),[T,R]=ie.useState(!1),[N,I]=ie.useState(""),j=M=>{M.preventDefault(),R(!0),I(""),fetch("https://api.japaneseacademy.online/login_user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,password:d})}).then(F=>F.json()).then(F=>{R(!1),F.token?(console.log("تم تسجيل الدخول بنجاح"),localStorage.setItem("token",F.token),localStorage.setItem("firstName",F.user.firstName),localStorage.setItem("userEmail",F.user.email),localStorage.setItem("userId",F.user.id),localStorage.setItem("userRole",F.user.role),E("/")):I("البريد الإلكتروني أو كلمة المرور غير صحيحة")}).catch(F=>{R(!1),console.error("Error:",F),I("حدث خطأ في الاتصال بالخادم. الرجاء المحاولة لاحقًا.")})};return f.jsx(f.Fragment,{children:f.jsxs("form",{className:"login-form academy container mt-5 mb-5",onSubmit:j,children:[f.jsx("h1",{className:"fw-bold m-auto",children:"تسجيل الدخول"}),f.jsxs("div",{className:"w-100",children:[f.jsx("label",{children:"البريد الإلكتروني:"}),f.jsx("input",{type:"email",value:l,onChange:M=>a(M.target.value),required:!0})]}),f.jsxs("div",{className:"w-100 mb-5",children:[f.jsx("label",{children:"كلمة المرور:"}),f.jsx("input",{type:"password",value:d,onChange:M=>h(M.target.value),required:!0})]}),f.jsx("button",{type:"submit",disabled:T,children:T?"جارٍ تسجيل الدخول...":"تسجيل الدخول"}),N&&f.jsx("p",{className:"error-message",children:N}),f.jsxs("h5",{className:"text-center m-auto mt-5 Dont_have_account",children:["لا تمتلك حساب؟",f.jsx(un,{to:"/Register_account",children:f.jsx("span",{children:"إنشاء حساب"})})]})]})})}function tJ(){const[l,a]=ie.useState(null),d=io();return ie.useEffect(()=>{if(!localStorage.getItem("token")){d("/Login_users");return}fetch("https://api.japaneseacademy.online/allusers",{method:"GET",headers:{"Content-Type":"application/json"}}).then(E=>E.json()).then(E=>{const T=E.find(R=>R.token===R.token);T?a(T):(alert("خدث خطأ أثناء تسجيل الدخول"),d("/Login_users"))}).catch(E=>{console.error("Error fetching user data:",E),alert("حدث خطأ أثناء جلب البيانات. حاول مرة أخرى."),d("/Login_users")})},[d]),l?f.jsxs("div",{className:"dashboard container mt-5",children:[f.jsxs("h1",{className:"fw-bold",children:["مرحباً، ",l.firstName," ",l.lastName]}),f.jsxs("p",{children:["البريد الإلكتروني: ",l.email]}),f.jsxs("p",{children:["الدولة: ",l.country]}),f.jsxs("p",{children:["العمر: ",l.age]}),f.jsxs("p",{children:["الجنس: ",l.gender]}),f.jsxs("p",{children:["المستوى التعليمي: ",l.educationLevel]}),f.jsxs("p",{children:["مستوى اللغة اليابانية: ",l.japaneseLevel]}),f.jsxs("p",{children:["رقم الهاتف: ",l.phone]})]}):f.jsx("p",{children:"جارٍ تحميل البيانات..."})}const nJ="/assets/_cf1366d8-6ddb-44f9-b966-a65d496096f6.BMRpVcwh.jpg",iJ="/assets/_8448e83a-3c19-4997-b93c-ce4df62dd5ea.BK8mtZW-.jpg";function rJ(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container Privacy mt-4",children:f.jsxs("div",{className:"details_privacy",children:[f.jsxs("div",{className:"row academy mb-5",children:[f.jsxs("div",{className:"col-lg-8 col-md-6 col-12 text_privacy ",children:[f.jsx("h2",{className:"mb-3",children:"سياسة الخصوصية"}),f.jsx("p",{children:"مرحبًا بكم في موقع أكاديمية اللغة اليابانية. تلتزم الأكاديمية بحماية خصوصية مستخدمي الموقع وتضمن حماية المعلومات الشخصية الخاصة بكم. تهدف سياسة الخصوصية هذه إلى توضيح كيفية جمع واستخدام وحماية المعلومات التي يقوم الطلاب بتقديمها عند استخدامهم لموقعنا."})]}),f.jsx("div",{className:"col-lg-4 col-md-6 col-12 img_privacy",children:f.jsx("img",{className:"m-auto",src:nJ,alt:""})})]}),f.jsxs("div",{className:"ul_privacy",children:[f.jsxs("ul",{className:"academy row mb-5",children:[f.jsxs("div",{className:"col-lg-8",children:[f.jsx("h2",{children:"جمع المعلومات الشخصية"}),f.jsx("p",{children:"تقوم أكاديمية اللغة اليابانية بجمع المعلومات الشخصية اللازمة لتقديم خدماتها التعليمية بشكل فعال، ويشمل ذلك:"}),f.jsxs("li",{children:[f.jsx("span",{children:"المعلومات الأساسية: "}),"كالاسم الكامل، وتاريخ الميلاد، والجنس."]}),f.jsxs("li",{children:[f.jsx("span",{children:"معلومات الاتصال: "}),"مثل البريد الإلكتروني، ورقم الهاتف."]}),f.jsxs("li",{children:[f.jsx("span",{children:"المعلومات التعليمية: "}),"مستوى اللغة الحالي، والخلفية التعليمية السابقة في اللغة اليابانية إن وجدت."]}),f.jsxs("li",{children:[f.jsx("span",{children:"معلومات الحساب: "}),"مثل اسم المستخدم وكلمة المرور الخاصة بالحساب على الموقع."]})]}),f.jsx("div",{className:"col-lg-4 img_privacy",children:f.jsx("img",{className:"m-auto",src:iJ,alt:""})}),f.jsx("p",{className:"mt-3",children:"يتم جمع هذه المعلومات بشكل رئيسي عند قيام الطالب بإنشاء حساب جديد أو التسجيل في إحدى الدورات التعليمية التي نقدمها."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"استخدام المعلومات الشخصية"}),f.jsx("p",{children:"نستخدم المعلومات الشخصية التي نجمعها للأغراض التالية:"}),f.jsxs("li",{children:[f.jsx("span",{children:"تقديم الخدمات التعليمية: "}),"مثل تسجيل الطلاب في الدورات، ومتابعة تقدمهم، وتوفير الموارد والدروس التعليمية."]}),f.jsxs("li",{children:[f.jsx("span",{children:"تحسين وتطوير الموقع:"}),"وذلك من خلال تحليل البيانات المتعلقة بتفاعل الطلاب مع الموقع لتحسين تجربة المستخدم."]}),f.jsxs("li",{children:[f.jsx("span",{children:"التواصل مع الطلاب: "}),"نستخدم بيانات الاتصال للتواصل مع الطلاب بشأن مواعيد الدورات، وتحديثات البرامج، والمعلومات المهمة المتعلقة بالدورات أو الحسابات."]}),f.jsxs("li",{children:[f.jsx("span",{children:"أغراض تسويقية: "}),"قد يتم استخدام البريد الإلكتروني لإرسال رسائل حول دورات جديدة أو عروض خاصة؛ يمكن للطالب اختيار إلغاء الاشتراك في أي وقت."]})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"حماية المعلومات"}),f.jsx("p",{children:"نولي أهمية كبيرة لحماية معلوماتكم الشخصية. ونقوم بتطبيق عدة إجراءات أمنية وتقنية لضمان الحفاظ على سرية البيانات، بما في ذلك:"}),f.jsxs("li",{children:[f.jsx("span",{children:"التشفير:"}),"يتم تخزين البيانات الشخصية بشكل مشفر، مما يقلل من مخاطر الوصول غير المصرح به."]}),f.jsxs("li",{children:[f.jsx("span",{children:"القيود الداخلية: "}),"لا يتم السماح بالوصول إلى المعلومات الشخصية إلا للموظفين المخولين بذلك، والذين يحتاجون إليها لأداء مهامهم."]}),f.jsxs("li",{children:[f.jsx("span",{children:"مراجعات الأمان الدورية: "}),"نقوم بعمليات تدقيق دورية للتأكد من سلامة النظام وتقليل احتمالية تعرضه لأي اختراق."]})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"مشاركة المعلومات"}),f.jsx("p",{children:"نلتزم بعدم بيع أو تأجير أو تبادل المعلومات الشخصية للطلاب مع أي طرف ثالث، إلا في الحالات التالية:"}),f.jsxs("li",{children:[f.jsx("span",{children:"الامتثال للمتطلبات القانونية:"}),"قد نكون ملزمين بمشاركة بعض المعلومات إذا كانت هناك طلبات قانونية أو استدعاءات قضائية."]}),f.jsxs("li",{children:[f.jsx("span",{children:"حماية الحقوق والمصالح: "}),"في حالات استثنائية، قد نقوم بمشاركة المعلومات عند الحاجة لحماية حقوق الأكاديمية، أو المستخدمين، أو للحد من الاحتيال."]})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"حقوق المستخدمين"}),f.jsx("p",{children:"نحرص على احترام حقوق المستخدمين فيما يخص معلوماتهم الشخصية. لذلك، يتمتع الطلاب بالحقوق التالية:"}),f.jsxs("li",{children:[f.jsx("span",{children:"الحق في الوصول: "}),"يحق للطلاب طلب الوصول إلى المعلومات الشخصية الخاصة بهم التي قمنا بجمعها."]}),f.jsxs("li",{children:[f.jsx("span",{children:"الحق في التعديل والتصحيح: "}),"إذا كانت هناك معلومات غير دقيقة أو تحتاج إلى تحديث، يمكن للطالب طلب تصحيح البيانات."]}),f.jsxs("li",{children:[f.jsx("span",{children:"الحق في الحذف:"}),"يمكن للطلاب طلب حذف بياناتهم الشخصية إذا لم تعد هناك حاجة للاحتفاظ بها لأغراض قانونية أو تشغيلية."]}),f.jsxs("li",{children:[f.jsx("span",{children:"الحق في الاعتراض: "}),"يحق للطلاب الاعتراض على استخدام بياناتهم الشخصية في بعض الحالات، مثل الاستخدامات التسويقية."]}),f.jsx("p",{children:"يمكن للطلاب ممارسة هذه الحقوق عن طريق التواصل معنا عبر البريد الإلكتروني info@japaneseacademy.jp، وسنعمل على تلبية الطلبات في أقرب وقت ممكن."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"تخزين البيانات ومدة الاحتفاظ بها"}),f.jsx("p",{children:"نقوم بتخزين المعلومات الشخصية التي يتم جمعها من الطلاب طوال فترة استخدامهم لخدمات الأكاديمية. بمجرد إنهاء الحساب أو طلب حذف البيانات، يتم اتخاذ إجراءات لحذف المعلومات أو جعلها غير قابلة للتعرف. قد نحتفظ ببعض المعلومات الضرورية لفترة أطول وفقًا للمتطلبات القانونية أو لأغراض الأمان الداخلي."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"ملفات تعريف الارتباط (الكوكيز)"}),f.jsx("p",{children:"يستخدم موقع أكاديمية اللغة اليابانية ملفات تعريف الارتباط (Cookies) لتحسين تجربة المستخدم وتخصيص المحتوى. هذه الملفات هي عبارة عن بيانات صغيرة تُخزن على جهاز المستخدم عند زيارته للموقع وتساعد في:"}),f.jsxs("li",{children:[f.jsx("span",{children:"تذكر تفضيلات المستخدم: "}),"لتحسين تجربة التصفح من خلال تذكر إعدادات معينة."]}),f.jsxs("li",{children:[f.jsx("span",{children:"تحليل البيانات: "}),"لمساعدتنا في فهم كيفية استخدام الموقع، وبالتالي تحسين جودة الخدمات."]}),f.jsx("p",{children:"يمكن للمستخدم اختيار تعطيل ملفات تعريف الارتباط من إعدادات المتصفح، لكن قد يؤثر ذلك على بعض ميزات الموقع."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"الروابط الخارجية"}),f.jsx("p",{children:"قد يحتوي موقع أكاديمية اللغة اليابانية على روابط لمواقع خارجية. يرجى العلم أننا لسنا مسؤولين عن سياسة الخصوصية أو محتوى تلك المواقع، وننصح المستخدمين بقراءة سياسات الخصوصية الخاصة بالمواقع الأخرى قبل تقديم أي معلومات شخصية."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"تحديث سياسة الخصوصية"}),f.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بالحق في تعديل أو تحديث سياسة الخصوصية هذه من وقت لآخر. سيتم نشر أي تغييرات على هذه الصفحة مع تحديد تاريخ آخر تحديث. يُنصح المستخدمون بمراجعة هذه السياسة بشكل دوري لضمان موافقتهم على أي تغييرات."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"التواصل معنا"}),f.jsxs("p",{children:["إذا كان لديكم أي استفسارات أو مخاوف بشأن سياسة الخصوصية، أو إذا كنتم ترغبون في ممارسة أي من حقوقكم، يُرجى التواصل معنا عبر البريد الإلكتروني:",f.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:"info@japaneseacademy.jp"})]})]})]})]})})})}function sJ(){return f.jsx(f.Fragment,{})}function oJ(){const[l,a]=ie.useState([]);ie.useEffect(()=>{ci.get("https://api.japaneseacademy.online/allusers").then(h=>{a(h.data)}).catch(h=>{console.error("Error fetching students data:",h)})},[]);const d={"المستوى الاحترافي (N1)":[],"المستوى المتقدم جدًا (N2)":[],"المستوى المتقدم (N3)":[],"المستوى المتوسط (N4)":[],"المستوى المبتدئ (N5)":[]};return l.forEach(h=>{d[h.Level]&&d[h.Level].push(h)}),f.jsxs("div",{className:"App",children:[f.jsx("h1",{children:"بيانات الطلاب حسب المستوى"}),Object.keys(d).map(h=>f.jsxs("div",{children:[f.jsx("h2",{children:h}),f.jsx("div",{className:"cards-container",children:d[h].map(E=>f.jsx(aJ,{student:E},E.id))})]},h))]})}const aJ=({student:l})=>f.jsxs("div",{className:"card",children:[f.jsxs("h3",{children:[l.firstName," ",l.lastName]}),f.jsxs("p",{children:[f.jsx("strong",{children:"البلد:"})," ",l.country]}),f.jsxs("p",{children:[f.jsx("strong",{children:"العمر:"})," ",l.age]}),f.jsxs("p",{children:[f.jsx("strong",{children:"الجنس:"})," ",l.gender]}),f.jsxs("p",{children:[f.jsx("strong",{children:"المستوى:"})," ",l.Level]}),f.jsxs("p",{children:[f.jsx("strong",{children:"البريد الإلكتروني:"})," ",l.email]})]});var RV={exports:{}};(function(l,a){var d={};(function(h,E){l.exports=E()})(oj,function(){function h(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof d<"u"?d:typeof self<"u"?self:{};function T(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var R=function(e){try{return!!e()}catch{return!0}},N=!R(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),I=N,j=Function.prototype,M=j.call,F=I&&j.bind.bind(M,M),Y=I?F:function(e){return function(){return M.apply(e,arguments)}},Z=Y({}.isPrototypeOf),X=function(e){return e&&e.Math==Math&&e},q=X(typeof globalThis=="object"&&globalThis)||X(typeof window=="object"&&window)||X(typeof self=="object"&&self)||X(typeof E=="object"&&E)||function(){return this}()||E||Function("return this")(),re=N,se=Function.prototype,$=se.apply,Q=se.call,me=typeof Reflect=="object"&&Reflect.apply||(re?Q.bind($):function(){return Q.apply($,arguments)}),Ee=Y,Ue=Ee({}.toString),Oe=Ee("".slice),xe=function(e){return Oe(Ue(e),8,-1)},ye=xe,Le=Y,Ge=function(e){if(ye(e)==="Function")return Le(e)},Qe=typeof document=="object"&&document.all,We={all:Qe,IS_HTMLDDA:Qe===void 0&&Qe!==void 0},ht=We.all,Ze=We.IS_HTMLDDA?function(e){return typeof e=="function"||e===ht}:function(e){return typeof e=="function"},wn={},li=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ht=N,qt=Function.prototype.call,ft=Ht?qt.bind(qt):function(){return qt.apply(qt,arguments)},gr={},so={}.propertyIsEnumerable,Fu=Object.getOwnPropertyDescriptor,Cf=Fu&&!so.call({1:2},1);gr.f=Cf?function(e){var t=Fu(this,e);return!!t&&t.enumerable}:so;var ns,Ml,Ns=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ke=R,Bu=xe,Ul=Object,Gu=Y("".split),Sr=ke(function(){return!Ul("z").propertyIsEnumerable(0)})?function(e){return Bu(e)=="String"?Gu(e,""):Ul(e)}:Ul,is=function(e){return e==null},dS=is,jr=TypeError,oo=function(e){if(dS(e))throw jr("Can't call method on "+e);return e},rt=Sr,jl=oo,ao=function(e){return rt(jl(e))},uS=Ze,wf=We.all,Ki=We.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:uS(e)||e===wf}:function(e){return typeof e=="object"?e!==null:uS(e)},ir={},Hu=ir,Wu=q,Uc=Ze,Af=function(e){return Uc(e)?e:void 0},Yi=function(e,t){return arguments.length<2?Af(Hu[e])||Af(Wu[e]):Hu[e]&&Hu[e][t]||Wu[e]&&Wu[e][t]},co=typeof navigator<"u"&&String(navigator.userAgent)||"",If=q,Ku=co,Yu=If.process,Of=If.Deno,Ia=Yu&&Yu.versions||Of&&Of.version,Nf=Ia&&Ia.v8;Nf&&(Ml=(ns=Nf.split("."))[0]>0&&ns[0]<4?1:+(ns[0]+ns[1])),!Ml&&Ku&&(!(ns=Ku.match(/Edge\/(\d+)/))||ns[1]>=74)&&(ns=Ku.match(/Chrome\/(\d+)/))&&(Ml=+ns[1]);var Tr=Ml,Df=Tr,hS=R,pS=q.String,Oa=!!Object.getOwnPropertySymbols&&!hS(function(){var e=Symbol();return!pS(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Df&&Df<41}),Pf=Oa&&!Symbol.sham&&typeof Symbol.iterator=="symbol",fS=Yi,mS=Ze,_S=Z,ES=Object,jc=Pf?function(e){return typeof e=="symbol"}:function(e){var t=fS("Symbol");return mS(t)&&_S(t.prototype,ES(e))},gS=String,Ds=function(e){try{return gS(e)}catch{return"Object"}},SS=Ze,iA=Ds,lo=TypeError,zi=function(e){if(SS(e))return e;throw lo(iA(e)+" is not a function")},TS=zi,vS=is,Vl=function(e,t){var n=e[t];return vS(n)?void 0:TS(n)},Na=ft,Ho=Ze,Wo=Ki,Fl=TypeError,Lf={exports:{}},Bl=q,yS=Object.defineProperty,RS=function(e,t){try{yS(Bl,e,{value:t,configurable:!0,writable:!0})}catch{Bl[e]=t}return t},kf="__core-js_shared__",zu=q[kf]||RS(kf,{}),xf=zu;(Lf.exports=function(e,t){return xf[e]||(xf[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Da=Lf.exports,Mf=oo,Gl=Object,rs=function(e){return Gl(Mf(e))},bS=rs,CS=Y({}.hasOwnProperty),Kn=Object.hasOwn||function(e,t){return CS(bS(e),t)},wS=Y,Uf=0,jf=Math.random(),AS=wS(1 .toString),qu=function(e){return"Symbol("+(e===void 0?"":e)+")_"+AS(++Uf+jf,36)},IS=Da,Vf=Kn,OS=qu,NS=Oa,DS=Pf,Pa=q.Symbol,uo=IS("wks"),PS=DS?Pa.for||Pa:Pa&&Pa.withoutSetter||OS,hn=function(e){return Vf(uo,e)||(uo[e]=NS&&Vf(Pa,e)?Pa[e]:PS("Symbol."+e)),uo[e]},Vc=ft,Ff=Ki,Bf=jc,LS=Vl,kS=function(e,t){var n,i;if(Ho(n=e.toString)&&!Wo(i=Na(n,e))||Ho(n=e.valueOf)&&!Wo(i=Na(n,e)))return i;throw Fl("Can't convert object to primitive value")},xS=TypeError,MS=hn("toPrimitive"),$u=function(e,t){if(!Ff(e)||Bf(e))return e;var n,i=LS(e,MS);if(i){if(n=Vc(i,e,t),!Ff(n)||Bf(n))return n;throw xS("Can't convert object to primitive value")}return kS(e)},La=jc,Ko=function(e){var t=$u(e,"string");return La(t)?t:t+""},Gf=Ki,Ju=q.document,US=Gf(Ju)&&Gf(Ju.createElement),Xu=function(e){return US?Ju.createElement(e):{}},jS=Xu,Hf=!li&&!R(function(){return Object.defineProperty(jS("div"),"a",{get:function(){return 7}}).a!=7}),Qu=li,VS=ft,FS=gr,ka=Ns,Mi=ao,rr=Ko,sr=Kn,Ui=Hf,Fc=Object.getOwnPropertyDescriptor;wn.f=Qu?Fc:function(e,t){if(e=Mi(e),t=rr(t),Ui)try{return Fc(e,t)}catch{}if(sr(e,t))return ka(!VS(FS.f,e,t),e[t])};var xa=R,Yo=Ze,Ma=/#|\.prototype\./,Ua=function(e,t){var n=ja[Zu(e)];return n==eh||n!=Wf&&(Yo(t)?xa(t):!!t)},Zu=Ua.normalize=function(e){return String(e).replace(Ma,".").toLowerCase()},ja=Ua.data={},Wf=Ua.NATIVE="N",eh=Ua.POLYFILL="P",Hl=Ua,Kf=zi,Yf=N,zf=Ge(Ge.bind),Ps=function(e,t){return Kf(e),t===void 0?e:Yf?zf(e,t):function(){return e.apply(t,arguments)}},or={},th=li&&R(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),qf=Ki,$f=String,Jf=TypeError,Si=function(e){if(qf(e))return e;throw Jf($f(e)+" is not an object")},ss=li,ar=Hf,zo=th,ji=Si,Wl=Ko,BS=TypeError,nh=Object.defineProperty,ih=Object.getOwnPropertyDescriptor,vr="enumerable",Ls="configurable",Va="writable";or.f=ss?zo?function(e,t,n){if(ji(e),t=Wl(t),ji(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Va in n&&!n[Va]){var i=ih(e,t);i&&i[Va]&&(e[t]=n.value,n={configurable:Ls in n?n[Ls]:i[Ls],enumerable:vr in n?n[vr]:i[vr],writable:!1})}return nh(e,t,n)}:nh:function(e,t,n){if(ji(e),t=Wl(t),ji(n),ar)try{return nh(e,t,n)}catch{}if("get"in n||"set"in n)throw BS("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Fa=or,rh=Ns,ks=li?function(e,t,n){return Fa.f(e,t,rh(1,n))}:function(e,t,n){return e[t]=n,e},xs=q,sh=me,Xf=Ge,Ms=Ze,GS=wn.f,ho=Hl,Us=ir,Qf=Ps,Ba=ks,Ga=Kn,oh=function(e){var t=function(n,i,r){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,r)}return sh(e,this,arguments)};return t.prototype=e.prototype,t},_t=function(e,t){var n,i,r,s,o,c,u,p,m,_=e.target,g=e.global,v=e.stat,D=e.proto,C=g?xs:v?xs[_]:(xs[_]||{}).prototype,w=g?Us:Us[_]||Ba(Us,_,{})[_],P=w.prototype;for(s in t)i=!(n=ho(g?s:_+(v?".":"#")+s,e.forced))&&C&&Ga(C,s),c=w[s],i&&(u=e.dontCallGetSet?(m=GS(C,s))&&m.value:C[s]),o=i&&u?u:t[s],i&&typeof c==typeof o||(p=e.bind&&i?Qf(o,xs):e.wrap&&i?oh(o):D&&Ms(o)?Xf(o):o,(e.sham||o&&o.sham||c&&c.sham)&&Ba(p,"sham",!0),Ba(w,s,p),D&&(Ga(Us,r=_+"Prototype")||Ba(Us,r,{}),Ba(Us[r],s,o),e.real&&P&&(n||!P[s])&&Ba(P,s,o)))},HS=Math.ceil,Zf=Math.floor,em=Math.trunc||function(e){var t=+e;return(t>0?Zf:HS)(t)},tm=em,ah=function(e){var t=+e;return t!=t||t===0?0:tm(t)},WS=ah,KS=Math.max,nm=Math.min,po=function(e,t){var n=WS(e);return n<0?KS(n+t,0):nm(n,t)},YS=ah,zS=Math.min,ch=function(e){return e>0?zS(YS(e),9007199254740991):0},qS=ch,Vr=function(e){return qS(e.length)},Kl=ao,$S=po,lh=Vr,im=function(e){return function(t,n,i){var r,s=Kl(t),o=lh(s),c=$S(i,o);if(e&&n!=n){for(;o>c;)if((r=s[c++])!=r)return!0}else for(;o>c;c++)if((e||c in s)&&s[c]===n)return e||c||0;return!e&&-1}},Ha={includes:im(!0),indexOf:im(!1)},JS=Ha.includes;_t({target:"Array",proto:!0,forced:R(function(){return!Array(1).includes()})},{includes:function(e){return JS(this,e,arguments.length>1?arguments[1]:void 0)}});var rm=ir,qi=function(e){return rm[e+"Prototype"]},dh=qi("Array").includes,XS=Ki,QS=xe,uh=hn("match"),hh=function(e){var t;return XS(e)&&((t=e[uh])!==void 0?!!t:QS(e)=="RegExp")},Bc=hh,ph=TypeError,sm={};sm[hn("toStringTag")]="z";var Yl=String(sm)==="[object z]",ZS=Yl,eT=Ze,Gc=xe,Wa=hn("toStringTag"),tT=Object,nT=Gc(function(){return arguments}())=="Arguments",os=ZS?Gc:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(t=tT(e),Wa))=="string"?n:nT?Gc(t):(i=Gc(t))=="Object"&&eT(t.callee)?"Arguments":i},om=os,am=String,$i=function(e){if(om(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return am(e)},iT=hn("match"),cm=_t,rT=function(e){if(Bc(e))throw ph("The method doesn't accept regular expressions");return e},sT=oo,fh=$i,oT=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[iT]=!1,"/./"[e](t)}catch{}}return!1},mh=Y("".indexOf);cm({target:"String",proto:!0,forced:!oT("includes")},{includes:function(e){return!!~mh(fh(sT(this)),fh(rT(e)),arguments.length>1?arguments[1]:void 0)}});var aT=qi("String").includes,lm=Z,dm=dh,cT=aT,_h=Array.prototype,Eh=String.prototype,lT=function(e){var t=e.includes;return e===_h||lm(_h,e)&&t===_h.includes?dm:typeof e=="string"||e===Eh||lm(Eh,e)&&t===Eh.includes?cT:t},ge=T(lT),dT=zi,uT=rs,hT=Sr,um=Vr,hm=TypeError,Hc=function(e){return function(t,n,i,r){dT(n);var s=uT(t),o=hT(s),c=um(s),u=e?c-1:0,p=e?-1:1;if(i<2)for(;;){if(u in o){r=o[u],u+=p;break}if(u+=p,e?u<0:c<=u)throw hm("Reduce of empty array with no initial value")}for(;e?u>=0:c>u;u+=p)u in o&&(r=n(r,o[u],u,s));return r}},pT={left:Hc(!1),right:Hc(!0)},fT=R,zl=function(e,t){var n=[][e];return!!n&&fT(function(){n.call(null,t||function(){return 1},1)})},Ka=typeof process<"u"&&xe(process)=="process",gh=pT.left;_t({target:"Array",proto:!0,forced:!Ka&&Tr>79&&Tr<83||!zl("reduce")},{reduce:function(e){var t=arguments.length;return gh(this,e,t,t>1?arguments[1]:void 0)}});var pm=qi("Array").reduce,fm=Z,rA=pm,js=Array.prototype,Sh=function(e){var t=e.reduce;return e===js||fm(js,e)&&t===js.reduce?rA:t},mm=Sh,yr=T(mm);let _m=!0,Th=!0;function ql(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function qo(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,c){if(o!==t)return r.apply(this,arguments);const u=p=>{const m=n(p);m&&(c.handleEvent?c.handleEvent(m):c(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,u),r.apply(this,[o,u])};const s=i.removeEventListener;i.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const u=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,u])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function mT(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(_m=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function _T(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Th=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Em(){if(typeof window=="object"){if(_m)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function $l(e,t){Th&&console.warn(e+" is deprecated, please use "+t+" instead.")}function vh(e){return Object.prototype.toString.call(e)==="[object Object]"}function gm(e){var t;return vh(e)?yr(t=Object.keys(e)).call(t,function(n,i){const r=vh(e[i]),s=r?gm(e[i]):e[i],o=r&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[i]:s})},{}):e}function fo(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?fo(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(r=>{fo(e,e.get(r),n)})}))}function Sm(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(t===null)return r;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(c=>{c.type===i&&c.trackId===o.id&&fo(e,c,r)})}),r}var ET=qu,Tm=Da("keys"),Jl=function(e){return Tm[e]||(Tm[e]=ET(e))},gT=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),$o=Kn,ST=Ze,Xl=rs,TT=gT,vm=Jl("IE_PROTO"),yh=Object,vT=yh.prototype,Rh=TT?yh.getPrototypeOf:function(e){var t=Xl(e);if($o(t,vm))return t[vm];var n=t.constructor;return ST(n)&&t instanceof n?n.prototype:t instanceof yh?vT:null},yT=Y,RT=zi,bT=Ze,CT=String,wT=TypeError,AT=function(e,t,n){try{return yT(RT(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},IT=Si,OT=function(e){if(typeof e=="object"||bT(e))return e;throw wT("Can't set "+CT(e)+" as a prototype")},Fr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=AT(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,r){return IT(i),OT(r),t?e(i,r):i.__proto__=r,i}}():void 0),Wc={},Ql={},Zl=Kn,ym=ao,NT=Ha.indexOf,DT=Ql,bh=Y([].push),Rm=function(e,t){var n,i=ym(e),r=0,s=[];for(n in i)!Zl(DT,n)&&Zl(i,n)&&bh(s,n);for(;t.length>r;)Zl(i,n=t[r++])&&(~NT(s,n)||bh(s,n));return s},bm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ed=Rm,PT=bm.concat("length","prototype");Wc.f=Object.getOwnPropertyNames||function(e){return ed(e,PT)};var Kc={};Kc.f=Object.getOwnPropertySymbols;var LT=Yi,kT=Wc,Cm=Kc,xT=Si,MT=Y([].concat),wm=LT("Reflect","ownKeys")||function(e){var t=kT.f(xT(e)),n=Cm.f;return n?MT(t,n(e)):t},Ch=Kn,Am=wm,td=wn,Im=or,Yc={},UT=Rm,sA=bm,Vi=Object.keys||function(e){return UT(e,sA)},jT=li,VT=th,FT=or,BT=Si,Om=ao,Nm=Vi;Yc.f=jT&&!VT?Object.defineProperties:function(e,t){BT(e);for(var n,i=Om(t),r=Nm(t),s=r.length,o=0;s>o;)FT.f(e,n=r[o++],i[n]);return e};var nd,Dm=Yi("document","documentElement"),GT=Si,HT=Yc,Pm=bm,WT=Ql,Lm=Dm,KT=Xu,id="prototype",zc="script",km=Jl("IE_PROTO"),wh=function(){},xm=function(e){return"<"+zc+">"+e+"</"+zc+">"},Mm=function(e){e.write(xm("")),e.close();var t=e.parentWindow.Object;return e=null,t},rd=function(){try{nd=new ActiveXObject("htmlfile")}catch{}var e,t,n;rd=typeof document<"u"?document.domain&&nd?Mm(nd):(t=KT("iframe"),n="java"+zc+":",t.style.display="none",Lm.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(xm("document.F=Object")),e.close(),e.F):Mm(nd);for(var i=Pm.length;i--;)delete rd[id][Pm[i]];return rd()};WT[km]=!0;var qc=Object.create||function(e,t){var n;return e!==null?(wh[id]=GT(e),n=new wh,wh[id]=null,n[km]=e):n=rd(),t===void 0?n:HT.f(n,t)},Jo=Ki,YT=ks,zT=Error,Vs=Y("".replace),Um=String(zT("zxcasd").stack),jm=/\n\s*at [^:]*:[^\n]*/,qT=jm.test(Um),Vm=Ns,Fm=!R(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Vm(1,7)),e.stack!==7)}),Bm=ks,$T=function(e,t){if(qT&&typeof e=="string"&&!zT.prepareStackTrace)for(;t--;)e=Vs(e,jm,"");return e},Gm=Fm,Hm=Error.captureStackTrace,Xo={},JT=Xo,Wm=hn("iterator"),Km=Array.prototype,Ym=function(e){return e!==void 0&&(JT.Array===e||Km[Wm]===e)},XT=os,zm=Vl,QT=is,ZT=Xo,ev=hn("iterator"),Rr=function(e){if(!QT(e))return zm(e,ev)||zm(e,"@@iterator")||ZT[XT(e)]},oA=ft,qm=zi,tv=Si,nv=Ds,iv=Rr,rv=TypeError,Ah=function(e,t){var n=arguments.length<2?iv(e):t;if(qm(n))return tv(oA(n,e));throw rv(nv(e)+" is not iterable")},sv=ft,$m=Si,ov=Vl,Jm=function(e,t,n){var i,r;$m(e);try{if(!(i=ov(e,"return"))){if(t==="throw")throw n;return n}i=sv(i,e)}catch(s){r=!0,i=s}if(t==="throw")throw n;if(r)throw i;return $m(i),n},av=Ps,cv=ft,Ih=Si,lv=Ds,sd=Ym,dv=Vr,Oh=Z,Xm=Ah,$c=Rr,od=Jm,uv=TypeError,ad=function(e,t){this.stopped=e,this.result=t},Qm=ad.prototype,Jc=function(e,t,n){var i,r,s,o,c,u,p,m=n&&n.that,_=!(!n||!n.AS_ENTRIES),g=!(!n||!n.IS_RECORD),v=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),C=av(t,m),w=function(L){return i&&od(i,"normal",L),new ad(!0,L)},P=function(L){return _?(Ih(L),D?C(L[0],L[1],w):C(L[0],L[1])):D?C(L,w):C(L)};if(g)i=e.iterator;else if(v)i=e;else{if(!(r=$c(e)))throw uv(lv(e)+" is not iterable");if(sd(r)){for(s=0,o=dv(e);o>s;s++)if((c=P(e[s]))&&Oh(Qm,c))return c;return new ad(!1)}i=Xm(e,r)}for(u=g?e.next:i.next;!(p=cv(u,i)).done;){try{c=P(p.value)}catch(L){od(i,"throw",L)}if(typeof c=="object"&&c&&Oh(Qm,c))return c}return new ad(!1)},hv=$i,pv=_t,fv=Z,mv=Rh,cd=Fr,_v=function(e,t,n){for(var i=Am(t),r=Im.f,s=td.f,o=0;o<i.length;o++){var c=i[o];Ch(e,c)||n&&Ch(n,c)||r(e,c,s(t,c))}},Zm=qc,Nh=ks,Dh=Ns,Ev=function(e,t){Jo(t)&&"cause"in t&&YT(e,"cause",t.cause)},gv=function(e,t,n,i){Gm&&(Hm?Hm(e,t):Bm(e,"stack",$T(n,i)))},Qo=Jc,Sv=function(e,t){return e===void 0?arguments.length<2?"":t:hv(e)},Tv=hn("toStringTag"),ld=Error,vv=[].push,Ya=function(e,t){var n,i=fv(za,this);cd?n=cd(ld(),i?mv(this):za):(n=i?this:Zm(za),Nh(n,Tv,"Error")),t!==void 0&&Nh(n,"message",Sv(t)),gv(n,Ya,n.stack,1),arguments.length>2&&Ev(n,arguments[2]);var r=[];return Qo(e,vv,{that:r}),Nh(n,"errors",r),n};cd?cd(Ya,ld):_v(Ya,ld,{name:!0});var za=Ya.prototype=Zm(ld.prototype,{constructor:Dh(1,Ya),message:Dh(1,""),name:Dh(1,"AggregateError")});pv({global:!0,constructor:!0,arity:2},{AggregateError:Ya});var dd,ud,qa,yv=Ze,e_=q.WeakMap,t_=yv(e_)&&/native code/.test(String(e_)),n_=q,Rv=Ki,$a=ks,Ph=Kn,Xc=zu,bv=Jl,i_=Ql,Cv="Object already initialized",r_=n_.TypeError,wv=n_.WeakMap;if(t_||Xc.state){var as=Xc.state||(Xc.state=new wv);as.get=as.get,as.has=as.has,as.set=as.set,dd=function(e,t){if(as.has(e))throw r_(Cv);return t.facade=e,as.set(e,t),t},ud=function(e){return as.get(e)||{}},qa=function(e){return as.has(e)}}else{var Ja=bv("state");i_[Ja]=!0,dd=function(e,t){if(Ph(e,Ja))throw r_(Cv);return t.facade=e,$a(e,Ja,t),t},ud=function(e){return Ph(e,Ja)?e[Ja]:{}},qa=function(e){return Ph(e,Ja)}}var Zo,s_,Xa,ea={set:dd,get:ud,has:qa,enforce:function(e){return qa(e)?ud(e):dd(e,{})},getterFor:function(e){return function(t){var n;if(!Rv(t)||(n=ud(t)).type!==e)throw r_("Incompatible receiver, "+e+" required");return n}}},o_=li,ta=Kn,a_=Function.prototype,Av=o_&&Object.getOwnPropertyDescriptor,Lh=ta(a_,"name"),c_={EXISTS:Lh,PROPER:Lh&&(function(){}).name==="something",CONFIGURABLE:Lh&&(!o_||o_&&Av(a_,"name").configurable)},Iv=ks,mo=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Iv(e,t,n),e},Ov=R,Nv=Ze,l_=Ki,Dv=qc,kh=Rh,xh=mo,hd=hn("iterator"),_o=!1;[].keys&&("next"in(Xa=[].keys())?(s_=kh(kh(Xa)))!==Object.prototype&&(Zo=s_):_o=!0);var d_=!l_(Zo)||Ov(function(){var e={};return Zo[hd].call(e)!==e});Nv((Zo=d_?{}:Dv(Zo))[hd])||xh(Zo,hd,function(){return this});var pd={IteratorPrototype:Zo,BUGGY_SAFARI_ITERATORS:_o},Pv=os,u_=Yl?{}.toString:function(){return"[object "+Pv(this)+"]"},Lv=Yl,Mh=or.f,kv=ks,xv=Kn,Mv=u_,Uh=hn("toStringTag"),cs=function(e,t,n,i){if(e){var r=n?e:e.prototype;xv(r,Uh)||Mh(r,Uh,{configurable:!0,value:t}),i&&!Lv&&kv(r,"toString",Mv)}},Uv=pd.IteratorPrototype,na=qc,jv=Ns,aA=cs,Eo=Xo,Vv=function(){return this},jh=function(e,t,n,i){var r=t+" Iterator";return e.prototype=na(Uv,{next:jv(+!i,n)}),aA(e,r,!1,!0),Eo[r]=Vv,e},Fv=_t,Bv=ft,Gv=c_,Hv=jh,Wv=Rh,Kv=cs,h_=mo,Vh=Xo,fd=pd,md=Gv.PROPER,_d=fd.BUGGY_SAFARI_ITERATORS,Fh=hn("iterator"),Qa="keys",Bh="values",x="entries",S=function(){return this},A=function(e,t,n,i,r,s,o){Hv(n,t,i);var c,u,p,m=function(P){if(P===r&&C)return C;if(!_d&&P in v)return v[P];switch(P){case Qa:case Bh:case x:return function(){return new n(this,P)}}return function(){return new n(this)}},_=t+" Iterator",g=!1,v=e.prototype,D=v[Fh]||v["@@iterator"]||r&&v[r],C=!_d&&D||m(r),w=t=="Array"&&v.entries||D;if(w&&(c=Wv(w.call(new e)))!==Object.prototype&&c.next&&(Kv(c,_,!0,!0),Vh[_]=S),md&&r==Bh&&D&&D.name!==Bh&&(g=!0,C=function(){return Bv(D,this)}),r)if(u={values:m(Bh),keys:s?C:m(Qa),entries:m(x)},o)for(p in u)(_d||g||!(p in v))&&h_(v,p,u[p]);else Fv({target:t,proto:!0,forced:_d||g},u);return o&&v[Fh]!==C&&h_(v,Fh,C,{name:r}),Vh[t]=C,u},B=function(e,t){return{value:e,done:t}},J=ao,le=Xo,he=ea;or.f;var be=A,Me=B,Je="Array Iterator",je=he.set,It=he.getterFor(Je);be(Array,"Array",function(e,t){je(this,{type:Je,target:J(e),index:0,kind:t})},function(){var e=It(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,Me(void 0,!0)):Me(n=="keys"?i:n=="values"?t[i]:[i,t[i]],!1)},"values"),le.Arguments=le.Array;var xt=or,mt=function(e,t,n){return xt.f(e,t,n)},An=Yi,Mt=mt,Qt=li,In=hn("species"),Yn=Z,zn=TypeError,Ut=function(e,t){if(Yn(t,e))return e;throw zn("Incorrect invocation")},pn=Ze,sn=zu,Gn=Y(Function.toString);pn(sn.inspectSource)||(sn.inspectSource=function(e){return Gn(e)});var mi=sn.inspectSource,_i=Y,di=R,Ti=Ze,Br=os,Fi=mi,go=function(){},ia=[],Ji=Yi("Reflect","construct"),cr=/^\s*(?:class|function)\b/,Ed=_i(cr.exec),ra=!cr.exec(go),So=function(e){if(!Ti(e))return!1;try{return Ji(go,ia,e),!0}catch{return!1}},gd=function(e){if(!Ti(e))return!1;switch(Br(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ra||!!Ed(cr,Fi(e))}catch{return!0}};gd.sham=!0;var Fs,Bs,sa,ls,To=!Ji||di(function(){var e;return So(So.call)||!So(Object)||!So(function(){e=!0})||e})?gd:So,Sd=To,oa=Ds,Gh=TypeError,p_=Si,Hh=function(e){if(Sd(e))return e;throw Gh(oa(e)+" is not a constructor")},Yv=is,f_=hn("species"),Wh=function(e,t){var n,i=p_(e).constructor;return i===void 0||Yv(n=p_(i)[f_])?t:Hh(n)},Td=Y([].slice),m_=TypeError,aa=function(e,t){if(e<t)throw m_("Not enough arguments");return e},__=/(?:ipad|iphone|ipod).*applewebkit/i.test(co),lr=q,ca=me,vd=Ps,Kh=Ze,E_=Kn,yd=R,Yh=Dm,g_=Td,zh=Xu,S_=aa,mF=__,_F=Ka,zv=lr.setImmediate,qv=lr.clearImmediate,EF=lr.process,$v=lr.Dispatch,gF=lr.Function,cA=lr.MessageChannel,SF=lr.String,Jv=0,qh={},lA="onreadystatechange";yd(function(){Fs=lr.location});var Xv=function(e){if(E_(qh,e)){var t=qh[e];delete qh[e],t()}},Qv=function(e){return function(){Xv(e)}},dA=function(e){Xv(e.data)},uA=function(e){lr.postMessage(SF(e),Fs.protocol+"//"+Fs.host)};zv&&qv||(zv=function(e){S_(arguments.length,1);var t=Kh(e)?e:gF(e),n=g_(arguments,1);return qh[++Jv]=function(){ca(t,void 0,n)},Bs(Jv),Jv},qv=function(e){delete qh[e]},_F?Bs=function(e){EF.nextTick(Qv(e))}:$v&&$v.now?Bs=function(e){$v.now(Qv(e))}:cA&&!mF?(ls=(sa=new cA).port2,sa.port1.onmessage=dA,Bs=vd(ls.postMessage,ls)):lr.addEventListener&&Kh(lr.postMessage)&&!lr.importScripts&&Fs&&Fs.protocol!=="file:"&&!yd(uA)?(Bs=uA,lr.addEventListener("message",dA,!1)):Bs=lA in zh("script")?function(e){Yh.appendChild(zh("script"))[lA]=function(){Yh.removeChild(this),Xv(e)}}:function(e){setTimeout(Qv(e),0)});var T_={set:zv,clear:qv},hA=function(){this.head=null,this.tail=null};hA.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Rd,Zv,ey,ty,pA,fA=hA,TF=/ipad|iphone|ipod/i.test(co)&&typeof Pebble<"u",vF=/web0s(?!.*chrome)/i.test(co),Qc=q,mA=Ps,yF=wn.f,ny=T_.set,RF=fA,bF=__,CF=TF,wF=vF,iy=Ka,_A=Qc.MutationObserver||Qc.WebKitMutationObserver,EA=Qc.document,gA=Qc.process,v_=Qc.Promise,SA=yF(Qc,"queueMicrotask"),ry=SA&&SA.value;if(!ry){var y_=new RF,R_=function(){var e,t;for(iy&&(e=gA.domain)&&e.exit();t=y_.get();)try{t()}catch(n){throw y_.head&&Rd(),n}e&&e.enter()};bF||iy||wF||!_A||!EA?!CF&&v_&&v_.resolve?((ty=v_.resolve(void 0)).constructor=v_,pA=mA(ty.then,ty),Rd=function(){pA(R_)}):iy?Rd=function(){gA.nextTick(R_)}:(ny=mA(ny,Qc),Rd=function(){ny(R_)}):(Zv=!0,ey=EA.createTextNode(""),new _A(R_).observe(ey,{characterData:!0}),Rd=function(){ey.data=Zv=!Zv}),ry=function(e){y_.head||Rd(),y_.add(e)}}var TA=ry,bd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Zc=q.Promise,vA=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",AF=!vA&&!Ka&&typeof window=="object"&&typeof document=="object",IF=q,$h=Zc,OF=Ze,NF=Hl,DF=mi,PF=hn,LF=AF,kF=vA,sy=Tr,yA=$h&&$h.prototype,xF=PF("species"),RA=!1,bA=OF(IF.PromiseRejectionEvent),MF=NF("Promise",function(){var e=DF($h),t=e!==String($h);if(!t&&sy===66||!yA.catch||!yA.finally)return!0;if(!sy||sy<51||!/native code/.test(e)){var n=new $h(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[xF]=i,!(RA=n.then(function(){})instanceof i))return!0}return!t&&(LF||kF)&&!bA}),Jh={CONSTRUCTOR:MF,REJECTION_EVENT:bA,SUBCLASSING:RA},vo={},CA=zi,UF=TypeError,jF=function(e){var t,n;this.promise=new e(function(i,r){if(t!==void 0||n!==void 0)throw UF("Bad Promise constructor");t=i,n=r}),this.resolve=CA(t),this.reject=CA(n)};vo.f=function(e){return new jF(e)};var oy,wA,VF=_t,b_=Ka,Za=q,Xh=ft,FF=mo,BF=cs,GF=function(e){var t=An(e);Qt&&t&&!t[In]&&Mt(t,In,{configurable:!0,get:function(){return this}})},HF=zi,ay=Ze,WF=Ki,KF=Ut,YF=Wh,AA=T_.set,cy=TA,zF=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},qF=bd,$F=fA,IA=ea,ly=Zc,OA=Jh,NA=vo,C_="Promise",DA=OA.CONSTRUCTOR,JF=OA.REJECTION_EVENT,dy=IA.getterFor(C_),XF=IA.set,QF=ly&&ly.prototype,Qh=ly,uy=QF,PA=Za.TypeError,hy=Za.document,py=Za.process,fy=NA.f,ZF=fy,e4=!!(hy&&hy.createEvent&&Za.dispatchEvent),LA="unhandledrejection",kA=function(e){var t;return!(!WF(e)||!ay(t=e.then))&&t},xA=function(e,t){var n,i,r,s=t.value,o=t.state==1,c=o?e.ok:e.fail,u=e.resolve,p=e.reject,m=e.domain;try{c?(o||(t.rejection===2&&n4(t),t.rejection=1),c===!0?n=s:(m&&m.enter(),n=c(s),m&&(m.exit(),r=!0)),n===e.promise?p(PA("Promise-chain cycle")):(i=kA(n))?Xh(i,n,u,p):u(n)):p(s)}catch(_){m&&!r&&m.exit(),p(_)}},MA=function(e,t){e.notified||(e.notified=!0,cy(function(){for(var n,i=e.reactions;n=i.get();)xA(n,e);e.notified=!1,t&&!e.rejection&&t4(e)}))},UA=function(e,t,n){var i,r;e4?((i=hy.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Za.dispatchEvent(i)):i={promise:t,reason:n},!JF&&(r=Za["on"+e])?r(i):e===LA&&zF("Unhandled promise rejection",n)},t4=function(e){Xh(AA,Za,function(){var t,n=e.facade,i=e.value;if(jA(e)&&(t=qF(function(){b_?py.emit("unhandledRejection",i,n):UA(LA,n,i)}),e.rejection=b_||jA(e)?2:1,t.error))throw t.value})},jA=function(e){return e.rejection!==1&&!e.parent},n4=function(e){Xh(AA,Za,function(){var t=e.facade;b_?py.emit("rejectionHandled",t):UA("rejectionhandled",t,e.value)})},Cd=function(e,t,n){return function(i){e(t,i,n)}},wd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,MA(e,!0))},my=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw PA("Promise can't be resolved itself");var i=kA(t);i?cy(function(){var r={done:!1};try{Xh(i,t,Cd(my,r,e),Cd(wd,r,e))}catch(s){wd(r,s,e)}}):(e.value=t,e.state=1,MA(e,!1))}catch(r){wd({done:!1},r,e)}}};DA&&(uy=(Qh=function(e){KF(this,uy),HF(e),Xh(oy,this);var t=dy(this);try{e(Cd(my,t),Cd(wd,t))}catch(n){wd(t,n)}}).prototype,(oy=function(e){XF(this,{type:C_,done:!1,notified:!1,parent:!1,reactions:new $F,rejection:!1,state:0,value:void 0})}).prototype=FF(uy,"then",function(e,t){var n=dy(this),i=fy(YF(this,Qh));return n.parent=!0,i.ok=!ay(e)||e,i.fail=ay(t)&&t,i.domain=b_?py.domain:void 0,n.state==0?n.reactions.add(i):cy(function(){xA(i,n)}),i.promise}),wA=function(){var e=new oy,t=dy(e);this.promise=e,this.resolve=Cd(my,t),this.reject=Cd(wd,t)},NA.f=fy=function(e){return e===Qh||e===void 0?new wA(e):ZF(e)}),VF({global:!0,constructor:!0,wrap:!0,forced:DA},{Promise:Qh}),BF(Qh,C_,!1,!0),GF(C_);var VA=hn("iterator"),FA=!1;try{var i4=0,BA={next:function(){return{done:!!i4++}},return:function(){FA=!0}};BA[VA]=function(){return this},Array.from(BA,function(){throw 2})}catch{}var r4=Zc,s4=function(e,t){if(!FA)return!1;var n=!1;try{var i={};i[VA]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},w_=Jh.CONSTRUCTOR||!s4(function(e){r4.all(e).then(void 0,function(){})}),o4=ft,a4=zi,c4=vo,l4=bd,d4=Jc;_t({target:"Promise",stat:!0,forced:w_},{all:function(e){var t=this,n=c4.f(t),i=n.resolve,r=n.reject,s=l4(function(){var o=a4(t.resolve),c=[],u=0,p=1;d4(e,function(m){var _=u++,g=!1;p++,o4(o,t,m).then(function(v){g||(g=!0,c[_]=v,--p||i(c))},r)}),--p||i(c)});return s.error&&r(s.value),n.promise}});var u4=_t,h4=Jh.CONSTRUCTOR;Zc&&Zc.prototype,u4({target:"Promise",proto:!0,forced:h4,real:!0},{catch:function(e){return this.then(void 0,e)}});var p4=ft,f4=zi,m4=vo,_4=bd,E4=Jc;_t({target:"Promise",stat:!0,forced:w_},{race:function(e){var t=this,n=m4.f(t),i=n.reject,r=_4(function(){var s=f4(t.resolve);E4(e,function(o){p4(s,t,o).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var g4=ft,S4=vo;_t({target:"Promise",stat:!0,forced:Jh.CONSTRUCTOR},{reject:function(e){var t=S4.f(this);return g4(t.reject,void 0,e),t.promise}});var T4=Si,v4=Ki,y4=vo,GA=function(e,t){if(T4(e),v4(t)&&t.constructor===e)return t;var n=y4.f(e);return(0,n.resolve)(t),n.promise},R4=_t,b4=Zc,C4=Jh.CONSTRUCTOR,w4=GA,A4=Yi("Promise"),I4=!C4;R4({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return w4(I4&&this===A4?b4:this,e)}});var O4=ft,N4=zi,D4=vo,P4=bd,L4=Jc;_t({target:"Promise",stat:!0,forced:w_},{allSettled:function(e){var t=this,n=D4.f(t),i=n.resolve,r=n.reject,s=P4(function(){var o=N4(t.resolve),c=[],u=0,p=1;L4(e,function(m){var _=u++,g=!1;p++,O4(o,t,m).then(function(v){g||(g=!0,c[_]={status:"fulfilled",value:v},--p||i(c))},function(v){g||(g=!0,c[_]={status:"rejected",reason:v},--p||i(c))})}),--p||i(c)});return s.error&&r(s.value),n.promise}});var k4=ft,x4=zi,M4=Yi,U4=vo,j4=bd,V4=Jc,HA="No one promise resolved";_t({target:"Promise",stat:!0,forced:w_},{any:function(e){var t=this,n=M4("AggregateError"),i=U4.f(t),r=i.resolve,s=i.reject,o=j4(function(){var c=x4(t.resolve),u=[],p=0,m=1,_=!1;V4(e,function(g){var v=p++,D=!1;m++,k4(c,t,g).then(function(C){D||_||(_=!0,r(C))},function(C){D||_||(D=!0,u[v]=C,--m||s(new n(u,HA)))})}),--m||s(new n(u,HA))});return o.error&&s(o.value),i.promise}});var F4=_t,_y=Zc,B4=R,G4=Yi,H4=Ze,W4=Wh,WA=GA,K4=_y&&_y.prototype;F4({target:"Promise",proto:!0,real:!0,forced:!!_y&&B4(function(){K4.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=W4(this,G4("Promise")),n=H4(e);return this.then(n?function(i){return WA(t,e()).then(function(){return i})}:e,n?function(i){return WA(t,e()).then(function(){throw i})}:e)}});var Ey=Y,Y4=ah,z4=$i,q4=oo,$4=Ey("".charAt),KA=Ey("".charCodeAt),J4=Ey("".slice),YA=function(e){return function(t,n){var i,r,s=z4(q4(t)),o=Y4(n),c=s.length;return o<0||o>=c?e?"":void 0:(i=KA(s,o))<55296||i>56319||o+1===c||(r=KA(s,o+1))<56320||r>57343?e?$4(s,o):i:e?J4(s,o,o+2):r-56320+(i-55296<<10)+65536}},gy={codeAt:YA(!1),charAt:YA(!0)},X4=gy.charAt,Q4=$i,zA=ea,Z4=A,qA=B,$A="String Iterator",eB=zA.set,tB=zA.getterFor($A);Z4(String,"String",function(e){eB(this,{type:$A,string:Q4(e),index:0})},function(){var e,t=tB(this),n=t.string,i=t.index;return i>=n.length?qA(void 0,!0):(e=X4(n,i),t.index+=e.length,qA(e,!1))});var nB=ir.Promise,iB={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},rB=q,sB=os,oB=ks,JA=Xo,XA=hn("toStringTag");for(var Sy in iB){var QA=rB[Sy],Ty=QA&&QA.prototype;Ty&&sB(Ty)!==XA&&oB(Ty,XA,Sy),JA[Sy]=JA.Array}var ZA=nB,ve=T(ZA);const eI=Em;function tI(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof o[u]=="object"?o[u]:{ideal:o[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(_,g){return _?_+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(p.ideal!==void 0){c.optional=c.optional||[];let _={};typeof p.ideal=="number"?(_[m("min",u)]=p.ideal,c.optional.push(_),_={},_[m("max",u)]=p.ideal,c.optional.push(_)):(_[m("",u)]=p.ideal,c.optional.push(_))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[m("",u)]=p.exact):["min","max"].forEach(_=>{p[_]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[m(_,u)]=p[_])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},r=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const u=function(p,m,_){m in p&&!(_ in p)&&(p[_]=p[m],delete p[m])};u((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),u(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let u=o.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete o.video.facingMode,u.exact==="environment"||u.ideal==="environment"?m=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(_=>{let g=(_=_.filter(v=>v.kind==="videoinput")).find(v=>m.some(D=>{var C;return ge(C=v.label.toLowerCase()).call(C,D)}));return!g&&_.length&&ge(m).call(m,"back")&&(g=_[_.length-1]),g&&(o.video.deviceId=u.exact?{exact:g.deviceId}:{ideal:g.deviceId}),o.video=i(o.video),eI("chrome: "+JSON.stringify(o)),c(o)})}o.video=i(o.video)}return eI("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,u){r(o,p=>{n.webkitGetUserMedia(p,c,m=>{u&&u(s(m))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,u=>o(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>ve.reject(s(p))))}}}function nI(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function iI(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else qo(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function rI(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let u=r.apply(this,arguments);return u||(u=t(this,o),this._senders.push(u)),u};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function sI(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const u={};return c.result().forEach(p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(_=>{m[_]=p.stat(_)}),u[m.id]=m}),u},o=function(c){return new Map(Object.keys(c).map(u=>[u,c[u]]))};if(arguments.length>=2){const c=function(u){i(o(s(u)))};return t.apply(this,[c,n])}return new ve((c,u)=>{t.apply(this,[function(p){c(o(s(p)))},u])}).then(i,r)}}function oI(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>Sm(s,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),qo(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>Sm(r,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(o=>{o.track===n&&(i?s=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===n&&(r?s=!0:r=o),o.track===n)),s||i&&r?ve.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():ve.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function aI(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(u=>{if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>o.indexOf(u)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),r.apply(this,arguments)}}function cI(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return aI(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(_=>_.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new e.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}i.apply(this,[u])};const r=e.RTCPeerConnection.prototype.removeStream;function s(u,p){let m=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{const g=u._reverseStreams[_],v=u._streams[g.id];m=m.replace(new RegExp(v.id,"g"),g.id)}),new RTCSessionDescription({type:p.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[p.id];if(g)g.addTrack(u),ve.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new e.MediaStream([u]);this._streams[p.id]=v,this._reverseStreams[v.id]=p,this.addStream(v)}return this.getSenders().find(v=>v.track===u)},["createOffer","createAnswer"].forEach(function(u){const p=e.RTCPeerConnection.prototype[u],m={[u](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[g=>{const v=s(this,g);_[0].apply(null,[v])},g=>{_[1]&&_[1].apply(null,g)},arguments[2]]):p.apply(this,arguments).then(g=>s(this,g))}};e.RTCPeerConnection.prototype[u]=m[u]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,p){let m=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{const g=u._reverseStreams[_],v=u._streams[g.id];m=m.replace(new RegExp(g.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:m})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:s(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(_=>u.track===_)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vy(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=r[n]})}function lI(e,t){qo(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var dI=Object.freeze({__proto__:null,fixNegotiationNeeded:lI,shimAddTrackRemoveTrack:cI,shimAddTrackRemoveTrackWithNative:aI,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:rI,shimGetStats:sI,shimGetUserMedia:tI,shimMediaStream:nI,shimOnTrack:iI,shimPeerConnection:vy,shimSenderReceiverGetStats:oI});function uI(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){$l("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,c,u){c in o&&!(u in o)&&(o[u]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const c=o.apply(this,arguments);return r(c,"mozAutoGainControl","autoGainControl"),r(c,"mozNoiseSuppression","noiseSuppression"),c}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c,"autoGainControl","mozAutoGainControl"),r(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function hI(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yy(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=e.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,s,o]=arguments;return i.apply(this,[r||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((p,m)=>{c.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(s,o)}}function pI(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ve.resolve(new Map)}}function fI(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),qo(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function mI(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){$l("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&ge(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function _I(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function EI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(i){const{sender:s}=r,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function gI(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function SI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function TI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var vI=Object.freeze({__proto__:null,shimAddTransceiver:EI,shimCreateAnswer:TI,shimCreateOffer:SI,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,ve.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:gI,shimGetUserMedia:uI,shimOnTrack:hI,shimPeerConnection:yy,shimRTCDataChannel:_I,shimReceiverGetStats:fI,shimRemoveStream:mI,shimSenderGetStats:pI});function yI(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),ge(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>t.call(this,r,n)),n.getVideoTracks().forEach(r=>t.call(this,r,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(o=>{var c;this._localStreams?ge(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(r=>{ge(i).call(i,r.track)&&this.removeTrack(r)})})}}function RI(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),ge(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function bI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(u,p){const m=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[m]);return p?(_.then(u,p),ve.resolve()):_},t.createAnswer=function(u,p){const m=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[m]);return p?(_.then(u,p),ve.resolve()):_};let c=function(u,p,m){const _=r.apply(this,[u]);return m?(_.then(p,m),ve.resolve()):_};t.setLocalDescription=c,c=function(u,p,m){const _=s.apply(this,[u]);return m?(_.then(p,m),ve.resolve()):_},t.setRemoteDescription=c,c=function(u,p,m){const _=o.apply(this,[u]);return m?(_.then(p,m),ve.resolve()):_},t.addIceCandidate=c}function CI(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=r=>i(wI(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}).bind(t))}function wI(e){return e&&e.video!==void 0?Object.assign({},e,{video:gm(e.video)}):e}function AI(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?($l("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(n.iceServers[s])}n.iceServers=r}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function II(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function OI(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function NI(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var DI=Object.freeze({__proto__:null,shimAudioContext:NI,shimCallbacksAPI:bI,shimConstraints:wI,shimCreateOfferLegacy:OI,shimGetUserMedia:CI,shimLocalStreamsAPI:yI,shimRTCIceServerUrls:AI,shimRemoteStreamsAPI:RI,shimTrackEventTransceiver:II}),PI=`	
\v\f\r                　\u2028\u2029\uFEFF`,aB=oo,cB=$i,Ry=PI,LI=Y("".replace),lB=RegExp("^["+Ry+"]+"),dB=RegExp("(^|[^"+Ry+"])["+Ry+"]+$"),by=function(e){return function(t){var n=cB(aB(t));return 1&e&&(n=LI(n,lB,"")),2&e&&(n=LI(n,dB,"$1")),n}},uB={start:by(1),end:by(2),trim:by(3)},hB=c_.PROPER,pB=R,kI=PI,fB=uB.trim;_t({target:"String",proto:!0,forced:function(e){return pB(function(){return!!kI[e]()||"​᠎"[e]()!=="​᠎"||hB&&kI[e].name!==e})}("trim")},{trim:function(){return fB(this)}});var mB=qi("String").trim,_B=Z,EB=mB,Cy=String.prototype,gB=function(e){var t=e.trim;return typeof e=="string"||e===Cy||_B(Cy,e)&&t===Cy.trim?EB:t},vi=T(gB),xI={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(r=>r.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},t.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const r=t.matchPrefix(n+i,"a=ice-ufrag:")[0],s=t.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");i.profile=r[2];for(let o=3;o<r.length;o++){const c=r[o],u=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const p=t.parseRtpMap(u),m=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(o=>{i.headerExtensions.push(t.parseExtmap(o))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(o=>{s.forEach(c=>{o.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),i},t.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=t.writeRtpMap(o),r+=t.writeFmtp(o),r+=t.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=t.writeExtmap(o)}),r},t.parseRtpEncodingParameters=function(n){const i=[],r=t.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map(g=>t.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),u=c.length>0&&c[0].ssrc;let p;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(v=>parseInt(v,10)));m.length>0&&m[0].length>1&&m[0][0]===u&&(p=m[0][1]),r.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let v={ssrc:u,codecPayloadType:parseInt(g.parameters.apt,10)};u&&p&&(v.rtx={ssrc:p}),i.push(v),s&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:u,mechanism:o?"red+ulpfec":"red"},i.push(v))}}),i.length===0&&u&&i.push({ssrc:u});let _=t.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,i.forEach(g=>{g.maxBitrate=_})),i},t.parseRtcpParameters=function(n){const i={},r=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const r=t.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),r=t.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const u=c[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const r=t.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},e.exports=t})(xI);var MI=xI.exports,Ad=T(MI),SB=h({__proto__:null,default:Ad},[MI]);function A_(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),r=Ad.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,qo(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function wy(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||qo(e,"icecandidate",t=>{if(t.candidate){const n=Ad.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function I_(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const u=Ad.splitSections(c.sdp);return u.shift(),u.some(p=>{const m=Ad.parseMLine(p);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},i=function(c){const u=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!=p?-1:p},r=function(c){let u=65536;return t.browser==="firefox"&&(u=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},s=function(c,u){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const m=Ad.matchPrefix(c.sdp,"a=max-message-size:");return m.length>0?p=parseInt(m[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(p=2147483637),p},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),u=r(c),p=s(arguments[0],c);let m;m=u===0&&p===0?Number.POSITIVE_INFINITY:u===0||p===0?Math.max(u,p):Math.min(u,p);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>m}),this._sctp=_}return o.apply(this,arguments)}}function O_(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,r){const s=i.send;i.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},qo(e,"datachannel",i=>(t(i.channel,i.target),i))}function Ay(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Iy(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>vi(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function N_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ve.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ve.resolve())})}function D_(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var TB=Object.freeze({__proto__:null,removeExtmapAllowMixed:Iy,shimAddIceCandidateNullOrEmpty:N_,shimConnectionState:Ay,shimMaxMessageSize:I_,shimParameterlessSetLocalDescription:D_,shimRTCIceCandidate:A_,shimRTCIceCandidateRelayProtocol:wy,shimSendThrowTypeError:O_});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Em,i=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=ql(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=ql(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=ql(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(e),r={browserDetails:i,commonShim:TB,extractVersion:ql,disableLog:mT,disableWarnings:_T,sdp:SB};switch(i.browser){case"chrome":if(!dI||!vy||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=dI,N_(e,i),D_(e),tI(e,i),nI(e),vy(e,i),iI(e),cI(e,i),rI(e),sI(e),oI(e),lI(e,i),A_(e),wy(e),Ay(e),I_(e,i),O_(e),Iy(e,i);break;case"firefox":if(!vI||!yy||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=vI,N_(e,i),D_(e),uI(e,i),yy(e,i),hI(e),mI(e),pI(e),fI(e),_I(e),EI(e),gI(e),SI(e),TI(e),A_(e),Ay(e),I_(e,i),O_(e);break;case"safari":if(!DI||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=DI,N_(e,i),D_(e),AI(e),OI(e),bI(e),yI(e),RI(e),II(e),CI(e),NI(e),A_(e),wy(e),I_(e,i),O_(e),Iy(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var vB=qi("Array").keys,yB=os,RB=Kn,bB=Z,CB=vB,Oy=Array.prototype,wB={DOMTokenList:!0,NodeList:!0},AB=function(e){var t=e.keys;return e===Oy||bB(Oy,e)&&t===Oy.keys||RB(wB,yB(e))?CB:t},br=T(AB),UI=Ds,IB=TypeError,OB=Ko,NB=or,DB=Ns,P_=function(e,t,n){var i=OB(t);i in e?NB.f(e,i,DB(0,n)):e[i]=n},jI=po,PB=Vr,LB=P_,kB=Array,xB=Math.max,Ny=function(e,t,n){for(var i=PB(e),r=jI(t,i),s=jI(n===void 0?i:n,i),o=kB(xB(s-r,0)),c=0;r<s;r++,c++)LB(o,c,e[r]);return o.length=c,o},VI=Ny,MB=Math.floor,Dy=function(e,t){var n=e.length,i=MB(n/2);return n<8?UB(e,t):jB(e,Dy(VI(e,0,i),t),Dy(VI(e,i),t),t)},UB=function(e,t){for(var n,i,r=e.length,s=1;s<r;){for(i=s,n=e[s];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==s++&&(e[i]=n)}return e},jB=function(e,t,n,i){for(var r=t.length,s=n.length,o=0,c=0;o<r||c<s;)e[o+c]=o<r&&c<s?i(t[o],n[c])<=0?t[o++]:n[c++]:o<r?t[o++]:n[c++];return e},FI=Dy,BI=co.match(/firefox\/(\d+)/i),VB=!!BI&&+BI[1],FB=/MSIE|Trident/.test(co),GI=co.match(/AppleWebKit\/(\d+)\./),BB=!!GI&&+GI[1],GB=_t,HI=Y,HB=zi,WB=rs,WI=Vr,KB=function(e,t){if(!delete e[t])throw IB("Cannot delete property "+UI(t)+" of "+UI(e))},KI=$i,Py=R,YB=FI,zB=zl,YI=VB,qB=FB,zI=Tr,qI=BB,ec=[],$I=HI(ec.sort),$B=HI(ec.push),JB=Py(function(){ec.sort(void 0)}),XB=Py(function(){ec.sort(null)}),QB=zB("sort"),JI=!Py(function(){if(zI)return zI<70;if(!(YI&&YI>3)){if(qB)return!0;if(qI)return qI<603;var e,t,n,i,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ec.push({k:t+i,v:n})}for(ec.sort(function(s,o){return o.v-s.v}),i=0;i<ec.length;i++)t=ec[i].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return r!=="DGBEFHACIJK"}});GB({target:"Array",proto:!0,forced:JB||!XB||!QB||!JI},{sort:function(e){e!==void 0&&HB(e);var t=WB(this);if(JI)return e===void 0?$I(t):$I(t,e);var n,i,r=[],s=WI(t);for(i=0;i<s;i++)i in t&&$B(r,t[i]);for(YB(r,function(o){return function(c,u){return u===void 0?-1:c===void 0?1:o!==void 0?+o(c,u)||0:KI(c)>KI(u)?1:-1}}(e)),n=WI(r),i=0;i<n;)t[i]=r[i++];for(;i<s;)KB(t,i++);return t}});var ZB=qi("Array").sort,e6=Z,t6=ZB,Ly=Array.prototype,n6=function(e){var t=e.sort;return e===Ly||e6(Ly,e)&&t===Ly.sort?t6:t},Zh=T(n6),ky={exports:{}};(function(e,t){(function(n,i){var r="function",s="undefined",o="object",c="string",u="major",p="model",m="name",_="type",g="vendor",v="version",D="architecture",C="console",w="mobile",P="tablet",L="smarttv",G="wearable",W="embedded",K="Amazon",ee="Apple",ae="ASUS",fe="BlackBerry",de="Browser",Ne="Chrome",tt="Firefox",Tt="Google",Gt="Huawei",Cn="LG",en="Microsoft",Is="Motorola",oe="Opera",pe="Samsung",Ie="Sharp",ze="Sony",gt="Xiaomi",Se="Zebra",b="Facebook",U="Chromium OS",H="Mac OS",ue=function(gn){for(var Dn={},zt=0;zt<gn.length;zt++)Dn[gn[zt].toUpperCase()]=gn[zt];return Dn},qe=function(gn,Dn){return typeof gn===c&&At(Dn).indexOf(At(gn))!==-1},At=function(gn){return gn.toLowerCase()},jn=function(gn,Dn){if(typeof gn===c)return gn=gn.replace(/^\s\s*/,""),typeof Dn===s?gn:gn.substring(0,350)},tr=function(gn,Dn){for(var zt,Er,Fo,Sn,St,nr,Ic=0;Ic<Dn.length&&!St;){var to=Dn[Ic],_U=Dn[Ic+1];for(zt=Er=0;zt<to.length&&!St&&to[zt];)if(St=to[zt++].exec(gn))for(Fo=0;Fo<_U.length;Fo++)nr=St[++Er],typeof(Sn=_U[Fo])===o&&Sn.length>0?Sn.length===2?typeof Sn[1]==r?this[Sn[0]]=Sn[1].call(this,nr):this[Sn[0]]=Sn[1]:Sn.length===3?typeof Sn[1]!==r||Sn[1].exec&&Sn[1].test?this[Sn[0]]=nr?nr.replace(Sn[1],Sn[2]):i:this[Sn[0]]=nr?Sn[1].call(this,nr,Sn[2]):i:Sn.length===4&&(this[Sn[0]]=nr?Sn[3].call(this,nr.replace(Sn[1],Sn[2])):i):this[Sn]=nr||i;Ic+=2}},ba=function(gn,Dn){for(var zt in Dn)if(typeof Dn[zt]===o&&Dn[zt].length>0){for(var Er=0;Er<Dn[zt].length;Er++)if(qe(Dn[zt][Er],gn))return zt==="?"?i:zt}else if(qe(Dn[zt],gn))return zt==="?"?i:zt;return gn},wg={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ag={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,v],[/opios[\/ ]+([\w\.]+)/i],[v,[m,oe+" Mini"]],[/\bopr\/([\w\.]+)/i],[v,[m,oe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,v],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[m,"UC"+de]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[v,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[v,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[v,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+de],v],[/\bfocus\/([\w\.]+)/i],[v,[m,tt+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[m,oe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[m,oe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[m,"MIUI "+de]],[/fxios\/([-\w\.]+)/i],[v,[m,tt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+de]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+de],v],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,v],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,b],v],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[m,Ne+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Ne+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[m,"Android "+de]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[v,ba,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[m,tt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,v],[/(cobalt)\/([\w\.]+)/i],[m,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,At]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",At]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,At]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[g,pe],[_,P]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[g,pe],[_,w]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[g,ee],[_,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[g,ee],[_,P]],[/(macintosh);/i],[p,[g,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[g,Ie],[_,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[g,Gt],[_,P]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[g,Gt],[_,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[g,gt],[_,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[g,gt],[_,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[g,"OPPO"],[_,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[g,"Vivo"],[_,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[g,"Realme"],[_,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[g,Is],[_,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[g,Is],[_,P]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[g,Cn],[_,P]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[g,Cn],[_,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[g,"Lenovo"],[_,P]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[g,"Nokia"],[_,w]],[/(pixel c)\b/i],[p,[g,Tt],[_,P]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[g,Tt],[_,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[g,ze],[_,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[g,ze],[_,P]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[g,"OnePlus"],[_,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[g,K],[_,P]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[g,K],[_,w]],[/(playbook);[-\w\),; ]+(rim)/i],[p,g,[_,P]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[g,fe],[_,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[g,ae],[_,P]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[g,ae],[_,w]],[/(nexus 9)/i],[p,[g,"HTC"],[_,P]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[p,/_/g," "],[_,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[g,"Acer"],[_,P]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[g,"Meizu"],[_,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,p,[_,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,p,[_,P]],[/(surface duo)/i],[p,[g,en],[_,P]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[g,"Fairphone"],[_,w]],[/(u304aa)/i],[p,[g,"AT&T"],[_,w]],[/\bsie-(\w*)/i],[p,[g,"Siemens"],[_,w]],[/\b(rct\w+) b/i],[p,[g,"RCA"],[_,P]],[/\b(venue[\d ]{2,7}) b/i],[p,[g,"Dell"],[_,P]],[/\b(q(?:mv|ta)\w+) b/i],[p,[g,"Verizon"],[_,P]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[g,"Barnes & Noble"],[_,P]],[/\b(tm\d{3}\w+) b/i],[p,[g,"NuVision"],[_,P]],[/\b(k88) b/i],[p,[g,"ZTE"],[_,P]],[/\b(nx\d{3}j) b/i],[p,[g,"ZTE"],[_,w]],[/\b(gen\d{3}) b.+49h/i],[p,[g,"Swiss"],[_,w]],[/\b(zur\d{3}) b/i],[p,[g,"Swiss"],[_,P]],[/\b((zeki)?tb.*\b) b/i],[p,[g,"Zeki"],[_,P]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],p,[_,P]],[/\b(ns-?\w{0,9}) b/i],[p,[g,"Insignia"],[_,P]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[g,"NextBook"],[_,P]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],p,[_,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],p,[_,w]],[/\b(ph-1) /i],[p,[g,"Essential"],[_,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[g,"Envizen"],[_,P]],[/\b(trio[-\w\. ]+) b/i],[p,[g,"MachSpeed"],[_,P]],[/\btu_(1491) b/i],[p,[g,"Rotor"],[_,P]],[/(shield[\w ]+) b/i],[p,[g,"Nvidia"],[_,P]],[/(sprint) (\w+)/i],[g,p,[_,w]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[g,en],[_,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[g,Se],[_,P]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[g,Se],[_,w]],[/smart-tv.+(samsung)/i],[g,[_,L]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[g,pe],[_,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,Cn],[_,L]],[/(apple) ?tv/i],[g,[p,ee+" TV"],[_,L]],[/crkey/i],[[p,Ne+"cast"],[g,Tt],[_,L]],[/droid.+aft(\w)( bui|\))/i],[p,[g,K],[_,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[g,Ie],[_,L]],[/(bravia[\w ]+)( bui|\))/i],[p,[g,ze],[_,L]],[/(mitv-\w{5}) bui/i],[p,[g,gt],[_,L]],[/Hbbtv.*(technisat) (.*);/i],[g,p,[_,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,jn],[p,jn],[_,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,p,[_,C]],[/droid.+; (shield) bui/i],[p,[g,"Nvidia"],[_,C]],[/(playstation [345portablevi]+)/i],[p,[g,ze],[_,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[g,en],[_,C]],[/((pebble))app/i],[g,p,[_,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[g,ee],[_,G]],[/droid.+; (glass) \d/i],[p,[g,Tt],[_,G]],[/droid.+; (wt63?0{2,3})\)/i],[p,[g,Se],[_,G]],[/(quest( 2| pro)?)/i],[p,[g,b],[_,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[_,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[_,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[_,P]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,P]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,w]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,v],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[v,ba,wg]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[v,ba,wg]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,H],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,v],[/\(bb(10);/i],[v,[m,fe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[m,tt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[m,Ne+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,U],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,v],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,v]]},Qr=function(gn,Dn){if(typeof gn===o&&(Dn=gn,gn=i),!(this instanceof Qr))return new Qr(gn,Dn).getResult();var zt=typeof n!==s&&n.navigator?n.navigator:i,Er=gn||(zt&&zt.userAgent?zt.userAgent:""),Fo=zt&&zt.userAgentData?zt.userAgentData:i,Sn=Dn?function(St,nr){var Ic={};for(var to in St)nr[to]&&nr[to].length%2==0?Ic[to]=nr[to].concat(St[to]):Ic[to]=St[to];return Ic}(Ag,Dn):Ag;return this.getBrowser=function(){var St={};return St[m]=i,St[v]=i,tr.call(St,Er,Sn.browser),St[u]=function(nr){return typeof nr===c?nr.replace(/[^\d\.]/g,"").split(".")[0]:i}(St[v]),zt&&zt.brave&&typeof zt.brave.isBrave==r&&(St[m]="Brave"),St},this.getCPU=function(){var St={};return St[D]=i,tr.call(St,Er,Sn.cpu),St},this.getDevice=function(){var St={};return St[g]=i,St[p]=i,St[_]=i,tr.call(St,Er,Sn.device),!St[_]&&Fo&&Fo.mobile&&(St[_]=w),St[p]=="Macintosh"&&zt&&typeof zt.standalone!==s&&zt.maxTouchPoints&&zt.maxTouchPoints>2&&(St[p]="iPad",St[_]=P),St},this.getEngine=function(){var St={};return St[m]=i,St[v]=i,tr.call(St,Er,Sn.engine),St},this.getOS=function(){var St={};return St[m]=i,St[v]=i,tr.call(St,Er,Sn.os),!St[m]&&Fo&&Fo.platform!="Unknown"&&(St[m]=Fo.platform.replace(/chrome os/i,U).replace(/macos/i,H)),St},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Er},this.setUA=function(St){return Er=typeof St===c&&St.length>350?jn(St,350):St,this},this.setUA(Er),this};Qr.VERSION="0.7.34",Qr.BROWSER=ue([m,v,u]),Qr.CPU=ue([D]),Qr.DEVICE=ue([p,g,_,C,w,L,P,G,W]),Qr.ENGINE=Qr.OS=ue([m,v]),e.exports&&(t=e.exports=Qr),t.UAParser=Qr;var Ac=typeof n!==s&&(n.jQuery||n.Zepto);if(Ac&&!Ac.ua){var Iu=new Qr;Ac.ua=Iu.getResult(),Ac.ua.get=function(){return Iu.getUA()},Ac.ua.set=function(gn){Iu.setUA(gn);var Dn=Iu.getResult();for(var zt in Dn)Ac.ua[zt]=Dn[zt]}}})(typeof window=="object"?window:E)})(ky,ky.exports);var i6=T(ky.exports),r6=os,s6=Kn,o6=is,a6=Xo,c6=hn("iterator"),l6=Object,d6=function(e){if(o6(e))return!1;var t=l6(e);return t[c6]!==void 0||"@@iterator"in t||s6(a6,r6(t))},u6=T(d6),xy=q;_t({global:!0,forced:xy.globalThis!==xy},{globalThis:xy});var XI=T(q),QI=T_.clear;_t({global:!0,bind:!0,enumerable:!0,forced:q.clearImmediate!==QI},{clearImmediate:QI});var h6=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",ZI=q,p6=me,f6=Ze,m6=h6,_6=co,E6=Td,g6=aa,S6=ZI.Function,T6=/MSIE .\./.test(_6)||m6&&function(){var e=ZI.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),v6=_t,e0=q,t0=T_.set,y6=function(e,t){var n=1;return T6?function(i,r){var s=g6(arguments.length,1)>n,o=f6(i)?i:S6(i),c=s?E6(arguments,n):[],u=s?function(){p6(o,this,c)}:o;return e(u)}:e},n0=e0.setImmediate?y6(t0):t0;v6({global:!0,bind:!0,enumerable:!0,forced:e0.setImmediate!==n0},{setImmediate:n0});var i0=T(ir.setImmediate),R6=_t,b6=TA,C6=zi,w6=aa,A6=Ka,I6=q.process;R6({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){w6(arguments.length,1),C6(e);var t=A6&&I6.domain;b6(t?t.bind(e):e)}});var r0=T(ir.queueMicrotask);function s0(e,t){return function(){return e.apply(t,arguments)}}const{toString:O6}=Object.prototype,{getPrototypeOf:My}=Object,L_=(Uy=Object.create(null),e=>{const t=O6.call(e);return Uy[t]||(Uy[t]=t.slice(8,-1).toLowerCase())});var Uy;const Gs=e=>(e=e.toLowerCase(),t=>L_(t)===e),k_=e=>t=>typeof t===e,{isArray:Id}=Array,ep=k_("undefined"),o0=Gs("ArrayBuffer"),N6=k_("string"),Gr=k_("function"),a0=k_("number"),x_=e=>e!==null&&typeof e=="object",M_=e=>{if(L_(e)!=="object")return!1;const t=My(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||u6(e))},D6=Gs("Date"),P6=Gs("File"),L6=Gs("Blob"),k6=Gs("FileList"),x6=Gs("URLSearchParams"),[M6,U6,j6,V6]=["ReadableStream","Request","Response","Headers"].map(Gs);function tp(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Id(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const s=r?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function c0(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const el=XI!==void 0?XI:typeof self<"u"?self:typeof window<"u"?window:d,l0=e=>!ep(e)&&e!==el,F6=(jy=typeof Uint8Array<"u"&&My(Uint8Array),e=>jy&&e instanceof jy);var jy;const B6=Gs("HTMLFormElement"),d0=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),G6=Gs("RegExp"),u0=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};tp(n,(r,s)=>{let o;(o=t(r,s,e))!==!1&&(i[s]=o||r)}),Object.defineProperties(e,i)},Vy="abcdefghijklmnopqrstuvwxyz",h0="0123456789",p0={DIGIT:h0,ALPHA:Vy,ALPHA_DIGIT:Vy+Vy.toUpperCase()+h0},H6=Gs("AsyncFunction"),f0=(m0=typeof i0=="function",_0=Gr(el.postMessage),m0?i0:_0?(Fy="axios@".concat(Math.random()),U_=[],el.addEventListener("message",e=>{let{source:t,data:n}=e;t===el&&n===Fy&&U_.length&&U_.shift()()},!1),e=>{U_.push(e),el.postMessage(Fy,"*")}):e=>setTimeout(e));var m0,_0,Fy,U_;const W6=r0!==void 0?r0.bind(el):typeof process<"u"&&process.nextTick||f0;var _e={isArray:Id,isArrayBuffer:o0,isBuffer:function(e){return e!==null&&!ep(e)&&e.constructor!==null&&!ep(e.constructor)&&Gr(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Gr(e.append)&&((t=L_(e))==="formdata"||t==="object"&&Gr(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&o0(e.buffer),t},isString:N6,isNumber:a0,isBoolean:e=>e===!0||e===!1,isObject:x_,isPlainObject:M_,isReadableStream:M6,isRequest:U6,isResponse:j6,isHeaders:V6,isUndefined:ep,isDate:D6,isFile:P6,isBlob:L6,isRegExp:G6,isFunction:Gr,isStream:e=>x_(e)&&Gr(e.pipe),isURLSearchParams:x6,isTypedArray:F6,isFileList:k6,forEach:tp,merge:function e(){const{caseless:t}=l0(this)&&this||{},n={},i=(r,s)=>{const o=t&&c0(n,s)||s;M_(n[o])&&M_(r)?n[o]=e(n[o],r):M_(r)?n[o]=e({},r):Id(r)?n[o]=r.slice():n[o]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&tp(arguments[r],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return tp(t,(r,s)=>{n&&Gr(r)?e[s]=s0(r,n):e[s]=r},{allOwnKeys:i}),e},trim:e=>vi(e)?vi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,s,o;const c={};if(t=t||{},e==null)return t;do{for(r=Object.getOwnPropertyNames(e),s=r.length;s-- >0;)o=r[s],i&&!i(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&My(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:L_,kindOfTest:Gs,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Id(e))return e;let t=e.length;if(!a0(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const r=i.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:B6,hasOwnProperty:d0,hasOwnProp:d0,reduceDescriptors:u0,freezeMethods:e=>{u0(e,(t,n)=>{if(Gr(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];Gr(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return Id(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:c0,global:el,isContextDefined:l0,ALPHABET:p0,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p0.ALPHA_DIGIT,n="";const{length:i}=t;for(;e--;)n+=t[Math.random()*i|0];return n},isSpecCompliantForm:function(e){return!!(e&&Gr(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(i,r)=>{if(x_(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[r]=i;const s=Id(i)?[]:{};return tp(i,(o,c)=>{const u=n(o,r+1);!ep(u)&&(s[c]=u)}),t[r]=void 0,s}}return i};return n(e,0)},isAsyncFn:H6,isThenable:e=>e&&(x_(e)||Gr(e))&&Gr(e.then)&&Gr(e.catch),setImmediate:f0,asap:W6};function Ot(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}_e.inherits(Ot,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_e.toJSONObject(this.config),code:this.code,status:this.status}}});const E0=Ot.prototype,g0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{g0[e]={value:e}}),Object.defineProperties(Ot,g0),Object.defineProperty(E0,"isAxiosError",{value:!0}),Ot.from=(e,t,n,i,r,s)=>{const o=Object.create(E0);return _e.toFlatObject(e,o,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),Ot.call(o,e.message,t,n,i,r),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function By(e){return _e.isPlainObject(e)||_e.isArray(e)}function S0(e){return _e.endsWith(e,"[]")?e.slice(0,-2):e}function T0(e,t,n){return e?e.concat(t).map(function(i,r){return i=S0(i),!n&&r?"["+i+"]":i}).join(n?".":""):t}const K6=_e.toFlatObject(_e,{},null,function(e){return/^is[A-Z]/.test(e)});function j_(e,t,n){if(!_e.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=_e.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,v){return!_e.isUndefined(v[g])})).metaTokens,r=n.visitor||p,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&_e.isSpecCompliantForm(t);if(!_e.isFunction(r))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(_e.isDate(g))return g.toISOString();if(!c&&_e.isBlob(g))throw new Ot("Blob is not supported. Use a Buffer instead.");return _e.isArrayBuffer(g)||_e.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function p(g,v,D){let C=g;if(g&&!D&&typeof g=="object"){if(_e.endsWith(v,"{}"))v=i?v:v.slice(0,-2),g=JSON.stringify(g);else if(_e.isArray(g)&&function(w){return _e.isArray(w)&&!w.some(By)}(g)||(_e.isFileList(g)||_e.endsWith(v,"[]"))&&(C=_e.toArray(g)))return v=S0(v),C.forEach(function(w,P){!_e.isUndefined(w)&&w!==null&&t.append(o===!0?T0([v],P,s):o===null?v:v+"[]",u(w))}),!1}return!!By(g)||(t.append(T0(D,v,s),u(g)),!1)}const m=[],_=Object.assign(K6,{defaultVisitor:p,convertValue:u,isVisitable:By});if(!_e.isObject(e))throw new TypeError("data must be an object");return function g(v,D){if(!_e.isUndefined(v)){if(m.indexOf(v)!==-1)throw Error("Circular reference detected in "+D.join("."));m.push(v),_e.forEach(v,function(C,w){(!(_e.isUndefined(C)||C===null)&&r.call(t,C,_e.isString(w)?vi(w).call(w):w,D,_))===!0&&g(C,D?D.concat(w):[w])}),m.pop()}}(e),t}function v0(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Gy(e,t){this._pairs=[],e&&j_(e,this,t)}const y0=Gy.prototype;function Y6(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function R0(e,t,n){if(!t)return e;const i=n&&n.encode||Y6,r=n&&n.serialize;let s;if(s=r?r(t,n):_e.isURLSearchParams(t)?t.toString():new Gy(t,n).toString(i),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}y0.append=function(e,t){this._pairs.push([e,t])},y0.toString=function(e){const t=e?function(n){return e.call(this,n,v0)}:v0;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var b0=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){_e.forEach(this.handlers,function(t){t!==null&&e(t)})}},C0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},w0={exports:{}},z6=_t,q6=li,A0=or.f;z6({target:"Object",stat:!0,forced:Object.defineProperty!==A0,sham:!q6},{defineProperty:A0});var I0=ir.Object,$6=w0.exports=function(e,t,n){return I0.defineProperty(e,t,n)};I0.defineProperty.sham&&($6.sham=!0);var O0=T(w0.exports),J6=xe,np=Array.isArray||function(e){return J6(e)=="Array"},X6=TypeError,N0=np,Q6=To,Z6=Ki,e5=hn("species"),D0=Array,t5=function(e){var t;return N0(e)&&(t=e.constructor,(Q6(t)&&(t===D0||N0(t.prototype))||Z6(t)&&(t=t[e5])===null)&&(t=void 0)),t===void 0?D0:t},P0=function(e,t){return new(t5(e))(t===0?0:t)},n5=R,i5=Tr,r5=hn("species"),L0=function(e){return i5>=51||!n5(function(){var t=[];return(t.constructor={})[r5]=function(){return{foo:1}},t[e](Boolean).foo!==1})},s5=_t,o5=R,a5=np,c5=Ki,l5=rs,d5=Vr,k0=function(e){if(e>9007199254740991)throw X6("Maximum allowed index exceeded");return e},x0=P_,u5=P0,h5=L0,p5=Tr,M0=hn("isConcatSpreadable"),f5=p5>=51||!o5(function(){var e=[];return e[M0]=!1,e.concat()[0]!==e}),m5=function(e){if(!c5(e))return!1;var t=e[M0];return t!==void 0?!!t:a5(e)};s5({target:"Array",proto:!0,arity:1,forced:!f5||!h5("concat")},{concat:function(e){var t,n,i,r,s,o=l5(this),c=u5(o,0),u=0;for(t=-1,i=arguments.length;t<i;t++)if(m5(s=t===-1?o:arguments[t]))for(r=d5(s),k0(u+r),n=0;n<r;n++,u++)n in s&&x0(c,u,s[n]);else k0(u+1),x0(c,u++,s);return c.length=u,c}});var U0={},_5=xe,E5=ao,j0=Wc.f,g5=Ny,V0=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];U0.f=function(e){return V0&&_5(e)=="Window"?function(t){try{return j0(t)}catch{return g5(V0)}}(e):j0(E5(e))};var Od={},S5=hn;Od.f=S5;var F0=ir,T5=Kn,v5=Od,y5=or.f,ti=function(e){var t=F0.Symbol||(F0.Symbol={});T5(t,e)||y5(t,e,{value:v5.f(e)})},R5=ft,b5=Yi,C5=hn,w5=mo,B0=function(){var e=b5("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=C5("toPrimitive");t&&!t[i]&&w5(t,i,function(r){return R5(n,this)},{arity:1})},A5=Ps,I5=Sr,O5=rs,N5=Vr,D5=P0,G0=Y([].push),tc=function(e){var t=e==1,n=e==2,i=e==3,r=e==4,s=e==6,o=e==7,c=e==5||s;return function(u,p,m,_){for(var g,v,D=O5(u),C=I5(D),w=A5(p,m),P=N5(C),L=0,G=_||D5,W=t?G(u,P):n||o?G(u,0):void 0;P>L;L++)if((c||L in C)&&(v=w(g=C[L],L,D),e))if(t)W[L]=v;else if(v)switch(e){case 3:return!0;case 5:return g;case 6:return L;case 2:G0(W,g)}else switch(e){case 4:return!1;case 7:G0(W,g)}return s?-1:i||r?r:W}},H0={forEach:tc(0),map:tc(1),filter:tc(2),some:tc(3),every:tc(4),find:tc(5),findIndex:tc(6),filterReject:tc(7)},V_=_t,Hy=q,Wy=ft,P5=Y,Nd=li,Dd=Oa,L5=R,Ii=Kn,k5=Z,Ky=Si,F_=ao,Yy=Ko,x5=$i,zy=Ns,ip=qc,W0=Vi,M5=Wc,K0=U0,U5=Kc,Y0=wn,z0=or,j5=Yc,q0=gr,$0=mo,V5=mt,qy=Da,J0=Ql,X0=qu,F5=hn,B5=Od,G5=ti,H5=B0,W5=cs,Q0=ea,B_=H0.forEach,Cr=Jl("hidden"),G_="Symbol",rp="prototype",K5=Q0.set,Z0=Q0.getterFor(G_),Hs=Object[rp],tl=Hy.Symbol,H_=tl&&tl[rp],Y5=Hy.TypeError,$y=Hy.QObject,eO=Y0.f,nl=z0.f,tO=K0.f,z5=q0.f,nO=P5([].push),la=qy("symbols"),sp=qy("op-symbols"),q5=qy("wks"),Jy=!$y||!$y[rp]||!$y[rp].findChild,Xy=Nd&&L5(function(){return ip(nl({},"a",{get:function(){return nl(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var i=eO(Hs,t);i&&delete Hs[t],nl(e,t,n),i&&e!==Hs&&nl(Hs,t,i)}:nl,Qy=function(e,t){var n=la[e]=ip(H_);return K5(n,{type:G_,tag:e,description:t}),Nd||(n.description=t),n},W_=function(e,t,n){e===Hs&&W_(sp,t,n),Ky(e);var i=Yy(t);return Ky(n),Ii(la,i)?(n.enumerable?(Ii(e,Cr)&&e[Cr][i]&&(e[Cr][i]=!1),n=ip(n,{enumerable:zy(0,!1)})):(Ii(e,Cr)||nl(e,Cr,zy(1,{})),e[Cr][i]=!0),Xy(e,i,n)):nl(e,i,n)},Zy=function(e,t){Ky(e);var n=F_(t),i=W0(n).concat(oO(n));return B_(i,function(r){Nd&&!Wy(iO,n,r)||W_(e,r,n[r])}),e},iO=function(e){var t=Yy(e),n=Wy(z5,this,t);return!(this===Hs&&Ii(la,t)&&!Ii(sp,t))&&(!(n||!Ii(this,t)||!Ii(la,t)||Ii(this,Cr)&&this[Cr][t])||n)},rO=function(e,t){var n=F_(e),i=Yy(t);if(n!==Hs||!Ii(la,i)||Ii(sp,i)){var r=eO(n,i);return!r||!Ii(la,i)||Ii(n,Cr)&&n[Cr][i]||(r.enumerable=!0),r}},sO=function(e){var t=tO(F_(e)),n=[];return B_(t,function(i){Ii(la,i)||Ii(J0,i)||nO(n,i)}),n},oO=function(e){var t=e===Hs,n=tO(t?sp:F_(e)),i=[];return B_(n,function(r){!Ii(la,r)||t&&!Ii(Hs,r)||nO(i,la[r])}),i};Dd||(tl=function(){if(k5(H_,this))throw Y5("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?x5(arguments[0]):void 0,t=X0(e),n=function(i){this===Hs&&Wy(n,sp,i),Ii(this,Cr)&&Ii(this[Cr],t)&&(this[Cr][t]=!1),Xy(this,t,zy(1,i))};return Nd&&Jy&&Xy(Hs,t,{configurable:!0,set:n}),Qy(t,e)},$0(H_=tl[rp],"toString",function(){return Z0(this).tag}),$0(tl,"withoutSetter",function(e){return Qy(X0(e),e)}),q0.f=iO,z0.f=W_,j5.f=Zy,Y0.f=rO,M5.f=K0.f=sO,U5.f=oO,B5.f=function(e){return Qy(F5(e),e)},Nd&&V5(H_,"description",{configurable:!0,get:function(){return Z0(this).description}})),V_({global:!0,constructor:!0,wrap:!0,forced:!Dd,sham:!Dd},{Symbol:tl}),B_(W0(q5),function(e){G5(e)}),V_({target:G_,stat:!0,forced:!Dd},{useSetter:function(){Jy=!0},useSimple:function(){Jy=!1}}),V_({target:"Object",stat:!0,forced:!Dd,sham:!Nd},{create:function(e,t){return t===void 0?ip(e):Zy(ip(e),t)},defineProperty:W_,defineProperties:Zy,getOwnPropertyDescriptor:rO}),V_({target:"Object",stat:!0,forced:!Dd},{getOwnPropertyNames:sO}),H5(),W5(tl,G_),J0[Cr]=!0;var aO=Oa&&!!Symbol.for&&!!Symbol.keyFor,$5=_t,J5=Yi,X5=Kn,Q5=$i,cO=Da,Z5=aO,eR=cO("string-to-symbol-registry"),e8=cO("symbol-to-string-registry");$5({target:"Symbol",stat:!0,forced:!Z5},{for:function(e){var t=Q5(e);if(X5(eR,t))return eR[t];var n=J5("Symbol")(t);return eR[t]=n,e8[n]=t,n}});var t8=_t,n8=Kn,i8=jc,r8=Ds,s8=aO,lO=Da("symbol-to-string-registry");t8({target:"Symbol",stat:!0,forced:!s8},{keyFor:function(e){if(!i8(e))throw TypeError(r8(e)+" is not a symbol");if(n8(lO,e))return lO[e]}});var dO=np,o8=Ze,uO=xe,a8=$i,hO=Y([].push),c8=_t,pO=Yi,fO=me,l8=ft,op=Y,mO=R,_O=Ze,EO=jc,gO=Td,d8=function(e){if(o8(e))return e;if(dO(e)){for(var t=e.length,n=[],i=0;i<t;i++){var r=e[i];typeof r=="string"?hO(n,r):typeof r!="number"&&uO(r)!="Number"&&uO(r)!="String"||hO(n,a8(r))}var s=n.length,o=!0;return function(c,u){if(o)return o=!1,u;if(dO(this))return u;for(var p=0;p<s;p++)if(n[p]===c)return u}}},u8=Oa,h8=String,nc=pO("JSON","stringify"),K_=op(/./.exec),SO=op("".charAt),p8=op("".charCodeAt),f8=op("".replace),m8=op(1 .toString),_8=/[\uD800-\uDFFF]/g,TO=/^[\uD800-\uDBFF]$/,vO=/^[\uDC00-\uDFFF]$/,yO=!u8||mO(function(){var e=pO("Symbol")();return nc([e])!="[null]"||nc({a:e})!="{}"||nc(Object(e))!="{}"}),RO=mO(function(){return nc("\uDF06\uD834")!=='"\\udf06\\ud834"'||nc("\uDEAD")!=='"\\udead"'}),E8=function(e,t){var n=gO(arguments),i=d8(t);if(_O(i)||e!==void 0&&!EO(e))return n[1]=function(r,s){if(_O(i)&&(s=l8(i,this,h8(r),s)),!EO(s))return s},fO(nc,null,n)},g8=function(e,t,n){var i=SO(n,t-1),r=SO(n,t+1);return K_(TO,e)&&!K_(vO,r)||K_(vO,e)&&!K_(TO,i)?"\\u"+m8(p8(e,0),16):e};nc&&c8({target:"JSON",stat:!0,arity:3,forced:yO||RO},{stringify:function(e,t,n){var i=gO(arguments),r=fO(yO?E8:nc,null,i);return RO&&typeof r=="string"?f8(r,_8,g8):r}});var bO=Kc,S8=rs;_t({target:"Object",stat:!0,forced:!Oa||R(function(){bO.f(1)})},{getOwnPropertySymbols:function(e){var t=bO.f;return t?t(S8(e)):[]}}),ti("asyncIterator"),ti("hasInstance"),ti("isConcatSpreadable"),ti("iterator"),ti("match"),ti("matchAll"),ti("replace"),ti("search"),ti("species"),ti("split");var T8=B0;ti("toPrimitive"),T8();var v8=Yi,y8=cs;ti("toStringTag"),y8(v8("Symbol"),"Symbol"),ti("unscopables"),cs(q.JSON,"JSON",!0);var R8=ir.Symbol,b8=hn,C8=or.f,CO=b8("metadata"),wO=Function.prototype;wO[CO]===void 0&&C8(wO,CO,{value:null}),ti("dispose"),ti("metadata");var w8=R8;ti("asyncDispose");var A8=Y,tR=Yi("Symbol"),I8=tR.keyFor,O8=A8(tR.prototype.valueOf),AO=tR.isRegisteredSymbol||function(e){try{return I8(O8(e))!==void 0}catch{return!1}};_t({target:"Symbol",stat:!0},{isRegisteredSymbol:AO});for(var N8=Da,IO=Yi,D8=Y,P8=jc,L8=hn,Y_=IO("Symbol"),OO=Y_.isWellKnownSymbol,NO=IO("Object","getOwnPropertyNames"),k8=D8(Y_.prototype.valueOf),DO=N8("wks"),nR=0,PO=NO(Y_),x8=PO.length;nR<x8;nR++)try{var LO=PO[nR];P8(Y_[LO])&&L8(LO)}catch{}var kO=function(e){if(OO&&OO(e))return!0;try{for(var t=k8(e),n=0,i=NO(DO),r=i.length;n<r;n++)if(DO[i[n]]==t)return!0}catch{}return!1};_t({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:kO}),ti("matcher"),ti("observable"),_t({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:AO}),_t({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:kO}),ti("metadataKey"),ti("patternMatch"),ti("replaceAll");var Pd=T(w8),xO=T(Od.f("iterator"));function ap(e){return ap=typeof Pd=="function"&&typeof xO=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Pd=="function"&&t.constructor===Pd&&t!==Pd.prototype?"symbol":typeof t},ap(e)}var M8=T(Od.f("toPrimitive"));function U8(e){var t=function(n,i){if(ap(n)!=="object"||n===null)return n;var r=n[M8];if(r!==void 0){var s=r.call(n,i||"default");if(ap(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return ap(t)==="symbol"?t:String(t)}function O(e,t,n){return(t=U8(t))in e?O0(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j8=R,V8=hn("iterator"),iR=!j8(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return e.pathname="c%20d",t.forEach(function(r,s){t.delete("b"),i+=s+r}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[V8]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),F8=mo,rR=_t,Ld=q,z_=ft,yo=Y,kd=li,MO=iR,UO=mo,B8=mt,G8=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:F8(e,i,t[i],n);return e},H8=cs,W8=jh,sR=ea,jO=Ut,oR=Ze,K8=Kn,Y8=Ps,z8=os,q8=Si,VO=Ki,dr=$i,$8=qc,FO=Ns,aR=Ah,J8=Rr,xd=aa,X8=FI,Q8=hn("iterator"),cp="URLSearchParams",BO=cp+"Iterator",GO=sR.set,ds=sR.getterFor(cp),Z8=sR.getterFor(BO),eG=Object.getOwnPropertyDescriptor,cR=function(e){if(!kd)return Ld[e];var t=eG(Ld,e);return t&&t.value},HO=cR("fetch"),q_=cR("Request"),lp=cR("Headers"),lR=q_&&q_.prototype,WO=lp&&lp.prototype,tG=Ld.RegExp,nG=Ld.TypeError,KO=Ld.decodeURIComponent,iG=Ld.encodeURIComponent,rG=yo("".charAt),YO=yo([].join),il=yo([].push),dR=yo("".replace),sG=yo([].shift),zO=yo([].splice),qO=yo("".split),oG=yo("".slice),aG=/\+/g,$O=Array(4),cG=function(e){return $O[e-1]||($O[e-1]=tG("((?:%[\\da-f]{2}){"+e+"})","gi"))},lG=function(e){try{return KO(e)}catch{return e}},JO=function(e){var t=dR(e,aG," "),n=4;try{return KO(t)}catch{for(;n;)t=dR(t,cG(n--),lG);return t}},dG=/[!'()~]|%20/g,uG={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hG=function(e){return uG[e]},XO=function(e){return dR(iG(e),dG,hG)},uR=W8(function(e,t){GO(this,{type:BO,iterator:aR(ds(e).entries),kind:t})},"Iterator",function(){var e=Z8(this),t=e.kind,n=e.iterator.next(),i=n.value;return n.done||(n.value=t==="keys"?i.key:t==="values"?i.value:[i.key,i.value]),n},!0),QO=function(e){this.entries=[],this.url=null,e!==void 0&&(VO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?rG(e,0)==="?"?oG(e,1):e:dr(e)))};QO.prototype={type:cp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,r,s,o,c,u=J8(e);if(u)for(n=(t=aR(e,u)).next;!(i=z_(n,t)).done;){if(s=(r=aR(q8(i.value))).next,(o=z_(s,r)).done||(c=z_(s,r)).done||!z_(s,r).done)throw nG("Expected sequence with length 2");il(this.entries,{key:dr(o.value),value:dr(c.value)})}else for(var p in e)K8(e,p)&&il(this.entries,{key:p,value:dr(e[p])})},parseQuery:function(e){if(e)for(var t,n,i=qO(e,"&"),r=0;r<i.length;)(t=i[r++]).length&&(n=qO(t,"="),il(this.entries,{key:JO(sG(n)),value:JO(YO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],il(n,XO(e.key)+"="+XO(e.value));return YO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $_=function(){jO(this,Md);var e=GO(this,new QO(arguments.length>0?arguments[0]:void 0));kd||(this.size=e.entries.length)},Md=$_.prototype;if(G8(Md,{append:function(e,t){var n=ds(this);xd(arguments.length,2),il(n.entries,{key:dr(e),value:dr(t)}),kd||this.length++,n.updateURL()},delete:function(e){for(var t=ds(this),n=xd(arguments.length,1),i=t.entries,r=dr(e),s=n<2?void 0:arguments[1],o=s===void 0?s:dr(s),c=0;c<i.length;){var u=i[c];if(u.key!==r||o!==void 0&&u.value!==o)c++;else if(zO(i,c,1),o!==void 0)break}kd||(this.size=i.length),t.updateURL()},get:function(e){var t=ds(this).entries;xd(arguments.length,1);for(var n=dr(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=ds(this).entries;xd(arguments.length,1);for(var n=dr(e),i=[],r=0;r<t.length;r++)t[r].key===n&&il(i,t[r].value);return i},has:function(e){for(var t=ds(this).entries,n=xd(arguments.length,1),i=dr(e),r=n<2?void 0:arguments[1],s=r===void 0?r:dr(r),o=0;o<t.length;){var c=t[o++];if(c.key===i&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=ds(this);xd(arguments.length,1);for(var i,r=n.entries,s=!1,o=dr(e),c=dr(t),u=0;u<r.length;u++)(i=r[u]).key===o&&(s?zO(r,u--,1):(s=!0,i.value=c));s||il(r,{key:o,value:c}),kd||(this.size=r.length),n.updateURL()},sort:function(){var e=ds(this);X8(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=ds(this).entries,i=Y8(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((t=n[r++]).value,t.key,this)},keys:function(){return new uR(this,"keys")},values:function(){return new uR(this,"values")},entries:function(){return new uR(this,"entries")}},{enumerable:!0}),UO(Md,Q8,Md.entries,{name:"entries"}),UO(Md,"toString",function(){return ds(this).serialize()},{enumerable:!0}),kd&&B8(Md,"size",{get:function(){return ds(this).entries.length},configurable:!0,enumerable:!0}),H8($_,cp),rR({global:!0,constructor:!0,forced:!MO},{URLSearchParams:$_}),!MO&&oR(lp)){var pG=yo(WO.has),fG=yo(WO.set),ZO=function(e){if(VO(e)){var t,n=e.body;if(z8(n)===cp)return t=e.headers?new lp(e.headers):new lp,pG(t,"content-type")||fG(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),$8(e,{body:FO(0,dr(n)),headers:FO(0,t)})}return e};if(oR(HO)&&rR({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return HO(e,arguments.length>1?ZO(arguments[1]):{})}}),oR(q_)){var hR=function(e){return jO(this,lR),new q_(e,arguments.length>1?ZO(arguments[1]):{})};lR.constructor=hR,hR.prototype=lR,rR({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:hR})}}var mG={URLSearchParams:$_,getState:ds},eN=T(ir.URLSearchParams),_G={isBrowser:!0,classes:{URLSearchParams:eN!==void 0?eN:Gy,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const pR=typeof window<"u"&&typeof document<"u",fR=typeof navigator=="object"&&navigator||void 0,EG=pR&&(!fR||["ReactNative","NativeScript","NS"].indexOf(fR.product)<0),gG=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",SG=pR&&window.location.href||"http://localhost";function tN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function nN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tN(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tN(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var wr=nN(nN({},Object.freeze({__proto__:null,hasBrowserEnv:pR,hasStandardBrowserEnv:EG,hasStandardBrowserWebWorkerEnv:gG,navigator:fR,origin:SG})),_G),TG=Si,vG=ft,yG=Kn,RG=Z,bG=function(){var e=TG(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},iN=RegExp.prototype,rN=function(e){var t=e.flags;return t!==void 0||"flags"in iN||yG(e,"flags")||!RG(iN,e)?t:vG(bG,e)},CG=gy.charAt,sN=ft,wG=Si,AG=Ze,IG=xe,OG=/./.exec,NG=TypeError,DG=_t,oN=ft,aN=Ge,PG=jh,J_=B,cN=oo,lN=ch,dp=$i,LG=Si,kG=is,xG=xe,MG=hh,dN=rN,UG=Vl,jG=R,VG=Wh,FG=function(e,t,n){return t+(n?CG(e,t).length:1)},BG=function(e,t){var n=e.exec;if(AG(n)){var i=sN(n,e,t);return i!==null&&wG(i),i}if(IG(e)==="RegExp")return sN(OG,e,t);throw NG("RegExp#exec called on incompatible receiver")},uN=ea,GG=hn("matchAll"),hN="RegExp String",pN=hN+" Iterator",HG=uN.set,WG=uN.getterFor(pN),KG=TypeError,mR=aN("".indexOf),X_=aN("".matchAll),_R=!!X_&&!jG(function(){X_("a",/./)}),YG=PG(function(e,t,n,i){HG(this,{type:pN,regexp:e,string:t,global:n,unicode:i,done:!1})},hN,function(){var e=WG(this);if(e.done)return J_(void 0,!0);var t=e.regexp,n=e.string,i=BG(t,n);return i===null?(e.done=!0,J_(void 0,!0)):e.global?(dp(i[0])===""&&(t.lastIndex=FG(n,lN(t.lastIndex),e.unicode)),J_(i,!1)):(e.done=!0,J_(i,!1))}),fN=function(e){var t,n,i,r=LG(this),s=dp(e),o=VG(r,RegExp),c=dp(dN(r));return t=new o(o===RegExp?r.source:r,c),n=!!~mR(c,"g"),i=!!~mR(c,"u"),t.lastIndex=lN(r.lastIndex),new YG(t,s,n,i)};DG({target:"String",proto:!0,forced:_R},{matchAll:function(e){var t,n,i,r,s=cN(this);if(kG(e)){if(_R)return X_(s,e)}else{if(MG(e)&&(t=dp(cN(dN(e))),!~mR(t,"g")))throw KG("`.matchAll` does not allow non-global regexes");if(_R)return X_(s,e);if((i=UG(e,GG))===void 0&&xG(e)=="RegExp"&&(i=fN),i)return oN(i,e,s)}return n=dp(s),r=new RegExp(e,"g"),oN(fN,r,n)}});var zG=qi("String").matchAll,qG=Z,$G=zG,ER=String.prototype,JG=function(e){var t=e.matchAll;return typeof e=="string"||e===ER||qG(ER,e)&&t===ER.matchAll?$G:t},XG=T(JG);function mN(e){function t(n,i,r,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),u=s>=n.length;return o=!o&&_e.isArray(r)?r.length:o,u?(_e.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!c):(r[o]&&_e.isObject(r[o])||(r[o]=[]),t(n,i,r[o],s)&&_e.isArray(r[o])&&(r[o]=function(p){const m={},_=Object.keys(p);let g;const v=_.length;let D;for(g=0;g<v;g++)D=_[g],m[D]=p[D];return m}(r[o])),!c)}if(_e.isFormData(e)&&_e.isFunction(e.entries)){const n={};return _e.forEachEntry(e,(i,r)=>{t(function(s){return XG(_e).call(_e,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(i),r,n,0)}),n}return null}const gR={transitional:C0,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=_e.isObject(e);if(r&&_e.isHTMLForm(e)&&(e=new FormData(e)),_e.isFormData(e))return i?JSON.stringify(mN(e)):e;if(_e.isArrayBuffer(e)||_e.isBuffer(e)||_e.isStream(e)||_e.isFile(e)||_e.isBlob(e)||_e.isReadableStream(e))return e;if(_e.isArrayBufferView(e))return e.buffer;if(_e.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,c){return j_(o,new wr.classes.URLSearchParams,Object.assign({visitor:function(u,p,m,_){return wr.isNode&&_e.isBuffer(u)?(this.append(p,u.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},c))}(e,this.formSerializer).toString();if((s=_e.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return j_(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(o,c,u){if(_e.isString(o))try{return(c||JSON.parse)(o),vi(_e).call(_e,o)}catch(p){if(p.name!=="SyntaxError")throw p}return(0,JSON.stringify)(o)}(e)):e}],transformResponse:[function(e){const t=this.transitional||gR.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(_e.isResponse(e)||_e.isReadableStream(e))return e;if(e&&_e.isString(e)&&(n&&!this.responseType||i)){const r=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(s){if(r)throw s.name==="SyntaxError"?Ot.from(s,Ot.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wr.classes.FormData,Blob:wr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_e.forEach(["delete","get","head","post","put","patch"],e=>{gR.headers[e]={}});var SR=gR;const QG=_e.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_N=Symbol("internals");function up(e){var t;return e&&vi(t=String(e)).call(t).toLowerCase()}function Q_(e){return e===!1||e==null?e:_e.isArray(e)?e.map(Q_):String(e)}function TR(e,t,n,i,r){return _e.isFunction(i)?i.call(this,t,n):(r&&(t=n),_e.isString(t)?_e.isString(i)?t.indexOf(i)!==-1:_e.isRegExp(i)?i.test(t):void 0:void 0)}class Z_{constructor(t){t&&this.set(t)}set(t,n,i){const r=this;function s(u,p,m){const _=up(p);if(!_)throw new Error("header name must be a non-empty string");const g=_e.findKey(r,_);(!g||r[g]===void 0||m===!0||m===void 0&&r[g]!==!1)&&(r[g||p]=Q_(u))}const o=(u,p)=>_e.forEach(u,(m,_)=>s(m,_,p));if(_e.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(_e.isString(t)&&(t=vi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(vi(c=t).call(c)))o((u=>{const p={};let m,_,g;return u&&u.split(`
`).forEach(function(v){var D,C;g=v.indexOf(":"),m=vi(D=v.substring(0,g)).call(D).toLowerCase(),_=vi(C=v.substring(g+1)).call(C),!m||p[m]&&QG[m]||(m==="set-cookie"?p[m]?p[m].push(_):p[m]=[_]:p[m]=p[m]?p[m]+", "+_:_)}),p})(t),n);else if(_e.isHeaders(t))for(const[u,p]of t.entries())s(p,u,i);else t!=null&&s(n,t,i);var c;return this}get(t,n){if(t=up(t)){const i=_e.findKey(this,t);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=c.exec(s);)o[u[1]]=u[2];return o}(r);if(_e.isFunction(n))return n.call(this,r,i);if(_e.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=up(t)){const i=_e.findKey(this,t);return!(!i||this[i]===void 0||n&&!TR(0,this[i],i,n))}return!1}delete(t,n){const i=this;let r=!1;function s(o){if(o=up(o)){const c=_e.findKey(i,o);!c||n&&!TR(0,i[c],c,n)||(delete i[c],r=!0)}}return _e.isArray(t)?t.forEach(s):s(t),r}clear(t){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];t&&!TR(0,this[s],s,t,!0)||(delete this[s],r=!0)}return r}normalize(t){const n=this,i={};return _e.forEach(this,(r,s)=>{var o;const c=_e.findKey(i,s);if(c)return n[c]=Q_(r),void delete n[s];const u=t?function(p){return vi(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,_,g)=>_.toUpperCase()+g)}(s):vi(o=String(s)).call(o);u!==s&&delete n[s],n[u]=Q_(r),i[u]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return _e.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=t&&_e.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[_N]=this[_N]={accessors:{}}).accessors,i=this.prototype;function r(s){const o=up(s);n[o]||(function(c,u){const p=_e.toCamelCase(" "+u);["get","set","has"].forEach(m=>{Object.defineProperty(c,m+p,{value:function(_,g,v){return this[m].call(this,u,_,g,v)},configurable:!0})})}(i,s),n[o]=!0)}return _e.isArray(t)?t.forEach(r):r(t),this}}Z_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),_e.reduceDescriptors(Z_.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(r){this[i]=r}}}),_e.freezeMethods(Z_);var Ws=Z_;function vR(e,t){const n=this||SR,i=t||n,r=Ws.from(i.headers);let s=i.data;return _e.forEach(e,function(o){s=o.call(n,s,r.normalize(),t?t.status:void 0)}),r.normalize(),s}function EN(e){return!(!e||!e.__CANCEL__)}function Ud(e,t,n){Ot.call(this,e??"canceled",Ot.ERR_CANCELED,t,n),this.name="CanceledError"}function gN(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Ot("Request failed with status code "+n.status,[Ot.ERR_BAD_REQUEST,Ot.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}_e.inherits(Ud,Ot,{__CANCEL__:!0});const eE=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,o){s=s||10;const c=new Array(s),u=new Array(s);let p,m=0,_=0;return o=o!==void 0?o:1e3,function(g){const v=Date.now(),D=u[_];p||(p=v),c[m]=g,u[m]=v;let C=_,w=0;for(;C!==m;)w+=c[C++],C%=s;if(m=(m+1)%s,m===_&&(_=(_+1)%s),v-p<o)return;const P=D&&v-D;return P?Math.round(1e3*w/P):void 0}}(50,250);return function(s,o){let c,u,p=0,m=1e3/o;const _=function(g){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,u&&(clearTimeout(u),u=null),s.apply(null,g)};return[function(){const g=Date.now(),v=g-p;for(var D=arguments.length,C=new Array(D),w=0;w<D;w++)C[w]=arguments[w];v>=m?_(C,g):(c=C,u||(u=setTimeout(()=>{u=null,_(c)},m-v)))},()=>c&&_(c)]}(s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,u=o-i,p=r(u);i=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&o<=c?(c-o)/p:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})},n)},SN=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},TN=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return _e.asap(()=>e(...n))};var ZG=wr.hasStandardBrowserEnv?function(){const e=wr.navigator&&/(msie|trident)/i.test(wr.navigator.userAgent),t=document.createElement("a");let n;function i(r){let s=r;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(r){const s=_e.isString(r)?i(r):r;return s.protocol===n.protocol&&s.host===n.host}}():function(){return!0},eH=wr.hasStandardBrowserEnv?{write(e,t,n,i,r,s){const o=[e+"="+encodeURIComponent(t)];_e.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),_e.isString(i)&&o.push("path="+i),_e.isString(r)&&o.push("domain="+r),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function vN(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(e,t):t}function yN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const RN=e=>e instanceof Ws?function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?yN(Object(i),!0).forEach(function(r){O(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):yN(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}({},e):e;function rl(e,t){t=t||{};const n={};function i(p,m,_){return _e.isPlainObject(p)&&_e.isPlainObject(m)?_e.merge.call({caseless:_},p,m):_e.isPlainObject(m)?_e.merge({},m):_e.isArray(m)?m.slice():m}function r(p,m,_){return _e.isUndefined(m)?_e.isUndefined(p)?void 0:i(void 0,p,_):i(p,m,_)}function s(p,m){if(!_e.isUndefined(m))return i(void 0,m)}function o(p,m){return _e.isUndefined(m)?_e.isUndefined(p)?void 0:i(void 0,p):i(void 0,m)}function c(p,m,_){return _ in t?i(p,m):_ in e?i(void 0,p):void 0}const u={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(p,m)=>r(RN(p),RN(m),!0)};return _e.forEach(Object.keys(Object.assign({},e,t)),function(p){const m=u[p]||r,_=m(e[p],t[p],p);_e.isUndefined(_)&&m!==c||(n[p]=_)}),n}var bN=e=>{const t=rl({},e);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:u}=t;if(t.headers=c=Ws.from(c),t.url=R0(vN(t.baseURL,t.url),e.params,e.paramsSerializer),u&&c.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),_e.isFormData(i)){if(wr.hasStandardBrowserEnv||wr.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[p,...m]=n?n.split(";").map(_=>vi(_).call(_)).filter(Boolean):[];c.setContentType([p||"multipart/form-data",...m].join("; "))}}if(wr.hasStandardBrowserEnv&&(r&&_e.isFunction(r)&&(r=r(t)),r||r!==!1&&ZG(t.url))){const p=s&&o&&eH.read(o);p&&c.set(s,p)}return t},tH=typeof XMLHttpRequest<"u"&&function(e){return new ve(function(t,n){const i=bN(e);let r=i.data;const s=Ws.from(i.headers).normalize();let o,c,u,p,m,{responseType:_,onUploadProgress:g,onDownloadProgress:v}=i;function D(){p&&p(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(o),i.signal&&i.signal.removeEventListener("abort",o)}let C=new XMLHttpRequest;function w(){if(!C)return;const L=Ws.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders());gN(function(G){t(G),D()},function(G){n(G),D()},{data:_&&_!=="text"&&_!=="json"?C.response:C.responseText,status:C.status,statusText:C.statusText,headers:L,config:e,request:C}),C=null}C.open(i.method.toUpperCase(),i.url,!0),C.timeout=i.timeout,"onloadend"in C?C.onloadend=w:C.onreadystatechange=function(){C&&C.readyState===4&&(C.status!==0||C.responseURL&&C.responseURL.indexOf("file:")===0)&&setTimeout(w)},C.onabort=function(){C&&(n(new Ot("Request aborted",Ot.ECONNABORTED,e,C)),C=null)},C.onerror=function(){n(new Ot("Network Error",Ot.ERR_NETWORK,e,C)),C=null},C.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const G=i.transitional||C0;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),n(new Ot(L,G.clarifyTimeoutError?Ot.ETIMEDOUT:Ot.ECONNABORTED,e,C)),C=null},r===void 0&&s.setContentType(null),"setRequestHeader"in C&&_e.forEach(s.toJSON(),function(L,G){C.setRequestHeader(G,L)}),_e.isUndefined(i.withCredentials)||(C.withCredentials=!!i.withCredentials),_&&_!=="json"&&(C.responseType=i.responseType),v&&([u,m]=eE(v,!0),C.addEventListener("progress",u)),g&&C.upload&&([c,p]=eE(g),C.upload.addEventListener("progress",c),C.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(o=L=>{C&&(n(!L||L.type?new Ud(null,e,C):L),C.abort(),C=null)},i.cancelToken&&i.cancelToken.subscribe(o),i.signal&&(i.signal.aborted?o():i.signal.addEventListener("abort",o)));const P=function(L){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(L);return G&&G[1]||""}(i.url);P&&wr.protocols.indexOf(P)===-1?n(new Ot("Unsupported protocol "+P+":",Ot.ERR_BAD_REQUEST,e)):C.send(r||null)})},nH=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,r=new AbortController;const s=function(p){if(!i){i=!0,c();const m=p instanceof Error?p:this.reason;r.abort(m instanceof Ot?m:new Ud(m instanceof Error?m.message:m))}};let o=t&&setTimeout(()=>{o=null,s(new Ot("timeout ".concat(t," of ms exceeded"),Ot.ETIMEDOUT))},t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),e=null)};e.forEach(p=>p.addEventListener("abort",s));const{signal:u}=r;return u.unsubscribe=()=>_e.asap(c),u}},iH=ZA,rH=vo;_t({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=rH.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var sH=vo,oH=bd;_t({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=sH.f(this),n=oH(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var yR=T(iH),CN=Od.f("asyncIterator"),aH=T(CN);function RR(e,t){this.v=e,this.k=t}function hp(e){var t,n;function i(s,o){try{var c=e[s](o),u=c.value,p=u instanceof RR;yR.resolve(p?u.v:u).then(function(m){if(p){var _=s==="return"?"return":"next";if(!u.k||m.done)return i(_,m);m=e[_](m).value}r(c.done?"return":"normal",m)},function(m){i("throw",m)})}catch(m){r("throw",m)}}function r(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(s,o){return new yR(function(c,u){var p={key:s,arg:o,resolve:c,reject:u,next:null};n?n=n.next=p:(t=n=p,i(s,o))})},typeof e.return!="function"&&(this.return=void 0)}function Hr(e){return function(){return new hp(e.apply(this,arguments))}}function ct(e){return new RR(e,0)}function tE(e){var t={},n=!1;function i(r,s){return n=!0,{done:!1,value:new RR(s=new yR(function(o){o(e[r](s))}),1)}}return t[Pd!==void 0&&xO||"@@iterator"]=function(){return this},t.next=function(r){return n?(n=!1,r):i("next",r)},typeof e.throw=="function"&&(t.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof e.return=="function"&&(t.return=function(r){return n?(n=!1,r):i("return",r)}),t}hp.prototype[typeof Pd=="function"&&aH||"@@asyncIterator"]=function(){return this},hp.prototype.next=function(e){return this._invoke("next",e)},hp.prototype.throw=function(e){return this._invoke("throw",e)},hp.prototype.return=function(e){return this._invoke("return",e)};var bR=T(CN);function CR(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=bR,i=Symbol.iterator);r--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new nE(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function nE(e){function t(n){if(Object(n)!==n)return ve.reject(new TypeError(n+" is not an object."));var i=n.done;return ve.resolve(n.value).then(function(r){return{value:r,done:i}})}return nE=function(n){this.s=n,this.n=n.next},nE.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ve.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ve.reject(n):t(i.apply(this.s,arguments))}},new nE(e)}const cH=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},lH=function(){var e=Hr(function*(t,n){var i,r=!1,s=!1;try{for(var o,c=CR(dH(t));r=!(o=yield ct(c.next())).done;r=!1){const u=o.value;yield*tE(CR(cH(u,n)))}}catch(u){s=!0,i=u}finally{try{r&&c.return!=null&&(yield ct(c.return()))}finally{if(s)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),dH=function(){var e=Hr(function*(t){if(t[bR])return void(yield*tE(CR(t)));const n=t.getReader();try{for(;;){const{done:i,value:r}=yield ct(n.read());if(i)break;yield r}}finally{yield ct(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),wN=(e,t,n,i)=>{const r=lH(e,t);let s,o=0,c=u=>{s||(s=!0,i&&i(u))};return new ReadableStream({async pull(u){try{const{done:p,value:m}=await r.next();if(p)return c(),void u.close();let _=m.byteLength;if(n){let g=o+=_;n(g)}u.enqueue(new Uint8Array(m))}catch(p){throw c(p),p}},cancel:u=>(c(u),r.return())},{highWaterMark:2})};function AN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function IN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AN(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AN(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const iE=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ON=iE&&typeof ReadableStream=="function",uH=iE&&(typeof TextEncoder=="function"?(NN=new TextEncoder,e=>NN.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var NN;const DN=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},hH=ON&&DN(()=>{let e=!1;const t=new Request(wr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),wR=ON&&DN(()=>_e.isReadableStream(new Response("").body)),rE={stream:wR&&(e=>e.body)};var PN;iE&&(PN=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!rE[e]&&(rE[e]=_e.isFunction(PN[e])?t=>t[e]():(t,n)=>{throw new Ot("Response type '".concat(e,"' is not supported"),Ot.ERR_NOT_SUPPORT,n)})}));const pH=async(e,t)=>{const n=_e.toFiniteNumber(e.getContentLength());return n??(async i=>i==null?0:_e.isBlob(i)?i.size:_e.isSpecCompliantForm(i)?(await new Request(wr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:_e.isArrayBufferView(i)||_e.isArrayBuffer(i)?i.byteLength:(_e.isURLSearchParams(i)&&(i+=""),_e.isString(i)?(await uH(i)).byteLength:void 0))(t)};var fH=iE&&(async e=>{let{url:t,method:n,data:i,signal:r,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:u,responseType:p,headers:m,withCredentials:_="same-origin",fetchOptions:g}=bN(e);p=p?(p+"").toLowerCase():"text";let v,D=nH([r,s&&s.toAbortSignal()],o);const C=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let w;try{if(u&&hH&&n!=="get"&&n!=="head"&&(w=await pH(m,i))!==0){let K,ee=new Request(t,{method:"POST",body:i,duplex:"half"});if(_e.isFormData(i)&&(K=ee.headers.get("content-type"))&&m.setContentType(K),ee.body){const[ae,fe]=SN(w,eE(TN(u)));i=wN(ee.body,65536,ae,fe)}}_e.isString(_)||(_=_?"include":"omit");const P="credentials"in Request.prototype;v=new Request(t,IN(IN({},g),{},{signal:D,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:P?_:void 0}));let L=await fetch(v);const G=wR&&(p==="stream"||p==="response");if(wR&&(c||G&&C)){const K={};["status","statusText","headers"].forEach(de=>{K[de]=L[de]});const ee=_e.toFiniteNumber(L.headers.get("content-length")),[ae,fe]=c&&SN(ee,eE(TN(c),!0))||[];L=new Response(wN(L.body,65536,ae,()=>{fe&&fe(),C&&C()}),K)}p=p||"text";let W=await rE[_e.findKey(rE,p)||"text"](L,e);return!G&&C&&C(),await new ve((K,ee)=>{gN(K,ee,{data:W,headers:Ws.from(L.headers),status:L.status,statusText:L.statusText,config:e,request:v})})}catch(P){throw C&&C(),P&&P.name==="TypeError"&&/fetch/i.test(P.message)?Object.assign(new Ot("Network Error",Ot.ERR_NETWORK,e,v),{cause:P.cause||P}):Ot.from(P,P&&P.code,e,v)}});const AR={http:null,xhr:tH,fetch:fH};_e.forEach(AR,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const LN=e=>"- ".concat(e),mH=e=>_e.isFunction(e)||e===null||e===!1;var kN={getAdapter:e=>{e=_e.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let s=0;s<t;s++){let o;if(n=e[s],i=n,!mH(n)&&(i=AR[(o=String(n)).toLowerCase()],i===void 0))throw new Ot("Unknown adapter '".concat(o,"'"));if(i)break;r[o||"#"+s]=i}if(!i){const s=Object.entries(r).map(o=>{let[c,u]=o;return"adapter ".concat(c," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new Ot("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(LN).join(`
`):" "+LN(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:AR};function IR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ud(null,e)}function xN(e){return IR(e),e.headers=Ws.from(e.headers),e.data=vR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),kN.getAdapter(e.adapter||SR.adapter)(e).then(function(t){return IR(e),t.data=vR.call(e,e.transformResponse,t),t.headers=Ws.from(t.headers),t},function(t){return EN(t)||(IR(e),t&&t.response&&(t.response.data=vR.call(e,e.transformResponse,t.response),t.response.headers=Ws.from(t.response.headers))),ve.reject(t)})}const MN="1.7.7",OR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{OR[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const UN={};OR.transitional=function(e,t,n){function i(r,s){return"[Axios v"+MN+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,o)=>{if(e===!1)throw new Ot(i(s," has been removed"+(t?" in "+t:"")),Ot.ERR_DEPRECATED);return t&&!UN[s]&&(UN[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,s,o)}};var NR={assertOptions:function(e,t,n){if(typeof e!="object")throw new Ot("options must be an object",Ot.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const s=i[r],o=t[s];if(o){const c=e[s],u=c===void 0||o(c,s,e);if(u!==!0)throw new Ot("option "+s+" must be "+u,Ot.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ot("Unknown option "+s,Ot.ERR_BAD_OPTION)}},validators:OR};const ic=NR.validators;let sE=class{constructor(e){this.defaults=e,this.interceptors={request:new b0,response:new b0}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=rl(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;n!==void 0&&NR.assertOptions(n,{silentJSONParsing:ic.transitional(ic.boolean),forcedJSONParsing:ic.transitional(ic.boolean),clarifyTimeoutError:ic.transitional(ic.boolean)},!1),i!=null&&(_e.isFunction(i)?t.paramsSerializer={serialize:i}:NR.assertOptions(i,{encode:ic.function,serialize:ic.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=r&&_e.merge(r.common,r[t.method]);r&&_e.forEach(["delete","get","head","post","put","patch","common"],v=>{delete r[v]}),t.headers=Ws.concat(s,r);const o=[];let c=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(c=c&&v.synchronous,o.unshift(v.fulfilled,v.rejected))});const u=[];let p;this.interceptors.response.forEach(function(v){u.push(v.fulfilled,v.rejected)});let m,_=0;if(!c){const v=[xN.bind(this),void 0];for(v.unshift.apply(v,o),v.push.apply(v,u),m=v.length,p=ve.resolve(t);_<m;)p=p.then(v[_++],v[_++]);return p}m=o.length;let g=t;for(_=0;_<m;){const v=o[_++],D=o[_++];try{g=v(g)}catch(C){D.call(this,C);break}}try{p=xN.call(this,g)}catch(v){return ve.reject(v)}for(_=0,m=u.length;_<m;)p=p.then(u[_++],u[_++]);return p}getUri(e){return R0(vN((e=rl(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};_e.forEach(["delete","get","head","options"],function(e){sE.prototype[e]=function(t,n){return this.request(rl(n||{},{method:e,url:t,data:(n||{}).data}))}}),_e.forEach(["post","put","patch"],function(e){function t(n){return function(i,r,s){return this.request(rl(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}sE.prototype[e]=t(),sE.prototype[e+"Form"]=t(!0)});var oE=sE;class DR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ve(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new ve(c=>{i.subscribe(c),s=c}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},t(function(r,s,o){i.reason||(i.reason=new Ud(r,s,o),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new DR(function(n){t=n}),cancel:t}}}var _H=DR;const PR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(PR).forEach(e=>{let[t,n]=e;PR[n]=t});var EH=PR;const Ei=function e(t){const n=new oE(t),i=s0(oE.prototype.request,n);return _e.extend(i,oE.prototype,n,{allOwnKeys:!0}),_e.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return e(rl(t,r))},i}(SR);Ei.Axios=oE,Ei.CanceledError=Ud,Ei.CancelToken=_H,Ei.isCancel=EN,Ei.VERSION=MN,Ei.toFormData=j_,Ei.AxiosError=Ot,Ei.Cancel=Ei.CanceledError,Ei.all=function(e){return ve.all(e)},Ei.spread=function(e){return function(t){return e.apply(null,t)}},Ei.isAxiosError=function(e){return _e.isObject(e)&&e.isAxiosError===!0},Ei.mergeConfig=rl,Ei.AxiosHeaders=Ws,Ei.formToJSON=e=>mN(_e.isHTMLForm(e)?new FormData(e):e),Ei.getAdapter=kN.getAdapter,Ei.HttpStatusCode=EH,Ei.default=Ei;var Bi=Ei;const gH=()=>{};function pp(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:gH};return e.promise=new ve((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const aE=new Map,cE=new Map,Ro=new Map;let Vn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),vt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const jN=new i6;let Ks=jN.getResult(),LR=null;function ut(e){if(!LR){Ks=jN.getResult();const t=function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return vt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return vt.CHROME;case"Safari":case"Mobile Safari":return vt.SAFARI;case"Edge":return vt.EDGE;case"Firefox":return vt.FIREFOX;case"QQ":case"QQBrowser":return vt.QQ;case"Opera":return vt.OPERA;case"WeChat":return vt.WECHAT;default:return c.browser.name||""}}(Ks),n=VN(Ks),i=function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""}(Ks),r=Ks.os.version,s=VN(Ks,!1),o=Ks.device.type;if(!(t&&n&&i&&r))return{name:t,version:n,os:i,osVersion:r,browserVersion:s,deviceType:o};LR={name:t,version:n,os:i,osVersion:r,browserVersion:s,deviceType:o}}return LR}function VN(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function lE(){return ut().os}function FN(){const e=ut();return"".concat(e.os," ").concat(e.osVersion)}function dE(){const e=ut();return!!(Ks.engine.name==="WebKit"&&e.os===Vn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==vt.SAFARI||Oi()&&e.name!==vt.SAFARI)}function rc(){return ut().name===vt.CHROME}function ni(){return ut().name===vt.SAFARI}function BN(){return ut().name===vt.EDGE}function on(){return ut().name===vt.FIREFOX}function Oi(){return ut().os===Vn.IOS}function kR(e){const t=ut();return!(t.name!==vt.CHROME||!t.osVersion)&&Number(t.version)>=e}function GN(e){const t=ut();return!(t.name!==vt.CHROME||!t.osVersion)&&Number(t.version)<e}function HN(e){const t=ut();return!(t.name!==vt.EDGE||!t.osVersion)&&Number(t.version)>=e}function WN(e){const t=ut();return!(t.name!==vt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function KN(e,t,n){const i=ut();if(i.os!==Vn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e}function YN(e,t,n){const i=ut();if(i.name!==vt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e}function zN(e){const t=ut();return!(t.name!==vt.OPERA||!t.osVersion)&&Number(t.version)>=e}function qN(){const e=ut();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function jd(){const e=ut();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function xR(){const e=ut();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function $N(){const e=ut();if(e.os!==Vn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function us(){return ni()&&navigator.maxTouchPoints>0}function JN(){return ut().name===vt.WECHAT}function XN(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function MR(){const e=lE();return function(){const{deviceType:t}=ut();return t==="mobile"||t==="tablet"}()||e===Vn.ANDROID||e===Vn.IOS||e===Vn.HARMONY_OS}function sc(){const e=ut();return e.name!==vt.EDGE&&e.name!==vt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function uE(){return lE()===Vn.ANDROID}function fp(){const e=ut();return uE()&&(e.name===vt.CHROME||e.name===vt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Kt(e,t,n){return(t=function(i){var r=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var u=c.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QN(Object(n),!0).forEach(function(i){Kt(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QN(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let k=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),te=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Kt(this,"code",void 0),Kt(this,"message",void 0),Kt(this,"data",void 0),Kt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function da(e,t){if(typeof e!="boolean")throw new te(k.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Un(e,t,n){if(!ge(n).call(n,e))throw new te(k.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Nt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(e))throw new te(k.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function UR(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new te(k.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Nt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Nt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Nt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Nt(e.ideal,"".concat(t,".ideal"),1,1/0)}else Nt(e,t,1,1/0)}function qn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new te(k.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!ZN(e,n,i,r))throw new te(k.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function ua(e,t){if(!Array.isArray(e))throw new te(k.INVALID_PARAMS,"".concat(t," should be an array"))}function tn(e){return e==null}function ZN(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const o=r.charCodeAt(s);if(o<0||o>255)return!1}return!0}(e))}var mp=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(mp||{}),jR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(jR||{});const eD=new class{constructor(){Kt(this,"_clientSize",null),Kt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Kt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Kt(this,"getStyle",e=>window.getComputedStyle(e,null)),Kt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:r,visibility:s,opacity:o,filter:c}=i;return(r==="none"||ge(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter(u=>{var p;const m=u.split("(")[0];return ge(p=["brightness","blur","opacity"]).call(p,m)}).map(u=>{const[p,m]=u.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(u=>{const[p,m]=u;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),Kt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const r=o=>t(o);let s=e;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),Kt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Kt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:r,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:i,right:r,top:s,bottom:o,clientWidth:c,clientHeight:u,clientMin:Math.min(c,u)}}),Kt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Kt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Kt(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),Kt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,r=e/6,s=t/6,o=[],c=10**6;for(let u=0;u<5;u++)for(let p=0;p<5;p++){const m=(n*c+(u===0?.1:u===4?(r*u*c-1e5)/c:r*u)*c)/c,_=(i*c+(p===0?.1:p===4?(s*p*c-1e5)/c:s*p)*c)/c;o.push({x:m,y:_})}return[...o]}),Kt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Kt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Kt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:o}=this._clientSize;let c,u,p,m;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(u=t<s?t:s,n<0)p=0;else{if(!(n<r))return!1;p=n}if(i<0)return!1;m=i<r?i:r;const _=u-c,g=m-p;return this.checkSizeIsVisible(_,g,o)}),Kt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Kt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(mp.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(mp.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(mp.SIZE)}}return this.returnHiddenResult(mp.STYLE)}return this.returnHiddenResult(jR.UNMOUNTED)}return this.returnHiddenResult(jR.INVALID_HTML_ELEMENT)}),Kt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function VR(e){return new TextEncoder().encode(e)}const tD=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},FR=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",VR(e)),16);class nn{constructor(){Kt(this,"_events",{}),Kt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],r=this._indexOfListener(i,n);r!==-1&&i.splice(r,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(o=>o);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,r||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,i)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o==null?void 0:o.toString()))}})}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}let _p=null;function nD(){if(_p)return _p;if(window.electron)return _p=window.electron;if(!window.require)return null;try{return _p=window.require("electron"),_p}catch{return null}}let Ln=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),an=function(e){return e.TRACER="tracer",e}({});function iD(e){return Nt(e.timeout,"config.timeout",0,1e5),Nt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Nt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Nt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let SH=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),bt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function hE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function rD(e){return qn(e.turnServerURL,"turnServerURL"),qn(e.username,"username"),qn(e.password,"password"),e.udpport&&Nt(e.udpport,"udpport",1,99999,!0),e.forceturn&&da(e.forceturn,"forceturn"),e.security&&da(e.security,"security"),e.tcpport&&Nt(e.tcpport,"tcpport",1,99999,!0),!0}function sD(e){return e.level!==void 0&&Un(e.level,"level",[1,2,3]),e.delay!==void 0&&Nt(e.delay,"delay",0,3e3,!0),!0}let st=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ii=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),ur=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Vd=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ri(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return e.getListeners(t).length===0?ve.reject(new te(k.UNEXPECTED_ERROR,"can not emit promise")):new ve((s,o)=>{e.emit(t,...i,s,o)})}function Lt(e,t){if(e.getListeners(t).length===0)return ve.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return ri(e,t,...i)}function Wr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Ep(e,t,...i)}function Ep(e,t){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),o=2;o<r;o++)s[o-2]=arguments[o];if(e.emit(t,...s,c=>{n=c},c=>{i=c}),i!==null)throw i;if(n===null)throw new te(k.UNEXPECTED_ERROR,"handler is not sync");return n}const Tn=new class extends nn{set networkState(e){this.emit(Vd.NETWORK_STATE_CHANGE,e,this._networkState),e===ur.ONLINE?this.emit(Vd.ONLINE):e===ur.OFFLINE&&(this.onlineWaiter=new ve(t=>{this.once(Vd.ONLINE,()=>{this.onlineWaiter=void 0,t(ur.ONLINE)})}),this.emit(Vd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ur.ONLINE}constructor(){super(),Kt(this,"_moduleName","network-indicator"),Kt(this,"_networkState",ur.ONLINE),Kt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ur.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ur.OFFLINE})}};function pE(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Fd(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function fE(e){ve!==void 0?ve.resolve().then(e):setTimeout(e,0)}function fn(e){return JSON.parse(JSON.stringify(e))}function sl(e){try{return fn(e)}catch{return e}}const oD={};function oc(e,t){oD[t]||(oD[t]=!0,e())}function ol(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function ac(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function aD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function cD(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=yr(t).call(t,(o,c)=>o+c.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return t.forEach(o=>{r.set(o,s),s+=o.length}),r}function bo(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function lD(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?bo(n):n.size}),t+138}function TH(e){const t=new te(k.TIMEOUT,"timeout");return new ve((n,i)=>{window.setTimeout(()=>i(t),e)})}function $n(e){return new ve(t=>{window.setTimeout(t,e)})}function jt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+jt(e-n.length,"")}function Bd(){return jt(32,"").toUpperCase()}const mE=()=>{},dD=new class{constructor(){Kt(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),o=4;o<r;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const u=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:s,skipFn:i})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,De(De({},c),{},{fn:e,args:s,skipFn:i}))}else{const c=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:i})}}},uD=dD.throttleByKey.bind(dD);function hD(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function BR(e,t){if(!hD(e)||!hD(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=BR(e[i],t[i]);return n}{const n=De({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=BR(e[i],t[i]):n[i]=t[i]);return n}}function pD(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function GR(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function fD(e){const t="0123456789abcdef";function n(G){let W,K="";for(W=0;W<=3;W++)K+=t.charAt(G>>8*W+4&15)+t.charAt(G>>8*W&15);return K}function i(G,W){const K=(65535&G)+(65535&W);return(G>>16)+(W>>16)+(K>>16)<<16|65535&K}function r(G,W,K,ee,ae,fe){return i(function(de,Ne){return de<<Ne|de>>>32-Ne}(i(i(W,G),i(ee,fe)),ae),K)}function s(G,W,K,ee,ae,fe,de){return r(W&K|~W&ee,G,W,ae,fe,de)}function o(G,W,K,ee,ae,fe,de){return r(W&ee|K&~ee,G,W,ae,fe,de)}function c(G,W,K,ee,ae,fe,de){return r(W^K^ee,G,W,ae,fe,de)}function u(G,W,K,ee,ae,fe,de){return r(K^(W|~ee),G,W,ae,fe,de)}const p=function(G){let W;const K=1+(G.length+8>>6),ee=new Array(16*K);for(W=0;W<16*K;W++)ee[W]=0;for(W=0;W<G.length;W++)ee[W>>2]|=G.charCodeAt(W)<<W%4*8;return ee[W>>2]|=128<<W%4*8,ee[16*K-2]=8*G.length,ee}(e);let m,_,g,v,D,C=1732584193,w=-271733879,P=-1732584194,L=271733878;for(m=0;m<p.length;m+=16)_=C,g=w,v=P,D=L,C=s(C,w,P,L,p[m+0],7,-680876936),L=s(L,C,w,P,p[m+1],12,-389564586),P=s(P,L,C,w,p[m+2],17,606105819),w=s(w,P,L,C,p[m+3],22,-1044525330),C=s(C,w,P,L,p[m+4],7,-176418897),L=s(L,C,w,P,p[m+5],12,1200080426),P=s(P,L,C,w,p[m+6],17,-1473231341),w=s(w,P,L,C,p[m+7],22,-45705983),C=s(C,w,P,L,p[m+8],7,1770035416),L=s(L,C,w,P,p[m+9],12,-1958414417),P=s(P,L,C,w,p[m+10],17,-42063),w=s(w,P,L,C,p[m+11],22,-1990404162),C=s(C,w,P,L,p[m+12],7,1804603682),L=s(L,C,w,P,p[m+13],12,-40341101),P=s(P,L,C,w,p[m+14],17,-1502002290),w=s(w,P,L,C,p[m+15],22,1236535329),C=o(C,w,P,L,p[m+1],5,-165796510),L=o(L,C,w,P,p[m+6],9,-1069501632),P=o(P,L,C,w,p[m+11],14,643717713),w=o(w,P,L,C,p[m+0],20,-373897302),C=o(C,w,P,L,p[m+5],5,-701558691),L=o(L,C,w,P,p[m+10],9,38016083),P=o(P,L,C,w,p[m+15],14,-660478335),w=o(w,P,L,C,p[m+4],20,-405537848),C=o(C,w,P,L,p[m+9],5,568446438),L=o(L,C,w,P,p[m+14],9,-1019803690),P=o(P,L,C,w,p[m+3],14,-187363961),w=o(w,P,L,C,p[m+8],20,1163531501),C=o(C,w,P,L,p[m+13],5,-1444681467),L=o(L,C,w,P,p[m+2],9,-51403784),P=o(P,L,C,w,p[m+7],14,1735328473),w=o(w,P,L,C,p[m+12],20,-1926607734),C=c(C,w,P,L,p[m+5],4,-378558),L=c(L,C,w,P,p[m+8],11,-2022574463),P=c(P,L,C,w,p[m+11],16,1839030562),w=c(w,P,L,C,p[m+14],23,-35309556),C=c(C,w,P,L,p[m+1],4,-1530992060),L=c(L,C,w,P,p[m+4],11,1272893353),P=c(P,L,C,w,p[m+7],16,-155497632),w=c(w,P,L,C,p[m+10],23,-1094730640),C=c(C,w,P,L,p[m+13],4,681279174),L=c(L,C,w,P,p[m+0],11,-358537222),P=c(P,L,C,w,p[m+3],16,-722521979),w=c(w,P,L,C,p[m+6],23,76029189),C=c(C,w,P,L,p[m+9],4,-640364487),L=c(L,C,w,P,p[m+12],11,-421815835),P=c(P,L,C,w,p[m+15],16,530742520),w=c(w,P,L,C,p[m+2],23,-995338651),C=u(C,w,P,L,p[m+0],6,-198630844),L=u(L,C,w,P,p[m+7],10,1126891415),P=u(P,L,C,w,p[m+14],15,-1416354905),w=u(w,P,L,C,p[m+5],21,-57434055),C=u(C,w,P,L,p[m+12],6,1700485571),L=u(L,C,w,P,p[m+3],10,-1894986606),P=u(P,L,C,w,p[m+10],15,-1051523),w=u(w,P,L,C,p[m+1],21,-2054922799),C=u(C,w,P,L,p[m+8],6,1873313359),L=u(L,C,w,P,p[m+15],10,-30611744),P=u(P,L,C,w,p[m+6],15,-1560198380),w=u(w,P,L,C,p[m+13],21,1309151649),C=u(C,w,P,L,p[m+4],6,-145523070),L=u(L,C,w,P,p[m+11],10,-1120210379),P=u(P,L,C,w,p[m+2],15,718787259),w=u(w,P,L,C,p[m+9],21,-343485551),C=i(C,_),w=i(w,g),P=i(P,v),L=i(L,D);return n(C)+n(w)+n(P)+n(L)}let vH=1,mD=console,ui=class{static setLogger(e){mD=e}constructor(e,t){Kt(this,"id",void 0),Kt(this,"lockingPromise",ve.resolve()),Kt(this,"locks",0),Kt(this,"name",""),Kt(this,"lockId",void 0),this.lockId=vH++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");mD.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new ve(r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Gd(e,t){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(i));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await s.apply(this,p)}finally{c()}},r}}const On={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function HR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ys(e,t,n,i){const r=Object.assign({},On,i);let s=r.timeout;const o=async()=>{await function(p){return new ve(m=>{window.setTimeout(m,p)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let c=!1;const u=new ve(async(p,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let _=0;_<r.maxRetryCount;_+=1){if(c)return m(new te(k.OPERATION_ABORTED));try{const g=await e();if(!t(g,_)||_+1===r.maxRetryCount)return p(g);await o()}catch(g){if(!n(g,_)||_+1===r.maxRetryCount)return m(g);await o()}}});return u.cancel=()=>c=!0,u}class _D{constructor(t){Kt(this,"input",[]),Kt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:yr(t=this.input).call(t,(n,i)=>n+i)/this.input.length}}let _E,EE=0,WR=0;function KR(e,t,n,i){return new ve((r,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),EE+=bo(t.data)):n&&(t.data.size?EE+=t.data.size:t.data instanceof FormData?EE+=lD(t.data):EE+=bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Bi.request(t).then(o=>{typeof o.data=="string"?WR+=bo(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?WR+=o.data.byteLength:WR+=bo(JSON.stringify(o.data)),r(o.data)}).catch(o=>{Bi.isCancel(o)?s(new te(k.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new te(k.NETWORK_TIMEOUT,o.message)):o.response?s(new te(k.NETWORK_RESPONSE_ERROR,o.response.status)):s(new te(k.NETWORK_ERROR,o.message))})})}async function yH(e,t){const n=new Blob([t.data],{type:"buffer"});return await KR(e,De(De({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const ED=()=>window.isSecureContext!==void 0,Kr=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.22.2"),YR=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let al=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const si=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let c=0;c<6;c++)r.push("1");const s=r.join(""),o={};return o[e]=i,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=si;const zR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},qR="v4.22.2-0-g4caa29bb(10/28/2024, 2:37:34 PM)",mn=De(De({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:zR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"]});function Dt(e,t,n){var i,r,s;ge(i=Object.keys(mn)).call(i,e)&&(!n&&ge(r=Object.keys(cc)).call(r,e)||(mn[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(mn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,mn.USE_NEW_NETWORK_CONFIG=s,s&&(mn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],mn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],mn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],mn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],mn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",mn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",mn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(mn.ENABLE_INSTANT_VIDEO=!0,mn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(mn.ENABLE_AUT_CC=!0)))}function V(e){return mn[e]}YR||(mn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],mn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],mn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],mn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],mn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],mn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],mn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",mn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",mn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",mn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",mn.AREAS=["NORTH_AMERICA","OVERSEA"]);const cc={};var nt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(nt||{});class RH{constructor(t,n,i,r){Kt(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:i,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:al.Default}}dispatch(t){this.state=function(n,i){switch(i.type){case nt.SET_SESSION_ID:return De(De({},n),{},{sessionId:i.sessionId});case nt.SET_P2P_ID:return De(De({},n),{},{p2pId:i.p2pId});case nt.SET_UID:return De(De({},n),{},{uid:i.uid});case nt.SET_INT_UID:return De(De({},n),{},{intUid:i.intUid});case nt.SET_PUB_ID:return De(De({},n),{},{pubId:i.pubId});case nt.KEY_METRIC_CLIENT_CREATED:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{clientCreated:i.metric})});case nt.KEY_METRIC_JOIN_START:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{joinStart:i.metric})});case nt.AVOID_JOIN_START:return De(De({},n),{},{avoidJoinStart:i.avoidJoinStart});case nt.KEY_METRIC_JOIN_END:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{joinEnd:i.metric})});case nt.KEY_METRIC_REQUEST_AP_START:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{requestAPStart:i.metric})});case nt.KEY_METRIC_REQUEST_AP_END:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{requestAPEnd:i.metric})});case nt.KEY_METRIC_JOIN_GATEWAY_START:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{joinGatewayStart:i.metric})});case nt.KEY_METRIC_JOIN_GATEWAY_END:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{joinGatewayEnd:i.metric})});case nt.KEY_METRIC_PEER_CONNECTION_START:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{peerConnectionStart:i.metric})});case nt.KEY_METRIC_PEER_CONNECTION_END:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{peerConnectionEnd:i.metric})});case nt.KEY_METRIC_DESCRIPTION_START:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{descriptionStart:i.metric})});case nt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{signalChannelOpen:i.metric})});case nt.KEY_METRIC_ICE_CONNECTION_END:return De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{iceConnectionEnd:i.metric})});case nt.KEY_METRIC_PUBLISH:{const r=n.keyMetrics.publish,s=r.findIndex(o=>o.trackId===i.metric.trackId);return s!==-1?(r[s]=De(De({},r[s]),i.metric),De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{publish:[...r]})})):De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,i.metric]})})}case nt.KEY_METRIC_SUBSCRIBE:{const r=n.keyMetrics.subscribe,s=r.findIndex(o=>o.userId===i.metric.userId&&o.type===i.metric.type);return s!==-1?(r[s]=De(De({},r[s]),i.metric),De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{subscribe:[...r]})})):De(De({},n),{},{keyMetrics:De(De({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,i.metric]})})}case nt.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=i.mode,n;case nt.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,i.record]:(n.joinChannelServiceRecords[i.index]=De(De({},n.joinChannelServiceRecords[i.index]),i.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case nt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case nt.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case nt.SET_USE_P2P:return De(De({},n),{},{useP2P:i.val});case nt.SET_TRANSPORT_TYPE:return De(De({},n),{},{p2pTransport:i.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:nt.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:nt.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:nt.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:nt.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:nt.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:nt.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:nt.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t){this.dispatch({type:nt.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:nt.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:nt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:nt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:nt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:nt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:nt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:nt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:nt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:nt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:nt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:nt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:nt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:nt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,i,r){this.dispatch({type:nt.KEY_METRIC_PUBLISH,metric:De(De({trackId:t,type:n},i&&{publishStart:i}),r&&{publishEnd:r})})}subscribe(t,n,i,r,s,o,c){this.dispatch({type:nt.KEY_METRIC_SUBSCRIBE,metric:De(De(De(De(De({userId:t,type:n},i&&{subscribeStart:i}),r&&{subscribeEnd:r}),s&&{firstFrame:s}),o&&{streamAdded:o}),c&&{firstDecoded:c})})}massSubscribe(t,n,i,r){t.forEach(s=>{this.dispatch({type:nt.KEY_METRIC_SUBSCRIBE,metric:De(De(De({userId:s.userId,type:s.type},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:nt.RECORD_JOIN_CHANNEL_SERVICE,record:De(De({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:nt.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:nt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:nt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:nt.AVOID_JOIN_START,avoidJoinStart:t})}}let gE=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const gD=128,bH=96,SD=1e3,Hd=10;let CH=0;function cn(e,t,n){return(t=function(i){var r=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var u=c.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?TD(Object(n),!0).forEach(function(i){cn(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TD(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const vD=new class extends nn{constructor(){super(...arguments),cn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class wH{constructor(t){cn(this,"logger",void 0),cn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function $R(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function yD(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Yr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},SE=Date.now(),gp=e=>{for(const t in Yr)if(Object.prototype.hasOwnProperty.call(Yr,t)&&Yr[t]===e)return t;return"DEFAULT"},y=new class{constructor(){cn(this,"proxyServerURL",void 0),cn(this,"logLevel",Yr.DEBUG),cn(this,"uploadState","collecting"),cn(this,"uploadLogWaitingList",[]),cn(this,"uploadLogUploadingList",[]),cn(this,"uploadErrorCount",0),cn(this,"currentLogID",0),cn(this,"url",void 0),cn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Yr.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Yr.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Yr.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Yr.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Yr.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Dt("UPLOAD_LOG",!0)}disableLogUpload(){Dt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new wH(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-SE<100)return void setTimeout(()=>{this.log(...t)},Date.now()-SE);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=$R()+" Agora-SDK [".concat(gp(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const r=$R()+" %cAgora-SDK [".concat(gp(i),"]:");let s=[];if(!V("USE_NEW_LOG"))switch(i){case Yr.DEBUG:s=[r,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case Yr.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case Yr.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case Yr.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-SE<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-SE);const i=Math.max(0,Math.min(4,t[0]));t[0]=$R()+" Agora-SDK [".concat(gp(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!V("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=yD()+" Agora-SDK [".concat(gp(e),"]:"):n[0]=yD()+" Agora-SDK [".concat(gp(e),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Kr,process_id:V("PROCESS_ID"),payload:JSON.stringify(e)};return Ys(async()=>{const n=await Bi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),vD.reportLogUploadError(i),!0},{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var RD;function AH(e){return qn(e.reportId,"params.reportId",0,100,!1),qn(e.category,"params.category",0,100,!1),qn(e.event,"params.event",0,100,!1),qn(e.label,"params.label",0,100,!1),Nt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(RD={}).FREE="free",RD.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const IH={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Jn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),rn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let OH=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Fe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const r=i.value;if(typeof r=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var o,c=arguments.length,u=new Array(c),p=0;p<c;p++)u[p]=arguments[p];let m=u;if(e.argsMap)try{m=e.argsMap(this,...u)}catch(g){y.warning(g),m=[]}try{JSON.stringify(m)}catch{y.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const _=(e.report||Pe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:m,tag:an.TRACER,reportResult:e.reportResult},e.throttleTime);try{const g=r.apply(this,u);return g instanceof ve?g.then(v=>(_.onSuccess(e.reportResult&&v),v)).catch(v=>{throw _.onError(v),v}):(_.onSuccess(e.reportResult&&g),g)}catch(g){throw _.onError(g),g}}}return i}}const Pe=new class{constructor(){cn(this,"baseInfoMap",new Map),cn(this,"proxyServer",void 0),cn(this,"eventUploadTimer",void 0),cn(this,"setSessionIdTimer",void 0),cn(this,"url",void 0),cn(this,"sids",new Set),cn(this,"backupUrl",void 0),cn(this,"_appId",void 0),cn(this,"keyEventUploadPendingItems",[]),cn(this,"normalEventUploadPendingItems",[]),cn(this,"apiInvokeUploadPendingItems",[]),cn(this,"apiInvokeCount",0),cn(this,"apiInvokeLoggedCount",0),cn(this,"ltsList",[]),cn(this,"lastSendNormalEventTime",Date.now()),cn(this,"customReportCounterTimer",void 0),cn(this,"customReportCount",0),cn(this,"extApiInvoke",async e=>{for(const t of e){const n=Xe(Xe({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:an.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!V("SHOW_REPORT_INVOKER_LOG"),o=!!V("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const u=this.apiInvokeLoggedCount;function p(v,D){if(c){let C="[apiInvoke-".concat(u,"]");t.id&&(C+="[".concat(t.id,"]")),t.name&&(C+="[".concat(t.name,"]")),y.info("".concat(C," ").concat(v),v==="start"?t.options:D||"")}}const m=()=>({tag:t.tag,invokeId:r,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});p("start");let _=!1;$n(t.timeout).then(()=>{_||(this.sendApiInvoke(Xe(Xe({},m()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const g=new te(k.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:v=>{const D=()=>{if(_)throw g;return _=!0,this.sendApiInvoke(Xe(Xe({},m()),{},{success:!0},t.reportResult&&{result:v})),p("onSuccess"),v};return n?uD(D,t.name+"Success",n,()=>_=!0):D()},onError:v=>{const D=()=>{if(_)throw v;_=!0,this.sendApiInvoke(Xe(Xe({},m()),{},{success:!1,error:v})),p("onFailure",v.toString())};return n?uD(D,t.name+"Error",n,()=>_=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const r=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:YR?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:u,lsid:p,clientRole:m}=t,_=Date.now(),g=Xe(Xe({},i),{},{eventType:Jn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:qR,lts:_,elapse:_-n,extend:JSON.stringify(r),mode:t.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:Kr,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:u,lsid:p,clientType:ge(v=window.navigator.userAgent).call(v,"AgoraWebView")?42:20,clientRole:m,serviceId:V("PROCESS_ID"),extensionID:V("PLUGIN_INFO").join(",")||""});var v;this.send({type:rn.SESSION,data:g},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:t.elapse||r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:rn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||r-n.startTime,eventElapse:r-t.lts,extend:JSON.stringify(t.extend)});this.send({type:rn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const r=Date.now(),{firstSuccess:s,avoidJoinStartTime:o}=t,c=r-(s&&o?o:n.startTime),u=Xe(Xe({},i),{},{eventType:Jn.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:r-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0});t.succ&&(n.lastJoinSuccessTime=r),this.send({type:rn.JOIN_GATEWAY,data:u},!0)}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),r=Xe(Xe({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:rn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.PUBLISH,lts:r,eventElapse:t.eventElapse,elapse:r-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:rn.PUBLISH,data:s},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,s=Date.now(),o=Xe(Xe({},r),{},{eventType:Jn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:rn.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...br(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,o=Date.now(),c=Xe(Xe({},s),{},{eventType:Jn.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-r.startTime,status:e.status?1:2});this.send({type:rn.WS_COMPRESSOR_INIT,data:c},!0)}firstRemoteVideoDecode(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,o=Date.now(),c=Xe(Xe(Xe({},s),i),{},{elapse:o-r.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((i.firstFrame||o)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,o=Date.now(),c=Xe(Xe(Xe({},s),i),{},{elapse:o-r.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe(Xe({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Jn.PC_STATS,lts:r,preallocation:t.preallocation?1:0});this.send({type:rn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe(Xe({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Jn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:rn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,o=Date.now(),c=Xe(Xe(Xe({},s),i),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-n.startTime,success:t.succ});this.send({type:rn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:rn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{eventType:Jn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:rn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?y.debug("reportProxyServerurl: ".concat(e)):y.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:rn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now();(function(s,o,c){const u=s[o];if(!u||typeof u!="string")return[s];s[o]="";const p=bo(JSON.stringify(s));let m=0;const _=[];let g=0;for(let v=0;v<u.length;v++)g+=u.charCodeAt(v)<=127?1:3,g<=c-p||(_[_.length]=De(De({},s),{},{[o]:u.substring(m,v)}),m=v,g=u.charCodeAt(v)<=127?1:3);return m!==u.length-1&&(_[_.length]=De(De({},s),{},{[o]:u.substring(m)})),_})(Xe(Xe(Xe({},i),t),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:rn.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe(Xe({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:rn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe(Xe({},i),t),{},{elapse:r-n.startTime,lts:r,extend:t.extend||void 0});this.send({type:rn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),s=Xe(Xe(Xe({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:rn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new te(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(r=>({type:rn.USER_ANALYTICS,data:Xe(Xe({sid:e},r),{},{lts:n})}));try{V("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw y.error("send custom report message failed",r.toString()),new te(k.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(e){const t=V("NOT_REPORT_EVENT");if(e.tag&&ge(t)&&ge(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:r,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof te){const{code:u,message:p}=e.error;o=u||p||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:i,cid:s,uid:r,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:rn.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):i.push(s)}e.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Zh(r=this.ltsList).call(r,(o,c)=>o-c))}return t||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&n.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{V("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),y.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Tn.networkState===ur.OFFLINE&&await ve.race([Tn.onlineWaiter,$n(2*On.maxRetryTimeout)]);const t=r=>{let s=new Uint8Array;return r.forEach(o=>{const c=VR(JSON.stringify(o.data)),u=new ArrayBuffer(5),p=(_=>{let g=0;return Object.entries(rn).forEach(v=>{let[D,C]=v;C===_.type&&(g=OH[D])}),g})(o),m=new DataView(u);m.setUint16(0,c.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),s=tD(s,new Uint8Array(u)),s=tD(s,c)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await KR(i,{timeout:1e4,data:t(e),headers:Xe(Xe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(s=>JSON.stringify(s)),vid:(s=>{const o=s&&s.data.sid&&this.baseInfoMap.get(s.data.sid);return o&&o.info.vid&&+o.info.vid||0})(e[0])};Tn.networkState===ur.OFFLINE&&await ve.race([Tn.onlineWaiter,$n(2*On.maxRetryTimeout)]);const i=t?"/events/proto-raws":"/events/messages";let r=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(i));for(let s=0;s<2;s+=1){s===1&&(r=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(i)));try{t?await yH(r,{timeout:1e4,data:n}):await KR(r,{timeout:1e4,data:n})}catch(o){if(s===1)throw o;continue}return}}createBaseInfo(e,t){const n=Object.assign({},IH);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:an.TRACER}).onSuccess()}};vD.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Tn.networkState,Pe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:an.TRACER}).onSuccess("logUploadError")});class z extends te{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),cn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,y)}throw(){super.throw(y)}}const NH=["CHINA","GLOBAL"],bD=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cl=[];function ll(e,t){return!!t&&cl.some(n=>n.uid===e&&n.channelName===t)}var DH=H0.forEach,CD=zl("forEach")?[].forEach:function(e){return DH(this,e,arguments.length>1?arguments[1]:void 0)};_t({target:"Array",proto:!0,forced:[].forEach!=CD},{forEach:CD});var PH=qi("Array").forEach,LH=os,kH=Kn,xH=Z,MH=PH,JR=Array.prototype,UH={DOMTokenList:!0,NodeList:!0},jH=function(e){var t=e.forEach;return e===JR||xH(JR,e)&&t===JR.forEach||kH(UH,LH(e))?MH:t},VH=T(jH),FH=rs,wD=Vi;_t({target:"Object",stat:!0,forced:R(function(){wD(1)})},{keys:function(e){return wD(FH(e))}});var AD=T(ir.Object.keys),BH=T(mm),GH=_t,HH=np,WH=Y([].reverse),ID=[1,2];GH({target:"Array",proto:!0,forced:String(ID)===String(ID.reverse())},{reverse:function(){return HH(this)&&(this.length=this.length),WH(this)}});var KH=qi("Array").reverse,YH=Z,zH=KH,XR=Array.prototype,qH=function(e){var t=e.reverse;return e===XR||YH(XR,e)&&t===XR.reverse?zH:t},OD=qH,$H=T(OD),JH=_t,ND=np,XH=To,QH=Ki,DD=po,ZH=Vr,eW=ao,tW=P_,nW=hn,iW=Td,rW=L0("slice"),sW=nW("species"),QR=Array,oW=Math.max;JH({target:"Array",proto:!0,forced:!rW},{slice:function(e,t){var n,i,r,s=eW(this),o=ZH(s),c=DD(e,o),u=DD(t===void 0?o:t,o);if(ND(s)&&(n=s.constructor,(XH(n)&&(n===QR||ND(n.prototype))||QH(n)&&(n=n[sW])===null)&&(n=void 0),n===QR||n===void 0))return iW(s,c,u);for(i=new(n===void 0?QR:n)(oW(u-c,0)),r=0;c<u;c++,r++)c in s&&tW(i,r,s[c]);return i.length=r,i}});var aW=qi("Array").slice,cW=Z,lW=aW,ZR=Array.prototype,dW=function(e){var t=e.slice;return e===ZR||cW(ZR,e)&&t===ZR.slice?lW:t},uW=T(dW);function Ae(e,t,n,i,r){var s,o,c,u={};return VH(s=AD(i)).call(s,function(p){u[p]=i[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=BH(o=$H(c=uW(n).call(n)).call(c)).call(o,function(p,m){return m(e,t,p)||p},u),r&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(r):void 0,u.initializer=void 0),u.initializer===void 0&&(O0(e,t,u),u=null),u}let eb=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Ar=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),TE=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),tb=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),hs=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Ni=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ve=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Bt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Ye=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Ke=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Sp=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),it=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Di=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),$e=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function vE(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw y.error("Invalid Channel Name ".concat(e)),new z(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function yE(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!ZN(e,1,255))throw new z(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&y.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ha=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const hW={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},nb={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ib(e,t){qn(e.url,"".concat(t,".url"),1,1e3,!1),tn(e.x)||Nt(e.x,"".concat(t,".x"),0,1e4),tn(e.y)||Nt(e.y,"".concat(t,".y"),0,1e4),tn(e.width)||Nt(e.width,"".concat(t,".width"),0,1e4),tn(e.height)||Nt(e.height,"".concat(t,".height"),0,1e4),tn(e.zOrder)||Nt(e.zOrder,"".concat(t,".zOrder"),0,255),tn(e.alpha)||Nt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const pW={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let lc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),rb=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),kn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function PD(e){if(!e.channelName)throw new z(k.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new z(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qn(e.token,"info.token",1,2047),yE(e.uid),vE(e.channelName),!0}let Pi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),pa=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Xi=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Wd=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),yt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),oi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),RE=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Fn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Et=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const LD=[Et.AFRICA,Et.ASIA,Et.CHINA,Et.EUROPE,Et.GLOBAL,Et.INDIA,Et.JAPAN,Et.NORTH_AMERICA,Et.OCEANIA,Et.OVERSEA,Et.SOUTH_AMERICA];let hi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const bE={CHINA:{},ASIA:{CODE:hi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:hi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:hi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:hi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:hi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:hi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:hi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:hi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:hi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:hi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:hi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:hi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:hi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};YR&&(bE.CHINA={CODE:hi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sb=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class kD extends nn{constructor(t,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"getLocalVideoStats",void 0)}}class xD extends kD{constructor(t,n){super(t,n),O(this,"establishPromise",void 0)}}let we=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),hr=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),fa=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),ce=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Rt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Be=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),ps=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),fs=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Hn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),MD=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Co=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),zr=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),zs=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Kd=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),_n=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Yd=function(e){return e.ABORT="abort",e}({}),dc=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),fW=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const mW={[TE.ACCESS_POINT]:{[Ni.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ni.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ni.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ni.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ni.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ni.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[TE.UNILBS]:{[hs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[TE.STRING_UID_ALLOCATOR]:{[tb.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[tb.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[tb.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function zd(e){const t=mW[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===TE.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const _W={[Ve.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ve.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ve.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ve.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ve.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ve.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ve.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ve.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ve.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ve.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ve.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ve.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ve.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ve.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ve.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ve.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ve.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ve.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ve.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ve.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ve.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ve.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ve.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ve.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ve.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ve.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ve.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ve.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ve.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ve.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ve.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ve.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ve.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ve.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ve.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ve.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ve.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ve.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ve.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ve.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ve.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ve.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ve.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ve.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ve.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ve.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ve.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ve.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ve.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ve.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ve.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ve.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ve.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ve.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ve.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ve.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ve.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ve.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ve.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Tp(e){return _W[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function UD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function ob(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UD(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UD(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function jD(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function VD(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:r}=e;if(t){const s=V("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const EW=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,gW=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,SW=/wss:\/\/(.+):([0-9]+)\/?/,TW=/wss:\/\/(.[^\/]+)\/?/;let vW=0;class yW{constructor(t,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++vW,this.try443PortDuration=V("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];y.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const r=V("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=r.find(m=>{var _;return ge(_=t.host).call(_,m)});c||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)r.forEach(m=>{u.push(VD(ob(ob({},t),{},{host:t.host.replace(c,m)}),n))});else{const m=ob({},t);if(n&&c){const _=r.find(g=>g!==c);_&&(m.host=m.host.replace(c,_))}u.push(VD(m,n))}try{u.forEach(m=>{const _=new WebSocket(m);_.binaryType="arraybuffer",o.push(_),this.logger("ws is connecting:",_.url)})}catch(m){if(this.logger("ws create failed"),o.forEach(_=>_.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new z(k.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}const p=pp();return this.store&&this.store.recordJoinChannelService({urls:o.map(m=>m.url),service:"gateway"},this.recordIndex),o.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(_=>{_!==m&&(_.onopen=null,_.onclose=null,_.onmessage=null,_.close(),this.logger("close backup websocket: ".concat(_.url)))}),this.websockets.length=0,p.resolve(m)},m.onclose=_=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(m.readyState)),n?this.isTry443PortFailed=jD(o):this.isNormalPortFailed=jD(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(_.reason)),p.reject({code:_.code,reason:RE.A_ROUND_WS_FAILED}))},m.onmessage=_=>this.logger("".concat(m.url," onmessage: ").concat(_.data))}),this.websockets.push(...o),i||(()=>{const m=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",p.isResolved),p.isResolved)return m();ut().os===Vn.MAC_OS&&on()&&m(),this.createWebSocket(t,!0,!0).then(_=>p.resolve(_)).catch(_=>{this.isNormalPortFailed&&p.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(m,this.forceCloseWSDuration)},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,i,r){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let o,c,u;return[,o,c,u]=s.match(EW)||[],o||([,c,u]=s.match(gW)||[]),c&&u||([,c,u]=s.match(SW)||[]),c&&u||([,c]=s.match(TW)||[]),c||y.warning("un-destructible url: ",s),{proxy:o,host:c,port:u||"443"}}(t)),this.recordIndex=r,this.useProxy=!!t.proxy,i&&this.useProxy&&(y.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function FD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class BD extends nn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ge(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit($e.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit($e.CONNECTED):this._state==="closed"?this.emit($e.CLOSED):this._state==="failed"&&this.emit($e.FAILED))}resetReconnectCount(t){y.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=function(_){for(var g=1;g<arguments.length;g++){var v=arguments[g]!=null?arguments[g]:{};g%2?FD(Object(v),!0).forEach(function(D){O(_,D,v[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(v)):FD(Object(v)).forEach(function(D){Object.defineProperty(_,D,Object.getOwnPropertyDescriptor(v,D))})}return _}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new ui("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:u}=n,p=Math.max(300,Math.floor(3*c/5)),m=Math.max(1.2,Math.floor(8*u)/10);ur.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),Tn.on(Vd.NETWORK_STATE_CHANGE,(_,g)=>{_!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(_)),_===ur.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const r=pp(),s=this.urls[this.currentURLIndex];V("ENABLE_PREALLOC_PC")&&this.emit(MD.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(r.resolve).catch(r.reject),this.once($e.CLOSED,()=>{r.reject(new te(k.WS_DISCONNECT))}),this.once($e.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void y.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),y.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new te(k.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new te(k.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=pp();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=m=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),y.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async m=>{var _;if(y.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new te(k.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const g=Wr(this,$e.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,v=await this.reconnectWithAction(g);if(this.state==="closed")return void y.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!v)return i.reject(new te(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},o=m=>{this.emit($e.ON_MESSAGE,m)},c=m=>{y.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=V("GATEWAY_WSS_ADDRESS")),y.debug("[".concat(this.name,"] start connect, url:"),t);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(m){const _=this.state==="closed",g=m instanceof te,v=g&&m.code===k.WS_ABORT,D=g&&m.code===k.WS_ERR,C=g?m.message:m&&(m.reason||m.toString());y.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:v?"aborted":"error",errors:[m]},u),_||D?(i.reject(_?new te(k.WS_DISCONNECT,"websocket is closed: ".concat(C)):new te(k.WS_ERR,"init websocket failed: ".concat(C))),D&&y.error("[".concat(this.name,"] init websocket failed: ").concat(C))):s&&s(m)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;y.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Tn.isOnline||!Tn.onlineWaiter||(this.onlineReconnectListener=Tn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const o=HR(this.reconnectCount,this.retryConfig);y.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await ve.race([$n(o),this.onlineReconnectListener||new ve(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(o,c)=>{this.emit($e.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await r(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);y.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],t)}else t==="recover"&&(y.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ri(this,$e.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],t))}catch(o){var s;y.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&ge(c).call(c,"dynamic key expired")?(this.emit($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class ab extends BD{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=pp(),r=function(o,c){return new yW(o,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new te(k.WS_ABORT,"choose best websocket aborted"))};const s=V("GATEWAY_DOMAINS");return y.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class vp extends BD{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new ve((i,r)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{y.debug("[choose-best-ws] close establishing websockets"),o.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),r(new te(k.WS_ABORT,"choose best websocket aborted"))};const c=V("GATEWAY_DOMAINS");let u;const p=t.indexOf("?h="),m=c.find(D=>p!==-1?ge(t).call(t,D,p):ge(t).call(t,D));y.debug("[choose-best-ws] currentDomain: ",m,", domains: ",c);let _=!this.tryDoubleDomain||!m;if(!_&&m){var g;const D=Date.now();try{c.forEach(C=>{const w=p===-1?t.replace(m,C):t.substr(0,p)+t.substr(p).replace(m,C),P=new WebSocket(w);P.binaryType="arraybuffer",o.push(P),y.debug("[choose-best-ws] ws is connecting:",P.url)})}catch{for(y.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(w=>w.close());o.length;)o.pop();_=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:o.map(C=>C.url),service:"gateway"},n),o.forEach(C=>{C.onopen=()=>{if(s)return;const w=Date.now()-D;y.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),o.filter(P=>P!==C).forEach(P=>{y.debug("[choose-best-ws]close backup websocket: ".concat(P.url)),P.close()}),s=!0,i(C)},C.onclose=w=>{u=w,!s&&(o.find(P=>!(P.readyState===WebSocket.CLOSED||P.readyState===WebSocket.CLOSING))||(y.debug("[choose-best-ws] all websocket is closed"),s=!0,r(u)))},C.onmessage=w=>{y.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(w.data))}}),$n(this.forceCloseTimeout).then(()=>{o.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(_){var v;let D;y.debug("[choose-best-ws] use single url: ",t),(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),o.push(D),D.binaryType="arraybuffer"}catch(C){const w=new te(k.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return y.error("[".concat(this.name,"]").concat(w)),void r(w)}D.onopen=()=>{i(D)},D.onclose=C=>{r(C)},D.onmessage=C=>{y.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(C.data))},$n(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class RW extends nn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(Ye.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(Ye.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(Ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new _D(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ye.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===it.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===it.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(bt.UID_BANNED);break;case 15:this.close(bt.IP_BANNED);break;case 16:this.close(bt.CHANNEL_BANNED)}if(r._type===it.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Ve.ERR_LICENSE_MISSING:this.close(bt.LICENSE_MISSING);break;case Ve.ERR_LICENSE_EXPIRED:this.close(bt.LICENSE_EXPIRED);break;case Ve.ERR_LICENSE_MINUTES_EXCEEDED:this.close(bt.LICENSE_MINUTES_EXCEEDED);break;case Ve.ERR_LICENSE_PERIOD_INVALID:this.close(bt.LICENSE_PERIOD_INVALID);break;case Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(bt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ve.ERR_LICENSE_ILLEGAL:this.close(bt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new ab("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",ii.OFFLINE)})}async request(t,n,i,r){const s=jt(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,u=()=>new ve((D,C)=>{if(this.connectionState===Bt.CONNECTED)return D();const w=()=>{this.off(Ye.WS_CLOSED,P),D()},P=()=>{this.off(Ye.WS_CONNECTED,w),C(new z(k.WS_ABORT))};this.once(Ye.WS_CONNECTED,w),this.once(Ye.WS_CLOSED,P),t!==Ke.PUBLISH&&t!==Ke.PUBLISH_DATASTREAM&&t!==Ke.SUBSCRIBE&&t!==Ke.SUBSCRIBE_DATASTREAM&&t!==Ke.UNSUBSCRIBE&&t!==Ke.UNSUBSCRIBE_DATASTREAM&&t!==Ke.UNPUBLISH&&t!==Ke.UNPUBLISH_DATASTREAM&&t!==Ke.CONTROL&&t!==Ke.RESTART_ICE||this.once(Ye.DISCONNECT_P2P,()=>{C(new z(k.DISCONNECT_P2P))}),t!==Ke.PUBLISH&&t!==Ke.RESTART_ICE||this.once(Ye.ABORT_P2P_EXECUTION,()=>{C(new z(k.DISCONNECT_P2P))})});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===Ke.JOIN||t===Ke.REJOIN||await u(),this.websocket.sendMessage(o,!0),r)return;const p=new ve((D,C)=>{let w=!1;const P=(G,W)=>{w=!0,D({isSuccess:G==="success",message:W||{}}),this.off(Ye.WS_CLOSED,L),this.off(Ye.WS_RECONNECTING,L),this.emit(Ye.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),P);const L=()=>{C(new z(k.WS_ABORT,"type: ".concat(t))),this.off(Ye.WS_CLOSED,L),this.off(Ye.WS_RECONNECTING,L),this.off("res-@".concat(s),P)};this.once(Ye.WS_CLOSED,L),this.once(Ye.WS_RECONNECTING,L),$n(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||w||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ye.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===Bt.CLOSED||t===Ke.LEAVE)throw new z(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===Ke.JOIN||t===Ke.REJOIN?null:(await u(),await this.request(t,n))}if(m.isSuccess)return m.message;const _=Number(m.message.error_code||m.message.code),g=Tp(_),v=new z(k.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(m.message.error_str),{code:_,data:m.message,desc:g.desc});return g.action==="success"?m.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(g.desc,", action: ").concat(g.action)),_===Ve.ERR_TOO_MANY_BROADCASTERS?((t===Ke.JOIN||t===Ke.REJOIN)&&(this.initError=v,this.close()),v.throw()):g.action==="failed"?v.throw():g.action==="quit"?(this.initError=v,this.close(),v.throw()):(_===Ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ii.MULTI_IP)):this.reconnect(g.action,ii.SERVER_ERROR),t===Ke.JOIN||t===Ke.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ve(i=>{const r=s=>{(!n||n(s))&&(this.off(t,r),i(s))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Sp.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const s=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ve((i,r)=>{this.once(Ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ye.WS_CLOSED,()=>r(this.initError||new z(k.WS_ABORT))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||bt.LEAVE,this.connectionState=Bt.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ye.ABORT_P2P_EXECUTION);const t=await ri(this,Ye.REQUEST_JOIN_INFO),n=await this.request(Ke.JOIN,t);if(!n)return this.emit(Ye.REPORT_JOIN_GATEWAY,RE.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new z(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ep(this,Ye.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ke.REJOIN,t);return!!n&&(this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(it.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(it.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(it.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(it.MUTE_AUDIO,{uid:i.uid}):this.emit(it.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(it.MUTE_VIDEO,{uid:i.uid}):this.emit(it.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(it.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(it.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(it.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(it.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(it.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){y.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Tp(t.code);if(t.code===28&&"detail"in t&&(y.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Ye.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(bt.UID_BANNED),void this.close()):void this.reconnect(n.action,ii.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=V("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(y.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ii.TIMEOUT):this.request(Ke.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(Ke.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Sp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on($e.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ye.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on($e.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($e.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on($e.FAILED,()=>{this._disconnectedReason=bt.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on($e.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on($e.WILL_RECONNECT,(t,n,i)=>{const r=Ep(this,Ye.IS_P2P_DISCONNECTED),s=r||t!=="retry";r&&t==="retry"&&(y.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=RE.P2P_DISCONNECTED),s&&(y.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Ye.REPORT_JOIN_GATEWAY,n||RE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ye.DISCONNECT_P2P)),i(t)}),this.websocket.on($e.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{y.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ii.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ye.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof z){if(t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Ve.ERR_NO_AUTHORIZED)return this.initError=new z(k.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ii.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ii.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on($e.REQUEST_NEW_URLS,(t,n)=>{ri(this,Ye.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(MD.PRE_CONNECT_PC,()=>{this.emit(Ye.PRE_CONNECT_PC)})}}let vn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function GD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function CE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GD(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GD(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function qd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(y.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function cb(e,t){e.addresses||(e.addresses=[]);const n=function(c,u){if(V("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(_=>{let{ip:g,port:v}=_;return{address:"".concat(g,":").concat(v)}});const p=V("GATEWAY_DOMAINS");let m=p[1]&&ge(u).call(u,p[1])?1:0;return c.map(_=>{let{domain_prefix:g,port:v,ip:D}=_;if(g)return{address:"".concat(g,".").concat(p[m++%p.length],":").concat(v)};const C=/^[\.\:\d]+$/.test(D),w=C?"".concat(D.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(v):"".concat(D,":").concat(v);return C||y.debug("Cannot recognized as ip address: ".concat(D,", use as host")),{ip:D,port:v,address:w}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const c=i.split(";");for(let u=0;u<c.length;u++){var r;const p=vi(r=c[u]).call(r);n[u]&&p&&(n[u].ip6=p)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,u]=s.split(":");c&&u&&(o={port:Number(u),ip:c,address:"".concat(c,":").concat(u)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function pr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function HD(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(pr(t.width),"x").concat(pr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function WD(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function yp(e,t){let n,i,r;switch(t){case vn.CHOOSE_SERVER:i=4096,r="choose server";break;case vn.CLOUD_PROXY:i=1048576,r="proxy";break;case vn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case vn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new z(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>CE(CE({},o),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:CE(CE({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new z(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function KD(e,t){return await ve.all(e.addresses.map(async n=>({address:qd(n.ip),tcpport:n.port,udpport:n.port,username:t&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():si.username,password:t&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await FR(t.toString()):si.password})))}function lb(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,r=t.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(pr(e.height),pr(e.width)),1):(y.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function uc(e){let{candidateType:t,relayProtocol:n,type:i,address:r,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(i!=="local-candidate"){const u=r.split(".");u.length>=4&&(u[1]="*",u[2]="*"),c.address=u.join("."),c.port=s}return c}var ms,bW=T(OD),CW=qi("Array").values,wW=os,AW=Kn,IW=Z,OW=CW,db=Array.prototype,NW={DOMTokenList:!0,NodeList:!0},DW=function(e){var t=e.values;return e===db||IW(db,e)&&t===db.values||AW(NW,wW(e))?OW:t},ma=T(DW),YD=li,PW=Y,LW=ft,kW=R,ub=Vi,xW=Kc,MW=gr,UW=rs,jW=Sr,$d=Object.assign,zD=Object.defineProperty,VW=PW([].concat),FW=!$d||kW(function(){if(YD&&$d({b:1},$d(zD({},"a",{enumerable:!0,get:function(){zD(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(r){t[r]=r}),$d({},e)[n]!=7||ub($d({},t)).join("")!=i})?function(e,t){for(var n=UW(e),i=arguments.length,r=1,s=xW.f,o=MW.f;i>r;)for(var c,u=jW(arguments[r++]),p=s?VW(ub(u),s(u)):ub(u),m=p.length,_=0;m>_;)c=p[_++],YD&&!LW(o,u,c)||(n[c]=u[c]);return n}:$d,BW=Si,GW=Jm,HW=Ps,WW=ft,KW=rs,YW=function(e,t,n,i){try{return i?t(BW(n)[0],n[1]):t(n)}catch(r){GW(e,"throw",r)}},zW=Ym,qW=To,$W=Vr,qD=P_,JW=Ah,XW=Rr,$D=Array,dl=Y,hb=2147483647,QW=/[^\0-\u007E]/,JD=/[.\u3002\uFF0E\uFF61]/g,XD="Overflow: input needs wider integers to process",QD=RangeError,ZW=dl(JD.exec),Jd=Math.floor,pb=String.fromCharCode,ZD=dl("".charCodeAt),eP=dl([].join),hc=dl([].push),e3=dl("".replace),t3=dl("".split),n3=dl("".toLowerCase),tP=function(e){return e+22+75*(e<26)},i3=function(e,t,n){var i=0;for(e=n?Jd(e/700):e>>1,e+=Jd(e/t);e>455;)e=Jd(e/35),i+=36;return Jd(i+36*e/(e+38))},r3=function(e){var t=[];e=function(P){for(var L=[],G=0,W=P.length;G<W;){var K=ZD(P,G++);if(K>=55296&&K<=56319&&G<W){var ee=ZD(P,G++);(64512&ee)==56320?hc(L,((1023&K)<<10)+(1023&ee)+65536):(hc(L,K),G--)}else hc(L,K)}return L}(e);var n,i,r=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(i=e[n])<128&&hc(t,pb(i));var u=t.length,p=u;for(u&&hc(t,"-");p<r;){var m=hb;for(n=0;n<e.length;n++)(i=e[n])>=s&&i<m&&(m=i);var _=p+1;if(m-s>Jd((hb-o)/_))throw QD(XD);for(o+=(m-s)*_,s=m,n=0;n<e.length;n++){if((i=e[n])<s&&++o>hb)throw QD(XD);if(i==s){for(var g=o,v=36;;){var D=v<=c?1:v>=c+26?26:v-c;if(g<D)break;var C=g-D,w=36-D;hc(t,pb(tP(D+C%w))),g=Jd(C/w),v+=36}hc(t,pb(tP(g))),c=i3(o,_,p==u),o=0,p++}}o++,s++}return eP(t,"")},s3=_t,fb=li,o3=iR,mb=q,nP=Ps,_s=Y,wE=mo,Es=mt,a3=Ut,_b=Kn,Eb=FW,Xd=function(e){var t=KW(e),n=qW(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=HW(r,i>2?arguments[2]:void 0));var o,c,u,p,m,_,g=XW(t),v=0;if(!g||this===$D&&zW(g))for(o=$W(t),c=n?new this(o):$D(o);o>v;v++)_=s?r(t[v],v):t[v],qD(c,v,_);else for(m=(p=JW(t,g)).next,c=n?new this:[];!(u=WW(m,p)).done;v++)_=s?YW(p,r,[u.value,v],!0):u.value,qD(c,v,_);return c.length=v,c},qs=Ny,c3=gy.codeAt,l3=function(e){var t,n,i=[],r=t3(e3(n3(e),JD,"."),".");for(t=0;t<r.length;t++)n=r[t],hc(i,ZW(QW,n)?"xn--"+r3(n):n);return eP(i,".")},_a=$i,d3=cs,u3=aa,iP=mG,rP=ea,h3=rP.set,AE=rP.getterFor("URL"),p3=iP.URLSearchParams,f3=iP.getState,Rp=mb.URL,gb=mb.TypeError,IE=mb.parseInt,m3=Math.floor,sP=Math.pow,gs=_s("".charAt),$s=_s(/./.exec),bp=_s([].join),_3=_s(1 .toString),E3=_s([].pop),Qd=_s([].push),Sb=_s("".replace),g3=_s([].shift),S3=_s("".split),Cp=_s("".slice),OE=_s("".toLowerCase),T3=_s([].unshift),Tb="Invalid scheme",ul="Invalid host",oP="Invalid port",aP=/[a-z]/i,v3=/[\d+-.a-z]/i,vb=/\d/,y3=/^0x/i,R3=/^[0-7]+$/,b3=/^\d+$/,cP=/^[\da-f]+$/i,C3=/[\0\t\n\r #%/:<>?@[\\\]^|]/,w3=/[\0\t\n\r #/:<>?@[\\\]^|]/,A3=/^[\u0000-\u0020]+/,I3=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,O3=/[\t\n\r]/g,wp=function(e){var t,n,i,r;if(typeof e=="number"){for(t=[],n=0;n<4;n++)T3(t,e%256),e=m3(e/256);return bp(t,".")}if(typeof e=="object"){for(t="",i=function(s){for(var o=null,c=1,u=null,p=0,m=0;m<8;m++)s[m]!==0?(p>c&&(o=u,c=p),u=null,p=0):(u===null&&(u=m),++p);return p>c&&(o=u,c=p),o}(e),n=0;n<8;n++)r&&e[n]===0||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=_3(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},NE={},lP=Eb({},NE,{" ":1,'"':1,"<":1,">":1,"`":1}),dP=Eb({},lP,{"#":1,"?":1,"{":1,"}":1}),yb=Eb({},dP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),pc=function(e,t){var n=c3(e,0);return n>32&&n<127&&!_b(t,e)?e:encodeURIComponent(e)},DE={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ap=function(e,t){var n;return e.length==2&&$s(aP,gs(e,0))&&((n=gs(e,1))==":"||!t&&n=="|")},uP=function(e){var t;return e.length>1&&Ap(Cp(e,0,2))&&(e.length==2||(t=gs(e,2))==="/"||t==="\\"||t==="?"||t==="#")},N3=function(e){return e==="."||OE(e)==="%2e"},Rb={},hP={},bb={},pP={},fP={},Cb={},mP={},_P={},PE={},LE={},wb={},Ab={},Ib={},Ob={},EP={},Nb={},Zd={},wo={},gP={},hl={},Ea={},Db=function(e,t,n){var i,r,s,o=_a(e);if(t){if(r=this.parse(o))throw gb(r);this.searchParams=null}else{if(n!==void 0&&(i=new Db(n,!0)),r=this.parse(o,null,i))throw gb(r);(s=f3(new p3)).bindURL(this),this.searchParams=s}};Db.prototype={type:"URL",parse:function(e,t,n){var i,r,s,o,c,u=this,p=t||Rb,m=0,_="",g=!1,v=!1,D=!1;for(e=_a(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=Sb(e,A3,""),e=Sb(e,I3,"$1")),e=Sb(e,O3,""),i=Xd(e);m<=i.length;){switch(r=i[m],p){case Rb:if(!r||!$s(aP,r)){if(t)return Tb;p=bb;continue}_+=OE(r),p=hP;break;case hP:if(r&&($s(v3,r)||r=="+"||r=="-"||r=="."))_+=OE(r);else{if(r!=":"){if(t)return Tb;_="",p=bb,m=0;continue}if(t&&(u.isSpecial()!=_b(DE,_)||_=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=_,t)return void(u.isSpecial()&&DE[u.scheme]==u.port&&(u.port=null));_="",u.scheme=="file"?p=Ob:u.isSpecial()&&n&&n.scheme==u.scheme?p=pP:u.isSpecial()?p=_P:i[m+1]=="/"?(p=fP,m++):(u.cannotBeABaseURL=!0,Qd(u.path,""),p=gP)}break;case bb:if(!n||n.cannotBeABaseURL&&r!="#")return Tb;if(n.cannotBeABaseURL&&r=="#"){u.scheme=n.scheme,u.path=qs(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,p=Ea;break}p=n.scheme=="file"?Ob:Cb;continue;case pP:if(r!="/"||i[m+1]!="/"){p=Cb;continue}p=PE,m++;break;case fP:if(r=="/"){p=LE;break}p=wo;continue;case Cb:if(u.scheme=n.scheme,r==ms)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=qs(n.path),u.query=n.query;else if(r=="/"||r=="\\"&&u.isSpecial())p=mP;else if(r=="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=qs(n.path),u.query="",p=hl;else{if(r!="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=qs(n.path),u.path.length--,p=wo;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=qs(n.path),u.query=n.query,u.fragment="",p=Ea}break;case mP:if(!u.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,p=wo;continue}p=LE}else p=PE;break;case _P:if(p=PE,r!="/"||gs(_,m+1)!="/")continue;m++;break;case PE:if(r!="/"&&r!="\\"){p=LE;continue}break;case LE:if(r=="@"){g&&(_="%40"+_),g=!0,s=Xd(_);for(var C=0;C<s.length;C++){var w=s[C];if(w!=":"||D){var P=pc(w,yb);D?u.password+=P:u.username+=P}else D=!0}_=""}else if(r==ms||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(g&&_=="")return"Invalid authority";m-=Xd(_).length+1,_="",p=wb}else _+=r;break;case wb:case Ab:if(t&&u.scheme=="file"){p=Nb;continue}if(r!=":"||v){if(r==ms||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(u.isSpecial()&&_=="")return ul;if(t&&_==""&&(u.includesCredentials()||u.port!==null))return;if(o=u.parseHost(_))return o;if(_="",p=Zd,t)return;continue}r=="["?v=!0:r=="]"&&(v=!1),_+=r}else{if(_=="")return ul;if(o=u.parseHost(_))return o;if(_="",p=Ib,t==Ab)return}break;case Ib:if(!$s(vb,r)){if(r==ms||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()||t){if(_!=""){var L=IE(_,10);if(L>65535)return oP;u.port=u.isSpecial()&&L===DE[u.scheme]?null:L,_=""}if(t)return;p=Zd;continue}return oP}_+=r;break;case Ob:if(u.scheme="file",r=="/"||r=="\\")p=EP;else{if(!n||n.scheme!="file"){p=wo;continue}if(r==ms)u.host=n.host,u.path=qs(n.path),u.query=n.query;else if(r=="?")u.host=n.host,u.path=qs(n.path),u.query="",p=hl;else{if(r!="#"){uP(bp(qs(i,m),""))||(u.host=n.host,u.path=qs(n.path),u.shortenPath()),p=wo;continue}u.host=n.host,u.path=qs(n.path),u.query=n.query,u.fragment="",p=Ea}}break;case EP:if(r=="/"||r=="\\"){p=Nb;break}n&&n.scheme=="file"&&!uP(bp(qs(i,m),""))&&(Ap(n.path[0],!0)?Qd(u.path,n.path[0]):u.host=n.host),p=wo;continue;case Nb:if(r==ms||r=="/"||r=="\\"||r=="?"||r=="#"){if(!t&&Ap(_))p=wo;else if(_==""){if(u.host="",t)return;p=Zd}else{if(o=u.parseHost(_))return o;if(u.host=="localhost"&&(u.host=""),t)return;_="",p=Zd}continue}_+=r;break;case Zd:if(u.isSpecial()){if(p=wo,r!="/"&&r!="\\")continue}else if(t||r!="?")if(t||r!="#"){if(r!=ms&&(p=wo,r!="/"))continue}else u.fragment="",p=Ea;else u.query="",p=hl;break;case wo:if(r==ms||r=="/"||r=="\\"&&u.isSpecial()||!t&&(r=="?"||r=="#")){if((c=OE(c=_))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(u.shortenPath(),r=="/"||r=="\\"&&u.isSpecial()||Qd(u.path,"")):N3(_)?r=="/"||r=="\\"&&u.isSpecial()||Qd(u.path,""):(u.scheme=="file"&&!u.path.length&&Ap(_)&&(u.host&&(u.host=""),_=gs(_,0)+":"),Qd(u.path,_)),_="",u.scheme=="file"&&(r==ms||r=="?"||r=="#"))for(;u.path.length>1&&u.path[0]==="";)g3(u.path);r=="?"?(u.query="",p=hl):r=="#"&&(u.fragment="",p=Ea)}else _+=pc(r,dP);break;case gP:r=="?"?(u.query="",p=hl):r=="#"?(u.fragment="",p=Ea):r!=ms&&(u.path[0]+=pc(r,NE));break;case hl:t||r!="#"?r!=ms&&(r=="'"&&u.isSpecial()?u.query+="%27":u.query+=r=="#"?"%23":pc(r,NE)):(u.fragment="",p=Ea);break;case Ea:r!=ms&&(u.fragment+=pc(r,lP))}m++}},parseHost:function(e){var t,n,i;if(gs(e,0)=="["){if(gs(e,e.length-1)!="]"||(t=function(r){var s,o,c,u,p,m,_,g=[0,0,0,0,0,0,0,0],v=0,D=null,C=0,w=function(){return gs(r,C)};if(w()==":"){if(gs(r,1)!=":")return;C+=2,D=++v}for(;w();){if(v==8)return;if(w()!=":"){for(s=o=0;o<4&&$s(cP,w());)s=16*s+IE(w(),16),C++,o++;if(w()=="."){if(o==0||(C-=o,v>6))return;for(c=0;w();){if(u=null,c>0){if(!(w()=="."&&c<4))return;C++}if(!$s(vb,w()))return;for(;$s(vb,w());){if(p=IE(w(),10),u===null)u=p;else{if(u==0)return;u=10*u+p}if(u>255)return;C++}g[v]=256*g[v]+u,++c!=2&&c!=4||v++}if(c!=4)return;break}if(w()==":"){if(C++,!w())return}else if(w())return;g[v++]=s}else{if(D!==null)return;C++,D=++v}}if(D!==null)for(m=v-D,v=7;v!=0&&m>0;)_=g[v],g[v--]=g[D+m-1],g[D+--m]=_;else if(v!=8)return;return g}(Cp(e,1,-1)),!t))return ul;this.host=t}else if(this.isSpecial()){if(e=l3(e),$s(C3,e)||(t=function(r){var s,o,c,u,p,m,_,g=S3(r,".");if(g.length&&g[g.length-1]==""&&g.length--,(s=g.length)>4)return r;for(o=[],c=0;c<s;c++){if((u=g[c])=="")return r;if(p=10,u.length>1&&gs(u,0)=="0"&&(p=$s(y3,u)?16:8,u=Cp(u,p==8?1:2)),u==="")m=0;else{if(!$s(p==10?b3:p==8?R3:cP,u))return r;m=IE(u,p)}Qd(o,m)}for(c=0;c<s;c++)if(m=o[c],c==s-1){if(m>=sP(256,5-s))return null}else if(m>255)return null;for(_=E3(o),c=0;c<o.length;c++)_+=o[c]*sP(256,3-c);return _}(e),t===null))return ul;this.host=t}else{if($s(w3,e))return ul;for(t="",n=Xd(e),i=0;i<n.length;i++)t+=pc(n[i],NE);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return _b(DE,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Ap(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,r=e.host,s=e.port,o=e.path,c=e.query,u=e.fragment,p=t+":";return r!==null?(p+="//",e.includesCredentials()&&(p+=n+(i?":"+i:"")+"@"),p+=wp(r),s!==null&&(p+=":"+s)):t=="file"&&(p+="//"),p+=e.cannotBeABaseURL?o[0]:o.length?"/"+bp(o,"/"):"",c!==null&&(p+="?"+c),u!==null&&(p+="#"+u),p},setHref:function(e){var t=this.parse(e);if(t)throw gb(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new eu(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+wp(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(_a(e)+":",Rb)},getUsername:function(){return this.username},setUsername:function(e){var t=Xd(_a(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=pc(t[n],yb)}},getPassword:function(){return this.password},setPassword:function(e){var t=Xd(_a(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=pc(t[n],yb)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?wp(e):wp(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wb)},getHostname:function(){var e=this.host;return e===null?"":wp(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ab)},getPort:function(){var e=this.port;return e===null?"":_a(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=_a(e))==""?this.port=null:this.parse(e,Ib))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+bp(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Zd))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=_a(e))==""?this.query=null:(gs(e,0)=="?"&&(e=Cp(e,1)),this.query="",this.parse(e,hl)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=_a(e))!=""?(gs(e,0)=="#"&&(e=Cp(e,1)),this.fragment="",this.parse(e,Ea)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var eu=function(e){var t=a3(this,fr),n=u3(arguments.length,1)>1?arguments[1]:void 0,i=h3(t,new Db(e,!1,n));fb||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},fr=eu.prototype,Ss=function(e,t){return{get:function(){return AE(this)[e]()},set:t&&function(n){return AE(this)[t](n)},configurable:!0,enumerable:!0}};if(fb&&(Es(fr,"href",Ss("serialize","setHref")),Es(fr,"origin",Ss("getOrigin")),Es(fr,"protocol",Ss("getProtocol","setProtocol")),Es(fr,"username",Ss("getUsername","setUsername")),Es(fr,"password",Ss("getPassword","setPassword")),Es(fr,"host",Ss("getHost","setHost")),Es(fr,"hostname",Ss("getHostname","setHostname")),Es(fr,"port",Ss("getPort","setPort")),Es(fr,"pathname",Ss("getPathname","setPathname")),Es(fr,"search",Ss("getSearch","setSearch")),Es(fr,"searchParams",Ss("getSearchParams")),Es(fr,"hash",Ss("getHash","setHash"))),wE(fr,"toJSON",function(){return AE(this).serialize()},{enumerable:!0}),wE(fr,"toString",function(){return AE(this).serialize()},{enumerable:!0}),Rp){var SP=Rp.createObjectURL,TP=Rp.revokeObjectURL;SP&&wE(eu,"createObjectURL",nP(SP,Rp)),TP&&wE(eu,"revokeObjectURL",nP(TP,Rp))}d3(eu,"URL"),s3({global:!0,constructor:!0,forced:!o3,sham:!fb},{URL:eu});var D3=_t,P3=R,L3=aa,vP=$i,k3=iR,yP=Yi("URL");D3({target:"URL",stat:!0,forced:!(k3&&P3(function(){yP.canParse()}))},{canParse:function(e){var t=L3(arguments.length,1),n=vP(e),i=t<2||arguments[1]===void 0?void 0:vP(arguments[1]);try{return!!new yP(n,i)}catch{return!1}}});var RP=T(ir.URL);const Xn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function pt(){return Xn}function bP(){return"setSinkId"in HTMLAudioElement.prototype&&(!V("RESTRICTION_SET_PLAYBACK_DEVICE")||(rc()||BN())&&!MR())}function CP(){return!Xn.supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&sc()}let Qn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function tu(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function lt(e,t,n,i,r){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:r}}function Ts(e,t,n,i,r){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:r}}function Pb(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const x3={"90p":lt(160,90),"90p_1":lt(160,90),"120p":lt(160,120,15,30,65),"120p_1":lt(160,120,15,30,65),"120p_3":lt(120,120,15,30,50),"120p_4":lt(212,120),"180p":lt(320,180,15,30,140),"180p_1":lt(320,180,15,30,140),"180p_3":lt(180,180,15,30,100),"180p_4":lt(240,180,15,30,120),"240p":lt(320,240,15,40,200),"240p_1":lt(320,240,15,40,200),"240p_3":lt(240,240,15,40,140),"240p_4":lt(424,240,15,40,220),"360p":lt(640,360,15,80,400),"360p_1":lt(640,360,15,80,400),"360p_3":lt(360,360,15,80,260),"360p_4":lt(640,360,30,80,600),"360p_6":lt(360,360,30,80,400),"360p_7":lt(480,360,15,80,320),"360p_8":lt(480,360,30,80,490),"360p_9":lt(640,360,15,80,800),"360p_10":lt(640,360,24,80,800),"360p_11":lt(640,360,24,80,1e3),"480p":lt(640,480,15,100,500),"480p_1":lt(640,480,15,100,500),"480p_2":lt(640,480,30,100,1e3),"480p_3":lt(480,480,15,100,400),"480p_4":lt(640,480,30,100,750),"480p_6":lt(480,480,30,100,600),"480p_8":lt(848,480,15,100,610),"480p_9":lt(848,480,30,100,930),"480p_10":lt(640,480,10,100,400),"720p":lt(1280,720,15,120,1130),"720p_auto":lt(1280,720,30,900,3e3),"720p_1":lt(1280,720,15,120,1130),"720p_2":lt(1280,720,30,120,2e3),"720p_3":lt(1280,720,30,120,1710),"720p_5":lt(960,720,15,120,910),"720p_6":lt(960,720,30,120,1380),"1080p":lt(1920,1080,15,120,2080),"1080p_1":lt(1920,1080,15,120,2080),"1080p_2":lt(1920,1080,30,120,3e3),"1080p_3":lt(1920,1080,30,120,3150),"1080p_5":lt(1920,1080,60,120,4780),"1440p":lt(2560,1440,30,120,4850),"1440p_1":lt(2560,1440,30,120,4850),"1440p_2":lt(2560,1440,60,120,7350),"4k":lt(3840,2160,30,120,8910),"4k_1":lt(3840,2160,30,120,8910),"4k_3":lt(3840,2160,60,120,13500)},M3={"480p":Ts(640,480,5),"480p_1":Ts(640,480,5),"480p_2":Ts(640,480,30),"480p_3":Ts(640,480,15),"720p":Ts(1280,720,5),"720p_auto":lt(1280,720,30,900,3e3),"720p_1":Ts(1280,720,5),"720p_2":Ts(1280,720,30),"720p_3":Ts(1280,720,15),"1080p":Ts(1920,1080,5),"1080p_1":Ts(1920,1080,5),"1080p_2":Ts(1920,1080,30),"1080p_3":Ts(1920,1080,15)},U3={"1SL1TL":Pb(1,1),"3SL3TL":Pb(3,3),"2SL3TL":Pb(2,3)};function Ao(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},x3[e]):e}function Lb(e){return typeof e=="string"?Object.assign({},M3[e]):e}function kE(e){return typeof e=="string"?Object.assign({},U3[e]):e}const j3={speech_low_quality:tu(16e3,!1),speech_standard:tu(32e3,!1,18),music_standard:tu(48e3,!1),standard_stereo:tu(48e3,!0,56),high_quality:tu(48e3,!1,128),high_quality_stereo:tu(48e3,!0,192)};function xE(e){return typeof e=="string"?Object.assign({},j3[e]):e}const nu=[];function wP(e){return Un(e,"mediaSource",["screen","window","application"]),!0}let Ce=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Vt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),iu=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),V3=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),F3=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),pl=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),ru=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),su=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),ou=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Ir=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const kb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},xb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},AP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},B3={uplinkNetworkQuality:0,downlinkNetworkQuality:0},IP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Li=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Or=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ip=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),fl=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),yi=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Io=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const Mb={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ME=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function dt(e,t,n,i,r){var s,o,c={};return Object.keys(i).forEach(function(u){c[u]=i[u]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=yr(s=bW(o=n.slice()).call(o)).call(s,function(u,p){return p(e,t,u)||u},c),r&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(r):void 0,c.initializer=void 0),c.initializer===void 0&&(Object.defineProperty(e,t,c),c=null),c}function ne(e,t,n){return(t=function(i){var r=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var u=c.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function $t(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OP(Object(n),!0).forEach(function(i){ne(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OP(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class NP extends nn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(pl.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ne(this,"trackMediaType",void 0),ne(this,"_ID",void 0),ne(this,"_rtpTransceiver",void 0),ne(this,"_lowRtpTransceiver",void 0),ne(this,"_hints",[]),ne(this,"_isClosed",!1),ne(this,"_originMediaStreamTrack",void 0),ne(this,"mediaStreamTrack",void 0),ne(this,"_external",{}),this._ID=n||jt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){ge(nu).call(nu,i)||nu.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||oc(()=>{var n;Pe.reportApiInvoke(null,{name:Ln.GET_MEDIA_STREAM_TRACK,options:[],tag:an.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===iu.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=nu.indexOf(t);n!==-1&&nu.splice(n,1)}(this),this.emit(ru.CLOSED),this.removeAllListeners(pl.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===iu.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(pl.TRANSCEIVER_UPDATED,t,n)}}class au extends NP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ne(this,"_enabled",!0),ne(this,"_muted",!1),ne(this,"_isExternalTrack",!1),ne(this,"_isClosed",!1),ne(this,"_enabledMutex",void 0),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ui("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,y.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ce.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Lt(this,Ce.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ru.TRACK_ENDED)}stateCheck(t,n){if(y.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),da(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new te(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",y);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new te(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",y)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ve.resolve([])}}const DP=window.AudioContext||window.webkitAudioContext;let Nr=null;const wt=new class extends nn{constructor(){super(...arguments),ne(this,"prevState",void 0),ne(this,"curState",void 0),ne(this,"currentTime",void 0),ne(this,"currentTimeStuckAt",void 0),ne(this,"interruptDetectorTrack",void 0),ne(this,"onLocalAudioTrackMute",()=>{y.info("ios15-interruption-start"),this.emit(Qn.IOS_15_16_INTERRUPTION_START)}),ne(this,"onLocalAudioTrackUnmute",async()=>{y.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?y.info("ios15-interruption-end-canceled"):(Nr&&await Nr.suspend(),this.emit(Qn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){y.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){y.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function cu(){if(!Nr){if(function(){if(!DP)return void y.error("your browser is not support web audio");y.info("create audio context");const e=$t({},V("WEBAUDIO_INIT_OPTIONS"));y.debug("audio context init option:",JSON.stringify(e)),Nr=new DP(e),wt.curState=Nr.state,Nr.onstatechange=()=>{wt.prevState=wt.curState,wt.curState=Nr?Nr.state:void 0;const{prevState:t,curState:n}=wt,i=n==="running",r=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",u=ut().osVersion;(Oi()||us())&&s&&r&&(y.info("ios".concat(u,"-interruption-start")),wt.emit(Qn.IOS_INTERRUPTION_START)),(Oi()||us())&&(o||c)&&i&&(y.info("ios".concat(u,"-interruption-end")),wt.emit(Qn.IOS_INTERRUPTION_END)),t!==n&&wt.emit(Qn.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Nr)===null||t===void 0?void 0:t.currentTime;wt.currentTime!==n?(wt.currentTimeStuckAt&&(y.debug("AudioContext current time resume at ".concat(n)),wt.currentTimeStuckAt=void 0),wt.currentTime=n):(n!==wt.currentTimeStuckAt&&(Pe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:an.TRACER}).onSuccess(),y.warning("AudioContext current time stuck at ".concat(n))),wt.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,o=!1;function c(C){t.state==="running"?u(!1):Oi()||us()?t.state==="suspended"&&(u(!0),C&&t.resume().then(p,p)):t.state!=="closed"&&(u(!0),C&&t.resume().then(p,p))}function u(C){if(r!==C){r=C;for(let w=0,P=n;w<P.length;w+=1){const L=P[w];C?window.addEventListener(L,m,{capture:!0,passive:!0}):window.removeEventListener(L,m,{capture:!0,passive:!0})}}}function p(){c(!1)}function m(){c(!0)}function _(C){if(!o)if(i.paused)if(C){let w;g(!1),o=!0;try{w=i.play(),w?w.then(v,v):(i.addEventListener("playing",v),i.addEventListener("abort",v),i.addEventListener("error",v))}catch{v()}}else g(!0);else g(!1)}function g(C){if(s!==C){s=C;for(let w=0,P=n;w<P.length;w++){const L=P[w];C?window.addEventListener(L,D,{capture:!0,passive:!0}):window.removeEventListener(L,D,{capture:!0,passive:!0})}}}function v(){i.removeEventListener("playing",v),i.removeEventListener("abort",v),i.removeEventListener("error",v),o=!1,_(!1)}function D(){_(!0)}if(Oi()){const C=t.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=C.stream,_(!0)}wt.on(Qn.STATE_CHANGE,function(){c(!0)}),c(!1)}(Nr)}(),!Nr)throw new te(k.NOT_SUPPORTED,"can not create audio context");return Nr}return Nr}function ml(e){if(function(){if(Ub!==null)return Ub;const i=cu(),r=i.createBufferSource(),s=i.createGain(),o=i.createGain();r.connect(s),r.connect(o),r.disconnect(s);let c=!1;try{r.disconnect(s)}catch{c=!0}return r.disconnect(),Ub=c,c}())return;const t=e.connect,n=e.disconnect;e.connect=(i,r,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),ge(o=e._inputNodes).call(o,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,r,s)):t.call(e,i,r)),e},e.disconnect=(i,r,s)=>{n.call(e),i?pE(e._inputNodes,i):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let Ub=null;function jb(e,t){let n=!1;const i=1/t;if(V("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):e(performance.now()/1e3)},1e3*i)}else{const r=cu();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const o=()=>{if(n)return void(s=null);const c=r.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(r.currentTime+i),e(r.currentTime)};o()}return()=>{n=!0}}class PP{constructor(){ne(this,"context",void 0),ne(this,"analyserNode",void 0),ne(this,"sourceNode",void 0),this.context=cu(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Oi()||us()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<t.length;++r)t[r]=i[r]/128-1}const n=yr(t).call(t,(i,r)=>i+r*r,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{y.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class LP extends nn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ne(this,"outputNode",void 0),ne(this,"outputTrack",void 0),ne(this,"isPlayed",!1),ne(this,"sourceNode",void 0),ne(this,"context",void 0),ne(this,"audioBufferNode",void 0),ne(this,"destNode",void 0),ne(this,"audioOutputLevel",0),ne(this,"volumeLevelAnalyser",void 0),ne(this,"_processedNode",void 0),ne(this,"playNode",void 0),ne(this,"isDestroyed",!1),ne(this,"onNoAudioInput",void 0),ne(this,"isNoAudioInput",!1),ne(this,"_noAudioInputCount",0),this.context=cu(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ml(this.outputNode),this.volumeLevelAnalyser=new PP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Ir.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let o=0;o<s.length;o+=1)s[o]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!pt().webAudioMediaStreamDest)throw new te(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&fE(()=>{wt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Oi()||us()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await $n(200),await this.checkHasAudioInput(t?t+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class kP extends LP{get isFreeze(){return!1}constructor(t,n,i){var r;if(super(),ne(this,"sourceNode",void 0),ne(this,"track",void 0),ne(this,"clonedTrack",void 0),ne(this,"audioElement",void 0),ne(this,"isCurrentTrackCloned",!1),ne(this,"isRemoteTrack",!1),ne(this,"originVolumeLevelAnalyser",void 0),ne(this,"rebuildWebAudio",async()=>{if(y.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void y.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>y.info("resume success")),y.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),ml(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),ml(this.outputNode),this.emit(Ir.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new te(k.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),ml(this.sourceNode),i){const c=i.clone();c.enabled=!0,this.clonedTrack=c,y.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([c]));ml(u),this.originVolumeLevelAnalyser=new PP,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=ut();n&&o.os===Vn.IOS&&Number((r=o.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(wt.on(Qn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),ml(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ir.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),wt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),y.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));ml(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function xP(e,t,n){const i=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function G3(e,t){const n=await MP(e.mediaSource),{sourceId:i,audio:r}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ve((c,u)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const v=document.createElement("div");v.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(P);const L=new Error("NotAllowedError");L.name="NotAllowedError",u(L)};let C=o;const w=document.createElement("div");if(o){const L=document.createElement("input");L.setAttribute("type","checkbox");const G=document.createElement("span");L.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",L.checked=C,L.onchange=()=>{C=L.checked},w.appendChild(L),w.appendChild(G)}v.appendChild(w),v.appendChild(D),m.appendChild(_),m.appendChild(g),m.appendChild(v);const P=document.createElement("div");P.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),P.appendChild(p),P.appendChild(m),document.body.appendChild(P),s.map(L=>{if(L.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=L.thumbnail;try{const{width:K}=W.getSize();K>1920&&(W=W.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+L.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(P),c({sourceId:L.id,audio:C})},g.appendChild(G)}})})}(n,t);return await xP(i,e,r)}async function MP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=nD();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new te(k.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new ve((s,o)=>{n.desktopCapturer.getSources({types:t},(c,u)=>{c?o(c):s(u)})}));try{return await i}catch(s){throw new te(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const Vb=new ui("safari");let UP=!1,jP=!1;async function Dr(e,t){let n=0,i=null;for(;n<2;)try{i=await H3(e,t,n>0);break}catch(r){if(r instanceof te)throw y.error("[".concat(t,"] ").concat(r.toString())),r;const s=UE(r.name||r.code||r,r.message);if(s.code===k.MEDIA_OPTION_INVALID){y.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await $n(500);continue}throw y.error("[".concat(t,"] ").concat(s.toString())),s}if(!i)throw new te(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function H3(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new te(k.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=pt(),r=new MediaStream;if(e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return y.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(nD())e.screen.sourceId?lu(r,await xP(e.screen.sourceId,e.screen,!!e.screenAudio)):lu(r,await G3(e.screen,!!e.screenAudio));else if(rc()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new te(k.NOT_SUPPORTED,"This browser does not support screen sharing");y.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const g=await(o=e.screen.extensionId,c=t,new ve((v,D)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},C=>{if(!C||!C.streamId)return y.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),C),void D(new te(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));v(C.streamId)})}catch(C){y.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),C.toString()),D(new te(k.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=g,lu(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var s;e.screen.mediaSource&&wP(e.screen.mediaSource);const g={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:v,surfaceSwitching:D,systemAudio:C}=e.screen,w={selfBrowserSurface:v,surfaceSwitching:D,systemAudio:C};!v&&delete w.selfBrowserSurface,!D&&delete w.surfaceSwitching,!C&&delete w.systemAudio,y.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:g,audio:e.screenAudio,controls:w})),lu(r,await navigator.mediaDevices.getDisplayMedia($t({video:g,audio:e.screenAudio},w)))}else{if(!on())throw y.error("[".concat(t,"] This browser does not support screenSharing")),new te(k.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&wP(e.screen.mediaSource);const g={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};y.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(g))),lu(r,await navigator.mediaDevices.getUserMedia(g))}}var o,c;if(!e.video&&!e.audio)return r;let u={video:e.video,audio:e.audio},p=V("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),u=BR(u,p)}catch{}y.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),ut();let m,_=null;(ni()||Oi()||dE())&&(_=await Vb.lock());try{m=await navigator.mediaDevices.getUserMedia(u)}catch(g){throw _&&_(),g}return u.audio&&(UP=!0),u.video&&(jP=!0),lu(r,m),_&&_(),r}function UE(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new te(k.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new te(k.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new te(k.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new te(k.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new te(k.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new te(k.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return y.error("getUserMedia unexpected error",e),new te(k.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function lu(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],r=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(i&&e.removeTrack(i),e.addTrack(s)),r&&(n&&e.removeTrack(n),e.addTrack(r))}const Pr=new class extends nn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(fl.STATE_CHANGE,e),this._state=e)}constructor(){super(),ne(this,"_state",Ip.IDLE),ne(this,"isAccessMicrophonePermission",!1),ne(this,"isAccessCameraPermission",!1),ne(this,"lastAccessMicrophonePermission",!1),ne(this,"lastAccessCameraPermission",!1),ne(this,"checkdeviceMatched",!1),ne(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(uE()||lE()===Vn.HARMONY_OS)&&sc())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>y.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new te(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;r.audio&&(s=!1),r.video&&(o=!1);let c=null,u=null,p=null;if(!n&&(s||o)){if(Vb.isLocked&&(y.debug("[device manager] wait GUM lock"),(await Vb.lock())(),y.debug("[device manager] GUM unlock")),UP&&(s=!1,this.isAccessMicrophonePermission=!0),jP&&(o=!1,this.isAccessCameraPermission=!0),y.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const _=UE(m.name||m.code||m,m.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const _=UE(m.name||m.code||m,m.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(o){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const _=UE(m.name||m.code||m,m.message);if(_.code===k.PERMISSION_DENIED)throw _;y.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}y.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),p&&p.getTracks().forEach(_=>_.stop()),c=null,u=null,p=null,m}catch(m){return c&&c.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),p&&p.getTracks().forEach(_=>_.stop()),c=null,u=null,p=null,new te(k.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new te(k.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Ip.INITING;try{await this.updateDevicesInfo(),this.state=Ip.INITEND}catch(e){throw y.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ip.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new te(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=e.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=e.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");r&&s?s.groupId===r.groupId?y.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):y.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):y.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),o),n.push(o)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==t&&(r.state="INACTIVE",n.push(r))}),this.state!==Ip.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fl.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(fl.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(fl.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(r=>r.kind==="audioinput"),n=e.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let Fb=!1;const Lr=new class extends nn{constructor(){super(...arguments),ne(this,"onAutoplayFailed",void 0),ne(this,"onAudioAutoplayFailed",void 0)}};function VP(){if(ut(),!Fb){const e=t=>{t.preventDefault(),Fb=!1,fp()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Fb=!0,fp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),y.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Lr.onAutoplayFailed?Lr.onAutoplayFailed():Lr.onAudioAutoplayFailed?y.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):y.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Lr.emit("autoplay-failed")}}function FP(e,t,n,i){if(!e)return;const r=Pe.getBaseInfoBySessionId(e);if(!r)return;const s=r.info,o=Date.now(),c=$t($t({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-r.startTime,cbRegistered:Lr.onAutoplayFailed||Lr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});Pe.send({type:rn.AUTOPLAY_FAILED,data:c},!0)}const W3=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Gi=new class{constructor(){ne(this,"onAutoplayFailed",void 0),ne(this,"elementMap",new Map),ne(this,"elementStateMap",new Map),ne(this,"elementsNeedToResume",[]),ne(this,"sinkIdMap",new Map),ne(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(y.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return i.pause(),void i.play();if(wt.curState==="running")return jd()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),ne(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(y.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),wt.on(Qn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(Qn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),wt.on(Qn.STATE_CHANGE,()=>{Oi()&&wt.prevState==="suspended"&&wt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new te(k.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,r),this.elementMap.set(t,r),this.elementStateMap.set(t,yi.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{r.setSinkId(s).catch(c=>{y.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){y.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=r.play();o&&o.then&&o.catch(c=>{i&&FP(i,"audio",c.message,t),y.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(y.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),fE(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),VP()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){W3.forEach(n=>{t.addEventListener(n,i=>{const r=this.elementStateMap.get(e),s=i.type==="pause"?"paused":i.type;if(y.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const o=t==null?void 0:t.error;o&&y.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{y.debug("Auto resume audio element success")}).catch(n=>{y.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ve(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{fp()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function En(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new te(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",y);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];const c=i.apply(this,s);return c instanceof ve?new ve((u,p)=>{c.then(u).catch(p)}):c}),n}}class BP extends nn{constructor(t){super(),ne(this,"name","VideoProcessorDestination"),ne(this,"ID","0"),ne(this,"_source",void 0),ne(this,"videoContext",void 0),ne(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new te(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new te(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Li.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Li.ON_TRACK,void 0)}}class GP extends nn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"usageRegistry",[]),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await ri(this,Or.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return y.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Lt(this,Or.REQUEST_UPDATE_CONSTRAINTS,Array.from(ma(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return y.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Lt(this,Or.REQUEST_UPDATE_CONSTRAINTS,Array.from(ma(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:i,type:r,stats:o})}catch(o){y.error(new te(k.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ve&&(i=await i),t.push($t($t({},i),{},{direction:this.direction}))}catch(i){y.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class HP extends nn{constructor(t){super(),ne(this,"name","AudioProcessorDestination"),ne(this,"ID","0"),ne(this,"inputTrack",void 0),ne(this,"inputNode",void 0),ne(this,"audioProcessorContext",void 0),ne(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new te(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new te(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Li.ON_TRACK,void 0),this.emit(Li.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Li.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Li.ON_NODE,this.inputNode))}}class WP extends nn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"audioContext",void 0),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"usageRegistry",[]),ne(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return ri(this,Or.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return y.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Lt(this,Or.REQUEST_UPDATE_CONSTRAINTS,Array.from(ma(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Lt(this,Or.REQUEST_UPDATE_CONSTRAINTS,Array.from(ma(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:i,type:r,stats:o})}catch(o){y.error(new te(k.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof ve&&(i=await i),t.push($t($t({},i),{},{direction:this.direction}))}catch(i){y.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class Bb extends nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ne(this,"context",void 0),ne(this,"processSourceNode",void 0),ne(this,"outputTrack",void 0),ne(this,"processedNode",void 0),ne(this,"clonedTrack",void 0),ne(this,"outputNode",void 0),this.outputNode=new K3}setVolume(){}createOutputTrack(){throw new te(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class K3{disconnect(){}connect(){}}function KP(e){return new ve((t,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=Oi()?"canplay":"playing";r.addEventListener(s,()=>{const o=r.videoWidth,c=r.videoHeight;!o&&on()||(i=!0,r.srcObject=null,r.remove(),t([o,c]))}),r.srcObject=new MediaStream([e]),r.play().catch(mE),setTimeout(()=>{i||(r.srcObject=null,r.remove(),t([r.videoWidth,r.videoHeight]))},4e3)})}function jE(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Ao(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!XN()&&n.frameRate&&(t.frameRate=n.frameRate),BN()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),on()&&(t.frameRate={ideal:30,max:30}),t}function YP(e){const t={};return XN()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,rc()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function zP(e){const t=YP(e);if(e.encoderConfig){const n=xE(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),uE()&&(t.sampleRate=void 0),t}const Y3=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:r}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=i,height:c=r}=t;if(!s||!o||!c)return;o=GR(o),c=GR(c),s=GR(s);const{max:u,min:p}=function(v,D,C){const w=200*Math.pow(C/15,.6)*Math.pow(v*D/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(o,c,s),{bitrateMax:m,bitrateMin:_}=t||{};m||y.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(m,", brMin: ").concat(_,"]"));const{maxFramerate:g}=V("ENCODER_CONFIG_LIMIT");return g&&typeof g=="number"&&(s=Math.min(s,g)),{frameRate:s,bitrateMax:m||u,bitrateMin:_||p,scaleResolutionDownBy:1,scale:0}},qP=async(e,t,n)=>await(async(i,r,s)=>{const o=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(fD(""+r+s)).slice(0,16),c=o.slice(0,12),u=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},u,i))})(e.buffer,t,n),Gb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new ve((n,i)=>{t.toBlob(async r=>{if(t.remove(),r){const s=await $P(r);n({buffer:s,width:t.width,height:t.height})}else i(new te(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},$P=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var JP,XP,QP,ZP,e1,t1,n1,i1,r1,s1,o1,a1,c1,l1,d1,u1,h1,p1,Zt,f1,m1,_1,E1,g1,S1,Oo,T1,v1,y1,R1,b1,C1,w1,A1,I1,O1,N1,D1,P1,ai;let ln=(JP=Fe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),XP=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),QP=En(),ZP=Gd("LocalAudioTrack","_enabledMutex"),e1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),t1=En(),n1=Gd("LocalAudioTrack","_enabledMutex"),i1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),r1=En(),s1=En(),o1=En(),a1=Fe({argsMap:e=>[e.getTrackId()]}),c1=En(),l1=Fe({argsMap:e=>[e.getTrackId()]}),d1=En(),u1=Fe({argsMap:e=>[e.getTrackId()]}),h1=Fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),p1=Fe({argsMap:e=>[e.getTrackId()]}),dt((Zt=class extends au{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Gi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),ne(this,"trackMediaType",ou.AUDIO),ne(this,"_encoderConfig",void 0),ne(this,"_trackSource",void 0),ne(this,"_enabled",!0),ne(this,"_volume",100),ne(this,"_useAudioElement",!0),ne(this,"_bypassWebAudio",!1),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_processorDestination",void 0),ne(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new Bb,V("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ni()&&!Nr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Nt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Gi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void y.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Lt(this,Ce.NEED_REPLACE_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{y.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!bP())throw new te(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Lt(this,Ce.NEED_ENABLE_TRACK,this),y.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Lt(this,Ce.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Lt(this,Ce.NEED_MUTE_TRACK,this):await Lt(this,Ce.NEED_UNMUTE_TRACK,this))}getStats(){return oc(()=>{y.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Wr(this,Ce.GET_STATS)||$t({},kb)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ir.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ir.ON_AUDIO_BUFFER),this._source.on(Ir.ON_AUDIO_BUFFER,n=>e(n))}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Gi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Gi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Lt(this,Ce.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ve.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new te(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new te(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Li.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Lt(this,Ce.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Lt(this,Ce.NEED_REPLACE_TRACK,this))}),e.on(Li.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Li.ON_TRACK),e.removeAllListeners(Li.ON_NODE)}bindProcessorContextEvents(e){e.on(Or.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Or.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Bb&&(this._trackSource=new kP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new WP(this._source.context,this.getTrackId(),"local"),t=new HP(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Ir.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Gi.stop(this.getTrackId()),this._source.play()),Lt(this,Ce.NEED_REPLACE_MIXING_TRACK,this).then(()=>{y.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{y.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[JP],Object.getOwnPropertyDescriptor(Zt.prototype,"setVolume"),Zt.prototype),dt(Zt.prototype,"setPlaybackDevice",[XP,QP],Object.getOwnPropertyDescriptor(Zt.prototype,"setPlaybackDevice"),Zt.prototype),dt(Zt.prototype,"setEnabled",[ZP,e1,t1],Object.getOwnPropertyDescriptor(Zt.prototype,"setEnabled"),Zt.prototype),dt(Zt.prototype,"setMuted",[n1,i1,r1],Object.getOwnPropertyDescriptor(Zt.prototype,"setMuted"),Zt.prototype),dt(Zt.prototype,"getStats",[s1],Object.getOwnPropertyDescriptor(Zt.prototype,"getStats"),Zt.prototype),dt(Zt.prototype,"setAudioFrameCallback",[o1],Object.getOwnPropertyDescriptor(Zt.prototype,"setAudioFrameCallback"),Zt.prototype),dt(Zt.prototype,"play",[a1,c1],Object.getOwnPropertyDescriptor(Zt.prototype,"play"),Zt.prototype),dt(Zt.prototype,"stop",[l1,d1],Object.getOwnPropertyDescriptor(Zt.prototype,"stop"),Zt.prototype),dt(Zt.prototype,"close",[u1],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),dt(Zt.prototype,"pipe",[h1],Object.getOwnPropertyDescriptor(Zt.prototype,"pipe"),Zt.prototype),dt(Zt.prototype,"unpipe",[p1],Object.getOwnPropertyDescriptor(Zt.prototype,"unpipe"),Zt.prototype),Zt),VE=(f1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),m1=En(),_1=Gd("MicrophoneAudioTrack","_enabledMutex"),E1=Fe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),g1=En(),S1=Fe({argsMap:e=>[e.getTrackId()]}),dt((Oo=class extends ln{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?xE(t.encoderConfig):{},i,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ne(this,"_config",void 0),ne(this,"_deviceName","default"),ne(this,"_constraints",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(jd()||xR())&&wt.bindInterruptDetectorTrack(this)}async setDevice(e){if(y.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Pr.getDeviceById(e),n={};n.audio=$t({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Dr(n,this.getTrackId())}catch(r){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await Dr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Pr.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}y.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return y.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),e),V("AUTO_RESET_AUDIO_ROUTE")&&(Oi()||us())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Lt(this,Ce.NEED_DISABLE_TRACK,this)}catch(o){throw y.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const r=$t({},this._constraints),s=Pr.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const o=await Dr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await Lt(this,Ce.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),y.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}y.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(jd()||xR())&&wt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Oi()||us())&&this._enabled&&!this._isClosed&&wt.duringInterruption){const e=async()=>{wt.off(Qn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(Qn.IOS_INTERRUPTION_END,e)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ru.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Pr.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Dr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Or.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Or.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[f1,m1],Object.getOwnPropertyDescriptor(Oo.prototype,"setDevice"),Oo.prototype),dt(Oo.prototype,"setEnabled",[_1,E1,g1],Object.getOwnPropertyDescriptor(Oo.prototype,"setEnabled"),Oo.prototype),dt(Oo.prototype,"close",[S1],Object.getOwnPropertyDescriptor(Oo.prototype,"close"),Oo.prototype),Oo),z3=(T1=Fe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),v1=En(),y1=Fe({argsMap:e=>[e.getTrackId()]}),R1=En(),b1=Fe({argsMap:e=>[e.getTrackId()]}),C1=En(),w1=Fe({argsMap:e=>[e.getTrackId()]}),A1=En(),I1=Fe({argsMap:e=>[e.getTrackId()]}),O1=En(),N1=Fe({argsMap:e=>[e.getTrackId()]}),D1=Fe({argsMap:e=>[e.getTrackId()]}),P1=En(),dt((ai=class extends ln{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),ne(this,"source",void 0),ne(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Ir.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(ru.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Nt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[T1,v1],Object.getOwnPropertyDescriptor(ai.prototype,"startProcessAudioBuffer"),ai.prototype),dt(ai.prototype,"pauseProcessAudioBuffer",[y1,R1],Object.getOwnPropertyDescriptor(ai.prototype,"pauseProcessAudioBuffer"),ai.prototype),dt(ai.prototype,"seekAudioBuffer",[b1,C1],Object.getOwnPropertyDescriptor(ai.prototype,"seekAudioBuffer"),ai.prototype),dt(ai.prototype,"resumeProcessAudioBuffer",[w1,A1],Object.getOwnPropertyDescriptor(ai.prototype,"resumeProcessAudioBuffer"),ai.prototype),dt(ai.prototype,"stopProcessAudioBuffer",[I1,O1],Object.getOwnPropertyDescriptor(ai.prototype,"stopProcessAudioBuffer"),ai.prototype),dt(ai.prototype,"close",[N1],Object.getOwnPropertyDescriptor(ai.prototype,"close"),ai.prototype),dt(ai.prototype,"setAudioBufferPlaybackSpeed",[D1,P1],Object.getOwnPropertyDescriptor(ai.prototype,"setAudioBufferPlaybackSpeed"),ai.prototype),ai);class xn extends ln{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=cu().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,jt(8,"track-mix-")),ne(this,"trackList",void 0),ne(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(y.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):y.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){y.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}pE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof xn?n.emit(pl.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class q3 extends LP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Ir.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ne(this,"audioBuffer",void 0),ne(this,"sourceNode",void 0),ne(this,"startPlayTime",0),ne(this,"startPlayOffset",0),ne(this,"pausePlayTime",0),ne(this,"options",void 0),ne(this,"currentLoopCount",0),ne(this,"currentPlaybackSpeed",100),ne(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):y.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const L1=new Map;class Hb{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(y.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ne(this,"trackId",void 0),ne(this,"config",void 0),ne(this,"onFirstVideoFrameDecoded",void 0),ne(this,"onVideoStateChanged",void 0),ne(this,"freezeTimeCounterList",[]),ne(this,"renderFreezeAccTime",0),ne(this,"isKeepLastFrame",!1),ne(this,"timeUpdatedCount",0),ne(this,"freezeTime",0),ne(this,"playbackTime",0),ne(this,"lastTimeUpdatedTime",0),ne(this,"autoplayFailed",!1),ne(this,"videoTrack",void 0),ne(this,"videoElement",void 0),ne(this,"cacheVideoElement",void 0),ne(this,"renderStats",void 0),ne(this,"_videoState",Io.VideoStateStopped),ne(this,"videoElementCheckInterval",void 0),ne(this,"videoElementFreezeTimeout",void 0),ne(this,"_videoElementStatus",yi.NONE),ne(this,"isGettingVideoDimensions",!1),ne(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return y.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ne(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&wt.curState==="running"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FN())),$N()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ne(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=yi.PLAYING;break;case"loadeddata":if(this.videoState=Io.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=yi.CANPLAY;break;case"stalled":this.videoElementStatus=yi.STALLED;break;case"suspend":this.videoElementStatus=yi.SUSPEND;break;case"pause":this.videoElementStatus=yi.PAUSED,Oi()||us()||ni()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=yi.WAITING;break;case"abort":this.videoElementStatus=yi.ABORT;break;case"ended":this.videoElementStatus=yi.ENDED;break;case"emptied":this.videoElementStatus=yi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=yi.ERROR,y.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,ga.lastVisibleTime<ga.lastHiddenTime||s<ga.lastHiddenTime||s<ga.lastVisibleTime)return;for(r>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ne(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(y.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FN())),$N()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),wt.on(Qn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(Qn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{t&&FP(t,"video",r.message,this.trackId),r.name==="NotAllowedError"?(y.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):y.warning("[".concat(this.trackId,"] play warning: "),r)});const i=ut();if((i.name==="Safari"&&Number(i.version)===15||jd())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return y.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new ve((s,o)=>{i.toBlob(async c=>{if(i.remove(),c){const u=await $P(c);s({buffer:u,width:i.width,height:i.height})}else o(new te(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await Gb(t)}destroy(){this.renderStats=void 0,wt.off(Qn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.off(Qn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Io.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=yi.INIT,!this.videoElementCheckInterval&&(k1.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=yi.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,V("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Io.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Io.VideoStateFrozen:document.addEventListener("visibilitychange",o))},u=(p,m)=>{if(this.videoElementStatus===yi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=m.mediaTime):this.renderStats={lastTs:m.mediaTime,curTs:m.mediaTime,lastRenderNum:0,renderNum:0},s){const v=m.presentationTime-s.presentationTime;this.videoState===Io.VideoStateStarting&&(this.videoState=Io.VideoStateDecoding),this.videoState===Io.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,V("VIDEO_FREEZE_DURATION"))),v<V("VIDEO_FREEZE_DURATION")&&this.videoState===Io.VideoStateFrozen&&(this.videoState=Io.VideoStateDecoding),v>V("VIDEO_FREEZE_DURATION")&&ga.lastVisibleTime>=ga.lastHiddenTime&&s.timestamp>ga.lastVisibleTime&&s.timestamp>ga.lastHiddenTime&&(this.renderFreezeAccTime+=v)}s=$t($t({},m),{},{timestamp:p})}var _,g;V("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(g=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(g,u))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),uE()&&!V("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ut();i.name==="Safari"&&Number(i.version)===15||jd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,on()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,on()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{y.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){k1.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=yi.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{y.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{y.error(i)}),this.autoplayFailed=!1,fp()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};fp()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),VP()}}const k1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class x1 extends Hb{constructor(t){super(t),ne(this,"container",void 0),ne(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await Gb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var M1,U1,j1,V1,F1,B1,G1,H1,W1,K1,Y1,z1,q1,$1,J1,X1,Q1,Z1,eL,tL,nL,iL,rL,sL,ot,oL,aL,cL,lL,dL,uL,hL,pL,kr;let Yt=(M1=Fe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),U1=En(),j1=Fe({argsMap:e=>[e.getTrackId()]}),V1=Gd("LocalVideoTrack","_enabledMutex"),F1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),B1=En(),G1=Gd("LocalVideoTrack","_enabledMutex"),H1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),W1=En(),K1=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),Y1=En(),z1=En(),q1=Fe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),$1=En(),J1=En(),X1=En(),Q1=En(),Z1=En(),eL=En(),tL=En(),nL=Fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),iL=Fe({argsMap:e=>[e.getTrackId()]}),rL=Fe({argsMap:e=>[e.getTrackId()]}),sL=Fe({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),ot=class bV extends au{get videoHeight(){if(ni()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(ni()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,r,s,o){if(super(t,s),ne(this,"trackMediaType",ou.VIDEO),ne(this,"_player",void 0),ne(this,"isUseScaleResolutionDownBy",!1),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ne(this,"_encoderConfig",void 0),ne(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ne(this,"_optimizationMode",void 0),ne(this,"_videoHeight",void 0),ne(this,"_videoWidth",void 0),ne(this,"_forceBitrateLimit",void 0),ne(this,"_enabled",!0),ne(this,"_processorDestination",void 0),ne(this,"_processorContext",void 0),ni()){const{width:c,height:u}=t.getSettings();this._videoWidth=c,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=o||[],this._hints.indexOf(Vt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(c,u,p){const m=ut();return!(m.name!==c||!m.osVersion)&&Number(m.version)===u}(vt.CHROME,115)&&lE().indexOf("Windows")!==-1){const c=function(u,p){if("VideoFrame"in window&&"TransformStream"in window&&pt().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(u),_=new MediaStreamTrackGenerator({kind:"video"});let g,v,D=Date.now();const C=()=>{w&&(clearInterval(w),w=void 0),g&&(g.close(),g=void 0),u.stop(),v=void 0,_.removeEventListener("ended",C)};let w=window.setInterval(()=>{if(v&&g&&Date.now()-D>1e3)try{_.readyState==="live"?v.enqueue(g.clone()):C()}catch{C()}},1e3);const P=new TransformStream({transform:(L,G)=>{_.readyState==="live"?(v=G,D=Date.now(),g===void 0?(g=L,G.enqueue(L.clone())):(G.enqueue(g),g=L)):L.close()}});return _.addEventListener("ended",C),m.readable.pipeThrough(P).pipeTo(_.writable),_}}(t);c&&(y.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(Vt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new GP(this.getTrackId(),"local"),this._processorDestination=new BP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const r=document.getElementById(t);r?t=r:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=$t($t($t({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new Hb(i):this._player=new x1(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(ru.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Lt(this,Ce.NEED_DISABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Lt(this,Ce.NEED_ENABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,y.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Lt(this,Ce.NEED_MUTE_TRACK,this):await Lt(this,Ce.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new te(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Ao(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=jE({encoderConfig:t});(ni()||Oi()||us())&&(i.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new te(k.UNEXPECTED_ERROR,r.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(Vt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Lt(this,Ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(y)}}getStats(){return oc(()=>{y.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Wr(this,Ce.GET_STATS)||$t({},xb)}async setBeautyEffect(t){y.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await Gb(t)}async setBitrateLimit(t){if(y.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Lt(this,Ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(y)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void y.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Lt(this,Ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,y.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return y.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,y.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){KP(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(mE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new te(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");y.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Ao(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Vt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Lt(this,Ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(y)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:o,min:c}=function(u,p,m,_,g){const v=V("BITRATE_ADAPTER_TYPE");if(v==="DEFAULT_BITRATE")return{min:_,max:g};if(g===void 0){var D;const w=Math.floor(200*Math.pow(m/15,.6)*Math.pow(u*p/640/360,.75));g=v==="STANDARD_BITRATE"?4*w:2*w,_=(D=_)!==null&&D!==void 0?D:w}else{var C;_=(C=_)!==null&&C!==void 0?C:Math.floor(g/10)}return{min:_,max:g}}(t,n,i,s,r);this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,y.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:o}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=eD.checkOneElementVisible(s),u=Object.assign({},c);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=Pe.reportApiInvoke(null,{tag:an.TRACER,name:Ln.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new te(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new te(k.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=$t($t({},i),Ao(t))),i=sl(i);const r=jt(8,"track-video-cloned-"),s=new bV(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,sl(this._scalabilityMode),this._optimizationMode,r,sl(this._hints));return t&&i&&s.setEncoderConfiguration(i),y.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new te(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new te(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(oc(()=>{Pe.reportApiInvoke(null,{name:Ln.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:an.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!V("ENABLE_VIDEO_SEI")||!V("ENABLE_ENCODED_TRANSFORM"))return void y.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new te(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void y.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",t):y.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Li.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Lt(this,Ce.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Lt(this,Ce.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Li.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Or.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Or.REQUEST_CONSTRAINTS)}},dt(ot.prototype,"play",[M1,U1],Object.getOwnPropertyDescriptor(ot.prototype,"play"),ot.prototype),dt(ot.prototype,"stop",[j1],Object.getOwnPropertyDescriptor(ot.prototype,"stop"),ot.prototype),dt(ot.prototype,"setEnabled",[V1,F1,B1],Object.getOwnPropertyDescriptor(ot.prototype,"setEnabled"),ot.prototype),dt(ot.prototype,"setMuted",[G1,H1,W1],Object.getOwnPropertyDescriptor(ot.prototype,"setMuted"),ot.prototype),dt(ot.prototype,"setEncoderConfiguration",[K1,Y1],Object.getOwnPropertyDescriptor(ot.prototype,"setEncoderConfiguration"),ot.prototype),dt(ot.prototype,"getStats",[z1],Object.getOwnPropertyDescriptor(ot.prototype,"getStats"),ot.prototype),dt(ot.prototype,"setBeautyEffect",[q1,$1],Object.getOwnPropertyDescriptor(ot.prototype,"setBeautyEffect"),ot.prototype),dt(ot.prototype,"getCurrentFrameData",[J1],Object.getOwnPropertyDescriptor(ot.prototype,"getCurrentFrameData"),ot.prototype),dt(ot.prototype,"getCurrentFrameImage",[X1],Object.getOwnPropertyDescriptor(ot.prototype,"getCurrentFrameImage"),ot.prototype),dt(ot.prototype,"setBitrateLimit",[Q1],Object.getOwnPropertyDescriptor(ot.prototype,"setBitrateLimit"),ot.prototype),dt(ot.prototype,"setOptimizationMode",[Z1],Object.getOwnPropertyDescriptor(ot.prototype,"setOptimizationMode"),ot.prototype),dt(ot.prototype,"setScalabiltyMode",[eL],Object.getOwnPropertyDescriptor(ot.prototype,"setScalabiltyMode"),ot.prototype),dt(ot.prototype,"updateMediaStreamTrackResolution",[tL],Object.getOwnPropertyDescriptor(ot.prototype,"updateMediaStreamTrackResolution"),ot.prototype),dt(ot.prototype,"pipe",[nL],Object.getOwnPropertyDescriptor(ot.prototype,"pipe"),ot.prototype),dt(ot.prototype,"unpipe",[iL],Object.getOwnPropertyDescriptor(ot.prototype,"unpipe"),ot.prototype),dt(ot.prototype,"close",[rL],Object.getOwnPropertyDescriptor(ot.prototype,"close"),ot.prototype),dt(ot.prototype,"replaceTrack",[sL],Object.getOwnPropertyDescriptor(ot.prototype,"replaceTrack"),ot.prototype),ot),Wb=(oL=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),aL=En(),cL=Gd("CameraVideoTrack","_enabledMutex"),lL=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),dL=En(),uL=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),hL=En(),pL=Fe({argsMap:e=>[e.getTrackId()]}),kr=class CV extends Yt{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,r,s,o){super(t,Ao(n.encoderConfig),r,s,o),ne(this,"_config",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_constraints",void 0),ne(this,"_enabled",!0),ne(this,"_deviceName","default"),ne(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(jd()||xR())&&!function(){const c=ut();if(c.os!==Vn.IOS||!c.osVersion)return!1;const u=c.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&JN()&&this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Ao(this._config.encoderConfig),wt.on(Qn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.on(Qn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(y.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await Pr.getDeviceById(t),i={};i.video=$t({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await Dr(i,this.getTrackId())}catch(s){throw y.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await Dr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Pr.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw y.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}y.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){y.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:$t($t({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Dr(n,this.getTrackId())}catch(r){throw y.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await Dr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=$t({},n.video),y.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(y.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Dr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Lt(this,Ce.NEED_ENABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),y.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Lt(this,Ce.NEED_DISABLE_TRACK,this)}catch(i){throw y.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}y.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new te(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Ao(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=fn(this._config);i.encoderConfig=t;const r=jE(i);(ni()||Oi()||us())&&(r.deviceId=void 0),y.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const o=new te(k.UNEXPECTED_ERROR,s.toString());throw y.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=t,this._hints.indexOf(Vt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Lt(this,Ce.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(y)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Oi()||us())&&this._enabled&&!this._isClosed&&wt.duringInterruption){const t=async()=>{wt.off(Qn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(y.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(Qn.IOS_INTERRUPTION_END,t)}else y.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ru.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=Pr.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await Dr({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),wt.off(Qn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.off(Qn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=$t($t({},i),Ao(t))),i=sl(i);const r=jt(8,"track-cam-cloned-"),s=new CV(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,sl($t($t({},this._config),{},{encoderConfig:i})),sl(this._constraints),sl(this._scalabilityMode),this._optimizationMode,r);return t&&i&&s.setEncoderConfiguration(i),y.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Or.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(Or.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},dt(kr.prototype,"setDevice",[oL,aL],Object.getOwnPropertyDescriptor(kr.prototype,"setDevice"),kr.prototype),dt(kr.prototype,"setEnabled",[cL,lL,dL],Object.getOwnPropertyDescriptor(kr.prototype,"setEnabled"),kr.prototype),dt(kr.prototype,"setEncoderConfiguration",[uL,hL],Object.getOwnPropertyDescriptor(kr.prototype,"setEncoderConfiguration"),kr.prototype),dt(kr.prototype,"close",[pL],Object.getOwnPropertyDescriptor(kr.prototype,"close"),kr.prototype),kr);function Kb(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=$t($t({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?y.debug("[".concat(e,"] set content hint to"),n.optimizationMode):y.debug("[".concat(e,"] set content hint failed")))):y.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var fL,mL,_L,EL,qr,gL,SL,TL,vL,yL,RL,Ri;class bL extends NP{getUserId(){return this._userId}constructor(t,n,i,r){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(jt(5,""))),ne(this,"_userId",void 0),ne(this,"_uintId",void 0),ne(this,"_isDestroyed",!1),ne(this,"store",void 0),ne(this,"processor",void 0),ne(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,y.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let du=(fL=Fe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),mL=Fe({argsMap:e=>[e.getTrackId()]}),_L=Fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EL=Fe({argsMap:e=>[e.getTrackId()]}),dt((qr=class extends bL{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ne(this,"trackMediaType",ou.VIDEO),ne(this,"_videoWidth",void 0),ne(this,"_videoHeight",void 0),ne(this,"_player",void 0),ne(this,"processorDestination",void 0),ne(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new GP(this.getTrackId(),"remote"),this.processorDestination=new BP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return oc(()=>{y.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Wr(this,Ce.GET_STATS)||$t({},IP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(y.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}y.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=$t($t({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Hb(n):this._player=new x1(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(su.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(su.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(su.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,y.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){KP(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(mE)}_updatePlayerSource(){y.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=eD.checkOneElementVisible(r),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const u=Pe.reportApiInvoke(null,{tag:an.TRACER,name:Ln.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new te(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new te(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Li.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Li.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(pl.SEI_RECEIVED,e)}}).prototype,"play",[fL],Object.getOwnPropertyDescriptor(qr.prototype,"play"),qr.prototype),dt(qr.prototype,"stop",[mL],Object.getOwnPropertyDescriptor(qr.prototype,"stop"),qr.prototype),dt(qr.prototype,"pipe",[_L],Object.getOwnPropertyDescriptor(qr.prototype,"pipe"),qr.prototype),dt(qr.prototype,"unpipe",[EL],Object.getOwnPropertyDescriptor(qr.prototype,"unpipe"),qr.prototype),qr),uu=(gL=Fe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),SL=Fe({argsMap:(e,t)=>[e.getTrackId(),t]}),TL=Fe({argsMap:e=>[e.getTrackId()]}),vL=Fe({argsMap:e=>[e.getTrackId()]}),yL=Fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),RL=Fe({argsMap:e=>[e.getTrackId()]}),dt((Ri=class extends bL{get isPlaying(){return this._useAudioElement?Gi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),ne(this,"trackMediaType",ou.AUDIO),ne(this,"_source",void 0),ne(this,"_useAudioElement",!0),ne(this,"_volume",100),ne(this,"processorContext",void 0),ne(this,"processorDestination",void 0),ne(this,"_played",!1),ne(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new Bb,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new kP(e,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ir.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(su.FIRST_FRAME_DECODED)}),this.processorContext=new WP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new HP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ir.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ir.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ir.ON_AUDIO_BUFFER),this._source.on(Ir.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Gi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!bP())throw new te(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return oc(()=>{y.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Wr(this,Ce.GET_STATS)||$t({},AP)}play(){y.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(y.debug("[".concat(this.getTrackId(),"] use audio element to play")),Gi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){y.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Gi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];y.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new te(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new te(k.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new te(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Li.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Li.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Li.ON_TRACK),this.processorDestination.removeAllListeners(Li.ON_NODE)}}).prototype,"setVolume",[gL],Object.getOwnPropertyDescriptor(Ri.prototype,"setVolume"),Ri.prototype),dt(Ri.prototype,"setPlaybackDevice",[SL],Object.getOwnPropertyDescriptor(Ri.prototype,"setPlaybackDevice"),Ri.prototype),dt(Ri.prototype,"play",[TL],Object.getOwnPropertyDescriptor(Ri.prototype,"play"),Ri.prototype),dt(Ri.prototype,"stop",[vL],Object.getOwnPropertyDescriptor(Ri.prototype,"stop"),Ri.prototype),dt(Ri.prototype,"pipe",[yL],Object.getOwnPropertyDescriptor(Ri.prototype,"pipe"),Ri.prototype),dt(Ri.prototype,"unpipe",[RL],Object.getOwnPropertyDescriptor(Ri.prototype,"unpipe"),Ri.prototype),Ri);const ga=new class extends nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ne(this,"_lastHiddenTime",0),ne(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),y.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class CL extends nn{constructor(t,n){super(),ne(this,"trackMediaType",ou.DATA),ne(this,"_version",1),ne(this,"_type",3),ne(this,"_config",void 0),ne(this,"_originDataChannel",void 0),ne(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ne(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),ne(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return V("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ve((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var r;n(new te(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new te(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new te(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[ME.OPEN,ME.CLOSE,ME.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;t.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class $3 extends CL{constructor(t){super(t),ne(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(V("SHOW_DATASTREAM2_LOG")&&y.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(ME.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class J3 extends CL{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function FE(){const e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>RP.revokeObjectURL(e),0),new Worker(RP.createObjectURL(e))}const BE=new Map,GE=new Map;function X3(e,t,n){let i=new Uint8Array(e,t,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}const HE=new Map;async function Q3(e,t){if(!pt().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(HE.has(e)||!e.track)return;const n={track:e.track};if(rc()){if(!e.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(c){return void y.error("create video-encoded-streams error",c&&c.message)}let s=[];t.on("sei-to-send",c=>{s.push(c)});const o=new TransformStream({transform(c,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(y.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const p=s.shift();p&&(c.data=function(m,_){const g=function(L){const G=L.length;let W=[],K=0;for(;K<G;)K+2<G&&L[K]===0&&L[K+1]===0&&(L[K+2]===0||L[K+2]===1||L[K+2]===2||L[K+2]===3)?(W.push(L[K],L[K+1],3,L[K+2]),K+=3):(W.push(L[K]),K++);return new Uint8Array(W)}(_),v=g.length,D=Math.floor(v/255),C=v%255,w=new Uint8Array(6+D+1+v+m.byteLength);w[0]=0,w[1]=0,w[2]=0,w[3]=1,w[4]=6,w[5]=101;let P=0;for(;P<D;)w[6+P]=255,P++;return w[6+P]=C,P++,w.set(g,6+P),w.set(new Uint8Array(m),6+P+v),w.buffer}(c.data,p)),u.enqueue(c)}});r.readable.pipeThrough(o).pipeTo(r.writable)}else{if(!ni())return;{if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const r=FE(),s=new MessageChannel;await new ve(c=>r.onmessage=u=>{u.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(r,{name:"tx",port:s.port2},[s.port2]);e.transform=o,await new ve(c=>r.onmessage=u=>{u.data==="started"&&c(void 0)}),t.on("sei-to-send",c=>{s.port1.postMessage({sei:c})}),s.port1.onmessage=c=>{var u;c.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(y.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const r=HE.get(e);if(r){HE.delete(e);try{var s,o;(s=r.controller)===null||s===void 0||s.terminate(),(o=r.worker)===null||o===void 0||o.terminate()}catch(c){y.warning(c&&c.message)}}}HE.set(e,n),e.track.addEventListener("ended",i)}const Op=new Map;(function(){const e=ut();Xn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xn.getStreamFromExtension=e.name===vt.CHROME&&Number(e.version)>34,Xn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Xn.supportMinBitrate=e.name===vt.CHROME||e.name===vt.EDGE,Xn.supportSetRtpSenderParameters=function(){const t=ut();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!sc()||!(!ni()&&!dE())||t.name===vt.FIREFOX&&Number(t.version)>=64)}(),e.name===vt.SAFARI&&(Number(e.version)>=14?Xn.supportDualStream=!0:Xn.supportDualStream=!1),Xn.webAudioMediaStreamDest=function(){const t=ut();return!(t.name===vt.SAFARI&&Number(t.version)<12)}(),Xn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xn.supportWebGL=typeof WebGLRenderingContext<"u",Xn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,sc()||(Xn.webAudioWithAEC=!0),Xn.supportShareAudio=function(){const t=ut();return(t.os===Vn.WIN_10||t.os===Vn.WIN_81||t.os===Vn.WIN_7||t.os===Vn.LINUX||t.os===Vn.MAC_OS||t.os===Vn.CHROMIUM_OS)&&t.name===vt.CHROME&&Number(t.version)>=74}(),Xn.supportDataChannel=!!(kR(76)||function(t){const n=ut();return!(n.name!==vt.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||WN(14)),Xn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!on()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Xn.supportWebRTCEncodedTransform=function(){const t=ut();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),Xn.supportWebRTCInsertableStream=function(){const t=ut();return(t.name===vt.CHROME||t.name===vt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,fE(()=>{Xn.supportDualStreamEncoding=function(){const t=ut();return!!V("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),y.debug("browser ua: ",navigator.userAgent),y.info("browser info: ",e),y.info("browser compatibility: ",Xn)})})();class _l extends nn{constructor(t,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Bt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*V("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,r,s){var o,c,u;if(this.userMap.size===0)return;const p=Array.from(ma(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(c=r)!==null&&c!==void 0?c:jt(6,""),s=(u=s)!==null&&u!==void 0?u:this._sequence++;const m={_id:r,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(p)};V("SHOW_P2P_LOG")&&y.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(g=>{this.signal.request(Ke.DATA_STREAM,{payload:ac(this.encoder.encode(g))})});const _=new ve((g,v)=>{const D=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),C),this.off("res-@".concat(r),P),this.off(Yd.ABORT,w),y.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(r)),this.userMap.size===0?v(new te(k.INVALID_REMOTE_USER)):v(new te(k.TIMEOUT))},V("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{D&&window.clearTimeout(D),this.off(Yd.ABORT,w),i&&g()},w=()=>{D&&window.clearTimeout(D),this.off("res-@".concat(r,"_ack"),C),this.off("res-@".concat(r),P),v(new te(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(r)))};this.once(Yd.ABORT,w),this.once("res-@".concat(r,"_ack"),C);const P=(G,W)=>{L=!0,D&&window.clearTimeout(D),this.off("res-@".concat(r,"_ack"),C),this.off(Yd.ABORT,w),G==="success"?g(W):v(new te(k.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(r)))};let L=!1;i||(this.once("res-@".concat(r),P),$n(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{L||y.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(r,", ").concat(m))}))});try{return await _}catch(g){if(g.code===k.TIMEOUT)return await this.send(t,n,i,r,s);throw g}}onMessage(t){var n;const{_uid:i}=t;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==_n.CHECK)return;const{token:p}=t;r=new Map,s={uid:i,isStart:!0,token:p,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(it.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:p,total:m}=t,_=(o=r.get(p))!==null&&o!==void 0?o:[];if(_.push(t),r.has(p)||r.set(p,_),_.length!==m)return;{const g=Zh(_).call(_,(v,D)=>v.index-D.index).map(v=>v.payload).join("");r.delete(p),(t=JSON.parse(g))._uid=i}}const{_type:c,token:u}=t;if(ge(n=[_n.ACK,_n.CHECK]).call(n,c))return c===_n.CHECK&&this.handleCheckToken(s,u),void this.receiveMessage(t);u==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):y.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:jt(6,""),token:this.token,_type:_n.CHECK};V("SHOW_P2P_LOG")&&y.debug("send message",t),this.signal.request(Ke.DATA_STREAM,{payload:ac(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:_n.ACK,token:this.token};V("SHOW_P2P_LOG")&&y.debug("send message",n),this.signal.request(Ke.DATA_STREAM,{payload:ac(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(_n.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:_}=p;for(;m.has(_);){const g=m.get(_);m.delete(_),this.receiveMessage(g),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:r}=t,s=this.userMap.get(i),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:u}=s;if(r<u)return this.ack(t._id),void y.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(t._message));o.set(r,t),c&&r===u&&(this.receiveMessage(t),o.delete(u),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:r,_uid:s}=t;if(V("SHOW_P2P_LOG")&&y.debug("receive message",t),n){let o;switch(t._type!==_n.ACK&&(r&&(o=JSON.parse(r)),this.ack(t._id)),t._type){case _n.CANDIDATE:case _n.CONTROL:this.signal.emit(i,o,s);break;case _n.PUBLISH:case _n.UNPUBLISH:case _n.RESTART_ICE:case _n.CALL:o.uid=s,ri(this.signal,i,o).then(c=>{this.response(t._id,c)}).catch(()=>{this.response(t._id,void 0,!0)});break;case _n.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case _n.RESPONSE:{const{success:c,message:u}=o;this.emit("res-@".concat(n),c?"success":"failed",u);break}}}}splitMessage(t){if(t.length<_l.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),r=jt(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const u={id:r,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(i)};JSON.stringify(u).length>_l.MAX_MESSAGE_SIZE?o-=50:(n.push(u),t=t.slice(o))}return n.map(u=>JSON.stringify(u))}handleCheckToken(t,n){return t.token!==n?(y.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{y.debug("token timeout, ".concat(n)),this.reset(t.uid)},V("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ri(this.signal,_n.CALL,void 0),n=await this.send(_n.CALL,t);this.signal.emit(Ye.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(Yd.ABORT),this.signal.emit(it.ON_USER_OFFLINE,{uid:i.uid,reason:fW.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(y.debug("change local token from ".concat(n," to ").concat(n)),this.token=jt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Yd.ABORT)}}O(_l,"MAX_SIZE",1),O(_l,"MAX_MESSAGE_SIZE",1024);class wL extends nn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(Ye.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(Ye.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(Ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new _D(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ye.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case it.ON_DATA_STREAM:return void this.handleDataStream(r._message);case it.MUTE_AUDIO:case it.MUTE_VIDEO:case it.ON_P2P_LOST:case it.ON_USER_ONLINE:return;case it.ON_USER_OFFLINE:const{uid:s}=r._message;return y.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===it.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===it.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(bt.UID_BANNED);break;case 15:this.close(bt.IP_BANNED);break;case 16:this.close(bt.CHANNEL_BANNED)}if(r._type===it.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Ve.ERR_LICENSE_MISSING:this.close(bt.LICENSE_MISSING);break;case Ve.ERR_LICENSE_EXPIRED:this.close(bt.LICENSE_EXPIRED);break;case Ve.ERR_LICENSE_MINUTES_EXCEEDED:this.close(bt.LICENSE_MINUTES_EXCEEDED);break;case Ve.ERR_LICENSE_PERIOD_INVALID:this.close(bt.LICENSE_PERIOD_INVALID);break;case Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(bt.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ve.ERR_LICENSE_ILLEGAL:this.close(bt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new ab("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",ii.OFFLINE)}),this.p2pToken=jt(6,""),this._external_signal=new _l(this,this.p2pToken)}async request(t,n,i,r){const s=jt(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,u=()=>new ve((D,C)=>{if(this.connectionState===Bt.CONNECTED)return D();const w=()=>{this.off(Ye.WS_CLOSED,P),D()},P=()=>{this.off(Ye.WS_CONNECTED,w),C(new te(k.WS_ABORT))};this.once(Ye.WS_CONNECTED,w),this.once(Ye.WS_CLOSED,P)});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===Ke.JOIN||t===Ke.REJOIN||await u(),this.websocket.sendMessage(o,!0),r)return;const p=new ve((D,C)=>{let w=!1;const P=(G,W)=>{w=!0,D({isSuccess:G==="success",message:W||{}}),this.off(Ye.WS_CLOSED,L),this.off(Ye.WS_RECONNECTING,L),this.emit(Ye.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),P);const L=()=>{C(new te(k.WS_ABORT,"type: ".concat(t))),this.off(Ye.WS_CLOSED,L),this.off(Ye.WS_RECONNECTING,L),this.off("res-@".concat(s),P)};this.once(Ye.WS_CLOSED,L),this.once(Ye.WS_RECONNECTING,L),$n(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||w||(y.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ye.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===Bt.CLOSED||t===Ke.LEAVE)throw new te(k.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():t===Ke.JOIN||t===Ke.REJOIN?null:(await u(),await this.request(t,n))}if(m.isSuccess)return m.message;const _=Number(m.message.error_code||m.message.code),g=Tp(_),v=new te(k.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(m.message.error_str),{code:_,data:m.message,desc:g.desc});return g.action==="success"?m.message:(y.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(_,", message: ").concat(g.desc,", action: ").concat(g.action)),_===Ve.ERR_TOO_MANY_BROADCASTERS?((t===Ke.JOIN||t===Ke.REJOIN)&&(this.initError=v,this.close()),v.throw()):g.action==="failed"?v.throw():g.action==="quit"?(this.initError=v,this.close(),v.throw()):(_===Ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,y.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ii.MULTI_IP)):this.reconnect(g.action,ii.SERVER_ERROR),t===Ke.JOIN||t===Ke.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new ve(i=>{const r=s=>{(!n||n(s))&&(this.off(t,r),i(s))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void y.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Sp.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const s=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ve((n,i)=>{this.once(Ye.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Ye.WS_CLOSED,()=>i(this.initError||new te(k.WS_ABORT))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||bt.LEAVE,this.connectionState=Bt.CLOSED,y.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=jt(6,""),this._external_signal.clear(),this._external_signal=new _l(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ye.ABORT_P2P_EXECUTION);const t=await ri(this,Ye.REQUEST_JOIN_INFO),n=await this.request(Ke.JOIN,t);if(!n)return this.emit(Ye.REPORT_JOIN_GATEWAY,k.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const i=ol(t.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||ge(n=Object.values(_n)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(it.ON_DATA_STREAM,t)}catch{this.emit(it.ON_DATA_STREAM,t)}}handleNotification(t){y.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Tp(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(bt.UID_BANNED),void this.close()):void this.reconnect(n.action,ii.SERVER_ERROR);y.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=V("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(y.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ii.TIMEOUT):this.request(Ke.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),V("REPORT_STATS")&&this.send(Ke.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on($e.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ye.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on($e.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($e.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on($e.FAILED,()=>{this._disconnectedReason=bt.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on($e.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on($e.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(y.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):y.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on($e.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Ye.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof te&&t.code===k.UNEXPECTED_RESPONSE&&t.data.code===Ve.ERR_NO_AUTHORIZED)return y.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ii.SERVER_ERROR);y.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ii.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on($e.REQUEST_NEW_URLS,(t,n)=>{ri(this,Ye.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var AL={exports:{}};(function(e,t){e.exports=(()=>{var n={8:(s,o,c)=>{c.r(o),c.d(o,{Parser:()=>tt,Printer:()=>Is,parse:()=>ze,print:()=>gt});const u=`
`,p="".concat("\r").concat(u),m=" ";let _;function g(Se){return Se>="0"&&Se<="9"}function v(Se){return Se>="!"&&Se<="~"}function D(Se){return v(Se)||Se>=""&&Se<="ÿ"}function C(Se){return Se==="!"||Se>="#"&&Se<="'"||Se>="*"&&Se<="+"||Se>="-"&&Se<="."||Se>="0"&&Se<="9"||Se>="A"&&Se<="Z"||Se>="^"&&Se<="~"}function w(Se){return Se>="1"&&Se<="9"}function P(Se){return Se>="A"&&Se<="Z"||Se>="a"&&Se<="z"}function L(Se){return Se==="d"||Se==="h"||Se==="m"||Se==="s"}function G(Se){return Se>""&&Se<"	"||Se>"\v"&&Se<"\f"||Se>""&&Se<"ÿ"}function W(Se){return P(Se)||g(Se)||Se==="+"||Se==="/"}function K(Se){return g(Se)||P(Se)||Se==="+"||Se==="/"||Se==="-"||Se==="_"}function ee(Se){return P(Se)||g(Se)||Se==="+"||Se==="/"}function ae(Se,b){var U=Object.keys(Se);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(Se);b&&(H=H.filter(function(ue){return Object.getOwnPropertyDescriptor(Se,ue).enumerable})),U.push.apply(U,H)}return U}function fe(Se){for(var b=1;b<arguments.length;b++){var U=arguments[b]!=null?arguments[b]:{};b%2?ae(Object(U),!0).forEach(function(H){de(Se,H,U[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Se,Object.getOwnPropertyDescriptors(U)):ae(Object(U)).forEach(function(H){Object.defineProperty(Se,H,Object.getOwnPropertyDescriptor(U,H))})}return Se}function de(Se,b,U){return b in Se?Object.defineProperty(Se,b,{value:U,enumerable:!0,configurable:!0,writable:!0}):Se[b]=U,Se}(function(Se){Se.VERSION="v",Se.ORIGIN="o",Se.SESSION_NAME="s",Se.INFORMATION="i",Se.URI="u",Se.EMAIL="e",Se.PHONE="p",Se.CONNECTION="c",Se.BANDWIDTH="b",Se.TIME="t",Se.REPEAT="r",Se.ZONE_ADJUSTMENTS="z",Se.KEY="k",Se.ATTRIBUTE="a",Se.MEDIA="m"})(_||(_={}));class Ne{consumeText(b,U){let H=U;for(;H<b.length;){const ue=b[H];if(ue==="\0"||ue==="\r"||ue===u)break;H+=1}if(H-U==0)throw new Error("Invalid text, at ".concat(b));return H}consumeUnicastAddress(b,U,H){return this.consumeTill(b,U,m)}consumeOneOrMore(b,U,H){let ue=U;for(;H(b[ue]);)ue++;if(ue-U==0)throw new Error("Invalid rule at ".concat(U,"."));return ue}consumeSpace(b,U){if(b[U]===m)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(b,U){let H=U;for(let ue=0;ue<4;ue++)if(H=this.consumeDecimalUChar(b,H),ue!==3){if(b[H]!==".")throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(b,U){let H=U;for(let qe=0;qe<3&&g(b[H]);qe++,H++);if(H-U==0)throw new Error("Invalid decimal uchar.");const ue=parseInt(b.slice(U,H));if(ue>=0&&ue<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,U){let H=this.consumeHexpart(b,U);return b[H]===":"&&(H+=1,H=this.consumeIP4Address(b,H)),H}consumeHexpart(b,U){let H=U;if(b[H]===":"&&b[H+1]===":"){H+=2;try{H=this.consumeHexseq(b,H)}catch{}return H}if(H=this.consumeHexseq(b,H),b[H]===":"&&b[H+1]===":"){H+=2;try{H=this.consumeHexseq(b,H)}catch{}return H}return H}consumeHexseq(b,U){let H=U;for(;H=this.consumeHex4(b,H),b[H]===":"&&b[H+1]!==":";)H+=1;return H}consumeHex4(b,U){let H=0;for(;H<4;H++)if(!((ue=b[U+H])>="0"&&ue<="9"||ue>="a"&&ue<="f"||ue>="A"&&ue<="F")){if(H===0)throw new Error("Invalid hex 4");break}var ue;return U+H}consumeFQDN(b,U){let H=U;for(;g(b[H])||P(b[H])||b[H]==="-"||b[H]===".";)H+=1;if(H-U<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(b,U){return this.consumeOneOrMore(b,U,D)}consumeMulticastAddress(b,U,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,U);default:try{return this.consumeFQDN(b,U)}catch{return this.consumeExtnAddr(b,U)}}}consumeIP6MulticastAddress(b,U){const H=this.consumeHexpart(b,U);return b[H]==="/"?this.consumeInteger(b,H+1):H}consumeIP4MulticastAddress(b,U){let H=U+3;const ue=b.slice(U,H),qe=parseInt(ue);if(qe<224||qe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let At=0;At<3;At++){if(b[H]!==".")throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(b,H)}return b[H]==="/"&&(H+=1),H=this.consumeTTL(b,H),b[H]==="/"&&(H=this.consumeInteger(b,H)),H}consumeInteger(b,U){if(!w(b[U]))throw new Error("Invalid integer.");for(U+=1;g(b[U]);)U+=1;return U}consumeTTL(b,U){if(b[U]==="0")return U+1;if(!w(b[U]))throw new Error("Invalid TTL.");U+=1;for(let H=0;H<2&&g(b[U]);H++)U+=1;return U}consumeToken(b,U){return this.consumeOneOrMore(b,U,C)}consumeTime(b,U){let H=U;if(b[H]==="0")return H+1;for(w(b[H])&&(H+=1);g(b[H]);)H++;if(H-U<10)throw new Error("Invalid time");return H}consumeAddress(b,U){return this.consumeTill(b,U,m)}consumeTypedTime(b,U){let H=U;return H=this.consumeOneOrMore(b,H,g),L(b[H])?H+1:H}consumeRepeatInterval(b,U){if(!w(b[U]))throw new Error("Invalid repeat interval");for(U+=1;g(b[U]);)U+=1;return L(b[U])&&(U+=1),U}consumePort(b,U){return this.consumeOneOrMore(b,U,g)}consume(b,U,H){for(let ue=0;ue<H.length;ue++){if(U+ue>=b.length)throw new Error("consume exceeding value length");if(b[U+ue]!==H[ue])throw new Error("consume ".concat(H," failed at ").concat(ue))}return U+H.length}consumeTill(b,U,H){let ue=U;for(;ue<b.length&&(typeof H!="string"||b[ue]!==H)&&(typeof H!="function"||!H(b[ue]));)ue++;return ue}}class tt extends Ne{constructor(){super(),de(this,"records",[]),de(this,"currentLine",0)}parse(b){const U=this.probeEOL(b);this.records=b.split(U).filter(Dn=>!!vi(Dn).call(Dn)).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),ue=this.parseOrigin(),qe=this.parseSessionName(),At=this.parseInformation(),jn=this.parseUri(),tr=this.parseEmail(),ba=this.parsePhone(),wg=this.parseConnection(),Ag=this.parseBandWidth(),Qr=this.parseTimeFields(),Ac=this.parseKey(),Iu=this.parseSessionAttribute(),gn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:ue,sessionName:qe,information:At,uri:jn,emails:tr,phones:ba,connection:wg,bandwidths:Ag,timeFields:Qr,key:Ac,attributes:Iu,mediaDescriptions:gn}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let U=0;U<b.length;U++)if(b[U]===u)return b[U-1]==="\r"?p:u;throw new Error("Invalid newline character.")}parseLine(b,U){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:b.slice(2),line:U,cur:0}}parseSessionAttribute(){const b=new Gt;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==_.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(U,ue=>C(ue)&&ue!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,H.attValue=this.extractOneOrMore(U,G)),b.parse(H),this.currentLine++}return b.digest()}parseMediaAttributes(b){const U=new Cn(b);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==_.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(H,qe=>C(qe)&&qe!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,ue.attValue=this.extractOneOrMore(H,G)),U.parse(ue),this.currentLine++}return U.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===_.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===_.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const H=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let ue=!1;b.value[b.cur]==="-"&&(ue=!0,b.cur+=1);const qe=this.extract(b,this.consumeTypedTime);U.push({time:H,typedTime:qe,back:ue})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const b=[];for(;;){const U=this.getCurrentRecord();if(U.type!==_.REPEAT)break;{const H=this.extract(U,this.consumeRepeatInterval),ue=this.parseTypedTime(U);b.push({repeatInterval:H,typedTimes:ue}),this.currentLine++}}return b}parseTypedTime(b){const U=[];for(;;)try{this.consumeSpaceForRecord(b),U.push(this.extract(b,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){const b=this.getCurrentRecord(),U=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const H=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:H}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==_.BANDWIDTH)break;{const H=this.extractOneOrMore(U,C);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;const ue=this.extractOneOrMore(U,g);b.push({bwtype:H,bandwidth:ue}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==_.VERSION)throw new Error("first sdp record must be version");const U=b.value.slice(0,this.consumeOneOrMore(b.value,0,g));if(U.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,U}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(b,D);this.consumeSpaceForRecord(b);const H=this.extractOneOrMore(b,g);this.consumeSpaceForRecord(b);const ue=this.extractOneOrMore(b,g);this.consumeSpaceForRecord(b);const qe=this.extractOneOrMore(b,C);this.consumeSpaceForRecord(b);const At=this.extractOneOrMore(b,C);this.consumeSpaceForRecord(b);const jn=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:H,sessVersion:ue,nettype:qe,addrtype:At,unicastAddress:jn}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===_.SESSION_NAME){const U=this.extract(b,this.consumeText);return this.currentLine++,U}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==_.INFORMATION)return;const U=this.extract(b,this.consumeText);return this.currentLine++,U}parseUri(){const b=this.getCurrentRecord();if(b.type===_.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const U=this.getCurrentRecord();if(U.type!==_.EMAIL)break;b.push(U.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const U=this.getCurrentRecord();if(U.type!==_.PHONE)break;b.push(U.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===_.CONNECTION){const U=this.extractOneOrMore(b,C);this.consumeSpaceForRecord(b);const H=this.extractOneOrMore(b,C);this.consumeSpaceForRecord(b);const ue=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:H,address:ue}}}parseMedia(){const b=this.getCurrentRecord(),U=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let H=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,H+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const ue=[];for(ue.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,ue.push(this.extract(b,this.consumeToken));if(ue.length===0)throw new Error("Invalid proto");const qe=this.parseFmt(b);return this.currentLine++,{mediaType:U,port:H,protos:ue,fmts:qe}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===_.TIME;){const U=this.parseTime(),H=this.parseRepeat(),ue=this.parseZone();b.push({time:U,repeats:H,zones:ue})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){const U=this.parseMedia(),H=this.parseInformation(),ue=this.parseConnections(),qe=this.parseBandWidth(),At=this.parseKey(),jn=this.parseMediaAttributes(U);b.push({media:U,information:H,connections:ue,bandwidths:qe,key:At,attributes:jn})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const U=[];for(;;)try{this.consumeSpaceForRecord(b),U.push(this.extract(b,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(b,U){for(var H=arguments.length,ue=new Array(H>2?H-2:0),qe=2;qe<H;qe++)ue[qe-2]=arguments[qe];const At=U.call(this,b.value,b.cur,...ue),jn=b.value.slice(b.cur,At);return b.cur=At,jn}extractOneOrMore(b,U){const H=this.consumeOneOrMore(b.value,b.cur,U),ue=b.value.slice(b.cur,H);return b.cur=H,ue}consumeSpaceForRecord(b){if(b.value[b.cur]!==m)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class Tt extends Ne{constructor(){super(...arguments),de(this,"attributes",void 0),de(this,"digested",!1)}extractOneOrMore(b,U,H){const ue=this.consumeOneOrMore(b.attValue,b._cur,U),qe=b.attValue.slice(b._cur,ue),[At,jn]=H||[];if(typeof At=="number"&&qe.length<At)throw new Error("error in length, should be more or equal than ".concat(At," characters."));if(typeof jn=="number"&&qe.length>jn)throw new Error("error in length, should be less or equal than ".concat(jn," characters."));return b._cur=ue,qe}consumeAttributeSpace(b){if(b.attValue[b._cur]!==m)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,U){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var H=arguments.length,ue=new Array(H>2?H-2:0),qe=2;qe<H;qe++)ue[qe-2]=arguments[qe];const At=U.call(this,b.attValue,b._cur,...ue),jn=b.attValue.slice(b._cur,At);return b._cur=At,jn}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,U){if(!b.attValue)throw new Error;for(let H=0;H<U.length;H++)if(U[H]!==b.attValue[b._cur+H])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,W,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,W,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(b);){U.push(this.extractOneOrMore(b,W));try{this.consumeAttributeSpace(b)}catch(H){if(this.atEnd(b))break;throw H}}this.attributes.iceOptions=U}parseFingerprint(b){const U=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const H=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:H})}parseExtmap(b){const U=this.extractOneOrMore(b,g);let H;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),H=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeTill,m),qe=fe(fe({entry:parseInt(U,10)},H&&{direction:H}),{},{extensionName:ue});this.peekChar(b)===m&&(this.consumeAttributeSpace(b),qe.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(qe)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(b,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class Gt extends Tt{constructor(){super(...arguments),de(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(U){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),U}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const U=this.extract(b,this.consumeToken),H=[];for(;!this.atEnd(b)&&this.peekChar(b)===m;)this.consumeAttributeSpace(b),H.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,K)}parseIdentity(b){const U=this.extractOneOrMore(b,ee),H=[];for(;!this.atEnd(b)&&this.peekChar(b)===m;){this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const qe=this.extractOneOrMore(b,At=>At!==m&&G(At));H.push({name:ue,value:qe})}this.attributes.identities.push({assertionValue:U,extensions:H})}parseMsidSemantic(b){this.peekChar(b)===m&&this.consumeAttributeSpace(b);const U={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),U.applyForAll=!0;break}{const H=this.extract(b,this.consumeTill,m);U.identifierList.push(H)}}this.attributes.msidSemantic=U}}class Cn extends Tt{constructor(b){super(),de(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(U){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),U}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const U=this.extractOneOrMore(b,W,[1,32]);this.consumeAttributeSpace(b);const H=this.extractOneOrMore(b,g,[1,5]);this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const qe=this.extractOneOrMore(b,g,[1,10]);this.consumeAttributeSpace(b);const At=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const jn=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const tr={foundation:U,componentId:H,transport:ue,priority:qe,connectionAddress:At,port:jn,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),tr.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),tr.relPort=this.extract(b,this.consumePort));this.peekChar(b)===m;){this.consumeAttributeSpace(b);const ba=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),tr.extension[ba]=this.extractOneOrMore(b,v)}this.attributes.candidates.push(tr)}parseRemoteCandidate(b){const U=[];for(;;){const H=this.extractOneOrMore(b,g,[1,5]);this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const qe=this.extract(b,this.consumePort);U.push({componentId:H,connectionAddress:ue,port:qe});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const U=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const H=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const ue={encodingName:H,clockRate:this.extractOneOrMore(b,g)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),ue.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const qe=this.attributes.payloads.find(At=>At.payloadType===parseInt(U,10));qe?qe.rtpMap=ue:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:ue,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const U=this.extractOneOrMore(b,g);this.consumeAttributeSpace(b);const H=this.extract(b,this.consumeTill,":");let ue;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),ue=this.extract(b,this.consumeTill));const qe=this.attributes.ssrcs.find(At=>At.ssrcId===parseInt(U,10));qe?qe.attributes[H]=ue:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[H]:ue}})}parseFmtp(b){const U=this.extract(b,this.consumeTill,m);this.consumeAttributeSpace(b);const H=this.extract(b,this.consumeTill),ue={};H.split(";").forEach(At=>{let[jn,tr]=At.split("=");jn=vi(jn).call(jn);const ba=typeof tr=="string"?vi(tr).call(tr):null;typeof jn=="string"&&jn.length>0&&(ue[jn]=ba)});const qe=this.attributes.payloads.find(At=>At.payloadType===parseInt(U,10));qe?qe.fmtp={parameters:ue}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:ue}})}parseFmtParameters(b){const U={},H=this.extract(b,this.consumeTill,"=");b._cur++;const ue=this.extract(b,this.consumeTill,";");for(U[H]=ue;b.attValue[b._cur]===";";){const qe=this.extract(b,this.consumeTill,"=");b._cur++;const At=this.extract(b,this.consumeTill,";");U[qe]=At}return U}parseRtcpFb(b){let U="";U=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,m),this.consumeAttributeSpace(b);const H=this.extract(b,this.consumeTill,m);let ue;if(H==="trr-int")ue={type:H,interval:this.extract(b,this.consumeTill)};else{const qe={type:H};this.peekChar(b)===m&&(this.consumeAttributeSpace(b),qe.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===m&&(qe.additional=this.extract(b,this.consumeTill))),ue=qe}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(ue);else{const qe=this.attributes.payloads.find(At=>At.payloadType===parseInt(U,10));qe?qe.rtcpFeedbacks.push(ue):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(b,this.consumePort)};this.peekChar(b)===m&&(this.consumeAttributeSpace(b),U.netType=this.extractOneOrMore(b,C),this.consumeAttributeSpace(b),U.addressType=this.extractOneOrMore(b,C),this.consumeAttributeSpace(b),U.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(b){const U={id:this.extractOneOrMore(b,C,[1,64])};this.peekChar(b)===m&&(this.consumeAttributeSpace(b),U.appdata=this.extractOneOrMore(b,C,[1,64])),this.attributes.msids.push(U)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const U=this.extractOneOrMore(b,ue=>P(ue)||g(ue)||ue==="_"||ue==="-");this.consumeAttributeSpace(b);const H={id:U,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===m){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const ue=[];for(;;){const qe=this.extract(b,this.consumeToken);ue.push(qe);try{this.extract(b,this.consume,",")}catch{break}}H.payloads=ue,this.peekChar(b)===m&&this.extract(b,this.consume,m)}for(;;){const ue=this.extract(b,this.consumeToken);switch(ue){case"depend":{const qe={type:ue,rids:this.extract(b,this.consume,"=").split(",")};H.params.push(qe);break}default:{const qe={type:ue};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),qe.val=this.extract(b,this.consumeTill,";")),H.params.push(qe)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,g,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,g,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const U=this.extract(b,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(b);const ue=this.extract(b,this.consumeInteger);H.push(parseInt(ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:H})}}function en(Se,b,U){return b in Se?Object.defineProperty(Se,b,{value:U,enumerable:!0,configurable:!0,writable:!0}):Se[b]=U,Se}class Is{constructor(){en(this,"eol",p)}print(b,U){let H="";return U&&(this.eol=U),H+=this.printVersion(b.version),H+=this.printOrigin(b.origin),H+=this.printSessionName(b.sessionName),H+=this.printInformation(b.information),H+=this.printUri(b.uri),H+=this.printEmail(b.emails),H+=this.printPhone(b.phones),H+=this.printConnection(b.connection),H+=this.printBandwidth(b.bandwidths),H+=this.printTimeFields(b.timeFields),H+=this.printKey(b.key),H+=this.printSessionAttributes(b.attributes),H+=this.printMediaDescription(b.mediaDescriptions),H}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let U="";for(const H of b)U+="e=".concat(H).concat(this.eol);return U}printPhone(b){let U="";for(const H of b)U+="e=".concat(H).concat(this.eol);return U}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let U="";for(const H of b)U+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return U}printTimeFields(b){let U="";for(const H of b){U+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const ue of H.repeats)U+="r=".concat(ue.repeatInterval," ").concat(ue.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(U+="z=",U+="z=".concat(H.zoneAdjustments.map(ue=>"".concat(ue.time," ").concat(ue.back?"-":""," ").concat(ue.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let U="";for(const H of b)U+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return U}printMediaDescription(b){let U="";for(const H of b)U+=this.printMedia(H.media),U+=this.printInformation(H.information),U+=this.printConnections(H.connections),U+=this.printBandwidth(H.bandwidths),U+=this.printKey(H.key),U+=this.printMediaAttributes(H);return U}printConnections(b){let U="";for(const H of b)U+=this.printConnection(H);return U}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new pe(this.eol).print(b)}printMediaAttributes(b){return new Ie(this.eol).print(b)}}class oe{constructor(b){en(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(m)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(m).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(m).concat(U.extensionName).concat(U.extensionAttributes?"".concat(m).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class pe extends oe{print(b){let U="";return U+=this.printGroups(b.groups),U+=this.printMsidSemantic(b.msidSemantic),U+=this.printIceLite(b.iceLite),U+=this.printIceUfrag(b.iceUfrag),U+=this.printIcePwd(b.icePwd),U+=this.printIceOptions(b.iceOptions),U+=this.printFingerprints(b.fingerprints),U+=this.printSetup(b.setup),U+=this.printTlsId(b.tlsId),U+=this.printIdentity(b.identities),U+=this.printExtmap(b.extmaps),U+=this.printUnrecognized(b.unrecognized),U}printGroups(b){let U="";return b.length>0&&(U+=b.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(ue=>"".concat(m).concat(ue)).join("")).concat(this.eol)).join("")),U}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(H=>"".concat(m).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let U="a=msid-semantic:".concat(b.semantic);return b.applyForAll?U+="".concat(m,"*"):b.identifierList.length>0&&(U+=b.identifierList.map(H=>"".concat(m).concat(H))),U+this.eol}}class Ie extends oe{print(b){const U=b.attributes;let H="";return H+=this.printRTCP(U.rtcp),H+=this.printIceUfrag(U.iceUfrag),H+=this.printIcePwd(U.icePwd),H+=this.printIceOptions(U.iceOptions),H+=this.printCandidates(U.candidates),H+=this.printRemoteCandidatesList(U.remoteCandidatesList),H+=this.printEndOfCandidates(U.endOfCandidates),H+=this.printFingerprints(U.fingerprints),H+=this.printSetup(U.setup),H+=this.printMid(U.mid),H+=this.printExtmap(U.extmaps),H+=this.printRTPRelated(U),H+=this.printPtime(U.ptime),H+=this.printMaxPtime(U.maxPtime),H+=this.printDirection(U.direction),H+=this.printSSRCGroups(U.ssrcGroups),H+=this.printSSRC(U.ssrcs),H+=this.printRTCPMux(U.rtcpMux),H+=this.printRTCPMuxOnly(U.rtcpMuxOnly),H+=this.printRTCPRsize(U.rtcpRsize),H+=this.printMSId(U.msids),H+=this.printImageattr(U.imageattr),H+=this.printRid(U.rids),H+=this.printSimulcast(U.simulcast),H+=this.printSCTPPort(U.sctpPort),H+=this.printMaxMessageSize(U.maxMessageSize),H+=this.printUnrecognized(U.unrecognized),H}printCandidates(b){return b.map(U=>"a=candidate:".concat(U.foundation).concat(m).concat(U.componentId).concat(m).concat(U.transport).concat(m).concat(U.priority).concat(m).concat(U.connectionAddress).concat(m).concat(U.port).concat(m,"typ").concat(m).concat(U.type).concat(U.relAddr?"".concat(m,"raddr").concat(m).concat(U.relAddr):"").concat(U.relPort?"".concat(m,"rport").concat(m).concat(U.relPort):"").concat(Object.keys(U.extension).map(H=>"".concat(m).concat(H).concat(m).concat(U.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(U=>"a=remote-candidates:".concat(U.join(m)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const U=b.payloads;let H="";H+=b.rtcpFeedbackWildcards.map(ue=>this.printRTCPFeedback("*",ue)).join("");for(const ue of U)H+=this.printRtpMap(ue.payloadType,ue.rtpMap),H+=this.printFmtp(ue.payloadType,ue.fmtp),H+=ue.rtcpFeedbacks.map(qe=>this.printRTCPFeedback(ue.payloadType,qe)).join("");return H}printFmtp(b,U){if(!U)return"";const H=Object.keys(U.parameters);return H.length===1&&U.parameters[H[0]]===null?"a=fmtp:".concat(b).concat(m).concat(H[0]).concat(this.eol):"a=fmtp:".concat(b).concat(m).concat(Object.keys(U.parameters).map(ue=>"".concat(ue,"=").concat(U.parameters[ue])).join(";")).concat(this.eol)}printRtpMap(b,U){return U?"a=rtpmap:".concat(b).concat(m).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,U){let H="a=rtcp-fb:".concat(b).concat(m),ue=U;return ue.type==="trr-int"?H+="ttr-int".concat(m).concat(ue.interval):(H+="".concat(ue.type),ue.parameter&&(H+="".concat(m).concat(ue.parameter),ue.additional&&(H+="".concat(m).concat(ue.additional)))),H+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(U=>Object.keys(U.attributes).map(H=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(m).concat(H).concat(U.attributes[H]?":".concat(U.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let U="a=rtcp:".concat(b.port);return b.netType&&(U+="".concat(m).concat(b.netType)),b.addressType&&(U+="".concat(m).concat(b.addressType)),b.address&&(U+="".concat(m).concat(b.address)),U+this.eol}printMSId(b){return b.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(m).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(b){return b.map(U=>{let H="a=rid:".concat(U.id).concat(m).concat(U.direction);return U.payloads&&(H+="".concat(m,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(H+="".concat(m).concat(U.params.map(ue=>ue.type==="depend"?"depend=".concat(ue.rids.join(",")):"".concat(ue.type,"=").concat(ue.val)).join(";"))),H+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(H=>"".concat(m).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function ze(Se){return new tt().parse(Se)}function gt(Se,b){return new Is().print(Se,b)}}},i={};function r(s){if(i[s])return i[s].exports;var o=i[s]={exports:{}};return n[s](o,o.exports,r),o.exports}return r.d=(s,o)=>{for(var c in o)r.o(o,c)&&!r.o(s,c)&&Object.defineProperty(s,c,{enumerable:!0,get:o[c]})},r.o=(s,o)=>Object.prototype.hasOwnProperty.call(s,o),r.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r(8)})()})(AL);var Zn=AL.exports;function Yb(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V("SVC_MODE");if(V("ENABLE_SVC"))return function(t){return t in eb}(e)?e:eb.L1T3}const IL={[we.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[we.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function WE(e,t,n){t.forEach(i=>{var r;const s=IL[e].find(c=>{var u;let{key:p}=c;return ge(u=i.extensionName).call(u,p)});if(!s)return;const o=n.find(c=>{let{extensionName:u}=c;return ge(u).call(u,s.key)});o&&ge(r=o.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=o.extensionName)})}function hu(e,t){t.forEach(n=>{var i;const r=IL[e].find(s=>{var o;let{key:c}=s;return ge(o=n.extensionName).call(o,c)});ge(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function OL(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ge(e).call(e,"abs-send-time")}function KE(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ge(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function NL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function DL(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NL(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Np(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:u}=t,{useXR:p}=n;let m=[],_=[],g=[],v=[],D=!1,C=!1;if(Zn.parse(e).mediaDescriptions.forEach(P=>{i&&i!==P.attributes.direction||(P.media.mediaType!=="video"||D||(_=P.attributes.payloads,v=P.attributes.extmaps,D=!0),P.media.mediaType!=="audio"||C||(m=P.attributes.payloads,g=P.attributes.extmaps,C=!0))}),!v||_.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_.forEach(P=>{var L;(L=P.rtpMap)!==null&&L!==void 0&&L.clockRate&&(P.rtpMap.clockRate=parseInt(P.rtpMap.clockRate)),p&&P.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(P=>{var L;(L=P.rtpMap)!==null&&L!==void 0&&L.clockRate&&(P.rtpMap.clockRate=parseInt(P.rtpMap.clockRate)),p&&P.rtcpFeedbacks.push({type:"rrtr"})}),r&&(m=m.filter(P=>{var L;return((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())!=="rtx"}),_=_.filter(P=>{var L;return((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())!=="rtx"})),s&&(_=_.filter(P=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test(((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName)||"")})),o&&(m=m.filter(P=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test(((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName)||"")})),c&&(c==null?void 0:c.length)>0&&(m=m.filter(P=>{var L;return ge(c).call(c,((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){const P=_.filter(L=>{var G;return ge(u).call(u,((G=L.rtpMap)===null||G===void 0?void 0:G.encodingName.toLowerCase())||"")});_=P.concat(r?[]:$b(P,_))}const w=V("UNSUPPORTED_VIDEO_CODEC");return w&&w.length>0&&(_=_.filter(P=>!(P.rtpMap&&ge(w).call(w,P.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:_,audioExtensions:g,videoExtensions:v}}function fc(e){const t=Zn.parse(e);let n,i;for(const r of t.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,o=r.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function PL(e,t){const n=[],i=e.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),r=e.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=e.attributes.ssrcs;if(r)r.ssrcIds.forEach(o=>{var c;const u=(c=i.find(p=>p.ssrcIds[0]===o))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?u:void 0})});else if(i.length>0){const o=i[0].ssrcIds[0],c=i[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function LL(e,t,n){const{cname:i}=e;let r=[];t&&(r=kL(t)),r.length===0&&(r=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),y.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const u=zE(e.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{p.push({kind:we.VIDEO,ssrcId:m.v,rtx:m.v_rtx,mslabel:"".concat(m.v,"_").concat(m.a)},{kind:we.AUDIO,ssrcId:m.a,mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:s,iceParameters:o,candidates:r,rtpCapabilities:u,setup:c,cname:i,preSSRCs:p}}function kL(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],y.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),y.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function El(e,t,n){const i=[],r=[];return e.forEach(s=>{let{ssrcId:o,rtx:c}=s;const u=jt(8,"track-"),p={ssrcId:o,attributes:DL({label:u,mslabel:n=n||jt(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(i.push(p),c!==void 0){const m={ssrcId:c,attributes:DL({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};i.push(m),r.push({semantic:"FID",ssrcIds:[o,c]})}}),e.length>1&&r.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:i,ssrcGroups:r}}function pu(e,t){t instanceof ln&&e.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!on()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function zb(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function qb(e,t){var n;if(!(t instanceof Yt&&t._encoderConfig&&t._hints.indexOf(Vt.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;pt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(r=>{var s,o;ge(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),pt().supportMinBitrate&&!ge(n=t._hints).call(n,Vt.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(r=>{var s,o;ge(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function xL(e){if(e.media.mediaType!=="video")return;const t=ut();if(t.name!==vt.SAFARI&&t.os!==Vn.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function YE(e,t,n){if(!t)return;let i,r;if(e.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),t.twcc===!0){const s=i.find(o=>KE(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(u=>KE(u.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(u,p){return p.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(g=>g.type==="transport-cc")))}(r,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(p=>p.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(o=>KE(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const s=i.find(o=>OL(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(u=>u.extensionName===o)||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(u,p){return p.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(g=>g.type==="goog-remb")))}(r,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(p=>p.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(o=>OL(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}}function ML(e,t,n){if(on()||e.media.mediaType!=="video"||!(t instanceof Yt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!V("SIMULCAST")||n==="vp9"&&V("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,r=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===r.ssrcId),o={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let c=1;c<i;c++)e.attributes.ssrcs.push({ssrcId:r.ssrcId+c,attributes:fn(r.attributes)}),o.ssrcIds.push(r.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:fn(r.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function UL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:o}=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=Np(p,c,u,"sendonly"),_=Np(p,c,u,"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(m,_,"videoExtensions",g,v,D),vs(m,_,"videoCodecs",g,v,D),vs(m,_,"audioExtensions",g,v,D),vs(m,_,"audioCodecs",g,v,D),V("RAISE_H264_BASELINE_PRIORITY")){const C=[],w=[];D.videoCodecs.forEach((P,L)=>{var G;if(((G=P.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var W,K;const ee=D.videoCodecs[L+1],ae=ee&&GL(P,ee),fe=(W=P.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"],de=(K=P.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!fe||fe!==V("FIRST_H264_PROFILE_LEVEL_ID")||V("FIRST_PACKETIZATION_MODE")&&de!==V("FIRST_PACKETIZATION_MODE")?ae?w.push([P,ee]):w.push([P]):ae?C.push([P,ee]):C.push([P])}}),C.length>0&&w.length>0&&(y.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((P,L)=>{var G;if(((G=P.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){const W=GL(P,D.videoCodecs[L+1]),K=C.shift()||w.shift()||[];K.length>0&&(W?D.videoCodecs.splice(L,2,...K):D.videoCodecs.splice(L,1,...K))}}),v.videoCodecs=v.videoCodecs.filter(P=>{var L,G;return!(((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((G=P.fmtp)===null||G===void 0?void 0:G.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))}),V("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(P=>{var L,G;return!(((L=P.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((G=P.fmtp)===null||G===void 0?void 0:G.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:g,recv:v,sendrecv:D}}(e,t,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:o}}function jL(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Np(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(e,t,"videoExtensions",n,i,r),vs(e,t,"videoCodecs",n,i,r),vs(e,t,"audioExtensions",n,i,r),vs(e,t,"audioCodecs",n,i,r),V("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){y.debug("raising H264 baseline profile priority");const c=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(o,0,c)}o!==-1&&(i.videoCodecs=i.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function vs(e,t,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach(c=>{t[n].some((u,p)=>{if(c.entry===u.entry&&c.extensionName===u.extensionName)return o.push(p),!0})?s[n].push(c):i[n].push(c)}),void t[n].forEach((c,u)=>{o.indexOf(u)===-1&&r[n].push(c)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach(c=>{t[n].some((u,p)=>{if(c.payloadType===u.payloadType&&JSON.stringify(c)===JSON.stringify(u))return o.push(p),!0})?s[n].push(c):i[n].push(c)}),void t[n].forEach((c,u)=>{o.indexOf(u)===-1&&r[n].push(c)})}}function zE(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let r,s;return t?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...t.audioCodecs,...i.audioCodecs],r.videoCodecs=[...t.videoCodecs,...i.videoCodecs],r.audioExtensions=[...t.audioExtensions,...i.audioExtensions],r.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function fu(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Dp(e,t,n,i){let r=[];if(e===we.VIDEO){if(V("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=t.videoCodecs.filter(s=>{var o;return ge(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===V("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const o=[],c=[],u=[];if(n.videoCodecs.forEach(p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";ge(m).call(m,i)?s.push(p):ge(m).call(m,"vp9")?o.push(p):ge(m).call(m,"vp8")?c.push(p):ge(m).call(m,"h264")&&u.push(p)}),s.length===0){let p="";o.length!==0?(s=o,p="vp9"):c.length!==0?(s=c,p="vp8"):u.length!==0&&(s=u,p="h264"),y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}s.length!==0&&(r=t.videoCodecs.filter(p=>s.some(m=>m.payloadType===p.payloadType)))}if(r.length===0&&(y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),r=t.videoCodecs),V("USE_PUB_RTX")||V("USE_SUB_RTX")){const s=$b(r,t.videoCodecs);r=[...r,...s]}}else r=t.audioCodecs.filter(s=>{var o;return ge(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,i)}),r.length===0&&(y.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=t.audioCodecs.filter(s=>{var o;return ge(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"opus")}));return r}function $b(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&ge(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function qE(e,t,n){const i=t.toString(),r=FL(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=VL(o,n||{}),r==null||r(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function VL(e,t,n){const i=Zn.parse(e),{useXR:r}=t;return i.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!ge(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&fu(s),r&&ge(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(u=>u.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),Zn.print(i)}function FL(e,t,n,i){if(V("SDP_LOGGING"))return y.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?r=>{FL(r,"answer",n==="local"?"remote":"local",i)}:void 0}function BL(e){const t=V("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>ge(e).call(e,n))}function GL(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function No(e,t){return typeof V(e)===t?V(e):void 0}function HL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function mc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HL(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Jb=new Map;class Z3 extends nn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(oi.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(oi.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){y.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?new wL(mc(mc({},n),{},{retryConfig:n.websocketRetryConfig}),t):new RW(mc(mc({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=Jb.get(t.cname);if(s||(s=new Map,Jb.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const p=new z(k.UID_CONFLICT);throw Pe.joinGateway(t.sid,{lts:r,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),this._isProactiveJoin=!1,p}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=r;const c=t.proxyServer;try{y.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const p=t.gatewayAddrs.map(m=>{let{address:_}=m;const[g,v]=_.split(":"),D={host:g,port:v};return t.proxyServer&&(D.proxy=t.proxyServer),D});o=(await this.signal.init(p,i)).uid,y.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var u;throw y.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),Pe.joinGateway(t.sid,{lts:r,succ:!1,ec:((u=p.data)===null||u===void 0?void 0:u.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!c,signalChannel:"0",preload:t.preload}),this._isProactiveJoin=!1,s.delete(t.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),y.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{y.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(oi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(oi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(oi.NETWORK_QUALITY,{uplinkNetworkQuality:WD(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:WD(this._statsCollector.trafficStats.B_dnq)}):this.emit(oi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==bt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Bt.CONNECTED||await function(i,r){return r===1/0?i:ve.race([i,TH(r)])}(this.signal.request(Ke.LEAVE,void 0,!0),3e3)}catch(i){y.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==bt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(await this.signal.request(Ke.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===Ve.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ke.PUBLISH_DATASTREAM,s,!0)}catch(o){if(i&&o.data&&o.data.code===Ve.ERR_PUBLISH_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ke.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){y.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ve.all(t.map(n=>this.signal.request(Ke.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){y.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX")||void 0,extend:V("SUB_EXTEND"),svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return await this.signal.request(Ke.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return(await this.signal.request(Ke.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ke.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!V("USE_SUB_RTX"),twcc:!!V("SUBSCRIBE_TWCC"),svc:Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0};try{return await this.signal.request(Ke.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return y.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw r}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,o=i.height,c=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,r||(c=!1)),c?{stream_type:0,width:s,height:o,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ke.SET_VIDEO_PROFILE,n);y.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ke.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){y.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ve.all(t.map(i=>this.signal.request(Ke.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){y.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Ke.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){y.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=t;return{gatewayEstablishParams:await this.signal.request(Ke.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ke.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ke.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let i,r=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(Ke.SET_CLIENT_ROLE,{role:t,level:r,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ke.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ke.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ke.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ke.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ke.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.signal instanceof wL)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),mc({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ke.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Jb.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:si.username,password:si.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(mc(mc({},si),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ke.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&fE(()=>{this.emit(oi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new z(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=V("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const r=!(on()||GN(87)||CP())&&typeof V("ENABLE_PRE_SUB")=="boolean"&&V("ENABLE_PRE_SUB"),s=!CP()&&No("ENABLE_PREALLOC_PC","boolean"),o=mc({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Kr,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof V("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?V("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof V("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?V("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof V("ENABLE_USER_LICENSE_CHECK")=="boolean"?V("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:V("USE_PUB_RTX")===!0||V("USE_SUB_RTX")===!0||void 0,disableFEC:V("DISABLE_FEC"),enableNTPReport:!!V("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!V("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!V("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:No("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!V("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!V("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:No("USE_XR","boolean"),enableLossbasedBwe:No("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!V("ENABLE_AUT_CC")||void 0,enableCCFallback:No("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:s,preSubNum:r?No("PRE_SUB_NUM","number"):void 0,enablePubTWCC:No("PUBLISH_TWCC","boolean"),enableSubTWCC:No("SUBSCRIBE_TWCC","boolean"),enablePubRTX:No("USE_PUB_RTX","boolean"),enableSubRTX:No("USE_SUB_RTX","boolean"),enableSubSVC:V("ENABLE_SVC")?V("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(V("SVC"))&&V("SVC").length!==0?V("SVC"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new z(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ye.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ye.WS_RECONNECTING,t=>{this.joinInfo&&Pe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ii.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Pe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ye.WS_CLOSED,t=>{let n;switch(t){case bt.LEAVE:n=ii.LEAVE;break;case bt.UID_BANNED:case bt.IP_BANNED:case bt.CHANNEL_BANNED:case bt.SERVER_ERROR:n=ii.SERVER_ERROR;break;case bt.FALLBACK:n=ii.FALLBACK;break;case bt.LICENSE_MISSING:case bt.LICENSE_EXPIRED:case bt.LICENSE_MINUTES_EXCEEDED:case bt.LICENSE_PERIOD_INVALID:case bt.LICENSE_MULTIPLE_SDK_SERVICE:case bt.LICENSE_ILLEGAL:case bt.TOKEN_EXPIRE:n=t;break;default:n=ii.NETWORK_ERROR}y.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+ii.NETWORK_ERROR)),this.joinInfo&&Pe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===bt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==bt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(y.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Pe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void y.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Dt("EVENT_REPORT_DOMAIN",t[1]),Dt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Dt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(it.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ye.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new z(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ri(this,oi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Ye.REQUEST_JOIN_INFO,async t=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:r,rtpCapabilities:s}=await ri(this,oi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:s,version:"2"}}))}),this.signal.on(Ye.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ye.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,r="";var s;t instanceof z?(i=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,r=t.message):i=t,Pe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Ye.IS_P2P_DISCONNECTED,t=>{t(Ep(this,oi.IS_P2P_DISCONNECTED))}),this.signal.on(Ye.DISCONNECT_P2P,()=>{this.emit(oi.DISCONNECT_P2P)}),this.signal.on(Ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ye.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(oi.JOIN_RESPONSE,t,n)}),this.signal.on(Ye.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=V("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const i=kL(t);this.emit(oi.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(Ye.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof V("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(V("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ke.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ke.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw y.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ke.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ke.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw y.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ke.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(r=>r.stream_type===yt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ke.CONTROL,i,!0,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(t,n){const i={action:t.find(r=>r.stream_type===yt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ke.CONTROL,i,!0,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(t,n){const i={action:t===we.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ke.CONTROL,i,!0,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(t,n){const i={action:t===we.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ke.CONTROL,i,!0,!0)}catch(r){throw y.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ke.RESTART_ICE,n,!0)}catch(i){throw y.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,ii.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!V("GATEWAY_WSS_ADDRESS"))return V("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(y.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ke.SET_PARAMETER,{enablePublishAudioFilter:t})}}let $E=0,Xb=0;function Js(e,t,n,i){return new ve((r,s)=>{t.timeout=t.timeout||V("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$E+=bo(t.data)):n&&(t.data.size?$E+=t.data.size:t.data instanceof FormData?$E+=lD(t.data):$E+=bo(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Bi.request(t).then(o=>{typeof o.data=="string"?Xb+=bo(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Xb+=o.data.byteLength:Xb+=bo(JSON.stringify(o.data)),i&&r({data:o.data,headers:o.headers}),r(o.data)}).catch(o=>{Bi.isCancel(o)?s(new z(k.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new z(k.NETWORK_TIMEOUT,o.message)):o.response?s(new z(k.NETWORK_RESPONSE_ERROR,o.response.status)):s(new z(k.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(oe){var pe=0;return function(){return pe<oe.length?{done:!1,value:oe[pe++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(oe,pe,Ie){return oe==Array.prototype||oe==Object.prototype||(oe[pe]=Ie.value),oe},i,r=function(oe){oe=[typeof globalThis=="object"&&globalThis,oe,typeof window=="object"&&window,typeof self=="object"&&self,typeof E=="object"&&E];for(var pe=0;pe<oe.length;++pe){var Ie=oe[pe];if(Ie&&Ie.Math==Math)return Ie}throw Error("Cannot find global object")}(this);function s(oe,pe){if(pe)e:{var Ie=r;oe=oe.split(".");for(var ze=0;ze<oe.length-1;ze++){var gt=oe[ze];if(!(gt in Ie))break e;Ie=Ie[gt]}(pe=pe(ze=Ie[oe=oe[oe.length-1]]))!=ze&&pe!=null&&n(Ie,oe,{configurable:!0,writable:!0,value:pe})}}function o(oe){return(oe={next:oe})[Symbol.iterator]=function(){return this},oe}function c(oe){var pe=typeof Symbol<"u"&&Symbol.iterator&&oe[Symbol.iterator];return pe?pe.call(oe):{next:t(oe)}}if(s("Symbol",function(oe){function pe(gt,Se){this.A=gt,n(this,"description",{configurable:!0,writable:!0,value:Se})}if(oe)return oe;pe.prototype.toString=function(){return this.A};var Ie="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ze=0;return function gt(Se){if(this instanceof gt)throw new TypeError("Symbol is not a constructor");return new pe(Ie+(Se||"")+"_"+ze++,Se)}}),s("Symbol.iterator",function(oe){if(oe)return oe;oe=Symbol("Symbol.iterator");for(var pe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ie=0;Ie<pe.length;Ie++){var ze=r[pe[Ie]];typeof ze=="function"&&typeof ze.prototype[oe]!="function"&&n(ze.prototype,oe,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return oe}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;e:{var p={};try{p.__proto__={a:!0},u=p.a;break e}catch{}u=!1}i=u?function(oe,pe){if(oe.__proto__=pe,oe.__proto__!==pe)throw new TypeError(oe+" is not extensible");return oe}:null}var m=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(oe){if(oe.m)throw new TypeError("Generator is already running");oe.m=!0}function v(oe,pe){return oe.h=3,{value:pe}}function D(oe){this.g=new _,this.G=oe}function C(oe,pe,Ie,ze){try{var gt=pe.call(oe.g.j,Ie);if(!(gt instanceof Object))throw new TypeError("Iterator result "+gt+" is not an object");if(!gt.done)return oe.g.m=!1,gt;var Se=gt.value}catch(b){return oe.g.j=null,oe.g.s(b),w(oe)}return oe.g.j=null,ze.call(oe.g,Se),w(oe)}function w(oe){for(;oe.g.h;)try{var pe=oe.G(oe.g);if(pe)return oe.g.m=!1,{value:pe.value,done:!1}}catch(Ie){oe.g.v=void 0,oe.g.s(Ie)}if(oe.g.m=!1,oe.g.l){if(pe=oe.g.l,oe.g.l=null,pe.F)throw pe.D;return{value:pe.return,done:!0}}return{value:void 0,done:!0}}function P(oe){this.next=function(pe){return oe.o(pe)},this.throw=function(pe){return oe.s(pe)},this.return=function(pe){return function(Ie,ze){g(Ie.g);var gt=Ie.g.j;return gt?C(Ie,"return"in gt?gt.return:function(Se){return{value:Se,done:!0}},ze,Ie.g.return):(Ie.g.return(ze),w(Ie))}(oe,pe)},this[Symbol.iterator]=function(){return this}}function L(oe,pe){return pe=new P(new D(pe)),m&&oe.prototype&&m(pe,oe.prototype),pe}if(_.prototype.o=function(oe){this.v=oe},_.prototype.s=function(oe){this.l={D:oe,F:!0},this.h=this.C||this.u},_.prototype.return=function(oe){this.l={return:oe},this.h=this.u},D.prototype.o=function(oe){return g(this.g),this.g.j?C(this,this.g.j.next,oe,this.g.o):(this.g.o(oe),w(this))},D.prototype.s=function(oe){return g(this.g),this.g.j?C(this,this.g.j.throw,oe,this.g.o):(this.g.s(oe),w(this))},s("Array.prototype.entries",function(oe){return oe||function(){return function(pe,Ie){pe instanceof String&&(pe+="");var ze=0,gt=!1,Se={next:function(){if(!gt&&ze<pe.length){var b=ze++;return{value:Ie(b,pe[b]),done:!1}}return gt=!0,{done:!0,value:void 0}}};return Se[Symbol.iterator]=function(){return Se},Se}(this,function(pe,Ie){return[pe,Ie]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(oe,pe){for(var Ie=0;Ie<oe.length;Ie++)pe(oe[Ie])},W=function(oe){return oe.replace(/\r?\n|\r/g,`\r
`)},K=function(oe,pe,Ie){return pe instanceof Blob?(Ie=Ie!==void 0?Ie+"":typeof pe.name=="string"?pe.name:"blob",pe.name===Ie&&Object.prototype.toString.call(pe)!=="[object Blob]"||(pe=new File([pe],Ie)),[String(oe),pe]):[String(oe),String(pe)]},ee=function(oe,pe){if(oe.length<pe)throw new TypeError(pe+" argument required, but only "+oe.length+" present.")},ae=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,fe=ae.FormData,de=ae.XMLHttpRequest&&ae.XMLHttpRequest.prototype.send,Ne=ae.Request&&ae.fetch,tt=ae.navigator&&ae.navigator.sendBeacon,Tt=ae.Element&&ae.Element.prototype,Gt=ae.Symbol&&Symbol.toStringTag;Gt&&(Blob.prototype[Gt]||(Blob.prototype[Gt]="Blob"),"File"in ae&&!File.prototype[Gt]&&(File.prototype[Gt]="File"));try{new File([],"")}catch{ae.File=function(pe,Ie,ze){return pe=new Blob(pe,ze||{}),Object.defineProperties(pe,{name:{value:Ie},lastModified:{value:+(ze&&ze.lastModified!==void 0?new Date(ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Gt&&Object.defineProperty(pe,Gt,{value:"File"}),pe}}var Cn=function(oe){return oe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},en=function(oe){this.i=[];var pe=this;oe&&G(oe.elements,function(Ie){if(Ie.name&&!Ie.disabled&&Ie.type!=="submit"&&Ie.type!=="button"&&!Ie.matches("form fieldset[disabled] *"))if(Ie.type==="file"){var ze=Ie.files&&Ie.files.length?Ie.files:[new File([],"",{type:"application/octet-stream"})];G(ze,function(gt){pe.append(Ie.name,gt)})}else Ie.type==="select-multiple"||Ie.type==="select-one"?G(Ie.options,function(gt){!gt.disabled&&gt.selected&&pe.append(Ie.name,gt.value)}):Ie.type==="checkbox"||Ie.type==="radio"?Ie.checked&&pe.append(Ie.name,Ie.value):(ze=Ie.type==="textarea"?W(Ie.value):Ie.value,pe.append(Ie.name,ze))})};if((e=en.prototype).append=function(oe,pe,Ie){ee(arguments,2),this.i.push(K(oe,pe,Ie))},e.delete=function(oe){ee(arguments,1);var pe=[];oe=String(oe),G(this.i,function(Ie){Ie[0]!==oe&&pe.push(Ie)}),this.i=pe},e.entries=function oe(){var pe,Ie=this;return L(oe,function(ze){if(ze.h==1&&(pe=0),ze.h!=3)return pe<Ie.i.length?ze=v(ze,Ie.i[pe]):(ze.h=0,ze=void 0),ze;pe++,ze.h=2})},e.forEach=function(oe,pe){ee(arguments,1);for(var Ie=c(this),ze=Ie.next();!ze.done;ze=Ie.next()){var gt=c(ze.value);ze=gt.next().value,gt=gt.next().value,oe.call(pe,gt,ze,this)}},e.get=function(oe){ee(arguments,1);var pe=this.i;oe=String(oe);for(var Ie=0;Ie<pe.length;Ie++)if(pe[Ie][0]===oe)return pe[Ie][1];return null},e.getAll=function(oe){ee(arguments,1);var pe=[];return oe=String(oe),G(this.i,function(Ie){Ie[0]===oe&&pe.push(Ie[1])}),pe},e.has=function(oe){ee(arguments,1),oe=String(oe);for(var pe=0;pe<this.i.length;pe++)if(this.i[pe][0]===oe)return!0;return!1},e.keys=function oe(){var pe,Ie,ze,gt,Se=this;return L(oe,function(b){if(b.h==1&&(pe=c(Se),Ie=pe.next()),b.h!=3)return Ie.done?void(b.h=0):(ze=Ie.value,gt=c(ze),v(b,gt.next().value));Ie=pe.next(),b.h=2})},e.set=function(oe,pe,Ie){ee(arguments,2),oe=String(oe);var ze=[],gt=K(oe,pe,Ie),Se=!0;G(this.i,function(b){b[0]===oe?Se&&(Se=!ze.push(gt)):ze.push(b)}),Se&&ze.push(gt),this.i=ze},e.values=function oe(){var pe,Ie,ze,gt,Se=this;return L(oe,function(b){if(b.h==1&&(pe=c(Se),Ie=pe.next()),b.h!=3)return Ie.done?void(b.h=0):(ze=Ie.value,(gt=c(ze)).next(),v(b,gt.next().value));Ie=pe.next(),b.h=2})},en.prototype._asNative=function(){for(var oe=new fe,pe=c(this),Ie=pe.next();!Ie.done;Ie=pe.next()){var ze=c(Ie.value);Ie=ze.next().value,ze=ze.next().value,oe.append(Ie,ze)}return oe},en.prototype._blob=function(){var oe="----formdata-polyfill-"+Math.random(),pe=[],Ie="--"+oe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ze,gt){return typeof ze=="string"?pe.push(Ie+Cn(W(gt))+`"\r
\r
`+W(ze)+`\r
`):pe.push(Ie+Cn(W(gt))+'"; filename="'+Cn(ze.name)+`"\r
Content-Type: `+(ze.type||"application/octet-stream")+`\r
\r
`,ze,`\r
`)}),pe.push("--"+oe+"--"),new Blob(pe,{type:"multipart/form-data; boundary="+oe})},en.prototype[Symbol.iterator]=function(){return this.entries()},en.prototype.toString=function(){return"[object FormData]"},Tt&&!Tt.matches&&(Tt.matches=Tt.matchesSelector||Tt.mozMatchesSelector||Tt.msMatchesSelector||Tt.oMatchesSelector||Tt.webkitMatchesSelector||function(oe){for(var pe=(oe=(this.document||this.ownerDocument).querySelectorAll(oe)).length;0<=--pe&&oe.item(pe)!==this;);return-1<pe}),Gt&&(en.prototype[Gt]="FormData"),de){var Is=ae.XMLHttpRequest.prototype.setRequestHeader;ae.XMLHttpRequest.prototype.setRequestHeader=function(oe,pe){Is.call(this,oe,pe),oe.toLowerCase()==="content-type"&&(this.B=!0)},ae.XMLHttpRequest.prototype.send=function(oe){oe instanceof en?(oe=oe._blob(),this.B||this.setRequestHeader("Content-Type",oe.type),de.call(this,oe)):de.call(this,oe)}}Ne&&(ae.fetch=function(oe,pe){return pe&&pe.body&&pe.body instanceof en&&(pe.body=pe.body._blob()),Ne.call(this,oe,pe)}),tt&&(ae.navigator.sendBeacon=function(oe,pe){return pe instanceof en&&(pe=pe._asNative()),tt.call(this,oe,pe)}),ae.FormData=en}})();const Pp=()=>{const e=V("AREAS");return e.length===0&&e.push(Et.GLOBAL),yr(e).call(e,(t,n,i)=>{const r=WL(n);return r?i===0?r:"".concat(t,",").concat(r):t},"")},WL=e=>e===Et.OVERSEA?"".concat(hi.ASIA,",").concat(hi.EUROPE,",").concat(hi.AFRICA,",").concat(hi.NORTH_AMERICA,",").concat(hi.SOUTH_AMERICA,",").concat(hi.OCEANIA):hi[e],e7=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=bE[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(i[s]))})}),t},JE={GLOBAL:{ASIA:[Et.CHINA,Et.JAPAN,Et.INDIA,Et.KOREA,Et.HKMC],EUROPE:[],NORTH_AMERICA:[Et.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},XE=Object.keys(JE[Et.GLOBAL]),Qb=[Et.CHINA,Et.NORTH_AMERICA,Et.EUROPE,Et.ASIA,Et.JAPAN,Et.INDIA,Et.OCEANIA,Et.SOUTH_AMERICA,Et.AFRICA,Et.KOREA,Et.HKMC,Et.US],t7=function(e,t){let n=[];if(ge(e).call(e,Et.GLOBAL)){const s=[Et.GLOBAL,Et.OVERSEA],o=Object.keys(bE);if(t===Et.GLOBAL)throw new z(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Et.CHINA)n=[Et.OVERSEA];else if(r=t,ge(XE).call(XE,r)){const c=(i=t,JE[Et.GLOBAL][i]||[]),u=[...s,t,...c];n=o.filter(p=>!ge(u).call(u,p))}else if(function(c){let u=!1;return XE.forEach(p=>{var m;ge(m=JE[Et.GLOBAL][p]).call(m,c)&&(u=!0)}),u}(t)){const c=function(p){let m;return XE.forEach(_=>{var g;ge(g=JE[Et.GLOBAL][_]).call(g,p)&&(m=_)}),m}(t),u=[...s,c,t];n=o.filter(p=>!ge(u).call(u,p))}else n=e;n=function(c){const u=[];return Qb.forEach(p=>{ge(c).call(c,p)&&u.push(p)}),u.concat(c.filter(p=>!ge(Qb).call(Qb,p)))}(n)}else n=e;var i,r;return n};function KL(e){var t,n;if(!e&&ge(t=V("AREAS")).call(t,Et.EXTENSIONS))return y.debug("update area from ap : reset"),void Zb(NH,!0);if(!ge(n=V("AREAS")).call(n,Et.GLOBAL)||!e)return;let i=bE.EXTENSIONS;i&&(i={CODE:WL(Et.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},y.debug("update area from ap success: ".concat(e,",config is "),i),Dt("AREAS",[Et.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Dt(r,i[r][0]):Dt(r,i[r])}))}function Zb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Pe.reportApiInvoke(null,{name:Ln.SET_AREA,options:e,tag:an.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!ge(LD).call(LD,s))throw new z(k.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new z(k.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),i=o?t7(c,o):c}if(!t){if(cc.AREAS){const s=new z(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void y.warning("setArea is prohibited because of config-distribute")}if(ge(i).call(i,Et.GLOBAL)&&V("AREAS")===Et.EXTENSIONS){const s=new z(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void y.warning("setArea is prohibited because of ap extensions")}}Dt("AREAS",i,t);const r=e7(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Dt(s,r[s][0]):Dt(s,r[s])}),y.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function YL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function QE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YL(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YL(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let eC=1;function n7(e,t,n,i,r){eC+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:eC,requestId:eC,version:Kr,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,u,p=e[0];return Ys(async()=>{c=Date.now();const m=await Js(p,{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-c,m.code!==0){const v=new z(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:u});throw y.error(v.toString()),v}const _=JSON.parse(m.json_body);if(_.code!==200){const v=new z(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:u});throw y.error(v.toString()),v}if(!_.servers||_.servers.length===0){const v=new z(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:u});throw y.error(v.toString()),v}const g=function(v,D){return{addressList:v.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:v.workerToken,vid:v.vid}}(_,t);return V("LIVE_STREAMING_ADDRESS")&&(g.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),QE(QE({},g),{},{responseTime:u})},(m,_)=>(Pe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:_===0,responseTime:u,serverIp:e[_%e.length]}),!1),(m,_)=>(Pe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:u,serverIp:e[_%e.length]}),!!(m.code!==k.OPERATION_ABORTED&&m.code!==k.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=e[(_+1)%e.length],!0)),r)}let tC=1;function zL(e,t,n,i){let{url:r,areaCode:s}=e;const{clientId:o,sid:c}=t,u=Date.now();let p;const[m,_]=iC(t,s,[vn.CHOOSE_SERVER]);let g=Tn.networkState;return Ys(async()=>{g&&Tn.networkState===ur.OFFLINE&&Tn.onlineWaiter&&await ve.race([Tn.onlineWaiter,$n(i&&i.maxRetryTimeout||On.maxRetryTimeout)]),g=Tn.networkState;const{data:v,headers:D}=await Js(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=D.http3==="1"?1:-1,Pe.reportResourceTiming(r,c),$L(v,r,t,u,[vn.CHOOSE_SERVER],p);const C=yp(v,vn.CHOOSE_SERVER);return nC(C),cb(C,r)},v=>(v&&Pe.joinChooseServer(c,{lts:u,succ:!0,csAddr:r,opid:_,serverList:v.gatewayAddrs.map(D=>D.address),ec:null,cid:v.cid.toString(),uid:v.uid.toString(),csIp:v.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:v.res.detail&&v.res.detail[38]}),!1),v=>v.code!==k.OPERATION_ABORTED&&(v.code===k.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(Pe.joinChooseServer(c,{lts:u,succ:!1,csAddr:r,serverList:null,opid:_,ec:v.code,csIp:v.data&&v.data.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:p,corssRegionTagReq:t.apRequestDetail}),y.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),v),!0)),i)}function qL(e,t,n,i){let r,{url:s,areaCode:o,serviceIds:c}=e;const u=Date.now(),[p,m]=iC(t,o,c);let _;return Ys(async()=>{_&&Tn.networkState===ur.OFFLINE&&Tn.onlineWaiter&&await ve.race([Tn.onlineWaiter,$n(i&&i.maxRetryTimeout||On.maxRetryTimeout)]),_=Tn.networkState;const{data:g,headers:v}=await Js(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=v.http3==="1"?1:-1,Pe.reportResourceTiming(s,t.sid),$L(g,s,t,u,c,r);const D=yp(g,vn.CHOOSE_SERVER),C=yp(g,t.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK);return nC(D),{gatewayInfo:cb(D,s),proxyInfo:C,url:s}},g=>(g.gatewayInfo&&Pe.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(v=>v.address),ec:null,opid:m,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:r,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38]}),g.proxyInfo&&Pe.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(v=>v.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),g=>g.code!==k.OPERATION_ABORTED&&(g.code===k.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Pe.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:_})}),y.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const $L=(e,t,n,i,r,s)=>{const{sid:o,clientId:c,cloudProxyServer:u}=n,p=[],m=_=>{_.flag===4096?Pe.joinChooseServer(o,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||Pe.joinWebProxyAP(o,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:_.error.code,eventType:u,unilbsServerIds:r.toString()})};if(e.response_body.forEach(_=>{const g=_.buffer.code;if(_.uri===23&&g===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)y.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const v={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:_.buffer.flag};p.push(v),m(v)}if(g!==0){const v=zd(g),D={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{desc:v.desc,retry:v.retry,csIp:e.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?y.warning(D.error.toString()):p.push(D),m(D)}}),p.length)throw y.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new z(k.CAN_NOT_GET_GATEWAY_SERVER,p.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!p.find(_=>_.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(_=>{var g;return _==null||(g=_.error)===null||g===void 0||(g=g.data)===null||g===void 0?void 0:g.desc}).filter(_=>!!_))]})},nC=e=>{var t,n,i,r;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new z(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(V("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((r=e.detail)===null||r===void 0?void 0:r[23])=="string"?KL(e.detail[23].toLowerCase()):KL()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o==null?void 0:o.split(";");for(let u=0;u<c.length;u++){var s;const p=vi(s=c[u]).call(s);e.addresses[u]&&c&&(e.addresses[u].fingerprint=p)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){y.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const o=V("GATEWAY_ADDRESS").map(c=>{var u,p;const m=(u=(p=e.addresses.find(_=>_.ip===c.ip&&_.port===c.port))===null||p===void 0?void 0:p.fingerprint)!==null&&u!==void 0?u:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=o}},i7=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=zd(n.buffer.code);throw new z(k.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw y.debug("update ticket request received ap response without response body:",t),new z(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iC=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:QE(QE({6:e.stringUid,11:t,12:V("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};r.request_bodies.forEach(o=>{e.multiIP&&e.multiIP.gateway_ip&&(o.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const s=new FormData;return s.append("request",JSON.stringify(r)),[s,i]},r7=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let mu=0;function _u(e){return ve.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Lp=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=e,o=0;const c=t;let u,p=0;const m=async()=>{const _=(()=>{const g=o*c,v=g+c;return n.slice(g,v).map(i)})();s&&s.push(..._);try{u=await _u(_)}catch(g){if(p+=c,o++,!(p>=n.length))return void await m();r(g)}_.forEach(g=>g.cancel())};return await m(),u},JL=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const r=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(u){if(s++,s>=r||i!=null&&i(u))throw u;return o()}};return o()};async function rC(e,t,n,i){return{gatewayInfo:await async function(s,o,c,u){let p=null;const m=[],_=async()=>{const v=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Pp()})),D=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(w=>w.url)}),C=await Lp({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>(y.debug("[".concat(s.clientId,"] Connect to choose_server:"),w.url),zL(w,s,o,c)),allFailedhandler:w=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},D),w[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),C},g=async()=>{if(await $n(1e3),p!==null)return p;const v=V("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Pp()})),D=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(w=>w.url)}),C=await Lp({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>(y.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),w.url),zL(w,s,o,c)),allFailedhandler:w=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},D),w[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),C};try{return p=await _u([_(),g()]),m.length&&m.forEach(v=>v.cancel&&typeof v.cancel=="function"&&v.cancel()),p}catch(v){throw v[0]}}(e,t,n,i)}}async function XL(e,t,n,i,r){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await rC(e,t,n,r);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:v}=await ek(e,t,n,r);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:g};const D=v.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||si.tcpport,udpport:C.udpport||si.udpport,username:C.username||si.username,password:C.password||si.password,forceturn:!1,security:!0}));if(r.useP2P){var o;const C=(o=e.uid)!==null&&o!==void 0?o:g.uid,w="glb:".concat(C.toString()),P=await FR(w),L=v.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||si.tcpport,udpport:G.udpport||si.udpport,username:w,password:P,forceturn:!1,security:!0}));D.push(...L)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:g}}return await rC(e,t,n,r)}const{proxyInfo:c,gatewayInfo:u}=await ek(e,t,n,r),p={gatewayInfo:u},m=c.map(g=>({turnServerURL:g.address,tcpport:s==="proxy3"?void 0:g.tcpport?g.tcpport:si.tcpport,udpport:s==="proxy4"?void 0:g.udpport?g.udpport:si.udpport,username:g.username||si.username,password:g.password||si.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var _;const g=(_=e.uid)!==null&&_!==void 0?_:u.uid,v="glb:".concat(g.toString()),D=await FR(v),C=c.map(w=>({turnServerURL:w.address,tcpport:s==="proxy3"?void 0:w.tcpport||si.tcpport,udpport:s==="proxy4"?void 0:w.udpport||si.udpport,username:v,password:D,forceturn:s!=="proxy4",security:s==="proxy5"}));m.push(...C)}return e.turnServer={mode:"manual",servers:m},y.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),p}async function QL(e,t,n,i,r){const s=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));const c=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const u=await async function(p,m,_,g,v){const D=Date.now(),C={sid:_.sid,opid:10,appid:_.appId,string_uid:m};let w=p[0];const P=await Ys(()=>Js(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(L,G)=>{if(L.code===0){if(L.uid<=0||L.uid>=Math.pow(2,32))throw y.error("Invalid Uint Uid ".concat(m," => ").concat(L.uid),L),Pe.reqUserAccount(C.sid,{lts:D,success:!1,serverAddr:w,stringUid:C.string_uid,uid:L.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new z(k.INVALID_UINT_UID_FROM_STRING_UID);return Pe.reqUserAccount(C.sid,{lts:D,success:!0,serverAddr:w,stringUid:C.string_uid,uid:L.uid,errorCode:null,extend:C}),!1}const W=zd(L.code);return W.retry&&(w=p[(G+1)%p.length]),Pe.reqUserAccount(C.sid,{lts:D,success:!1,serverAddr:w,stringUid:C.string_uid,uid:L.uid,errorCode:W.desc,extend:C}),W.retry},(L,G)=>L.code!==k.OPERATION_ABORTED&&(Pe.reqUserAccount(C.sid,{lts:D,success:!1,serverAddr:w,stringUid:C.string_uid,uid:null,errorCode:L.code,extend:C}),w=p[(G+1)%p.length],!0),v);if(P.code!==0){const L=zd(P.code);throw new z(k.UNEXPECTED_RESPONSE,L.desc)}return P}(o,e,t,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},c),u.uid}catch(u){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},c),u}}async function s7(e,t,n){const i=V("ACCOUNT_REGISTER");let r=[];r=t.proxyServer?i.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await JL({referenceList:r,asyncMapHandler:o=>async function(c,u,p,m){const _=Date.now(),g={sid:p.sid,opid:10,appid:p.appId,string_uid:u};try{const v=await Js(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:g,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(v.code!==0){const D=zd(v.code);throw new z(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(v.uid<=0||v.uid>=Math.pow(2,32))throw new z(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:c,req:g,uid:v.uid,elapse:Date.now()-_}}catch(v){throw v}}(o,e,t,n),closeFn:o=>o.code===k.OPERATION_ABORTED||o.code===k.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function o7(e,t,n){const i=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),r=i.map(u=>function(p,m,_,g){const v=ut(),D={flag:64,cipher_method:0,features:{device:v.name,system:v.os,system_general:navigator.userAgent,vendor:m.appId,version:Kr,cname:m.cname,sid:m.sid,session_id:m.sid,detail:"",proxyServer:m.proxyServer}};return Ys(()=>Js(p,{data:D,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==k.OPERATION_ABORTED,g)}(u,e,t,n));let s=null,o=null,c={};try{s=await _u(r)}catch(u){if(u.code===k.OPERATION_ABORTED)throw u;o=u}if(r.forEach(u=>u.cancel()),Pe.reportApiInvoke(e.sid,{name:Ln.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=function(u){if(!u.test_tags)return{};const p=u.test_tags,m=Object.keys(p),_={};return m.forEach(g=>{var v;const D=vi(v=g.slice(4)).call(v),C=JSON.parse(p[g])[1];_[D]=C}),_}(s)}catch{}return c}async function ZL(e,t){const n=V("WEBCS_DOMAIN").concat(V("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Pp(),serviceIds:[vn.CHOOSE_SERVER,vn.CLOUD_PROXY_FALLBACK]}));try{return await JL({referenceList:n,asyncMapHandler:r=>async function(s,o,c){let u,{url:p,areaCode:m,serviceIds:_}=s;const g=Date.now(),[v,D]=iC(o,m,_);let C=Tn.networkState;try{C&&Tn.networkState===ur.OFFLINE&&Tn.onlineWaiter&&await ve.race([Tn.onlineWaiter,$n(On.maxRetryTimeout)]),C=Tn.networkState;const{data:w,headers:P}=await Js(p,{data:v,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=P.http3==="1"?1:-1,(K=>{const ee=[];if(K.response_body.forEach(ae=>{const fe=ae.buffer.code;if(ae.uri===23&&fe===0&&!ae.buffer.edges_services)if(ae.buffer.flag===4194310)ae.buffer.edges_services=[];else{const de={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:K.detail[502]}),flag:ae.buffer.flag};ee.push(de)}if(fe!==0){const de=zd(fe),Ne={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,de.desc,{desc:de.desc,retry:de.retry,csIp:K.detail[502]}),flag:ae.buffer.flag};ae.buffer.flag===4194310?y.warning(Ne.error.toString()):ee.push(Ne)}}),ee.length)throw new z(k.CAN_NOT_GET_GATEWAY_SERVER,ee.map(ae=>"flag: ".concat(ae.flag,", message: ").concat(ae.error.message)).join(" | "),{retry:!!ee.find(ae=>ae.error.data.retry),csIp:K.detail[502],desc:[...new Set(ee.map(ae=>{var fe;return ae==null||(fe=ae.error)===null||fe===void 0||(fe=fe.data)===null||fe===void 0?void 0:fe.desc}).filter(ae=>!!ae))]})})(w);const G=yp(w,vn.CHOOSE_SERVER),W=yp(w,vn.CLOUD_PROXY_FALLBACK);return nC(G),{gatewayInfo:cb(G,p),proxyInfo:W,opid:D,requestTime:g,url:p,isHttp3:u,elapse:Date.now()-g}}catch(w){throw w}}(r,e,t),closeFn:r=>r.code===k.OPERATION_ABORTED||r.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function ek(e,t,n,i){const r=V("PROXY_SERVER_TYPE3"),s=(v,D,C)=>{let w=C||r;return Array.isArray(w)&&(w=D%2==0?r[1]:r[0]),"https://".concat(w,"/ap/?url=").concat(v)};let o=null;const c=[],u=async()=>{const v=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((w,P)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),P,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),P),{url:L,areaCode:Pp(),serviceIds:[vn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(w=>w.url)}),C=await Lp({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>(y.debug("[".concat(e.clientId,"] Connect to choose_server:"),w.url),qL(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},D),w[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),C},p=async()=>{if(await $n(1e3),o!==null)return o;const v=V("WEBCS_DOMAIN_BACKUP_LIST").map((w,P)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),P,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),P),{url:L,areaCode:Pp(),serviceIds:[vn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(w=>w.url)}),C=await Lp({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>(y.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),w.url),qL(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},D),w[0]},promisesCollector:c});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),C};let m,_,g;try{({gatewayInfo:m,proxyInfo:_,url:g}=await _u([u(),p()]))}catch(v){throw v[0]}if(c.length&&c.forEach(v=>v.cancel&&typeof v.cancel=="function"&&v.cancel()),!m||!_)throw new z(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=g,e.cloudProxyServer!=="disabled"&&Array.isArray(r)&&g){const v=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];ge(r).call(r,v)&&(e.proxyServer=v,y.setProxyServer(v),Pe.setProxyServer(v))}return o={gatewayInfo:m,proxyInfo:await KD(_,m.uid)},o}async function a7(e,t,n){const i=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(o,c,u,p){const m={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Kr,cname:c.cname,uid:c.uid.toString(),requestId:tC,seq:tC};tC+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(m)};return Ys(async()=>{const g=await Js(o,{data:_,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(g.code!==0){const D=new z(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+g.code,{retry:!0});throw y.error(D.toString()),D}const v=JSON.parse(g.json_body);if(v.code!==200){const D=new z(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(v.code,", reason: ").concat(v.reason));throw y.error(D.toString()),D}if(!v.servers||v.servers.length===0){const D=new z(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw y.error(D.toString()),D}return{vid:v.vid,workerToken:v.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||v.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,g=>!!(g.code!==k.OPERATION_ABORTED&&g.code!==k.UNEXPECTED_RESPONSE||g.data&&g.data.retry),p)}(s,e,t,n));try{const s=await _u(r);return r.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function c7(e,t,n){let i=null;const r=[],s=async o=>{const c=V(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return o&&(await $n(1e3),i!==null)?i:await Lp({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:u=>(y.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),u),function(p,m,_,g){const[v]=r7(m,[vn.CHOOSE_SERVER]);let D=Tn.networkState;return Ys(async()=>{D&&Tn.networkState===ur.OFFLINE&&Tn.onlineWaiter&&await ve.race([Tn.onlineWaiter,$n(g&&g.maxRetryTimeout||On.maxRetryTimeout)]),D=Tn.networkState;const C=await Js(p,{data:v,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return i7(C,p)},()=>!1,C=>C.code!==k.OPERATION_ABORTED&&(C.code===k.UPDATE_TICKET_FAILED?C.data.retry:(y.warning("[".concat(m.clientId,"] update ticket network error, retry"),C),!0)),g)}(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:r})};try{return i=await _u([s(!1),s(!0)]),r.length&&r.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),i}catch(o){throw o[0]}}function tk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function nk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class l7 extends nn{get isSuccess(){return!!this.configs}constructor(t){super(),O(this,"configs",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),this.mutex=new ui("config-distribute",t)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Pe.reportApiInvoke(null,{options:void 0,name:Ln.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:an.TRACER}).onSuccess(JSON.stringify(cc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void y.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await o7(this.joinInfo,this.cancelToken,this.retryConfig),y.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const r=new z(k.NETWORK_RESPONSE_ERROR,i);y.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(sb.UPDATE_BITRATE_LIMIT,t):this.emit(sb.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&nk({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const i=Zh(n=Object.keys(t).filter(s=>/^webrtc_ng_global_parameter/.test(s))).call(n);for(let s=0;s<i.length;s++)for(let o=i.length-1;o>s;o--){const c=i[o];if(typeof t[c].__priority=="number"){const u=t[c].__priority,p=i[o-1];if(typeof t[p].__priority=="number"){if(!(u>t[p].__priority))continue;{const m=c;i[o]=i[o-1],i[o-1]=m}}else{const m=c;i[o]=i[o-1],i[o-1]=m}}}const r={};i.forEach(s=>{const o=t[s],c=o.__expires;Object.keys(o).forEach(u=>{u==="__priority"||u==="__expires"||Object.prototype.hasOwnProperty.call(r,u)||(r[u]=nk({value:o[u]},c&&{expires:c}))})});try{(function(c){try{const u=Date.now();Object.keys(c).forEach(p=>{switch(p){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(mn,p)){const{value:m,expires:_}=c[p];if(_&&_<=u)return;cc[p]=m,mn[p]=m,y.debug("Update global parameters from config distribute",p,m)}}})}catch(u){y.error("Error update config immediately: ".concat(c),u.message)}})(r);const s=JSON.stringify(r),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),y.debug("Caching global parameters ".concat(s))}catch(s){y.error("Error caching global parameters:",s.message)}}}class d7 extends nn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(V("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(t);if(r&&(r.result.push(i),r.result.length>=5)){var s;const o=ge(s=r.result).call(s,!0);r.isPrevNormal&&!o&&this.emit("exception",ik[t],t,n),!r.isPrevNormal&&o&&this.emit("exception",ik[t]+2e3,t+"_RECOVER",n),r.isPrevNormal=o,r.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof xn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=pr(n._encoderConfig.frameRate));const r=t.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof xn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const ik={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},pi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};var rk=T(ir.Object.getOwnPropertySymbols),u7=_t,h7=Ha.indexOf,p7=zl,sC=Ge([].indexOf),sk=!!sC&&1/sC([1],1,-0)<0;u7({target:"Array",proto:!0,forced:sk||!p7("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return sk?sC(this,e,t)||0:h7(this,e,t)}});var f7=qi("Array").indexOf,m7=Z,_7=f7,oC=Array.prototype,E7=function(e){var t=e.indexOf;return e===oC||m7(oC,e)&&t===oC.indexOf?_7:t},ok=T(E7);function g7(e,t){if(e==null)return{};var n,i,r=function(o,c){if(o==null)return{};var u,p,m={},_=AD(o);for(p=0;p<_.length;p++)u=_[p],ok(c).call(c,u)>=0||(m[u]=o[u]);return m}(e,t);if(rk){var s=rk(e);for(i=0;i<s.length;i++)n=s[i],ok(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ys(e){if(Array.isArray(e))return e.map(n=>n);if(!ak(e))return e;const t={};for(const n in e){const i=e[n];ak(i)||Array.isArray(i)?t[n]=ys(i):t[n]=i}return t}function ak(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class aC{constructor(t){O(this,"input",[]),O(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Do={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},kp={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Do,remoteCandidate:Do},updateInterval:0},ck={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},lk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},dk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},uk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function hk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function pk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class cC{constructor(t,n){O(this,"onFirstVideoReceived",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"videoIsReady",!1),O(this,"videoIsReady2",{}),O(this,"pc",void 0),O(this,"options",void 0),O(this,"intervalTimer",void 0),O(this,"stats",ys(kp)),O(this,"isFirstVideoReceived",{}),O(this,"isFirstVideoDecoded",{}),O(this,"isFirstAudioReceived",{}),O(this,"isFirstAudioDecoded",{}),O(this,"isFirstVideoDecodedTimeout",{}),O(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ve(t=>{t({local:pk({},Do),remote:pk({},Do)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,s=0,o=0,c=0;for(const u of i)t[u].forEach((p,m)=>{if(!this.lossRateWindowStats[n-1][u][m]||!this.lossRateWindowStats[0][u][m])return;const _=this.lossRateWindowStats[n-1][u][m].packets-this.lossRateWindowStats[0][u][m].packets,g=this.lossRateWindowStats[n-1][u][m].packetsLost-this.lossRateWindowStats[0][u][m].packetsLost;u==="videoSend"||u==="audioSend"?(r+=_,o+=g):(s+=_,c+=g),Number.isNaN(_)||Number.isNaN(_)?p.packetLostRate=0:p.packetLostRate=_<=0||g<=0?0:g/(_+g)});t.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),t.recvPacketLossRate=s<=0||c<=0?0:c/(s+c)}}function fk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function S7(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class T7 extends cC{constructor(){super(...arguments),O(this,"_stats",kp),O(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=ys(kp);const i=n.filter(s=>s.type==="ssrc");this.processSSRCStats(i);const r=n.find(s=>s.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{var i;const r=ge(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const s=ys(lk);s.codec=n.googCodecName,s.adaptionChangeReason="none",n.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(n.googAvgEncodeMs),s.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.firsCount=Number(n.googFirReceived),s.nacksCount=Number(n.googNacksReceived),s.plisCount=Number(n.googPlisReceived),s.frameCount=Number(n.framesEncoded),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=ys(ck),o=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(s.codec=n.googCodecName,s.targetDelayMs=Number(n.googTargetDelayMs),s.renderDelayMs=Number(n.googRenderDelayMs),s.currentDelayMs=Number(n.googCurrentDelayMs),s.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),s.decodeMs=Number(n.googDecodeMs),s.maxDecodeMs=Number(n.googMaxDecodeMs),s.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},s.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},s.decodeFrameRate=Number(n.googFrameRateDecoded),s.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},s.jitterBufferMs=Number(n.googJitterBufferMs),s.firsCount=Number(n.googFirsSent),s.nacksCount=Number(n.googNacksSent),s.plisCount=Number(n.googPlisSent),s.framesDecodeCount=Number(n.framesDecoded),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const c=o.stats,u=Date.now()-o.lts;s.framesDecodeFreezeTime=c.framesDecodeFreezeTime,s.framesDecodeInterval=c.framesDecodeInterval,s.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=u,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:S7({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=ys(uk);s.codec=n.googCodecName,s.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,s.decodingCNG=Number(n.googDecodingCNG),s.decodingCTN=Number(n.googDecodingCTN),s.decodingCTSG=Number(n.googDecodingCTSG),s.decodingNormal=Number(n.googDecodingNormal),s.decodingPLC=Number(n.googDecodingPLC),s.decodingPLCCNG=Number(n.googDecodingPLCCNG),s.expandRate=Number(n.googExpandRate),s.accelerateRate=Number(n.googAccelerateRate),s.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),s.speechExpandRate=Number(n.googSpeechExpandRate),s.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),s.jitterBufferMs=Number(n.googJitterBufferMs),s.jitterMs=Number(n.googJitterReceived),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),s.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=ys(dk);s.codec=n.googCodecName,s.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,s.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new ve((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(i=>{const r={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(s=>{r[s]=i.stat(s)}),n.push(r)}),n}}var Eu=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Eu||{});function xp(e,t,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Eu.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[i]);if(typeof o!="number")return;if(!e)return o?s/o*r:void 0;const c=Number(e[n]);if(typeof c!="number")return;const u=Number(e[i]);if(typeof u!="number")return;const p=o-u;return p?(s-c)/p*r:void 0}function mk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _c(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class _k extends cC{constructor(){super(...arguments),O(this,"_stats",kp),O(this,"report",void 0),O(this,"lastDecodeVideoReceiverStats",new Map),O(this,"lastVideoFramesRecv",new Map),O(this,"lastVideoFramesSent",new Map),O(this,"lastVideoFramesDecode",new Map),O(this,"lastVideoFramesOutput",new Map),O(this,"lastVideoJBDelay",new Map),O(this,"lastAudioJBDelay",new Map),O(this,"mediaBytesSent",new Map),O(this,"mediaBytesRetransmit",new Map),O(this,"mediaBytesTargetEncode",new Map),O(this,"lastDecodeAudioReceiverStats",new Map),O(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ys(kp),this.report.forEach(t=>{switch(t.type){case Ar.OUTBOUND:case Ar.INBOUND:{const n=t.mediaType||t.kind,i=!n&&"frameWidth"in t,r=!n&&!("frameWidth"in t);t.type===Ar.OUTBOUND?n==="audio"||r?this.processAudioOutboundStats(t):(n==="video"||i)&&this.processVideoOutboundStats(t):t.type===Ar.INBOUND&&(n==="audio"||r?this.processAudioInboundStats(t):(n==="video"||i)&&this.processVideoInboundStats(t));break}case Ar.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Ar.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:_c({},Do),remote:_c({},Do)};return t.forEach(i=>{let r;if(i.type===Ar.TRANSPORT&&(r=t.get(i.selectedCandidatePairId)),i.type===Ar.CANDIDATE_PAIR&&i.selected&&(r=i),r){const s=(o,c)=>{o.type=c.type,o.id=c.id,c.address&&(o.address=c.address),c.candidateType&&(o.candidateType=c.candidateType),c.port&&(o.port=c.port),c.priority&&(o.priority=c.priority),c.protocol&&(o.protocol=c.protocol),c.relayProtocol&&(o.relayProtocol=c.relayProtocol)};if(r.localCandidateId){const o=t.get(r.localCandidateId);o&&s(n.local,o)}if(r.remoteCandidateId){const o=t.get(r.remoteCandidateId);o&&s(n.remote,o)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===Ar.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===Ar.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===Ar.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(_c({},n),_c({},this.stats.selectedCandidatePair.localCandidate)),t.type===Ar.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(_c({},n),_c({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);n||(n=ys(uk),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.packetsDiscarded=t.packetsDiscarded,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,n.retransmittedBytesReceived=t.retransmittedBytesReceived,n.retransmittedPacketsReceived=t.retransmittedPacketsReceived,n.totalProcessingDelay=t.totalProcessingDelay,n.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=xp(i,n,"totalProcessingDelay","jitterBufferEmittedCount",Eu.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,_c({},n))}processVideoInboundStats(t){let n=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);n||(n=ys(ck),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.framesDroppedCount=t.framesDropped,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,n.totalFreezesDuration=t.totalFreezesDuration,n.totalProcessingDelay=t.totalProcessingDelay,n.packetsDiscarded=t.packetsDiscarded,n.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,n.totalAssemblyTime=t.totalAssemblyTime,n.keyFramesDecoded=t.keyFramesDecoded,n.retransmittedBytesReceived=t.retransmittedBytesReceived,n.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),r=this.lastVideoFramesDecode.get(n.ssrc),s=this.lastVideoFramesOutput.get(n.ssrc),o=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const c=n.decodedFrame?n.decodedFrame.width:0,u=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,c,u),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const c=i.stats,u=o-i.lts;n.framesDecodeFreezeTime=c.framesDecodeFreezeTime,n.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=u,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<c.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime,n.avgDecodeMs=xp(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=xp(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",Eu.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=xp(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",Eu.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=xp(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",Eu.kMillisecondsFromSeconds),r&&o-r.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:n.decodeFrameRate})):r?n.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:0}),n.framesDroppedCount&&t.framesReceived&&(s&&o-s.lts>=800?(n.outputFrameRate=Math.round((t.framesReceived-n.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:o,rate:Math.max(n.outputFrameRate,0)})):s?n.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:_c({},n),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(r=>r.ssrc===t.ssrc);n||(n=ys(lk),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const r=new aC(10);r.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,r)}if(t.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(t.ssrc);if(r)r.add(t.retransmittedBytesSent);else{const s=new aC(10);s.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,s)}}if(t.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(t.ssrc);if(r)r.add(t.totalEncodedBytesTarget);else{const s=new aC(10);s.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,s)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,n.retransmittedBytesSent=t.retransmittedBytesSent,n.retransmittedPacketsSent=t.retransmittedPacketsSent,n.hugeFramesSent=t.hugeFramesSent,n.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const r=this.lastEncoderMs.get(t.ssrc);if(!r||r.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const s=t.framesEncoded-r.lastFrameCount,o=t.totalEncodeTime-r.lastEncoderTime;n.avgEncodeMs=1e3*o/s}}if(t.framesEncoded&&t.qpSum){const r=this.lastEncoderMs.get(t.ssrc);!r||r.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-r.lastQpSum)/(t.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,Ar.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(n||(n=ys(dk),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,n.retransmittedBytesSent=t.retransmittedBytesSent,n.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,Ar.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(t,n){var i;const r=Array.from(ma(i=this.report).call(i)).find(s=>s.type===n&&s.ssrc===t);return r?r.id:null}processVideoMediaSource(t,n){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,n){const i=this.report.get(t);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,n,i){var r,s,o,c;const u=n?this.report.get(n):void 0,p=(r=u==null?void 0:u.framesSent)!==null&&r!==void 0?r:t.framesSent;if(typeof p!="number")return;let m=(s=u==null?void 0:u.frameWidth)!==null&&s!==void 0?s:t.frameWidth,_=(o=u==null?void 0:u.frameHeight)!==null&&o!==void 0?o:t.frameHeight,g=(c=u==null?void 0:u.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof m=="number"&&typeof _=="number"||(m=0,_=0),g==null){const v=Date.now(),D=this.lastVideoFramesSent.get(i.ssrc);D&&v-D.lts>=800?(g=Math.round((p-D.count)/((v-D.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:v,rate:g})):D?g=D.rate:this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:v,rate:0})}i.sentFrame={width:m,height:_,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(t,n,i){var r,s,o,c,u;const p=n?this.report.get(n):void 0,m=(r=p==null?void 0:p.framesReceived)!==null&&r!==void 0?r:t.framesReceived,_=(s=p==null?void 0:p.frameWidth)!==null&&s!==void 0?s:t.frameWidth,g=(o=p==null?void 0:p.frameHeight)!==null&&o!==void 0?o:t.frameHeight,v=(c=p==null?void 0:p.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,D=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof m=="number"){const C=this.lastVideoFramesRecv.get(i.ssrc),w=Date.now();i.framesReceivedCount=m;let P=0;C&&w-C.lts>=800?(P=Math.round((m-C.count)/((w-C.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:w,rate:P})):C?P=C.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:m,lts:w,rate:0}),i.receivedFrame={width:_||0,height:g||0,frameRate:P||0},i.decodedFrame={width:_||0,height:g||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:g||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(v&&D){const C=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=C.jitterBufferMs;const P=D-C.jitterBufferEmittedCount;P>0&&(w=1e3*(v-C.jitterBufferDelay)/P),i.jitterBufferMs=w,i.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:D,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,n,i){var r,s,o,c;const u=n?this.report.get(n):void 0,p=(r=(s=u==null?void 0:u.echoReturnLoss)!==null&&s!==void 0?s:t.echoReturnLoss)!==null&&r!==void 0?r:0,m=(o=(c=u==null?void 0:u.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;i.aecReturnLoss=p,i.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(t,n,i){var r,s,o,c,u,p,m;const _=n?this.report.get(n):void 0,g=(r=_==null?void 0:_.removedSamplesForAcceleration)!==null&&r!==void 0?r:t.removedSamplesForAcceleration,v=(s=_==null?void 0:_.totalSamplesReceived)!==null&&s!==void 0?s:t.totalSamplesReceived,D=(o=_==null?void 0:_.jitterBufferDelay)!==null&&o!==void 0?o:t.jitterBufferDelay,C=(c=_==null?void 0:_.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,w=(u=_==null?void 0:_.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,P=(p=_==null?void 0:_.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,L=(m=_==null?void 0:_.concealedSamples)!==null&&m!==void 0?m:t.concealedSamples;if(g&&v&&(i.accelerateRate=g/v),D&&C){const W=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let K=W.jitterBufferMs;const ee=C-W.jitterBufferEmittedCount;ee>0&&(K=1e3*(D-W.jitterBufferDelay)/ee),i.jitterBufferMs=Math.round(K),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:C,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=w;let G=1920;P&&v&&(G=v/P/50,i.receivedFrames=Math.round(v/G)),L&&(i.droppedFrames=Math.round(L/G))}processRemoteInboundStats(t,n){const i=this.report.get(t);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,n=null,i=null;this.mediaBytesSent.forEach(s=>{t+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{i=i===null?s.diffMean():i+s.diffMean()});const r=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class v7 extends cC{updateStats(){return ve.resolve()}}function lC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new T7(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new _k(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof ve||function(u){return!!u&&(typeof u=="object"||typeof u=="function")&&typeof u.then=="function"}(c))}(e)?new _k(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new v7(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}let Ek=class{get localCapabilities(){return fn(this._localCapabilities)}get rtpCapabilities(){return fn(this._rtpCapabilities)}get candidates(){return fn(this._candidates)}get iceParameters(){return fn(this._iceParameters)}get dtlsParameters(){return fn(this._dtlsParameters)}constructor(e){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),e=fn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:o,setup:c,videoCodec:u,audioCodec:p}=e;let m;this.setup=c,m=o===Di.RECEIVE_ONLY?Zn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Zn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const _=o===Di.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,g=o===Di.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,v=o===Di.RECEIVE_ONLY?r.send.videoCodecs:Dp(we.VIDEO,_,g,u),D=o===Di.RECEIVE_ONLY?r.send.audioCodecs:Dp(we.AUDIO,_,g,p);for(const C of m.mediaDescriptions)C.attributes.iceUfrag=t.iceUfrag,C.attributes.icePwd=t.icePwd,C.attributes.fingerprints=n.fingerprints,C.attributes.candidates=i,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=v.map(w=>w.payloadType.toString(10)),C.attributes.payloads=v,C.attributes.extmaps=_.videoExtensions),C.media.mediaType==="audio"&&(C.media.fmts=D.map(w=>w.payloadType.toString(10)),C.attributes.payloads=D,C.attributes.extmaps=_.audioExtensions,fu(C));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Zn.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=El(t,this.cname,V("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(on()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(c,r),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,s,i);let p;return u===-1?(p=this.createOrRecycleSendMedia(e,s,o,"sendonly",i,r),this.updateBundleMids()):(p=fn(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,r)),on()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(r=>{const s=r._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,u=!1;o===-1?(u=!0,c=this.createOrRecycleRecvMedia(r,[],"recvonly",t,n),this.updateBundleMids()):(c=fn(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),i.push({mid:c.attributes.mid,needCreateTransceiver:u})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:r,type:s,relatedAddress:o,relatedPort:c,priority:u}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some(m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,r){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=Dp(s,o,this.localCapabilities.send,s===we.AUDIO?r:i),u=s===we.VIDEO?o.videoExtensions:o.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,e);const _=this.findFirstClosedMedia(s);if(_){const g=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[g]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ge(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>ge(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(on()){if(r){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=fn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,r,s){const o=this.rtpCapabilities.send,c=e===we.VIDEO?o.videoCodecs:o.audioCodecs,u=e===we.VIDEO?o.videoExtensions:o.audioExtensions;on()&&(r="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};p=this.mungSendMediaDesc(p,s);const m=this.findFirstClosedMedia(e);if(m){const _=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[_]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const i=fn(e);return zb(i),pu(i,t),qb(i,t),xL(i),YE(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=fn(e);return YE(n,t,this.localCapabilities.recv),fu(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>on()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const y7=["sdp"];var Wt;function gk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Ec(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Sk=(Wt=class Nu extends kD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Nu.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Di.SEND_ONLY,this.name=this.direction===Di.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=lC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,on()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await UL();if(this.localCapabilities=zE(n),t){const{sdp:i}=t,r=g7(t,y7),s=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=Np(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vs(_,m,"videoExtensions",g,v,D),vs(_,m,"videoCodecs",g,v,D),vs(_,m,"audioExtensions",g,v,D),vs(_,m,"audioCodecs",g,v,D),V("RAISE_H264_BASELINE_PRIORITY")){const C=D.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){const w=D.videoCodecs.findIndex(P=>P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<C){y.debug("raising H264 baseline profile priority");const P=D.videoCodecs[C];D.videoCodecs.splice(C,1),D.videoCodecs.splice(w,0,P)}w!==-1&&V("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(P=>!(P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&P.fmtp&&P.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:g,recv:v,sendrecv:D}}({},{},i);this.remoteSDP=new Ek({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=fc(o.sdp);await this.peerConnection.setLocalDescription(o);const u=await jL({},{},o.sdp);this.localCapabilities=zE(u);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Ec(Ec({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=fc(i.sdp);return this.initialOffer=i,Ec(Ec({},r),{},{sdp:i.sdp})}}catch(n){throw new te(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=t,s=await jL({},{},n);this.remoteSDP=new Ek({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new te(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var r=this;return Hr(function*(){const s=yield ct(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=r.remoteSDP.receive(t,n,i);t.forEach((w,P)=>{if(c[P].needCreateTransceiver){const L=r.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});o.push(L),w._updateRtpTransceiver(L)}else{const L=r.peerConnection.getTransceivers().find(G=>G.mid===c[P].mid);if(!L)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[P].mid));o.push(L),w._updateRtpTransceiver(L)}}),on()&&V("SIMULCAST")===!0&&(yield ct(r.applySimulcastForFirefox(o,t)));const u=c.map(w=>w.mid),p=yield ct(r.peerConnection.createOffer()),m=r.mungSendOfferSDP(p.sdp,t,u),_=Zn.parse(m),g=u.map(w=>{const P=_.mediaDescriptions.find(L=>L.attributes.mid===w);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return PL(P,V("USE_PUB_RTX"))}),v=o.map((w,P)=>{const L=u[P];return{localSSRC:g[P],id:L}});yield ct(r.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield v}catch(w){const P=r.remoteSDP.toString();throw yield ct(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ct(r.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield ct(r.stopSending(u,!0)),w}yield ct(r.applySimulcastEncodings(o,t)),yield ct(r.applySendEncodings(o,t));const D=r.remoteSDP.toString(),C=r.logSDPExchange(m,"offer","local","send");return C==null||C(D),yield ct(r.setRemoteDescription({type:"answer",sdp:D})),o.map((w,P)=>{const L=u[P];return{localSSRC:g[P],id:L}})}catch(o){throw o instanceof te?o:new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));r.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o==null||o(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,i,r);if(o){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const m=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(m.sdp,s,t);p==null||p(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,i,r);if(o){const c=this.remoteSDP.toString(),u=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,t);u==null||u(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===al.Auto&&(this.store.p2pTransport=al.SdRtn,pt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nu.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,pt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nu.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=fc(n.sdp);return this.store.descriptionStart(),this.direction===Di.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Di.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=fc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new te(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===t);i.length===1&&(this.isVP8Simulcast(n)?on()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Ec(Ec({},Do),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Ec(Ec({},Do),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ge(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(hE(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Nu.turnServerConfigToIceServers(t.turnServer.servers,n,i)),V("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Nu.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),ge(s=[al.Relay,al.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),V("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&pt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),y.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=t.filter(c=>c.tcpport);y.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const o=s.length>i?s[i]:s[0];switch(n){case al.SdRtn:const c=t.filter(p=>{var m;return ge(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL}),u=c.length>i?c[i]:c[0];u&&(r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(qd(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(qd(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case al.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(qd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(qd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pt().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:m,frameRate:_,scaleResolutionDownBy:g}=t._encoderConfig;m&&(s.maxBitrate=1e3*m),ge(o=t._hints).call(o,Vt.LOW_STREAM)&&(_&&(s.maxFramerate=pr(_)),g&&g>=1&&(s.scaleResolutionDownBy=g))}if(V("DSCP_TYPE")&&sc()){var c;const m=V("DSCP_TYPE");ge(c=["very-low","low","medium","high"]).call(c,m)&&(s.networkPriority=m)}const u=n.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];on()&&!p&&(r.encodings=[s]),p&&Object.assign(p,s),Object.assign(u,r),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!pt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],s=n[i];s instanceof Yt&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const r=Zn.parse(t);return n.forEach((s,o)=>{const c=i[o],u=r.mediaDescriptions.find(p=>p.attributes.mid===c);u&&(pu(u,s),ML(u,s,this.store.codec))}),Zn.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var i,r,s,o,c;const p=t[u],m=n[u];if(m instanceof Yt&&!ge(i=m._hints).call(i,Vt.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},g={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const v=p.sender.getParameters();await p.sender.setParameters(Object.assign(v,_))}}}async applySimulcastEncodings(t,n){if(!on()&&t.length===n.length)for(let i=0;i<t.length;i++){const r=n[i];if(r instanceof Yt&&this.isVP8Simulcast(r)){const s=t[i],o={},c={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,o))}}}isVP8Simulcast(t){var n,i,r,s,o;return!!(t instanceof Yt&&V("SIMULCAST")&&this.store.codec==="vp8"&&!ge(n=t._hints).call(n,Vt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(V("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var s;const o=(s=Zn.parse(n).mediaDescriptions.find(c=>c.attributes.mid===t))===null||s===void 0?void 0:s.attributes.ssrcs;return o==null?void 0:o[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),ge(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const r=Zn.parse(t),s=r.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&i===we.AUDIO&&s.media.mediaType==="audio"&&fu(s),Zn.print(r)}},Ae(Wt.prototype,"establish",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"establish"),Wt.prototype),Ae(Wt.prototype,"connect",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"connect"),Wt.prototype),Ae(Wt.prototype,"receive",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"receive"),Wt.prototype),Ae(Wt.prototype,"mockReceive",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"mockReceive"),Wt.prototype),Ae(Wt.prototype,"stopReceiving",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"stopReceiving"),Wt.prototype),Ae(Wt.prototype,"restartICE",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"restartICE"),Wt.prototype),Ae(Wt.prototype,"close",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"close"),Wt.prototype),Ae(Wt.prototype,"updateEncoderConfig",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"updateEncoderConfig"),Wt.prototype),Ae(Wt.prototype,"updateSendParameters",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"updateSendParameters"),Wt.prototype),Ae(Wt.prototype,"replaceTrack",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"replaceTrack"),Wt.prototype),Ae(Wt.prototype,"muteLocal",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"muteLocal"),Wt.prototype),Ae(Wt.prototype,"unmuteLocal",[Rs],Object.getOwnPropertyDescriptor(Wt.prototype,"unmuteLocal"),Wt.prototype),Wt);function Rs(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return await i.apply(this,c)}finally{s()}},n}function dC(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=pr(t.width),i.height=pr(t.height);const r=pr(t.framerate||15);document.body.append(n),document.body.append(i);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=i.getContext("2d");if(!o)throw new z(k.UNEXPECTED_ERROR,"can not get canvas context");const c=pt(),u=i.captureStream(c.supportRequestFrame?0:r).getVideoTracks()[0];u.canvas||(u.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,_=n.videoHeight/m,g=i.width*_;Math.abs(g-i.height)>=2&&(y.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(g)),i.height=g)}o.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=jb(()=>i.startCapture&&i.startCapture(),r);const p=u.stop;return u.stop=()=>{p.call(u),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),y.debug("clean low stream renderer")},u}var ZE=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(ZE||{}),yn=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(yn||{}),gl=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(gl||{}),Rn=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Rn||{}),Sl=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Sl||{}),Tk=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(Tk||{}),Xs=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Xs||{}),Qi=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e}(Qi||{}),vk=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(vk||{}),mr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(mr||{});const Sa=1e3,Tl=3;function He(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function yk(e){const t={[mr.CONN_TYPE]:0,[mr.RTT]:e.rtt,[mr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[mr.CONN_TYPE]=1),n==="tcp"&&(t[mr.CONN_TYPE]=3),n==="tls"&&(t[mr.CONN_TYPE]=4);break}case"srflx":t[mr.CONN_TYPE]=2}return t}function Rk(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class bk extends nn{constructor(t){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastFullRecvStats",void 0),O(this,"lastFullSendStats",void 0),O(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n,i;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),n||i){const r={};if(this.uploadTransportStarted&&n){const s=this.getTransportStats(n,i,t);s&&(r.misc=[s])}if(this.uploadOutboundStarted&&n){const s=this.getOutboundStats(n,t?this.lastSendStats:this.lastFullSendStats,t);s&&(r.outbound=[s])}if(this.uploadInboundStarted&&i){const s=this.getInboundStats(i,t?this.lastRecvStats:this.lastFullRecvStats,t);s&&(r.inbound=s)}this.requestUploadStats(r)}this.lastRecvStats=i,this.lastSendStats=n,t||(this.lastFullRecvStats=i,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Tl),++t===Tl+1&&(t=1)},Sa)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,i){if(!this.requestStats)return;if(i)return t.rtt==null?void 0:{addition:{[mr.RTT]:t.rtt,[mr.CONN_TYPE]:void 0,[mr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const r=yk(t);if(this.store.useP2P){if(n){const s=yk(n);r[mr.CONN_TYPE]+=s[mr.CONN_TYPE]<<3}r[mr.CONN_TYPE]+=110}else r[mr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(t,n,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||r.length===0)return;let s,o,c;return r.forEach(u=>{let[p,{track:m,ssrcs:_}]=u;switch(p){case ce.LocalVideoLowTrack:case ce.LocalVideoTrack:if(p===ce.LocalVideoTrack){const g=function(C,w,P,L,G){const W=w.videoSend.find(Ne=>Ne.ssrc===C);if(!W)return;const K={},{sentFrame:ee,inputFrame:ae}=W;if(ae&&ee){const Ne=ae.frameRate,tt=ee.frameRate;K[yn.FREEZE]=function(Tt,Gt){let Cn=!0;return Cn=!(Tt<=5)&&(Tt<=10?Gt<3:Tt<=20?Gt<4:Gt<5),Cn}(Ne,tt)?1:0}if(He(K,yn.QP_SUM,W.qpSumPerFrame),G)return K;switch(ee&&(He(K,yn.HEIGHT,ee.height),He(K,yn.WIDTH,ee.width),He(K,yn.FRAME_RATE,ee.frameRate)),K[yn.DISABLED]=L._originMediaStreamTrack&&!L._originMediaStreamTrack.enabled||L._mediaStreamTrack&&!L._mediaStreamTrack.enabled?1:0,W.adaptionChangeReason){case"none":K[yn.ADAPTATION]=0;break;case"cpu":K[yn.ADAPTATION]=1;break;case"bandwidth":K[yn.ADAPTATION]=2;break;case"other":K[yn.ADAPTATION]=3}let fe=0;W.adaptionChangeReason&&(fe+=Rk(W.adaptionChangeReason)),w.qualityLimitationReason&&(fe+=Rk(w.qualityLimitationReason)<<3),K[yn.ADAPTATION]=fe,K[yn.PLAYER_STATUS]=Mb[L._player?L._player.videoElementStatus:"uninit"],He(K,yn.NACKS,W.nacksCount),He(K,yn.PLIS,W.plisCount),He(K,yn.FIRS,W.firsCount),He(K,yn.AVG_ENCODE,W.avgEncodeMs),He(K,yn.HUGE_FRAME_SENT,W.hugeFramesSent),He(K,yn.BYTES_RETRANSMIT,W.retransmittedBytesSent),He(K,yn.PACKAGES_RETRANSMIT,W.retransmittedPacketsSent),He(K,yn.KEY_FRAMES_ENCODED,W.keyFramesEncoded);const de=P&&P.videoSend.find(Ne=>Ne.ssrc===C);if(de){let Ne=G?Sa:Sa*Tl;de.timestamp&&W.timestamp&&(Ne=W.timestamp-de.timestamp),de.packets!=null&&W.packets!=null&&He(K,yn.PACKAGE_RATE,1e3*(W.packets-de.packets)/Ne),W.packetsLost!=null&&de.packetsLost!=null&&He(K,yn.PACKAGE_LOST,W.packetsLost-de.packetsLost),de.bytes!=null&&W.bytes!=null&&He(K,yn.BITRATE,8*(W.bytes-de.bytes)/Ne)}return K}(_[0].ssrcId,t,n,m,i),v=i?null:function(C,w,P){const L=w.videoSend.find(fe=>fe.ssrc===C);if(!L)return null;const G={},W=L.inputFrame,K=W&&W.height||P&&P.videoHeight||0,ee=W&&W.width||P&&P.videoWidth||0,ae=W&&W.frameRate||0;return He(G,ZE.HEIGHT,K),He(G,ZE.WIDTH,ee),He(G,ZE.FRAME_RATE,ae),G}(_[0].ssrcId,t,m),D=i?null:function(C){const w={};return He(w,yn.RETRANSMIT,C.bitrate.retransmit),He(w,yn.TARGET_ENCODED,C.bitrate.targetEncoded),He(w,yn.ACTUAL_ENCODED,C.bitrate.actualEncoded),He(w,yn.TRANSMIT,C.bitrate.transmit),He(w,yn.BANDWIDTH,C.sendBandwidth),w}(t);o=Object.assign({},g,v,D)}else c=i?void 0:function(g,v,D){const C=v.videoSend.find(L=>L.ssrc===g);if(!C)return;const w={},P=C.sentFrame;if(P&&(He(w,gl.HEIGHT,P.height),He(w,gl.WIDTH,P.width),He(w,gl.FRAME_RATE,P.frameRate)),D){const L=D.videoSend.find(G=>G.ssrc===g);if(L){let G=Sa*Tl;L.timestamp&&C.timestamp&&(G=C.timestamp-L.timestamp),L.packets!=null&&C.packets!=null&&He(w,gl.PACKAGE_RATE,1e3*(C.packets-L.packets)/G),C.packetsLost!=null&&L.packetsLost!=null&&He(w,gl.PACKAGE_LOST,C.packetsLost-L.packetsLost),L.bytes!=null&&C.bytes!=null&&He(w,gl.BITRATE,8*(C.bytes-L.bytes)/G)}}return w}(_[0].ssrcId,t,n);break;case ce.LocalAudioTrack:s=i?void 0:function(g,v,D,C){const w=v.audioSend.find(K=>K.ssrc===g);if(!w)return;const P={};P[Xs.DISABLED]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;const L=100*C._source.getAccurateVolumeLevel(),G=w.inputLevel;if(G!=null){const K=Math.ceil(50*Math.log10(100*G+1));He(P,Xs.LEVEL,K)}else He(P,Xs.LEVEL,L);He(P,Tk.PCM_LEVEL,L),He(P,Xs.AEC_RETURN_LOSS,w.aecReturnLoss),He(P,Xs.AEC_RETURN_LOSS_ENH,w.aecReturnLossEnhancement),He(P,Xs.BYTES_RETRANSMIT,w.retransmittedBytesSent),He(P,Xs.PACKAGES_RETRANSMIT,w.retransmittedPacketsSent),P[Xs.FREEZE]=0;const W=D&&D.audioSend.find(K=>K.ssrc===g);if(W){let K=Sa*Tl;W.timestamp&&w.timestamp&&(K=w.timestamp-W.timestamp),W.bytes!=null&&w.bytes!=null&&He(P,Xs.BITRATE,8*(w.bytes-W.bytes)/K),W.packets!=null&&w.packets!=null&&He(P,Xs.PACKAGE_RATE,1e3*(w.packets-W.packets)/K)}return P}(_[0].ssrcId,t,n,m)}}),{high:o,low:c,audio:s}}getInboundStats(t,n,i){if(!this.requestRemoteMedia)return;const r=this.requestRemoteMedia()||[],s=[];return r.forEach(o=>{let[c,u]=o;const p={peer:c.uid};if(u.has(we.VIDEO)&&c.videoTrack){const m=c._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(c._videoSSRC)||!1,_=c.videoTrack?function(g,v,D,C,w,P,L){var G;const W=v.videoRecv.find(tt=>tt.ssrc===g);if(!W)return;const K={},{receivedFrame:ee,outputFrame:ae,decodeFrameRate:fe}=W,de=D&&D.videoRecv.find(tt=>tt.ssrc===g);if(K[Rn.FREEZE]=w&&Mp.isRemoteVideoFreeze(C,W,de)?1:0,He(K,Sl.FRAME_RATE_DECODE,fe),He(K,Rn.QP_SUM,W.qpSumPerFrame),W.framesRateFirefox&&He(K,Rn.FRAME_RATE,W.framesRateFirefox),ee&&He(K,Rn.FRAME_RATE,ee.frameRate),He(K,Rn.FRAMES_DROPPED,W.framesDroppedCount),He(K,Rn.BYTES_RETRANSMIT,W.retransmittedBytesReceived),He(K,Rn.PACKAGES_RETRANSMIT,W.retransmittedPacketsReceived),He(K,Rn.PACKAGES_DISCARDED,W.packetsDiscarded),He(K,Rn.AVG_DECODE,W.avgDecodeMs),He(K,Rn.AVG_PROCESSING_DELAY,W.avgProcessingDelayMs),He(K,Rn.AVG_ASSEMBLY_TIME,W.avgFramesAssembledFromMultiplePacketsMs),He(K,Rn.AVG_INTER_FRAME_DELAY,W.avgInterFrameDelayMs),He(K,Rn.KEY_FRAMES_DECODED,W.keyFramesDecoded),de){const tt=v.timestamp-D.timestamp||(L?Sa:Tl*Sa);W.packetsLost!=null&&de.packetsLost!=null&&He(K,Rn.PACKAGE_LOST,W.packetsLost-de.packetsLost),de.bytes!=null&&W.bytes!=null&&He(K,Rn.BITRATE,8*(W.bytes-de.bytes)/tt),de.packets!=null&&W.packets!=null&&He(K,Rn.PACKAGE_RATE,1e3*(W.packets-de.packets)/tt)}if(L)return K;ee?(He(K,Rn.HEIGHT,ee.height),He(K,Rn.WIDTH,ee.width)):C&&(He(K,Rn.HEIGHT,C._videoHeight||0),He(K,Rn.WIDTH,C._videoWidth||0)),ae&&He(K,Sl.FRAME_RATE_OUTPUT,ae.frameRate);const Ne=(G=C._player)===null||G===void 0?void 0:G.rendFrameRate.toFixed(0);if(Ne&&He(K,Sl.FRAME_RATE_RENDER,+Ne),He(K,Rn.JITTER_BUFFER,W.jitterBufferMs),He(K,Rn.CURRENT_DELAY,W.currentDelayMs),He(K,Rn.FIRS,W.firsCount),He(K,Rn.NACKS,W.nacksCount),He(K,Rn.PLIS,W.plisCount),C){K[Rn.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const tt=C._player;if(tt){const{freezeTimeCounterList:Tt,renderFreezeAccTime:Gt,videoElementStatus:Cn}=tt;if(Tt&&Tt.length>0&&He(K,Sl.FREEZE_TIME,Tt.splice(0,1)[0]),P&&ga.visibility==="visible"&&Cn===yi.PLAYING&&pt().supportRequestVideoFrameCallback){const en=Math.min(6e3,Gt);tt.renderFreezeAccTime=Math.max(0,Gt-en),He(K,Sl.FREEZE_TIME_RENDER,en)}if(typeof W.totalFreezesDuration=="number"){const en=de&&de.totalFreezesDuration?W.totalFreezesDuration-de.totalFreezesDuration:W.totalFreezesDuration;He(K,Sl.FREEZE_DURATION,1e3*en)}}}if(K[Rn.PLAYER_STATUS]=Mb[C._player?C._player.videoElementStatus:"uninit"],de&&W.totalInterFrameDelay!==void 0&&W.totalSquaredInterFrameDelay!==void 0&&de.totalInterFrameDelay!==void 0&&de.totalSquaredInterFrameDelay!==void 0){const tt=W.totalInterFrameDelay-de.totalInterFrameDelay,Tt=W.totalSquaredInterFrameDelay-de.totalSquaredInterFrameDelay,Gt=W.framesDecodeCount-de.framesDecodeCount,Cn=tt/Gt*1e3,en=Math.round(1e3*Math.sqrt((Tt-Math.pow(tt,2)/Gt)/Gt));!isNaN(en)&&Cn+en>Math.max(3*Cn,Cn+150)&&(K[Rn.I_FRAME_DELAY]=en)}return K}(c._videoSSRC,t,n,c.videoTrack,m===!0,this.needUploadRenderFreezeTime,i):void 0;_&&(p.video=_)}if(u.has(we.AUDIO)&&c.audioTrack){const m=c.audioTrack?function(_,g,v,D,C){const w=g.audioRecv.find(de=>de.ssrc===_);if(!w)return;const P={},L=v&&v.audioRecv.find(de=>de.ssrc===_),{receivedFrames:G,droppedFrames:W}=w;var K,ee;if(He(P,Qi.JITTER,w.jitterMs),He(P,Qi.BYTES_RETRANSMIT,w.retransmittedBytesReceived),He(P,Qi.PACKAGES_RETRANSMIT,w.retransmittedPacketsReceived),He(P,Qi.PACKAGES_DISCARDED,w.packetsDiscarded),He(P,Qi.AVG_PROCESSING_DELAY,w.avgProcessingDelayMs),G!=null&&W!=null&&(P[Qi.FREEZE]=(ee=W,(K=G)===0||100*ee/K>20?1:0)),L){const de=g.timestamp-v.timestamp||(C?Sa:Sa*Tl);w.packets!=null&&L.packets!=null&&He(P,Qi.PACKAGE_RATE,1e3*(w.packets-L.packets)/de),L.bytes!=null&&w.bytes!=null&&He(P,Qi.BITRATE,8*(w.bytes-L.bytes)/de),w.packetsLost!=null&&L.packetsLost!=null&&He(P,Qi.PACKAGE_LOST,w.packetsLost-L.packetsLost)}if(C)return P;const ae=100*D._source.getAccurateVolumeLevel(),fe=w.outputLevel;if(fe!=null){const de=Math.ceil(50*Math.log10(100*fe+1));He(P,vk.LEVEL,de)}if(He(P,Qi.PCM_LEVEL,ae),D&&(P[Qi.DISABLED]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),He(P,Qi.JITTER_BUFFER,w.jitterBufferMs),He(P,Qi.CURRENT_DELAY,w.jitterBufferMs),P[Qi.PLAYER_STATUS]=Mb[Gi.getPlayerState(D.getTrackId())],L){const de=w.concealedSamples-L.concealedSamples;de>0&&He(P,Qi.CONCEALED_SAMPLES,de)}return P}(c._audioSSRC,t,n,c.audioTrack,i):void 0;m&&(p.audio=m)}(p.video||p.audio)&&s.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof VE);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Sp.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(we.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(we.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of s)!p.muted&&p.enabled&&(r=r.concat(await p.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of o)m.has(we.VIDEO)&&p.videoTrack&&(r=r.concat(await p.videoTrack.getProcessorUsage())),m.has(we.AUDIO)&&p.audioTrack&&(r=r.concat(await p.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(p,m){const _={};for(const{id:C,value:w,level:P,direction:L}of p){var g;const G=(g=m.get(C))!==null&&g!==void 0?g:0,W=w===2?G+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var v,D;m.set(C,W),_[C]?(w===2&&(_[C].value=w),P>_[C].level&&(_[C].level=P),L==="remote"&&(_[C].remoteUidCount+=1),_[C].totalTs=(v=m.get(C))!==null&&v!==void 0?v:0):_[C]={value:w,level:P,remoteUidCount:L==="local"?0:1,totalTs:(D=m.get(C))!==null&&D!==void 0?D:0}}return Object.keys(_).map(C=>{const{level:w,value:P,totalTs:L}=_[C];return{id:C,level:w,value:P,totalTs:L}})}(r,t);const c=Date.now(),u=c>n?c:n+1;this.requestUpload&&this.requestUpload(Sp.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:u})},V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class gc{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}let Qs=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function R7(e,t){var n;let i;switch(t){case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoTrack:i=ge(n=e._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:i=yt.Low}return i}function uC(e){const t=pt();if(e.some(n=>n._bypassWebAudio))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hC(e,t){uC(e);const n=new xn;return e.forEach(i=>n.addAudioTrack(i)),n}var Ck,wk,Ak,Ik,Ok,Nk,Dk,Pk,Lk,kk,xk,Jt;function Mk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function eg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let _r=(Ck=Zs(Qs.SEND_ONLY),wk=Zs(Qs.SEND_ONLY),Ak=Zs(),Ik=Zs(Qs.RECEIVE_ONLY),Ok=Zs(Qs.RECEIVE_ONLY),Nk=Zs(Qs.RECEIVE_ONLY),Dk=Zs(Qs.RECEIVE_ONLY),Pk=Zs(Qs.RECEIVE_ONLY),Lk=Zs(Qs.RECEIVE_ONLY),kk=Zs(),xk=Zs(Qs.RECEIVE_ONLY),Jt=class extends nn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Be.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",Rt.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void r(new te(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const p=u.find(v=>v[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(v=>{let[,{id:D}]=v;return D}));let m=!1;var o,c;n.trackMediaType==="video"?m=!((o=this.localTrackMap.get(ce.LocalAudioTrack))===null||o===void 0||!o.track._muted):m=((c=this.localTrackMap.get(ce.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const _=this.createMuteMessage(u);await Lt(this,Be.RequestMuteLocal,_);const g=n.trackMediaType==="video"?dc.MUTE_LOCAL_VIDEO:dc.MUTE_LOCAL_AUDIO;await Lt(this,Be.RequestP2PMuteLocal,{action:g,message:_,isMuteAll:m}),i()}catch(u){r(u)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void r(new te(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void i();await this.sendConnection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const c=this.createUnmuteMessage(o),u=n.trackMediaType==="video"?dc.UNMUTE_LOCAL_VIDEO:dc.UNMUTE_LOCAL_AUDIO;await Lt(this,Be.RequestP2PMuteLocal,{action:u,message:c}),i()}catch(o){r(o)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const o=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Rt.Connected)return void i();const{id:c,track:u}=o;c&&(await this.sendConnection.updateSendParameters(c,u),await this.sendConnection.updateEncoderConfig(c,u),this.emit(Be.UpdateVideoEncoder,u)),i()}catch(o){r(o)}finally{s()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Rt.Connected)return void i();const{id:c,track:u}=o;c&&await this.sendConnection.updateSendParameters(c,u),i()}catch(o){r(o)}finally{s()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let o;y.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:_}]=m;return n===_});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Rt.Connected)return void i();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),p[0]===ce.LocalVideoTrack&&pt().supportDualStreamEncoding){const m=this.localTrackMap.get(ce.LocalVideoLowTrack);if(m){const _=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_,await new ve((g,v)=>{this.handleReplaceTrack(m.track,g,v,!0)})}}i()}catch(p){r(p)}finally{var u;(u=o)===null||u===void 0||u()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new bk(e),this.bindStatsUploaderEvents(),this.sendMutex=new ui("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ui("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},V("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new te(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new te(k.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Sk(e,this.store,Di.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Rt.New,this.sendConnection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Sk(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new te(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected}async addRemoteCandidate(e,t){if(t===Di.RECEIVE_ONLY){if(!this.sendConnection)throw new te(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new te(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return Hr(function*(){const r=yield ct(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Rt.Connected){i.throwIfTrackTypeNotMatch(e);const p=e.filter(m=>i.pendingLocalTracks.indexOf(m)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(p))}i.store.pubId=i.store.pubId+1,pi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield ct(i.tryToUnmuteAudio(e)));s.forEach(p=>{let{track:m,type:_}=p;const g=Date.now();i.store.publish(m.getTrackId(),_===ce.LocalAudioTrack?"audio":"video",g)}),i.bindLocalTrackEvents(s);const o=yield ct(i.sendConnection.send(s.map(p=>{let{track:m}=p;return m}),i.store.codec,i.store.audioCodec)),c=(yield ct(o.next())).value,u=i.createGatewayPublishMessage(s,c);try{yield u}catch(p){throw o.throw(p),(p==null?void 0:p.code)===k.WS_ABORT&&s.forEach(m=>{let{track:_}=m;i.pendingLocalTracks.indexOf(_)===-1&&i.pendingLocalTracks.push(_)}),i.unbindLocalTrackEvents(s),p}yield ct(o.next()),s.forEach(p=>{let{type:m}=p;i.statsCollector.addLocalStats(m)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,c),s.forEach(p=>{let{track:m,type:_}=p;const g=Date.now();i.store.publish(m.getTrackId(),_===ce.LocalAudioTrack?"audio":"video",void 0,g)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Rt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!ge(e).call(e,r)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[s,{track:o}]=r;return{type:s,track:o}})),t.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Rt.Connected)return n&&n[1].track.close(),i;e.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:o}]=i;const c={stream_type:R7(s,r),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)}),t.length>0&&t.forEach(i=>{Lt(this,Be.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Lt(this,Be.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Hr(function*(){throw new te(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ri(this,Be.RequestRePublish,this.pendingLocalTracks),this.emit(Be.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new te(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var r;if(!this.recvConnection)throw new te(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(e))!==null&&r!==void 0&&r.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===we.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new uu(s,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new du(s,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(m=>{let{user:_,kind:g}=m;return _.uid===e.uid&&t===g});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Be.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new te(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid});if(i.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:o}=s;var c;if(o===we.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===we.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(e,t);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[o,{kind:c}]=s;var u,p;if(c===we.VIDEO&&o._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===we.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0);else if(c===we.AUDIO){var m;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((m=o._audioTrack)===null||m===void 0||m._destroy(),o._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:o}]=s;Lt(this,Be.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[we.VIDEO,we.AUDIO].forEach(i=>{n.has(i)?Lt(this,Be.RequestP2PUnmuteRemote,i):Lt(this,Be.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new te(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new te(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new te(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new te(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===we.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof xn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ce.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ce.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,r){if(e){const o=this.localTrackMap.get(ce.LocalAudioTrack),c=i?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);Pe.publish(this.store.sessionId,{eventElapse:pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:c==null?void 0:c.track.getTrackLabel(),screenshare:(c==null?void 0:c.track._hints.indexOf(Vt.SCREEN_TRACK))!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const o=n.find(u=>u instanceof ln),c=i?(s=this.localTrackMap.get(ce.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(u=>u instanceof Yt);Pe.publish(this.store.sessionId,{eventElapse:pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.getTrackLabel(),videoName:c==null?void 0:c.getTrackLabel(),screenshare:(c==null?void 0:c._hints.indexOf(Vt.SCREEN_TRACK))!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===we.VIDEO?n._videoSSRC:n._audioSSRC;r&&Pe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===we.VIDEO,audio:i===we.AUDIO,peerid:n.uid,subscribeRequestid:i===we.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:pi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ui("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ui("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Rt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Yt||t&&t.track instanceof ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(br(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Zh(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ce.LocalVideoTrack:ge(t=i._hints).call(t,Vt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ce.LocalAudioTrack:i instanceof xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ce.LocalVideoLowTrack:}}),this.emit(Be.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(br(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Be.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof gc?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Di.SEND_ONLY){if(!this.sendConnection)throw new te(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new te(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const r=await i.restartICE(t);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await ri(this,Be.RequestP2PRestartICE,{direction:Di.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalAudioTrack),i=e.videoSend.find(v=>{var D;return v.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),r=e.audioSend.find(v=>{var D;return v.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!i||!r)return 1;const s=Wr(this,Be.NeedSignalRTT),o=i?i.rttMs:void 0,c=r?r.rttMs:void 0,u=o&&c?(o+c)/2:o||c,p=(u&&s?(u+s)/2:u||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,_=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,g=t==null?void 0:t.track;if(g&&g._encoderConfig&&g._hints.indexOf(Vt.SCREEN_TRACK)===-1){const v=g._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(v&&D){const C=(1e3*v-D)/(1e3*v);return bD[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===r),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const u=Wr(this,Be.NeedSignalRTT),p=e.rtt,m=(p&&u?(p+u)/2:p||u)||0,_=o?o.jitterMs:void 0,g=e.recvPacketLossRate;let v=.7*g*100/50+.3*m/1500;_&&(v=.6*g*100/50+.2*m/1500+.2*_/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],r=pt(),s=this.getAllTracks();e=Fd(e=e.filter(u=>s.indexOf(u)===-1));let o=!1,c=!1;for(const u of e){if(u instanceof Yt&&(this.localTrackMap.has(ce.LocalVideoTrack)||o?new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:ce.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(u,n);i.push({track:p,type:ce.LocalVideoLowTrack})}if(u instanceof ln){const p=this.localTrackMap.get(ce.LocalAudioTrack);if(p){if(!(p.track instanceof xn))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(c){const m=i.find(_=>{let{type:g}=_;return g===ce.LocalAudioTrack});if(!(m.track instanceof xn))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof xn||u._bypassWebAudio)i.push({track:u,type:ce.LocalAudioTrack});else{const m=new xn;m.addAudioTrack(u),i.push({track:m,type:ce.LocalAudioTrack})}c=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Fd(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof ln){const r=this.localTrackMap.get(ce.LocalAudioTrack);if(!r)continue;r.track instanceof xn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,r]),r.track.close())):t.push([ce.LocalAudioTrack,r])}if(i instanceof Yt){const r=this.localTrackMap.get(ce.LocalVideoTrack);if(!r)continue;t.push([ce.LocalVideoTrack,r]);const s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ce.LocalVideoTrack:n.addListener(Ce.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof xn?e.trackList.forEach(n=>{n.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ce.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ce.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ce.LocalVideoTrack:n.off(Ce.GET_STATS,this.handleGetLocalVideoStats),n.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof xn?e.trackList.forEach(t=>{t.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ce.GET_STATS,this.handleGetLocalAudioStats),t.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ce.GET_STATS,this.handleGetLocalAudioStats),e.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof du&&t.addListener(Ce.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof uu&&t.addListener(Ce.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ce.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(we.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(we.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let s,{track:o,type:c}=n;switch(c){case ce.LocalAudioTrack:s=yt.Audio;break;case ce.LocalVideoTrack:s=ge(r=o._hints).call(r,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:s=yt.Low}return{kind:c===ce.LocalAudioTrack?we.AUDIO:we.VIDEO,stream_type:s,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Be.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ge(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await $n(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Pe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:an.TRACER}).onSuccess(),this.emit(Be.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(su.FIRST_FRAME_DECODED),Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_AUDIO_DECODE,rn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===t);i&&Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_AUDIO_RECEIVED,rn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===t);i&&Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_VIDEO_RECEIVED,rn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Be.ConnectionTypeChange,i),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uc(n))," -> ").concat(JSON.stringify(uc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uc(n))," -> ").concat(JSON.stringify(uc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Be.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Di.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,y.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Di.SEND_ONLY?this.restartICE(e):ri(this,Be.RequestP2PRestartICE,{direction:Di.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof ln&&(n==null?void 0:n.track)instanceof xn)return n.track.isActive||t.push([ce.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(i&&(t.push(i),i[0]===ce.LocalVideoTrack)){const r=this.localTrackMap.get(ce.LocalVideoLowTrack);r&&t.push([ce.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof ln&&(n==null?void 0:n.track)instanceof xn)return n.track.isActive&&t.push([ce.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(i)if(i[0]===ce.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(ce.LocalVideoLowTrack);r&&t.push([ce.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,o]=r;n.push([e,{kind:s,id:o}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case we.VIDEO:return void(i._videoSSRC&&t.push({stream_type:we.VIDEO,ssrcId:i._videoSSRC}));case we.AUDIO:return void(i._audioSSRC&&t.push({stream_type:we.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof ln){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Lt(this,Be.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Be.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Be.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $n(HR(this.dtlsFailedCount,On)),this.emit(Be.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Yt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Yt).length>1)throw new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ln).length>1&&(e.some(t=>t instanceof ln&&t._bypassWebAudio)||!pt().webAudioMediaStreamDest))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Yt&&this.pendingLocalTracks.some(n=>n instanceof Yt))throw new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ln&&this.pendingLocalTracks.some(n=>n instanceof ln)&&(!pt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof ln&&n._bypassWebAudio)))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding,i=eg(eg({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=n?e._mediaStreamTrack.clone():dC(e,i);const s=jt(8,"track-low-"),o=new Yt(r,eg(eg({},n&&{scaleResolutionDownBy:lb(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return o.on(pl.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,iu.LOW_STREAM)}),o._hints.push(Vt.LOW_STREAM),e.addListener(Ce.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var r;const s=Array.from(br(r=this.remoteUserMap).call(r)).find(o=>o._videoSSRC===e);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(u=>u.userId===s.uid&&u.type==="video");Pe.firstRemoteVideoDecode(this.store.sessionId,Jn.FIRST_VIDEO_DECODE,rn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(c==null?void 0:c.subscribeEnd)||0,subscriberStart:(c==null?void 0:c.subscribeStart)||0,videoAddNotify:(c==null?void 0:c.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const r=i.get(t);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new te(k.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new te(k.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new te(k.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new te(k.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new te(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new te(k.NOT_SUPPORTED)}async preConnect(e){throw new te(k.NOT_SUPPORTED)}getEstablishParams(){throw new te(k.NOT_SUPPORTED)}async reSubscribe(e){throw new te(k.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new te(k.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ce.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,iu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ae(Jt.prototype,"p2pConnect",[Ck],Object.getOwnPropertyDescriptor(Jt.prototype,"p2pConnect"),Jt.prototype),Ae(Jt.prototype,"unpublish",[wk],Object.getOwnPropertyDescriptor(Jt.prototype,"unpublish"),Jt.prototype),Ae(Jt.prototype,"unpublishLowStream",[Ak],Object.getOwnPropertyDescriptor(Jt.prototype,"unpublishLowStream"),Jt.prototype),Ae(Jt.prototype,"subscribe",[Ik],Object.getOwnPropertyDescriptor(Jt.prototype,"subscribe"),Jt.prototype),Ae(Jt.prototype,"mockSubscribe",[Ok],Object.getOwnPropertyDescriptor(Jt.prototype,"mockSubscribe"),Jt.prototype),Ae(Jt.prototype,"unsubscribe",[Nk],Object.getOwnPropertyDescriptor(Jt.prototype,"unsubscribe"),Jt.prototype),Ae(Jt.prototype,"muteRemote",[Dk],Object.getOwnPropertyDescriptor(Jt.prototype,"muteRemote"),Jt.prototype),Ae(Jt.prototype,"unmuteRemote",[Pk],Object.getOwnPropertyDescriptor(Jt.prototype,"unmuteRemote"),Jt.prototype),Ae(Jt.prototype,"hasRemoteMediaWithLock",[Lk],Object.getOwnPropertyDescriptor(Jt.prototype,"hasRemoteMediaWithLock"),Jt.prototype),Ae(Jt.prototype,"disconnectForReconnect",[kk],Object.getOwnPropertyDescriptor(Jt.prototype,"disconnectForReconnect"),Jt.prototype),Ae(Jt.prototype,"remoteMediaSsrcChanged",[xk],Object.getOwnPropertyDescriptor(Jt.prototype,"remoteMediaSsrcChanged"),Jt.prototype),Jt);function Zs(e){return function(t,n,i){const r=t[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case Qs.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,o)}finally{u()}}case Qs.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,o)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,o)}finally{u(),p()}}}},i}}function Uk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function vl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Uk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Mp{constructor(t){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",eb.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new d7,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ce.LocalAudioTrack)||vl({},kb)}getLocalVideoTrackStats(){return this.localStats.get(ce.LocalVideoTrack)||vl({},xb)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},i={};if(t){var r;const s=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.audioStats;s&&(i[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:c}]=s;c&&(i[o]=n(o,c))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const r=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;r&&(n[t]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:o}]=r;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},i={};if(t){var r;const s=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.videoStats;s&&(i[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:c}]=s;c&&(i[o]=n(o,c))});return i}getRTCStats(){let t=0,n=0,i=0,r=0;const s=this.localStats.get(ce.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(ce.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(ce.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:m,videoStats:_}=p;m&&(i+=m.receiveBytes,r+=m.receiveBitrate),_&&(i+=_.receiveBytes,r+=_.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?pi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,o=r!=null&&r.audioSSRC?pi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&y.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case ce.LocalVideoTrack:case ce.LocalVideoLowTrack:{const o=r,c=vl({},xb),u=t.getStats(),p=t.getLocalMedia(i);if(u){const m=u.videoSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){const _=t.getLocalVideoSize(),g=t.getEncoderConfig(ce.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(c.codecType=m.codec),c.sendBytes=m.bytes,c.sendBitrate=o?8*Math.max(0,c.sendBytes-o.sendBytes):0,m.inputFrame?(c.captureFrameRate=m.inputFrame.frameRate,c.captureResolutionHeight=m.inputFrame.height,c.captureResolutionWidth=m.inputFrame.width):_&&(c.captureResolutionWidth=_.width,c.captureResolutionHeight=_.height),m.sentFrame?(c.sendFrameRate=m.sentFrame.frameRate,c.sendResolutionHeight=m.sentFrame.height,c.sendResolutionWidth=m.sentFrame.width):_&&(c.sendResolutionWidth=_.width,c.sendResolutionHeight=_.height),m.avgEncodeMs&&(c.encodeDelay=m.avgEncodeMs),g&&g.bitrateMax&&(c.targetSendBitrate=1e3*g.bitrateMax),c.sendPackets=m.packets,c.sendPacketsLost=m.packetsLost,c.sendJitterMs=m.jitterMs,c.sendRttMs=m.rttMs,c.totalDuration=o?o.totalDuration+1:1,c.totalFreezeTime=o?o.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(c.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(y.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(i,c),((o==null?void 0:o.sendResolutionWidth)!==c.sendResolutionWidth||(o==null?void 0:o.sendResolutionHeight)!==c.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:c.sendResolutionWidth,height:c.sendResolutionHeight})),c&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,c);break}case ce.LocalAudioTrack:{const o=r,c=vl({},kb),u=t.getStats(),p=t.getLocalMedia(i);if(u){const m=u.audioSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(c.codecType=m.codec),m.inputLevel)c.sendVolumeLevel=Math.round(32767*m.inputLevel);else{const _=t.getLocalAudioVolume();_&&(c.sendVolumeLevel=Math.round(32767*_))}c.sendBytes=m.bytes,c.sendPackets=m.packets,c.sendPacketsLost=m.packetsLost,c.sendJitterMs=m.jitterMs,c.sendRttMs=m.rttMs,c.sendBitrate=o?8*Math.max(0,c.sendBytes-o.sendBytes):0}}this.trafficStats&&(c.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ce.LocalAudioTrack,c),c&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,c);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:o,audioStats:c,videoPcStats:u}]=n;const p=c,m=o,_=u,g=vl({},AP),v=vl({},IP),D=vl({},B3),{audioTrack:C,videoTrack:w,audioSSRC:P,videoSSRC:L}=t.getRemoteMedia(s);let G;G=t instanceof _r?t.getStats(!0):t.getStats();const W=(i=G)===null||i===void 0?void 0:i.audioRecv.find(ae=>ae.ssrc===P),K=(r=G)===null||r===void 0?void 0:r.videoRecv.find(ae=>ae.ssrc===L),ee=this.trafficStats&&this.trafficStats.peer_delay.find(ae=>ae.peer_uid===s);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(g.codecType=W.codec),W.outputLevel?g.receiveLevel=Math.round(32767*W.outputLevel):C&&(g.receiveLevel=Math.round(32767*C.getVolumeLevel())),g.receiveBytes=W.bytes,g.receivePackets=W.packets,g.receivePacketsLost=W.packetsLost,g.receivePacketsDiscarded=W.packetsDiscarded,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=p?p.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=W.jitterBufferMs,g.totalDuration>10&&Mp.isRemoteAudioFreeze(C)&&(g.totalFreezeTime+=1)),K){K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(v.codecType=K.codec),v.receiveBytes=K.bytes,v.receiveBitrate=m?8*Math.max(0,v.receiveBytes-m.receiveBytes):0,v.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,v.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(v.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(v.receiveFrameRate=K.receivedFrame.frameRate,v.receiveResolutionHeight=K.receivedFrame.height,v.receiveResolutionWidth=K.receivedFrame.width):w&&(v.receiveResolutionHeight=w._videoHeight||0,v.receiveResolutionWidth=w._videoWidth||0),K.framesRateFirefox!==void 0&&(v.receiveFrameRate=Math.round(K.framesRateFirefox)),v.receivePackets=K.packets,v.receivePacketsLost=K.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.totalDuration=m?m.totalDuration+1:1,v.totalFreezeTime=m?m.totalFreezeTime:0,v.receiveDelay=K.jitterBufferMs||0;const ae=!!L&&t.getRemoteVideoIsReady(L);w&&ae&&Mp.isRemoteVideoFreeze(w,K,_)&&(v.totalFreezeTime+=1),v.freezeRate=v.totalFreezeTime/v.totalDuration}ee&&(g.end2EndDelay=ee.B_ad,v.end2EndDelay=ee.B_vd,g.transportDelay=ee.B_ed,v.transportDelay=ee.B_ed,g.currentPacketLossRate=ee.B_ealr4/100,v.currentPacketLossRate=ee.B_evlr4/100,D.uplinkNetworkQuality=ee.B_punq?ee.B_punq:0,D.downlinkNetworkQuality=ee.B_pdnq?ee.B_pdnq:0),this.remoteStats.set(s,{audioStats:g,videoStats:v,videoPcStats:K,networkStats:D}),C&&this.exceptionMonitor.setRemoteAudioStats(C,g),w&&this.exceptionMonitor.setRemoteVideoStats(w,v)})}}class jk{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){PD(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){PD(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){vE(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Vk(e){if(!(e instanceof jk))return new z(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new z(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new z(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function Fk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Bk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var kt;function Gk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function tg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Gk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Up=(kt=class mf extends xD{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ge(n=Object.keys(gE)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(mf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=lC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,on()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=fc(t.sdp),i=Np(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,tg(tg({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new te(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(i){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),i=fn(i);const{iceParameters:r,dtlsParameters:s,candidates:o,rtpCapabilities:c,setup:u,localCapabilities:p,sdkCodec:m,cname:_}=i,g=Zn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=o,this.iceParameters=r,this.dtlsParameters=s,this.setup=u,this.localCapabilities=p,this.cname=_;for(let v=0;v<g.mediaDescriptions.length;v++){const D=g.mediaDescriptions[v];if(D.attributes.iceUfrag=r.iceUfrag,D.attributes.icePwd=r.icePwd,D.attributes.fingerprints=s.fingerprints,D.attributes.candidates=o,D.attributes.setup=u,D.media.mediaType==="video"){D.media.fmts=c.videoCodecs.map(w=>w.payloadType.toString(10));let C=c.videoCodecs.filter(w=>{var P,L;return(P=w.rtpMap)===null||P===void 0?void 0:ge(L=P.encodingName.toLowerCase()).call(L,m)});C.length===0&&(C=c.videoCodecs),D.attributes.payloads=C,D.attributes.extmaps=c.videoExtensions}D.media.mediaType==="audio"&&(D.media.fmts=c.audioCodecs.map(C=>C.payloadType.toString(10)),D.attributes.payloads=c.audioCodecs,D.attributes.extmaps=c.audioExtensions),g.mediaDescriptions[v]=this.mungMediaDesc(D)}this.sessionDesc=g,this.currentMidIndex=g.mediaDescriptions.length-1}toString(){return Zn.print(this.sessionDesc)}send(i,r,s){const{ssrcs:o,ssrcGroups:c}=El(r,this.cname),u=this.sessionDesc.mediaDescriptions.find(_=>i===we.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),p=o[0].attributes.label,m=o[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(o),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(c),{id:p,mslabel:m}}batchSend(i){return i.map(r=>{let{kind:s,ssrcMsg:o}=r;return this.send(s,o,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(r=>{const s=[],o=[],c=[];r.attributes.ssrcs.forEach(u=>{ge(i).call(i,u.attributes.label||"")?c.push(u):s.push(u)}),r.attributes.ssrcGroups.forEach(u=>{var p;ge(p=c.map(m=>m.ssrcId)).call(p,u.ssrcIds[0])||o.push(u)}),r.attributes.ssrcs=s,r.attributes.ssrcGroups=o})}mute(i){const r=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(i){const r=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(i,r,s){i.forEach((o,c)=>{const u=o._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===u.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],o);this.sessionDesc.mediaDescriptions[p]=m})}stopReceiving(i){}updateCandidates(i){i===hr.TCP?this.candidates.forEach(r=>{this.candidates.findIndex(s=>s.transport==="tcp"&&s.connectionAddress===r.connectionAddress&&s.port===r.port)===-1&&this.candidates.push(Bk(Bk({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this.candidates=this.candidates.filter(r=>r.transport!=="tcp");for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(i){i=fn(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=i.iceUfrag,r.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const r=[];for(let s=0;s<i;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}mungRecvMediaDsec(i,r){const s=fn(i);return pu(s,r),qb(s,r),s}updateRecvMedia(i,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===i);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,r,s){const o=this.sessionDesc.mediaDescriptions.find(u=>i===we.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(o){const u=o.attributes.ssrcs.find(p=>p.attributes.label===r);var c;u&&(u.attributes.label=s,(c=u.attributes.msid)===null||c===void 0||c.replace(r,s))}}mungMediaDesc(i){const r=fn(i);return zb(r),function(s){const o=s.attributes.extmaps.find(c=>KE(c.extensionName));o&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(o),1),s.attributes.payloads.forEach(c=>{const u=c.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");u!==-1&&c.rtcpFeedbacks.splice(u,1)})}(r),r}getSSRC(i){for(const r of this.sessionDesc.mediaDescriptions)for(const s of r.attributes.ssrcs)if(s.attributes.label===i)return[s]}}(tg(tg({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new te(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return Hr(function*(){const r=yield ct(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(g=>i.peerConnection.addTrack(g._mediaStreamTrack)),o=yield ct(i.peerConnection.createOffer()),c=Zn.parse(o.sdp),u=t.map(g=>{const v=g._mediaStreamTrack,D=c.mediaDescriptions.find(C=>C.attributes.mid===v.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(C,w,P){const L=C.attributes.ssrcs.filter(W=>W.attributes.label===w),G=C.attributes.ssrcGroups;if(L.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&L.length>1){const W=G.find(K=>K.ssrcIds.indexOf(L[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:P?W.ssrcIds[1]:void 0}]:[{ssrcId:L[0].ssrcId}]}return[{ssrcId:L[0].ssrcId}]}(D,v.id,i.useRTX)});let p;try{p=yield u}catch(g){throw s.forEach(v=>{ni()&&v.replaceTrack(null),i.peerConnection.removeTrack(v)}),g}const m=i.mungSendOfferSDP(o.sdp,t);i.remoteSDP.receive(t,n,p);const _=i.remoteSDP.toString();return yield ct(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield ct(i.applySendEncodings(s,t)),yield ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),t.map((g,v)=>{const D=g._mediaStreamTrack.id;return{localSSRC:u[v],id:D}})}catch(s){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{ni()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,r),c=new ve((m,_)=>{const g=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),v=D=>{const C=ut();if((C.name==="Safari"&&Number(C.version)===11||Oi())&&D.track.id!==s&&D.streams[0].id===o){var w;const P=D.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(t,s,D.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(g),void m(P)}if(D.track.id===s)return this.peerConnection.removeEventListener("track",v),clearTimeout(g),void m(D.track)};this.peerConnection.addEventListener("track",v)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await c,id:s}}catch(s){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return t.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(ni()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(ni()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(c=>c.active=!0),await s.setParameters(o)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Hr(function*(){const i=yield ct(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(pt().supportPCSetConfiguration){const u=n.peerConnection.getConfiguration(),p=t===hr.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(y.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,n.peerConnection.setConfiguration(u))}else if(t===hr.RELAY)return;t!==hr.RELAY&&n.remoteSDP.updateCandidates(t);const r=yield ct(n.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=fc(r.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const c=n.remoteSDP.toString();yield ct(n.peerConnection.setLocalDescription(r)),yield ct(n.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(r){y.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new te(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new te(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new te(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(hE(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...mf.turnServerConfigToIceServers(t.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...mf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!pt().supportSetRtpSenderParameters)return y.warn("Browser not support set rtp-sender parameters");const r={},s={};if(t instanceof Yt)switch(t._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(V("DSCP_TYPE")&&sc()){var o;const p=V("DSCP_TYPE");ge(o=["very-low","low","medium","high"]).call(o,p)&&(s.networkPriority=p)}const c=n.getParameters(),u=(i=c.encodings)===null||i===void 0?void 0:i[0];u&&Object.assign(u,s),Object.assign(c,r),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!pt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=Zn.parse(t);return n.forEach((r,s)=>{const o=r._mediaStreamTrack,c=i.mediaDescriptions.find(u=>u.attributes.mid===o.kind);c&&pu(c,r)}),Zn.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,o)=>{let{id:c,mslabel:u}=s;const{kind:p}=t[o];return new ve((m,_)=>{const g=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(c)))},1e4),v=D=>{const C=ut();if(C.name==="Safari"&&Number(C.version)===11&&D.track.id!==c&&D.streams[0].id===u){var w;const P=D.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(p,c,D.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(g),void m({track:P,id:c})}if(D.track.id===c)return this.peerConnection.removeEventListener("track",v),clearTimeout(g),void m({track:D.track,id:c})};this.peerConnection.addEventListener("track",v)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await ve.all(n)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(pt().supportPCSetConfiguration){const n=mf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ae(kt.prototype,"connect",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"connect"),kt.prototype),Ae(kt.prototype,"stopSending",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"stopSending"),kt.prototype),Ae(kt.prototype,"receive",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"receive"),kt.prototype),Ae(kt.prototype,"stopReceiving",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"stopReceiving"),kt.prototype),Ae(kt.prototype,"muteRemote",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"muteRemote"),kt.prototype),Ae(kt.prototype,"unmuteRemote",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteRemote"),kt.prototype),Ae(kt.prototype,"muteLocal",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"muteLocal"),kt.prototype),Ae(kt.prototype,"unmuteLocal",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteLocal"),kt.prototype),Ae(kt.prototype,"close",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"close"),kt.prototype),Ae(kt.prototype,"updateEncoderConfig",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"updateEncoderConfig"),kt.prototype),Ae(kt.prototype,"updateSendParameters",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"updateSendParameters"),kt.prototype),Ae(kt.prototype,"replaceTrack",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"replaceTrack"),kt.prototype),Ae(kt.prototype,"getRemoteSSRC",[$r],Object.getOwnPropertyDescriptor(kt.prototype,"getRemoteSSRC"),kt.prototype),kt);function $r(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return await i.apply(this,c)}finally{s()}},n}function Hk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Sc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Hk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const jp="9",Wk=4e4;class b7{get localCapabilities(){return fn(this._localCapabilities)}get rtpCapabilities(){return fn(this._rtpCapabilities)}get candidates(){return fn(this._candidates)}get iceParameters(){return fn(this._iceParameters)}get dtlsParameters(){return fn(this._dtlsParameters)}constructor(t){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"firefoxSsrcMidMap",new Map),t=fn(t);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:o,localCapabilities:c,cname:u}=t;this._rtpCapabilities=s,this._candidates=r,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=c,this.setup=o,this.cname=u,this.sessionDesc=this.updateRemoteRTPCapabilities(s),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t){const n=this.candidates,i=this.dtlsParameters,r=this.iceParameters,s=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let c=1;c<t;c++){const u=2*c+2e4,p=2*c+Wk,{ssrcs:m,ssrcGroups:_}=El([{ssrcId:u}],this.cname),{ssrcs:g,ssrcGroups:v}=El([{ssrcId:p,rtx:V("USE_SUB_RTX")?p+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:jp,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.videoCodecs.map(D=>D.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:n,extmaps:s.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:g,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:s.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:jp,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.audioCodecs.map(D=>D.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:n,extmaps:s.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:s.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Zn.print(this.sessionDesc)}send(t,n,i,r){const{ssrcs:s,ssrcGroups:o}=El(n,this.cname,V("SYNC_GROUP")?i:void 0),c=this.findPreloadMediaDesc(s);if(c){if(on()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(c,r),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,s);let p;return u===-1||u===1&&(ni()||function(){const m=ut();return!(m.name!==vt.CHROME||!m.osVersion)&&Number(m.version)<=90}())||u===0&&V("USE_SUB_RTX")||qN()?(p=this.createOrRecycleSendMedia(t,s,o,"sendonly",r),this.updateBundleMids()):(p=fn(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,r)),on()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:n}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:n}}batchSend(t){const n=t.map(s=>{let{kind:o,ssrcMsg:c,mslabel:u}=s;return this.send(o,c,u)}),i=[];let r=!1;return n.forEach(s=>{let{mid:o,needExchangeSDP:c}=s;c&&(r=!0),i.push(o)}),{mids:i,needExchangeSDP:r}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||on()||qN()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>ge(t).call(t,i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>ge(t).call(t,i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,r){t.forEach((s,o)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",n,i,r[o])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const n=this.sessionDesc||Zn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=t;const i=this.rtpCapabilities.send,r=this.localCapabilities.send;for(const s of n.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"){if(i.videoCodecs.length===0){const o=r.videoCodecs.filter(c=>{var u,p;return(u=c.rtpMap)===null||u===void 0?void 0:ge(p=u.encodingName.toLowerCase()).call(p,"vp8")})||[r.videoCodecs[0]];s.media.fmts=o.map(c=>c.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=i.videoCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:c}=El([{ssrcId:Wk,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=c}}if(s.media.mediaType==="audio"){if(i.audioCodecs.length===0){const o=r.audioCodecs.filter(c=>{var u,p;return(u=c.rtpMap)===null||u===void 0?void 0:ge(p=u.encodingName.toLowerCase()).call(p,"opus")})||[r.audioCodecs[0]];s.media.fmts=o.map(c=>c.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=i.audioCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,fu(s),V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:c}=El([{ssrcId:2e4}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=c}}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t){const n=this._candidates.filter(i=>i.transport==="udp");if(t===hr.TCP){if(n.length===0)return;if(V("TCP_CANDIDATE_ONLY")){const i=this._candidates.filter(r=>r.transport==="tcp");n.forEach(r=>{i.findIndex(s=>s.connectionAddress===r.connectionAddress)===-1&&i.push(Sc(Sc({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=i}else{const i=[];n.forEach(r=>{i.push(Sc(Sc({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=[...n,...i]}}else if(t===hr.RELAY){if(n.length!==0)return;{const i=this._candidates.filter(r=>r.transport==="tcp");i.forEach(r=>{n.push(Sc(Sc({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=[...n,...i]}}else n.length===0?(this._candidates.filter(i=>i.transport==="tcp").forEach(i=>{n.push(Sc(Sc({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=n):this._candidates=this._candidates.filter(i=>i.transport!=="tcp");for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(t){t=fn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(on()){if(r){const s=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),n={media:{mediaType:"application",port:jp,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n),{mediaDesc:n,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,n,i,r,s,o){const c=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=Dp(c,u,this.localCapabilities.send,c===we.VIDEO?r:s),m=c===we.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let g={media:{mediaType:c,port:jp,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(D=>D.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};g=this.mungRecvMediaDsec(g,t,o);const v=this.findFirstClosedMedia(c);if(v){const D=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[D]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateRemoteCodec(t,n,i){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").filter(g=>{var v;return ge(v=Object.keys(gE)).call(v,g)}))],s=new Set(n);if(r.every(g=>s.has(g)))return y.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(g=>n.some(v=>{var D;return ge(D=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(D,v)}));if(o.length===0)return y.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(n)),!1;const c=[...new Set(o.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||""))];let u;if(y.debug("updateRemoteCodec, from ".concat(r," to ").concat(c)),t.length===0)u=this.sessionDesc.mediaDescriptions.filter(g=>g.media.mediaType==="video"&&g.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(g=>g.attributes.mid&&ge(t).call(t,g.attributes.mid)&&g.attributes.direction==="recvonly"),u.length!==t.length)return y.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(n)),!1;if(V("USE_PUB_RTX")||V("USE_SUB_RTX")){const g=$b(o,this.rtpCapabilities.recv.videoCodecs);o.push(...g)}this._rtpCapabilities.recv.videoCodecs=o;const p=this.localCapabilities.send,m=this.rtpCapabilities.recv,_=Dp(we.VIDEO,m,p,i);return u.forEach(g=>{const v=_.map(D=>D.payloadType.toString(10));y.debug("updateRemoteCodec mid: ".concat(g.attributes.mid,", from"),g.attributes.payloads,"to",_),g.attributes.payloads=_,g.media.fmts=v}),!0}createOrRecycleSendMedia(t,n,i,r,s){const o=this.rtpCapabilities.send,c=t===we.VIDEO?o.videoCodecs:o.audioCodecs,u=t===we.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let m={media:{mediaType:t,port:jp,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungSendMediaDesc(m,s);const _=this.findFirstClosedMedia(t);if(_){const g=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[g]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const r=fn(t);return zb(r),pu(r,n),qb(r,n),xL(r),YE(r,i,this.localCapabilities.send),r}mungSendMediaDesc(t,n){const i=fn(t);return YE(i,n,this.localCapabilities.recv),fu(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>on()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}function Kk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Ta(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Vp=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var gu=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(gu||{});const ng=new Map;function Yk(e,t,n,i){let{scale:r}=e;if(r===0&&i===gu.UP||r>=t.length-1&&i===gu.DOWN)return e;let s=Ta(Ta({},e),{},{scale:i===gu.DOWN?++r:--r});switch(n){case"maintain-framerate":s=Ta(Ta({},s),t[r].motion);break;case"maintain-resolution":s=Ta(Ta({},s),t[r].detail);break;case"balanced":s=Ta(Ta({},s),t[r].balanced)}return s}function zk(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:qk(t)};ng.set(e,n)}else ng.delete(e)}function qk(e){const t=Ta({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:C,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:P,MOTION_RESOLUTION_FACTOR:L,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:K}=zR,ee=Math.min(t.frameRate,c),ae=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(g,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(v,1)*ee),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let fe=1;fe<=u;fe++){const de={bwe_up:Math.round(Math.pow(_,fe)*n),bwe_down:Math.round(Math.pow(g,fe+1)*n),fps_up:Math.round(Math.pow(D,fe)*ee),fps_down:Math.round(Math.pow(v,fe+1)*ee)},Ne={scaleResolutionDownBy:r/Math.pow(P,fe),frameRate:Math.max(Math.round(Math.pow(w,fe)*i),o),bitrateMax:Math.max(Math.round(Math.pow(C,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(C,fe)*s),p)},tt={scaleResolutionDownBy:r/Math.pow(L,fe),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(G,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(G,fe)*s),p)},Tt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,fe)*i),o),bitrateMax:Math.max(Math.round(Math.pow(K,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(K,fe)*s),p)};ae.push({scale:fe,threshold:de,balanced:Ne,motion:tt,detail:Tt})}return ae}function C7(e,t,n,i,r,s){const o=ng.get(e)||{overUse:0,underUse:0,adaptationList:qk(r)},{adaptationList:c}=o;ng.set(e,o);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:p}=zR,{scale:m}=i;let _,g;return typeof t=="number"&&t>0&&function(v,D,C,w){if(D>=C.length)return!1;let{threshold:{fps_down:P}}=C[D];return V("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(P=C[0].threshold.fps_down),v<P}(t,m,c,s)&&(o.overUse++,g=Vp.CPU,o.overUse>u)||typeof n=="number"&&n>0&&function(v,D,C){if(D>=C.length)return!1;const{threshold:{bwe_down:w}}=C[D];return v<w}(n,m,c)&&(o.overUse++,g=Vp.BANDWIDTH,o.overUse>u)?(o.overUse=0,o.underUse=0,_=Yk(i,c,s,gu.DOWN),[_,g]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(v,D,C,w){if(D===0)return;let{threshold:{fps_up:P}}=C[D];return V("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(P=C[1].threshold.fps_up),v>P}(t,m,c,s)&&function(v,D,C){if(D===0)return;const{threshold:{bwe_up:w}}=C[D];return v>w}(n,m,c)&&(o.underUse++,o.underUse>p&&(o.overUse=0,o.underUse=0,_=Yk(i,c,s,gu.UP),_.scale===0&&(g=Vp.NONE))),[_,g])}function $k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function pC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$k(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$k(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function w7(e){var t;return!!V("ENABLE_AG_ADAPTATION")&&!!(e instanceof Wb||ge(t=e._hints).call(t,Vt.CUSTOM_TRACK))&&(!!V("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=ut();if(i.os!==Vn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&KN(17,4)||WN(14)&&YN(17,4)))}const ig=new Map;function rg(e,t){const n=ig.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),ig.delete(e)}t.qualityLimitationReason=Vp.NONE,zk(e)}var at;function Jk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Po(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let eo=(at=class _f extends xD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ge(n=Object.keys(gE)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"id",jt(5,"connection-")),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:V("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preSSRCMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",Vp.NONE),this.store=n,this.mutex=new ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(_f.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=lC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,on()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void y.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else y.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=fc(n.sdp),r=await UL({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},this.extension);let s;return this.localCapabilities=zE(r),this.initialOffer=n,n.sdp&&BL(n.sdp)&&(s=fn(r),(t=s).send&&(hu(we.VIDEO,t.send.videoExtensions),hu(we.AUDIO,t.send.audioExtensions)),t.recv&&(hu(we.VIDEO,t.recv.videoExtensions),hu(we.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(hu(we.VIDEO,t.sendrecv.videoExtensions),hu(we.AUDIO,t.sendrecv.audioExtensions))),Po(Po({},i),{},{rtpCapabilities:s||r,offerSDP:n.sdp})}catch(n){throw new te(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}var t}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&BL(this.initialOffer.sdp)&&(n=t.rtpCapabilities,i=this.localCapabilities,n.send&&(WE(we.VIDEO,n.send.videoExtensions,i.send.videoExtensions),WE(we.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(WE(we.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),WE(we.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new b7(Po(Po({},t),{},{localCapabilities:this.localCapabilities})),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=VL(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o==null||o(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),V("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(V("PRELOAD_MEDIA_COUNT"));const p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(m)}const{preSSRCs:u}=t;if(Array.isArray(u)&&u.length>0){const{mids:p}=this.remoteSDP.batchSend(u.map(m=>({kind:m.kind,ssrcMsg:[{ssrcId:m.ssrcId,rtx:m.rtx}],mslabel:m.mslabel})));p.forEach((m,_)=>{this.preSSRCMap.set(u[_].ssrcId,m)}),await qE(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=t;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));r.forEach((s,o)=>{this.preSSRCMap.set(i[o].ssrcId,s)})}await qE(this.peerConnection,this.remoteSDP,this.extension),y.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var r=this;return Hr(function*(){const s=yield ct(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];t.forEach(C=>{const w=r.peerConnection.addTransceiver(C._mediaStreamTrack,{direction:"sendonly"});o.push(w),C._updateRtpTransceiver(w)}),on()&&V("SIMULCAST")===!0&&(yield ct(r.applySimulcastForFirefox(o,t)));const c=yield ct(r.peerConnection.createOffer()),u=r.remoteSDP.predictReceivingMids(t.length),p=r.mungSendOfferSDP(c.sdp,t,u),m=Zn.parse(p),_=u.map(C=>{const w=m.mediaDescriptions.find(P=>P.attributes.mid===C);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return PL(w,V("USE_PUB_RTX"))});let g;try{g=yield _}catch(C){g=[],r.remoteSDP.receive(t,n,i,g);const w=r.remoteSDP.toString();throw yield ct(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ct(r.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield ct(r.stopSending(u,!0)),C}r.remoteSDP.receive(t,n,i,g);const v=r.remoteSDP.toString(),D=r.logSDPExchange(p,"offer","local","send");return yield ct(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ct(r.applySimulcastEncodings(o,t)),yield ct(r.applySendEncodings(o,t)),D==null||D(v),yield ct(r.peerConnection.setRemoteDescription({type:"answer",sdp:v})),o.map((C,w)=>{const P=u[w];return{localSSRC:_[w],id:P,transceiver:C}})}catch(o){throw o instanceof te?o:new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")y.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),y.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else y.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof te?i:new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof te?n:new te(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{var p;rg(this.id+u.mid,this),u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o==null||o(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(t,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,i,r);o&&(await qE(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await qE(this.peerConnection,this.remoteSDP,this.extension),y.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(o=>{let[c,u]=o;if(u===s)return this.preSSRCMap.delete(c),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,c)=>{o.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new te(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Hr(function*(){const i=yield ct(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(pt().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),m=t===hr.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(y.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}else if(t===hr.RELAY)return;n.remoteSDP.updateCandidates(t);const r=yield ct(n.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=fc(r.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const c=n.remoteSDP.toString(),u=n.logSDPExchange(r.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ct(n.peerConnection.setLocalDescription(r)),u==null||u(c),yield ct(n.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(r){y.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{rg(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Po(Po({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new te(k.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===t);i.length===1&&(this.isVP8Simulcast(n)?on()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Po(Po({},Do),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Po(Po({},Do),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,y.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(hE(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(..._f.turnServerConfigToIceServers(t.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(..._f.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&pt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(qd(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!V("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair();y.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===t._mediaStreamTrack)),!n)return y.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return y.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pt().supportSetRtpSenderParameters)return y.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=function(C,w){return C.getTransceivers().find(P=>P.sender.track===w||P.receiver.track===w)}(this.peerConnection,t._mediaStreamTrack),u=Y3(t);if(w7(t)&&c&&n&&u&&this.getLocalVideoStats&&ge(i=["vp8","vp9"]).call(i,this.store.codec)){var p;const C=s.degradationPreference||(ge(p=t._hints).call(p,Vt.CUSTOM_TRACK)?V("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,P,L,G,W,K){if(rg(w,L),W(P),G!=="balanced"&&G!=="maintain-framerate"&&G!=="maintain-resolution")return;let ee=-1;zk(w,P);const ae=window.setInterval(()=>{const de=ig.get(w);if(!V("ENABLE_AG_ADAPTATION")||!de)return rg(w,L),void W(P);const Ne=K();if(Ne.sendPackets>0&&Ne.OutgoingAvailableBandwidth>0){if(ee===-1)return void(ee=Date.now());if(Date.now()-ee<1e3)return;const tt=Ne.sendFrameRate,Tt=Ne.OutgoingAvailableBandwidth,[Gt,Cn]=C7(w,tt,Tt,de.adaptationConfig,P,G);Cn&&(L.qualityLimitationReason=Cn),Gt&&de.adaptationConfig.scale!==Gt.scale&&(y.debug("[".concat(w,"] applyAdaptation: ").concat(L.qualityLimitationReason,`
           sendFps `).concat(tt,", bwe ").concat(Tt,", switch from ").concat(de.adaptationConfig.scale," to ").concat(Gt.scale," ")),de.adaptationConfig=pC(pC({},de.adaptationConfig),Gt),W(Gt))}},V("CHECK_LOCAL_STATS_INTERVAL")),fe=pC({},P);ig.set(w,{timer:ae,adaptationConfig:fe,originConfig:P,adaptationFunc:W}),y.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(P),", degradationPreference: ").concat(G))})(this.id+c.mid,u,this,C,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:C,frameRate:w,scaleResolutionDownBy:P}=t._encoderConfig;C&&(o.maxBitrate=1e3*C),(ge(m=t._hints).call(m,Vt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(w&&(o.maxFramerate=pr(w)),P&&P>=1&&(o.scaleResolutionDownBy=P))}const{maxFramerate:_}=V("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,_):_),V("DSCP_TYPE")&&sc()){var g;const C=V("DSCP_TYPE");ge(g=["very-low","low","medium","high"]).call(g,C)&&(o.networkPriority=C)}const v=n.getParameters(),D=(r=v.encodings)===null||r===void 0?void 0:r[0];on()&&!D&&(s.encodings=[o]),D&&Object.assign(D,o),Object.assign(v,s),y.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(v.encodings))),await n.setParameters(v),await async function(C,w,P){try{var L;if(!pt().supportSetRtpSenderParameters||!function(ae){return ae==="vp9"}(C)||!V("ENABLE_SVC"))return;const G={},W={},K=w.getParameters(),ee=(L=K.encodings)===null||L===void 0?void 0:L[0];W.scalabilityMode=Yb(P),ee&&Object.assign(ee,W),Object.assign(K,G),await w.setParameters(K),y.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(G){y.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",G)}}(this.store.codec,n,V("SVC_MODE"))}async updateAdaptation(t,n){var i,r;if(!t)return y.debug("[updateAdaptation] no rtpSender found");if(!pt().supportSetRtpSenderParameters)return y.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:u}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=pr(c)),u&&u>=1&&ge(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=u);const p=t.getParameters(),m=(r=p.encodings)===null||r===void 0?void 0:r[0];m&&Object.assign(m,s),Object.assign(p,{});try{await t.setParameters(p),y.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(_){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?y.debug("[updateAdaptation] peerConnection not connected}"):y.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):y.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!pt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const r=t[i],s=n[i];s instanceof Yt&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{y.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const r=Zn.parse(t);return n.forEach((s,o)=>{const c=i[o],u=r.mediaDescriptions.find(p=>p.attributes.mid===c);u&&(pu(u,s),ML(u,s,this.store.codec))}),Zn.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var i,r,s,o,c;const p=t[u],m=n[u];if(m instanceof Yt&&!ge(i=m._hints).call(i,Vt.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},g={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const v=p.sender.getParameters();await p.sender.setParameters(Object.assign(v,_))}}}async applySimulcastEncodings(t,n){if(!on()&&t.length===n.length)for(let i=0;i<t.length;i++){const r=n[i];if(r instanceof Yt&&this.isVP8Simulcast(r)){const s=t[i],o={},c={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,o))}}}isVP8Simulcast(t){var n,i,r,s,o;return!!(t instanceof Yt&&V("SIMULCAST")&&this.store.codec==="vp8"&&!ge(n=t._hints).call(n,Vt.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(V("SDP_LOGGING"))return y.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(pt().supportPCSetConfiguration){const n=_f.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ae(at.prototype,"updateRemoteRTPCapabilities",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"updateRemoteRTPCapabilities"),at.prototype),Ae(at.prototype,"connect",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"connect"),at.prototype),Ae(at.prototype,"updateRemoteConnect",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"updateRemoteConnect"),at.prototype),Ae(at.prototype,"createDataChannels",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"createDataChannels"),at.prototype),Ae(at.prototype,"receive",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"receive"),at.prototype),Ae(at.prototype,"batchReceive",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"batchReceive"),at.prototype),Ae(at.prototype,"stopReceiving",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"stopReceiving"),at.prototype),Ae(at.prototype,"muteRemote",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"muteRemote"),at.prototype),Ae(at.prototype,"unmuteRemote",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"unmuteRemote"),at.prototype),Ae(at.prototype,"muteLocal",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"muteLocal"),at.prototype),Ae(at.prototype,"unmuteLocal",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"unmuteLocal"),at.prototype),Ae(at.prototype,"close",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"close"),at.prototype),Ae(at.prototype,"updateEncoderConfig",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"updateEncoderConfig"),at.prototype),Ae(at.prototype,"updateSendParameters",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"updateSendParameters"),at.prototype),Ae(at.prototype,"replaceTrack",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"replaceTrack"),at.prototype),Ae(at.prototype,"updateAdaptation",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"updateAdaptation"),at.prototype),Ae(at.prototype,"getRemoteSSRC",[Hi],Object.getOwnPropertyDescriptor(at.prototype,"getRemoteSSRC"),at.prototype),at);function Hi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return await i.apply(this,c)}finally{s()}},n}var et;function Xk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Lo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xk(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xk(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Qk(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=bR,i=Symbol.iterator);r--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new sg(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function sg(e){function t(n){if(Object(n)!==n)return ve.reject(new TypeError(n+" is not an object."));var i=n.done;return ve.resolve(n.value).then(function(r){return{value:r,done:i}})}return sg=function(n){this.s=n,this.n=n.next},sg.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?ve.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?ve.reject(n):t(i.apply(this.s,arguments))}},new sg(e)}let og=(et=class extends nn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Be.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",Rt.Disconnected),O(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?fa.FIRST_CONNECTION:fa.OLD_FIRST_CONNECTION),O(this,"_isInRestartIce",!1),O(this,"_isStartRestartIce",!1),O(this,"_restartStates",["disconnected","failed"]),O(this,"_restartTimer",void 0),O(this,"_isFirstConnected",!0),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void r(new te(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void i();const c=o.find(p=>p[0]==="videoLowTrack");c&&c[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const u=this.createMuteMessage(o);await Lt(this,Be.RequestMuteLocal,u),i()}catch(o){r(o)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void r(new te(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void i();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];if(p.track._originMediaStreamTrack.stop(),!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=dC(n,Ep(this,Be.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new ve((m,_)=>{this.handleReplaceTrack(p.track,m,_,!0)})}await this.connection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const u=this.createUnmuteMessage(o);await Lt(this,Be.RequestUnmuteLocal,u),i()}catch(o){r(o)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const o=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Rt.Connected)return void i();const{id:c,track:u}=o;await this.connection.updateSendParameters(c,u),await this.connection.updateEncoderConfig(c,u),this.emit(Be.UpdateVideoEncoder,u),i()}catch(o){r(o)}finally{s()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Rt.Connected)return void i();const{id:c,track:u}=o;await this.connection.updateSendParameters(c,u),i()}catch(o){r(o)}finally{s()}}),O(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==Rt.Connected)return void i();const o=hC([n]);let c;y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),i()}catch(p){r(p)}finally{var u;(u=c)===null||u===void 0||u()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let o;y.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:_}]=m;return n===_});if(!this.connection||!p||this.state!==Rt.Connected)return void i();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===ce.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding){const m=this.localTrackMap.get(ce.LocalVideoLowTrack);if(m){const _=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_,await new ve((g,v)=>{this.handleReplaceTrack(m.track,g,v,!0)})}}i()}catch(p){r(p)}finally{var u;(u=o)===null||u===void 0||u()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new bk(this.store),this.bindStatsUploaderEvents(),this.mutex=new ui("P2PChannel-mutex",this.store.clientId),this.isPlanB=!pt().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&sc(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&pt().supportPCSetConfiguration&&MR(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Up({},this.store):new eo({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Rt.New;const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(y.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Up(e,this.store):new eo(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new te(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=V("NEW_ICE_RESTART")?fa.FIRST_CONNECTION:fa.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new te(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");V("ENABLE_PREALLOC_PC")&&this.state===Rt.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[o]=r;return ge(s=[ce.LocalVideoLowTrack,ce.LocalVideoTrack]).call(s,o)}),n=t.map(r=>{let[,{id:s}]=r;return s}),i=t.map(r=>{let[s]=r;return s});if(this.connection instanceof eo){if(Pe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ge(e).call(e,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>ge(e).call(e,s));r&&(this.store.codec=r,y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof eo&&this.connection.peerConnectionState!=="closed"&&ge(e=[Rt.New,Rt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Rt.Connected){if(this.state===Rt.Disconnected)throw new te(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;ge(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return Hr(function*(){const r=yield ct(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Rt.Connected){if(i.state===Rt.Disconnected)throw new te(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const o=e.filter(c=>i.pendingLocalTracks.indexOf(c)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(o))}i.store.pubId=i.store.pubId+1,pi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield ct(i.tryToUnmuteAudio(e)));yield*tE(Qk(i.doPublish(i.connection,s)))}finally{r()}})()}doPublish(e,t){var n=this;return Hr(function*(){t.forEach(_=>{let{track:g,type:v}=_;const D=Date.now();n.store.publish(g.getTrackId(),v===ce.LocalAudioTrack?"audio":"video",D)}),n.bindLocalTrackEvents(t);const i=t.map(_=>{let{track:g}=_;return g}),r=yield ct(e.send(i,n.store.codec,n.store.audioCodec)),s=(yield ct(r.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(_){throw r.throw(_),(_==null?void 0:_.code)===k.WS_ABORT&&t.forEach(g=>{let{track:v}=g;n.pendingLocalTracks.indexOf(v)===-1&&n.pendingLocalTracks.push(v)}),n.unbindLocalTrackEvents(t),_}const u=n.mapPubResToRemoteConfig(o,c,i),p=(yield ct(r.next(u))).value,m=V("ENABLE_VIDEO_SEI");i.forEach(async _=>{const g=_.getRTCRtpTransceiver();g&&m&&(_.trackMediaType===we.VIDEO?await Q3(g.sender,_):_.trackMediaType===we.AUDIO&&await async function(v){if(!pt().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(BE.has(v)||!v.track)return;const D={track:v.track};if(rc()){if(!v.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let w=null;try{w=v.createEncodedStreams()}catch(L){return void y.error("create audio-encoded-streams error",L&&L.message)}const P=new TransformStream({transform(L,G){D.controller||(D.controller=G),v.track&&v.track.id!==D.track.id&&(y.debug("audio track changed: ".concat(D.track.id," => ").concat(v.track.id)),D.track.removeEventListener("ended",C),D.track=v.track,D.track.addEventListener("ended",C)),G.enqueue(L)}});w.readable.pipeThrough(P).pipeTo(w.writable)}else if(ni()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const w=FE(),P=new MessageChannel;await new ve(G=>w.onmessage=W=>{W.data==="registered"&&G(void 0)});const L=new RTCRtpScriptTransform(w,{name:"tx",port:P.port2},[P.port2]);v.transform=L,await new ve(G=>w.onmessage=W=>{W.data==="started"&&G(void 0)}),P.port1.onmessage=G=>{var W;G.data.transformed&&v.track&&((W=v.track)===null||W===void 0?void 0:W.id)!==D.track.id&&(y.debug("audio track changed: ".concat(D.track.id," => ").concat(v.track.id)),D.track.removeEventListener("ended",C),D.track=v.track,D.track.addEventListener("ended",C))},D.worker=w}function C(){if(v.track){if(this.id!==v.track.id)return;v.track.removeEventListener("ended",C)}const w=BE.get(v);if(w){BE.delete(v);try{var P,L;(P=w.controller)===null||P===void 0||P.terminate(),(L=w.worker)===null||L===void 0||L.terminate()}catch(G){y.warning(G&&G.message)}}}BE.set(v,D),v.track.addEventListener("ended",C)}(g.sender))}),t.forEach(_=>{let{type:g}=_;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:g,type:v}=_;const D=Date.now();n.store.publish(g.getTrackId(),v===ce.LocalAudioTrack?"audio":"video",void 0,D)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof Yt))return y.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof eo||this.connection instanceof Up))return y.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:i}=n,r=function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=lb(s,o)),c.maxFramerate=s.framerate?pr(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ce.LocalVideoLowTrack||!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return y.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(o,c){const u=o.canvas;c.width&&(u.width=pr(c.width)),c.height&&(u.height=pr(c.height)),c.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=jb(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},pr(c.framerate)))})(s,e)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),y.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return Hr(function*(){if(!t.connection||t.state!==Rt.Connected)return;const n=yield ct(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=t.localTrackMap.get(ce.LocalVideoTrack);if(!r)throw new te(k.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ce.LocalVideoLowTrack))throw new te(k.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(r.track,e),type:ce.LocalVideoLowTrack}];if(yield*tE(Qk(t.doPublish(t.connection,s))),r.track.muted||!r.track.enabled){var i;const o=(i=t.localTrackMap.get(ce.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;o!==void 0&&(yield ct(t.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(y.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ri(this,Be.RequestRePublish,this.pendingLocalTracks),this.emit(Be.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(y.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ri(this,Be.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==we.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==we.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ri(this,Be.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===we.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Be.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Rt.Connected)return void e.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Rt.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Rt.Connected)return;const e=this.localTrackMap.get(ce.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ce.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),t.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Rt.Connected)throw new te(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(e)?(r=this.remoteDataChannelMap.get(e))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:c,id:u}=o;return c.uid===e.uid&&u===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,r){var s;if(!this.connection||this.state!==Rt.Connected)throw new te(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,u;const p=this.connection.getPreMedia(n);if(p)y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),u=p.transceiver,o=p.track,c=p.id;else if(r){const g=r.find(D=>{let{stream_type:C}=D;return C===t});if(!g)throw new te(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const v=await this.connection.receive(t,g.ssrcs,String(e._uintid),g.attributes);this.connection instanceof eo&&(u=v.transceiver),o=v.track,c=v.id}else{const g=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof eo&&(u=g.transceiver),o=g.track,c=g.id}t===we.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new uu(o,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new du(o,e.uid,e._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack)),V("ENABLE_VIDEO_SEI")&&u&&(t==we.VIDEO?await async function(g){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!pt().supportWebRTCEncodedTransform)return void y.warning("browser not support video encoded transform");if(!g.track)return;if(Op.has(g)){const w=Op.get(g);return void(w&&(w.onSei=v.onSei))}const D={track:g.track,onSei:v.onSei};if(rc()){if(!g.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let w=null;try{w=g.createEncodedStreams()}catch(L){return void y.error("create video-encoded-streams error",L&&L.message)}const P=new TransformStream({transform(L,G){D.controller||(D.controller=G),g.track&&g.track.id!==D.track.id&&(y.debug("video track changed: ".concat(D.track.id," => ").concat(g.track.id)),D.track.removeEventListener("ended",C),D.track=g.track,D.track.addEventListener("ended",C));const W=function(K){const ee=new DataView(K.data);let ae=0;for(;ae+4<K.data.byteLength;){if(ee.getUint8(ae+0)===0&&ee.getUint8(ae+1)===0&&ee.getUint8(ae+2)===0&&ee.getUint8(ae+3)===1&&ee.getUint8(ae+4)===6){let fe=ae+6,de=0,Ne=0;for(;(Ne=ee.getUint8(fe++))===255;)de+=255;de+=Ne;const tt=X3(K.data,fe,de);return new Uint8Array(tt)}ae++}return null}(L);W&&D.onSei&&D.onSei(W),G.enqueue(L)}});w.readable.pipeThrough(P).pipeTo(w.writable)}else if(ni()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const w=FE(),P=new MessageChannel;await new ve(G=>w.onmessage=W=>{W.data==="registered"&&G(void 0)});const L=new RTCRtpScriptTransform(w,{name:"rx",port:P.port2},[P.port2]);g.transform=L,await new ve(G=>w.onmessage=W=>{W.data==="started"&&G(void 0)}),P.port1.onmessage=G=>{var W;G.data.transformed&&g.track&&((W=g.track)===null||W===void 0?void 0:W.id)!==D.track.id?(y.debug("video track changed: ".concat(D.track.id," => ").concat(g.track.id)),D.track.removeEventListener("ended",C),D.track=g.track,D.track.addEventListener("ended",C)):G.data.sei&&D.onSei&&D.onSei(G.data.sei)},D.worker=w}function C(){if(g.track){if(this.id!==g.track.id)return;g.track.removeEventListener("ended",C)}(function(w){const P=Op.get(w);if(P){Op.delete(w);try{var L,G;(L=P.controller)===null||L===void 0||L.terminate(),(G=P.worker)===null||G===void 0||G.terminate()}catch(W){y.warning(W&&W.message)}}})(g)}Op.set(g,D),g.track.addEventListener("ended",C)}(u.receiver,{onSei:g=>{var v;(v=e._videoTrack)===null||v===void 0||v._onSei(g)}}):t==we.AUDIO&&await async function(g){if(!pt().supportWebRTCEncodedTransform)return void y.warning("browser not support audio encoded transform");if(GE.has(g))return;const v={track:g.track};if(rc()){if(!g.createEncodedStreams)return void y.warning("browser not support createEncodedStreams() API");let C=null;try{C=g.createEncodedStreams()}catch(P){return void y.error("create audio-encoded-streams error",P&&P.message)}const w=new TransformStream({transform(P,L){v.controller||(v.controller=L),g.track&&g.track.id!==v.track.id&&(y.debug("audio track changed: ".concat(v.track.id," => ").concat(g.track.id)),v.track.removeEventListener("ended",D),v.track=g.track,v.track.addEventListener("ended",D)),L.enqueue(P)}});C.readable.pipeThrough(w).pipeTo(C.writable)}else if(ni()){if(typeof RTCRtpScriptTransform>"u")return void y.warning("browser not support RTCRtpScriptTransform");const C=FE(),w=new MessageChannel;await new ve(L=>C.onmessage=G=>{G.data==="registered"&&L(void 0)});const P=new RTCRtpScriptTransform(C,{name:"rx",port:w.port2},[w.port2]);g.transform=P,await new ve(L=>C.onmessage=G=>{G.data==="started"&&L(void 0)}),w.port1.onmessage=L=>{var G;L.data.transformed&&g.track&&((G=g.track)===null||G===void 0?void 0:G.id)!==v.track.id&&(y.debug("audio track changed: ".concat(v.track.id," => ").concat(g.track.id)),v.track.removeEventListener("ended",D),v.track=g.track,v.track.addEventListener("ended",D))},v.worker=C}function D(){g.track.removeEventListener("ended",D),function(C){const w=GE.get(C);if(w){GE.delete(C);try{var P,L;(P=w.controller)===null||P===void 0||P.terminate(),(L=w.worker)===null||L===void 0||L.terminate()}catch(G){y.warning(G&&G.message)}}}(g)}GE.set(g,v),g.track.addEventListener("ended",D)}(u.receiver));const m=this.remoteUserMap.get(e);m?m.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(g=>{let{user:v,kind:D}=g;return v.uid===e.uid&&t===D});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Be.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Rt.Connected)throw new te(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(r=>{var s;let{user:o,mediaType:c}=r;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))});const t=[],n=new Map;e.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);s?n.set(r.ssrcId,s):t.push(r)});const i=await this.connection.batchReceive(t.map(r=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:u}=r;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:u}],mslabel:String(s._uintid)}}));t.forEach((r,s)=>{n.set(r.ssrcId,i[s])}),e.forEach(r=>{let{user:s,mediaType:o,ssrcId:c}=r;const u=n.get(c);if(!u)return void y.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(c));const{track:p,id:m,transceiver:_}=u;o===we.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(p):(s._audioTrack=new uu(p,s.uid,s._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),_&&s._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(p):(s._videoTrack=new du(p,s.uid,s._uintid,this.store),y.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),_&&s._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(s,s._videoTrack));const g=this.remoteUserMap.get(s);g?g.set(o,m):this.remoteUserMap.set(s,new Map([[o,m]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(D=>{let{user:C,kind:w}=D;return C.uid===s.uid&&o===w});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Be.MediaReconnectEnd,s.uid))})}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:u}=o;return t!==void 0?c.uid===e.uid&&t===u:c.uid===e.uid});if(i.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===Rt.Connected||n||i.forEach(o=>{let{kind:c}=o;var u;if(c===we.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(c===we.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Rt.Connected)return;const r=this.filterTobeUnSubscribedTracks(e,t);if(r.length===0)return;await this.connection.stopReceiving(r.map(o=>{let[,{id:c}]=o;return c}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(o=>{let[c,{kind:u}]=o;var p,m;if(u===we.VIDEO&&c._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),u===we.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0);else if(u===we.AUDIO){var _;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((_=c._audioTrack)===null||_===void 0||_._destroy(),c._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(r=>r.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:r,mediaType:s}of e){const o=this.pendingRemoteTracks.filter(c=>{let{user:u,kind:p}=c;return s!==void 0?u.uid===r.uid&&s===p:u.uid===r.uid});o.forEach(c=>{const u=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(o)}if(!this.connection||this.state!==Rt.Connected)return void t.forEach(r=>{let{user:s,kind:o}=r;var c;if(o===we.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===we.VIDEO){var u;(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0}});const n=yr(e).call(e,(r,s)=>{let{user:o,mediaType:c}=s;const u=this.filterTobeUnSubscribedTracks(o,c);return r.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:o}]=r;var c,u;if(o===we.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===we.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0;else if(o===we.AUDIO){var p;this.unbindRemoteTrackEvents(s._audioTrack),(p=s._audioTrack)===null||p===void 0||p._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==Rt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void y.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===we.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||y.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof xn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ce.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===ce.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ce.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,r){if(e){const o=this.localTrackMap.get(ce.LocalAudioTrack),c=i?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);Pe.publish(this.store.sessionId,{eventElapse:pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:c==null?void 0:c.track.getTrackLabel(),screenshare:(c==null?void 0:c.track._hints.indexOf(Vt.SCREEN_TRACK))!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const o=n.find(u=>u instanceof ln),c=i?(s=this.localTrackMap.get(ce.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(u=>u instanceof Yt);Pe.publish(this.store.sessionId,{eventElapse:pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o==null?void 0:o.getTrackLabel(),videoName:c==null?void 0:c.getTrackLabel(),screenshare:(c==null?void 0:c._hints.indexOf(Vt.SCREEN_TRACK))!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===we.VIDEO?n._videoSSRC:n._audioSSRC;r&&Pe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===we.VIDEO,audio:i===we.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:pi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){y.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ui("P2PChannel-mutex",this.store.clientId),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Up({},this.store):new eo({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Rt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Yt||t&&t.track instanceof ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(br(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Zh(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(y.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,V("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Up({},this.store):new eo({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ce.LocalVideoTrack:ge(t=i._hints).call(t,Vt.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ce.LocalAudioTrack:i instanceof xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ce.LocalVideoLowTrack:}}),this.emit(Be.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(br(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Be.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(br(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),y.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((e instanceof gc?e.uid:e)===i.uid&&r===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof gc?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Hr(function*(){if(!t.connection||t.state!==Rt.Connected)return;const n=yield ct(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield ct(t.connection.restartICE(e));const s=yield ct(i.next());if(s.done)return;const o=s.value,c=yield o;switch(t.reportPCDisconnectedOrFailed(e),e){case hr.TCP:t._pcStatsUploadType=fa.TCP_RESTART;break;case hr.RELAY:t._pcStatsUploadType=fa.RELAY_RESTART;break;default:t._pcStatsUploadType=fa.OLD_RESTART}t._isInRestartIce=!0,i.next(c)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalAudioTrack),i=e.videoSend.find(v=>v.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),r=e.audioSend.find(v=>v.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=Wr(this,Be.NeedSignalRTT),o=i?i.rttMs:void 0,c=r?r.rttMs:void 0,u=o&&c?(o+c)/2:o||c,p=(u&&s?(u+s)/2:u||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,_=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,g=t==null?void 0:t.track;if(g&&g._encoderConfig&&g._hints.indexOf(Vt.SCREEN_TRACK)===-1){const v=g._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(v&&D){const C=(1e3*v-D)/(1e3*v);return bD[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===r),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const u=Wr(this,Be.NeedSignalRTT),p=e.rtt,m=(p&&u?(p+u)/2:p||u)||0,_=o?o.jitterMs:void 0,g=e.recvPacketLossRate;let v=.7*g*100/50+.3*m/1500;_&&(v=.6*g*100/50+.2*m/1500+.2*_/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(y.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Rt.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(!i)return;const r=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:r}]),this.bindLocalTrackEvents([{track:t,type:r}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const s=i[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===ce.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding){const s=this.localTrackMap.get(ce.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new ve((c,u)=>{this.handleReplaceTrack(s.track,c,u,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],r=this.getAllTracks();e=Fd(e=e.filter(u=>r.indexOf(u)===-1));let s,o=!1;const c=this.localTrackMap.get(ce.LocalAudioTrack);for(const u of e){if(u instanceof Yt&&(this.localTrackMap.has(ce.LocalVideoTrack)||o?new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:ce.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(u,n);i.push({track:p,type:ce.LocalVideoLowTrack})}if(u instanceof ln)if(c){const p=c.track;if(p instanceof xn)uC([u]),p.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const m=hC([p,u]);y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else s instanceof xn?(uC([u]),s.addAudioTrack(u)):s||!u._useAudioElement&&pt().webAudioMediaStreamDest&&!u._bypassWebAudio?s=hC(s?[u,s]:[u]):s=u}return s&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:ce.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Fd(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof ln){const r=this.localTrackMap.get(ce.LocalAudioTrack);if(!r)continue;r.track instanceof xn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,r]),r.track.close())):t.push([ce.LocalAudioTrack,r])}if(i instanceof Yt){const r=this.localTrackMap.get(ce.LocalVideoTrack);if(!r)continue;t.push([ce.LocalVideoTrack,r]);const s=this.localTrackMap.get(ce.LocalVideoLowTrack);s&&t.push([ce.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Fd(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Fd(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ce.LocalVideoTrack:n.addListener(Ce.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ce.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof xn?e.trackList.forEach(n=>{n.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ce.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ce.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ce.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ce.LocalVideoTrack:n.off(Ce.GET_STATS,this.handleGetLocalVideoStats),n.off(Ce.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ce.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ce.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof xn?e.trackList.forEach(t=>{t.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ce.GET_STATS,this.handleGetLocalAudioStats),t.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ce.GET_STATS,this.handleGetLocalAudioStats),e.off(Ce.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ce.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ce.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ce.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ce.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ce.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof du&&t.addListener(Ce.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof uu&&t.addListener(Ce.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ce.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(we.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(we.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let s,o,{track:c,type:u}=n;switch(u){case ce.LocalAudioTrack:s=yt.Audio,o={dtx:c instanceof VE&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ce.LocalVideoTrack:s=ge(r=c._hints).call(r,Vt.SCREEN_TRACK)?yt.Screen:yt.High,o=Lo(Lo({},HD(c)),{},{codec:this.store.codec,svc_mode:Yb()});break;case ce.LocalVideoLowTrack:s=yt.Low,o=Lo(Lo({},HD(c)),{},{codec:this.store.codec,svc_mode:Yb()})}return{stream_type:s,attributes:o,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Be.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),V("NEW_ICE_RESTART")){var n;if(ge(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=o=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(y.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(o)),Wr(this,Be.QueryClientConnectionState)==="CONNECTED"&&this.emit(Be.RequestRestartICE,o))},r=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),y.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=V("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&pt().supportPCSetConfiguration)i(hr.RELAY),this._restartTimer=window.setTimeout(r,s);else if(on())i(hr.UDP),this._restartTimer=window.setTimeout(r,4e3);else{if(i(hr.TCP),pt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{i(hr.RELAY),this._restartTimer=window.setTimeout(r,s)},s));this._restartTimer=window.setTimeout(r,s)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&V("ICE_RESTART")&&Wr(this,Be.QueryClientConnectionState)==="CONNECTED"&&this.emit(Be.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(y.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Pe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:an.TRACER}).onSuccess(),this.emit(Be.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(su.FIRST_FRAME_DECODED),Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_AUDIO_DECODE,rn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===t);i&&Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_AUDIO_RECEIVED,rn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(br(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===t);i&&Pe.firstRemoteFrame(this.store.sessionId,Jn.FIRST_VIDEO_RECEIVED,rn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Be.ConnectionTypeChange,i),y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(uc(n))," -> ").concat(JSON.stringify(uc(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{y.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(uc(n))," -> ").concat(JSON.stringify(uc(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Lo(Lo({},t),n)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof ln&&(n==null?void 0:n.track)instanceof xn)return n.track.isActive||t.push([ce.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(i&&(t.push(i),i[0]===ce.LocalVideoTrack)){const r=this.localTrackMap.get(ce.LocalVideoLowTrack);r&&t.push([ce.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof ln&&(n==null?void 0:n.track)instanceof xn)return n.track.isActive&&t.push([ce.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return e===s});if(i)if(i[0]===ce.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(ce.LocalVideoLowTrack);r&&t.push([ce.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:s,ssrcs:o,id:c}]=t;switch(r){case ce.LocalAudioTrack:i=yt.Audio;break;case ce.LocalVideoTrack:i=ge(n=s._hints).call(n,Vt.SCREEN_TRACK)?yt.Screen:yt.High;break;case ce.LocalVideoLowTrack:i=yt.Low}return{stream_type:i,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,o]=r;n.push([e,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(e))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case we.VIDEO:return void(i._videoSSRC&&t.push({stream_type:we.VIDEO,ssrcId:i._videoSSRC}));case we.AUDIO:return void(i._audioSSRC&&t.push({stream_type:we.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:r}]=n;if(t.has(i)){let s=t.get(i);r===we.VIDEO?s|=Fn.Video:s|=Fn.Audio,t.set(i,s)}else r===we.VIDEO?t.set(i,Fn.Video):t.set(i,Fn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((i,r)=>{var s;let{stream_type:o}=i;const c=(s=t.find(u=>{let{stream_type:p}=u;return o===p}))===null||s===void 0?void 0:s.attributes;if(c&&V("DISABLE_SCREEN_SHARE_REMB")){const u=n[r]._hints;(ge(u).call(u,Vt.SCREEN_TRACK)||ge(u).call(u,Vt.SCREEN_LOW_TRACK))&&(c.remb=!1,y.debug("disable remb for screen share, hints:",u))}return c})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof ln){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(s=>{let[,{id:o}]=s;return o})));const r=this.createUnmuteMessage(i);return void await Lt(this,Be.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Be.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Be.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $n(HR(this.dtlsFailedCount,On)),this.emit(Be.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ri(this,Be.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Be.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Yt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Yt).length>1)throw new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ln).length>1&&(e.some(t=>t instanceof ln&&t._bypassWebAudio)||!pt().webAudioMediaStreamDest))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Yt&&this.pendingLocalTracks.some(n=>n instanceof Yt))throw new te(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ln&&this.pendingLocalTracks.some(n=>n instanceof ln)&&(!pt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof ln&&n._bypassWebAudio)))throw new te(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&pt().supportDualStreamEncoding,r=Lo(Lo({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=i?e._mediaStreamTrack.clone():dC(e,r);const o=jt(8,"track-low-"),c=new Yt(s,Lo(Lo({},i&&{scaleResolutionDownBy:lb(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return c.on(pl.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,iu.LOW_STREAM)}),c._hints.push(Vt.LOW_STREAM),ge(n=e._hints).call(n,Vt.SCREEN_TRACK)&&c._hints.push(Vt.SCREEN_LOW_TRACK),e.on("sei-to-send",u=>{c.emit("sei-to-send",u)}),e.addListener(Ce.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof eo){var r,s,o,c;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:_}=this.connection,{local:g,remote:v}=await this.connection.getSelectedCandidatePair();Pe.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:p,dtlsstate:m,connectionstate:_,intSucc:t?1:2,error:i,selectedLocalCandidateProtocol:(r=g==null?void 0:g.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=g.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(g.address,":").concat(g.port),selectedRemoteCandidateProtocol:(o=v.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=v.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(v.address,":").concat(v.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,n,i){var r;const s=Array.from(br(r=this.remoteUserMap).call(r)).find(o=>o._videoSSRC===e);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(u=>u.userId===s.uid&&u.type==="video");Pe.firstRemoteVideoDecode(this.store.sessionId,Jn.FIRST_VIDEO_DECODE,rn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:pi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(c==null?void 0:c.subscribeEnd)||0,subscriberStart:(c==null?void 0:c.subscribeStart)||0,videoAddNotify:(c==null?void 0:c.streamAdded)||0,state:i?1:0,firstFrame:(c==null?void 0:c.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const r=i.get(t);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ce.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,iu.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof eo&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===fa.TCP_RESTART&&e===hr.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,fa.DISCONNECTED_OR_FAILED)))}},Ae(et.prototype,"startP2PConnection",[bi],Object.getOwnPropertyDescriptor(et.prototype,"startP2PConnection"),et.prototype),Ae(et.prototype,"connect",[bi],Object.getOwnPropertyDescriptor(et.prototype,"connect"),et.prototype),Ae(et.prototype,"updateRemoteRTPCapabilities",[bi],Object.getOwnPropertyDescriptor(et.prototype,"updateRemoteRTPCapabilities"),et.prototype),Ae(et.prototype,"publishDataChannel",[bi],Object.getOwnPropertyDescriptor(et.prototype,"publishDataChannel"),et.prototype),Ae(et.prototype,"unpublish",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unpublish"),et.prototype),Ae(et.prototype,"unpublishDataChannel",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unpublishDataChannel"),et.prototype),Ae(et.prototype,"unpublishLowStream",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unpublishLowStream"),et.prototype),Ae(et.prototype,"subscribeDataChannel",[bi],Object.getOwnPropertyDescriptor(et.prototype,"subscribeDataChannel"),et.prototype),Ae(et.prototype,"subscribe",[bi],Object.getOwnPropertyDescriptor(et.prototype,"subscribe"),et.prototype),Ae(et.prototype,"massSubscribe",[bi],Object.getOwnPropertyDescriptor(et.prototype,"massSubscribe"),et.prototype),Ae(et.prototype,"unsubscribe",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unsubscribe"),et.prototype),Ae(et.prototype,"unsubscribeDataChannel",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unsubscribeDataChannel"),et.prototype),Ae(et.prototype,"massUnsubscribe",[bi],Object.getOwnPropertyDescriptor(et.prototype,"massUnsubscribe"),et.prototype),Ae(et.prototype,"muteRemote",[bi],Object.getOwnPropertyDescriptor(et.prototype,"muteRemote"),et.prototype),Ae(et.prototype,"unmuteRemote",[bi],Object.getOwnPropertyDescriptor(et.prototype,"unmuteRemote"),et.prototype),Ae(et.prototype,"hasRemoteMediaWithLock",[bi],Object.getOwnPropertyDescriptor(et.prototype,"hasRemoteMediaWithLock"),et.prototype),Ae(et.prototype,"disconnectForReconnect",[bi],Object.getOwnPropertyDescriptor(et.prototype,"disconnectForReconnect"),et.prototype),Ae(et.prototype,"updateBitrateLimit",[bi],Object.getOwnPropertyDescriptor(et.prototype,"updateBitrateLimit"),et.prototype),Ae(et.prototype,"remoteMediaSsrcChanged",[bi],Object.getOwnPropertyDescriptor(et.prototype,"remoteMediaSsrcChanged"),et.prototype),et);function bi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return await i.apply(this,c)}finally{s()}},n}const Zk={};function Fp(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&y.debug("install service ".concat(e.name)),Zk[e.name]=e}function Bp(e){const t=Zk[e];if(!t)throw new te(k.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function ex(e,t){return Bp("DataStream").create(e,t)}function tx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function nx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tx(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tx(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const A7=Date.now(),I7=20,fC=new Map,ag=new Map;async function ix(e){const t=fC.get(e),n=Array.isArray(t)&&t[t.length-1],i=ag.get(e);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,o=s-(Date.now()-i.firstRecvTs);o>0&&(i.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),rx(n.context,r),c=0):c=Math.min(c,I7),setTimeout(()=>t.length&&ix(e),c)}function rx(e,t){e.safeEmit(st.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function O7(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return rx(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),r=fC.get(i)||[],s=r.findIndex(p=>e.sendTs>=p.sendTs),o=nx(nx({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?r.push(o):r.splice(s,0,o),fC.set(i,r);let c=!1;var u;ag.has(i)?c=!((u=ag.get(i))===null||u===void 0||!u.isSyncing):ag.set(i,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||ix(i)}const N7=ut().name;function sx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function ox(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sx(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sx(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Su="websdk_ng_cache_parameter",D7=V("MAX_PRELOAD_ASYNC_LENGTH"),P7=1e4,yl=new Map,Rl=[];let mC=null,_C=0,EC=0;const cg=new Map,L7=function(e,t){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<t?r():i--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new ve(async(u,p)=>{n.push(async()=>{try{const m=await e(...o);u(m)}catch(m){p(m)}}),i<t&&(i++,r())})}}(ax,D7),gC=Bi.CancelToken.source();async function ax(e,t,n,i,r,s){try{if(!V("ENABLE_PRELOAD"))return;if(!pt().supportWebCrypto)return void oc(()=>{y.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new te(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&qn(n,"token",1,2047),qn(e,"appid",1,2047),vE(t),i&&yE(i);const o=Bd();y.debug("preload channel ".concat(t,", uid is ").concat(i));const c={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:o,proxyServer:r};let u,p;typeof i=="string"?(c.stringUid=i,[p,u]=await ve.all([s7(i,{sid:o,appId:e},gC.token),ZL(ox(ox({},c),{},{token:n||e,uid:0}),gC.token)]),c.uid=p.uid,u.gatewayInfo.uid=c.uid,u.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),u=await ZL(c,gC.token));const m={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||i,intUid:c.uid||u.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:p,ap:u};await async function(_){let g;try{_.uid&&lx({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});const v=px(_),D=await async function(w,P){try{const L=await window.crypto.subtle.importKey("raw",aD(P),"AES-GCM",!1,["encrypt"]),G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},L,ol(window.btoa(JSON.stringify(w))));return ac(new Uint8Array(G))}catch{return}}(_,_.token||_.appId);if(!D)return;g=hx(Su);const C=g?JSON.parse(g):[];C.push({[v]:D}),C.length>V("AP_CACHE_NUM")&&C.shift(),lg(Su,JSON.stringify(C))}catch(v){y.warn("Error caching server parameters:",v.message),lg(Su,"")}}(m),_C++}catch(o){throw EC++,function(c){mC||(mC=window.setTimeout(()=>{let p="";cg.forEach((m,_)=>{p+="".concat(_,": ").concat(m," ;")}),Pe.reportApiInvoke(null,{name:Ln.PRELOAD,options:{success:_C,failed:EC,err:p}}).onError(c),_C=0,EC=0,cg.clear(),mC=null},P7));const u=cg.get(c.code)||0;cg.set(c.code,u+1)}(o),o}}async function cx(e){try{if(V("AP_REQUEST_DETAIL"))return;const t=lx(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",aD(r),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,ol(i));return JSON.parse(window.atob(ac(new Uint8Array(o))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<V("AP_CACHE_LIFETIME"))return n}catch(t){y.warn("Error get preloadInfo",t.message)}}function lx(e){let t;try{if(t=hx(Su),!t)return;const n=JSON.parse(t),i=px(e),r=function(o,c){for(let u=o.length-1;u>=0;u--)if(c(o[u]))return u;return-1}(n,o=>i in o);if(r===-1)return;const s=n.splice(r,1)[0];return lg(Su,JSON.stringify(n)),s[i]}catch(n){y.warn("Error delete preload info: ".concat(t),n.message),lg(Su,"")}}function SC(e){if(e){let t=yl.get(e);t&&(window.clearTimeout(t),t=null,yl.delete(e)),ge(Rl).call(Rl,e)||e.cloudProxyServer!=="disabled"||Rl.push(e)}if(yl.size<V("AP_CACHE_NUM")&&Rl.length>0){const t=Rl.shift();yl.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:o,proxyServer:c}=t;try{await L7(n,i,r,o,c,s),yl.has(t)&&SC(t)}catch(u){y.warn("update preload failed",u.message),dx(t)}},V("AP_UPDATE_INTERVAL")))}}function dx(e){const t=Rl.indexOf(e);t!==-1&&Rl.splice(t,1);let n=yl.get(e);n&&(window.clearTimeout(n),n=null,yl.delete(e),SC())}function ux(e,t){const n=e.sua,i=e.ap;t&&n&&Pe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Pe.reportResourceTiming(e.ap.url,e.sid),Pe.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[vn.CHOOSE_SERVER,vn.CLOUD_PROXY_FALLBACK].toString()}),Pe.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function hx(e){return window.atob(window.localStorage.getItem(e)||"")}function lg(e,t){window.localStorage.setItem(e,window.btoa(t))}function px(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),fD(t)}function k7(e){let t=function(){const n=U7.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(bn(i,10),Tc(i,r));let s=n.cid;s!==void 0&&(bn(i,16),bn(i,s));let o=n.cname;o!==void 0&&(bn(i,26),Tc(i,o));let c=n.deviceId;c!==void 0&&(bn(i,34),Tc(i,c));let u=n.elapse;u!==void 0&&(bn(i,40),vc(i,u));let p=n.fileSize;p!==void 0&&(bn(i,48),vc(i,Tu(p)));let m=n.height;m!==void 0&&(bn(i,56),vc(i,Tu(m)));let _=n.jpg;_!==void 0&&(bn(i,66),bn(i,_.length),mx(i,_));let g=n.networkType;g!==void 0&&(bn(i,72),vc(i,Tu(g)));let v=n.osType;v!==void 0&&(bn(i,80),vc(i,Tu(v)));let D=n.requestId;D!==void 0&&(bn(i,90),Tc(i,D));let C=n.sdkVersion;C!==void 0&&(bn(i,98),Tc(i,C));let w=n.sequence;w!==void 0&&(bn(i,104),vc(i,Tu(w)));let P=n.sid;P!==void 0&&(bn(i,114),Tc(i,P));let L=n.timestamp;L!==void 0&&(bn(i,120),vc(i,L));let G=n.uid;G!==void 0&&(bn(i,128),bn(i,G));let W=n.vid;W!==void 0&&(bn(i,136),bn(i,W));let K=n.width;K!==void 0&&(bn(i,144),vc(i,Tu(K)));let ee=n.service;ee!==void 0&&(bn(i,152),bn(i,ee));let ae=n.callbackData;ae!==void 0&&(bn(i,162),bn(i,ae.length),mx(i,ae));let fe=n.ticket;fe!==void 0&&(bn(i,170),Tc(i,fe));let de=n.vendorConfigs;de!==void 0&&(bn(i,178),Tc(i,de))}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}function x7(e){return function(n){let i={};e:for(;!j7(n);){let r=Gp(n);switch(r>>>3){case 0:break e;case 1:i.code=Gp(n);break;case 2:i.msg=_x(n,Gp(n));break;case 3:i.requestId=_x(n,Gp(n));break;case 4:i.timestamp=V7(n,!1);break;default:M7(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function M7(e,t){switch(t){case 0:for(;128&bs(e););break;case 2:TC(e,Gp(e));break;case 5:TC(e,4);break;case 1:TC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Tu(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let U7=[];function TC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function j7(e){return e.offset>=e.limit}function dg(e,t){let n=e.bytes,i=e.offset,r=e.limit,s=i+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>r&&(e.limit=s),i}function fx(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function mx(e,t){let n=dg(e,t.length);e.bytes.set(t,n)}function _x(e,t){let n=fx(e,t),i=String.fromCharCode,r=e.bytes,s="�",o="";for(let c=0;c<t;c++){let u,p,m,_,g=r[c+n];128&g?(224&g)==192?c+1>=t?o+=s:(u=r[c+n+1],(192&u)!=128?o+=s:(_=(31&g)<<6|63&u,_<128?o+=s:(o+=i(_),c++))):(240&g)==224?c+2>=t?o+=s:(u=r[c+n+1],p=r[c+n+2],(49344&(u|p<<8))!=32896?o+=s:(_=(15&g)<<12|(63&u)<<6|63&p,_<2048||_>=55296&&_<=57343?o+=s:(o+=i(_),c+=2))):(248&g)==240?c+3>=t?o+=s:(u=r[c+n+1],p=r[c+n+2],m=r[c+n+3],(12632256&(u|p<<8|m<<16))!=8421504?o+=s:(_=(7&g)<<18|(63&u)<<12|(63&p)<<6|63&m,_<65536||_>1114111?o+=s:(_-=65536,o+=i(55296+(_>>10),56320+(1023&_)),c+=3))):o+=s:o+=i(g)}return o}function Tc(e,t){let n=t.length,i=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}bn(e,i);let r=dg(e,i),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[r++]=c:(c<2048?s[r++]=c>>6&31|192:(c<65536?s[r++]=c>>12&15|224:(s[r++]=c>>18&7|240,s[r++]=c>>12&63|128),s[r++]=c>>6&63|128),s[r++]=63&c|128)}}function bs(e){return e.bytes[fx(e,1)]}function Ex(e,t){let n=dg(e,1);e.bytes[n]=t}function Gp(e){let t,n=0,i=0;do t=bs(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function bn(e,t){for(t>>>=0;t>=128;)Ex(e,127&t|128),t>>>=7;Ex(e,t)}function V7(e,t){let n,i=0,r=0,s=0;return n=bs(e),i=127&n,128&n&&(n=bs(e),i|=(127&n)<<7,128&n&&(n=bs(e),i|=(127&n)<<14,128&n&&(n=bs(e),i|=(127&n)<<21,128&n&&(n=bs(e),r=127&n,128&n&&(n=bs(e),r|=(127&n)<<7,128&n&&(n=bs(e),r|=(127&n)<<14,128&n&&(n=bs(e),r|=(127&n)<<21,128&n&&(n=bs(e),s=127&n,128&n&&(n=bs(e),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:t}}function vc(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,o=dg(e,s),c=e.bytes;switch(s){case 10:c[o+9]=r>>>7&1;case 9:c[o+8]=s!==9?128|r:127&r;case 8:c[o+7]=s!==8?i>>>21|128:i>>>21&127;case 7:c[o+6]=s!==7?i>>>14|128:i>>>14&127;case 6:c[o+5]=s!==6?i>>>7|128:i>>>7&127;case 5:c[o+4]=s!==5?128|i:127&i;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const gx={},Sx={},ug=4294967296,F7=ug*ug,Tx=F7/2;yx(0,!0);const vx=yx(0),B7=Hp(0,-2147483648,!1),G7=Hp(-1,2147483647,!1);function yx(e,t){let n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=Sx[e],i)?i:(n=Hp(e,0,!0),r&&(Sx[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=gx[e],i)?i:(n=Hp(e,e<0?-1:0,!1),r&&(gx[e]=n),n)}function Hp(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function H7(e,t){if(isNaN(e))return vx;{if(e<=-Tx)return B7;if(e+1>=Tx)return G7}return e<0?vx:Hp(e%ug|0,e/ug|0,t)}function Rx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class vC extends nn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(zs.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",zr.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Bi.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==zr.CONNECTED)throw new z(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===zr.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=jt(5,"image-moderation-"),this._workerMessageLengthLimit=V("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=V("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=V("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new vp("worker-"+this._moderationId,On),this.on(zs.STATE_CHANGE,(i,r)=>{y.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Kd[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(zs.STATE_CHANGE,Kd.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ve((r,s)=>{this.on(zs.CONNECTION_STATE_CHANGE,(o,c)=>{o===zr.CONNECTED&&r()}),this.requestAP(t,i,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),y.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===zr.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const r=V("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),s=await function(u,p,m,_){let{appId:g,areaCode:v,cname:D,sid:C,token:w,uid:P}=p;mu++;const L="moderation_plugin",G={service_name:L,json_body:JSON.stringify({appId:g,areaCode:v,cname:D,command:"allocateEdge",requestId:mu,seq:mu,sid:C,appToken:w,ts:Date.now(),uid:P+""})};let W,K,ee=u[0];return Ys(async()=>{W=Date.now();const ae=await Js(ee,{data:G,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-W,ae.code!==0){const Ne=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ae.code,{retry:!0,responseTime:K});throw y.error(Ne.toString()),Ne}const fe=JSON.parse(ae.json_body);if(fe.code!==200){const Ne=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(fe.code,", reason: ").concat(fe.reason),{code:fe.code,responseTime:K});throw y.error(Ne.toString()),Ne}if(!fe.servers||!Array.isArray(fe.servers)||fe.servers.length===0){const Ne=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:fe.code,responseTime:K});throw y.error(Ne.toString()),Ne}if(!fe.servers.some(Ne=>!!Ne.wss)){const Ne=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:fe.code,responseTime:K});throw y.error(Ne.toString()),Ne}const de=V("IMAGE_MODERATION_WORKER_HOST");return{addressList:fe.servers.map(Ne=>{let{address:tt,wss:Tt}=Ne;if(tt&&Tt)return"wss://".concat(tt.replace(/\./g,"-"),".").concat(de,":").concat(Tt,"/moderation")}).filter(Ne=>!!Ne),workerToken:fe.workerToken,vid:fe.vid,ticket:fe.appTicket,responseTime:K}},(ae,fe)=>(Pe.apworkerEvent(C,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(ae.addressList),firstSuccess:fe===0,responseTime:K,serverIp:u[fe%u.length]}),!1),(ae,fe)=>(Pe.apworkerEvent(C,{success:!1,sc:ae.data&&ae.data.code||200,serviceName:L,responseTime:K,serverIp:u[fe%u.length]}),!!(ae.code!==k.OPERATION_ABORTED&&ae.code!==k.UNEXPECTED_RESPONSE||ae.data&&ae.data.retry)&&(ee=u[(fe+1)%u.length],!0)),_)}(r,t,n,i);this.emit(zs.STATE_CHANGE,Kd.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(zs.STATE_CHANGE,Kd.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on($e.CONNECTED,async()=>{this.emit(zs.STATE_CHANGE,Kd.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=zr.CONNECTED}),this._workerConnection.on($e.CLOSED,()=>{this.connectionState=zr.CLOSED}),this._workerConnection.on($e.FAILED,()=>{this.connectionState=zr.CLOSED}),this._workerConnection.on($e.RECONNECTING,()=>{this.connectionState=this.connectionState===zr.CONNECTED?zr.RECONNECTING:zr.CONNECTING}),this._workerConnection.on($e.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=x7(new Uint8Array(t.data));V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,y.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Pe.reportApiInvoke(this._connectInfo.sid||null,{name:Ln.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:an.TRACER}).onError(new z(k.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},V("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else y.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on($e.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on($e.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Wr(this,zs.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&y.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:r,cid:s,vid:o,sid:c,uid:u}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await qP(m,i,r),g=this._sequence+"-"+s+"-"+u+"-"+p+"-"+jt(12,""),v={appId:i,cid:s,cname:r,deviceId:"",elapse:vC.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:_,networkType:6,osType:7,requestId:g,sdkVersion:"4.22.2",sequence:this._sequence,sid:c,timestamp:H7(p),uid:u,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete v.callbackData;const D=k7(v);if(D.byteLength<this._workerMessageLengthLimit){if(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const C=function(w){for(var P=1;P<arguments.length;P++){var L=arguments[P]!=null?arguments[P]:{};P%2?Rx(Object(L),!0).forEach(function(G){O(w,G,L[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(L)):Rx(Object(L)).forEach(function(G){Object.defineProperty(w,G,Object.getOwnPropertyDescriptor(L,G))})}return w}({},v);delete C.jpg,y.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return D}{const C=this.quality*this._qualityRatio;return this.quality=C,await this.generateRequestData(t,{appId:i,cname:r,cid:s,vid:o,sid:c,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=zr.CLOSED,this.emit(zs.STATE_CHANGE,Kd.CLOSED)}}function bx(e){if(Nt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new z(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new z(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const W7={name:"ImageModeration",create:function(e){let{config:t}=e;return bx(t),new vC(t)}};var Cx,wx,Ax,Ix,Ox,Nx,Dx,Px,Lx,kx,xx,Mx,Ux,jx,Vx,Fx,Bx,Gx,Hx,Wx,Kx,Yx,zx,qx,$x,Jx,Xx,Qx,Zx,eM,tM,nM,iM,rM,sM,oM,aM,cM,lM,dM,Re;function uM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Cs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uM(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}ui.setLogger(y);let K7=(Cx=Fe(),wx=Fe({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof au))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),Ax=Fe({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==ou.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),Ix=Fe({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),Ox=Fe({argsMap:(e,t,n)=>[t,n]}),Nx=Fe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),Dx=Fe({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),Px=Fe({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),Lx=Fe(),kx=Fe(),xx=Fe(),Mx=Fe(),Ux=Fe(),jx=Fe(),Vx=Fe(),Fx=Fe(),Bx=Fe(),Gx=Fe(),Hx=Fe(),Wx=Fe(),Kx=Fe(),Yx=Fe(),zx=Fe({argsMap:(e,t)=>[t]}),qx=Fe(),$x=Fe(),Jx=Fe(),Xx=Fe(),Qx=Fe(),Zx=Fe(),eM=Fe(),tM=Fe(),nM=Fe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),iM=Fe(),rM=Fe(),sM=Fe(),oM=Fe(),aM=Fe(),cM=Fe(),lM=Fe({reportResult:!0}),dM=Fe(),Re=class extends nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",Bi.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_handleLocalTrackEnable",(i,r,s)=>{this.publish(i,!1).then(r).catch(s)}),O(this,"_handleLocalTrackDisable",(i,r,s)=>{this.unpublish(i).then(r).catch(s)}),O(this,"_handleUserOnline",i=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(i.uid,this.channelName))return void y.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&y.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(s=>s.uid===i.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(st.USER_JOINED,r));else{const s=new gc(i.uid,i.uint_id||i.uid);this._users.push(s),y.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(st.USER_JOINED,s)}}),O(this,"_handleUserOffline",i=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(i.uid,this.channelName))return;const r=this._users.find(s=>s.uid===i.uid);r&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:pE(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),y.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(st.USER_LEAVED,r,i.reason))}),O(this,"_handleAddAudioOrVideoStream",(i,r,s,o,c,u,p)=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(r,this.channelName))return;const m=this._users.find(g=>g.uid===r);if(!m)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(m.uid,i,void 0,void 0,void 0,Date.now());const _=i==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=c||r),i==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,i==="audio"?(m._audio_added_=!0,s!==void 0&&(m._audioSSRC=s),o!==void 0&&(m._cname=o),u&&(m._audioOrtc=u)):(m._video_added_=!0,s!==void 0&&(m._videoSSRC=s),o!==void 0&&(m._cname=o),p!==void 0&&(m._rtxSsrcId=p),u&&(m._videoOrtc=u)),(i==="audio"?m.hasAudio:m.hasVideo)&&!_&&(y.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(i)),this.safeEmit(st.USER_PUBLISHED,m,i)),i==="video"?Pe.onGatewayStream(this._sessionId,Jn.ON_ADD_VIDEO_STREAM,rn.ON_ADD_VIDEO_STREAM,{peer:c||r,ssrc:m._videoSSRC}):Pe.onGatewayStream(this._sessionId,Jn.ON_ADD_AUDIO_STREAM,rn.ON_ADD_AUDIO_STREAM,{peer:c||r,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,i,s).then(g=>{if(g&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof og))return this._p2pChannel.unsubscribe(m,i,!0).then(()=>this._subscribe(m,i,!0).catch(v=>{y.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,i)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,i,!0).catch(g=>{y.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),O(this,"_handleRemoveStream",i=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(i.uid,this.channelName))return;const r=this._users.find(o=>o.uid===i.uid);if(!r)return void y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));y.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let s=()=>{};r.hasAudio&&r.hasVideo?s=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(st.USER_UNPUBLISHED,r,"audio"),y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(st.USER_UNPUBLISHED,r,"video")}:r.hasVideo?s=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(st.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(s=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(st.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof og&&this._p2pChannel.unsubscribe(r).then(o=>{if(o)return this._gateway.unsubscribe(o,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),Pe.onGatewayStream(this._sessionId,Jn.ON_REMOVE_STREAM,rn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),s()}),O(this,"_handleSetStreamLocalEnable",(i,r,s)=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(r,this.channelName))return;const o=this._users.find(p=>p.uid===r);if(!o)return void y.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));y.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(s?"enabled":"disabled"," with uid ").concat(r));const c=i==="audio"?o.hasAudio:o.hasVideo;if(i==="audio"){o._trust_audio_enabled_state_=!0;const p=o._audio_enabled_;if(o._audio_enabled_=s,o._audio_enabled_===p)return;{const m=o._audio_enabled_?"enable-local-audio":"disable-local-audio";y.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(st.USER_INFO_UPDATED,r,m)}}else{o._trust_video_enabled_state_=!0;const p=o._video_enabled_;if(o._video_enabled_=s,o._video_enabled_===p)return;{const m=o._video_enabled_?"enable-local-video":"disable-local-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(st.USER_INFO_UPDATED,r,m)}}const u=i==="audio"?o.hasAudio:o.hasVideo;return c!==u?!c&&u?(y.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(st.USER_PUBLISHED,o,i)):(i==="video"&&o._videoTrack&&o._videoTrack._destroy(),i==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,i),y.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),void this.safeEmit(st.USER_UNPUBLISHED,o,i)):void 0}),O(this,"_handleMuteStream",(i,r,s)=>{if(V("BLOCK_LOCAL_CLIENT")&&ll(i,this.channelName))return;y.debug("[".concat(this._clientId,"] receive mute message"),i,r,s);const o=this._users.find(p=>p.uid===i);if(!o)return void y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const c=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_mute_state_=!0;const p=o._audio_muted_;if(o._audio_muted_=s,o._audio_muted_===p)return;{const m=o._audio_muted_?"mute-audio":"unmute-audio";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(st.USER_INFO_UPDATED,i,m)}}else{o._trust_video_mute_state_=!0;const p=o._video_muted_;if(o._video_muted_=s,o._video_muted_===p)return;{const m=o._video_muted_?"mute-video":"unmute-video";y.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(st.USER_INFO_UPDATED,i,m)}}const u=r==="audio"?o.hasAudio:o.hasVideo;if(c!==u){if(!c&&u)return(r==="audio"?o._audioSSRC:o._videoSSRC)?(y.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(st.USER_PUBLISHED,o,r)):void y.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),y.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),this.safeEmit(st.USER_UNPUBLISHED,o,r)}}),O(this,"_handleP2PLost",async i=>{y.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():y.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),O(this,"_handleTokenWillExpire",()=>{y.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(st.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),y.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(st.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(st.NETWORK_QUALITY,i)}),O(this,"_handleP2PAddAudioOrVideoStream",(i,r,s,o)=>{const c=this._users.find(p=>p.uid===r);if(!c)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));y.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(c.uid,i,void 0,void 0,void 0,Date.now());const u=i==="audio"?c.hasAudio:c.hasVideo;i==="audio"?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,i==="audio"?(c._audio_added_=!0,s!==void 0&&(c._audioSSRC=s),o!==void 0&&(c._audioMid=o)):(c._video_added_=!0,s!==void 0&&(c._videoSSRC=s),o!==void 0&&(c._videoMid=o)),(i==="audio"?c.hasAudio:c.hasVideo)&&!u&&(y.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(i)),this.safeEmit(st.USER_PUBLISHED,c,i)),this._p2pChannel.hasPendingRemoteMedia(c,i)&&(y.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,i,!0).catch(p=>{y.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=t||jt(5,"client-"),this.store=new RH(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new ui("client-leave",this._clientId),this._publishMutex=new ui("client-publish",this._clientId),this._renewTokenMutex=new ui("client-renewtoken",this._clientId),this._subscribeMutex=new ui("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),y.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Kr," build: ").concat(qR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{sD(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){y.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new Mp(this.store),this._statsCollector.onStatsException=(i,r,s)=>{y.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(r,", uid: ").concat(s)),this.safeEmit(st.EXCEPTION,{code:i,msg:r,uid:s})},this._statsCollector.onUploadPublishDuration=(i,r,s,o)=>{const c=this._users.find(u=>u.uid===i);c&&Pe.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:r,videoPublishDuration:s,peer:c._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Z3(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||On,httpRetryConfig:e.httpRetryConfig||On,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new l7(this._clientId),this.store.useP2P?(this._p2pChannel=new _r(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new og(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Dt("JOIN_GATEWAY_USE_443PORT_ONLY",s),Dt("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof ab&&(c.use443PortOnly=s,c.tryDoubleDomain=o),async function(u,p,m){aE.get(u)||aE.set(u,[]),cE.get(u)||cE.set(u,p),Ro.get(u)||Ro.set(u,0);const _=aE.get(u),g=cE.get(u);if(!_||!g)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ro.get(u)===g){const P=pp();_.push(P),await P.promise}Ro.set(u,Ro.get(u)+1);for(var v=arguments.length,D=new Array(v>3?v-3:0),C=3;C<v;C++)D[C-3]=arguments[C];const w=await m(...D);return Ro.set(u,Ro.get(u)-1),Ro.get(u)===g-1&&_.length>0&&(_[0].resolve(),_.shift()),Ro.get(u)===0&&(aE.set(u,[]),cE.set(u,0),Ro.set(u,0)),w}("client.join",V("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,r)}async join(e,t,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const o=(_E||_E||(_E=(window.location.protocol.split(":")[0]||"").toUpperCase(),_E))==="HTTPS",c=ED()?window.isSecureContext:"Browser Not Support";(!ED()&&!o||!window.isSecureContext)&&y.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),y.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Pe.setAppId(e);try{if(!n&&n!==null)throw new z(k.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&qn(n,"token",1,2047),qn(e,"appid",1,2047),vE(t),i&&yE(i),r&&qn(r,"optionalInfo",1,2047)}catch(C){throw Pe.reportApiInvoke(Bd(),{name:Ln.JOIN,options:[e,t,n,i],states:{isHttps:o,isSecureContext:c},tag:an.TRACER}).onError(C),C}if(this._leaveMutex.isLocked&&(y.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),y.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const C=new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Pe.reportApiInvoke(Bd(),{name:Ln.JOIN,options:[e,t,n,i],states:{isHttps:o,isSecureContext:c},tag:an.TRACER}).onError(C),C}this._gateway.state="CONNECTING";const u=await cx({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(u==null?void 0:u.sid)||Bd();y.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const m=Pe.reportApiInvoke(p,{id:this._clientId,name:Ln.JOIN,options:[e,t,n,i],states:{isHttps:o,isSecureContext:c},tag:an.TRACER}),_=Cs(Cs(Cs({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:V("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async C=>{const w=function(W){const K=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ee=new Uint8Array(new ArrayBuffer(K.length));for(let ae=0;ae<K.length;ae+=1)ee[ae]=K.charCodeAt(ae);return ee}(),P=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),L=VR(C),G=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},P,L);return function(W){let K="";for(let ee=0;ee<W.length;ee+=1)K+=String.fromCharCode(W[ee]);return window.btoa(K)}(new Uint8Array(G))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const C=new TextEncoder,w=V("USE_PURE_ENCRYPTION_MASTER_KEY")?C.encode(_.appId+this._encryptionSecret+this._encryptionSecret):C.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(P,L,G){const W=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),K=P==="aes-128-gcm2"?128:256,ee=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:SD,hash:"SHA-256",salt:G},W,K+bH);return new Uint8Array(ee).subarray(K/8)}(this._encryptionMode,w,ol(this._encryptionSalt)),this._encryptDataStreamKey=await async function(P,L,G){const W=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),K=P==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:SD,hash:"SHA-256",salt:G},W,{name:"AES-GCM",length:K},!0,["encrypt","decrypt"])}(this._encryptionMode,w,ol(this._encryptionSalt))}else c?y.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):y.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,y.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&Pe.joinChannelTimeout(this._sessionId,5)},5e3);try{var v;let C;const w=_.cloudProxyServer;if(ge(v=["proxy3","proxy4","proxy5"]).call(v,w)){const K=V("PROXY_SERVER_TYPE3");Array.isArray(K)?_.proxyServer=K[0]:_.proxyServer=K}if(Pe.setProxyServer(_.proxyServer),y.setProxyServer(_.proxyServer),this.store.requestAPStart(),u){if(y.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(u.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=u.intUid),C={gatewayInfo:u.ap.gatewayInfo},V("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)y.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const K=(await KD(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||si.tcpport,udpport:ee.udpport||si.udpport,username:ee.username||si.username,password:ee.password||si.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:K}}ux(u,_.stringUid)}else{if(_.stringUid&&!_.uid){let K;[K,C]=await ve.all([QL(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||On,this.store),XL(_,this._axiosCancelSource.token,this._config.httpRetryConfig||On,!0,this.store)]),y.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(K)),_.uid=K,C.gatewayInfo.uid=K,C.gatewayInfo.res.uid=K}else C=await XL(_,this._axiosCancelSource.token,this._config.httpRetryConfig||On,!0,this.store);if(!this._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(sb.UPDATE_BITRATE_LIMIT,K=>{this._p2pChannel.updateBitrateLimit(K)})},0),this._key=n||e;const P=C.gatewayInfo,L=_.uid?_.uid:P.uid;this._joinInfo=Cs(Cs({},_),{},{cid:P.cid,uid:L,vid:P.vid,apResponse:P.res,apGatewayAddress:P.apGatewayAddress,uni_lbs_ip:P.uni_lbs_ip,gatewayAddrs:P.gatewayAddrs}),this.store.intUid=L;const G=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(G),this._appId=e,this._channelName=_.cname,this._uid=G,this.store.uid=G,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ni()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const W=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return y.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(W)),setTimeout(()=>{y.startUpload()},5e3),this.store.joinEnd(),D=this,ge(cl).call(cl,D)||cl.push(D),this._cloudProxyServerMode==="disabled"&&pt().supportWebCrypto&&V("ENABLE_PRELOAD")&&SC(this._joinInfo),G}catch(C){const w=Array.isArray(C)?C[0]:C;throw w&&w.code===k.OPERATION_ABORTED?y.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w):y.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w),w.code!==k.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(w),w}var D}_joinGateway(){if(!this._joinInfo||!this._key)throw new z(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){y.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ni()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=cl.indexOf(t);n!==-1&&cl.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return y.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),y.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof au))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new z(k.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new z(k.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof au))throw new z(k.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new z(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}y.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof Yt&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),y.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw y.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(e){Nt(e.id,"id",0,65535,!0),da(e.ordered,"ordered"),qn(e.metadata,"metadata",0,512),y.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===e.id)!==-1)throw new z(k.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new z(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new z(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return ex(r,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new z(k.CREATE_DATACHANNEL_ERROR);try{await ve.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==k.DISCONNECT_P2P)throw r}}return y.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw y.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new z(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof au))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);y.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof _r){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(_n.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),y.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw y.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),y.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),y.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw y.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof gc)){const i=this.remoteUsers.find(r=>r.uid===e);if(!i)throw new z(k.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Un(t,"mediaType",["audio","video"]),this._p2pChannel instanceof _r)throw new z(k.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new z(k.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===we.AUDIO,i=t===we.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:u,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new z(k.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(g=>g.uid===e);m||(m=new gc(e,p||e),m._is_pre_created=!0,this._users.push(m)),u&&(m._cname=u),m._uintid||(m._uintid=p||e),n&&(m._audioSSRC=s,m._audio_pre_subscribed=!0,o&&(m._audioOrtc=o)),i&&(m._videoSSRC=s,m._video_pre_subscribed=!0,o&&(m._videoOrtc=o),c!=null&&(m._rtxSsrcId=c)),y.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(m,t,s,c,o);const _=n?m._audioTrack:m._videoTrack;if(!_)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),_}catch(s){throw y.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{r()}}async _subscribeDataChannel(e,t){var n;if(Nt(t,"channelId",0,65535,!0),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new z(k.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new z(k.INVALID_REMOTE_USER,"user is not published");const r=(n=e._dataChannels)===null||n===void 0?void 0:n.find(c=>c.id===t);if(!r)throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new z(k.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[r]);if(c&&ge(c).call(c,r.id))try{var o;if(typeof r._originDataChannelId!="number")throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new z(k.CREATE_DATACHANNEL_ERROR);const u={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(o=r.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await r._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),u;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(e,t,n){if(Un(t,"mediaType",["audio","video"]),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new z(k.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const r=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof _r&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{r()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof _r)return this._p2pSubscribe(e,t);if(Un(t,"mediaType",["audio","video"]),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new z(k.INVALID_REMOTE_USER,"user is not published");throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let r=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?we.AUDIO:we.VIDEO,ssrcId:r};const u=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==r&&(r=m,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?we.AUDIO:we.VIDEO,ssrcId:r}),pi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,c,!0)}catch(_){if((_==null?void 0:_.code)!==k.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}y.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{y.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw y.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{u()}}async massSubscribe(e){if(ua(e,"subscribeList"),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();y.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(c=>{let{user:u,mediaType:p}=c;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(p)}).join("; ")));const r=(e=[...e]).map(c=>{let{user:u,mediaType:p}=c;return{user:u,mediaType:p}}),s=await this._p2pChannel.globalLock();try{var o;for(let u=e.length-1;u>=0;u--){const p=e[u],{user:m,mediaType:_}=p;if(Un(_,"mediaType",["audio","video"]),!m){const C=new z(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===m)){const C=new z(k.INVALID_REMOTE_USER,"user is not in the channel");y.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),r[u].error=C,e.splice(u,1);continue}if(_==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||_==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const C=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);y.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(_,", remote user is not published")),r[u].error=C,e.splice(u,1);continue}const v=Fn.Video|Fn.LwoVideo,D=n.get(m);if(D){if(_==="video"?D&v:D&Fn.Audio){e.splice(u,1),y.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(_," twice"));continue}n.set(m,D|(_==="video"?v:Fn.Audio))}else n.set(m,_==="video"?v:Fn.Audio)}for(let u=e.length-1;u>=0;u--){const p=e[u],{user:m,mediaType:_}=p,g=Fn.Video|Fn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,_)){await this._p2pChannel.unmuteRemoteNoLock(m,_);const v=n.get(m);n.set(m,_==="video"?v^g:v^Fn.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);let c=yr(o=Array.from(n.entries())).call(o,(u,p)=>{let[m,_]=p;if(_===0)return u;const g={stream_id:m.uid,stream_type:_};return _&Fn.Audio&&(g.audio_ssrc=m._audioSSRC),_&Fn.Video&&(g.video_ssrc=m._videoSSRC),u.push(g),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:m,mediaType:_}=p;return{user:m,mediaType:_,ssrcId:_===we.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:_===we.VIDEO?m._rtxSsrcId:void 0}}));const u=new Map;if(c=c.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),c.length>0){const p=await this._gateway.subscribeAll(c,!0);((p==null?void 0:p.users)||[]).forEach(m=>{let{stream_id:_,video_error_code:g,audio_error_code:v,error_code:D}=m;(g||v||D)&&u.set(_,{video_error_code:g,audio_error_code:v,error_code:D})})}if(Array.from(u.entries()).length>0){const p=[];Array.from(u.entries()).forEach(m=>{let[_,g]=m;const v=this.remoteUsers.find(D=>D.uid===_);if(v){let D;g.error_code||g.video_error_code&&g.audio_error_code?D=void 0:g.video_error_code?D=we.VIDEO:g.audio_error_code&&(D=we.AUDIO),p.push({user:v,mediaType:D})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of r){const m=u.get(p.user.uid);if(m){const _=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(_){const g=Tp(_);y.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(g.desc)),p.error=new z(k.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(g.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(r.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),r.forEach(p=>{var m;Pe.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===we.VIDEO,audio:p.mediaType===we.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===we.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),y.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:m,mediaType:_}=p;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(_)}).join("; "))),r}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{s(),i()}}async unsubscribe(e,t,n){if(!(e instanceof gc)){const s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new z(k.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Un(t,"mediaType",["audio","video"]),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof _r)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&pE(this._users,e),y.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===k.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&Nt(t,"id",0,65535,!0),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===e)){const r=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}let i;if(typeof t=="number"){const r=e._dataChannels.find(s=>s.id===t);r&&(i=[r])}else i=e._dataChannels;if(i===void 0){const r=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw y.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}y.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(e,i);r&&await this._gateway.unsubscribeDataChannel(r,e.uid),y.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===k.DISCONNECT_P2P)return void y.warning("disconnecting p2p, abort unsubscribe request.");throw y.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(ua(e,"unsubscribeList"),!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");y.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:r}=e[n];if(!i){const c=new z(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw y.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(Un(r,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===i)){y.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const o=Fn.Video|Fn.LwoVideo;if(t.has(i)){const c=t.get(i);let u;switch(r){case"video":u=c&o;break;case"audio":u=c&Fn.Audio;break;default:u=c&(Fn.Audio|o)}if(u){y.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),e.splice(n,1);continue}r?r==="audio"?t.set(i,c|Fn.Audio):r==="video"&&t.set(i,c|o):t.set(i,c|Fn.Audio|o)}else r?r==="audio"?t.set(i,Fn.Audio):r==="video"&&t.set(i,o):t.set(i,Fn.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),y.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===k.DISCONNECT_P2P)return void y.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw y.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new te(k.INVALID_PARAMS);tn(n.width)||UR(n.width,"streamParameter.width"),tn(n.height)||UR(n.height,"streamParameter.height"),tn(n.framerate)||UR(n.framerate,"streamParameter.framerate"),tn(n.bitrate)||Nt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&y.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),y.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ce.LocalVideoLowTrack)}async enableDualStream(){if(!pt().supportDualStream)throw Pe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new z(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new z(k.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Pe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Pe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),y.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ce.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Pe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Pe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),y.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){Un(n,"role",["audience","host"])}(e),t&&sD(t),this.mode==="rtc"||this.mode==="p2p")throw y.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new z(k.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new z(k.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new z(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,y.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new z(k.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Pe.setProxyServer(this._proxyServer),y.setProxyServer(this._proxyServer),y.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new z(k.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy")}if(hE(e))return this._turnServer={servers:e,mode:"original-manual"},void y.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>rD(n)),this._turnServer={servers:e,mode:"manual"},y.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new z(k.INVALID_OPERATION,"you should set license before join channel");if(qn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new z(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,y.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new z(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new z(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new z(k.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new z(k.INVALID_OPERATION,"Stop proxy server after leave channel");Pe.setProxyServer(),y.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",y.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new z(k.INVALID_PARAMS,"accessPoints is required.");ua(e.accessPoints.serverList,"accessPoints.serverList"),qn(e.accessPoints.domain,"accessPoints.domain");const t=(g,v)=>{Nt(g,v,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(Dt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Dt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=e.accessPoints.domain,s=e.accessPoints.serverList.map(g=>i.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(r):g),o=s.map(g=>"".concat(g,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Dt("WEBCS_DOMAIN",o),Dt("WEBCS_DOMAIN_BACKUP_LIST",o),Dt("GATEWAY_DOMAINS",[r]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ua(e.report.hostname,"report.hostname"),Dt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Dt("EVENT_REPORT_DOMAIN",s[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),Dt("STATS_COLLECTOR_PORT",c),e.report?Dt("ENABLE_EVENT_REPORT",!0):Dt("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ua(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=s[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),Dt("LOG_UPLOAD_SERVER","".concat(u,":").concat(p));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ua(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=s;let _=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),_=e.cds.port),Dt("CDS_AP",m.map(g=>"".concat(g,":").concat(_))),e.cds?Dt("ENABLE_CONFIG_DISTRIBUTE",!0):Dt("ENABLE_CONFIG_DISTRIBUTE",!1),y.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ua(e,"serverList"),qn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Dt("WEBCS_DOMAIN",e),Dt("WEBCS_DOMAIN_BACKUP_LIST",e),Dt("GATEWAY_DOMAINS",[t]),Dt("EVENT_REPORT_DOMAIN",e[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Dt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),y.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Un(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw y.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else y.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Un(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw y.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}y.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Un(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw y.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}y.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(s){Un(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qn(t,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(ge(r).call(r,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new z(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new z(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(da(i,"encryptDataStream"),!ge(r).call(r,e))throw new z(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||y.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ac(n))}async renewToken(e){if(qn(e,"token",1,2047),!this._key||!this._joinInfo)throw new z(k.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){y.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await c7(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||On);y.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else y.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});y.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,y.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?y.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(st.VOLUME_INDICATOR,e)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new z(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new z(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new z(k.LIVE_STREAMING_TASK_CONFLICT);const n=t?ha.TRANSCODE:ha.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(ha.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new z(k.INVALID_PARAMS,"can not find live streaming url to stop");await ve.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){Vk(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Vk(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new z(k.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const r=new TextEncoder;e.payload=r.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ge(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(r,s,o){var c;const u=yr(c=Array.from(o)).call(c,(C,w)=>C+w,0),p={serverTs:0,seq:CH++,length:o.length,checkSum:u},m=new Uint8Array(pD(u,2)),_=new ArrayBuffer(Hd),g=new DataView(_);g.setUint32(0,p.serverTs),g.setUint16(4,p.seq),g.setUint16(6,p.length),g.setUint16(8,p.checkSum);const v=16-o.length%16;o=cD(o,new Uint8Array(v));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:gD,additionalData:m},s,o);return cD(new Uint8Array(_),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new z(k.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ke.DATA_STREAM,{payload:ac(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-A7},!n)}sendMetadata(e){if(!this._joinInfo)throw new z(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new z(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ke.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ac(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(AH),!this._joinInfo)throw new z(k.INVALID_OPERATION,"can not send custom report, not joined");await Pe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Un(t.spatialLayer,"spatialLayer",[0,1,2,3]),Un(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw y.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(da(t,"apRTM"),Nt(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,y.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(y.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Bi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&dx(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Pe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ui("client-publish",this._clientId),this._subscribeMutex=new ui("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||Bd();e?y.debug("[".concat(this._clientId,"] new Session ").concat(i)):y.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Pe.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Pe.sessionInit(this._sessionId,Cs({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new z(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");y.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof _r){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(_n.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==k.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=r)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of e)r instanceof Yt&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(k.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));y.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==k.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=r)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===k.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new z(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Bp("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{Pe.reportApiInvoke(this._sessionId,{name:Ln.ON_LIVE_STREAM_ERROR,options:[r,s],tag:an.TRACER}).onSuccess(),this.safeEmit(st.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{Pe.reportApiInvoke(this._sessionId,{name:Ln.ON_LIVE_STREAM_WARNING,options:[r,s],tag:an.TRACER}).onSuccess(),this.safeEmit(st.LIVE_STREAMING_WARNING,r,s)},n.on(rb.REQUEST_WORKER_MANAGER_LIST,(r,s,o)=>{if(!this._joinInfo)return o(new z(k.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,u,p,m){const _=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(g=>u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap"));return await n7(_,c,u,p,m)})(r,this._joinInfo,this._axiosCancelSource.token,On).then(s).catch(o)}),n};return e===ha.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new z(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Bp("ChannelMediaRelay").create(e));i.on("state",r=>{r===Xi.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(st.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(st.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var o;r==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,r=[];if(t){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(c=>{n.every(u=>u.uid!==o._uintid||u.stream_id!==c.id)&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:c,ordered:u,max_retrans_times:p,metadata:m}=s,_=this._users.find(g=>g._uintid===o);if(!_)return void y.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(y.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),ge(r).call(r,_)||r.push(_),_._uintid||(_._uintid=o),_._dataChannels.findIndex(g=>g.id===s.stream_id)===-1){const g={id:c,ordered:!!u,maxRetransmits:p,metadata:m},v=function(D){return ex(D,!0)}(g);_._dataChannels.push(v),y.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),t||this.safeEmit(st.USER_PUBLISHED,_,"datachannel",g)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(y.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(g=>{y.error("[".concat(this._clientId,"] resubscribe datachannel error"),g.toString())}))}),t&&(this.safeEmit(st.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:o,stream_id:c}=s,u=this._users.find(m=>m._uintid===o);if(!u)return void y.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=u._dataChannels.find(m=>m.id===s.stream_id);p&&(y.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(u,[p]).then(m=>{if(u._dataChannels=u._dataChannels.filter(_=>_!==p),m)return this._gateway.unsubscribeDataChannel(m,u.uid)}),y.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(st.USER_UNPUBLISHED,u,"datachannel",p._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){y.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{y.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(st.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else y.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(oi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(oi.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===bt.FALLBACK)return;const r=()=>{this.safeEmit(st.CONNECTION_STATE_CHANGE,e,t,n)};if(Pe.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Ln.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:an.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),y.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void r();if(e==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch(u=>{y.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch(u=>{y.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{y.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{y.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{y.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,we.AUDIO,!1)),o._trust_video_mute_state_||(y.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,we.VIDEO,!1)),o._trust_audio_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(y.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(y.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(y.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}r()}),this._gateway.on(oi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new z(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await cx(Cs(Cs({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,ux(i),this._joinInfo.preload=!0):(n=await rC(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||On,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[c,u]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:c,port:u}):r.push({host:c,port:u})}),e(r)}catch(n){t(n)}}),this._gateway.on(oi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(st.NETWORK_QUALITY,e)}),this._gateway.on(oi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(st.STREAM_TYPE_CHANGED,e,t),Pe.reportApiInvoke(this._sessionId,{name:Ln.STREAM_TYPE_CHANGE,options:[e,t],tag:an.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(oi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(oi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();V("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(oi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:y.debug("no attributes in joinResponse");const i=LL(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(oi.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(r),icePwd:"".concat(s,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=V("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(it.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(it.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(it.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(it.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(it.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(it.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(it.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(it.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(it.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,we.AUDIO,!0)),this._gateway.signal.on(it.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,we.AUDIO,!1)),this._gateway.signal.on(it.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,we.VIDEO,!0)),this._gateway.signal.on(it.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,we.VIDEO,!1)),this._gateway.signal.on(it.RECEIVE_METADATA,e=>{const t=ol(e.metadata);this.safeEmit(st.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(it.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=ol(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ge(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Hd)throw new z(k.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Hd));n=await async function(s,o,c){const u=c.subarray(0,Hd),p=u.slice(8,Hd),m=(p[0]<<8)+p[1],_=(u[6]<<8)+u[7],g=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:gD,additionalData:new Uint8Array(pD(m,2))},o,c.subarray(Hd));return new Uint8Array(g).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(c=>c.uid===e.uid),o=r==null?void 0:r.audioRecv.find(c=>c.ssrc===(s==null?void 0:s._audioSSRC));i=o==null?void 0:o.jitterBufferMs}i==null&&(i=0),O7(Cs(Cs({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(it.ON_CRYPT_ERROR,()=>{oc(()=>{y.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(st.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(it.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{y.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,bt.TOKEN_EXPIRE),this.safeEmit(st.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(it.ON_STREAM_FALLBACK_UPDATE,e=>{y.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(st.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(it.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),y.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(it.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(it.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ye.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ke.PUBLISH:{if(!t)return;const r=t.ortc;if(r){var n,i;const s=r.some(u=>{let{stream_type:p}=u;return p===yt.Audio}),o=r.some(u=>{let{stream_type:p}=u;return p!==yt.Audio}),c=r.some(u=>{let{stream_type:p}=u;return p===yt.Screen||p===yt.ScreenLow});t.state==="offer"&&Pe.publish(this._joinInfo.sid,{eventElapse:pi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=r.find(u=>{let{stream_type:p}=u;return p===yt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(i=r.find(u=>{let{stream_type:p}=u;return p!==yt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Ke.SUBSCRIBE:t&&Pe.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:t.stream_type===we.AUDIO,video:t.stream_type===we.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:pi.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(it.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(it.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;V("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!ll(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let r=this._users.find(m=>m._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new gc(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(y.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(st.USER_JOINED,r)));const s=Fn.Audio&i.stream_type,o=(Fn.Video|Fn.LwoVideo)&i.stream_type,c=(65280&i.stream_type)!=0,u=s&&r.hasAudio,p=o&&r.hasVideo;o&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!u&&this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(st.USER_PUBLISHED,r,"audio")),o&&!p&&this.getListeners(st.PUBLISHED_USER_LIST).length===0&&(y.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(st.USER_PUBLISHED,r,"video")),(s&&!u||o&&!p||c)&&t.push(r),o&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(y.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{y.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(st.PUBLISHED_USER_LIST).length>0?V("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(y.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(st.PUBLISHED_USER_LIST,t)):y.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(it.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof og&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return ge(i=Object.keys(gE)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(it.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(_n.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(r=>{const{kind:s,ssrcs:o,mid:c,isMuted:u}=r;this._handleP2PAddAudioOrVideoStream(s,i,o[0].ssrcId,c);const p=this._users.find(m=>m.uid===i);return p&&this._p2pChannel instanceof _r?this._p2pChannel.mockSubscribe(p,s,o[0].ssrcId,c).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,s,!!u)})}),this._gateway.signal.on(_n.CALL,async(e,t,n)=>{if(this._p2pChannel instanceof _r)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(r){n(r)}}),this._gateway.signal.on(Ye.P2P_CONNECTION,async e=>{this._p2pChannel instanceof _r&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(_n.UNPUBLISH,async(e,t,n)=>{if(this._p2pChannel instanceof _r){const{unpubMsg:i,uid:r}=e,s=this._users.find(o=>o.uid===r);if(!s)return y.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void t();try{i.forEach(async o=>{let{stream_type:c}=o;const u=c===yt.Audio?we.AUDIO:we.VIDEO;await this._p2pChannel.unsubscribe(s,u),this._handleMuteStream(r,u,!0)}),t()}catch(o){n(o)}}}),this._gateway.signal.on(_n.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case dc.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,we.VIDEO,!0);break;case dc.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,we.AUDIO,!0);break;case dc.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,we.VIDEO,!1);break;case dc.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,we.AUDIO,!1)}}),this._gateway.signal.on(_n.RESTART_ICE,async(e,t,n)=>{if(this._p2pChannel instanceof _r)try{const{direction:i,iceParameter:r}=e;i!==Di.SEND_ONLY||r?t(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(_n.CANDIDATE,e=>{if(this._p2pChannel instanceof _r){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Be.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(_n.RESTART_ICE,e,i===Di.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Be.LocalCandidate,e=>{this._gateway.sendExtensionMessage(_n.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Be.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(_n.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Be.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Be.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Be.StateChange,(e,t)=>{t===Rt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Be.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Be.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===k.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Be.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Be.RequestRePublishDataChannel,(e,t,n)=>{ve.all(e.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==k.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(Be.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:r}of e)r===we.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Be.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Be.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Be.MediaReconnectStart,e=>{this.safeEmit(st.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Be.MediaReconnectEnd,e=>{this.safeEmit(st.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Be.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Be.RequestRestartICE,async e=>{if(this._p2pChannel instanceof _r)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(o){return void t.throw(o)}const{iceParameters:s}=function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(r);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(Be.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Be.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),o=LL(r,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Be.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Be.P2PLost,()=>{this.safeEmit(st.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Be.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Be.ConnectionTypeChange,e=>{this.safeEmit(st.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Be.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Be.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Bp("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:o,uid:c,cid:u,vid:p}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:o,uid:c,cid:u,vid:p?Number(p):0},On)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Hn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(st.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===ps.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(st.CONTENT_INSPECT_ERROR,new z(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Hn.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===k.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return y.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(st.CONTENT_INSPECT_RESULT,t,n)}),e.on(Hn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(da(e,"enabled"),e){if(!t)throw new z(k.INVALID_PARAMS,"config is required");if(bx(t),!this._joinInfo)throw new z(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},Bp("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:o,token:c,uid:u,cid:p,vid:m}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:o,token:c,uid:u,cid:p,vid:m?Number(m):0},On)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new z(k.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(zs.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(st.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===zr.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new z(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(zs.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){Un(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new z(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,y.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return y.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){da(e,"enabled"),Dt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ae(Re.prototype,"leave",[Cx],Object.getOwnPropertyDescriptor(Re.prototype,"leave"),Re.prototype),Ae(Re.prototype,"publish",[wx],Object.getOwnPropertyDescriptor(Re.prototype,"publish"),Re.prototype),Ae(Re.prototype,"unpublish",[Ax],Object.getOwnPropertyDescriptor(Re.prototype,"unpublish"),Re.prototype),Ae(Re.prototype,"subscribe",[Ix],Object.getOwnPropertyDescriptor(Re.prototype,"subscribe"),Re.prototype),Ae(Re.prototype,"presubscribe",[Ox],Object.getOwnPropertyDescriptor(Re.prototype,"presubscribe"),Re.prototype),Ae(Re.prototype,"massSubscribe",[Nx],Object.getOwnPropertyDescriptor(Re.prototype,"massSubscribe"),Re.prototype),Ae(Re.prototype,"unsubscribe",[Dx],Object.getOwnPropertyDescriptor(Re.prototype,"unsubscribe"),Re.prototype),Ae(Re.prototype,"massUnsubscribe",[Px],Object.getOwnPropertyDescriptor(Re.prototype,"massUnsubscribe"),Re.prototype),Ae(Re.prototype,"setLowStreamParameter",[Lx],Object.getOwnPropertyDescriptor(Re.prototype,"setLowStreamParameter"),Re.prototype),Ae(Re.prototype,"enableDualStream",[kx],Object.getOwnPropertyDescriptor(Re.prototype,"enableDualStream"),Re.prototype),Ae(Re.prototype,"disableDualStream",[xx],Object.getOwnPropertyDescriptor(Re.prototype,"disableDualStream"),Re.prototype),Ae(Re.prototype,"setClientRole",[Mx],Object.getOwnPropertyDescriptor(Re.prototype,"setClientRole"),Re.prototype),Ae(Re.prototype,"setProxyServer",[Ux],Object.getOwnPropertyDescriptor(Re.prototype,"setProxyServer"),Re.prototype),Ae(Re.prototype,"setTurnServer",[jx],Object.getOwnPropertyDescriptor(Re.prototype,"setTurnServer"),Re.prototype),Ae(Re.prototype,"setLicense",[Vx],Object.getOwnPropertyDescriptor(Re.prototype,"setLicense"),Re.prototype),Ae(Re.prototype,"startProxyServer",[Fx],Object.getOwnPropertyDescriptor(Re.prototype,"startProxyServer"),Re.prototype),Ae(Re.prototype,"stopProxyServer",[Bx],Object.getOwnPropertyDescriptor(Re.prototype,"stopProxyServer"),Re.prototype),Ae(Re.prototype,"setLocalAccessPointsV2",[Gx],Object.getOwnPropertyDescriptor(Re.prototype,"setLocalAccessPointsV2"),Re.prototype),Ae(Re.prototype,"setLocalAccessPoints",[Hx],Object.getOwnPropertyDescriptor(Re.prototype,"setLocalAccessPoints"),Re.prototype),Ae(Re.prototype,"setRemoteDefaultVideoStreamType",[Wx],Object.getOwnPropertyDescriptor(Re.prototype,"setRemoteDefaultVideoStreamType"),Re.prototype),Ae(Re.prototype,"setRemoteVideoStreamType",[Kx],Object.getOwnPropertyDescriptor(Re.prototype,"setRemoteVideoStreamType"),Re.prototype),Ae(Re.prototype,"setStreamFallbackOption",[Yx],Object.getOwnPropertyDescriptor(Re.prototype,"setStreamFallbackOption"),Re.prototype),Ae(Re.prototype,"setEncryptionConfig",[zx],Object.getOwnPropertyDescriptor(Re.prototype,"setEncryptionConfig"),Re.prototype),Ae(Re.prototype,"renewToken",[qx],Object.getOwnPropertyDescriptor(Re.prototype,"renewToken"),Re.prototype),Ae(Re.prototype,"enableAudioVolumeIndicator",[$x],Object.getOwnPropertyDescriptor(Re.prototype,"enableAudioVolumeIndicator"),Re.prototype),Ae(Re.prototype,"startLiveStreaming",[Jx],Object.getOwnPropertyDescriptor(Re.prototype,"startLiveStreaming"),Re.prototype),Ae(Re.prototype,"setLiveTranscoding",[Xx],Object.getOwnPropertyDescriptor(Re.prototype,"setLiveTranscoding"),Re.prototype),Ae(Re.prototype,"stopLiveStreaming",[Qx],Object.getOwnPropertyDescriptor(Re.prototype,"stopLiveStreaming"),Re.prototype),Ae(Re.prototype,"startChannelMediaRelay",[Zx],Object.getOwnPropertyDescriptor(Re.prototype,"startChannelMediaRelay"),Re.prototype),Ae(Re.prototype,"updateChannelMediaRelay",[eM],Object.getOwnPropertyDescriptor(Re.prototype,"updateChannelMediaRelay"),Re.prototype),Ae(Re.prototype,"stopChannelMediaRelay",[tM],Object.getOwnPropertyDescriptor(Re.prototype,"stopChannelMediaRelay"),Re.prototype),Ae(Re.prototype,"sendCustomReportMessage",[nM],Object.getOwnPropertyDescriptor(Re.prototype,"sendCustomReportMessage"),Re.prototype),Ae(Re.prototype,"pickSVCLayer",[iM],Object.getOwnPropertyDescriptor(Re.prototype,"pickSVCLayer"),Re.prototype),Ae(Re.prototype,"setRTMConfig",[rM],Object.getOwnPropertyDescriptor(Re.prototype,"setRTMConfig"),Re.prototype),Ae(Re.prototype,"enableContentInspect",[sM],Object.getOwnPropertyDescriptor(Re.prototype,"enableContentInspect"),Re.prototype),Ae(Re.prototype,"disableContentInspect",[oM],Object.getOwnPropertyDescriptor(Re.prototype,"disableContentInspect"),Re.prototype),Ae(Re.prototype,"setImageModeration",[aM],Object.getOwnPropertyDescriptor(Re.prototype,"setImageModeration"),Re.prototype),Ae(Re.prototype,"setP2PTransport",[cM],Object.getOwnPropertyDescriptor(Re.prototype,"setP2PTransport"),Re.prototype),Ae(Re.prototype,"getJoinChannelServiceRecords",[lM],Object.getOwnPropertyDescriptor(Re.prototype,"getJoinChannelServiceRecords"),Re.prototype),Ae(Re.prototype,"setPublishAudioFilterEnabled",[dM],Object.getOwnPropertyDescriptor(Re.prototype,"setPublishAudioFilterEnabled"),Re.prototype),Re);class Wp{constructor(t,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),Wp.count+=1,this.id=Wp.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new ve(o=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&o(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await t(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new z(k.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(r){throw new z(k.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new z(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){y.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var hM,hg;O(Wp,"count",0);const Y7=window.AudioContext||window.webkitAudioContext,z7=new(hM=Fe({report:Pe}),Ae((hg=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return y.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Y7);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Wp(e,this.context),this.units.push(t)),t.startEchoCancellation(),y.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return ut().name!==vt.SAFARI}}).prototype,"processExternalMediaAEC",[hM],Object.getOwnPropertyDescriptor(hg.prototype,"processExternalMediaAEC"),hg.prototype),hg);function pM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function fM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pM(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pM(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const yC=window||document;function mM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!yC)return;const n=Nn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=r=>{if(!(r&&r.blockedURI&&(Nn.onSecurityPolicyViolation||Nn.getListeners(Co.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(o=>ge(s).call(s,o))&&(Nn.onSecurityPolicyViolation&&typeof Nn.onSecurityPolicyViolation=="function"&&Nn.onSecurityPolicyViolation(r),Nn.getListeners(Co.SECURITY_POLICY_VIOLATION).length>0&&Nn.safeEmit(Co.SECURITY_POLICY_VIOLATION,r))};n&&yC.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Nn.getListeners(Co.SECURITY_POLICY_VIOLATION).length>0)&&yC.addEventListener("securitypolicyviolation",i),Nn._cspEventHandlerPointer=i}var q7=Z,$7=rN,_M=RegExp.prototype,J7=function(e){return e===_M||q7(_M,e)?$7(e):e.flags},Ci=T(J7);function vu(e){let t=e.length;for(;--t>=0;)e[t]=0}const RC=256,EM=286,Kp=30,Yp=15,bC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),pg=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),X7=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),va=new Array(576);vu(va);const zp=new Array(60);vu(zp);const qp=new Array(512);vu(qp);const $p=new Array(256);vu($p);const CC=new Array(29);vu(CC);const fg=new Array(Kp);function wC(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let SM,TM,vM;function AC(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}vu(fg);const yM=e=>e<256?qp[e]:qp[256+(e>>>7)],Jp=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},xr=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Jp(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ko=(e,t,n)=>{xr(e,n[2*t],n[2*t+1])},RM=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},bM=(e,t,n)=>{const i=new Array(16);let r,s,o=0;for(r=1;r<=Yp;r++)o=o+n[r-1]<<1,i[r]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=RM(i[c]++,c))}},CM=e=>{let t;for(t=0;t<EM;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Kp;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},wM=e=>{e.bi_valid>8?Jp(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},AM=(e,t,n,i)=>{const r=2*t,s=2*n;return e[r]<e[s]||e[r]===e[s]&&i[t]<=i[n]},IC=(e,t,n)=>{const i=e.heap[n];let r=n<<1;for(;r<=e.heap_len&&(r<e.heap_len&&AM(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!AM(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},IM=(e,t,n)=>{let i,r,s,o,c=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+c++],i+=(255&e.pending_buf[e.sym_buf+c++])<<8,r=e.pending_buf[e.sym_buf+c++],i===0?ko(e,r,t):(s=$p[r],ko(e,s+RC+1,t),o=bC[s],o!==0&&(r-=CC[s],xr(e,r,o)),i--,s=yM(i),ko(e,s,n),o=pg[s],o!==0&&(i-=fg[s],xr(e,i,o)));while(c<e.sym_next);ko(e,256,t)},OC=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,u,p=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=p=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=p<2?++p:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,r&&(e.static_len-=i[2*u+1]);for(t.max_code=p,o=e.heap_len>>1;o>=1;o--)IC(e,n,o);u=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],IC(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*u]=n[2*o]+n[2*c],e.depth[u]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=u,e.heap[1]=u++,IC(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,_)=>{const g=_.dyn_tree,v=_.max_code,D=_.stat_desc.static_tree,C=_.stat_desc.has_stree,w=_.stat_desc.extra_bits,P=_.stat_desc.extra_base,L=_.stat_desc.max_length;let G,W,K,ee,ae,fe,de=0;for(ee=0;ee<=Yp;ee++)m.bl_count[ee]=0;for(g[2*m.heap[m.heap_max]+1]=0,G=m.heap_max+1;G<573;G++)W=m.heap[G],ee=g[2*g[2*W+1]+1]+1,ee>L&&(ee=L,de++),g[2*W+1]=ee,W>v||(m.bl_count[ee]++,ae=0,W>=P&&(ae=w[W-P]),fe=g[2*W],m.opt_len+=fe*(ee+ae),C&&(m.static_len+=fe*(D[2*W+1]+ae)));if(de!==0){do{for(ee=L-1;m.bl_count[ee]===0;)ee--;m.bl_count[ee]--,m.bl_count[ee+1]+=2,m.bl_count[L]--,de-=2}while(de>0);for(ee=L;ee!==0;ee--)for(W=m.bl_count[ee];W!==0;)K=m.heap[--G],K>v||(g[2*K+1]!==ee&&(m.opt_len+=(ee-g[2*K+1])*g[2*K],g[2*K+1]=ee),W--)}})(e,t),bM(n,p,e.bl_count)},OM=(e,t,n)=>{let i,r,s=-1,o=t[1],c=0,u=7,p=4;for(o===0&&(u=138,p=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++c<u&&r===o||(c<p?e.bl_tree[2*r]+=c:r!==0?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=r,o===0?(u=138,p=3):r===o?(u=6,p=3):(u=7,p=4))},NM=(e,t,n)=>{let i,r,s=-1,o=t[1],c=0,u=7,p=4;for(o===0&&(u=138,p=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++c<u&&r===o)){if(c<p)do ko(e,r,e.bl_tree);while(--c!=0);else r!==0?(r!==s&&(ko(e,r,e.bl_tree),c--),ko(e,16,e.bl_tree),xr(e,c-3,2)):c<=10?(ko(e,17,e.bl_tree),xr(e,c-3,3)):(ko(e,18,e.bl_tree),xr(e,c-11,7));c=0,s=r,o===0?(u=138,p=3):r===o?(u=6,p=3):(u=7,p=4)}};let DM=!1;const PM=(e,t,n,i)=>{xr(e,0+(i?1:0),3),wM(e),Jp(e,n),Jp(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Q7=e=>{DM||((()=>{let t,n,i,r,s;const o=new Array(16);for(i=0,r=0;r<28;r++)for(CC[r]=i,t=0;t<1<<bC[r];t++)$p[i++]=r;for($p[i-1]=r,s=0,r=0;r<16;r++)for(fg[r]=s,t=0;t<1<<pg[r];t++)qp[s++]=r;for(s>>=7;r<Kp;r++)for(fg[r]=s<<7,t=0;t<1<<pg[r]-7;t++)qp[256+s++]=r;for(n=0;n<=Yp;n++)o[n]=0;for(t=0;t<=143;)va[2*t+1]=8,t++,o[8]++;for(;t<=255;)va[2*t+1]=9,t++,o[9]++;for(;t<=279;)va[2*t+1]=7,t++,o[7]++;for(;t<=287;)va[2*t+1]=8,t++,o[8]++;for(bM(va,287,o),t=0;t<Kp;t++)zp[2*t+1]=5,zp[2*t]=RM(t,5);SM=new wC(va,bC,257,EM,Yp),TM=new wC(zp,pg,0,Kp,Yp),vM=new wC(new Array(0),X7,0,19,7)})(),DM=!0),e.l_desc=new AC(e.dyn_ltree,SM),e.d_desc=new AC(e.dyn_dtree,TM),e.bl_desc=new AC(e.bl_tree,vM),e.bi_buf=0,e.bi_valid=0,CM(e)},Z7=(e,t,n,i)=>{let r,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let u,p=4093624447;for(u=0;u<=31;u++,p>>>=1)if(1&p&&c.dyn_ltree[2*u]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(u=32;u<RC;u++)if(c.dyn_ltree[2*u]!==0)return 1;return 0})(e)),OC(e,e.l_desc),OC(e,e.d_desc),o=(c=>{let u;for(OM(c,c.dyn_ltree,c.l_desc.max_code),OM(c,c.dyn_dtree,c.d_desc.max_code),OC(c,c.bl_desc),u=18;u>=3&&c.bl_tree[2*gM[u]+1]===0;u--);return c.opt_len+=3*(u+1)+5+5+4,u})(e),r=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&t!==-1?PM(e,t,n,i):e.strategy===4||s===r?(xr(e,2+(i?1:0),3),IM(e,va,zp)):(xr(e,4+(i?1:0),3),((c,u,p,m)=>{let _;for(xr(c,u-257,5),xr(c,p-1,5),xr(c,m-4,4),_=0;_<m;_++)xr(c,c.bl_tree[2*gM[_]+1],3);NM(c,c.dyn_ltree,u-1),NM(c,c.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),IM(e,e.dyn_ltree,e.dyn_dtree)),CM(e),i&&wM(e)},e9=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*($p[n]+RC+1)]++,e.dyn_dtree[2*yM(t)]++),e.sym_next===e.sym_end),t9=e=>{xr(e,2,3),ko(e,256,va),(t=>{t.bi_valid===16?(Jp(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},n9={_tr_init:Q7,_tr_stored_block:PM,_tr_flush_block:Z7,_tr_tally:e9,_tr_align:t9},Xp=(e,t,n,i)=>{let r=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do r=r+t[i++]|0,s=s+r|0;while(--o);r%=65521,s%=65521}return r|s<<16|0};const i9=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var ki=(e,t,n,i)=>{const r=i9,s=i+n;e^=-1;for(let o=i;o<s;o++)e=e>>>8^r[255&(e^t[o])];return-1^e},bl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},yu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:r9,_tr_stored_block:NC,_tr_flush_block:s9,_tr_tally:yc,_tr_align:o9}=n9,{Z_NO_FLUSH:Rc,Z_PARTIAL_FLUSH:a9,Z_FULL_FLUSH:c9,Z_FINISH:ws,Z_BLOCK:LM,Z_OK:Wi,Z_STREAM_END:kM,Z_STREAM_ERROR:xo,Z_DATA_ERROR:l9,Z_BUF_ERROR:DC,Z_DEFAULT_COMPRESSION:d9,Z_FILTERED:u9,Z_HUFFMAN_ONLY:mg,Z_RLE:h9,Z_FIXED:p9,Z_DEFAULT_STRATEGY:f9,Z_UNKNOWN:m9,Z_DEFLATED:_g}=yu,PC=286,_9=30,E9=19,g9=2*PC+1,S9=15,Cl=258,Mo=262,Ru=42,wl=113,Qp=666,Al=(e,t)=>(e.msg=bl[t],t),xM=e=>2*e-(e>4?9:0),bc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},T9=e=>{let t,n,i,r=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=r?n-r:0;while(--t);t=r,i=t;do n=e.prev[--i],e.prev[i]=n>=r?n-r:0;while(--t)};let Cc=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Jr=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Xr=(e,t)=>{s9(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Jr(e.strm)},dn=(e,t)=>{e.pending_buf[e.pending++]=t},Zp=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},LC=(e,t,n,i)=>{let r=e.avail_in;return r>i&&(r=i),r===0?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),e.state.wrap===1?e.adler=Xp(e.adler,t,r,n):e.state.wrap===2&&(e.adler=ki(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},MM=(e,t)=>{let n,i,r=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const u=e.strstart>e.w_size-Mo?e.strstart-(e.w_size-Mo):0,p=e.window,m=e.w_mask,_=e.prev,g=e.strstart+Cl;let v=p[s+o-1],D=p[s+o];e.prev_length>=e.good_match&&(r>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,p[n+o]===D&&p[n+o-1]===v&&p[n]===p[s]&&p[++n]===p[s+1]){s+=2,n++;do;while(p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&s<g);if(i=Cl-(g-s),s=g-Cl,i>o){if(e.match_start=t,o=i,i>=c)break;v=p[s+o-1],D=p[s+o]}}while((t=_[t&m])>u&&--r!=0);return o<=e.lookahead?o:e.lookahead},bu=e=>{const t=e.w_size;let n,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Mo)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),T9(e),i+=t),e.strm.avail_in===0)break;if(n=LC(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Cc(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Cc(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Mo&&e.strm.avail_in!==0)},UM=(e,t)=>{let n,i,r,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&t!==ws||t===Rc||n!==i+e.strm.avail_in)))break;o=t===ws&&n===i+e.strm.avail_in?1:0,NC(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Jr(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(LC(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Rc&&t!==ws&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(LC(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,s=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=s||(i||t===ws)&&t!==Rc&&e.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,o=t===ws&&e.strm.avail_in===0&&n===i?1:0,NC(e,e.block_start,n,o),e.block_start+=n,Jr(e.strm)),o?3:1)},kC=(e,t)=>{let n,i;for(;;){if(e.lookahead<Mo){if(bu(e),e.lookahead<Mo&&t===Rc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Cc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Mo&&(e.match_length=MM(e,n)),e.match_length>=3)if(i=yc(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Cc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Cc(e,e.ins_h,e.window[e.strstart+1]);else i=yc(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Xr(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ws?(Xr(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Xr(e,!1),e.strm.avail_out===0)?1:2},Cu=(e,t)=>{let n,i,r;for(;;){if(e.lookahead<Mo){if(bu(e),e.lookahead<Mo&&t===Rc)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Cc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Mo&&(e.match_length=MM(e,n),e.match_length<=5&&(e.strategy===u9||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=yc(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Cc(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Xr(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=yc(e,0,e.window[e.strstart-1]),i&&Xr(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=yc(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ws?(Xr(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Xr(e,!1),e.strm.avail_out===0)?1:2};function Uo(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}const ef=[new Uo(0,0,0,0,UM),new Uo(4,4,8,4,kC),new Uo(4,5,16,8,kC),new Uo(4,6,32,32,kC),new Uo(4,4,16,16,Cu),new Uo(8,16,32,32,Cu),new Uo(8,16,128,128,Cu),new Uo(8,32,128,256,Cu),new Uo(32,128,258,1024,Cu),new Uo(32,258,258,4096,Cu)];function v9(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*g9),this.dyn_dtree=new Uint16Array(2*(2*_9+1)),this.bl_tree=new Uint16Array(2*(2*E9+1)),bc(this.dyn_ltree),bc(this.dyn_dtree),bc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(S9+1),this.heap=new Uint16Array(2*PC+1),bc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*PC+1),bc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const tf=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ru&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==wl&&t.status!==Qp?1:0},jM=e=>{if(tf(e))return Al(e,xo);e.total_in=e.total_out=0,e.data_type=m9;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Ru:wl,e.adler=t.wrap===2?0:1,t.last_flush=-2,r9(t),Wi},VM=e=>{const t=jM(e);return t===Wi&&(n=>{n.window_size=2*n.w_size,bc(n.head),n.max_lazy_match=ef[n.level].max_lazy,n.good_match=ef[n.level].good_length,n.nice_match=ef[n.level].nice_length,n.max_chain_length=ef[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},FM=(e,t,n,i,r,s)=>{if(!e)return xo;let o=1;if(t===d9&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==_g||i<8||i>15||t<0||t>9||s<0||s>p9||i===8&&o!==1)return Al(e,xo);i===8&&(i=9);const c=new v9;return e.state=c,c.strm=e,c.status=Ru,c.wrap=o,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=r+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<r+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,VM(e)};var y9=(e,t)=>{if(tf(e)||t>LM||t<0)return e?Al(e,xo):xo;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Qp&&t!==ws)return Al(e,e.avail_out===0?DC:xo);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(Jr(e),e.avail_out===0)return n.last_flush=-1,Wi}else if(e.avail_in===0&&xM(t)<=xM(i)&&t!==ws)return Al(e,DC);if(n.status===Qp&&e.avail_in!==0)return Al(e,DC);if(n.status===Ru&&n.wrap===0&&(n.status=wl),n.status===Ru){let r=_g+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=mg||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,Zp(n,r),n.strstart!==0&&(Zp(n,e.adler>>>16),Zp(n,65535&e.adler)),e.adler=1,n.status=wl,Jr(e),n.pending!==0)return n.last_flush=-1,Wi}if(n.status===57){if(e.adler=0,dn(n,31),dn(n,139),dn(n,8),n.gzhead)dn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),dn(n,255&n.gzhead.time),dn(n,n.gzhead.time>>8&255),dn(n,n.gzhead.time>>16&255),dn(n,n.gzhead.time>>24&255),dn(n,n.level===9?2:n.strategy>=mg||n.level<2?4:0),dn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(dn(n,255&n.gzhead.extra.length),dn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=ki(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(dn(n,0),dn(n,0),dn(n,0),dn(n,0),dn(n,0),dn(n,n.level===9?2:n.strategy>=mg||n.level<2?4:0),dn(n,3),n.status=wl,Jr(e),n.pending!==0)return n.last_flush=-1,Wi}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(e.adler=ki(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=c,Jr(e),n.pending!==0)return n.last_flush=-1,Wi;r=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(e.adler=ki(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=ki(e.adler,n.pending_buf,n.pending-s,s)),Jr(e),n.pending!==0)return n.last_flush=-1,Wi;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,dn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=ki(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=ki(e.adler,n.pending_buf,n.pending-s,s)),Jr(e),n.pending!==0)return n.last_flush=-1,Wi;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,dn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=ki(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Jr(e),n.pending!==0))return n.last_flush=-1,Wi;dn(n,255&e.adler),dn(n,e.adler>>8&255),e.adler=0}if(n.status=wl,Jr(e),n.pending!==0)return n.last_flush=-1,Wi}if(e.avail_in!==0||n.lookahead!==0||t!==Rc&&n.status!==Qp){let r=n.level===0?UM(n,t):n.strategy===mg?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(bu(s),s.lookahead===0)){if(o===Rc)return 1;break}if(s.match_length=0,c=yc(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(Xr(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===ws?(Xr(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Xr(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===h9?((s,o)=>{let c,u,p,m;const _=s.window;for(;;){if(s.lookahead<=Cl){if(bu(s),s.lookahead<=Cl&&o===Rc)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(p=s.strstart-1,u=_[p],u===_[++p]&&u===_[++p]&&u===_[++p])){m=s.strstart+Cl;do;while(u===_[++p]&&u===_[++p]&&u===_[++p]&&u===_[++p]&&u===_[++p]&&u===_[++p]&&u===_[++p]&&u===_[++p]&&p<m);s.match_length=Cl-(m-p),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=yc(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=yc(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(Xr(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===ws?(Xr(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Xr(s,!1),s.strm.avail_out===0)?1:2})(n,t):ef[n.level].func(n,t);if(r!==3&&r!==4||(n.status=Qp),r===1||r===3)return e.avail_out===0&&(n.last_flush=-1),Wi;if(r===2&&(t===a9?o9(n):t!==LM&&(NC(n,0,0,!1),t===c9&&(bc(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Jr(e),e.avail_out===0))return n.last_flush=-1,Wi}return t!==ws?Wi:n.wrap<=0?kM:(n.wrap===2?(dn(n,255&e.adler),dn(n,e.adler>>8&255),dn(n,e.adler>>16&255),dn(n,e.adler>>24&255),dn(n,255&e.total_in),dn(n,e.total_in>>8&255),dn(n,e.total_in>>16&255),dn(n,e.total_in>>24&255)):(Zp(n,e.adler>>>16),Zp(n,65535&e.adler)),Jr(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Wi:kM)},R9=(e,t)=>{let n=t.length;if(tf(e))return xo;const i=e.state,r=i.wrap;if(r===2||r===1&&i.status!==Ru||i.lookahead)return xo;if(r===1&&(e.adler=Xp(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){r===0&&(bc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let u=new Uint8Array(i.w_size);u.set(t.subarray(n-i.w_size,n),0),t=u,n=i.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,bu(i);i.lookahead>=3;){let u=i.strstart,p=i.lookahead-2;do i.ins_h=Cc(i,i.ins_h,i.window[u+3-1]),i.prev[u&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=u,u++;while(--p);i.strstart=u,i.lookahead=2,bu(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,i.wrap=r,Wi},nf={deflateInit:(e,t)=>FM(e,t,_g,15,8,f9),deflateInit2:FM,deflateReset:VM,deflateResetKeep:jM,deflateSetHeader:(e,t)=>tf(e)||e.state.wrap!==2?xo:(e.state.gzhead=t,Wi),deflate:y9,deflateEnd:e=>{if(tf(e))return xo;const t=e.state.status;return e.state=null,t===wl?Al(e,l9):Wi},deflateSetDictionary:R9,deflateInfo:"pako deflate (from Nodeca project)"};const b9=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Eg={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)b9(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,r=0,s=e.length;i<s;i++){let o=e[i];n.set(o,r),r+=o.length}return n}};let BM=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{BM=!1}const rf=new Uint8Array(256);for(let e=0;e<256;e++)rf[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;rf[254]=rf[254]=1;var sf={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,r,s,o=e.length,c=0;for(r=0;r<o;r++)n=e.charCodeAt(r),(64512&n)==55296&&r+1<o&&(i=e.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,r=0;s<c;r++)n=e.charCodeAt(r),(64512&n)==55296&&r+1<o&&(i=e.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let o=e[i++];if(o<128){s[r++]=o;continue}let c=rf[o];if(c>4)s[r++]=65533,i+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&i<n;)o=o<<6|63&e[i++],c--;c>1?s[r++]=65533:o<65536?s[r++]=o:(o-=65536,s[r++]=55296|o>>10&1023,s[r++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&BM)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let u="";for(let p=0;p<c;p++)u+=String.fromCharCode(o[p]);return u})(s,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+rf[e[n]]>t?n:t}},GM=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const HM=Object.prototype.toString,{Z_NO_FLUSH:C9,Z_SYNC_FLUSH:w9,Z_FULL_FLUSH:A9,Z_FINISH:I9,Z_OK:gg,Z_STREAM_END:O9,Z_DEFAULT_COMPRESSION:N9,Z_DEFAULT_STRATEGY:D9,Z_DEFLATED:P9}=yu;function of(e){this.options=Eg.assign({level:N9,method:P9,chunkSize:16384,windowBits:15,memLevel:8,strategy:D9},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GM,this.strm.avail_out=0;let n=nf.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==gg)throw new Error(bl[n]);if(t.header&&nf.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?sf.string2buf(t.dictionary):HM.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=nf.deflateSetDictionary(this.strm,i),n!==gg)throw new Error(bl[n]);this._dict_set=!0}}function xC(e,t){const n=new of(t);if(n.push(e,!0),n.err)throw n.msg||bl[n.err];return n.result}of.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?I9:C9,typeof e=="string"?n.input=sf.string2buf(e):HM.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===w9||s===A9)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=nf.deflate(n,s),r===O9)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=nf.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===gg;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},of.prototype.onData=function(e){this.chunks.push(e)},of.prototype.onEnd=function(e){e===gg&&(this.result=Eg.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var L9={Deflate:of,deflate:xC,deflateRaw:function(e,t){return(t=t||{}).raw=!0,xC(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,xC(e,t)},constants:yu};const Sg=16209;var k9=function(e,t){let n,i,r,s,o,c,u,p,m,_,g,v,D,C,w,P,L,G,W,K,ee,ae,fe,de;const Ne=e.state;n=e.next_in,fe=e.input,i=n+(e.avail_in-5),r=e.next_out,de=e.output,s=r-(t-e.avail_out),o=r+(e.avail_out-257),c=Ne.dmax,u=Ne.wsize,p=Ne.whave,m=Ne.wnext,_=Ne.window,g=Ne.hold,v=Ne.bits,D=Ne.lencode,C=Ne.distcode,w=(1<<Ne.lenbits)-1,P=(1<<Ne.distbits)-1;e:do{v<15&&(g+=fe[n++]<<v,v+=8,g+=fe[n++]<<v,v+=8),L=D[g&w];t:for(;;){if(G=L>>>24,g>>>=G,v-=G,G=L>>>16&255,G===0)de[r++]=65535&L;else{if(!(16&G)){if(!(64&G)){L=D[(65535&L)+(g&(1<<G)-1)];continue t}if(32&G){Ne.mode=16191;break e}e.msg="invalid literal/length code",Ne.mode=Sg;break e}W=65535&L,G&=15,G&&(v<G&&(g+=fe[n++]<<v,v+=8),W+=g&(1<<G)-1,g>>>=G,v-=G),v<15&&(g+=fe[n++]<<v,v+=8,g+=fe[n++]<<v,v+=8),L=C[g&P];n:for(;;){if(G=L>>>24,g>>>=G,v-=G,G=L>>>16&255,!(16&G)){if(!(64&G)){L=C[(65535&L)+(g&(1<<G)-1)];continue n}e.msg="invalid distance code",Ne.mode=Sg;break e}if(K=65535&L,G&=15,v<G&&(g+=fe[n++]<<v,v+=8,v<G&&(g+=fe[n++]<<v,v+=8)),K+=g&(1<<G)-1,K>c){e.msg="invalid distance too far back",Ne.mode=Sg;break e}if(g>>>=G,v-=G,G=r-s,K>G){if(G=K-G,G>p&&Ne.sane){e.msg="invalid distance too far back",Ne.mode=Sg;break e}if(ee=0,ae=_,m===0){if(ee+=u-G,G<W){W-=G;do de[r++]=_[ee++];while(--G);ee=r-K,ae=de}}else if(m<G){if(ee+=u+m-G,G-=m,G<W){W-=G;do de[r++]=_[ee++];while(--G);if(ee=0,m<W){G=m,W-=G;do de[r++]=_[ee++];while(--G);ee=r-K,ae=de}}}else if(ee+=m-G,G<W){W-=G;do de[r++]=_[ee++];while(--G);ee=r-K,ae=de}for(;W>2;)de[r++]=ae[ee++],de[r++]=ae[ee++],de[r++]=ae[ee++],W-=3;W&&(de[r++]=ae[ee++],W>1&&(de[r++]=ae[ee++]))}else{ee=r-K;do de[r++]=de[ee++],de[r++]=de[ee++],de[r++]=de[ee++],W-=3;while(W>2);W&&(de[r++]=de[ee++],W>1&&(de[r++]=de[ee++]))}break}}break}}while(n<i&&r<o);W=v>>3,n-=W,v-=W<<3,g&=(1<<v)-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<o?o-r+257:257-(r-o),Ne.hold=g,Ne.bits=v};const Tg=15,x9=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),M9=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U9=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),j9=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var af=(e,t,n,i,r,s,o,c)=>{const u=c.bits;let p,m,_,g,v,D,C=0,w=0,P=0,L=0,G=0,W=0,K=0,ee=0,ae=0,fe=0,de=null;const Ne=new Uint16Array(16),tt=new Uint16Array(16);let Tt,Gt,Cn,en=null;for(C=0;C<=Tg;C++)Ne[C]=0;for(w=0;w<i;w++)Ne[t[n+w]]++;for(G=u,L=Tg;L>=1&&Ne[L]===0;L--);if(G>L&&(G=L),L===0)return r[s++]=20971520,r[s++]=20971520,c.bits=1,0;for(P=1;P<L&&Ne[P]===0;P++);for(G<P&&(G=P),ee=1,C=1;C<=Tg;C++)if(ee<<=1,ee-=Ne[C],ee<0)return-1;if(ee>0&&(e===0||L!==1))return-1;for(tt[1]=0,C=1;C<Tg;C++)tt[C+1]=tt[C]+Ne[C];for(w=0;w<i;w++)t[n+w]!==0&&(o[tt[t[n+w]]++]=w);if(e===0?(de=en=o,D=20):e===1?(de=x9,en=M9,D=257):(de=U9,en=j9,D=0),fe=0,w=0,C=P,v=s,W=G,K=0,_=-1,ae=1<<G,g=ae-1,e===1&&ae>852||e===2&&ae>592)return 1;for(;;){Tt=C-K,o[w]+1<D?(Gt=0,Cn=o[w]):o[w]>=D?(Gt=en[o[w]-D],Cn=de[o[w]-D]):(Gt=96,Cn=0),p=1<<C-K,m=1<<W,P=m;do m-=p,r[v+(fe>>K)+m]=Tt<<24|Gt<<16|Cn|0;while(m!==0);for(p=1<<C-1;fe&p;)p>>=1;if(p!==0?(fe&=p-1,fe+=p):fe=0,w++,--Ne[C]==0){if(C===L)break;C=t[n+o[w]]}if(C>G&&(fe&g)!==_){for(K===0&&(K=G),v+=P,W=C-K,ee=1<<W;W+K<L&&(ee-=Ne[W+K],!(ee<=0));)W++,ee<<=1;if(ae+=1<<W,e===1&&ae>852||e===2&&ae>592)return 1;_=fe&g,r[_]=G<<24|W<<16|v-s|0}}return fe!==0&&(r[v+fe]=C-K<<24|64<<16|0),c.bits=G,0};const{Z_FINISH:WM,Z_BLOCK:V9,Z_TREES:vg,Z_OK:Il,Z_STREAM_END:F9,Z_NEED_DICT:B9,Z_STREAM_ERROR:As,Z_DATA_ERROR:KM,Z_MEM_ERROR:YM,Z_BUF_ERROR:G9,Z_DEFLATED:zM}=yu,yg=16180,Rg=16190,ya=16191,MC=16192,UC=16194,bg=16199,Cg=16200,jC=16206,Wn=16209,qM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function H9(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ol=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<yg||t.mode>16211?1:0},$M=e=>{if(Ol(e))return As;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=yg,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Il},JM=e=>{if(Ol(e))return As;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,$M(e)},XM=(e,t)=>{let n;if(Ol(e))return As;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?As:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,JM(e))},QM=(e,t)=>{if(!e)return As;const n=new H9;e.state=n,n.strm=e,n.window=null,n.mode=yg;const i=XM(e,t);return i!==Il&&(e.state=null),i};let VC,FC,ZM=!0;const W9=e=>{if(ZM){VC=new Int32Array(512),FC=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(af(1,e.lens,0,288,VC,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;af(2,e.lens,0,32,FC,0,e.work,{bits:5}),ZM=!1}e.lencode=VC,e.lenbits=9,e.distcode=FC,e.distbits=5},eU=(e,t,n,i)=>{let r;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(t.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(t.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var K9=(e,t)=>{let n,i,r,s,o,c,u,p,m,_,g,v,D,C,w,P,L,G,W,K,ee,ae,fe=0;const de=new Uint8Array(4);let Ne,tt;const Tt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ol(e)||!e.output||!e.input&&e.avail_in!==0)return As;n=e.state,n.mode===ya&&(n.mode=MC),o=e.next_out,r=e.output,u=e.avail_out,s=e.next_in,i=e.input,c=e.avail_in,p=n.hold,m=n.bits,_=c,g=u,ae=Il;e:for(;;)switch(n.mode){case yg:if(n.wrap===0){n.mode=MC;break}for(;m<16;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,de[0]=255&p,de[1]=p>>>8&255,n.check=ki(n.check,de,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=Wn;break}if((15&p)!==zM){e.msg="unknown compression method",n.mode=Wn;break}if(p>>>=4,m-=4,ee=8+(15&p),n.wbits===0&&(n.wbits=ee),ee>15||ee>n.wbits){e.msg="invalid window size",n.mode=Wn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:ya,p=0,m=0;break;case 16181:for(;m<16;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(n.flags=p,(255&Ci(n))!==zM){e.msg="unknown compression method",n.mode=Wn;break}if(57344&Ci(n)){e.msg="unknown header flags set",n.mode=Wn;break}n.head&&(n.head.text=p>>8&1),512&Ci(n)&&4&n.wrap&&(de[0]=255&p,de[1]=p>>>8&255,n.check=ki(n.check,de,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.head&&(n.head.time=p),512&Ci(n)&&4&n.wrap&&(de[0]=255&p,de[1]=p>>>8&255,de[2]=p>>>16&255,de[3]=p>>>24&255,n.check=ki(n.check,de,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&Ci(n)&&4&n.wrap&&(de[0]=255&p,de[1]=p>>>8&255,n.check=ki(n.check,de,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&Ci(n)){for(;m<16;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&Ci(n)&&4&n.wrap&&(de[0]=255&p,de[1]=p>>>8&255,n.check=ki(n.check,de,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Ci(n)&&(v=n.length,v>c&&(v=c),v&&(n.head&&(ee=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+v),ee)),512&Ci(n)&&4&n.wrap&&(n.check=ki(n.check,i,v,s)),c-=v,s+=v,n.length-=v),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Ci(n)){if(c===0)break e;v=0;do ee=i[s+v++],n.head&&ee&&n.length<65536&&(n.head.name+=String.fromCharCode(ee));while(ee&&v<c);if(512&Ci(n)&&4&n.wrap&&(n.check=ki(n.check,i,v,s)),c-=v,s+=v,ee)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Ci(n)){if(c===0)break e;v=0;do ee=i[s+v++],n.head&&ee&&n.length<65536&&(n.head.comment+=String.fromCharCode(ee));while(ee&&v<c);if(512&Ci(n)&&4&n.wrap&&(n.check=ki(n.check,i,v,s)),c-=v,s+=v,ee)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Ci(n)){for(;m<16;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Wn;break}p=0,m=0}n.head&&(n.head.hcrc=Ci(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ya;break;case 16189:for(;m<32;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}e.adler=n.check=qM(p),p=0,m=0,n.mode=Rg;case Rg:if(n.havedict===0)return e.next_out=o,e.avail_out=u,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,B9;e.adler=n.check=1,n.mode=ya;case ya:if(t===V9||t===vg)break e;case MC:if(n.last){p>>>=7&m,m-=7&m,n.mode=jC;break}for(;m<3;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(W9(n),n.mode=bg,t===vg){p>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Wn}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Wn;break}if(n.length=65535&p,p=0,m=0,n.mode=UC,t===vg)break e;case UC:n.mode=16195;case 16195:if(v=n.length,v){if(v>c&&(v=c),v>u&&(v=u),v===0)break e;r.set(i.subarray(s,s+v),o),c-=v,s+=v,u-=v,o+=v,n.length-=v;break}n.mode=ya;break;case 16196:for(;m<14;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Wn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.lens[Tt[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[Tt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ne={bits:n.lenbits},ae=af(0,n.lens,0,19,n.lencode,0,n.work,Ne),n.lenbits=Ne.bits,ae){e.msg="invalid code lengths set",n.mode=Wn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;fe=n.lencode[p&(1<<n.lenbits)-1],w=fe>>>24,P=fe>>>16&255,L=65535&fe,!(w<=m);){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(L<16)p>>>=w,m-=w,n.lens[n.have++]=L;else{if(L===16){for(tt=w+2;m<tt;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(p>>>=w,m-=w,n.have===0){e.msg="invalid bit length repeat",n.mode=Wn;break}ee=n.lens[n.have-1],v=3+(3&p),p>>>=2,m-=2}else if(L===17){for(tt=w+3;m<tt;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}p>>>=w,m-=w,ee=0,v=3+(7&p),p>>>=3,m-=3}else{for(tt=w+7;m<tt;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}p>>>=w,m-=w,ee=0,v=11+(127&p),p>>>=7,m-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Wn;break}for(;v--;)n.lens[n.have++]=ee}}if(n.mode===Wn)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Wn;break}if(n.lenbits=9,Ne={bits:n.lenbits},ae=af(1,n.lens,0,n.nlen,n.lencode,0,n.work,Ne),n.lenbits=Ne.bits,ae){e.msg="invalid literal/lengths set",n.mode=Wn;break}if(n.distbits=6,n.distcode=n.distdyn,Ne={bits:n.distbits},ae=af(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ne),n.distbits=Ne.bits,ae){e.msg="invalid distances set",n.mode=Wn;break}if(n.mode=bg,t===vg)break e;case bg:n.mode=Cg;case Cg:if(c>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,k9(e,g),o=e.next_out,r=e.output,u=e.avail_out,s=e.next_in,i=e.input,c=e.avail_in,p=n.hold,m=n.bits,n.mode===ya&&(n.back=-1);break}for(n.back=0;fe=n.lencode[p&(1<<n.lenbits)-1],w=fe>>>24,P=fe>>>16&255,L=65535&fe,!(w<=m);){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(P&&!(240&P)){for(G=w,W=P,K=L;fe=n.lencode[K+((p&(1<<G+W)-1)>>G)],w=fe>>>24,P=fe>>>16&255,L=65535&fe,!(G+w<=m);){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=w,m-=w,n.back+=w,n.length=L,P===0){n.mode=16205;break}if(32&P){n.back=-1,n.mode=ya;break}if(64&P){e.msg="invalid literal/length code",n.mode=Wn;break}n.extra=15&P,n.mode=16201;case 16201:if(n.extra){for(tt=n.extra;m<tt;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;fe=n.distcode[p&(1<<n.distbits)-1],w=fe>>>24,P=fe>>>16&255,L=65535&fe,!(w<=m);){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(!(240&P)){for(G=w,W=P,K=L;fe=n.distcode[K+((p&(1<<G+W)-1)>>G)],w=fe>>>24,P=fe>>>16&255,L=65535&fe,!(G+w<=m);){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=w,m-=w,n.back+=w,64&P){e.msg="invalid distance code",n.mode=Wn;break}n.offset=L,n.extra=15&P,n.mode=16203;case 16203:if(n.extra){for(tt=n.extra;m<tt;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Wn;break}n.mode=16204;case 16204:if(u===0)break e;if(v=g-u,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Wn;break}v>n.wnext?(v-=n.wnext,D=n.wsize-v):D=n.wnext-v,v>n.length&&(v=n.length),C=n.window}else C=r,D=o-n.offset,v=n.length;v>u&&(v=u),u-=v,n.length-=v;do r[o++]=C[D++];while(--v);n.length===0&&(n.mode=Cg);break;case 16205:if(u===0)break e;r[o++]=n.length,u--,n.mode=Cg;break;case jC:if(n.wrap){for(;m<32;){if(c===0)break e;c--,p|=i[s++]<<m,m+=8}if(g-=u,e.total_out+=g,n.total+=g,4&n.wrap&&g&&(e.adler=n.check=Ci(n)?ki(n.check,r,g,o-g):Xp(n.check,r,g,o-g)),g=u,4&n.wrap&&(Ci(n)?p:qM(p))!==n.check){e.msg="incorrect data check",n.mode=Wn;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&Ci(n)){for(;m<32;){if(c===0)break e;c--,p+=i[s++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Wn;break}p=0,m=0}n.mode=16208;case 16208:ae=F9;break e;case Wn:ae=KM;break e;case 16210:return YM;default:return As}return e.next_out=o,e.avail_out=u,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,(n.wsize||g!==e.avail_out&&n.mode<Wn&&(n.mode<jC||t!==WM))&&eU(e,e.output,e.next_out,g-e.avail_out),_-=e.avail_in,g-=e.avail_out,e.total_in+=_,e.total_out+=g,n.total+=g,4&n.wrap&&g&&(e.adler=n.check=Ci(n)?ki(n.check,r,g,e.next_out-g):Xp(n.check,r,g,e.next_out-g)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ya?128:0)+(n.mode===bg||n.mode===UC?256:0),(_===0&&g===0||t===WM)&&ae===Il&&(ae=G9),ae},Ra={inflateReset:JM,inflateReset2:XM,inflateResetKeep:$M,inflateInit:e=>QM(e,15),inflateInit2:QM,inflate:K9,inflateEnd:e=>{if(Ol(e))return As;let t=e.state;return t.window&&(t.window=null),e.state=null,Il},inflateGetHeader:(e,t)=>{if(Ol(e))return As;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Il):As},inflateSetDictionary:(e,t)=>{const n=t.length;let i,r,s;return Ol(e)?As:(i=e.state,i.wrap!==0&&i.mode!==Rg?As:i.mode===Rg&&(r=1,r=Xp(r,t,n,0),r!==i.check)?KM:(s=eU(e,t,n,n),s?(i.mode=16210,YM):(i.havedict=1,Il)))},inflateInfo:"pako inflate (from Nodeca project)"},Y9=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const tU=Object.prototype.toString,{Z_NO_FLUSH:z9,Z_FINISH:q9,Z_OK:cf,Z_STREAM_END:BC,Z_NEED_DICT:GC,Z_STREAM_ERROR:$9,Z_DATA_ERROR:nU,Z_MEM_ERROR:J9}=yu;function lf(e){this.options=Eg.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GM,this.strm.avail_out=0;let n=Ra.inflateInit2(this.strm,t.windowBits);if(n!==cf)throw new Error(bl[n]);if(this.header=new Y9,Ra.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=sf.string2buf(t.dictionary):tU.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ra.inflateSetDictionary(this.strm,t.dictionary),n!==cf)))throw new Error(bl[n])}function HC(e,t){const n=new lf(t);if(n.push(e),n.err)throw n.msg||bl[n.err];return n.result}lf.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?q9:z9,tU.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=Ra.inflate(n,o),s===GC&&r&&(s=Ra.inflateSetDictionary(n,r),s===cf?s=Ra.inflate(n,o):s===nU&&(s=GC));n.avail_in>0&&s===BC&&n.state.wrap>0&&e[n.next_in]!==0;)Ra.inflateReset(n),s=Ra.inflate(n,o);switch(s){case $9:case nU:case GC:case J9:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===BC))if(this.options.to==="string"){let u=sf.utf8border(n.output,n.next_out),p=n.next_out-u,m=sf.buf2string(n.output,u);n.next_out=p,n.avail_out=i-p,p&&n.output.set(n.output.subarray(u,u+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==cf||c!==0){if(s===BC)return s=Ra.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},lf.prototype.onData=function(e){this.chunks.push(e)},lf.prototype.onEnd=function(e){e===cf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Eg.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var X9={Inflate:lf,inflate:HC,inflateRaw:function(e,t){return(t=t||{}).raw=!0,HC(e,t)},ungzip:HC,constants:yu};const{Deflate:oQ,deflate:Q9,deflateRaw:aQ,gzip:cQ}=L9,{Inflate:lQ,inflate:Z9,inflateRaw:dQ,ungzip:uQ}=X9;var eK=Q9,tK=Z9,iU=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(iU||{});class nK{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const u={id:0,length:4,data:c.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;V("SHOW_DATASTREAM2_LOG")&&y.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);r.set(new Uint8Array(c),o),o+=c.byteLength}if(r.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let o,c;if(i+=4,V("SHOW_DATASTREAM2_LOG")&&y.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){c=this.deserializeExtension(t.slice(i)),i+=2+c.length,o=t.slice(i);let u=!1;if(c.datas.length>0){const p=c.datas.find(m=>m.id===0);p&&(u=(1&new DataView(p.data).getUint32(0,!0))==1)}o=u?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:i,datas:r}=t,s=new ArrayBuffer(i+2),o=new Uint8Array(s),c=new DataView(s);let u=0;if(c.setUint8(u++,n),c.setUint8(u++,i),r.forEach(p=>{n?(c.setUint8(u++,p.id),c.setUint8(u++,p.length),o.set(new Uint8Array(p.data),u),u+=p.data.byteLength):(c.setUint8(u++,p.id|p.length<<4),o.set(new Uint8Array(p.data),u),u+=p.data.byteLength)}),u!==i+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(i+2));return s}deserializeExtension(t){const n=new DataView(t);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const o=r===iU.TWO_BYTE,c=[],u=new DataView(t,2);let p=0;for(;p<s;){let m=0,_=0,g=new ArrayBuffer(0);o?(m=u.getUint8(p),p++,_=u.getUint8(p),p++):(m=15&u.getUint8(p),_=u.getUint8(p)>>4,p++),_>0&&(g=u.buffer.slice(p+2,p+2+_),p+=g.byteLength),c.push({id:m,length:_,data:g})}if(p!==s)throw Error("parse error");return{profile:r,length:s,datas:c}}decompress(t){return tK(new Uint8Array(t))}compress(t){return eK(new Uint8Array(t))}}const iK={name:"DataStream",create:(e,t)=>{const n=t?new $3(e):new J3(e);return n.useDataStream(new nK),n}};class rK extends nn{constructor(t,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",r=>{this.emit("close"),this.dispose()}),O(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new vp("cross-channel-".concat(this.clientId),i),this.ws.on($e.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on($e.CONNECTED,this.onOpen),this.ws.on($e.ON_MESSAGE,this.onMessage),this.ws.on($e.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ve((n,i)=>{const r=window.setTimeout(()=>{i(new z(k.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new z(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new z(k.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new z(k.WS_DISCONNECT);const n=()=>new ve((o,c)=>{this.ws.once($e.CLOSED,()=>c(new z(k.WS_ABORT))),this.ws.once($e.CONNECTED,o)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),r=new ve((o,c)=>{const u=()=>{c(new z(k.WS_ABORT))};this.ws.once($e.RECONNECTING,u),this.ws.once($e.CLOSED,u),this.once("req_".concat(i),o),$n(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off($e.RECONNECTING,u),this.ws.off($e.CLOSED,u),c(new z(k.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new z(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners($e.REQUEST_NEW_URLS),this.ws.on($e.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class sK extends nn{set state(t){t!==this._state&&(t!==Xi.RELAY_STATE_FAILURE&&(this.errorCode=Wd.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,r,s){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",Bi.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",Xi.RELAY_STATE_IDLE),O(this,"errorCode",Wd.RELAY_OK),O(this,"onStatus",o=>{y.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",pa.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",pa.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Wd.SRC_TOKEN_EXPIRED,this.state=Xi.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Wd.DEST_TOKEN_EXPIRED,this.state=Xi.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{y.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pa.NETWORK_DISCONNECTED),this.state=Xi.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Xi.RELAY_STATE_IDLE&&(y.error("auto restart channel media relay failed",o.toString()),this.errorCode=Wd.SERVER_CONNECTION_LOST,this.state=Xi.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Bd(),this.signal=new rK(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Xi.RELAY_STATE_IDLE)throw new z(k.INVALID_OPERATION);this.state=Xi.RELAY_STATE_CONNECTING,await this.connect(),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new z(k.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new z(k.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new z(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Xi.RELAY_STATE_RUNNING)throw new z(k.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Xi.RELAY_STATE_RUNNING)throw new z(k.INVALID_OPERATION);const n=this.genMessage(Pi.SetVideoProfile);await this.signal.request(n),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),y.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xi.RELAY_STATE_IDLE,this.dispose()}dispose(){y.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Bi.CancelToken.source(),this.state=Xi.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await a7(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",pa.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Pi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Pi.SetSdkProfile,t);await this.signal.request(i),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Pi.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pa.PACKET_JOINED_SRC_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Pi.SetSourceUserId,t);await this.signal.request(s),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Pi.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pa.PACKET_JOINED_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Pi.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",pa.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xi.RELAY_STATE_RUNNING,y.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Pi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",pa.PACKET_UPDATE_DEST_CHANNEL),y.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Pi.StopPacketTransfer);await this.signal.request(t),y.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],r=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Kr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.2"&&(o.sdkVersion="0.0.1");let c=null,u=null;switch(t){case Pi.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Pi.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new z(k.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},o;case Pi.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new z(k.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:u.uid+""},o;case Pi.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new z(k.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},o;case Pi.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Pi.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Pi.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Pi.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new z(k.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{i.push(p.channelName),r.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},o;case Pi.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const oK={name:"ChannelMediaRelay",create:function(e){return new sK(e.joinInfo,e.clientId,e.websocketRetryConfig||On,e.httpRetryConfig||On,e.resolution)}};function rU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function df(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class aK extends nn{constructor(t,n,i,r){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Pe.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===ha.TRANSCODE?1:2}),this.emit(lc.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=t,this.serviceMode=r,this.websocket=new vp("live-streaming",i),this.websocket.on($e.CONNECTED,this.handleWebSocketOpen),this.websocket.on($e.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on($e.REQUEST_NEW_URLS,(s,o)=>{ri(this,lc.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on($e.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,r){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new z(k.UNEXPECTED_ERROR);const c=df({command:t,sdkVersion:Kr==="4.22.2"?"0.0.1":Kr,seq:o,requestId:o,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new z(k.WS_DISCONNECT);const u=()=>new ve((g,v)=>{this.websocket.once($e.CLOSED,()=>v(new z(k.WS_ABORT))),this.websocket.once($e.CONNECTED,g)});this.websocket.state!=="connected"&&await u(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const p=new ve((g,v)=>{const D=()=>{v(new z(k.WS_ABORT))};this.websocket.once($e.RECONNECTING,D),this.websocket.once($e.CLOSED,D),this.once("@".concat(o,"-").concat(this.spec.sid),C=>{g(C)})});r&&Pe.workerEvent(this.spec.sid,df(df({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(c);let _=null;try{_=await p}catch(g){if(this.websocket.state==="closed")throw g;return await u(),await this.request(t,n,i)}return r&&Pe.workerEvent(this.spec.sid,df(df({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-m})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Kr==="4.22.2"?"0.0.1":Kr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case kn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void y.warning("live stream response already exists stream");case kn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case kn.LIVE_STREAM_RESPONSE_BAD_STREAM:case kn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new z(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case kn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case kn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new z(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case kn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new z(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(lc.WARNING,n,t.serverResponse.url)}case kn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new z(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(lc.WARNING,n,t.serverResponse.url)}case kn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case kn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new z(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case kn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new z(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(lc.WARNING,n,t.serverResponse.url)}case kn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case kn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case kn.LIVE_STREAM_RESPONSE_WORKER_LOST:case kn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case kn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case kn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new z(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(mE)},6e3)}}function sU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Zi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sU(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class cK extends nn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:On,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:On;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new ui("live-streaming")),O(this,"cancelToken",Bi.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=Zi(Zi({},pW),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(y.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>Zi(Zi(Zi({},hW),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){tn(o.width)||Nt(o.width,"config.width",0,1e4),tn(o.height)||Nt(o.height,"config.height",0,1e4),tn(o.videoBitrate)||Nt(o.videoBitrate,"config.videoBitrate",1,1e6),tn(o.videoFrameRate)||Nt(o.videoFrameRate,"config.videoFrameRate"),tn(o.lowLatency)||da(o.lowLatency,"config.lowLatency"),tn(o.audioSampleRate)||Un(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),tn(o.audioBitrate)||Nt(o.audioBitrate,"config.audioBitrate",1,128),tn(o.audioChannels)||Un(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),tn(o.videoGop)||Nt(o.videoGop,"config.videoGop"),tn(o.videoCodecProfile)||Un(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),tn(o.userCount)||Nt(o.userCount,"config.userCount",0,17),tn(o.backgroundColor)||Nt(o.backgroundColor,"config.backgroundColor",0,16777215),tn(o.userConfigExtraInfo)||qn(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!tn(o.transcodingUsers)&&(ua(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((c,u)=>{yE(c.uid),tn(c.x)||Nt(c.x,"transcodingUser[".concat(u,"].x"),0,1e4),tn(c.y)||Nt(c.y,"transcodingUser[".concat(u,"].y"),0,1e4),tn(c.width)||Nt(c.width,"transcodingUser[".concat(u,"].width"),0,1e4),tn(c.height)||Nt(c.height,"transcodingUser[".concat(u,"].height"),0,1e4),tn(c.zOrder)||Nt(c.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),tn(c.alpha)||Nt(c.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),tn(o.watermark)||ib(o.watermark,"watermark"),tn(o.backgroundImage)||ib(o.backgroundImage,"backgroundImage"),o.images&&!tn(o.images)&&(ua(o.images,"config.images"),o.images.forEach((c,u)=>{ib(c,"images[".concat(u,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(o=>Zi(Zi(Zi({},nb),o),{},{zOrder:255}))),n.backgroundImage&&(i.push(Zi(Zi(Zi({},nb),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(Zi(Zi(Zi({},nb),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>Zi({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?ve.resolve(o.uid):QL(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ve.all(r)).forEach((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ma(s=this.streamingTasks).call(s)).map(c=>c.taskId).join("#")});y.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{y.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then(()=>{y.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(u=>{y.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,u)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===ha.TRANSCODE)throw new z(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};y.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(t)&&!i)return s(),new z(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case ha.TRANSCODE:r.transcodingConfig=Zi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new ve((p,m)=>{$n(this.retryTimeout).then(()=>{if(i)return m(i);const _=this.statusError.get(t);return _?(this.statusError.delete(t),m(_)):void 0})}),u=await ve.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:n===ha.TRANSCODE?1:2,requestByUser:!i,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,y.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(t,{clientRequest:r,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||i)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new ve((n,i)=>{const r=this.streamingTasks.get(t);if(!r||!this.connection)return new z(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:t,command:"UnPublishStream",workerType:s===ha.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{y.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(ma(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Bi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new z(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ri(this,rb.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new aK(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(lc.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(lc.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(lc.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new z(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));ri(this,rb.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=t.reason;switch(t.code){case kn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case kn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new z(k.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return y.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case kn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new z(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case kn.LIVE_STREAM_RESPONSE_WORKER_LOST:case kn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(ma(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(y.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{y.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(u=>{y.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,u)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const lK={name:"LiveStreaming",create:function(e){return new cK(e.joinInfo,e.websocketRetryConfig||On,e.httpRetryConfig||On)}};function dK(e){let t=cU();return function(n,i){let r=n.appId;r!==void 0&&(Ct(i,10),jo(i,r));let s=n.cid;s!==void 0&&(Ct(i,16),Ct(i,s));let o=n.cname;o!==void 0&&(Ct(i,26),jo(i,o));let c=n.deviceId;c!==void 0&&(Ct(i,34),jo(i,c));let u=n.elapse;u!==void 0&&(Ct(i,40),wc(i,u));let p=n.fileSize;p!==void 0&&(Ct(i,48),wc(i,wu(p)));let m=n.height;m!==void 0&&(Ct(i,56),wc(i,wu(m)));let _=n.jpg;_!==void 0&&(Ct(i,66),Ct(i,_.length),function(Is,oe){let pe=Au(Is,oe.length);Is.bytes.set(oe,pe)}(i,_));let g=n.networkType;g!==void 0&&(Ct(i,72),wc(i,wu(g)));let v=n.osType;v!==void 0&&(Ct(i,80),wc(i,wu(v)));let D=n.requestId;D!==void 0&&(Ct(i,90),jo(i,D));let C=n.sdkVersion;C!==void 0&&(Ct(i,98),jo(i,C));let w=n.sequence;w!==void 0&&(Ct(i,104),wc(i,wu(w)));let P=n.sid;P!==void 0&&(Ct(i,114),jo(i,P));let L=n.timestamp;L!==void 0&&(Ct(i,120),wc(i,L));let G=n.uid;G!==void 0&&(Ct(i,128),Ct(i,G));let W=n.vid;W!==void 0&&(Ct(i,136),Ct(i,W));let K=n.width;K!==void 0&&(Ct(i,144),wc(i,wu(K)));let ee=n.service;ee!==void 0&&(Ct(i,152),Ct(i,ee));let ae=n.callbackData;ae!==void 0&&(Ct(i,162),jo(i,ae));let fe=n.jpgEncryption;fe!==void 0&&(Ct(i,168),Ct(i,fe));let de=n.requestType;de!==void 0&&(Ct(i,176),Ct(i,de));let Ne=n.scorePorn;Ne!==void 0&&(Ct(i,185),qC(i,Ne));let tt=n.scoreSexy;tt!==void 0&&(Ct(i,193),qC(i,tt));let Tt=n.scoreNeutral;Tt!==void 0&&(Ct(i,201),qC(i,Tt));let Gt=n.scene;Gt!==void 0&&(Ct(i,208),Ct(i,Gt));let Cn=n.ossFilePrefix;Cn!==void 0&&(Ct(i,218),jo(i,Cn));let en=n.serviceVendor;if(en!==void 0)for(let Is of en){Ct(i,226);let oe=cU();pK(Is,oe),Ct(i,oe.limit),EK(i,oe),_K(oe)}}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}function uK(e){return function(n){let i={};e:for(;!lU(n);){let r=Vo(n);switch(r>>>3){case 0:break e;case 1:i.code=Vo(n);break;case 2:i.msg=dU(n,Vo(n));break;case 3:{let s=fK(n);i.data=hK(n),n.limit=s;break}default:oU(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function hK(e){let t={};e:for(;!lU(e);){let n=Vo(e);switch(n>>>3){case 0:break e;case 1:t.requestId=dU(e,Vo(e));break;case 2:t.requestType=Vo(e)>>>0;break;case 3:t.scorePorn=zC(e);break;case 4:t.scoreSexy=zC(e);break;case 5:t.scoreNeutral=zC(e);break;case 6:t.requestScene=Vo(e)>>>0;break;case 7:t.scene=Vo(e)>>>0;break;default:oU(e,7&n)}}return t}function pK(e,t){let n=e.service;n!==void 0&&(Ct(t,8),Ct(t,n));let i=e.vendor;i!==void 0&&(Ct(t,16),Ct(t,i));let r=e.token;r!==void 0&&(Ct(t,26),jo(t,r));let s=e.callbackUrl;s!==void 0&&(Ct(t,34),jo(t,s))}function fK(e){let t=Vo(e),n=e.limit;return e.limit=e.offset+t,n}function oU(e,t){switch(t){case 0:for(;128&uU(e););break;case 2:KC(e,Vo(e));break;case 5:KC(e,4);break;case 1:KC(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let mK=new Float32Array(1);new Uint8Array(mK.buffer);let WC=new Float64Array(1),er=new Uint8Array(WC.buffer);function wu(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let aU=[];function cU(){const e=aU.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function _K(e){aU.push(e)}function KC(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function lU(e){return e.offset>=e.limit}function Au(e,t){let n=e.bytes,i=e.offset,r=e.limit,s=i+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>r&&(e.limit=s),i}function YC(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function dU(e,t){let n=YC(e,t),i=String.fromCharCode,r=e.bytes,s="�",o="";for(let c=0;c<t;c++){let u,p,m,_,g=r[c+n];128&g?(224&g)==192?c+1>=t?o+=s:(u=r[c+n+1],(192&u)!=128?o+=s:(_=(31&g)<<6|63&u,_<128?o+=s:(o+=i(_),c++))):(240&g)==224?c+2>=t?o+=s:(u=r[c+n+1],p=r[c+n+2],(49344&(u|p<<8))!=32896?o+=s:(_=(15&g)<<12|(63&u)<<6|63&p,_<2048||_>=55296&&_<=57343?o+=s:(o+=i(_),c+=2))):(248&g)==240?c+3>=t?o+=s:(u=r[c+n+1],p=r[c+n+2],m=r[c+n+3],(12632256&(u|p<<8|m<<16))!=8421504?o+=s:(_=(7&g)<<18|(63&u)<<12|(63&p)<<6|63&m,_<65536||_>1114111?o+=s:(_-=65536,o+=i(55296+(_>>10),56320+(1023&_)),c+=3))):o+=s:o+=i(g)}return o}function jo(e,t){let n=t.length,i=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),i+=c<128?1:c<2048?2:c<65536?3:4}Ct(e,i);let r=Au(e,i),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[r++]=c:(c<2048?s[r++]=c>>6&31|192:(c<65536?s[r++]=c>>12&15|224:(s[r++]=c>>18&7|240,s[r++]=c>>12&63|128),s[r++]=c>>6&63|128),s[r++]=63&c|128)}}function EK(e,t){let n=Au(e,t.limit),i=e.bytes,r=t.bytes;for(let s=0,o=t.limit;s<o;s++)i[s+n]=r[s]}function uU(e){return e.bytes[YC(e,1)]}function hU(e,t){let n=Au(e,1);e.bytes[n]=t}function zC(e){let t=YC(e,8),n=e.bytes;return er[0]=n[t++],er[1]=n[t++],er[2]=n[t++],er[3]=n[t++],er[4]=n[t++],er[5]=n[t++],er[6]=n[t++],er[7]=n[t++],WC[0]}function qC(e,t){let n=Au(e,8),i=e.bytes;WC[0]=t,i[n++]=er[0],i[n++]=er[1],i[n++]=er[2],i[n++]=er[3],i[n++]=er[4],i[n++]=er[5],i[n++]=er[6],i[n++]=er[7]}function Vo(e){let t,n=0,i=0;do t=uU(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Ct(e,t){for(t>>>=0;t>=128;)hU(e,127&t|128),t>>>=7;hU(e,t)}function wc(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,o=Au(e,s),c=e.bytes;switch(s){case 10:c[o+9]=r>>>7&1;case 9:c[o+8]=s!==9?128|r:127&r;case 8:c[o+7]=s!==8?i>>>21|128:i>>>21&127;case 7:c[o+6]=s!==7?i>>>14|128:i>>>14&127;case 6:c[o+5]=s!==6?i>>>7|128:i>>>7&127;case 5:c[o+4]=s!==5?128|i:127&i;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function pU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const gK=new Map([["moderation",1],["supervise",2]]);function fU(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}class SK extends nn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Hn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=yr(n=t.map(i=>gK.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",ps.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Bi.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==ps.CONNECTED)throw new z(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ps.CONNECTED?this.requestToInspectImage():y.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=jt(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new vp("worker-manager-"+this._inspectId,On),this.on(Hn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,y.debug("[".concat(this._inspectId,"] Inspect operation :").concat(fs[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new vp("worker-"+this._inspectId,On),this.handleWorkerEvents()}async init(t,n){this.emit(Hn.STATE_CHANGE,fs.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new ve((r,s)=>{this.on(Hn.CONNECTION_STATE_CHANGE,(o,c)=>{c===ps.CONNECTED&&r()}),this.requestAP(t,i,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(t,n,i){const r=V("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await function(c,u,p,m){let{appId:_,areaCode:g,cname:v,sid:D,token:C,uid:w}=u;mu++;const P="image_moderation_api",L={service_name:P,json_body:JSON.stringify({appId:_,areaCode:g,cname:v,command:"allocateEdge",requestId:mu,seq:mu,sid:D,token:C,ts:Date.now(),uid:w+""})};let G,W,K=c[0];return Ys(async()=>{G=Date.now();const ee=await Js(K,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-G,ee.code!==0){const Ne=new z(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:W});throw y.error(Ne.toString()),Ne}const ae=JSON.parse(ee.json_body);if(ae.code!==200){const Ne=new z(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ae.code,", reason: ").concat(ae.reason),{code:ae.code,responseTime:W});throw y.error(Ne.toString()),Ne}if(!ae.servers||!Array.isArray(ae.servers)||ae.servers.length===0){const Ne=new z(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ae.code,responseTime:W});throw y.error(Ne.toString()),Ne}const fe=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),de=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ae.servers.map(Ne=>{let{address:tt,wss:Tt}=Ne;if(tt&&Tt)return"wss://".concat(tt.replace(/\./g,"-"),".").concat(fe,":").concat(de||Tt)}).filter(Ne=>!!Ne),workerToken:ae.workerToken,vid:ae.vid,responseTime:W}},(ee,ae)=>(Pe.apworkerEvent(D,{success:!0,sc:200,serviceName:P,responseDetail:JSON.stringify(ee.addressList),firstSuccess:ae===0,responseTime:W,serverIp:c[ae%c.length]}),!1),(ee,ae)=>(Pe.apworkerEvent(D,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:P,responseTime:W,serverIp:c[ae%c.length]}),!!(ee.code!==k.OPERATION_ABORTED&&ee.code!==k.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(K=c[(ae+1)%c.length],!0)),m)}(r,t,n,i);this.emit(Hn.STATE_CHANGE,fs.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Hn.STATE_CHANGE,fs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on($e.CONNECTED,async()=>{this.emit(Hn.STATE_CHANGE,fs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on($e.CLOSED,()=>{this._innerConnectionState<fs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on($e.FAILED,()=>{this._innerConnectionState<fs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on($e.RECONNECTING,()=>{this._innerConnectionState<fs.GET_WORKER_MANAGER_RESPONSE&&y.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on($e.ON_MESSAGE,async t=>{this.emit(Hn.STATE_CHANGE,fs.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw y.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new z(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw y.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new z(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=V("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(Hn.STATE_CHANGE,fs.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Hn.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on($e.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on($e.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on($e.CONNECTED,async()=>{this.emit(Hn.STATE_CHANGE,fs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ps.CONNECTED}),this.workerConnection.on($e.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=uK(new Uint8Array(t.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&y.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Hn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=yr(n=Object.keys(r)).call(n,(c,u)=>r[c]>r[u]?c:u,"porn"),o=Object.keys(r).find(c=>c===s);this.emit(Hn.INSPECT_RESULT,o)}else this.emit(Hn.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Hn.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else y.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Hn.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on($e.CLOSED,()=>{this.connectionState=ps.CLOSED}),this.workerConnection.on($e.FAILED,()=>{this.connectionState=ps.CLOSED}),this.workerConnection.on($e.RECONNECTING,()=>{this.connectionState=this.connectionState===ps.CONNECTED?ps.RECONNECTING:ps.CONNECTING}),this.workerConnection.on($e.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on($e.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Hn.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Wr(this,Hn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Hn.INSPECT_RESULT,void 0,new z(k.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Hn.INSPECT_RESULT,void 0,new z(k.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:r,cid:s,vid:o,sid:c,uid:u}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),_=await qP(m,i,r),g=this.sequence+"-"+s+"-"+u+"-"+p+"-"+jt(12,""),v={appId:i,cid:s,cname:r,deviceId:"",elapse:fU(Number(p-this.inspectStartTime)),fileSize:_.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:_,networkType:6,osType:7,requestId:g,sdkVersion:"4.22.2",sequence:this.sequence,sid:c,timestamp:fU(p),uid:u,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete v.callbackData,this.ossFilePrefix===void 0&&delete v.ossFilePrefix;const D=dK(v);if(D.byteLength<this.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const C=function(w){for(var P=1;P<arguments.length;P++){var L=arguments[P]!=null?arguments[P]:{};P%2?pU(Object(L),!0).forEach(function(G){O(w,G,L[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(L)):pU(Object(L)).forEach(function(G){Object.defineProperty(w,G,Object.getOwnPropertyDescriptor(L,G))})}return w}({},v);delete C.jpg,y.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(C))}return D}{const C=this.quality*this.qualityRatio;return this.quality=C,await this.generateRequestData(t,{appId:i,cname:r,cid:s,vid:o,sid:c,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Bi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ps.CLOSED,this.emit(Hn.STATE_CHANGE,fs.CLOSED)}}const TK={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new z(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new z(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!ge(s=["supervise","moderation"]).call(s,r))throw new z(k.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new z(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new SK(t)}};Dt("PROCESS_ID","process-".concat(jt(8,""),"-").concat(jt(4,""),"-").concat(jt(4,""),"-").concat(jt(4,""),"-").concat(jt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void y.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();y.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(mn,i)){const{value:r,expires:s}=t[i];if(s&&s<=n)return;cc[i]=r,mn[i]=r}})}catch(t){y.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(cc.AREAS)&&cc.AREAS.length>0&&Zb(cc.AREAS,!0);const mU=(e,t,n)=>{y.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Dt(e,t,n)};Fp(oK,!1),Fp(lK,!1),Fp(W7,!1),Fp(TK,!1),Fp(iK,!1);const Nn=function(e){const t=new nn,n=e,i={getListeners:t.getListeners.bind(t),on:(r,s)=>(function(o,c){o===Co.SECURITY_POLICY_VIOLATION&&mM(c,!0)}(r,s),t.on.bind(t)(r,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return fM(fM({},n),i)}({__TRACK_LIST__:nu,VERSION:Kr,BUILD:qR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:mU,getParameter:V,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let r;return pt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(t);if(!n)return e;t.close(),t=null,e=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(t){throw new z(k.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Pe.reportApiInvoke(null,{name:Ln.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:an.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&MR()&&GN(75)&&new s().close()}catch(s){return y.error("check system requirement failed: ",s),!1}let n=!1;const i=ut();i.name===vt.CHROME&&Number(i.version)>=58&&(Ks.engine.name!=="WebKit"||function(){const s=ut();if(dE()){if(s.os===Vn.MAC_OS)return!0;if(s.os===Vn.IOS){const o=Ks.os.version&&Ks.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(i.name===vt.FIREFOX&&Number(i.version)>=56||i.name===vt.OPERA&&Number(i.version)>=45||i.name===vt.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Oi()||us())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||JN()||ut().name===vt.QQ)&&(n=!0),y.debug("checkSystemRequirements, api:",t,"browser",n);const r=t&&n;return e.onSuccess(r),r},getDevices:function(e){return Pr.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Pr.getRecordingDevices(e)},getCameras:function(e){return Pr.getCamerasDevices(e)},getElectronScreenSources:MP,getPlaybackDevices:function(e){return Pr.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=jt(5,"client-"),i=Pe.reportApiInvoke(null,{id:n,name:Ln.CREATE_CLIENT,options:[t],tag:an.TRACER});try{(function(r){Un(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Un(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Un(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&qn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&rD(r.turnServer),r.httpRetryConfig!==void 0&&iD(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&iD(r.websocketRetryConfig)})(t)}catch(r){throw i.onError(r),r}return(KN(16,0)||YN(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",y.debug("browser not support vp9, force use vp8")),Dt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new K7(Cs(Cs({forceWaitGatewayResponse:!0},t),{},{role:ge(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=V("CAMERA_CAPTURE_CONFIG"),n=jt(8,"track-cam-"),i=Pe.reportApiInvoke(null,{id:n,tag:an.TRACER,name:Ln.CREATE_CAM_VIDEO_TRACK,options:[$t({},e),t]});t&&(e.encoderConfig=t);const r=jE(e);let s=null;y.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Dr({video:r},n)).getVideoTracks()[0]||null}catch(c){throw i.onError(c),c}if(!s){const c=new te(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(c),c.throw(y)}e.optimizationMode&&Kb(n,s,e,Ao(e.encoderConfig));const o=new Wb(s,e,r,e.scalabiltyMode?kE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(o.getTrackId()),y.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=jt(8,"track-cus-"),n=Pe.reportApiInvoke(null,{id:t,tag:an.TRACER,name:Ln.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new Yt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?kE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Vt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),y.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(g){return YP(g)}(t):void 0;n&&(t="auto");const i=jt(8,"track-scr-v-"),r=Pe.reportApiInvoke(null,{id:i,tag:an.TRACER,name:Ln.CREATE_SCREEN_VIDEO_TRACK,options:[$t({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(g){const v={};g.screenSourceType&&(v.mediaSource=g.screenSourceType),g.extensionId&&rc()&&(v.extensionId=g.extensionId);const{displaySurface:D,selfBrowserSurface:C,surfaceSwitching:w,systemAudio:P}=g;(kR(107)||HN(107)||zN(93))&&(D&&(Un(D,"displaySurface",["browser","window","monitor"]),v.displaySurface=D),C?(Un(C,"selfBrowserSurface",["exclude","include"]),v.selfBrowserSurface=C):v.selfBrowserSurface="include",w&&(Un(w,"surfaceSwitching",["exclude","include"]),v.surfaceSwitching=w)),(kR(105)||HN(105)||zN(91))&&P&&(Un(P,"systemAudio",["exclude","include"]),v.systemAudio=P),g.electronScreenSourceId&&(v.sourceId=g.electronScreenSourceId);const L=g.encoderConfig?Lb(g.encoderConfig):null;return v.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(v.mandatory.maxFrameRate=L.frameRate,v.mandatory.minFrameRate=L.frameRate):(v.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,v.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),v.frameRate=L.frameRate),L.width&&(v.width=L.width),L.height&&(v.height=L.height)),v}(e);let o=null,c=null;const u=pt();if(!u.supportShareAudio&&t==="enable"){const g=new te(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(g),g.throw(y)}y.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const p=u.supportShareAudio&&t!=="disable";try{const g=await Dr({screen:s,screenAudio:p?n||!0:void 0},i);o=g.getVideoTracks()[0]||null,c=g.getAudioTracks()[0]||null}catch(g){throw r.onError(g),g}if(!o){const g=new te(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(g),g.throw(y)}if(!c&&t==="enable"){o&&o.stop();const g=new te(k.SHARE_AUDIO_NOT_ALLOWED);return r.onError(g),g.throw(y)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Kb(i,o,e,e.encoderConfig&&Lb(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new Yt(o,e.encoderConfig?Lb(e.encoderConfig):{},e.scalabiltyMode?kE(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Vt.SCREEN_TRACK]);if(!c)return r.onSuccess(m.getTrackId()),y.info("create screen video track success","video:",m.getTrackId()),m;const _=new ln(c,void 0,jt(8,"track-scr-a-"),!1);return r.onSuccess([m.getTrackId(),_.getTrackId()]),y.info("create screen video track success","video:",m.getTrackId(),"audio:",_.getTrackId()),[m,_]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=V("CAMERA_CAPTURE_CONFIG"),i=jt(8,"track-mic-"),r=jt(8,"track-cam-"),s=Pe.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:an.TRACER,name:Ln.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=jE(t),c=zP(e);let u=null,p=null;y.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const g=await Dr({audio:c,video:o},"".concat(i,"-").concat(r));u=g.getAudioTracks()[0],p=g.getVideoTracks()[0]}catch(g){throw s.onError(g),g}if(!u||!p){const g=new te(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(g),g.throw(y)}t.optimizationMode&&Kb(r,p,t,Ao(t.encoderConfig));const m=new VE(u,e,c,i),_=new Wb(p,t,o,t.scalabiltyMode?kE(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r);return s.onSuccess([m.getTrackId(),_.getTrackId()]),y.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[m,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=jt(8,"track-mic-"),n=Pe.reportApiInvoke(null,{id:t,tag:an.TRACER,name:Ln.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=zP(e);let r=null;y.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{r=(await Dr({audio:i},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!r){const o=new te(k.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(y)}const s=new VE(r,e,i,t);return n.onSuccess(s.getTrackId()),y.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=jt(8,"track-cus-"),n=Pe.reportApiInvoke(null,{id:t,tag:an.TRACER,name:Ln.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new ln(e.mediaStreamTrack,e.encoderConfig?xE(e.encoderConfig):{},t,!1);return y.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:r}=e;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":r,cacheOnlineFile:n,encoderConfig:i},o=jt(8,"track-buf-"),c=Pe.reportApiInvoke(null,{id:o,tag:an.TRACER,name:Ln.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(V("DISABLE_WEBAUDIO"))throw new te(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");y.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const u=r;if(!(r instanceof AudioBuffer))try{r=await async function(_,g){let v=null;if(typeof _=="string"){const C=L1.get(_);if(C)return y.debug("use cached audio resource: ",_),C;try{v=(await Ys(()=>Bi.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new te(k.FETCH_AUDIO_FILE_FAILED,w.toString())}}else v=await new ve((w,P)=>{const L=new FileReader;L.onload=G=>{G.target?w(G.target.result):P(new te(k.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{P(new te(k.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(_)});const D=await function(C){const w=cu();return new ve((P,L)=>{w.decodeAudioData(C,G=>{P(G)},G=>{L(new te(k.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(v);return typeof _=="string"&&g&&L1.set(_,D),D}(r,n)}catch(_){return c.onError(_),_.throw(y)}const p=new q3(r),m=new z3(u,p,i?xE(i):{},o);return y.info("create buffer source audio track success, trackId:",o),c.onSuccess(m.getTrackId()),m},setAppType:function(e){if(y.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw y.debug("Invalid appType"),new z(k.INVALID_PARAMS,"invalid app type",e);Dt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){y.setLogLevel(e)},enableLogUpload:function(){V("USE_NEW_LOG")?Dt("UPLOAD_LOG",!0):y.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?Dt("UPLOAD_LOG",!1):y.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new jk},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Pe.reportApiInvoke(null,{tag:an.TRACER,name:Ln.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ln||e instanceof uu)){const u=new z(k.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof ln?e.getTrackLabel():"remote_track",r=e.getVolumeLevel();let s=r,o=r;const c=Date.now();return new ve(u=>{const p=setInterval(()=>{const m=e.getVolumeLevel();s=m>s?m:s,o=m<o?m:o;const _=s-o>1e-4,g=Date.now()-c;if(_||g>t){clearInterval(p);const v=_,D={duration:g,deviceLabel:i,maxVolumeLevel:s,result:v};y.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),u(v)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Pe.reportApiInvoke(null,{tag:an.TRACER,name:Ln.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Yt||e instanceof du)){const _=new z(k.INVALID_TRACK,"the parameter is not a video track");return n.onError(_),_.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Yt?e.getTrackLabel():"remote_track",r=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(ni()||dE())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,u=0;try{const _=Date.now();c=await function(g,v,D,C){let w,P=0,L=null;return new ve((G,W)=>{function K(){P>C&&w&&(w(),G(P));const ee=D.getContext("2d");if(!ee){const de=new z(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return y.error(de.toString()),void W(de)}ee.drawImage(g,0,0,160,120);const ae=ee.getImageData(0,0,D.width,D.height),fe=Math.floor(ae.data.length/3);if(L){for(let de=0;de<fe;de+=3)if(ae.data[de]!==L[de])return P+=1,void(L=ae.data);L=ae.data}else L=ae.data}setTimeout(()=>{w&&(w(),G(P))},v),w=jb(()=>{K()},30)})}(s,t,o,4),u=Date.now()-_}catch(_){throw n.onError(_),_}N7===vt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const p=c>4,m={duration:u,changedPicNum:c,deviceLabel:i,result:p};return y.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:Zb,audioElementPlayCenter:Gi,resumeAudioContext:function(){Gi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){z7.processExternalMediaAEC(e)},registerExtensions:function(e){const t=V("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ge(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=y.extLog,i.reporter.hookApiInvoke=Pe.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=V(r)})}),mU("PLUGIN_INFO",t)},ChannelMediaRelayError:Wd,ChannelMediaRelayEvent:pa,ChannelMediaRelayState:Xi,RemoteStreamFallbackType:F3,RemoteStreamType:V3,ConnectionDisconnectedReason:bt,AudienceLatencyLevelType:SH,AREAS:Et,preload:async function(e,t,n,i){return ax(e,t,n,i)}});return Object.defineProperties(Nn,{onAudioAutoplayFailed:{get:()=>Lr.onAudioAutoplayFailed,set:e=>{Lr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Lr.onAutoplayFailed,set:e=>{Lr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Nn._onSecurityPolicyViolation,set(e){Nn._onSecurityPolicyViolation=e,mM(e)}},__CLIENT_LIST__:{get:()=>V("SHOW_GLOBAL_CLIENT_LIST")?cl:[]}}),Pr.on(fl.CAMERA_DEVICE_CHANGED,e=>{y.info("camera device changed",JSON.stringify(e)),Nn.onCameraChanged&&Nn.onCameraChanged(e),Nn.safeEmit(Co.CAMERA_CHANGED,e)}),Pr.on(fl.RECORDING_DEVICE_CHANGED,e=>{y.info("microphone device changed",JSON.stringify(e)),Nn.onMicrophoneChanged&&Nn.onMicrophoneChanged(e),Nn.safeEmit(Co.MICROPHONE_CHANGED,e)}),Pr.on(fl.PLAYOUT_DEVICE_CHANGED,e=>{y.debug("playout device changed",JSON.stringify(e)),Nn.onPlaybackDeviceChanged&&Nn.onPlaybackDeviceChanged(e),Nn.safeEmit(Co.PLAYBACK_DEVICE_CHANGED,e)}),Gi.onAutoplayFailed=()=>{y.info("detect audio element autoplay failed"),Lr.onAudioAutoplayFailed&&Lr.onAudioAutoplayFailed()},wt.on("autoplay-failed",()=>{y.info("detect webaudio autoplay failed"),Lr.onAudioAutoplayFailed&&Lr.onAudioAutoplayFailed(),Nn.safeEmit(Co.AUTOPLAY_FAILED)}),wt.on(Qn.STATE_CHANGE,(e,t)=>{y.info("audio context state changed: ".concat(t," => ").concat(e)),Nn.onAudioContextStateChanged&&Nn.onAudioContextStateChanged(e,t),Nn.safeEmit(Co.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Tn.on(Vd.NETWORK_STATE_CHANGE,(e,t)=>{y.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Nn),Nn})})(RV);var cJ=RV.exports;const Du=Pw(cJ),lJ="46c493c48baf40cead62de60ae7efda5",dJ="007eJxTYAiZu2h1bvQKdY1z/UtDbZdaLrBblvhe5MlnzqkHuf0aVnkrMJiYJZtYGiebWCQlppkYJKcmppgZpaSaGSSmmqempSSa/tZKSm8IZGRQEl3FzMjAyMACxCA+E5hkBpMsUDI3MTOPgQEAlIoh8A==",uJ="main",hJ=()=>{const[l]=ie.useState(Du.createClient({mode:"rtc",codec:"vp8"})),[a,d]=ie.useState([]),[h,E]=ie.useState({}),[T,R]=ie.useState(!1);ie.useEffect(()=>(l.on("user-published",I),l.on("user-unpublished",j),()=>{l.removeAllListeners()}),[l]);const N=async()=>{await l.join(lJ,uJ,dJ,null);const F=await Du.createMicrophoneAndCameraTracks();d(F),F[1].play("local-video"),await l.publish(F),R(!0),console.log("Joined the room successfully!")},I=async(F,Y)=>{await l.subscribe(F,Y),Y==="video"&&(E(Z=>({...Z,[F.uid]:F.videoTrack})),F.videoTrack.play(`remote-user-${F.uid}`))},j=F=>{E(Y=>{const Z={...Y};return delete Z[F.uid],Z})},M=async()=>{for(let F of a)F.stop(),F.close();await l.leave(),d([]),E({}),R(!1),console.log("Left the room.")};return f.jsxs("div",{children:[f.jsx("h1",{children:"Join Video Call - Student"}),T?f.jsx("button",{onClick:M,style:{backgroundColor:"red",color:"white"},children:"Leave Room"}):f.jsx("button",{onClick:N,style:{backgroundColor:"blue",color:"white"},children:"Join Room"}),f.jsx("div",{id:"local-video",style:{width:"400px",height:"300px",background:"black",marginTop:"20px"}}),f.jsx("div",{id:"remote-videos",children:Object.keys(h).map(F=>f.jsx("div",{id:`remote-user-${F}`,style:{width:"400px",height:"300px",background:"gray",marginTop:"20px"}},F))})]})},Go=Object.create(null);Go.open="0";Go.close="1";Go.ping="2";Go.pong="3";Go.message="4";Go.upgrade="5";Go.noop="6";const xg=Object.create(null);Object.keys(Go).forEach(l=>{xg[Go[l]]=l});const ww={type:"error",data:"parser error"},wV=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",AV=typeof ArrayBuffer=="function",IV=l=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(l):l&&l.buffer instanceof ArrayBuffer,Kw=({type:l,data:a},d,h)=>wV&&a instanceof Blob?d?h(a):QU(a,h):AV&&(a instanceof ArrayBuffer||IV(a))?d?h(a):QU(new Blob([a]),h):h(Go[l]+(a||"")),QU=(l,a)=>{const d=new FileReader;return d.onload=function(){const h=d.result.split(",")[1];a("b"+(h||""))},d.readAsDataURL(l)};function ZU(l){return l instanceof Uint8Array?l:l instanceof ArrayBuffer?new Uint8Array(l):new Uint8Array(l.buffer,l.byteOffset,l.byteLength)}let aw;function pJ(l,a){if(wV&&l.data instanceof Blob)return l.data.arrayBuffer().then(ZU).then(a);if(AV&&(l.data instanceof ArrayBuffer||IV(l.data)))return a(ZU(l.data));Kw(l,!1,d=>{aw||(aw=new TextEncoder),a(aw.encode(d))})}const ej="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ef=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let l=0;l<ej.length;l++)Ef[ej.charCodeAt(l)]=l;const fJ=l=>{let a=l.length*.75,d=l.length,h,E=0,T,R,N,I;l[l.length-1]==="="&&(a--,l[l.length-2]==="="&&a--);const j=new ArrayBuffer(a),M=new Uint8Array(j);for(h=0;h<d;h+=4)T=Ef[l.charCodeAt(h)],R=Ef[l.charCodeAt(h+1)],N=Ef[l.charCodeAt(h+2)],I=Ef[l.charCodeAt(h+3)],M[E++]=T<<2|R>>4,M[E++]=(R&15)<<4|N>>2,M[E++]=(N&3)<<6|I&63;return j},mJ=typeof ArrayBuffer=="function",Yw=(l,a)=>{if(typeof l!="string")return{type:"message",data:OV(l,a)};const d=l.charAt(0);return d==="b"?{type:"message",data:_J(l.substring(1),a)}:xg[d]?l.length>1?{type:xg[d],data:l.substring(1)}:{type:xg[d]}:ww},_J=(l,a)=>{if(mJ){const d=fJ(l);return OV(d,a)}else return{base64:!0,data:l}},OV=(l,a)=>{switch(a){case"blob":return l instanceof Blob?l:new Blob([l]);case"arraybuffer":default:return l instanceof ArrayBuffer?l:l.buffer}},NV="",EJ=(l,a)=>{const d=l.length,h=new Array(d);let E=0;l.forEach((T,R)=>{Kw(T,!1,N=>{h[R]=N,++E===d&&a(h.join(NV))})})},gJ=(l,a)=>{const d=l.split(NV),h=[];for(let E=0;E<d.length;E++){const T=Yw(d[E],a);if(h.push(T),T.type==="error")break}return h};function SJ(){return new TransformStream({transform(l,a){pJ(l,d=>{const h=d.length;let E;if(h<126)E=new Uint8Array(1),new DataView(E.buffer).setUint8(0,h);else if(h<65536){E=new Uint8Array(3);const T=new DataView(E.buffer);T.setUint8(0,126),T.setUint16(1,h)}else{E=new Uint8Array(9);const T=new DataView(E.buffer);T.setUint8(0,127),T.setBigUint64(1,BigInt(h))}l.data&&typeof l.data!="string"&&(E[0]|=128),a.enqueue(E),a.enqueue(d)})}})}let cw;function Ng(l){return l.reduce((a,d)=>a+d.length,0)}function Dg(l,a){if(l[0].length===a)return l.shift();const d=new Uint8Array(a);let h=0;for(let E=0;E<a;E++)d[E]=l[0][h++],h===l[0].length&&(l.shift(),h=0);return l.length&&h<l[0].length&&(l[0]=l[0].slice(h)),d}function TJ(l,a){cw||(cw=new TextDecoder);const d=[];let h=0,E=-1,T=!1;return new TransformStream({transform(R,N){for(d.push(R);;){if(h===0){if(Ng(d)<1)break;const I=Dg(d,1);T=(I[0]&128)===128,E=I[0]&127,E<126?h=3:E===126?h=1:h=2}else if(h===1){if(Ng(d)<2)break;const I=Dg(d,2);E=new DataView(I.buffer,I.byteOffset,I.length).getUint16(0),h=3}else if(h===2){if(Ng(d)<8)break;const I=Dg(d,8),j=new DataView(I.buffer,I.byteOffset,I.length),M=j.getUint32(0);if(M>Math.pow(2,21)-1){N.enqueue(ww);break}E=M*Math.pow(2,32)+j.getUint32(4),h=3}else{if(Ng(d)<E)break;const I=Dg(d,E);N.enqueue(Yw(T?I:cw.decode(I),a)),h=0}if(E===0||E>l){N.enqueue(ww);break}}}})}const DV=4;function gi(l){if(l)return vJ(l)}function vJ(l){for(var a in gi.prototype)l[a]=gi.prototype[a];return l}gi.prototype.on=gi.prototype.addEventListener=function(l,a){return this._callbacks=this._callbacks||{},(this._callbacks["$"+l]=this._callbacks["$"+l]||[]).push(a),this};gi.prototype.once=function(l,a){function d(){this.off(l,d),a.apply(this,arguments)}return d.fn=a,this.on(l,d),this};gi.prototype.off=gi.prototype.removeListener=gi.prototype.removeAllListeners=gi.prototype.removeEventListener=function(l,a){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var d=this._callbacks["$"+l];if(!d)return this;if(arguments.length==1)return delete this._callbacks["$"+l],this;for(var h,E=0;E<d.length;E++)if(h=d[E],h===a||h.fn===a){d.splice(E,1);break}return d.length===0&&delete this._callbacks["$"+l],this};gi.prototype.emit=function(l){this._callbacks=this._callbacks||{};for(var a=new Array(arguments.length-1),d=this._callbacks["$"+l],h=1;h<arguments.length;h++)a[h-1]=arguments[h];if(d){d=d.slice(0);for(var h=0,E=d.length;h<E;++h)d[h].apply(this,a)}return this};gi.prototype.emitReserved=gi.prototype.emit;gi.prototype.listeners=function(l){return this._callbacks=this._callbacks||{},this._callbacks["$"+l]||[]};gi.prototype.hasListeners=function(l){return!!this.listeners(l).length};const aS=typeof Promise=="function"&&typeof Promise.resolve=="function"?a=>Promise.resolve().then(a):(a,d)=>d(a,0),Os=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),yJ="arraybuffer";function PV(l,...a){return a.reduce((d,h)=>(l.hasOwnProperty(h)&&(d[h]=l[h]),d),{})}const RJ=Os.setTimeout,bJ=Os.clearTimeout;function cS(l,a){a.useNativeTimers?(l.setTimeoutFn=RJ.bind(Os),l.clearTimeoutFn=bJ.bind(Os)):(l.setTimeoutFn=Os.setTimeout.bind(Os),l.clearTimeoutFn=Os.clearTimeout.bind(Os))}const CJ=1.33;function wJ(l){return typeof l=="string"?AJ(l):Math.ceil((l.byteLength||l.size)*CJ)}function AJ(l){let a=0,d=0;for(let h=0,E=l.length;h<E;h++)a=l.charCodeAt(h),a<128?d+=1:a<2048?d+=2:a<55296||a>=57344?d+=3:(h++,d+=4);return d}function LV(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function IJ(l){let a="";for(let d in l)l.hasOwnProperty(d)&&(a.length&&(a+="&"),a+=encodeURIComponent(d)+"="+encodeURIComponent(l[d]));return a}function OJ(l){let a={},d=l.split("&");for(let h=0,E=d.length;h<E;h++){let T=d[h].split("=");a[decodeURIComponent(T[0])]=decodeURIComponent(T[1])}return a}class NJ extends Error{constructor(a,d,h){super(a),this.description=d,this.context=h,this.type="TransportError"}}class zw extends gi{constructor(a){super(),this.writable=!1,cS(this,a),this.opts=a,this.query=a.query,this.socket=a.socket,this.supportsBinary=!a.forceBase64}onError(a,d,h){return super.emitReserved("error",new NJ(a,d,h)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(a){this.readyState==="open"&&this.write(a)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(a){const d=Yw(a,this.socket.binaryType);this.onPacket(d)}onPacket(a){super.emitReserved("packet",a)}onClose(a){this.readyState="closed",super.emitReserved("close",a)}pause(a){}createUri(a,d={}){return a+"://"+this._hostname()+this._port()+this.opts.path+this._query(d)}_hostname(){const a=this.opts.hostname;return a.indexOf(":")===-1?a:"["+a+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(a){const d=IJ(a);return d.length?"?"+d:""}}class DJ extends zw{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(a){this.readyState="pausing";const d=()=>{this.readyState="paused",a()};if(this._polling||!this.writable){let h=0;this._polling&&(h++,this.once("pollComplete",function(){--h||d()})),this.writable||(h++,this.once("drain",function(){--h||d()}))}else d()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(a){const d=h=>{if(this.readyState==="opening"&&h.type==="open"&&this.onOpen(),h.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(h)};gJ(a,this.socket.binaryType).forEach(d),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const a=()=>{this.write([{type:"close"}])};this.readyState==="open"?a():this.once("open",a)}write(a){this.writable=!1,EJ(a,d=>{this.doWrite(d,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const a=this.opts.secure?"https":"http",d=this.query||{};return this.opts.timestampRequests!==!1&&(d[this.opts.timestampParam]=LV()),!this.supportsBinary&&!d.sid&&(d.b64=1),this.createUri(a,d)}}let kV=!1;try{kV=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const PJ=kV;function LJ(){}class kJ extends DJ{constructor(a){if(super(a),typeof location<"u"){const d=location.protocol==="https:";let h=location.port;h||(h=d?"443":"80"),this.xd=typeof location<"u"&&a.hostname!==location.hostname||h!==a.port}}doWrite(a,d){const h=this.request({method:"POST",data:a});h.on("success",d),h.on("error",(E,T)=>{this.onError("xhr post error",E,T)})}doPoll(){const a=this.request();a.on("data",this.onData.bind(this)),a.on("error",(d,h)=>{this.onError("xhr poll error",d,h)}),this.pollXhr=a}}let Lu=class Mg extends gi{constructor(a,d,h){super(),this.createRequest=a,cS(this,h),this._opts=h,this._method=h.method||"GET",this._uri=d,this._data=h.data!==void 0?h.data:null,this._create()}_create(){var a;const d=PV(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");d.xdomain=!!this._opts.xd;const h=this._xhr=this.createRequest(d);try{h.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){h.setDisableHeaderCheck&&h.setDisableHeaderCheck(!0);for(let E in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(E)&&h.setRequestHeader(E,this._opts.extraHeaders[E])}}catch{}if(this._method==="POST")try{h.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{h.setRequestHeader("Accept","*/*")}catch{}(a=this._opts.cookieJar)===null||a===void 0||a.addCookies(h),"withCredentials"in h&&(h.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(h.timeout=this._opts.requestTimeout),h.onreadystatechange=()=>{var E;h.readyState===3&&((E=this._opts.cookieJar)===null||E===void 0||E.parseCookies(h.getResponseHeader("set-cookie"))),h.readyState===4&&(h.status===200||h.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof h.status=="number"?h.status:0)},0))},h.send(this._data)}catch(E){this.setTimeoutFn(()=>{this._onError(E)},0);return}typeof document<"u"&&(this._index=Mg.requestsCount++,Mg.requests[this._index]=this)}_onError(a){this.emitReserved("error",a,this._xhr),this._cleanup(!0)}_cleanup(a){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=LJ,a)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Mg.requests[this._index],this._xhr=null}}_onLoad(){const a=this._xhr.responseText;a!==null&&(this.emitReserved("data",a),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Lu.requestsCount=0;Lu.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",tj);else if(typeof addEventListener=="function"){const l="onpagehide"in Os?"pagehide":"unload";addEventListener(l,tj,!1)}}function tj(){for(let l in Lu.requests)Lu.requests.hasOwnProperty(l)&&Lu.requests[l].abort()}const xJ=function(){const l=xV({xdomain:!1});return l&&l.responseType!==null}();class MJ extends kJ{constructor(a){super(a);const d=a&&a.forceBase64;this.supportsBinary=xJ&&!d}request(a={}){return Object.assign(a,{xd:this.xd},this.opts),new Lu(xV,this.uri(),a)}}function xV(l){const a=l.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!a||PJ))return new XMLHttpRequest}catch{}if(!a)try{return new Os[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const MV=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class UJ extends zw{get name(){return"websocket"}doOpen(){const a=this.uri(),d=this.opts.protocols,h=MV?{}:PV(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(h.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(a,d,h)}catch(E){return this.emitReserved("error",E)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=a=>this.onClose({description:"websocket connection closed",context:a}),this.ws.onmessage=a=>this.onData(a.data),this.ws.onerror=a=>this.onError("websocket error",a)}write(a){this.writable=!1;for(let d=0;d<a.length;d++){const h=a[d],E=d===a.length-1;Kw(h,this.supportsBinary,T=>{try{this.doWrite(h,T)}catch{}E&&aS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const a=this.opts.secure?"wss":"ws",d=this.query||{};return this.opts.timestampRequests&&(d[this.opts.timestampParam]=LV()),this.supportsBinary||(d.b64=1),this.createUri(a,d)}}const lw=Os.WebSocket||Os.MozWebSocket;class jJ extends UJ{createSocket(a,d,h){return MV?new lw(a,d,h):d?new lw(a,d):new lw(a)}doWrite(a,d){this.ws.send(d)}}class VJ extends zw{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(a){return this.emitReserved("error",a)}this._transport.closed.then(()=>{this.onClose()}).catch(a=>{this.onError("webtransport error",a)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(a=>{const d=TJ(Number.MAX_SAFE_INTEGER,this.socket.binaryType),h=a.readable.pipeThrough(d).getReader(),E=SJ();E.readable.pipeTo(a.writable),this._writer=E.writable.getWriter();const T=()=>{h.read().then(({done:N,value:I})=>{N||(this.onPacket(I),T())}).catch(N=>{})};T();const R={type:"open"};this.query.sid&&(R.data=`{"sid":"${this.query.sid}"}`),this._writer.write(R).then(()=>this.onOpen())})})}write(a){this.writable=!1;for(let d=0;d<a.length;d++){const h=a[d],E=d===a.length-1;this._writer.write(h).then(()=>{E&&aS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var a;(a=this._transport)===null||a===void 0||a.close()}}const FJ={websocket:jJ,webtransport:VJ,polling:MJ},BJ=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,GJ=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Aw(l){if(l.length>8e3)throw"URI too long";const a=l,d=l.indexOf("["),h=l.indexOf("]");d!=-1&&h!=-1&&(l=l.substring(0,d)+l.substring(d,h).replace(/:/g,";")+l.substring(h,l.length));let E=BJ.exec(l||""),T={},R=14;for(;R--;)T[GJ[R]]=E[R]||"";return d!=-1&&h!=-1&&(T.source=a,T.host=T.host.substring(1,T.host.length-1).replace(/;/g,":"),T.authority=T.authority.replace("[","").replace("]","").replace(/;/g,":"),T.ipv6uri=!0),T.pathNames=HJ(T,T.path),T.queryKey=WJ(T,T.query),T}function HJ(l,a){const d=/\/{2,9}/g,h=a.replace(d,"/").split("/");return(a.slice(0,1)=="/"||a.length===0)&&h.splice(0,1),a.slice(-1)=="/"&&h.splice(h.length-1,1),h}function WJ(l,a){const d={};return a.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(h,E,T){E&&(d[E]=T)}),d}const Iw=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ug=[];Iw&&addEventListener("offline",()=>{Ug.forEach(l=>l())},!1);class kc extends gi{constructor(a,d){if(super(),this.binaryType=yJ,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,a&&typeof a=="object"&&(d=a,a=null),a){const h=Aw(a);d.hostname=h.host,d.secure=h.protocol==="https"||h.protocol==="wss",d.port=h.port,h.query&&(d.query=h.query)}else d.host&&(d.hostname=Aw(d.host).host);cS(this,d),this.secure=d.secure!=null?d.secure:typeof location<"u"&&location.protocol==="https:",d.hostname&&!d.port&&(d.port=this.secure?"443":"80"),this.hostname=d.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=d.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},d.transports.forEach(h=>{const E=h.prototype.name;this.transports.push(E),this._transportsByName[E]=h}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},d),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=OJ(this.opts.query)),Iw&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ug.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(a){const d=Object.assign({},this.opts.query);d.EIO=DV,d.transport=a,this.id&&(d.sid=this.id);const h=Object.assign({},this.opts,{query:d,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[a]);return new this._transportsByName[a](h)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const a=this.opts.rememberUpgrade&&kc.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const d=this.createTransport(a);d.open(),this.setTransport(d)}setTransport(a){this.transport&&this.transport.removeAllListeners(),this.transport=a,a.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",d=>this._onClose("transport close",d))}onOpen(){this.readyState="open",kc.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",a),this.emitReserved("heartbeat"),a.type){case"open":this.onHandshake(JSON.parse(a.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const d=new Error("server error");d.code=a.data,this._onError(d);break;case"message":this.emitReserved("data",a.data),this.emitReserved("message",a.data);break}}onHandshake(a){this.emitReserved("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this._pingInterval=a.pingInterval,this._pingTimeout=a.pingTimeout,this._maxPayload=a.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const a=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+a,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},a),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const a=this._getWritablePackets();this.transport.send(a),this._prevBufferLen=a.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let d=1;for(let h=0;h<this.writeBuffer.length;h++){const E=this.writeBuffer[h].data;if(E&&(d+=wJ(E)),h>0&&d>this._maxPayload)return this.writeBuffer.slice(0,h);d+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const a=Date.now()>this._pingTimeoutTime;return a&&(this._pingTimeoutTime=0,aS(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),a}write(a,d,h){return this._sendPacket("message",a,d,h),this}send(a,d,h){return this._sendPacket("message",a,d,h),this}_sendPacket(a,d,h,E){if(typeof d=="function"&&(E=d,d=void 0),typeof h=="function"&&(E=h,h=null),this.readyState==="closing"||this.readyState==="closed")return;h=h||{},h.compress=h.compress!==!1;const T={type:a,data:d,options:h};this.emitReserved("packetCreate",T),this.writeBuffer.push(T),E&&this.once("flush",E),this.flush()}close(){const a=()=>{this._onClose("forced close"),this.transport.close()},d=()=>{this.off("upgrade",d),this.off("upgradeError",d),a()},h=()=>{this.once("upgrade",d),this.once("upgradeError",d)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?h():a()}):this.upgrading?h():a()),this}_onError(a){if(kc.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",a),this._onClose("transport error",a)}_onClose(a,d){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Iw&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const h=Ug.indexOf(this._offlineEventListener);h!==-1&&Ug.splice(h,1)}this.readyState="closed",this.id=null,this.emitReserved("close",a,d),this.writeBuffer=[],this._prevBufferLen=0}}}kc.protocol=DV;class KJ extends kc{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let a=0;a<this._upgrades.length;a++)this._probe(this._upgrades[a])}_probe(a){let d=this.createTransport(a),h=!1;kc.priorWebsocketSuccess=!1;const E=()=>{h||(d.send([{type:"ping",data:"probe"}]),d.once("packet",F=>{if(!h)if(F.type==="pong"&&F.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",d),!d)return;kc.priorWebsocketSuccess=d.name==="websocket",this.transport.pause(()=>{h||this.readyState!=="closed"&&(M(),this.setTransport(d),d.send([{type:"upgrade"}]),this.emitReserved("upgrade",d),d=null,this.upgrading=!1,this.flush())})}else{const Y=new Error("probe error");Y.transport=d.name,this.emitReserved("upgradeError",Y)}}))};function T(){h||(h=!0,M(),d.close(),d=null)}const R=F=>{const Y=new Error("probe error: "+F);Y.transport=d.name,T(),this.emitReserved("upgradeError",Y)};function N(){R("transport closed")}function I(){R("socket closed")}function j(F){d&&F.name!==d.name&&T()}const M=()=>{d.removeListener("open",E),d.removeListener("error",R),d.removeListener("close",N),this.off("close",I),this.off("upgrading",j)};d.once("open",E),d.once("error",R),d.once("close",N),this.once("close",I),this.once("upgrading",j),this._upgrades.indexOf("webtransport")!==-1&&a!=="webtransport"?this.setTimeoutFn(()=>{h||d.open()},200):d.open()}onHandshake(a){this._upgrades=this._filterUpgrades(a.upgrades),super.onHandshake(a)}_filterUpgrades(a){const d=[];for(let h=0;h<a.length;h++)~this.transports.indexOf(a[h])&&d.push(a[h]);return d}}let YJ=class extends KJ{constructor(a,d={}){const h=typeof a=="object"?a:d;(!h.transports||h.transports&&typeof h.transports[0]=="string")&&(h.transports=(h.transports||["polling","websocket","webtransport"]).map(E=>FJ[E]).filter(E=>!!E)),super(a,h)}};function zJ(l,a="",d){let h=l;d=d||typeof location<"u"&&location,l==null&&(l=d.protocol+"//"+d.host),typeof l=="string"&&(l.charAt(0)==="/"&&(l.charAt(1)==="/"?l=d.protocol+l:l=d.host+l),/^(https?|wss?):\/\//.test(l)||(typeof d<"u"?l=d.protocol+"//"+l:l="https://"+l),h=Aw(l)),h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443")),h.path=h.path||"/";const T=h.host.indexOf(":")!==-1?"["+h.host+"]":h.host;return h.id=h.protocol+"://"+T+":"+h.port+a,h.href=h.protocol+"://"+T+(d&&d.port===h.port?"":":"+h.port),h}const qJ=typeof ArrayBuffer=="function",$J=l=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(l):l.buffer instanceof ArrayBuffer,UV=Object.prototype.toString,JJ=typeof Blob=="function"||typeof Blob<"u"&&UV.call(Blob)==="[object BlobConstructor]",XJ=typeof File=="function"||typeof File<"u"&&UV.call(File)==="[object FileConstructor]";function qw(l){return qJ&&(l instanceof ArrayBuffer||$J(l))||JJ&&l instanceof Blob||XJ&&l instanceof File}function jg(l,a){if(!l||typeof l!="object")return!1;if(Array.isArray(l)){for(let d=0,h=l.length;d<h;d++)if(jg(l[d]))return!0;return!1}if(qw(l))return!0;if(l.toJSON&&typeof l.toJSON=="function"&&arguments.length===1)return jg(l.toJSON(),!0);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d)&&jg(l[d]))return!0;return!1}function QJ(l){const a=[],d=l.data,h=l;return h.data=Ow(d,a),h.attachments=a.length,{packet:h,buffers:a}}function Ow(l,a){if(!l)return l;if(qw(l)){const d={_placeholder:!0,num:a.length};return a.push(l),d}else if(Array.isArray(l)){const d=new Array(l.length);for(let h=0;h<l.length;h++)d[h]=Ow(l[h],a);return d}else if(typeof l=="object"&&!(l instanceof Date)){const d={};for(const h in l)Object.prototype.hasOwnProperty.call(l,h)&&(d[h]=Ow(l[h],a));return d}return l}function ZJ(l,a){return l.data=Nw(l.data,a),delete l.attachments,l}function Nw(l,a){if(!l)return l;if(l&&l._placeholder===!0){if(typeof l.num=="number"&&l.num>=0&&l.num<a.length)return a[l.num];throw new Error("illegal attachments")}else if(Array.isArray(l))for(let d=0;d<l.length;d++)l[d]=Nw(l[d],a);else if(typeof l=="object")for(const d in l)Object.prototype.hasOwnProperty.call(l,d)&&(l[d]=Nw(l[d],a));return l}const eX=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],tX=5;var Xt;(function(l){l[l.CONNECT=0]="CONNECT",l[l.DISCONNECT=1]="DISCONNECT",l[l.EVENT=2]="EVENT",l[l.ACK=3]="ACK",l[l.CONNECT_ERROR=4]="CONNECT_ERROR",l[l.BINARY_EVENT=5]="BINARY_EVENT",l[l.BINARY_ACK=6]="BINARY_ACK"})(Xt||(Xt={}));class nX{constructor(a){this.replacer=a}encode(a){return(a.type===Xt.EVENT||a.type===Xt.ACK)&&jg(a)?this.encodeAsBinary({type:a.type===Xt.EVENT?Xt.BINARY_EVENT:Xt.BINARY_ACK,nsp:a.nsp,data:a.data,id:a.id}):[this.encodeAsString(a)]}encodeAsString(a){let d=""+a.type;return(a.type===Xt.BINARY_EVENT||a.type===Xt.BINARY_ACK)&&(d+=a.attachments+"-"),a.nsp&&a.nsp!=="/"&&(d+=a.nsp+","),a.id!=null&&(d+=a.id),a.data!=null&&(d+=JSON.stringify(a.data,this.replacer)),d}encodeAsBinary(a){const d=QJ(a),h=this.encodeAsString(d.packet),E=d.buffers;return E.unshift(h),E}}function nj(l){return Object.prototype.toString.call(l)==="[object Object]"}class $w extends gi{constructor(a){super(),this.reviver=a}add(a){let d;if(typeof a=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");d=this.decodeString(a);const h=d.type===Xt.BINARY_EVENT;h||d.type===Xt.BINARY_ACK?(d.type=h?Xt.EVENT:Xt.ACK,this.reconstructor=new iX(d),d.attachments===0&&super.emitReserved("decoded",d)):super.emitReserved("decoded",d)}else if(qw(a)||a.base64)if(this.reconstructor)d=this.reconstructor.takeBinaryData(a),d&&(this.reconstructor=null,super.emitReserved("decoded",d));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+a)}decodeString(a){let d=0;const h={type:Number(a.charAt(0))};if(Xt[h.type]===void 0)throw new Error("unknown packet type "+h.type);if(h.type===Xt.BINARY_EVENT||h.type===Xt.BINARY_ACK){const T=d+1;for(;a.charAt(++d)!=="-"&&d!=a.length;);const R=a.substring(T,d);if(R!=Number(R)||a.charAt(d)!=="-")throw new Error("Illegal attachments");h.attachments=Number(R)}if(a.charAt(d+1)==="/"){const T=d+1;for(;++d&&!(a.charAt(d)===","||d===a.length););h.nsp=a.substring(T,d)}else h.nsp="/";const E=a.charAt(d+1);if(E!==""&&Number(E)==E){const T=d+1;for(;++d;){const R=a.charAt(d);if(R==null||Number(R)!=R){--d;break}if(d===a.length)break}h.id=Number(a.substring(T,d+1))}if(a.charAt(++d)){const T=this.tryParse(a.substr(d));if($w.isPayloadValid(h.type,T))h.data=T;else throw new Error("invalid payload")}return h}tryParse(a){try{return JSON.parse(a,this.reviver)}catch{return!1}}static isPayloadValid(a,d){switch(a){case Xt.CONNECT:return nj(d);case Xt.DISCONNECT:return d===void 0;case Xt.CONNECT_ERROR:return typeof d=="string"||nj(d);case Xt.EVENT:case Xt.BINARY_EVENT:return Array.isArray(d)&&(typeof d[0]=="number"||typeof d[0]=="string"&&eX.indexOf(d[0])===-1);case Xt.ACK:case Xt.BINARY_ACK:return Array.isArray(d)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class iX{constructor(a){this.packet=a,this.buffers=[],this.reconPack=a}takeBinaryData(a){if(this.buffers.push(a),this.buffers.length===this.reconPack.attachments){const d=ZJ(this.reconPack,this.buffers);return this.finishedReconstruction(),d}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const rX=Object.freeze(Object.defineProperty({__proto__:null,Decoder:$w,Encoder:nX,get PacketType(){return Xt},protocol:tX},Symbol.toStringTag,{value:"Module"}));function no(l,a,d){return l.on(a,d),function(){l.off(a,d)}}const sX=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class jV extends gi{constructor(a,d,h){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=a,this.nsp=d,h&&h.auth&&(this.auth=h.auth),this._opts=Object.assign({},h),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const a=this.io;this.subs=[no(a,"open",this.onopen.bind(this)),no(a,"packet",this.onpacket.bind(this)),no(a,"error",this.onerror.bind(this)),no(a,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...a){return a.unshift("message"),this.emit.apply(this,a),this}emit(a,...d){var h,E,T;if(sX.hasOwnProperty(a))throw new Error('"'+a.toString()+'" is a reserved event name');if(d.unshift(a),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(d),this;const R={type:Xt.EVENT,data:d};if(R.options={},R.options.compress=this.flags.compress!==!1,typeof d[d.length-1]=="function"){const M=this.ids++,F=d.pop();this._registerAckCallback(M,F),R.id=M}const N=(E=(h=this.io.engine)===null||h===void 0?void 0:h.transport)===null||E===void 0?void 0:E.writable,I=this.connected&&!(!((T=this.io.engine)===null||T===void 0)&&T._hasPingExpired());return this.flags.volatile&&!N||(I?(this.notifyOutgoingListeners(R),this.packet(R)):this.sendBuffer.push(R)),this.flags={},this}_registerAckCallback(a,d){var h;const E=(h=this.flags.timeout)!==null&&h!==void 0?h:this._opts.ackTimeout;if(E===void 0){this.acks[a]=d;return}const T=this.io.setTimeoutFn(()=>{delete this.acks[a];for(let N=0;N<this.sendBuffer.length;N++)this.sendBuffer[N].id===a&&this.sendBuffer.splice(N,1);d.call(this,new Error("operation has timed out"))},E),R=(...N)=>{this.io.clearTimeoutFn(T),d.apply(this,N)};R.withError=!0,this.acks[a]=R}emitWithAck(a,...d){return new Promise((h,E)=>{const T=(R,N)=>R?E(R):h(N);T.withError=!0,d.push(T),this.emit(a,...d)})}_addToQueue(a){let d;typeof a[a.length-1]=="function"&&(d=a.pop());const h={id:this._queueSeq++,tryCount:0,pending:!1,args:a,flags:Object.assign({fromQueue:!0},this.flags)};a.push((E,...T)=>h!==this._queue[0]?void 0:(E!==null?h.tryCount>this._opts.retries&&(this._queue.shift(),d&&d(E)):(this._queue.shift(),d&&d(null,...T)),h.pending=!1,this._drainQueue())),this._queue.push(h),this._drainQueue()}_drainQueue(a=!1){if(!this.connected||this._queue.length===0)return;const d=this._queue[0];d.pending&&!a||(d.pending=!0,d.tryCount++,this.flags=d.flags,this.emit.apply(this,d.args))}packet(a){a.nsp=this.nsp,this.io._packet(a)}onopen(){typeof this.auth=="function"?this.auth(a=>{this._sendConnectPacket(a)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(a){this.packet({type:Xt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},a):a})}onerror(a){this.connected||this.emitReserved("connect_error",a)}onclose(a,d){this.connected=!1,delete this.id,this.emitReserved("disconnect",a,d),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(a=>{if(!this.sendBuffer.some(h=>String(h.id)===a)){const h=this.acks[a];delete this.acks[a],h.withError&&h.call(this,new Error("socket has been disconnected"))}})}onpacket(a){if(a.nsp===this.nsp)switch(a.type){case Xt.CONNECT:a.data&&a.data.sid?this.onconnect(a.data.sid,a.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Xt.EVENT:case Xt.BINARY_EVENT:this.onevent(a);break;case Xt.ACK:case Xt.BINARY_ACK:this.onack(a);break;case Xt.DISCONNECT:this.ondisconnect();break;case Xt.CONNECT_ERROR:this.destroy();const h=new Error(a.data.message);h.data=a.data.data,this.emitReserved("connect_error",h);break}}onevent(a){const d=a.data||[];a.id!=null&&d.push(this.ack(a.id)),this.connected?this.emitEvent(d):this.receiveBuffer.push(Object.freeze(d))}emitEvent(a){if(this._anyListeners&&this._anyListeners.length){const d=this._anyListeners.slice();for(const h of d)h.apply(this,a)}super.emit.apply(this,a),this._pid&&a.length&&typeof a[a.length-1]=="string"&&(this._lastOffset=a[a.length-1])}ack(a){const d=this;let h=!1;return function(...E){h||(h=!0,d.packet({type:Xt.ACK,id:a,data:E}))}}onack(a){const d=this.acks[a.id];typeof d=="function"&&(delete this.acks[a.id],d.withError&&a.data.unshift(null),d.apply(this,a.data))}onconnect(a,d){this.id=a,this.recovered=d&&this._pid===d,this._pid=d,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(a=>this.emitEvent(a)),this.receiveBuffer=[],this.sendBuffer.forEach(a=>{this.notifyOutgoingListeners(a),this.packet(a)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(a=>a()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Xt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(a){return this.flags.compress=a,this}get volatile(){return this.flags.volatile=!0,this}timeout(a){return this.flags.timeout=a,this}onAny(a){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(a),this}prependAny(a){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(a),this}offAny(a){if(!this._anyListeners)return this;if(a){const d=this._anyListeners;for(let h=0;h<d.length;h++)if(a===d[h])return d.splice(h,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(a){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(a),this}prependAnyOutgoing(a){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(a),this}offAnyOutgoing(a){if(!this._anyOutgoingListeners)return this;if(a){const d=this._anyOutgoingListeners;for(let h=0;h<d.length;h++)if(a===d[h])return d.splice(h,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(a){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const d=this._anyOutgoingListeners.slice();for(const h of d)h.apply(this,a.data)}}}function Vu(l){l=l||{},this.ms=l.min||100,this.max=l.max||1e4,this.factor=l.factor||2,this.jitter=l.jitter>0&&l.jitter<=1?l.jitter:0,this.attempts=0}Vu.prototype.duration=function(){var l=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),d=Math.floor(a*this.jitter*l);l=Math.floor(a*10)&1?l+d:l-d}return Math.min(l,this.max)|0};Vu.prototype.reset=function(){this.attempts=0};Vu.prototype.setMin=function(l){this.ms=l};Vu.prototype.setMax=function(l){this.max=l};Vu.prototype.setJitter=function(l){this.jitter=l};class Dw extends gi{constructor(a,d){var h;super(),this.nsps={},this.subs=[],a&&typeof a=="object"&&(d=a,a=void 0),d=d||{},d.path=d.path||"/socket.io",this.opts=d,cS(this,d),this.reconnection(d.reconnection!==!1),this.reconnectionAttempts(d.reconnectionAttempts||1/0),this.reconnectionDelay(d.reconnectionDelay||1e3),this.reconnectionDelayMax(d.reconnectionDelayMax||5e3),this.randomizationFactor((h=d.randomizationFactor)!==null&&h!==void 0?h:.5),this.backoff=new Vu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(d.timeout==null?2e4:d.timeout),this._readyState="closed",this.uri=a;const E=d.parser||rX;this.encoder=new E.Encoder,this.decoder=new E.Decoder,this._autoConnect=d.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(a){return arguments.length?(this._reconnection=!!a,a||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(a){return a===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=a,this)}reconnectionDelay(a){var d;return a===void 0?this._reconnectionDelay:(this._reconnectionDelay=a,(d=this.backoff)===null||d===void 0||d.setMin(a),this)}randomizationFactor(a){var d;return a===void 0?this._randomizationFactor:(this._randomizationFactor=a,(d=this.backoff)===null||d===void 0||d.setJitter(a),this)}reconnectionDelayMax(a){var d;return a===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=a,(d=this.backoff)===null||d===void 0||d.setMax(a),this)}timeout(a){return arguments.length?(this._timeout=a,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(a){if(~this._readyState.indexOf("open"))return this;this.engine=new YJ(this.uri,this.opts);const d=this.engine,h=this;this._readyState="opening",this.skipReconnect=!1;const E=no(d,"open",function(){h.onopen(),a&&a()}),T=N=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",N),a?a(N):this.maybeReconnectOnOpen()},R=no(d,"error",T);if(this._timeout!==!1){const N=this._timeout,I=this.setTimeoutFn(()=>{E(),T(new Error("timeout")),d.close()},N);this.opts.autoUnref&&I.unref(),this.subs.push(()=>{this.clearTimeoutFn(I)})}return this.subs.push(E),this.subs.push(R),this}connect(a){return this.open(a)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const a=this.engine;this.subs.push(no(a,"ping",this.onping.bind(this)),no(a,"data",this.ondata.bind(this)),no(a,"error",this.onerror.bind(this)),no(a,"close",this.onclose.bind(this)),no(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(a){try{this.decoder.add(a)}catch(d){this.onclose("parse error",d)}}ondecoded(a){aS(()=>{this.emitReserved("packet",a)},this.setTimeoutFn)}onerror(a){this.emitReserved("error",a)}socket(a,d){let h=this.nsps[a];return h?this._autoConnect&&!h.active&&h.connect():(h=new jV(this,a,d),this.nsps[a]=h),h}_destroy(a){const d=Object.keys(this.nsps);for(const h of d)if(this.nsps[h].active)return;this._close()}_packet(a){const d=this.encoder.encode(a);for(let h=0;h<d.length;h++)this.engine.write(d[h],a.options)}cleanup(){this.subs.forEach(a=>a()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(a,d){var h;this.cleanup(),(h=this.engine)===null||h===void 0||h.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",a,d),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const a=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const d=this.backoff.duration();this._reconnecting=!0;const h=this.setTimeoutFn(()=>{a.skipReconnect||(this.emitReserved("reconnect_attempt",a.backoff.attempts),!a.skipReconnect&&a.open(E=>{E?(a._reconnecting=!1,a.reconnect(),this.emitReserved("reconnect_error",E)):a.onreconnect()}))},d);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}}onreconnect(){const a=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",a)}}const pf={};function Vg(l,a){typeof l=="object"&&(a=l,l=void 0),a=a||{};const d=zJ(l,a.path||"/socket.io"),h=d.source,E=d.id,T=d.path,R=pf[E]&&T in pf[E].nsps,N=a.forceNew||a["force new connection"]||a.multiplex===!1||R;let I;return N?I=new Dw(h,a):(pf[E]||(pf[E]=new Dw(h,a)),I=pf[E]),d.query&&!a.query&&(a.query=d.queryKey),I.socket(d.path,a)}Object.assign(Vg,{Manager:Dw,Socket:jV,io:Vg,connect:Vg});var VV={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(l){(function(){var a={}.hasOwnProperty;function d(){for(var T="",R=0;R<arguments.length;R++){var N=arguments[R];N&&(T=E(T,h(N)))}return T}function h(T){if(typeof T=="string"||typeof T=="number")return T;if(typeof T!="object")return"";if(Array.isArray(T))return d.apply(null,T);if(T.toString!==Object.prototype.toString&&!T.toString.toString().includes("[native code]"))return T.toString();var R="";for(var N in T)a.call(T,N)&&T[N]&&(R=E(R,N));return R}function E(T,R){return R?T?T+" "+R:T+R:T}l.exports?(d.default=d,l.exports=d):window.classNames=d})()})(VV);var oX=VV.exports;const Pn=Pw(oX),aX=["xxl","xl","lg","md","sm","xs"],cX="xs",Jw=ie.createContext({prefixes:{},breakpoints:aX,minBreakpoint:cX});function Bn(l,a){const{prefixes:d}=ie.useContext(Jw);return l||d[a]||a}function FV(){const{breakpoints:l}=ie.useContext(Jw);return l}function BV(){const{minBreakpoint:l}=ie.useContext(Jw);return l}var GV={exports:{}},lX="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",dX=lX,uX=dX;function HV(){}function WV(){}WV.resetWarningCache=HV;var hX=function(){function l(h,E,T,R,N,I){if(I!==uX){var j=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw j.name="Invariant Violation",j}}l.isRequired=l;function a(){return l}var d={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:a,element:l,elementType:l,instanceOf:a,node:l,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:WV,resetWarningCache:HV};return d.PropTypes=d,d};GV.exports=hX();var pX=GV.exports;const ku=Pw(pX),KV=l=>ie.forwardRef((a,d)=>f.jsx("div",{...a,ref:d,className:Pn(a.className,l)})),fX=["as","disabled"];function mX(l,a){if(l==null)return{};var d={};for(var h in l)if({}.hasOwnProperty.call(l,h)){if(a.indexOf(h)>=0)continue;d[h]=l[h]}return d}function _X(l){return!l||l.trim()==="#"}function YV({tagName:l,disabled:a,href:d,target:h,rel:E,role:T,onClick:R,tabIndex:N=0,type:I}){l||(d!=null||h!=null||E!=null?l="a":l="button");const j={tagName:l};if(l==="button")return[{type:I||"button",disabled:a},j];const M=Y=>{if((a||l==="a"&&_X(d))&&Y.preventDefault(),a){Y.stopPropagation();return}R==null||R(Y)},F=Y=>{Y.key===" "&&(Y.preventDefault(),M(Y))};return l==="a"&&(d||(d="#"),a&&(d=void 0)),[{role:T??"button",disabled:void 0,tabIndex:a?void 0:N,href:d,target:l==="a"?h:void 0,"aria-disabled":a||void 0,rel:l==="a"?E:void 0,onClick:M,onKeyDown:F},j]}const EX=ie.forwardRef((l,a)=>{let{as:d,disabled:h}=l,E=mX(l,fX);const[T,{tagName:R}]=YV(Object.assign({tagName:d,disabled:h},E));return f.jsx(R,Object.assign({},E,T,{ref:a}))});EX.displayName="Button";const zV=ie.forwardRef(({as:l,bsPrefix:a,variant:d="primary",size:h,active:E=!1,disabled:T=!1,className:R,...N},I)=>{const j=Bn(a,"btn"),[M,{tagName:F}]=YV({tagName:l,disabled:T,...N}),Y=F;return f.jsx(Y,{...M,...N,ref:I,disabled:T,className:Pn(R,j,E&&"active",d&&`${j}-${d}`,h&&`${j}-${h}`,N.href&&T&&"disabled")})});zV.displayName="Button";const Xw=ie.forwardRef(({className:l,bsPrefix:a,as:d="div",...h},E)=>(a=Bn(a,"card-body"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));Xw.displayName="CardBody";const qV=ie.forwardRef(({className:l,bsPrefix:a,as:d="div",...h},E)=>(a=Bn(a,"card-footer"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));qV.displayName="CardFooter";const $V=ie.createContext(null);$V.displayName="CardHeaderContext";const JV=ie.forwardRef(({bsPrefix:l,className:a,as:d="div",...h},E)=>{const T=Bn(l,"card-header"),R=ie.useMemo(()=>({cardHeaderBsPrefix:T}),[T]);return f.jsx($V.Provider,{value:R,children:f.jsx(d,{ref:E,...h,className:Pn(a,T)})})});JV.displayName="CardHeader";const XV=ie.forwardRef(({bsPrefix:l,className:a,variant:d,as:h="img",...E},T)=>{const R=Bn(l,"card-img");return f.jsx(h,{ref:T,className:Pn(d?`${R}-${d}`:R,a),...E})});XV.displayName="CardImg";const QV=ie.forwardRef(({className:l,bsPrefix:a,as:d="div",...h},E)=>(a=Bn(a,"card-img-overlay"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));QV.displayName="CardImgOverlay";const ZV=ie.forwardRef(({className:l,bsPrefix:a,as:d="a",...h},E)=>(a=Bn(a,"card-link"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));ZV.displayName="CardLink";const gX=KV("h6"),eF=ie.forwardRef(({className:l,bsPrefix:a,as:d=gX,...h},E)=>(a=Bn(a,"card-subtitle"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));eF.displayName="CardSubtitle";const tF=ie.forwardRef(({className:l,bsPrefix:a,as:d="p",...h},E)=>(a=Bn(a,"card-text"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));tF.displayName="CardText";const SX=KV("h5"),nF=ie.forwardRef(({className:l,bsPrefix:a,as:d=SX,...h},E)=>(a=Bn(a,"card-title"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));nF.displayName="CardTitle";const iF=ie.forwardRef(({bsPrefix:l,className:a,bg:d,text:h,border:E,body:T=!1,children:R,as:N="div",...I},j)=>{const M=Bn(l,"card");return f.jsx(N,{ref:j,...I,className:Pn(a,M,d&&`bg-${d}`,h&&`text-${h}`,E&&`border-${E}`),children:T?f.jsx(Xw,{children:R}):R})});iF.displayName="Card";const ij=Object.assign(iF,{Img:XV,Title:nF,Subtitle:eF,Body:Xw,Link:ZV,Text:tF,Header:JV,Footer:qV,ImgOverlay:QV});function TX(l,a){return ie.Children.toArray(l).some(d=>ie.isValidElement(d)&&d.type===a)}function vX({as:l,bsPrefix:a,className:d,...h}){a=Bn(a,"col");const E=FV(),T=BV(),R=[],N=[];return E.forEach(I=>{const j=h[I];delete h[I];let M,F,Y;typeof j=="object"&&j!=null?{span:M,offset:F,order:Y}=j:M=j;const Z=I!==T?`-${I}`:"";M&&R.push(M===!0?`${a}${Z}`:`${a}${Z}-${M}`),Y!=null&&N.push(`order${Z}-${Y}`),F!=null&&N.push(`offset${Z}-${F}`)}),[{...h,className:Pn(d,...R,...N)},{as:l,bsPrefix:a,spans:R}]}const Qw=ie.forwardRef((l,a)=>{const[{className:d,...h},{as:E="div",bsPrefix:T,spans:R}]=vX(l);return f.jsx(E,{...h,ref:a,className:Pn(d,!R.length&&T)})});Qw.displayName="Col";const rF=ie.forwardRef(({bsPrefix:l,fluid:a=!1,as:d="div",className:h,...E},T)=>{const R=Bn(l,"container"),N=typeof a=="string"?`-${a}`:"-fluid";return f.jsx(d,{ref:T,...E,className:Pn(h,a?`${R}${N}`:R)})});rF.displayName="Container";const yX={type:ku.string,tooltip:ku.bool,as:ku.elementType},lS=ie.forwardRef(({as:l="div",className:a,type:d="valid",tooltip:h=!1,...E},T)=>f.jsx(l,{...E,ref:T,className:Pn(a,`${d}-${h?"tooltip":"feedback"}`)}));lS.displayName="Feedback";lS.propTypes=yX;const Aa=ie.createContext({}),Zw=ie.forwardRef(({id:l,bsPrefix:a,className:d,type:h="checkbox",isValid:E=!1,isInvalid:T=!1,as:R="input",...N},I)=>{const{controlId:j}=ie.useContext(Aa);return a=Bn(a,"form-check-input"),f.jsx(R,{...N,ref:I,type:h,id:l||j,className:Pn(d,a,E&&"is-valid",T&&"is-invalid")})});Zw.displayName="FormCheckInput";const Qg=ie.forwardRef(({bsPrefix:l,className:a,htmlFor:d,...h},E)=>{const{controlId:T}=ie.useContext(Aa);return l=Bn(l,"form-check-label"),f.jsx("label",{...h,ref:E,htmlFor:d||T,className:Pn(a,l)})});Qg.displayName="FormCheckLabel";const sF=ie.forwardRef(({id:l,bsPrefix:a,bsSwitchPrefix:d,inline:h=!1,reverse:E=!1,disabled:T=!1,isValid:R=!1,isInvalid:N=!1,feedbackTooltip:I=!1,feedback:j,feedbackType:M,className:F,style:Y,title:Z="",type:X="checkbox",label:q,children:re,as:se="input",...$},Q)=>{a=Bn(a,"form-check"),d=Bn(d,"form-switch");const{controlId:me}=ie.useContext(Aa),Ee=ie.useMemo(()=>({controlId:l||me}),[me,l]),Ue=!re&&q!=null&&q!==!1||TX(re,Qg),Oe=f.jsx(Zw,{...$,type:X==="switch"?"checkbox":X,ref:Q,isValid:R,isInvalid:N,disabled:T,as:se});return f.jsx(Aa.Provider,{value:Ee,children:f.jsx("div",{style:Y,className:Pn(F,Ue&&a,h&&`${a}-inline`,E&&`${a}-reverse`,X==="switch"&&d),children:re||f.jsxs(f.Fragment,{children:[Oe,Ue&&f.jsx(Qg,{title:Z,children:q}),j&&f.jsx(lS,{type:M,tooltip:I,children:j})]})})})});sF.displayName="FormCheck";const Zg=Object.assign(sF,{Input:Zw,Label:Qg}),oF=ie.forwardRef(({bsPrefix:l,type:a,size:d,htmlSize:h,id:E,className:T,isValid:R=!1,isInvalid:N=!1,plaintext:I,readOnly:j,as:M="input",...F},Y)=>{const{controlId:Z}=ie.useContext(Aa);return l=Bn(l,"form-control"),f.jsx(M,{...F,type:a,size:h,ref:Y,readOnly:j,id:E||Z,className:Pn(T,I?`${l}-plaintext`:l,d&&`${l}-${d}`,a==="color"&&`${l}-color`,R&&"is-valid",N&&"is-invalid")})});oF.displayName="FormControl";const RX=Object.assign(oF,{Feedback:lS}),aF=ie.forwardRef(({className:l,bsPrefix:a,as:d="div",...h},E)=>(a=Bn(a,"form-floating"),f.jsx(d,{ref:E,className:Pn(l,a),...h})));aF.displayName="FormFloating";const eA=ie.forwardRef(({controlId:l,as:a="div",...d},h)=>{const E=ie.useMemo(()=>({controlId:l}),[l]);return f.jsx(Aa.Provider,{value:E,children:f.jsx(a,{...d,ref:h})})});eA.displayName="FormGroup";const cF=ie.forwardRef(({as:l="label",bsPrefix:a,column:d=!1,visuallyHidden:h=!1,className:E,htmlFor:T,...R},N)=>{const{controlId:I}=ie.useContext(Aa);a=Bn(a,"form-label");let j="col-form-label";typeof d=="string"&&(j=`${j} ${j}-${d}`);const M=Pn(E,a,h&&"visually-hidden",d&&j);return T=T||I,d?f.jsx(Qw,{ref:N,as:"label",className:M,htmlFor:T,...R}):f.jsx(l,{ref:N,className:M,htmlFor:T,...R})});cF.displayName="FormLabel";const lF=ie.forwardRef(({bsPrefix:l,className:a,id:d,...h},E)=>{const{controlId:T}=ie.useContext(Aa);return l=Bn(l,"form-range"),f.jsx("input",{...h,type:"range",ref:E,className:Pn(a,l),id:d||T})});lF.displayName="FormRange";const dF=ie.forwardRef(({bsPrefix:l,size:a,htmlSize:d,className:h,isValid:E=!1,isInvalid:T=!1,id:R,...N},I)=>{const{controlId:j}=ie.useContext(Aa);return l=Bn(l,"form-select"),f.jsx("select",{...N,size:d,ref:I,className:Pn(h,l,a&&`${l}-${a}`,E&&"is-valid",T&&"is-invalid"),id:R||j})});dF.displayName="FormSelect";const uF=ie.forwardRef(({bsPrefix:l,className:a,as:d="small",muted:h,...E},T)=>(l=Bn(l,"form-text"),f.jsx(d,{...E,ref:T,className:Pn(a,l,h&&"text-muted")})));uF.displayName="FormText";const hF=ie.forwardRef((l,a)=>f.jsx(Zg,{...l,ref:a,type:"switch"}));hF.displayName="Switch";const bX=Object.assign(hF,{Input:Zg.Input,Label:Zg.Label}),pF=ie.forwardRef(({bsPrefix:l,className:a,children:d,controlId:h,label:E,...T},R)=>(l=Bn(l,"form-floating"),f.jsxs(eA,{ref:R,className:Pn(a,l),controlId:h,...T,children:[d,f.jsx("label",{htmlFor:h,children:E})]})));pF.displayName="FloatingLabel";const CX={_ref:ku.any,validated:ku.bool,as:ku.elementType},tA=ie.forwardRef(({className:l,validated:a,as:d="form",...h},E)=>f.jsx(d,{...h,ref:E,className:Pn(l,a&&"was-validated")}));tA.displayName="Form";tA.propTypes=CX;const dw=Object.assign(tA,{Group:eA,Control:RX,Floating:aF,Check:Zg,Switch:bX,Label:cF,Text:uF,Range:lF,Select:dF,FloatingLabel:pF}),fF=ie.forwardRef(({bsPrefix:l,className:a,as:d="div",...h},E)=>{const T=Bn(l,"row"),R=FV(),N=BV(),I=`${T}-cols`,j=[];return R.forEach(M=>{const F=h[M];delete h[M];let Y;F!=null&&typeof F=="object"?{cols:Y}=F:Y=F;const Z=M!==N?`-${M}`:"";Y!=null&&j.push(`${I}${Z}-${Y}`)}),f.jsx(d,{ref:E,...h,className:Pn(a,T,...j)})});fF.displayName="Row";const ff=Vg("https://api.japaneseacademy.online"),nA=({userRole:l,firstName:a})=>{const[d,h]=ie.useState(""),[E,T]=ie.useState([]);ie.useEffect(()=>(ff.on("chatHistory",I=>{T(I)}),ff.on("receiveMessage",I=>{T(j=>[...j,I])}),()=>{ff.off("chatHistory"),ff.off("receiveMessage")}),[]);const R=()=>{if(d.trim()){const I={sender:a,role:l,text:d,timestamp:new Date().toLocaleTimeString()};ff.emit("sendMessage",I),h("")}},N=localStorage.getItem("firstName");return f.jsx(f.Fragment,{children:f.jsx(rF,{children:f.jsx(fF,{className:"justify-content-center mt-4",children:f.jsx(Qw,{md:11,children:f.jsx(ij,{className:"w-100",children:f.jsxs(ij.Body,{children:[f.jsx("div",{className:"chat-box",style:{height:"300px",overflowY:"scroll",border:"1px solid #ddd",padding:"10px"},children:E.map((I,j)=>f.jsxs("div",{className:`message ${I.role==="teacher"?"text-primary":"text-success"}`,children:[f.jsxs("strong",{children:[I.sender," (",localStorage.getItem("userRole")==="teacher"?" المعلم":`${N} الطالب`,"):"]})," ",I.text,f.jsx("div",{style:{fontSize:"0.8rem",color:"#888"},children:I.timestamp})]},j))}),f.jsxs(dw,{className:"mt-3",children:[f.jsx(dw.Group,{controlId:"messageInput",children:f.jsx(dw.Control,{type:"text",placeholder:"اكتب رسالتك هنا...",value:d,onChange:I=>h(I.target.value)})}),f.jsx(zV,{className:"webRtcSend mt-2",variant:"primary",onClick:R,children:"إرسال"})]})]})})})})})})};function wX(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M8.25 4.5a3.75 3.75 0 1 1 7.5 0v8.25a3.75 3.75 0 1 1-7.5 0V4.5Z"},child:[]},{tag:"path",attr:{d:"M6 10.5a.75.75 0 0 1 .75.75v1.5a5.25 5.25 0 1 0 10.5 0v-1.5a.75.75 0 0 1 1.5 0v1.5a6.751 6.751 0 0 1-6 6.709v2.291h3a.75.75 0 0 1 0 1.5h-7.5a.75.75 0 0 1 0-1.5h3v-2.291a6.751 6.751 0 0 1-6-6.709v-1.5A.75.75 0 0 1 6 10.5Z"},child:[]}]})(l)}function AX(l){return Ft({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.38,229.92a8,8,0,0,1-11.3-.54l-30.92-34A78.83,78.83,0,0,1,136,207.59V240a8,8,0,0,1-16,0V207.6A80.11,80.11,0,0,1,48,128a8,8,0,0,1,16,0,64.07,64.07,0,0,0,64,64,63.41,63.41,0,0,0,32.21-8.68l-11.1-12.2A48,48,0,0,1,80,128V95.09L42.08,53.38A8,8,0,0,1,53.92,42.62l160,176A8,8,0,0,1,213.38,229.92Zm-24.19-63.13a7.88,7.88,0,0,0,3.51.82,8,8,0,0,0,7.19-4.49A79.16,79.16,0,0,0,208,128a8,8,0,0,0-16,0,63.32,63.32,0,0,1-6.48,28.09A8,8,0,0,0,189.19,166.79Zm-27.33-29.22A8,8,0,0,0,175.74,133a49.49,49.49,0,0,0,.26-5V64A48,48,0,0,0,84,44.87a8,8,0,0,0,1.41,8.57Z"},child:[]}]})(l)}function IX(l){return Ft({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 3H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3"},child:[]},{tag:"path",attr:{d:"M8 21h8"},child:[]},{tag:"path",attr:{d:"M12 17v4"},child:[]},{tag:"path",attr:{d:"m17 8 5-5"},child:[]},{tag:"path",attr:{d:"M17 3h5v5"},child:[]}]})(l)}function rj(l){return Ft({tag:"svg",attr:{viewBox:"0 0 1024 1024",fill:"currentColor",fillRule:"evenodd"},child:[{tag:"path",attr:{d:"M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.118.118 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.118.118 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.118.118 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926 224.297 857.629c-.04.041-.06.052-.083.059a.118.118 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.118.118 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512 166.371 224.297c-.041-.04-.052-.06-.059-.083a.118.118 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.118.118 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.118.118 0 0 1 .07 0Z"},child:[]}]})(l)}const OX=()=>{const[l,a]=ie.useState([]),[d,h]=ie.useState(null);ie.useEffect(()=>{fetch("https://api.japaneseacademy.online/files").then(R=>R.json()).then(R=>a(R)).catch(R=>console.error("Error fetching files:",R))},[]);const E=R=>{h(R.target.files[0])},T=async()=>{if(!d){alert("Please select a file to upload.");return}const R=new FormData;R.append("file",d),R.append("uploader_id","user-id");try{const N=await fetch("https://api.japaneseacademy.online/uploads",{method:"POST",body:R});if(!N.ok){const j=await N.text();throw console.error("Error response:",j),new Error(`Failed to upload file: ${N.statusText}`)}const I=await N.json();a(j=>[...j,I.file]),h(null),alert("File uploaded successfully.")}catch(N){console.error("Error uploading file:",N),alert("Failed to upload file. Please try again later.")}};return f.jsxs("div",{className:"FilesWeb",children:[f.jsx("h3",{children:"مشاركة الملفات"}),f.jsx("input",{type:"file",onChange:E}),f.jsx("button",{className:"UploadFile",onClick:T,children:"رفع الملف"})," ",f.jsx("ul",{className:"containerFile",children:l.map(R=>f.jsxs("li",{children:[R.name," ",f.jsx("a",{className:"DownloadFile",href:R.url,download:!0,children:"تحميل"})]},R.id))})]})},NX="46c493c48baf40cead62de60ae7efda5",sj="main",DX=()=>{const[l]=ie.useState(Du.createClient({mode:"rtc",codec:"vp8"})),[a,d]=ie.useState([]),[h,E]=ie.useState([]),[T,R]=ie.useState(!1),[N,I]=ie.useState(!1),[j,M]=ie.useState(!1),[F,Y]=ie.useState(null),[Z,X]=ie.useState(!1),[q,re]=ie.useState(!1),se=io();ie.useEffect(()=>{(async()=>{const Ge=await(await fetch(`https://api.japaneseacademy.online/get-token?channelName=${sj}&uid=0`)).json();Y(Ge.token)})()},[]);const $=async()=>{if(!F)return;l.on("user-published",me),l.on("user-unpublished",Q);const ye=await l.join(NX,sj,F,null);if(a.length===0){const Le=await Du.createMicrophoneAndCameraTracks();d(Le),E(Ge=>[...Ge,{id:ye,videoTrack:Le[1]}]),await l.publish(Le)}},Q=ye=>{E(Le=>Le.filter(Ge=>Ge.id!==ye.uid))},me=async(ye,Le)=>{var Ge;await l.subscribe(ye,Le),Le==="video"&&ye.videoTrack&&E(Qe=>Qe.some(We=>We.id===ye.uid)?Qe:[...Qe,{id:ye.uid,videoTrack:ye.videoTrack}]),Le==="audio"&&((Ge=ye.audioTrack)==null||Ge.play())};ie.useEffect(()=>{$()},[F]),ie.useEffect(()=>{h.forEach(ye=>{const Le=document.getElementById(`user-${ye.id}`);Le&&ye.videoTrack&&ye.videoTrack.play(Le)})},[h]);const Ee=async()=>{for(let ye of a)ye.stop(),ye.close();await l.leave(),d([]),E([]),se("/")},Ue=async()=>{if(a[0]){const ye=!T;a[0].setEnabled(!ye),R(ye)}},Oe=async()=>{if(a[1]){const ye=!N;a[1].setEnabled(!ye),I(ye)}},xe=async()=>{if(j){await l.unpublish(a[1]);const ye=await Du.createMicrophoneAndCameraTracks();d(ye),await l.publish(ye),M(!1)}else{const ye=await Du.createScreenVideoTrack();await l.unpublish(a[1]),d([a[0],ye]),await l.publish(ye),M(!0)}};return f.jsxs("div",{className:"webRtc",children:[f.jsx("div",{id:"video-streams",children:h.map(ye=>f.jsx("div",{id:`user-${ye.id}`,style:{background:ye.videoTrack?"black":"transparent"}},ye.id))}),f.jsxs("div",{className:"webRtcButtons",children:[f.jsx("button",{className:"webRtcCamera",onClick:Ue,style:{backgroundColor:T?"#EE4B2B":"cadetblue"},children:T?f.jsx(AX,{}):f.jsx(wX,{})}),f.jsx("button",{className:"webRtcMic",onClick:Oe,style:{backgroundColor:N?"#EE4B2B":"cadetblue"},children:N?f.jsx(JY,{}):f.jsx($Y,{})}),f.jsx("button",{className:"webRtcScreenShare",onClick:xe,style:{backgroundColor:j?"#EE4B2B":"cadetblue"},children:f.jsx(IX,{})}),f.jsx("button",{className:"endCall",onClick:Ee,children:f.jsx(zY,{})})]}),f.jsx("button",{className:"chatButton",onClick:()=>X(!Z),children:f.jsx(qY,{})}),Z&&f.jsxs("div",{className:"chatContainer",children:[f.jsx("button",{className:"closeChat",onClick:()=>X(!1),style:{position:"absolute",top:0,right:0},children:f.jsx(rj,{})}),f.jsx(nA,{})]}),f.jsx("button",{className:"FileButton ",onClick:()=>re(!q),children:f.jsx(jY,{})}),q&&f.jsxs("div",{className:"FileContainer ",children:[f.jsx("button",{className:"closeFiles",onClick:()=>re(!1),style:{position:"absolute",top:0,right:0},children:f.jsx(rj,{})}),f.jsx(OX,{})]})]})};function PX(){return ie.useEffect(()=>{document.title="academy"},[]),f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(M$,{}),f.jsx(Ai,{})]})}function LX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(ez,{}),f.jsx(nz,{}),f.jsx(tz,{}),f.jsx(iz,{}),f.jsx(rz,{}),f.jsx(sz,{}),f.jsx(oz,{}),f.jsx(vV,{}),f.jsx(az,{}),f.jsx(Ai,{})]})}function kX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(cz,{}),f.jsx(Ai,{})]})}function xX(){return f.jsx(f.Fragment,{children:f.jsx(E$,{})})}function MX(){return f.jsx(f.Fragment,{children:f.jsx(g$,{})})}function UX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(v$,{}),f.jsx(Ai,{})]})}function jX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(R$,{}),f.jsx(N$,{}),f.jsx(Ai,{})]})}function VX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(U$,{}),f.jsx(Ai,{})]})}function FX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(V$,{}),f.jsx(Ai,{})]})}function BX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(H$,{}),f.jsx(Ai,{})]})}function GX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(K$,{}),f.jsx(Ai,{})]})}function HX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(z$,{}),f.jsx(Ai,{})]})}function WX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx($$,{}),f.jsx(Ai,{})]})}function KX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(X$,{}),f.jsx(Ai,{})]})}function YX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(eJ,{}),f.jsx(Ai,{})]})}function zX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(Z$,{}),f.jsx(Ai,{})]})}function qX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(hJ,{}),f.jsx(nA,{}),f.jsx(tJ,{}),f.jsx(Ai,{})]})}function $X(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(rJ,{}),f.jsx(Ai,{})]})}function JX(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(vV,{}),f.jsx(Ai,{})]})}const XX="/assets/_4406e21c-6fff-4238-900e-8718d8d061de.B7loVfxR.jpg",QX="/assets/_6c036b6a-95ec-4a89-94cb-7b3657d6a1b6.DLw9CdB6.jpg";function ZX(){return f.jsx(f.Fragment,{children:f.jsx("div",{className:"container Privacy mt-4",children:f.jsxs("div",{className:"details_privacy",children:[f.jsxs("div",{className:"row academy mb-5",children:[f.jsxs("div",{className:"col-lg-8 col-md-6 col-12 text_privacy ",children:[f.jsx("h2",{className:"mb-3",children:"شروط الاستخدام"}),f.jsx("p",{children:"مرحبًا بكم في موقع أكاديمية اللغة اليابانية، المتخصص في تقديم دورات تعليم اللغة اليابانية عبر الإنترنت. باستخدامك لهذا الموقع، فإنك توافق على الالتزام بالشروط التالية أدناه. يُرجى قراءة هذه الشروط بعناية قبل البدء في استخدام الموقع أو التسجيل في أي من الدورات التعليمية."})]}),f.jsx("div",{className:"col-lg-4 col-md-6 col-12 img_privacy",children:f.jsx("img",{className:"m-auto",src:XX,alt:""})})]}),f.jsxs("div",{className:"ul_privacy",children:[f.jsxs("ul",{className:"academy row mb-5",children:[f.jsxs("div",{className:"col-lg-8",children:[f.jsx("h2",{children:"قبول الشروط"}),f.jsx("p",{children:"يُعد استخدام هذا الموقع أو التسجيل للحصول على خدمات الأكاديمية موافقة صريحة على الالتزام بشروط الاستخدام وسياسة الخصوصية. في حال عدم الموافقة على هذه الشروط، يُرجى الامتناع عن استخدام الموقع."})]}),f.jsx("div",{className:"col-lg-4 img_privacy",children:f.jsx("img",{className:"m-auto",src:QX,alt:""})}),f.jsx("p",{className:"mt-3",children:"يتم جمع هذه المعلومات بشكل رئيسي عند قيام الطالب بإنشاء حساب جديد أو التسجيل في إحدى الدورات التعليمية التي نقدمها."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"إنشاء الحساب"}),f.jsx("p",{children:"للاستفادة من خدمات الأكاديمية، يُطلب من جميع الطلاب إنشاء حساب شخصي يتضمن معلومات مثل الاسم، وتاريخ الميلاد، والبريد الإلكتروني، ورقم الهاتف. ويتحمل المستخدم مسؤولية دقة المعلومات المقدمة، ويلتزم بتحديثها في حال حدوث أي تغيير."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"الاستخدام المسموح به"}),f.jsxs("p",{children:["يوافق المستخدم على استخدام الموقع لأغراض تعليمية فقط، ويتعهد بما يلي:"," "]}),f.jsx("li",{children:"عدم استخدام الموقع أو أي من محتوياته لأغراض غير قانونية أو تنتهك حقوق الملكية الفكرية."}),f.jsx("li",{children:"الامتناع عن تحميل أو نشر أي محتوى ضار، أو فيروسات، أو برامج تهدف إلى التأثير سلبًا على تشغيل الموقع."}),f.jsxs("li",{children:["عدم محاولة الوصول غير المصرح به إلى أنظمة الأكاديمية، أو الحسابات الأخرى."," "]})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"حماية الحساب"}),f.jsx("p",{children:"يجب على المستخدم الحفاظ على سرية معلومات الدخول الخاصة به (اسم المستخدم وكلمة المرور). والأكاديمية غير مسؤولة عن أي استخدام غير مصرح به للحساب الشخصي الناتج عن عدم الحفاظ على سرية معلومات الدخول."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"الحقوق الفكرية"}),f.jsx("p",{children:"جميع المحتويات الموجودة على الموقع، بما في ذلك النصوص، والصور، والفيديوهات، والمحتوى التعليمي، هي ملك لأكاديمية اللغة اليابانية. ويُمنع منعًا باتًّا نسخ أو إعادة إنتاج أو توزيع أي محتوى دون الحصول على إذن خطي مسبق من الأكاديمية."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"سياسة الدفع والاسترداد"}),f.jsx("p",{children:"يُرجى مراجعة سياسة الرسوم والاسترداد الخاصة بالدورات التعليمية قبل التسجيل. يتم عرض الأسعار وشروط الدفع بشكل واضح، ولا يمكن استرداد الرسوم إلا وفقًا للسياسة التي تحددها الأكاديمية."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"التغييرات في الدورات أو الخدمات"}),f.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بالحق في تعديل أو إلغاء أي من الدورات أو الخدمات المقدمة عبر الموقع في أي وقت، دون الحاجة إلى إشعار مسبق. وستبذل الأكاديمية جهودًا لإعلام المستخدمين في حال وجود تغييرات كبيرة قد تؤثر على تجربتهم التعليمية في الأكاديمية."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"إخلاء المسؤولية"}),f.jsx("p",{children:"تبذل الأكاديمية جهدها لتقديم محتوى تعليمي عالي الجودة، لكنها لا تضمن خلو الموقع أو الدورات من الأخطاء أو الأعطال التقنية. كما أن الأكاديمية غير مسؤولة عن أي أضرار مباشرة أو غير مباشرة قد تحدث نتيجة استخدام الموقع."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"الروابط الخارجية"}),f.jsx("p",{children:"قد يحتوي الموقع على روابط لمواقع أخرى. والأكاديمية ليست مسؤولة عن المحتوى أو سياسة الخصوصية الخاصة بهذه المواقع الخارجية، ويجب على المستخدم مراجعة شروط الاستخدام وسياسة الخصوصية الخاصة بتلك المواقع قبل استخدامها."})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"التعديلات على الشروط"}),f.jsx("p",{children:"تحتفظ أكاديمية اللغة اليابانية بحقها في تعديل شروط الاستخدام هذه في أي وقت. وسيتم نشر التعديلات على هذه الصفحة مع تاريخ التحديث. يُنصح المستخدمون بمراجعة الشروط بشكل دوري لضمان فهمهم لأي تحديثات قد تطرأ.              "})]}),f.jsxs("ul",{className:"academy mb-5",children:[f.jsx("h2",{children:"التواصل"}),f.jsxs("p",{children:["في حال وجود أي استفسارات أو مشاكل تتعلق بشروط الاستخدام، يُرجى التواصل معنا عبر البريد الإلكتروني:",f.jsx("a",{href:"mailto:info@japaneseacademy.jp",children:"info@japaneseacademy.jp"}),f.jsx("p",{children:"باستخدامك لموقع أكاديمية اللغة اليابانية، فإنك توافق على الالتزام بجميع الشروط الواردة أعلاه."})]})]})]})]})})})}function eQ(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(ZX,{}),f.jsx(Ai,{})]})}function tQ(){return f.jsxs(f.Fragment,{children:[f.jsx(wi,{}),f.jsx(yV,{}),f.jsx(nA,{}),f.jsx(sJ,{}),f.jsx(oJ,{}),f.jsx(Ai,{})]})}const nQ=({isAuthenticated:l,children:a})=>l?a:f.jsx(EY,{to:"/Login",replace:!0});function iQ(l){return Ft({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M87.48 380c1.2-4.38-1.43-10.47-3.94-14.86a42.63 42.63 0 0 0-2.54-3.8 199.81 199.81 0 0 1-33-110C47.64 139.09 140.72 48 255.82 48 356.2 48 440 117.54 459.57 209.85a199 199 0 0 1 4.43 41.64c0 112.41-89.49 204.93-204.59 204.93-18.31 0-43-4.6-56.47-8.37s-26.92-8.77-30.39-10.11a31.14 31.14 0 0 0-11.13-2.07 30.7 30.7 0 0 0-12.08 2.43L81.5 462.78a15.92 15.92 0 0 1-4.66 1.22 9.61 9.61 0 0 1-9.58-9.74 15.85 15.85 0 0 1 .6-3.29z"},child:[]},{tag:"circle",attr:{cx:"160",cy:"256",r:"32"},child:[]},{tag:"circle",attr:{cx:"256",cy:"256",r:"32"},child:[]},{tag:"circle",attr:{cx:"352",cy:"256",r:"32"},child:[]}]})(l)}function rQ(){const[l,a]=ie.useState(!1),[d,h]=ie.useState(!1),[E,T]=ie.useState({necessary:!0,analytics:!0,preferences:!0});ie.useEffect(()=>{const M=localStorage.getItem("cookiesSettings");M&&(T(JSON.parse(M)),a(!0))},[]);const R=()=>{a(!0),document.cookie="acceptCookies=true; path=/; max-age="+60*60*24*30,localStorage.setItem("cookiesSettings",JSON.stringify(E))},N=()=>{a(!0),document.cookie="acceptCookies=false; path=/; max-age="+60*60*24*30},I=(M,F)=>{T(Y=>({...Y,[M]:F}))},j=()=>{localStorage.setItem("cookiesSettings",JSON.stringify(E)),document.cookie=`cookiesSettings=${JSON.stringify(E)}; path=/`,alert("تم حفظ إعدادات ملفات تعريف الارتباط بنجاح!"),a(!0),h(!1)};return f.jsx(f.Fragment,{children:f.jsxs("div",{className:"Cookies",children:[!l&&f.jsxs("div",{className:"cookie-banner",children:[f.jsxs("p",{className:"mb-4",children:["مرحبًا بكم في موقع أكاديمية اللغة اليابانية! ",f.jsx("br",{}),'نحن نستخدم ملفات تعريف الارتباط لتحسين تجربتكم. بالضغط على "قبول جميع ملفات تعريف الارتباط"، فإنكم توافقون على استخدامها.',f.jsx("br",{}),"لمزيد من التفاصيل، يُرجى الاطلاع على"," ",f.jsx("a",{href:"/Privacy",children:"سياسة الخصوصية"}),"."]}),f.jsxs("div",{className:"buttonsCookies",children:[f.jsx("button",{className:"mb-4",onClick:R,children:"قبول جميع ملفات تعريف الارتباط"}),f.jsx("button",{className:"mb-4",onClick:()=>h(!0),children:"إعدادات تعريف ملفات الارتباط"}),f.jsx("button",{onClick:N,children:"رفض"})]})]}),d&&f.jsx("div",{className:"modal-overlay",children:f.jsxs("div",{className:"modal",children:[f.jsx("h2",{children:"إعدادات ملفات تعريف الارتباط"}),f.jsx("p",{children:"قبل البدء بتصفح الموقع، يمكنك تعديل إعدادات ملفات تعريف الارتباط حسب تفضيلاتك."}),f.jsxs("div",{className:"cookie-option",children:[f.jsx("h3",{children:"1. ملفات الارتباط الضرورية"}),f.jsx("p",{children:"هذه الملفات ضرورية لتشغيل الموقع بشكل صحيح ولا يمكن تعطيلها."})]}),f.jsxs("div",{className:"cookie-option",children:[f.jsx("h3",{children:"2. ملفات الارتباط التحليلية"}),f.jsx("p",{children:"تساعدنا في تحسين الأداء وتحليل سلوك المستخدم."}),f.jsx("button",{className:E.analytics?"active_disable":"",onClick:()=>I("analytics",!0),children:"تفعيل"}),f.jsx("button",{className:E.analytics?"":"active_enable",onClick:()=>I("analytics",!1),children:"تعطيل"})]}),f.jsxs("div",{className:"cookie-option",children:[f.jsx("h3",{children:"3. ملفات الارتباط الخاصة بالتفضيلات"}),f.jsx("p",{children:"تسمح بحفظ تفضيلاتك لتوفير تجربة مخصصة عند العودة للموقع."}),f.jsx("button",{className:E.preferences?"active_disable":"",onClick:()=>I("preferences",!0),children:"تفعيل"}),f.jsx("button",{className:E.preferences?"":"active_enable",onClick:()=>I("preferences",!1),children:"تعطيل"})]}),f.jsx("div",{className:"actions",children:f.jsx("button",{onClick:j,children:"حفظ الإعدادات"})})]})})]})})}function sQ(){const[l,a]=ie.useState(!1);ie.useEffect(()=>{const j=setTimeout(()=>{a(!0)},1300);return()=>clearTimeout(j)},[]);const[d,h]=ie.useState(!1);ie.useEffect(()=>{h(!0),setTimeout(()=>{h(!1)},100)},[]);const[E,T]=ie.useState(!1),R=()=>{T(!E)},[N,I]=ie.useState(!1);return ie.useEffect(()=>{const j=localStorage.getItem("auth");I(j==="true")},[]),ie.useEffect(()=>{const j=document.querySelectorAll(".up"),M=()=>{window.scrollY>=120?j.forEach(Y=>Y.classList.add("look")):j.forEach(Y=>Y.classList.remove("look"))},F=()=>{window.scrollTo({top:0,behavior:"smooth"})};return window.addEventListener("scroll",M),j.forEach(Y=>Y.addEventListener("click",F)),()=>{window.removeEventListener("scroll",M),j.forEach(Y=>Y.removeEventListener("click",F))}},[]),f.jsx(f.Fragment,{children:f.jsxs(f.Fragment,{children:[f.jsx(rQ,{}),f.jsx("button",{className:"up",children:f.jsx(HY,{})}),f.jsx("div",{className:"social",children:f.jsxs("ul",{onClick:R,style:{cursor:"pointer"},children:[f.jsx("li",{className:"click",children:f.jsx(iQ,{})}),E&&f.jsxs(f.Fragment,{children:[f.jsx("li",{className:"line top",children:f.jsx("a",{href:"https://line.me/ti/p/IuAqVt59QV",children:f.jsx(VY,{})})}),f.jsx("li",{className:"email top",children:f.jsx("a",{href:"mailto:contact@sawagroup.jp",children:f.jsx(Dj,{})})}),f.jsx("li",{className:"whatsapp top",children:f.jsx("a",{href:"https://wa.link/mr0gya",children:f.jsx(Wg,{})})})]})]})}),d?f.jsx("img",{className:"Loading",src:Uw,alt:""}):f.jsx(wY,{children:f.jsxs(SY,{children:[f.jsx(ei,{path:"/",element:f.jsx(PX,{})}),f.jsx(ei,{path:"/About",element:f.jsx(LX,{})}),f.jsx(ei,{path:"/Date",element:f.jsx(kX,{})}),f.jsx(ei,{path:"/Login",element:f.jsx(MX,{})}),f.jsx(ei,{path:"/Articles",element:f.jsx(jX,{})}),f.jsx(ei,{path:"/Level_division",element:f.jsx(FX,{})}),f.jsx(ei,{path:"/Register",element:f.jsx(VX,{})}),f.jsx(ei,{path:"/Teachers",element:f.jsx(BX,{})}),f.jsx(ei,{path:"/Study_materials",element:f.jsx(GX,{})}),f.jsx(ei,{path:"/More_services",element:f.jsx(HX,{})}),f.jsx(ei,{path:"/Support",element:f.jsx(WX,{})}),f.jsx(ei,{path:"/Fees",element:f.jsx(KX,{})}),f.jsx(ei,{path:"/Register_account",element:f.jsx(zX,{})}),f.jsx(ei,{path:"/Login_users",element:f.jsx(YX,{})}),f.jsx(ei,{path:"/Dash_users/:userId",element:f.jsx(qX,{})}),f.jsx(ei,{path:"/Comments",element:f.jsx(JX,{})}),f.jsx(ei,{path:"/Questions",element:f.jsx(UX,{})}),f.jsx(ei,{path:"/Privacy",element:f.jsx($X,{})}),f.jsx(ei,{path:"/Terms",element:f.jsx(eQ,{})}),f.jsx(ei,{path:"/Dash_Teachers",element:f.jsx(tQ,{})}),f.jsx(ei,{path:"/meetingNow",element:f.jsx(DX,{})}),f.jsx(ei,{path:"/Dash",element:f.jsx(nQ,{isAuthenticated:!!localStorage.getItem("auth"),children:f.jsx(xX,{})})})]})})]})})}uw.createRoot(document.getElementById("root")).render(f.jsx(Mn.StrictMode,{children:f.jsx(sQ,{})}));
